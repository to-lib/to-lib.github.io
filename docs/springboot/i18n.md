---
sidebar_position: 22
---

# 国际化 (i18n)

> [!TIP]
> **国际化的重要性**: 让应用支持多语言，面向全球用户，提升用户体验。Spring Boot 提供了完善的国际化支持。

## 基本配置

### 创建资源文件

在 `src/main/resources` 目录下创建国际化资源文件：

```
resources/
  ├── messages.properties (默认,英文)
  ├── messages_zh_CN.properties (中文简体)
  ├── messages_zh_TW.properties (中文繁体)
  └── messages_ja.properties (日语)
```

### messages.properties (默认英文)

```properties
greeting=Hello
welcome=Welcome, {0}!
user.not.found=User not found
error.invalid.email=Invalid email format
```

### messages_zh_CN.properties (中文)

```properties
greeting=你好
welcome=欢迎, {0}!
user.not.found=用户未找到
error.invalid.email=邮箱格式不正确
```

### 配置 MessageSource

```java
@Configuration
public class I18nConfig {
    
    @Bean
    public MessageSource messageSource() {
        ResourceBundleMessageSource messageSource = 
            new ResourceBundleMessageSource();
        messageSource.setBasename("messages");
        messageSource.setDefaultEncoding("UTF-8");
        messageSource.setCacheSeconds(3600);
        return messageSource;
    }
    
    @Bean
    public LocaleResolver localeResolver() {
        // 方式1：从请求头获取语言（推荐）
        AcceptHeaderLocaleResolver resolver = new AcceptHeaderLocaleResolver();
        resolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);
        return resolver;
        
        // 方式2：从 Cookie 获取
        // CookieLocaleResolver resolver = new CookieLocaleResolver();
        // resolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);
        // return resolver;
        
        // 方式3：从 Session 获取
        // SessionLocaleResolver resolver = new SessionLocaleResolver();
        // resolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);
        // return resolver;
    }
}
```

## 使用国际化

### 在代码中使用

```java
@Service
public class UserService {
    
    @Autowired
    private MessageSource messageSource;
    
    public String getGreeting(Locale locale) {
        return messageSource.getMessage("greeting", null, locale);
    }
    
    public String getWelcomeMessage(String username, Locale locale) {
        return messageSource.getMessage(
            "welcome", 
            new Object[]{username}, 
            locale
        );
    }
    
    public void validateUser(User user, Locale locale) {
        if (user == null) {
            String message = messageSource.getMessage(
                "user.not.found", null, locale);
            throw new NotFoundException(message);
        }
    }
}
```

### 在 Controller 中使用

```java
@RestController
@RequestMapping("/api")
public class GreetingController {
    
    @Autowired
    private MessageSource messageSource;
    
    @GetMapping("/greeting")
    public ResponseEntity<String> greeting(
            @RequestHeader(value = "Accept-Language", required = false) Locale locale) {
        
        String message = messageSource.getMessage("greeting", null, locale);
        return ResponseEntity.ok(message);
    }
    
    // 使用 LocaleContextHolder
    @GetMapping("/welcome")
    public ResponseEntity<String> welcome(@RequestParam String name) {
        Locale locale = LocaleContextHolder.getLocale();
        String message = messageSource.getMessage(
            "welcome", new Object[]{name}, locale);
        return ResponseEntity.ok(message);
    }
}
```

## 动态切换语言

### 添加拦截器

```java
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        LocaleChangeInterceptor interceptor = new LocaleChangeInterceptor();
        interceptor.setParamName("lang"); // URL参数名
        registry.addInterceptor(interceptor);
    }
}
```

### 使用

```
# 切换到中文
GET /api/greeting?lang=zh_CN

# 切换到英文
GET /api/greeting?lang=en

# 切换到日语
GET /api/greeting?lang=ja
```

## 验证消息国际化

### 实体类

```java
public class User {
    @NotBlank(message = "{user.username.notblank}")
    @Size(min = 3, max = 20, message = "{user.username.size}")
    private String username;
    
    @NotBlank(message = "{user.email.notblank}")
    @Email(message = "{user.email.invalid}")
    private String email;
}
```

### ValidationMessages.properties

```properties
user.username.notblank=用户名不能为空
user.username.size=用户名长度必须在 {min} 到 {max} 之间
user.email.notblank=邮箱不能为空
user.email.invalid=邮箱格式不正确
```

## 完整示例

### 统一响应类

```java
@Data
@AllArgsConstructor
public class ApiResponse<T> {
    private int code;
    private String message;
    private T data;
    
    public static <T> ApiResponse<T> success(String messageKey, T data) {
        Locale locale = LocaleContextHolder.getLocale();
        String message = SpringContextHolder.getBean(MessageSource.class)
            .getMessage(messageKey, null, locale);
        return new ApiResponse<>(200, message, data);
    }
    
    public static <T> ApiResponse<T> error(String messageKey) {
        Locale locale = LocaleContextHolder.getLocale();
        String message = SpringContextHolder.getBean(MessageSource.class)
            .getMessage(messageKey, null, locale);
        return new ApiResponse<>(500, message, null);
    }
}
```

### 全局异常处理

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    @Autowired
    private MessageSource messageSource;
    
    @ExceptionHandler(NotFoundException.class)
    public ResponseEntity<ApiResponse<Void>> handleNotFound(
            NotFoundException ex, Locale locale) {
        
        String message = messageSource.getMessage(
            "user.not.found", null, locale);
        return ResponseEntity.status(HttpStatus.NOT_FOUND)
            .body(new ApiResponse<>(404, message, null));
    }
}
```

## 最佳实践

> [!TIP]
> **国际化最佳实践**：
>
> 1. **使用 UTF-8 编码** - 确保所有资源文件使用 UTF-8
> 2. **合理的默认语言** - 设置合适的默认语言
> 3. **占位符参数化** - 使用参数而非硬编码
> 4. **统一管理** - 将所有文本集中在资源文件中
> 5. **测试覆盖** - 测试所有支持的语言

## 总结

- **MessageSource** - Spring 国际化核心接口
- **LocaleResolver** - 语言解析器
- **资源文件** - messages*.properties 文件
- **动态切换** - 支持运行时切换语言

下一步学习 [开发者工具](./devtools)。

---
sidebar_position: 22
title: é¢è¯•é¢˜æ±‡æ€»
---

# C è¯­è¨€é¢è¯•é¢˜æ±‡æ€»

å¸¸è§ C è¯­è¨€é¢è¯•é¢˜åŠè§£ç­”ã€‚

## åŸºç¡€æ¦‚å¿µ

### Q1: sizeof å’Œ strlen çš„åŒºåˆ«ï¼Ÿ

```c
char str[] = "Hello";
char *ptr = "Hello";

sizeof(str);   // 6 (åŒ…å« '\0')
strlen(str);   // 5 (ä¸åŒ…å« '\0')
sizeof(ptr);   // 8 (64ä½ç³»ç»ŸæŒ‡é’ˆå¤§å°)
strlen(ptr);   // 5
```

**ç­”ï¼š** sizeof æ˜¯ç¼–è¯‘æ—¶è¿ç®—ç¬¦ï¼Œè¿”å›ç±»å‹/å˜é‡å ç”¨çš„å­—èŠ‚æ•°ï¼›strlen æ˜¯è¿è¡Œæ—¶å‡½æ•°ï¼Œè¿”å›å­—ç¬¦ä¸²é•¿åº¦ï¼ˆä¸å« `\0`ï¼‰ã€‚

### Q2: #define å’Œ const çš„åŒºåˆ«ï¼Ÿ

| ç‰¹æ€§     | #define          | const             |
| -------- | ---------------- | ----------------- |
| å¤„ç†æ—¶æœº | é¢„å¤„ç†é˜¶æ®µ       | ç¼–è¯‘é˜¶æ®µ          |
| ç±»å‹æ£€æŸ¥ | æ—                | æœ‰                |
| è°ƒè¯•æ”¯æŒ | æ— ç¬¦å·           | æœ‰ç¬¦å·            |
| ä½œç”¨åŸŸ   | ä»å®šä¹‰åˆ°æ–‡ä»¶ç»“æŸ | éµå¾ª C ä½œç”¨åŸŸè§„åˆ™ |
| å†…å­˜     | æ— å†…å­˜åˆ†é…       | å¯èƒ½åˆ†é…å†…å­˜      |

### Q3: static å…³é”®å­—çš„ä½œç”¨ï¼Ÿ

```c
// 1. é™æ€å±€éƒ¨å˜é‡ï¼šç”Ÿå‘½å‘¨æœŸå»¶é•¿åˆ°ç¨‹åºç»“æŸ
void func(void) {
    static int count = 0;  // åªåˆå§‹åŒ–ä¸€æ¬¡
    count++;
}

// 2. é™æ€å…¨å±€å˜é‡/å‡½æ•°ï¼šé™åˆ¶åœ¨æœ¬æ–‡ä»¶å¯è§
static int file_private = 10;
static void helper(void) { }

// 3. ç»“æ„ä½“ä¸­æ— ç‰¹æ®Šä½œç”¨ï¼ˆCæ²¡æœ‰é™æ€æˆå‘˜çš„æ¦‚å¿µï¼‰
```

### Q4: volatile çš„ä½œç”¨ï¼Ÿ

```c
// å‘Šè¯‰ç¼–è¯‘å™¨å˜é‡å¯èƒ½è¢«å¤–éƒ¨ä¿®æ”¹ï¼Œç¦æ­¢ä¼˜åŒ–

volatile int flag = 0;  // ç¡¬ä»¶å¯„å­˜å™¨æˆ–ä¸­æ–­å˜é‡

// æ¯æ¬¡éƒ½ä»å†…å­˜è¯»å–ï¼Œä¸ä½¿ç”¨ç¼“å­˜å€¼
while (!flag) { }
```

**å¸¸è§åœºæ™¯ï¼š** ç¡¬ä»¶å¯„å­˜å™¨ã€ä¸­æ–­æœåŠ¡ç¨‹åºå…±äº«å˜é‡ã€å¤šçº¿ç¨‹å…±äº«å˜é‡ã€‚

## æŒ‡é’ˆç›¸å…³

### Q5: ä»¥ä¸‹ä»£ç è¾“å‡ºä»€ä¹ˆï¼Ÿ

```c
int arr[] = {1, 2, 3, 4, 5};
int *p = arr;

printf("%d\n", *(p++));   // 1, p æŒ‡å‘ arr[1]
printf("%d\n", *(++p));   // 3, p å…ˆç§»åŠ¨å†è§£å¼•ç”¨
printf("%d\n", *p++);     // 3, ç­‰ä»·äº *(p++)
printf("%d\n", ++*p);     // 5, *p=arr[3]=4, ++4=5
```

### Q6: æŒ‡é’ˆå’Œæ•°ç»„çš„åŒºåˆ«ï¼Ÿ

```c
int arr[5];
int *ptr;

sizeof(arr);    // 20 (5 * 4)
sizeof(ptr);    // 8 (æŒ‡é’ˆå¤§å°)

arr++;          // é”™è¯¯ï¼æ•°ç»„åæ˜¯å¸¸é‡
ptr++;          // æ­£ç¡®

// ä½œä¸ºå‡½æ•°å‚æ•°æ—¶ï¼Œæ•°ç»„é€€åŒ–ä¸ºæŒ‡é’ˆ
void func(int arr[]) { }  // arr æ˜¯æŒ‡é’ˆ
```

### Q7: è§£é‡Šä»¥ä¸‹å£°æ˜

```c
int *p;              // æŒ‡å‘ int çš„æŒ‡é’ˆ
int **p;             // æŒ‡å‘ int* çš„æŒ‡é’ˆ
int *p[10];          // åŒ…å« 10 ä¸ª int* çš„æ•°ç»„
int (*p)[10];        // æŒ‡å‘ int[10] çš„æŒ‡é’ˆ
int (*p)(int);       // æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ
int *(*p)(int);      // è¿”å› int* çš„å‡½æ•°æŒ‡é’ˆ
```

### Q8: NULL å’Œ 0 çš„åŒºåˆ«ï¼Ÿ

```c
// åœ¨æŒ‡é’ˆä¸Šä¸‹æ–‡ä¸­ï¼ŒNULL å’Œ 0 ç­‰ä»·
int *p1 = NULL;
int *p2 = 0;         // éƒ½è¡¨ç¤ºç©ºæŒ‡é’ˆ

// ä½† NULL è¯­ä¹‰æ›´æ¸…æ™°
if (p == NULL) { }   // æ¨è
if (p == 0) { }      // å¯è¡Œä½†ä¸æ¨è
if (!p) { }          // å¯è¡Œ
```

## å†…å­˜ç®¡ç†

### Q9: malloc å’Œ calloc çš„åŒºåˆ«ï¼Ÿ

```c
int *p1 = malloc(10 * sizeof(int));   // æœªåˆå§‹åŒ–
int *p2 = calloc(10, sizeof(int));    // åˆå§‹åŒ–ä¸º 0

// ç­‰ä»·æ“ä½œ
int *p3 = malloc(10 * sizeof(int));
memset(p3, 0, 10 * sizeof(int));
```

### Q10: å†…å­˜æ³„æ¼çš„å¸¸è§åŸå› ï¼Ÿ

```c
// 1. å¿˜è®° free
void leak1(void) {
    int *p = malloc(100);
    // æ²¡æœ‰ free
}

// 2. è¦†ç›–æŒ‡é’ˆ
void leak2(void) {
    int *p = malloc(100);
    p = malloc(200);  // å‰ 100 å­—èŠ‚æ³„æ¼
    free(p);
}

// 3. æå‰è¿”å›
void leak3(int flag) {
    int *p = malloc(100);
    if (flag) return;  // æœªé‡Šæ”¾å°±è¿”å›
    free(p);
}
```

### Q11: é‡æŒ‡é’ˆå’Œæ‚¬ç©ºæŒ‡é’ˆï¼Ÿ

```c
// é‡æŒ‡é’ˆï¼šæœªåˆå§‹åŒ–
int *wild;     // æŒ‡å‘æœªçŸ¥åœ°å€
*wild = 10;    // å±é™©ï¼

// æ‚¬ç©ºæŒ‡é’ˆï¼šæŒ‡å‘å·²é‡Šæ”¾çš„å†…å­˜
int *dangling = malloc(sizeof(int));
free(dangling);
*dangling = 10;  // å±é™©ï¼

// é¢„é˜²ï¼šåˆå§‹åŒ–ä¸º NULLï¼Œé‡Šæ”¾åç½® NULL
int *safe = NULL;
safe = malloc(sizeof(int));
free(safe);
safe = NULL;
```

## å­—ç¬¦ä¸²

### Q12: strcpy å’Œ strncpy çš„åŒºåˆ«ï¼Ÿ

```c
char dest[10];

strcpy(dest, "Hello World");  // å±é™©ï¼å¯èƒ½æº¢å‡º
strncpy(dest, "Hello World", sizeof(dest) - 1);
dest[sizeof(dest) - 1] = '\0';  // ç¡®ä¿ç»ˆæ­¢
```

### Q13: è¿™æ®µä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ

```c
char *getString(void) {
    char str[] = "Hello";
    return str;  // é”™è¯¯ï¼è¿”å›å±€éƒ¨å˜é‡åœ°å€
}

// æ­£ç¡®åšæ³•
char *getString(void) {
    static char str[] = "Hello";  // é™æ€
    return str;
}
// æˆ–
char *getString(void) {
    char *str = malloc(10);
    strcpy(str, "Hello");
    return str;  // è°ƒç”¨è€…è´Ÿè´£é‡Šæ”¾
}
```

## ç»“æ„ä½“

### Q14: ç»“æ„ä½“å¯¹é½åŸç†ï¼Ÿ

```c
struct S1 {
    char a;    // 1 å­—èŠ‚
    int b;     // 4 å­—èŠ‚
    char c;    // 1 å­—èŠ‚
};
// sizeof(S1) = 12 (ä¸æ˜¯ 6ï¼)
// å¸ƒå±€: a(1) + å¡«å……(3) + b(4) + c(1) + å¡«å……(3)

struct S2 {
    char a;    // 1 å­—èŠ‚
    char c;    // 1 å­—èŠ‚
    int b;     // 4 å­—èŠ‚
};
// sizeof(S2) = 8 (ä¼˜åŒ–å)

// å‡å°‘å¡«å……ï¼šæŒ‰å¤§å°é™åºæ’åˆ—æˆå‘˜
```

### Q15: ç»“æ„ä½“æŒ‡é’ˆå’Œæˆå‘˜è®¿é—®ï¼Ÿ

```c
struct Point { int x, y; };
struct Point p = {10, 20};
struct Point *ptr = &p;

p.x;      // 10
ptr->x;   // 10 (ç­‰ä»·äº (*ptr).x)
```

## ç¼–ç¨‹é¢˜

### Q16: å®ç° strlen

```c
size_t my_strlen(const char *s) {
    const char *p = s;
    while (*p) p++;
    return p - s;
}
```

### Q17: å®ç° strcpy

```c
char *my_strcpy(char *dest, const char *src) {
    char *ret = dest;
    while ((*dest++ = *src++));
    return ret;
}
```

### Q18: åè½¬å­—ç¬¦ä¸²

```c
void reverse(char *s) {
    char *end = s + strlen(s) - 1;
    while (s < end) {
        char temp = *s;
        *s++ = *end;
        *end-- = temp;
    }
}
```

### Q19: åˆ¤æ–­å¤§å°ç«¯

```c
int is_little_endian(void) {
    int x = 1;
    return *(char*)&x == 1;
}
```

### Q20: ä¸ç”¨ä¸´æ—¶å˜é‡äº¤æ¢ä¸¤æ•°

```c
void swap(int *a, int *b) {
    *a ^= *b;
    *b ^= *a;
    *a ^= *b;
}
```

## æ˜“é”™é¢˜

### Q21: å®çš„é™·é˜±

```c
#define SQUARE(x) x * x

SQUARE(3 + 2);  // 3 + 2 * 3 + 2 = 11ï¼Œä¸æ˜¯ 25ï¼

// æ­£ç¡®å†™æ³•
#define SQUARE(x) ((x) * (x))
```

### Q22: é€—å·è¡¨è¾¾å¼

```c
int a = (1, 2, 3);  // a = 3
int b = 1, 2, 3;    // è¯­æ³•é”™è¯¯
```

### Q23: æ•°ç»„å‚æ•°

```c
void func(int arr[100]) {
    sizeof(arr);  // 8ï¼Œä¸æ˜¯ 400ï¼
    // arr æ˜¯æŒ‡é’ˆï¼Œä¸æ˜¯æ•°ç»„
}
```

é¢è¯•åŠ æ²¹ï¼ğŸ’ª

---
id: security-and-access
title: 安全与权限（生产环境必读）
sidebar_label: 安全与权限
sidebar_position: 15
---

# Spring Cloud Alibaba 安全与权限（生产环境必读）

## 1. 总体原则

- **网络分区**：将注册中心、配置中心、事务协调器、消息队列等组件放在内网（或受控 VPC）中，不暴露到公网。
- **最小权限**：账号只授予必需权限，应用按“环境/业务线/团队”拆分账号。
- **配置与密钥分离**：敏感信息尽量使用环境变量/密钥管理服务（KMS/Vault），避免明文写入配置中心。
- **审计与留痕**：开启组件审计日志（配置变更、登录、权限变更），与集中式日志系统对接。

## 2. Nacos 安全

### 2.1 启用登录与权限控制

生产环境不要使用默认账号密码；建议启用 Nacos 的鉴权能力，并为不同环境、不同团队创建独立账号。

- **建议做法**
  - 为 Nacos 控制台启用认证与授权
  - 修改默认账号密码
  - 给应用访问配置/注册所需的最小权限

### 2.2 访问方式与传输安全

- **建议做法**
  - 通过内网域名或内部 LB 访问 Nacos，限制安全组/防火墙入方向端口
  - 如具备条件，启用 HTTPS 或在网关/Ingress 层做 TLS 终止
  - 明确区分“控制台访问入口”和“客户端访问入口”，必要时拆分

### 2.3 配置中心敏感信息治理

- **不要**把数据库密码、AccessKey/SecretKey 等长期凭证以明文保存到 Nacos。
- **建议做法**
  - 使用加密方案（例如应用侧解密）
  - 或使用密钥管理服务，通过环境变量注入密钥引用
  - 配置变更要有审批流（至少要有操作审计与回滚方案）

## 3. Sentinel 安全

### 3.1 Sentinel Dashboard 鉴权

Sentinel Dashboard 默认的登录账号密码存在弱安全风险，生产环境必须调整。

- **建议做法**
  - 修改控制台登录账号密码
  - 限制控制台访问来源（仅内网/堡垒机）
  - 控制台与应用之间的通信端口也应限制访问来源

### 3.2 规则数据源的权限

如果将规则持久化到 Nacos：

- **建议做法**
  - 为 Sentinel 规则使用独立 `Group`（例如 `SENTINEL_GROUP`）
  - 使用独立账号仅允许读写对应的规则 DataId
  - 对规则发布流程进行“灰度/回滚/审计”管理

## 4. RocketMQ 安全

### 4.1 ACL（访问控制）

RocketMQ 支持基于 ACL 的访问控制。

- **建议做法**
  - 对生产环境启用 ACL
  - 为不同业务线、不同应用创建独立的 AccessKey/SecretKey
  - Producer/Consumer 仅授予必需 Topic 的权限

### 4.2 Topic 与消费组隔离

- **建议做法**
  - Topic 命名包含环境与业务域，例如：`prod-order-topic`
  - ConsumerGroup 同样包含环境与业务域，避免跨环境误消费
  - 对关键 Topic 做权限隔离与变更审计

## 5. Seata 安全

### 5.1 注册中心与配置中心访问控制

Seata 常见使用 Nacos 作为注册中心与配置中心。

- **建议做法**
  - 为 Seata 使用独立的 `Group`（例如 `SEATA_GROUP`）
  - 使用独立账号控制访问范围
  - Seata Server 与业务应用的通信端口只允许内网访问

### 5.2 全局事务与数据安全

- **建议做法**
  - 业务侧实现幂等与防重（避免异常重试导致的数据污染）
  - 对关键库表变更进行评审，确保与 Seata 代理模式兼容

## 6. Gateway 安全（与 Spring Cloud Alibaba 组合）

- **建议做法**
  - 在网关层做统一认证鉴权（JWT/OAuth2 等）
  - 配置 CORS 白名单（不要在生产环境长期使用 `allowed-origins: "*"`）
  - 为管理接口（如 Actuator）配置独立端口或独立路由与访问控制

## 7. 落地检查清单

- [ ] 注册中心/配置中心/事务协调器/消息队列不暴露公网
- [ ] 修改默认账号密码，启用权限控制
- [ ] 配置中心不存放明文长期密钥
- [ ] 规则与配置变更可审计、可回滚
- [ ] 生产环境按环境隔离 Topic/Group/Namespace
- [ ] 管理面（Dashboard/Console）仅允许内网访问

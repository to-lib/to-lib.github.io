"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[59108],{38440:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>c,contentTitle:()=>d,default:()=>o,frontMatter:()=>i,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"netty/faq","title":"\u5e38\u89c1\u95ee\u9898\u89e3\u7b54","description":"[!TIP]","source":"@site/docs/netty/faq.md","sourceDirName":"netty","slug":"/netty/faq","permalink":"/docs/netty/faq","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/netty/faq.md","tags":[],"version":"current","sidebarPosition":8.5,"frontMatter":{"sidebar_position":8.5,"title":"\u5e38\u89c1\u95ee\u9898\u89e3\u7b54"},"sidebar":"netty","previous":{"title":"\u5e38\u89c1\u95ee\u9898\u4e0e\u6392\u67e5","permalink":"/docs/netty/troubleshooting"}}');var s=l(22714),t=l(48885);const i={sidebar_position:8.5,title:"\u5e38\u89c1\u95ee\u9898\u89e3\u7b54"},d="Netty \u5e38\u89c1\u95ee\u9898\u89e3\u7b54 (FAQ)",c={},a=[{value:"\u5165\u95e8\u95ee\u9898",id:"\u5165\u95e8\u95ee\u9898",level:2},{value:"Q1: \u5982\u4f55\u9009\u62e9 Netty \u7248\u672c\uff1f",id:"q1-\u5982\u4f55\u9009\u62e9-netty-\u7248\u672c",level:3},{value:"Q2: netty-all vs \u5355\u72ec\u6a21\u5757\uff0c\u9009\u54ea\u4e2a\uff1f",id:"q2-netty-all-vs-\u5355\u72ec\u6a21\u5757\u9009\u54ea\u4e2a",level:3},{value:"Q3: Netty \u652f\u6301\u7684 JDK \u7248\u672c\uff1f",id:"q3-netty-\u652f\u6301\u7684-jdk-\u7248\u672c",level:3},{value:"\u5f00\u53d1\u95ee\u9898",id:"\u5f00\u53d1\u95ee\u9898",level:2},{value:"Q4: Handler \u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u5417\uff1f",id:"q4-handler-\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u5417",level:3},{value:"Q5: \u4e3a\u4ec0\u4e48\u6536\u5230\u7684\u6d88\u606f\u662f\u4e71\u7801\uff1f",id:"q5-\u4e3a\u4ec0\u4e48\u6536\u5230\u7684\u6d88\u606f\u662f\u4e71\u7801",level:3},{value:"Q6: \u4e3a\u4ec0\u4e48 ctx.write() \u6ca1\u6709\u53d1\u9001\u6570\u636e\uff1f",id:"q6-\u4e3a\u4ec0\u4e48-ctxwrite-\u6ca1\u6709\u53d1\u9001\u6570\u636e",level:3},{value:"Q7: \u5982\u4f55\u5728 Handler \u5916\u90e8\u5411 Channel \u53d1\u9001\u6d88\u606f\uff1f",id:"q7-\u5982\u4f55\u5728-handler-\u5916\u90e8\u5411-channel-\u53d1\u9001\u6d88\u606f",level:3},{value:"Q8: SimpleChannelInboundHandler \u548c ChannelInboundHandlerAdapter \u7684\u533a\u522b\uff1f",id:"q8-simplechannelinboundhandler-\u548c-channelinboundhandleradapter-\u7684\u533a\u522b",level:3},{value:"\u914d\u7f6e\u95ee\u9898",id:"\u914d\u7f6e\u95ee\u9898",level:2},{value:"Q9: \u5982\u4f55\u8bbe\u7f6e\u8fde\u63a5\u8d85\u65f6\uff1f",id:"q9-\u5982\u4f55\u8bbe\u7f6e\u8fde\u63a5\u8d85\u65f6",level:3},{value:"Q10: \u5982\u4f55\u914d\u7f6e TCP \u53c2\u6570\uff1f",id:"q10-\u5982\u4f55\u914d\u7f6e-tcp-\u53c2\u6570",level:3},{value:"Q11: EventLoopGroup \u7684\u7ebf\u7a0b\u6570\u5e94\u8be5\u8bbe\u7f6e\u591a\u5c11\uff1f",id:"q11-eventloopgroup-\u7684\u7ebf\u7a0b\u6570\u5e94\u8be5\u8bbe\u7f6e\u591a\u5c11",level:3},{value:"\u6027\u80fd\u95ee\u9898",id:"\u6027\u80fd\u95ee\u9898",level:2},{value:"Q12: \u5982\u4f55\u5f00\u542f\u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b\uff1f",id:"q12-\u5982\u4f55\u5f00\u542f\u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b",level:3},{value:"Q13: \u4e3a\u4ec0\u4e48\u5185\u5b58\u6301\u7eed\u589e\u957f\uff1f",id:"q13-\u4e3a\u4ec0\u4e48\u5185\u5b58\u6301\u7eed\u589e\u957f",level:3},{value:"Q14: \u5982\u4f55\u4f18\u5316\u9ad8\u5e76\u53d1\u6027\u80fd\uff1f",id:"q14-\u5982\u4f55\u4f18\u5316\u9ad8\u5e76\u53d1\u6027\u80fd",level:3},{value:"\u90e8\u7f72\u95ee\u9898",id:"\u90e8\u7f72\u95ee\u9898",level:2},{value:"Q15: \u751f\u4ea7\u73af\u5883\u7684\u63a8\u8350\u914d\u7f6e\uff1f",id:"q15-\u751f\u4ea7\u73af\u5883\u7684\u63a8\u8350\u914d\u7f6e",level:3},{value:"Q16: \u5982\u4f55\u5b9e\u73b0\u4f18\u96c5\u5173\u95ed\uff1f",id:"q16-\u5982\u4f55\u5b9e\u73b0\u4f18\u96c5\u5173\u95ed",level:3},{value:"\u76f8\u5173\u8d44\u6e90",id:"\u76f8\u5173\u8d44\u6e90",level:2}];function h(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"netty-\u5e38\u89c1\u95ee\u9898\u89e3\u7b54-faq",children:"Netty \u5e38\u89c1\u95ee\u9898\u89e3\u7b54 (FAQ)"})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:["[!TIP]\n\u672c\u6587\u6863\u6536\u96c6\u4e86 Netty \u5f00\u53d1\u4e2d\u7684\u5e38\u89c1\u95ee\u9898\u53ca\u89e3\u7b54\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u5feb\u901f\u89e3\u51b3\u95ee\u9898\u3002\u5982\u9700\u66f4\u6df1\u5165\u7684\u6392\u67e5\u6307\u5357\uff0c\u8bf7\u53c2\u8003 ",(0,s.jsx)(e.a,{href:"/docs/netty/troubleshooting",children:"\u6545\u969c\u6392\u9664"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u5165\u95e8\u95ee\u9898",children:"\u5165\u95e8\u95ee\u9898"}),"\n",(0,s.jsx)(e.h3,{id:"q1-\u5982\u4f55\u9009\u62e9-netty-\u7248\u672c",children:"Q1: \u5982\u4f55\u9009\u62e9 Netty \u7248\u672c\uff1f"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u63a8\u8350\u7248\u672c\uff1a"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u751f\u4ea7\u73af\u5883\uff1a"})," \u4f7f\u7528 4.1.x \u6700\u65b0\u7a33\u5b9a\u7248\uff08\u5982 4.1.100.Final\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u65b0\u9879\u76ee\uff1a"})," \u5efa\u8bae\u4f7f\u7528 4.1.x\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528 5.x\uff08\u5f00\u53d1\u4e2d\uff0c\u4e0d\u7a33\u5b9a\uff09"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Maven \u4f9d\u8d56\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-xml",children:"<dependency>\n    <groupId>io.netty</groupId>\n    <artifactId>netty-all</artifactId>\n    <version>4.1.100.Final</version>\n</dependency>\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"q2-netty-all-vs-\u5355\u72ec\u6a21\u5757\u9009\u54ea\u4e2a",children:"Q2: netty-all vs \u5355\u72ec\u6a21\u5757\uff0c\u9009\u54ea\u4e2a\uff1f"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"netty-all\uff1a"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5305\u542b\u6240\u6709\u6a21\u5757\uff0c\u65b9\u4fbf\u5f00\u53d1"}),"\n",(0,s.jsx)(e.li,{children:"\u4f53\u79ef\u8f83\u5927\uff08\u7ea6 4MB\uff09"}),"\n",(0,s.jsx)(e.li,{children:"\u9002\u5408\u5f00\u53d1\u548c\u5c0f\u578b\u9879\u76ee"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u5355\u72ec\u6a21\u5757\uff1a"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u6309\u9700\u5f15\u5165\uff0c\u4f53\u79ef\u66f4\u5c0f"}),"\n",(0,s.jsx)(e.li,{children:"\u9002\u5408\u751f\u4ea7\u73af\u5883\u7cbe\u7ec6\u63a7\u5236"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-xml",children:"\x3c!-- \u6309\u9700\u5f15\u5165 --\x3e\n<dependency>\n    <groupId>io.netty</groupId>\n    <artifactId>netty-transport</artifactId>\n    <version>4.1.100.Final</version>\n</dependency>\n<dependency>\n    <groupId>io.netty</groupId>\n    <artifactId>netty-handler</artifactId>\n    <version>4.1.100.Final</version>\n</dependency>\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"q3-netty-\u652f\u6301\u7684-jdk-\u7248\u672c",children:"Q3: Netty \u652f\u6301\u7684 JDK \u7248\u672c\uff1f"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"Netty \u7248\u672c"}),(0,s.jsx)(e.th,{children:"\u6700\u4f4e JDK \u7248\u672c"}),(0,s.jsx)(e.th,{children:"\u63a8\u8350 JDK \u7248\u672c"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"4.1.x"}),(0,s.jsx)(e.td,{children:"JDK 6+"}),(0,s.jsx)(e.td,{children:"JDK 8/11/17"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"4.0.x"}),(0,s.jsx)(e.td,{children:"JDK 6+"}),(0,s.jsx)(e.td,{children:"JDK 8"})]})]})]}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"[!NOTE]\n\u63a8\u8350\u4f7f\u7528 JDK 8 \u6216\u66f4\u9ad8\u7248\u672c\uff0c\u4ee5\u83b7\u5f97\u66f4\u597d\u7684\u6027\u80fd\u548c\u5b89\u5168\u6027\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u5f00\u53d1\u95ee\u9898",children:"\u5f00\u53d1\u95ee\u9898"}),"\n",(0,s.jsx)(e.h3,{id:"q4-handler-\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u5417",children:"Q4: Handler \u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u5417\uff1f"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u9ed8\u8ba4\u60c5\u51b5\uff1a"})," \u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u89e3\u91ca\uff1a"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4e00\u4e2a Channel \u53ea\u4f1a\u7ed1\u5b9a\u5230\u4e00\u4e2a EventLoop"}),"\n",(0,s.jsx)(e.li,{children:"\u540c\u4e00\u4e2a Channel \u7684\u4e8b\u4ef6\u7531\u540c\u4e00\u4e2a\u7ebf\u7a0b\u5904\u7406"}),"\n",(0,s.jsx)(e.li,{children:"\u56e0\u6b64\u5355\u4e2a Channel \u7684 Handler \u4e0d\u5b58\u5728\u5e76\u53d1\u95ee\u9898"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u4f46\u9700\u8981\u6ce8\u610f\uff1a"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u5982\u679c Handler \u88ab\u591a\u4e2a Channel \u5171\u4eab\uff08\u5982 ",(0,s.jsx)(e.code,{children:"@ChannelHandler.Sharable"}),"\uff09\uff0c\u5219\u9700\u8981\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"// \u53ef\u5171\u4eab\u7684 Handler - \u9700\u8981\u65e0\u72b6\u6001\u6216\u7ebf\u7a0b\u5b89\u5168\n@ChannelHandler.Sharable\npublic class SharedHandler extends ChannelInboundHandlerAdapter {\n    @Override\n    public void channelRead(ChannelHandlerContext ctx, Object msg) {\n        // \u4e0d\u8981\u4f7f\u7528\u5b9e\u4f8b\u53d8\u91cf\u5b58\u50a8\u72b6\u6001\n        ctx.fireChannelRead(msg);\n    }\n}\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"q5-\u4e3a\u4ec0\u4e48\u6536\u5230\u7684\u6d88\u606f\u662f\u4e71\u7801",children:"Q5: \u4e3a\u4ec0\u4e48\u6536\u5230\u7684\u6d88\u606f\u662f\u4e71\u7801\uff1f"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u5e38\u89c1\u539f\u56e0\uff1a"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u7f16\u7801\u4e0d\u4e00\u81f4\uff1a"})," \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4f7f\u7528\u4e0d\u540c\u7684\u5b57\u7b26\u7f16\u7801"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u7f3a\u5c11\u89e3\u7801\u5668\uff1a"})," Pipeline \u4e2d\u6ca1\u6709\u6dfb\u52a0\u5b57\u7b26\u4e32\u89e3\u7801\u5668"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"// \u786e\u4fdd\u6dfb\u52a0\u6b63\u786e\u7684\u7f16\u89e3\u7801\u5668\npipeline.addLast(new StringDecoder(CharsetUtil.UTF_8));\npipeline.addLast(new StringEncoder(CharsetUtil.UTF_8));\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"q6-\u4e3a\u4ec0\u4e48-ctxwrite-\u6ca1\u6709\u53d1\u9001\u6570\u636e",children:"Q6: \u4e3a\u4ec0\u4e48 ctx.write() \u6ca1\u6709\u53d1\u9001\u6570\u636e\uff1f"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u539f\u56e0\uff1a"})," ",(0,s.jsx)(e.code,{children:"write()"})," \u53ea\u662f\u5c06\u6570\u636e\u5199\u5165\u7f13\u51b2\u533a\uff0c\u9700\u8981 ",(0,s.jsx)(e.code,{children:"flush()"})," \u624d\u4f1a\u771f\u6b63\u53d1\u9001\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"// \u65b9\u5f0f 1\uff1a\u4f7f\u7528 writeAndFlush\nctx.writeAndFlush(msg);\n\n// \u65b9\u5f0f 2\uff1a\u5206\u5f00\u8c03\u7528\nctx.write(msg);\nctx.flush();\n\n// \u65b9\u5f0f 3\uff1a\u5728 channelReadComplete \u4e2d\u7edf\u4e00 flush\n@Override\npublic void channelReadComplete(ChannelHandlerContext ctx) {\n    ctx.flush();\n}\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"q7-\u5982\u4f55\u5728-handler-\u5916\u90e8\u5411-channel-\u53d1\u9001\u6d88\u606f",children:"Q7: \u5982\u4f55\u5728 Handler \u5916\u90e8\u5411 Channel \u53d1\u9001\u6d88\u606f\uff1f"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u4fdd\u5b58 Channel \u5f15\u7528\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// \u5728\u8fde\u63a5\u5efa\u7acb\u65f6\u4fdd\u5b58 Channel\npublic class MyHandler extends ChannelInboundHandlerAdapter {\n    private static Map<String, Channel> channels = new ConcurrentHashMap<>();\n\n    @Override\n    public void channelActive(ChannelHandlerContext ctx) {\n        String clientId = "client-" + ctx.channel().id();\n        channels.put(clientId, ctx.channel());\n    }\n\n    // \u5916\u90e8\u8c03\u7528\u53d1\u9001\u6d88\u606f\n    public static void sendToClient(String clientId, String message) {\n        Channel channel = channels.get(clientId);\n        if (channel != null && channel.isActive()) {\n            channel.writeAndFlush(message);\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"q8-simplechannelinboundhandler-\u548c-channelinboundhandleradapter-\u7684\u533a\u522b",children:"Q8: SimpleChannelInboundHandler \u548c ChannelInboundHandlerAdapter \u7684\u533a\u522b\uff1f"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u7279\u6027"}),(0,s.jsx)(e.th,{children:"SimpleChannelInboundHandler"}),(0,s.jsx)(e.th,{children:"ChannelInboundHandlerAdapter"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u81ea\u52a8\u91ca\u653e ByteBuf"}),(0,s.jsx)(e.td,{children:"\u2705 \u662f"}),(0,s.jsx)(e.td,{children:"\u274c \u5426\uff0c\u9700\u624b\u52a8\u91ca\u653e"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u6cdb\u578b\u652f\u6301"}),(0,s.jsx)(e.td,{children:"\u2705 \u652f\u6301\u6307\u5b9a\u6d88\u606f\u7c7b\u578b"}),(0,s.jsx)(e.td,{children:"\u274c \u63a5\u6536 Object \u7c7b\u578b"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u6d88\u606f\u4f20\u64ad"}),(0,s.jsxs)(e.td,{children:["\u9700\u8981\u663e\u5f0f\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"ctx.fireChannelRead()"})]}),(0,s.jsx)(e.td,{children:"\u9700\u8981\u663e\u5f0f\u8c03\u7528"})]})]})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"// SimpleChannelInboundHandler - \u81ea\u52a8\u91ca\u653e\npublic class MyHandler extends SimpleChannelInboundHandler<String> {\n    @Override\n    protected void channelRead0(ChannelHandlerContext ctx, String msg) {\n        // msg \u4f7f\u7528\u5b8c\u540e\u81ea\u52a8\u91ca\u653e\n    }\n}\n\n// ChannelInboundHandlerAdapter - \u9700\u624b\u52a8\u91ca\u653e\npublic class MyHandler extends ChannelInboundHandlerAdapter {\n    @Override\n    public void channelRead(ChannelHandlerContext ctx, Object msg) {\n        try {\n            // \u5904\u7406 msg\n        } finally {\n            ReferenceCountUtil.release(msg);\n        }\n    }\n}\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u914d\u7f6e\u95ee\u9898",children:"\u914d\u7f6e\u95ee\u9898"}),"\n",(0,s.jsx)(e.h3,{id:"q9-\u5982\u4f55\u8bbe\u7f6e\u8fde\u63a5\u8d85\u65f6",children:"Q9: \u5982\u4f55\u8bbe\u7f6e\u8fde\u63a5\u8d85\u65f6\uff1f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"// \u5ba2\u6237\u7aef\u8fde\u63a5\u8d85\u65f6\nBootstrap bootstrap = new Bootstrap();\nbootstrap.option(ChannelOption.CONNECT_TIMEOUT_MILLIS, 5000); // 5\u79d2\n\n// \u670d\u52a1\u7aef SO_TIMEOUT\uff08\u4e0d\u5e38\u7528\uff09\nServerBootstrap serverBootstrap = new ServerBootstrap();\nserverBootstrap.childOption(ChannelOption.SO_TIMEOUT, 5000);\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"q10-\u5982\u4f55\u914d\u7f6e-tcp-\u53c2\u6570",children:"Q10: \u5982\u4f55\u914d\u7f6e TCP \u53c2\u6570\uff1f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"ServerBootstrap bootstrap = new ServerBootstrap();\n\n// \u670d\u52a1\u5668 Socket \u9009\u9879\nbootstrap.option(ChannelOption.SO_BACKLOG, 1024);      // \u8fde\u63a5\u961f\u5217\u5927\u5c0f\nbootstrap.option(ChannelOption.SO_REUSEADDR, true);    // \u7aef\u53e3\u590d\u7528\n\n// \u5b50 Channel \u9009\u9879\nbootstrap.childOption(ChannelOption.SO_KEEPALIVE, true);   // TCP \u4fdd\u6d3b\nbootstrap.childOption(ChannelOption.TCP_NODELAY, true);    // \u7981\u7528 Nagle\nbootstrap.childOption(ChannelOption.SO_SNDBUF, 256 * 1024);  // \u53d1\u9001\u7f13\u51b2\nbootstrap.childOption(ChannelOption.SO_RCVBUF, 256 * 1024);  // \u63a5\u6536\u7f13\u51b2\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"q11-eventloopgroup-\u7684\u7ebf\u7a0b\u6570\u5e94\u8be5\u8bbe\u7f6e\u591a\u5c11",children:"Q11: EventLoopGroup \u7684\u7ebf\u7a0b\u6570\u5e94\u8be5\u8bbe\u7f6e\u591a\u5c11\uff1f"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u63a8\u8350\u914d\u7f6e\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"int cpuCores = Runtime.getRuntime().availableProcessors();\n\n// Boss Group - \u901a\u5e38 1 \u4e2a\u5c31\u591f\nEventLoopGroup bossGroup = new NioEventLoopGroup(1);\n\n// Worker Group - CPU \u6838\u5fc3\u6570 * 2\nEventLoopGroup workerGroup = new NioEventLoopGroup(cpuCores * 2);\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u7279\u6b8a\u573a\u666f\uff1a"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"IO \u5bc6\u96c6\u578b\uff1a\u53ef\u4ee5\u589e\u52a0\u5230 CPU \u6838\u5fc3\u6570 * 4"}),"\n",(0,s.jsx)(e.li,{children:"\u8ba1\u7b97\u5bc6\u96c6\u578b\uff1a\u4f7f\u7528\u72ec\u7acb\u7ebf\u7a0b\u6c60\u5904\u7406\u4e1a\u52a1\u903b\u8f91"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u6027\u80fd\u95ee\u9898",children:"\u6027\u80fd\u95ee\u9898"}),"\n",(0,s.jsx)(e.h3,{id:"q12-\u5982\u4f55\u5f00\u542f\u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b",children:"Q12: \u5982\u4f55\u5f00\u542f\u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b\uff1f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"// \u65b9\u5f0f 1\uff1aJVM \u53c2\u6570\n// -Dio.netty.leakDetection.level=PARANOID\n\n// \u65b9\u5f0f 2\uff1a\u4ee3\u7801\u8bbe\u7f6e\nResourceLeakDetector.setLevel(ResourceLeakDetector.Level.PARANOID);\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u68c0\u6d4b\u7ea7\u522b\uff1a"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"DISABLED"}),"\uff1a\u7981\u7528"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"SIMPLE"}),"\uff1a\u7b80\u5355\u68c0\u6d4b\uff08\u9ed8\u8ba4\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ADVANCED"}),"\uff1a\u9ad8\u7ea7\u68c0\u6d4b"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"PARANOID"}),"\uff1a\u6700\u4e25\u683c\u68c0\u6d4b\uff08\u6027\u80fd\u5f71\u54cd\u5927\uff0c\u4ec5\u7528\u4e8e\u8c03\u8bd5\uff09"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"q13-\u4e3a\u4ec0\u4e48\u5185\u5b58\u6301\u7eed\u589e\u957f",children:"Q13: \u4e3a\u4ec0\u4e48\u5185\u5b58\u6301\u7eed\u589e\u957f\uff1f"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u53ef\u80fd\u539f\u56e0\uff1a"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"ByteBuf \u672a\u91ca\u653e"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"Channel \u672a\u5173\u95ed"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.strong,{children:"\u5b9a\u65f6\u4efb\u52a1\u672a\u53d6\u6d88"})}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u68c0\u67e5\u65b9\u6cd5\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// \u5f00\u542f\u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b\nResourceLeakDetector.setLevel(ResourceLeakDetector.Level.PARANOID);\n\n// \u68c0\u67e5 ByteBuf \u5f15\u7528\u8ba1\u6570\nByteBuf buf = ...;\nSystem.out.println("\u5f15\u7528\u8ba1\u6570: " + buf.refCnt());\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"q14-\u5982\u4f55\u4f18\u5316\u9ad8\u5e76\u53d1\u6027\u80fd",children:"Q14: \u5982\u4f55\u4f18\u5316\u9ad8\u5e76\u53d1\u6027\u80fd\uff1f"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u5173\u952e\u914d\u7f6e\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"// 1. \u4f7f\u7528\u6c60\u5316\u5206\u914d\u5668\nbootstrap.childOption(ChannelOption.ALLOCATOR, PooledByteBufAllocator.DEFAULT);\n\n// 2. \u5173\u95ed Nagle \u7b97\u6cd5\u51cf\u5c11\u5ef6\u8fdf\nbootstrap.childOption(ChannelOption.TCP_NODELAY, true);\n\n// 3. \u914d\u7f6e\u5408\u7406\u7684\u7f13\u51b2\u533a\nbootstrap.childOption(ChannelOption.WRITE_BUFFER_WATER_MARK,\n    new WriteBufferWaterMark(32 * 1024, 1024 * 1024));\n\n// 4. \u4f7f\u7528 Epoll\uff08Linux\uff09\nEventLoopGroup workerGroup = new EpollEventLoopGroup();\nbootstrap.channel(EpollServerSocketChannel.class);\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u90e8\u7f72\u95ee\u9898",children:"\u90e8\u7f72\u95ee\u9898"}),"\n",(0,s.jsx)(e.h3,{id:"q15-\u751f\u4ea7\u73af\u5883\u7684\u63a8\u8350\u914d\u7f6e",children:"Q15: \u751f\u4ea7\u73af\u5883\u7684\u63a8\u8350\u914d\u7f6e\uff1f"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"JVM \u53c2\u6570\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"java -server \\\n     -Xms4g -Xmx4g \\\n     -XX:+UseG1GC \\\n     -XX:MaxDirectMemorySize=2g \\\n     -Dio.netty.leakDetection.level=SIMPLE \\\n     -jar your-app.jar\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u7cfb\u7edf\u53c2\u6570\uff08Linux\uff09\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# \u589e\u52a0\u6587\u4ef6\u63cf\u8ff0\u7b26\u9650\u5236\nulimit -n 100000\n\n# \u4f18\u5316 TCP \u53c2\u6570\nsysctl -w net.core.somaxconn=65535\nsysctl -w net.ipv4.tcp_max_syn_backlog=65535\nsysctl -w net.ipv4.tcp_tw_reuse=1\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h3,{id:"q16-\u5982\u4f55\u5b9e\u73b0\u4f18\u96c5\u5173\u95ed",children:"Q16: \u5982\u4f55\u5b9e\u73b0\u4f18\u96c5\u5173\u95ed\uff1f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// \u6ce8\u518c JVM \u5173\u95ed\u94a9\u5b50\nRuntime.getRuntime().addShutdownHook(new Thread(() -> {\n    System.out.println("\u6b63\u5728\u5173\u95ed\u670d\u52a1...");\n\n    // 1. \u505c\u6b62\u63a5\u6536\u65b0\u8fde\u63a5\n    if (serverChannel != null) {\n        serverChannel.close().syncUninterruptibly();\n    }\n\n    // 2. \u4f18\u96c5\u5173\u95ed EventLoopGroup\n    if (bossGroup != null) {\n        bossGroup.shutdownGracefully(0, 30, TimeUnit.SECONDS);\n    }\n    if (workerGroup != null) {\n        workerGroup.shutdownGracefully(0, 30, TimeUnit.SECONDS);\n    }\n\n    System.out.println("\u670d\u52a1\u5df2\u5173\u95ed");\n}));\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u76f8\u5173\u8d44\u6e90",children:"\u76f8\u5173\u8d44\u6e90"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"/docs/netty/troubleshooting",children:"\u6545\u969c\u6392\u9664\u6307\u5357"})," - \u66f4\u8be6\u7ec6\u7684\u95ee\u9898\u6392\u67e5"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"/docs/interview/netty-interview-questions",children:"\u9762\u8bd5\u9898\u7cbe\u9009"})," - \u5e38\u89c1\u9762\u8bd5\u95ee\u9898"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"/docs/netty/quick-reference",children:"\u5feb\u901f\u53c2\u8003"})," - API \u901f\u67e5\u8868"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"/docs/netty/advanced",children:"\u9ad8\u7ea7\u7279\u6027"})," - \u6027\u80fd\u4f18\u5316\u6307\u5357"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6709\u95ee\u9898\u6ca1\u627e\u5230\u7b54\u6848\uff1f"})," \u6b22\u8fce\u67e5\u9605 ",(0,s.jsx)(e.a,{href:"https://netty.io/wiki/",children:"Netty \u5b98\u65b9\u6587\u6863"})," \u6216 ",(0,s.jsx)(e.a,{href:"https://github.com/netty/netty/issues",children:"GitHub Issues"}),"\u3002"]})]})}function o(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(h,{...n})}):h(n)}},48885:(n,e,l)=>{l.d(e,{R:()=>i,x:()=>d});var r=l(99378);const s={},t=r.createContext(s);function i(n){const e=r.useContext(t);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:i(n.components),r.createElement(t.Provider,{value:e},n.children)}}}]);
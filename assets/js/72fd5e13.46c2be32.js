"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[85604],{48885:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var r=s(99378);const t={},o=r.createContext(t);function l(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(o.Provider,{value:n},e.children)}},97670:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"frontend/browser/storage","title":"\u6d4f\u89c8\u5668\u5b58\u50a8","description":"[!TIP]","source":"@site/docs/frontend/browser/storage.md","sourceDirName":"frontend/browser","slug":"/frontend/browser/storage","permalink":"/docs/frontend/browser/storage","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/frontend/browser/storage.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"\u6d4f\u89c8\u5668\u5b58\u50a8"}}');var t=s(22714),o=s(48885);const l={sidebar_position:2,title:"\u6d4f\u89c8\u5668\u5b58\u50a8"},d="\u6d4f\u89c8\u5668\u5b58\u50a8",i={},c=[{value:"\ud83c\udf6a Cookie",id:"-cookie",level:2},{value:"\u57fa\u672c\u64cd\u4f5c",id:"\u57fa\u672c\u64cd\u4f5c",level:3},{value:"Cookie \u5c5e\u6027",id:"cookie-\u5c5e\u6027",level:3},{value:"\ud83d\udce6 LocalStorage",id:"-localstorage",level:2},{value:"\u57fa\u672c\u64cd\u4f5c",id:"\u57fa\u672c\u64cd\u4f5c-1",level:3},{value:"\u5b58\u50a8\u5bf9\u8c61",id:"\u5b58\u50a8\u5bf9\u8c61",level:3},{value:"\ud83d\udccb SessionStorage",id:"-sessionstorage",level:2},{value:"\u4f7f\u7528\u573a\u666f",id:"\u4f7f\u7528\u573a\u666f",level:3},{value:"\ud83d\udcca \u5bf9\u6bd4",id:"-\u5bf9\u6bd4",level:2},{value:"\ud83d\udcbe IndexedDB",id:"-indexeddb",level:2},{value:"\u57fa\u672c\u4f7f\u7528",id:"\u57fa\u672c\u4f7f\u7528",level:3},{value:"\u5c01\u88c5 Promise",id:"\u5c01\u88c5-promise",level:3},{value:"\ud83d\udd10 \u5b58\u50a8\u5b89\u5168",id:"-\u5b58\u50a8\u5b89\u5168",level:2},{value:"\u654f\u611f\u6570\u636e\u5904\u7406",id:"\u654f\u611f\u6570\u636e\u5904\u7406",level:3},{value:"\u5b58\u50a8\u76d1\u542c",id:"\u5b58\u50a8\u76d1\u542c",level:3},{value:"\ud83d\udca1 \u6700\u4f73\u5b9e\u8df5",id:"-\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u5f0f",id:"1-\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u5f0f",level:3},{value:"2. \u5904\u7406\u5b58\u50a8\u5f02\u5e38",id:"2-\u5904\u7406\u5b58\u50a8\u5f02\u5e38",level:3},{value:"3. \u6570\u636e\u7248\u672c\u7ba1\u7406",id:"3-\u6570\u636e\u7248\u672c\u7ba1\u7406",level:3},{value:"\ud83d\udd17 \u76f8\u5173\u8d44\u6e90",id:"-\u76f8\u5173\u8d44\u6e90",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\u6d4f\u89c8\u5668\u5b58\u50a8",children:"\u6d4f\u89c8\u5668\u5b58\u50a8"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"[!TIP]\n\u6d4f\u89c8\u5668\u63d0\u4f9b\u591a\u79cd\u5b58\u50a8\u65b9\u5f0f\uff0c\u7528\u4e8e\u5728\u5ba2\u6237\u7aef\u4fdd\u5b58\u6570\u636e\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"-cookie",children:"\ud83c\udf6a Cookie"}),"\n",(0,t.jsx)(n.p,{children:"Cookie \u4e3b\u8981\u7528\u4e8e\u8eab\u4efd\u9a8c\u8bc1\u548c\u670d\u52a1\u7aef\u4f1a\u8bdd\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"\u57fa\u672c\u64cd\u4f5c",children:"\u57fa\u672c\u64cd\u4f5c"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// \u8bbe\u7f6e Cookie\ndocument.cookie = "username=Alice";\ndocument.cookie = "theme=dark; max-age=86400"; // 1\u5929\n\n// \u8bfb\u53d6 Cookie\nconsole.log(document.cookie); // \'username=Alice; theme=dark\'\n\n// \u89e3\u6790 Cookie\nfunction getCookie(name) {\n  const cookies = document.cookie.split("; ");\n  for (const cookie of cookies) {\n    const [key, value] = cookie.split("=");\n    if (key === name) return decodeURIComponent(value);\n  }\n  return null;\n}\n\n// \u5220\u9664 Cookie\uff08\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u4e3a\u8fc7\u53bb\uff09\ndocument.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 GMT";\n'})}),"\n",(0,t.jsx)(n.h3,{id:"cookie-\u5c5e\u6027",children:"Cookie \u5c5e\u6027"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"document.cookie = `\n  token=abc123;\n  path=/;\n  domain=.example.com;\n  max-age=604800;\n  secure;\n  samesite=strict\n`;\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u5c5e\u6027"}),(0,t.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"path"})}),(0,t.jsx)(n.td,{children:"Cookie \u53ef\u7528\u8def\u5f84"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"domain"})}),(0,t.jsx)(n.td,{children:"Cookie \u53ef\u7528\u57df\u540d"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"max-age"})}),(0,t.jsx)(n.td,{children:"\u6709\u6548\u671f\uff08\u79d2\uff09"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"expires"})}),(0,t.jsx)(n.td,{children:"\u8fc7\u671f\u65e5\u671f"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"secure"})}),(0,t.jsx)(n.td,{children:"\u4ec5 HTTPS \u4f20\u8f93"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"httpOnly"})}),(0,t.jsx)(n.td,{children:"\u7981\u6b62 JS \u8bbf\u95ee\uff08\u670d\u52a1\u7aef\u8bbe\u7f6e\uff09"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"samesite"})}),(0,t.jsx)(n.td,{children:"\u8de8\u7ad9\u9650\u5236 (strict/lax/none)"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"-localstorage",children:"\ud83d\udce6 LocalStorage"}),"\n",(0,t.jsx)(n.p,{children:"\u6301\u4e45\u5316\u5b58\u50a8\uff0c\u9664\u975e\u4e3b\u52a8\u5220\u9664\uff0c\u6570\u636e\u6c38\u4e45\u4fdd\u5b58\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"\u57fa\u672c\u64cd\u4f5c-1",children:"\u57fa\u672c\u64cd\u4f5c"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// \u5b58\u50a8\nlocalStorage.setItem("user", JSON.stringify({ name: "Alice" }));\nlocalStorage.theme = "dark"; // \u7b80\u5199\n\n// \u8bfb\u53d6\nconst user = JSON.parse(localStorage.getItem("user"));\nconst theme = localStorage.theme;\n\n// \u5220\u9664\nlocalStorage.removeItem("user");\n\n// \u6e05\u7a7a\nlocalStorage.clear();\n\n// \u904d\u5386\nfor (let i = 0; i < localStorage.length; i++) {\n  const key = localStorage.key(i);\n  console.log(key, localStorage.getItem(key));\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u5b58\u50a8\u5bf9\u8c61",children:"\u5b58\u50a8\u5bf9\u8c61"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// \u5c01\u88c5\u5de5\u5177\u51fd\u6570\nconst storage = {\n  get(key, defaultValue = null) {\n    try {\n      const value = localStorage.getItem(key);\n      return value ? JSON.parse(value) : defaultValue;\n    } catch {\n      return defaultValue;\n    }\n  },\n\n  set(key, value) {\n    localStorage.setItem(key, JSON.stringify(value));\n  },\n\n  remove(key) {\n    localStorage.removeItem(key);\n  },\n};\n\n// \u4f7f\u7528\nstorage.set("settings", { theme: "dark", lang: "zh" });\nconst settings = storage.get("settings", {});\n'})}),"\n",(0,t.jsx)(n.h2,{id:"-sessionstorage",children:"\ud83d\udccb SessionStorage"}),"\n",(0,t.jsx)(n.p,{children:"\u4f1a\u8bdd\u5b58\u50a8\uff0c\u9875\u9762\u5173\u95ed\u540e\u6570\u636e\u6e05\u9664\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// API \u4e0e LocalStorage \u5b8c\u5168\u76f8\u540c\nsessionStorage.setItem("tempData", "value");\nconst data = sessionStorage.getItem("tempData");\nsessionStorage.removeItem("tempData");\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u4f7f\u7528\u573a\u666f",children:"\u4f7f\u7528\u573a\u666f"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u8868\u5355\u4e34\u65f6\u6570\u636e"}),"\n",(0,t.jsx)(n.li,{children:"\u9875\u9762\u95f4\u4f20\u9012\u6570\u636e"}),"\n",(0,t.jsx)(n.li,{children:"\u4e00\u6b21\u6027\u64cd\u4f5c\u72b6\u6001"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"-\u5bf9\u6bd4",children:"\ud83d\udcca \u5bf9\u6bd4"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u7279\u6027"}),(0,t.jsx)(n.th,{children:"Cookie"}),(0,t.jsx)(n.th,{children:"LocalStorage"}),(0,t.jsx)(n.th,{children:"SessionStorage"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u5b58\u50a8\u5927\u5c0f"}),(0,t.jsx)(n.td,{children:"~4KB"}),(0,t.jsx)(n.td,{children:"~5MB"}),(0,t.jsx)(n.td,{children:"~5MB"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u8fc7\u671f\u65f6\u95f4"}),(0,t.jsx)(n.td,{children:"\u53ef\u8bbe\u7f6e"}),(0,t.jsx)(n.td,{children:"\u6c38\u4e45"}),(0,t.jsx)(n.td,{children:"\u9875\u9762\u5173\u95ed"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u81ea\u52a8\u53d1\u9001"}),(0,t.jsx)(n.td,{children:"\u6bcf\u6b21\u8bf7\u6c42"}),(0,t.jsx)(n.td,{children:"\u5426"}),(0,t.jsx)(n.td,{children:"\u5426"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u4f5c\u7528\u57df"}),(0,t.jsx)(n.td,{children:"\u8def\u5f84+\u57df\u540d"}),(0,t.jsx)(n.td,{children:"\u540c\u6e90"}),(0,t.jsx)(n.td,{children:"\u540c\u6e90+\u540c\u6807\u7b7e"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"API"}),(0,t.jsx)(n.td,{children:"\u5b57\u7b26\u4e32\u64cd\u4f5c"}),(0,t.jsx)(n.td,{children:"\u7b80\u6d01 API"}),(0,t.jsx)(n.td,{children:"\u7b80\u6d01 API"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"-indexeddb",children:"\ud83d\udcbe IndexedDB"}),"\n",(0,t.jsx)(n.p,{children:"\u6d4f\u89c8\u5668\u5185\u7f6e\u7684 NoSQL \u6570\u636e\u5e93\uff0c\u9002\u5408\u5b58\u50a8\u5927\u91cf\u7ed3\u6784\u5316\u6570\u636e\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"\u57fa\u672c\u4f7f\u7528",children:"\u57fa\u672c\u4f7f\u7528"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// \u6253\u5f00\u6570\u636e\u5e93\nconst request = indexedDB.open("MyDB", 1);\n\nrequest.onerror = () => console.error("\u6253\u5f00\u5931\u8d25");\n\nrequest.onupgradeneeded = (event) => {\n  const db = event.target.result;\n\n  // \u521b\u5efa\u5bf9\u8c61\u4ed3\u5e93\uff08\u7c7b\u4f3c\u8868\uff09\n  if (!db.objectStoreNames.contains("users")) {\n    const store = db.createObjectStore("users", { keyPath: "id" });\n    store.createIndex("name", "name", { unique: false });\n  }\n};\n\nrequest.onsuccess = (event) => {\n  const db = event.target.result;\n\n  // \u6dfb\u52a0\u6570\u636e\n  const tx = db.transaction("users", "readwrite");\n  const store = tx.objectStore("users");\n  store.add({ id: 1, name: "Alice", age: 25 });\n\n  // \u8bfb\u53d6\u6570\u636e\n  const getRequest = store.get(1);\n  getRequest.onsuccess = () => {\n    console.log(getRequest.result);\n  };\n};\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u5c01\u88c5-promise",children:"\u5c01\u88c5 Promise"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'function openDB(name, version, upgradeCallback) {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open(name, version);\n    request.onerror = () => reject(request.error);\n    request.onsuccess = () => resolve(request.result);\n    request.onupgradeneeded = (e) => upgradeCallback(e.target.result);\n  });\n}\n\n// \u4f7f\u7528\nconst db = await openDB("MyDB", 1, (db) => {\n  db.createObjectStore("users", { keyPath: "id" });\n});\n'})}),"\n",(0,t.jsx)(n.h2,{id:"-\u5b58\u50a8\u5b89\u5168",children:"\ud83d\udd10 \u5b58\u50a8\u5b89\u5168"}),"\n",(0,t.jsx)(n.h3,{id:"\u654f\u611f\u6570\u636e\u5904\u7406",children:"\u654f\u611f\u6570\u636e\u5904\u7406"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// \u274c \u4e0d\u8981\u5b58\u50a8\u654f\u611f\u4fe1\u606f\nlocalStorage.setItem("password", "123456");\n\n// \u2705 \u654f\u611f\u6570\u636e\u5e94\u8be5\n// 1. \u4f7f\u7528 httpOnly Cookie\uff08\u670d\u52a1\u7aef\u8bbe\u7f6e\uff09\n// 2. \u4f7f\u7528 sessionStorage \u5b58\u4e34\u65f6 token\n// 3. \u5fc5\u8981\u65f6\u52a0\u5bc6\u5b58\u50a8\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u5b58\u50a8\u76d1\u542c",children:"\u5b58\u50a8\u76d1\u542c"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// \u76d1\u542c\u5176\u4ed6\u6807\u7b7e\u9875\u7684\u5b58\u50a8\u53d8\u5316\nwindow.addEventListener("storage", (event) => {\n  console.log("Key:", event.key);\n  console.log("Old:", event.oldValue);\n  console.log("New:", event.newValue);\n  console.log("URL:", event.url);\n});\n'})}),"\n",(0,t.jsx)(n.h2,{id:"-\u6700\u4f73\u5b9e\u8df5",children:"\ud83d\udca1 \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,t.jsx)(n.h3,{id:"1-\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u5f0f",children:"1. \u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u5f0f"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u8eab\u4efd\u9a8c\u8bc1 \u2192 Cookie (httpOnly)\n// \u7528\u6237\u504f\u597d \u2192 LocalStorage\n// \u4e34\u65f6\u8868\u5355 \u2192 SessionStorage\n// \u5927\u91cf\u6570\u636e \u2192 IndexedDB\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-\u5904\u7406\u5b58\u50a8\u5f02\u5e38",children:"2. \u5904\u7406\u5b58\u50a8\u5f02\u5e38"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'try {\n  localStorage.setItem("key", "value");\n} catch (e) {\n  if (e.name === "QuotaExceededError") {\n    console.error("\u5b58\u50a8\u5df2\u6ee1");\n    // \u6e05\u7406\u65e7\u6570\u636e\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"3-\u6570\u636e\u7248\u672c\u7ba1\u7406",children:"3. \u6570\u636e\u7248\u672c\u7ba1\u7406"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'const STORAGE_VERSION = "1.0";\n\nfunction migrateStorage() {\n  const version = localStorage.getItem("storageVersion");\n  if (version !== STORAGE_VERSION) {\n    // \u6570\u636e\u8fc1\u79fb\u903b\u8f91\n    localStorage.clear();\n    localStorage.setItem("storageVersion", STORAGE_VERSION);\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"-\u76f8\u5173\u8d44\u6e90",children:"\ud83d\udd17 \u76f8\u5173\u8d44\u6e90"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/frontend/browser/",children:"\u6d4f\u89c8\u5668\u539f\u7406"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/frontend/browser/network",children:"HTTP \u7f51\u7edc"})}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u4e0b\u4e00\u6b65"}),"\uff1a\u5b66\u4e60 ",(0,t.jsx)(n.a,{href:"/docs/frontend/browser/network",children:"HTTP \u7f51\u7edc"})," \u4e86\u89e3\u6570\u636e\u4f20\u8f93\u3002"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);
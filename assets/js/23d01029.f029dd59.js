"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[54494],{48885:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>l});var r=i(99378);const s={},t=r.createContext(s);function d(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),r.createElement(t.Provider,{value:n},e.children)}},61755:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>m,contentTitle:()=>l,default:()=>c,frontMatter:()=>d,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"ml/recommendation-system","title":"\ud83c\udfaf \u63a8\u8350\u7cfb\u7edf","description":"\u63a8\u8350\u7cfb\u7edf\u6839\u636e\u7528\u6237\u7684\u5386\u53f2\u884c\u4e3a\u548c\u504f\u597d\uff0c\u5411\u7528\u6237\u63a8\u8350\u53ef\u80fd\u611f\u5174\u8da3\u7684\u7269\u54c1\u3002","source":"@site/docs/ml/recommendation-system.md","sourceDirName":"ml","slug":"/ml/recommendation-system","permalink":"/docs/ml/recommendation-system","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/ml/recommendation-system.md","tags":[],"version":"current","sidebarPosition":16,"frontMatter":{"sidebar_position":16,"title":"\ud83c\udfaf \u63a8\u8350\u7cfb\u7edf"},"sidebar":"ml","previous":{"title":"\ud83d\udcc8 \u65f6\u95f4\u5e8f\u5217","permalink":"/docs/ml/time-series"},"next":{"title":"\ud83d\udcdd NLP \u57fa\u7840","permalink":"/docs/ml/nlp-basics"}}');var s=i(22714),t=i(48885);const d={sidebar_position:16,title:"\ud83c\udfaf \u63a8\u8350\u7cfb\u7edf"},l="\u63a8\u8350\u7cfb\u7edf",m={},a=[{value:"\u63a8\u8350\u7b97\u6cd5\u5206\u7c7b",id:"\u63a8\u8350\u7b97\u6cd5\u5206\u7c7b",level:2},{value:"\u534f\u540c\u8fc7\u6ee4",id:"\u534f\u540c\u8fc7\u6ee4",level:2},{value:"\u57fa\u4e8e\u7528\u6237\u7684\u534f\u540c\u8fc7\u6ee4",id:"\u57fa\u4e8e\u7528\u6237\u7684\u534f\u540c\u8fc7\u6ee4",level:3},{value:"\u57fa\u4e8e\u7269\u54c1\u7684\u534f\u540c\u8fc7\u6ee4",id:"\u57fa\u4e8e\u7269\u54c1\u7684\u534f\u540c\u8fc7\u6ee4",level:3},{value:"\u77e9\u9635\u5206\u89e3 (SVD)",id:"\u77e9\u9635\u5206\u89e3-svd",level:3},{value:"\u57fa\u4e8e\u5185\u5bb9\u7684\u63a8\u8350",id:"\u57fa\u4e8e\u5185\u5bb9\u7684\u63a8\u8350",level:2},{value:"\u7269\u54c1\u7279\u5f81\u5411\u91cf",id:"\u7269\u54c1\u7279\u5f81\u5411\u91cf",level:3},{value:"\u7528\u6237\u753b\u50cf",id:"\u7528\u6237\u753b\u50cf",level:3},{value:"\u6df1\u5ea6\u5b66\u4e60\u63a8\u8350",id:"\u6df1\u5ea6\u5b66\u4e60\u63a8\u8350",level:2},{value:"\u795e\u7ecf\u534f\u540c\u8fc7\u6ee4 (NCF)",id:"\u795e\u7ecf\u534f\u540c\u8fc7\u6ee4-ncf",level:3},{value:"\u53cc\u5854\u6a21\u578b",id:"\u53cc\u5854\u6a21\u578b",level:3},{value:"\u8bc4\u4f30\u6307\u6807",id:"\u8bc4\u4f30\u6307\u6807",level:2},{value:"\u65b9\u6cd5\u9009\u62e9",id:"\u65b9\u6cd5\u9009\u62e9",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",mermaid:"mermaid",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u63a8\u8350\u7cfb\u7edf",children:"\u63a8\u8350\u7cfb\u7edf"})}),"\n",(0,s.jsx)(n.p,{children:"\u63a8\u8350\u7cfb\u7edf\u6839\u636e\u7528\u6237\u7684\u5386\u53f2\u884c\u4e3a\u548c\u504f\u597d\uff0c\u5411\u7528\u6237\u63a8\u8350\u53ef\u80fd\u611f\u5174\u8da3\u7684\u7269\u54c1\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u63a8\u8350\u7b97\u6cd5\u5206\u7c7b",children:"\u63a8\u8350\u7b97\u6cd5\u5206\u7c7b"}),"\n",(0,s.jsx)(n.mermaid,{value:"graph TB\n    A[\u63a8\u8350\u7cfb\u7edf] --\x3e B[\u534f\u540c\u8fc7\u6ee4]\n    A --\x3e C[\u57fa\u4e8e\u5185\u5bb9]\n    A --\x3e D[\u6df7\u5408\u63a8\u8350]\n    B --\x3e B1[\u57fa\u4e8e\u7528\u6237]\n    B --\x3e B2[\u57fa\u4e8e\u7269\u54c1]\n    B --\x3e B3[\u77e9\u9635\u5206\u89e3]\n    C --\x3e C1[TF-IDF]\n    C --\x3e C2[Embedding]"}),"\n",(0,s.jsx)(n.h2,{id:"\u534f\u540c\u8fc7\u6ee4",children:"\u534f\u540c\u8fc7\u6ee4"}),"\n",(0,s.jsx)(n.h3,{id:"\u57fa\u4e8e\u7528\u6237\u7684\u534f\u540c\u8fc7\u6ee4",children:"\u57fa\u4e8e\u7528\u6237\u7684\u534f\u540c\u8fc7\u6ee4"}),"\n",(0,s.jsx)(n.p,{children:"\u627e\u5230\u76f8\u4f3c\u7528\u6237\uff0c\u63a8\u8350\u4ed6\u4eec\u559c\u6b22\u7684\u7269\u54c1\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from sklearn.metrics.pairwise import cosine_similarity\nimport numpy as np\n\n# \u7528\u6237-\u7269\u54c1\u8bc4\u5206\u77e9\u9635\nratings = np.array([\n    [5, 3, 0, 1],\n    [4, 0, 0, 1],\n    [1, 1, 0, 5],\n    [0, 0, 5, 4],\n])\n\n# \u8ba1\u7b97\u7528\u6237\u76f8\u4f3c\u5ea6\nuser_similarity = cosine_similarity(ratings)\n\ndef predict_user_based(user_id, item_id, ratings, similarity, k=3):\n    # \u627e\u5230 k \u4e2a\u6700\u76f8\u4f3c\u4e14\u8bc4\u8fc7\u5206\u7684\u7528\u6237\n    sim_users = np.argsort(similarity[user_id])[::-1][1:k+1]\n\n    # \u52a0\u6743\u5e73\u5747\n    numerator = sum(similarity[user_id, u] * ratings[u, item_id] for u in sim_users if ratings[u, item_id] > 0)\n    denominator = sum(abs(similarity[user_id, u]) for u in sim_users if ratings[u, item_id] > 0)\n\n    return numerator / denominator if denominator > 0 else 0\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u57fa\u4e8e\u7269\u54c1\u7684\u534f\u540c\u8fc7\u6ee4",children:"\u57fa\u4e8e\u7269\u54c1\u7684\u534f\u540c\u8fc7\u6ee4"}),"\n",(0,s.jsx)(n.p,{children:"\u627e\u5230\u76f8\u4f3c\u7269\u54c1\uff0c\u63a8\u8350\u7ed9\u559c\u6b22\u8be5\u7269\u54c1\u7684\u7528\u6237\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# \u8ba1\u7b97\u7269\u54c1\u76f8\u4f3c\u5ea6\nitem_similarity = cosine_similarity(ratings.T)\n\ndef predict_item_based(user_id, item_id, ratings, similarity, k=3):\n    # \u7528\u6237\u8bc4\u8fc7\u5206\u7684\u7269\u54c1\n    rated_items = np.where(ratings[user_id] > 0)[0]\n\n    # \u627e\u5230\u6700\u76f8\u4f3c\u7684 k \u4e2a\u7269\u54c1\n    sim_items = sorted(rated_items, key=lambda x: similarity[item_id, x], reverse=True)[:k]\n\n    numerator = sum(similarity[item_id, i] * ratings[user_id, i] for i in sim_items)\n    denominator = sum(abs(similarity[item_id, i]) for i in sim_items)\n\n    return numerator / denominator if denominator > 0 else 0\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u77e9\u9635\u5206\u89e3-svd",children:"\u77e9\u9635\u5206\u89e3 (SVD)"}),"\n",(0,s.jsx)(n.p,{children:"\u5c06\u7528\u6237-\u7269\u54c1\u77e9\u9635\u5206\u89e3\u4e3a\u4f4e\u7ef4\u6f5c\u5728\u56e0\u5b50\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from surprise import SVD, Dataset, Reader\nfrom surprise.model_selection import cross_validate\n\n# \u51c6\u5907\u6570\u636e\nreader = Reader(rating_scale=(1, 5))\ndata = Dataset.load_from_df(df[['user_id', 'item_id', 'rating']], reader)\n\n# SVD \u6a21\u578b\nsvd = SVD(n_factors=50, n_epochs=20, lr_all=0.005, reg_all=0.02)\ncross_validate(svd, data, cv=5)\n\n# \u8bad\u7ec3\u5e76\u9884\u6d4b\ntrainset = data.build_full_trainset()\nsvd.fit(trainset)\nprediction = svd.predict(user_id, item_id)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u57fa\u4e8e\u5185\u5bb9\u7684\u63a8\u8350",children:"\u57fa\u4e8e\u5185\u5bb9\u7684\u63a8\u8350"}),"\n",(0,s.jsx)(n.h3,{id:"\u7269\u54c1\u7279\u5f81\u5411\u91cf",children:"\u7269\u54c1\u7279\u5f81\u5411\u91cf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from sklearn.feature_extraction.text import TfidfVectorizer\n\n# \u7269\u54c1\u63cf\u8ff0\ndescriptions = ["\u52a8\u4f5c\u5192\u9669\u7535\u5f71", "\u6d6a\u6f2b\u559c\u5267\u7535\u5f71", "\u79d1\u5e7b\u52a8\u4f5c\u7535\u5f71"]\n\n# TF-IDF \u5411\u91cf\u5316\ntfidf = TfidfVectorizer()\nitem_features = tfidf.fit_transform(descriptions)\n\n# \u7269\u54c1\u76f8\u4f3c\u5ea6\nitem_sim = cosine_similarity(item_features)\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u7528\u6237\u753b\u50cf",children:"\u7528\u6237\u753b\u50cf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"def build_user_profile(user_id, ratings, item_features):\n    # \u7528\u6237\u8bc4\u8fc7\u5206\u7684\u7269\u54c1\n    rated_items = np.where(ratings[user_id] > 0)[0]\n\n    # \u52a0\u6743\u5e73\u5747\u7269\u54c1\u7279\u5f81\n    profile = np.zeros(item_features.shape[1])\n    for item in rated_items:\n        profile += ratings[user_id, item] * item_features[item].toarray().flatten()\n\n    return profile / len(rated_items)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6df1\u5ea6\u5b66\u4e60\u63a8\u8350",children:"\u6df1\u5ea6\u5b66\u4e60\u63a8\u8350"}),"\n",(0,s.jsx)(n.h3,{id:"\u795e\u7ecf\u534f\u540c\u8fc7\u6ee4-ncf",children:"\u795e\u7ecf\u534f\u540c\u8fc7\u6ee4 (NCF)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import torch\nimport torch.nn as nn\n\nclass NCF(nn.Module):\n    def __init__(self, num_users, num_items, embed_dim=64):\n        super().__init__()\n        self.user_embed = nn.Embedding(num_users, embed_dim)\n        self.item_embed = nn.Embedding(num_items, embed_dim)\n        self.mlp = nn.Sequential(\n            nn.Linear(embed_dim * 2, 128),\n            nn.ReLU(),\n            nn.Linear(128, 64),\n            nn.ReLU(),\n            nn.Linear(64, 1)\n        )\n\n    def forward(self, user_ids, item_ids):\n        user_emb = self.user_embed(user_ids)\n        item_emb = self.item_embed(item_ids)\n        x = torch.cat([user_emb, item_emb], dim=1)\n        return self.mlp(x).squeeze()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u53cc\u5854\u6a21\u578b",children:"\u53cc\u5854\u6a21\u578b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"class TwoTower(nn.Module):\n    def __init__(self, num_users, num_items, embed_dim=64):\n        super().__init__()\n        # \u7528\u6237\u5854\n        self.user_tower = nn.Sequential(\n            nn.Embedding(num_users, embed_dim),\n            nn.Linear(embed_dim, 64),\n            nn.ReLU()\n        )\n        # \u7269\u54c1\u5854\n        self.item_tower = nn.Sequential(\n            nn.Embedding(num_items, embed_dim),\n            nn.Linear(embed_dim, 64),\n            nn.ReLU()\n        )\n\n    def forward(self, user_ids, item_ids):\n        user_vec = self.user_tower(user_ids)\n        item_vec = self.item_tower(item_ids)\n        return (user_vec * item_vec).sum(dim=1)  # \u70b9\u79ef\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u8bc4\u4f30\u6307\u6807",children:"\u8bc4\u4f30\u6307\u6807"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# \u51c6\u786e\u7387@K\ndef precision_at_k(recommended, relevant, k):\n    recommended_k = recommended[:k]\n    return len(set(recommended_k) & set(relevant)) / k\n\n# \u53ec\u56de\u7387@K\ndef recall_at_k(recommended, relevant, k):\n    recommended_k = recommended[:k]\n    return len(set(recommended_k) & set(relevant)) / len(relevant)\n\n# NDCG@K\ndef ndcg_at_k(recommended, relevant, k):\n    dcg = sum(1 / np.log2(i + 2) for i, item in enumerate(recommended[:k]) if item in relevant)\n    idcg = sum(1 / np.log2(i + 2) for i in range(min(len(relevant), k)))\n    return dcg / idcg if idcg > 0 else 0\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u65b9\u6cd5\u9009\u62e9",children:"\u65b9\u6cd5\u9009\u62e9"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u573a\u666f"}),(0,s.jsx)(n.th,{children:"\u63a8\u8350\u65b9\u6cd5"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u51b7\u542f\u52a8\u7269\u54c1"}),(0,s.jsx)(n.td,{children:"\u57fa\u4e8e\u5185\u5bb9"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u51b7\u542f\u52a8\u7528\u6237"}),(0,s.jsx)(n.td,{children:"\u70ed\u95e8\u63a8\u8350 / \u57fa\u4e8e\u5185\u5bb9"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u7a00\u758f\u6570\u636e"}),(0,s.jsx)(n.td,{children:"\u77e9\u9635\u5206\u89e3"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u5927\u89c4\u6a21\u6570\u636e"}),(0,s.jsx)(n.td,{children:"\u53cc\u5854\u6a21\u578b + ANN"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u5e8f\u5217\u884c\u4e3a"}),(0,s.jsx)(n.td,{children:"Transformer"})]})]})]})]})}function c(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);
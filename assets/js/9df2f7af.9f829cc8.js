"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[20924],{37740:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"kubernetes/storage","title":"\u5b58\u50a8\u7ba1\u7406","description":"Kubernetes \u6301\u4e45\u5316\u5b58\u50a8 PV/PVC","source":"@site/docs/kubernetes/storage.md","sourceDirName":"kubernetes","slug":"/kubernetes/storage","permalink":"/docs/kubernetes/storage","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/kubernetes/storage.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"\u5b58\u50a8\u7ba1\u7406","description":"Kubernetes \u6301\u4e45\u5316\u5b58\u50a8 PV/PVC"},"sidebar":"kubernetes","previous":{"title":"ConfigMap \u4e0e Secret","permalink":"/docs/kubernetes/configmap-secret"},"next":{"title":"Helm \u5305\u7ba1\u7406","permalink":"/docs/kubernetes/helm"}}');var i=s(22714),l=s(48885);const t={sidebar_position:8,title:"\u5b58\u50a8\u7ba1\u7406",description:"Kubernetes \u6301\u4e45\u5316\u5b58\u50a8 PV/PVC"},a="\u5b58\u50a8\u7ba1\u7406",d={},c=[{value:"\u5b58\u50a8\u6982\u8ff0",id:"\u5b58\u50a8\u6982\u8ff0",level:2},{value:"Volume \u7c7b\u578b",id:"volume-\u7c7b\u578b",level:2},{value:"\u4e34\u65f6\u5377",id:"\u4e34\u65f6\u5377",level:3},{value:"hostPath",id:"hostpath",level:3},{value:"PersistentVolume (PV)",id:"persistentvolume-pv",level:2},{value:"\u8bbf\u95ee\u6a21\u5f0f",id:"\u8bbf\u95ee\u6a21\u5f0f",level:3},{value:"\u56de\u6536\u7b56\u7565",id:"\u56de\u6536\u7b56\u7565",level:3},{value:"PersistentVolumeClaim (PVC)",id:"persistentvolumeclaim-pvc",level:2},{value:"\u4f7f\u7528 PVC",id:"\u4f7f\u7528-pvc",level:3},{value:"StorageClass",id:"storageclass",level:2},{value:"\u5e38\u7528 Provisioner",id:"\u5e38\u7528-provisioner",level:3},{value:"\u52a8\u6001\u4f9b\u5e94",id:"\u52a8\u6001\u4f9b\u5e94",level:3},{value:"StatefulSet \u4e0e\u5b58\u50a8",id:"statefulset-\u4e0e\u5b58\u50a8",level:2},{value:"\u5377\u6269\u5bb9",id:"\u5377\u6269\u5bb9",level:2},{value:"\u542f\u7528\u6269\u5bb9",id:"\u542f\u7528\u6269\u5bb9",level:3},{value:"\u6269\u5bb9 PVC",id:"\u6269\u5bb9-pvc",level:3},{value:"\u5377\u5feb\u7167",id:"\u5377\u5feb\u7167",level:2},{value:"CSI (Container Storage Interface)",id:"csi-container-storage-interface",level:2},{value:"\u5e38\u7528 CSI \u9a71\u52a8",id:"\u5e38\u7528-csi-\u9a71\u52a8",level:3},{value:"\u5b89\u88c5 CSI \u9a71\u52a8",id:"\u5b89\u88c5-csi-\u9a71\u52a8",level:3},{value:"\u672c\u5730\u5b58\u50a8",id:"\u672c\u5730\u5b58\u50a8",level:2},{value:"Local PV",id:"local-pv",level:3},{value:"\u5e38\u7528\u64cd\u4f5c",id:"\u5e38\u7528\u64cd\u4f5c",level:2},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u5b58\u50a8\u7ba1\u7406",children:"\u5b58\u50a8\u7ba1\u7406"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5b58\u50a8\u6982\u8ff0",children:"\u5b58\u50a8\u6982\u8ff0"}),"\n",(0,i.jsx)(n.p,{children:"Kubernetes \u63d0\u4f9b\u4e86\u7075\u6d3b\u7684\u5b58\u50a8\u62bd\u8c61\uff0c\u652f\u6301\u591a\u79cd\u5b58\u50a8\u540e\u7aef\u3002"}),"\n",(0,i.jsx)(n.mermaid,{value:"graph TB\n    SC[StorageClass] --\x3e PV[PersistentVolume]\n    PVC[PersistentVolumeClaim] --\x3e PV\n    Pod --\x3e PVC\n    PV --\x3e Storage[\u5b58\u50a8\u540e\u7aef<br/>NFS/Ceph/AWS EBS/...]"}),"\n",(0,i.jsx)(n.h2,{id:"volume-\u7c7b\u578b",children:"Volume \u7c7b\u578b"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e34\u65f6\u5377",children:"\u4e34\u65f6\u5377"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: temp-volume-pod\nspec:\n  containers:\n    - name: app\n      image: nginx\n      volumeMounts:\n        - name: cache\n          mountPath: /cache\n        - name: shared\n          mountPath: /shared\n\n  volumes:\n    # emptyDir\uff1aPod \u5220\u9664\u65f6\u6570\u636e\u4e22\u5931\n    - name: cache\n      emptyDir:\n        sizeLimit: 500Mi\n        medium: Memory # \u4f7f\u7528\u5185\u5b58\uff08tmpfs\uff09\n\n    # \u5171\u4eab\u76ee\u5f55\n    - name: shared\n      emptyDir: {}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"hostpath",children:"hostPath"}),"\n",(0,i.jsx)(n.p,{children:"\u5c06\u8282\u70b9\u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u5230 Pod\uff08\u4ec5\u7528\u4e8e\u7279\u6b8a\u573a\u666f\uff09\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"volumes:\n  - name: host-volume\n    hostPath:\n      path: /data\n      type: DirectoryOrCreate # \u4e0d\u5b58\u5728\u5219\u521b\u5efa\n"})}),"\n",(0,i.jsx)(n.p,{children:"hostPath \u7c7b\u578b\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Directory"}),"\uff1a\u76ee\u5f55\u5fc5\u987b\u5b58\u5728"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DirectoryOrCreate"}),"\uff1a\u4e0d\u5b58\u5728\u5219\u521b\u5efa"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"File"}),"\uff1a\u6587\u4ef6\u5fc5\u987b\u5b58\u5728"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FileOrCreate"}),"\uff1a\u4e0d\u5b58\u5728\u5219\u521b\u5efa"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Socket"}),"\uff1aUnix Socket"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"persistentvolume-pv",children:"PersistentVolume (PV)"}),"\n",(0,i.jsx)(n.p,{children:"PV \u662f\u96c6\u7fa4\u7ea7\u522b\u7684\u5b58\u50a8\u8d44\u6e90\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: my-pv\n  labels:\n    type: local\nspec:\n  capacity:\n    storage: 10Gi\n\n  volumeMode: Filesystem # \u6216 Block\n  accessModes:\n    - ReadWriteOnce # RWO\n    - ReadOnlyMany # ROX\n\n  persistentVolumeReclaimPolicy: Retain\n\n  storageClassName: manual\n\n  # NFS \u793a\u4f8b\n  nfs:\n    server: nfs-server.example.com\n    path: /exports/data\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u8bbf\u95ee\u6a21\u5f0f",children:"\u8bbf\u95ee\u6a21\u5f0f"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u6a21\u5f0f"}),(0,i.jsx)(n.th,{children:"\u7b80\u5199"}),(0,i.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ReadWriteOnce"}),(0,i.jsx)(n.td,{children:"RWO"}),(0,i.jsx)(n.td,{children:"\u5355\u8282\u70b9\u8bfb\u5199"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ReadOnlyMany"}),(0,i.jsx)(n.td,{children:"ROX"}),(0,i.jsx)(n.td,{children:"\u591a\u8282\u70b9\u53ea\u8bfb"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ReadWriteMany"}),(0,i.jsx)(n.td,{children:"RWX"}),(0,i.jsx)(n.td,{children:"\u591a\u8282\u70b9\u8bfb\u5199"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ReadWriteOncePod"}),(0,i.jsx)(n.td,{children:"RWOP"}),(0,i.jsx)(n.td,{children:"\u5355 Pod \u8bfb\u5199\uff081.22+\uff09"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\u56de\u6536\u7b56\u7565",children:"\u56de\u6536\u7b56\u7565"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u7b56\u7565"}),(0,i.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Retain"}),(0,i.jsx)(n.td,{children:"\u4fdd\u7559\u6570\u636e\uff0c\u624b\u52a8\u56de\u6536"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Delete"}),(0,i.jsx)(n.td,{children:"\u5220\u9664 PV \u548c\u540e\u7aef\u5b58\u50a8"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Recycle"}),(0,i.jsx)(n.td,{children:"\u5df2\u5f03\u7528"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"persistentvolumeclaim-pvc",children:"PersistentVolumeClaim (PVC)"}),"\n",(0,i.jsx)(n.p,{children:"PVC \u662f\u7528\u6237\u5bf9\u5b58\u50a8\u7684\u8bf7\u6c42\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: my-pvc\n  namespace: default\nspec:\n  accessModes:\n    - ReadWriteOnce\n\n  resources:\n    requests:\n      storage: 5Gi\n\n  storageClassName: manual\n\n  # \u53ef\u9009\uff1a\u9009\u62e9\u7279\u5b9a PV\n  selector:\n    matchLabels:\n      type: local\n    matchExpressions:\n      - key: environment\n        operator: In\n        values:\n          - production\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u4f7f\u7528-pvc",children:"\u4f7f\u7528 PVC"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: app\nspec:\n  containers:\n    - name: app\n      image: nginx\n      volumeMounts:\n        - name: data\n          mountPath: /data\n\n  volumes:\n    - name: data\n      persistentVolumeClaim:\n        claimName: my-pvc\n        readOnly: false\n"})}),"\n",(0,i.jsx)(n.h2,{id:"storageclass",children:"StorageClass"}),"\n",(0,i.jsx)(n.p,{children:"StorageClass \u5b9a\u4e49\u52a8\u6001\u5b58\u50a8\u4f9b\u5e94\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: fast\n  annotations:\n    storageclass.kubernetes.io/is-default-class: "true"\nprovisioner: kubernetes.io/aws-ebs\nparameters:\n  type: gp3\n  iops: "3000"\n  throughput: "125"\n  encrypted: "true"\nreclaimPolicy: Delete\nallowVolumeExpansion: true\nvolumeBindingMode: WaitForFirstConsumer\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u5e38\u7528-provisioner",children:"\u5e38\u7528 Provisioner"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Provisioner"}),(0,i.jsx)(n.th,{children:"\u5b58\u50a8\u7c7b\u578b"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"kubernetes.io/aws-ebs"}),(0,i.jsx)(n.td,{children:"AWS EBS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"kubernetes.io/gce-pd"}),(0,i.jsx)(n.td,{children:"GCE Persistent Disk"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"kubernetes.io/azure-disk"}),(0,i.jsx)(n.td,{children:"Azure Disk"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"kubernetes.io/azure-file"}),(0,i.jsx)(n.td,{children:"Azure File"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"kubernetes.io/cinder"}),(0,i.jsx)(n.td,{children:"OpenStack Cinder"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"kubernetes.io/no-provisioner"}),(0,i.jsx)(n.td,{children:"\u624b\u52a8\u4f9b\u5e94"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\u52a8\u6001\u4f9b\u5e94",children:"\u52a8\u6001\u4f9b\u5e94"}),"\n",(0,i.jsx)(n.p,{children:"\u4f7f\u7528 StorageClass \u81ea\u52a8\u521b\u5efa PV\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: dynamic-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 10Gi\n  storageClassName: fast # \u6307\u5b9a StorageClass\n"})}),"\n",(0,i.jsx)(n.h2,{id:"statefulset-\u4e0e\u5b58\u50a8",children:"StatefulSet \u4e0e\u5b58\u50a8"}),"\n",(0,i.jsx)(n.p,{children:"StatefulSet \u4e3a\u6bcf\u4e2a Pod \u521b\u5efa\u72ec\u7acb\u7684 PVC\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  serviceName: mysql\n  replicas: 3\n  selector:\n    matchLabels:\n      app: mysql\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      containers:\n        - name: mysql\n          image: mysql:8.0\n          volumeMounts:\n            - name: data\n              mountPath: /var/lib/mysql\n\n  # VolumeClaimTemplate\n  volumeClaimTemplates:\n    - metadata:\n        name: data\n      spec:\n        accessModes:\n          - ReadWriteOnce\n        storageClassName: fast\n        resources:\n          requests:\n            storage: 20Gi\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u751f\u6210\u7684 PVC\uff1a",(0,i.jsx)(n.code,{children:"data-mysql-0"}),"\u3001",(0,i.jsx)(n.code,{children:"data-mysql-1"}),"\u3001",(0,i.jsx)(n.code,{children:"data-mysql-2"})]}),"\n",(0,i.jsx)(n.h2,{id:"\u5377\u6269\u5bb9",children:"\u5377\u6269\u5bb9"}),"\n",(0,i.jsx)(n.h3,{id:"\u542f\u7528\u6269\u5bb9",children:"\u542f\u7528\u6269\u5bb9"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: expandable\nprovisioner: kubernetes.io/aws-ebs\nallowVolumeExpansion: true # \u5141\u8bb8\u6269\u5bb9\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u6269\u5bb9-pvc",children:"\u6269\u5bb9 PVC"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u7f16\u8f91 PVC\nkubectl edit pvc my-pvc\n\n# \u4fee\u6539 spec.resources.requests.storage\n# \u53ea\u80fd\u589e\u5927\uff0c\u4e0d\u80fd\u7f29\u5c0f\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5377\u5feb\u7167",children:"\u5377\u5feb\u7167"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# VolumeSnapshotClass\napiVersion: snapshot.storage.k8s.io/v1\nkind: VolumeSnapshotClass\nmetadata:\n  name: csi-snapclass\ndriver: ebs.csi.aws.com\ndeletionPolicy: Delete\n\n---\n# VolumeSnapshot\napiVersion: snapshot.storage.k8s.io/v1\nkind: VolumeSnapshot\nmetadata:\n  name: my-snapshot\nspec:\n  volumeSnapshotClassName: csi-snapclass\n  source:\n    persistentVolumeClaimName: my-pvc\n\n---\n# \u4ece\u5feb\u7167\u6062\u590d\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: restored-pvc\nspec:\n  accessModes:\n    - ReadWriteOnce\n  storageClassName: fast\n  dataSource:\n    name: my-snapshot\n    kind: VolumeSnapshot\n    apiGroup: snapshot.storage.k8s.io\n  resources:\n    requests:\n      storage: 10Gi\n"})}),"\n",(0,i.jsx)(n.h2,{id:"csi-container-storage-interface",children:"CSI (Container Storage Interface)"}),"\n",(0,i.jsx)(n.p,{children:"CSI \u662f\u5bb9\u5668\u5b58\u50a8\u7684\u6807\u51c6\u63a5\u53e3\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u5e38\u7528-csi-\u9a71\u52a8",children:"\u5e38\u7528 CSI \u9a71\u52a8"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u9a71\u52a8"}),(0,i.jsx)(n.th,{children:"\u5b58\u50a8\u7c7b\u578b"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"aws-ebs-csi-driver"}),(0,i.jsx)(n.td,{children:"AWS EBS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"aws-efs-csi-driver"}),(0,i.jsx)(n.td,{children:"AWS EFS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"azuredisk-csi-driver"}),(0,i.jsx)(n.td,{children:"Azure Disk"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"gce-pd-csi-driver"}),(0,i.jsx)(n.td,{children:"GCE PD"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ceph-csi"}),(0,i.jsx)(n.td,{children:"Ceph"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"longhorn"}),(0,i.jsx)(n.td,{children:"Longhorn"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"local-path-provisioner"}),(0,i.jsx)(n.td,{children:"\u672c\u5730\u8def\u5f84"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\u5b89\u88c5-csi-\u9a71\u52a8",children:"\u5b89\u88c5 CSI \u9a71\u52a8"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# AWS EBS CSI \u9a71\u52a8\u793a\u4f8b\nkubectl apply -k "github.com/kubernetes-sigs/aws-ebs-csi-driver/deploy/kubernetes/overlays/stable/?ref=release-1.20"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u672c\u5730\u5b58\u50a8",children:"\u672c\u5730\u5b58\u50a8"}),"\n",(0,i.jsx)(n.h3,{id:"local-pv",children:"Local PV"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: local-pv\nspec:\n  capacity:\n    storage: 100Gi\n  volumeMode: Filesystem\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Delete\n  storageClassName: local-storage\n  local:\n    path: /mnt/disks/ssd1\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n        - matchExpressions:\n            - key: kubernetes.io/hostname\n              operator: In\n              values:\n                - node1\n\n---\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: local-storage\nprovisioner: kubernetes.io/no-provisioner\nvolumeBindingMode: WaitForFirstConsumer\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5e38\u7528\u64cd\u4f5c",children:"\u5e38\u7528\u64cd\u4f5c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b StorageClass\nkubectl get storageclass\nkubectl get sc\n\n# \u67e5\u770b PV\nkubectl get pv\nkubectl describe pv my-pv\n\n# \u67e5\u770b PVC\nkubectl get pvc\nkubectl describe pvc my-pvc\n\n# \u67e5\u770b PVC \u7ed1\u5b9a\u72b6\u6001\nkubectl get pvc -o wide\n\n# \u5220\u9664 PVC\nkubectl delete pvc my-pvc\n\n# \u5220\u9664 PV\nkubectl delete pv my-pv\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4f7f\u7528 StorageClass \u52a8\u6001\u4f9b\u5e94"}),"\uff1a\u51cf\u5c11\u624b\u52a8\u7ba1\u7406"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u8bbe\u7f6e\u5408\u9002\u7684\u8bbf\u95ee\u6a21\u5f0f"}),"\uff1a\u6839\u636e\u5e94\u7528\u9700\u6c42\u9009\u62e9"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u542f\u7528\u5377\u6269\u5bb9"}),"\uff1a\u9884\u7559\u6269\u5bb9\u80fd\u529b"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4f7f\u7528 WaitForFirstConsumer"}),"\uff1a\u5ef6\u8fdf\u7ed1\u5b9a\uff0c\u4f18\u5316\u8c03\u5ea6"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5b9a\u671f\u5907\u4efd"}),"\uff1a\u4f7f\u7528\u5feb\u7167\u6216\u5907\u4efd\u5de5\u5177"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u76d1\u63a7\u5b58\u50a8\u4f7f\u7528"}),"\uff1a\u53ca\u65f6\u6269\u5bb9\u907f\u514d\u7a7a\u95f4\u4e0d\u8db3"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4f7f\u7528 CSI \u9a71\u52a8"}),"\uff1a\u6807\u51c6\u5316\u5b58\u50a8\u63a5\u53e3"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},48885:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var r=s(99378);const i={},l=r.createContext(i);function t(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);
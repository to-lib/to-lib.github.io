"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[1e3],{36950:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>t,contentTitle:()=>a,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"springboot/docker","title":"Docker \u5bb9\u5668\u5316","description":"[!TIP]","source":"@site/docs/springboot/docker.md","sourceDirName":"springboot","slug":"/springboot/docker","permalink":"/docs/springboot/docker","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/springboot/docker.md","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20},"sidebar":"springboot","previous":{"title":"\u6e05\u7406\u5e76\u6253\u5305","permalink":"/docs/springboot/deployment"},"next":{"title":"\u6700\u4f73\u5b9e\u8df5","permalink":"/docs/springboot/best-practices"}}');var i=r(22714),o=r(48885);const l={sidebar_position:20},a="Docker \u5bb9\u5668\u5316",t={},d=[{value:"Dockerfile \u7f16\u5199",id:"dockerfile-\u7f16\u5199",level:2},{value:"\u57fa\u7840 Dockerfile",id:"\u57fa\u7840-dockerfile",level:3},{value:"\u4f18\u5316\u7684 Dockerfile",id:"\u4f18\u5316\u7684-dockerfile",level:3},{value:"\u591a\u9636\u6bb5\u6784\u5efa\uff08\u6700\u4f73\u5b9e\u8df5\uff09",id:"\u591a\u9636\u6bb5\u6784\u5efa\u6700\u4f73\u5b9e\u8df5",level:3},{value:"Docker Compose",id:"docker-compose",level:2},{value:"\u57fa\u672c\u914d\u7f6e",id:"\u57fa\u672c\u914d\u7f6e",level:3},{value:"\u5b8c\u6574\u7684\u751f\u4ea7\u73af\u5883\u914d\u7f6e",id:"\u5b8c\u6574\u7684\u751f\u4ea7\u73af\u5883\u914d\u7f6e",level:3},{value:"Spring Boot \u914d\u7f6e",id:"spring-boot-\u914d\u7f6e",level:2},{value:"application-docker.yml",id:"application-dockeryml",level:3},{value:"\u6784\u5efa\u548c\u8fd0\u884c",id:"\u6784\u5efa\u548c\u8fd0\u884c",level:2},{value:"\u6784\u5efa\u955c\u50cf",id:"\u6784\u5efa\u955c\u50cf",level:3},{value:"\u4f7f\u7528 Docker Compose",id:"\u4f7f\u7528-docker-compose",level:3},{value:"Kubernetes \u90e8\u7f72\u57fa\u7840",id:"kubernetes-\u90e8\u7f72\u57fa\u7840",level:2},{value:"Deployment",id:"deployment",level:3},{value:"Service",id:"service",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function c(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"docker-\u5bb9\u5668\u5316",children:"Docker \u5bb9\u5668\u5316"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.p,{children:["[!TIP]\n",(0,i.jsx)(e.strong,{children:"\u5bb9\u5668\u5316\u7684\u4f18\u52bf"}),': Docker \u8ba9\u5e94\u7528\u90e8\u7f72\u66f4\u7b80\u5355\u3001\u4e00\u81f4\u4e14\u53ef\u91cd\u590d\u3002\u4e00\u6b21\u6784\u5efa\uff0c\u5230\u5904\u8fd0\u884c\uff0c\u89e3\u51b3\u4e86"\u5728\u6211\u673a\u5668\u4e0a\u80fd\u8dd1"\u7684\u95ee\u9898\u3002']}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"dockerfile-\u7f16\u5199",children:"Dockerfile \u7f16\u5199"}),"\n",(0,i.jsx)(e.h3,{id:"\u57fa\u7840-dockerfile",children:"\u57fa\u7840 Dockerfile"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-dockerfile",children:'# \u4f7f\u7528 OpenJDK 17 \u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\nFROM eclipse-temurin:17-jre\n\n# \u8bbe\u7f6e\u5de5\u4f5c\u76ee\u5f55\nWORKDIR /app\n\n# \u590d\u5236 JAR \u6587\u4ef6\nCOPY target/*.jar app.jar\n\n# \u66b4\u9732\u7aef\u53e3\nEXPOSE 8080\n\n# \u542f\u52a8\u5e94\u7528\nENTRYPOINT ["java", "-jar", "app.jar"]\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u4f18\u5316\u7684-dockerfile",children:"\u4f18\u5316\u7684 Dockerfile"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-dockerfile",children:'FROM eclipse-temurin:17-jre-alpine\n\n# \u6dfb\u52a0\u975e root \u7528\u6237\nRUN addgroup -S spring && adduser -S spring -G spring\nUSER spring:spring\n\nWORKDIR /app\n\n# \u590d\u5236 JAR \u6587\u4ef6\nARG JAR_FILE=target/*.jar\nCOPY ${JAR_FILE} app.jar\n\n# \u4f7f\u7528\u5206\u5c42 JAR\uff08Spring Boot 2.3+\uff09\nEXPOSE 8080\n\nENTRYPOINT ["java", \\\n    "-Djava.security.egd=file:/dev/./urandom", \\\n    "-Dspring.profiles.active=prod", \\\n    "-jar", \\\n    "app.jar"]\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u591a\u9636\u6bb5\u6784\u5efa\u6700\u4f73\u5b9e\u8df5",children:"\u591a\u9636\u6bb5\u6784\u5efa\uff08\u6700\u4f73\u5b9e\u8df5\uff09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-dockerfile",children:'# \u7b2c\u4e00\u9636\u6bb5\uff1a\u6784\u5efa\nFROM maven:3.9-eclipse-temurin-17 AS build\nWORKDIR /app\nCOPY pom.xml .\nCOPY src ./src\nRUN mvn clean package -DskipTests\n\n# \u7b2c\u4e8c\u9636\u6bb5\uff1a\u8fd0\u884c\nFROM eclipse-temurin:17-jre-alpine\nRUN addgroup -S spring && adduser -S spring -G spring\nUSER spring:spring\nWORKDIR /app\nCOPY --from=build /app/target/*.jar app.jar\n\nEXPOSE 8080\nHEALTHCHECK --interval=30s --timeout=3s \\\n  CMD wget -q --spider http://localhost:8080/actuator/health || exit 1\n\nENTRYPOINT ["java", "-jar", "app.jar"]\n'})}),"\n",(0,i.jsx)(e.h2,{id:"docker-compose",children:"Docker Compose"}),"\n",(0,i.jsx)(e.h3,{id:"\u57fa\u672c\u914d\u7f6e",children:"\u57fa\u672c\u914d\u7f6e"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"version: '3.8'\n\nservices:\n  app:\n    build: .\n    ports:\n      - \"8080:8080\"\n    environment:\n      - SPRING_PROFILES_ACTIVE=prod\n      - SPRING_DATASOURCE_URL=jdbc:mysql://db:3306/myapp\n      - SPRING_DATASOURCE_USERNAME=root\n      - SPRING_DATASOURCE_PASSWORD=password\n    depends_on:\n      - db\n      - redis\n    networks:\n      - app-network\n\n  db:\n    image: mysql:8.0\n    environment:\n      - MYSQL_ROOT_PASSWORD=password\n      - MYSQL_DATABASE=myapp\n    volumes:\n      - mysql-data:/var/lib/mysql\n    networks:\n      - app-network\n\n  redis:\n    image: redis:7-alpine\n    networks:\n      - app-network\n\nvolumes:\n  mysql-data:\n\nnetworks:\n  app-network:\n    driver: bridge\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u5b8c\u6574\u7684\u751f\u4ea7\u73af\u5883\u914d\u7f6e",children:"\u5b8c\u6574\u7684\u751f\u4ea7\u73af\u5883\u914d\u7f6e"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  app:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    image: myapp:latest\n    container_name: myapp\n    restart: unless-stopped\n    ports:\n      - "8080:8080"\n    environment:\n      - SPRING_PROFILES_ACTIVE=prod\n      - SPRING_DATASOURCE_URL=jdbc:mysql://db:3306/myapp?useSSL=false&serverTimezone=UTC\n      - SPRING_DATASOURCE_USERNAME=appuser\n      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}\n      - SPRING_REDIS_HOST=redis\n      - SPRING_REDIS_PORT=6379\n      - JAVA_OPTS=-Xmx512m -Xms256m\n    depends_on:\n      db:\n        condition: service_healthy\n      redis:\n        condition: service_started\n    healthcheck:\n      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/actuator/health"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n    networks:\n      - backend\n    volumes:\n      - app-logs:/app/logs\n\n  db:\n    image: mysql:8.0\n    container_name: myapp-db\n    restart: unless-stopped\n    environment:\n      - MYSQL_ROOT_PASSWORD=${DB_ROOT_PASSWORD}\n      - MYSQL_DATABASE=myapp\n      - MYSQL_USER=appuser\n      - MYSQL_PASSWORD=${DB_PASSWORD}\n    volumes:\n      - mysql-data:/var/lib/mysql\n      - ./init.sql:/docker-entrypoint-initdb.d/init.sql\n    healthcheck:\n      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n    networks:\n      - backend\n\n  redis:\n    image: redis:7-alpine\n    container_name: myapp-redis\n    restart: unless-stopped\n    command: redis-server --appendonly yes\n    volumes:\n      - redis-data:/data\n    networks:\n      - backend\n\n  nginx:\n    image: nginx:alpine\n    container_name: myapp-nginx\n    restart: unless-stopped\n    ports:\n      - "80:80"\n      - "443:443"\n    volumes:\n      - ./nginx.conf:/etc/nginx/nginx.conf:ro\n      - ./ssl:/etc/nginx/ssl:ro\n    depends_on:\n      - app\n    networks:\n      - backend\n\nvolumes:\n  mysql-data:\n  redis-data:\n  app-logs:\n\nnetworks:\n  backend:\n    driver: bridge\n'})}),"\n",(0,i.jsx)(e.h2,{id:"spring-boot-\u914d\u7f6e",children:"Spring Boot \u914d\u7f6e"}),"\n",(0,i.jsx)(e.h3,{id:"application-dockeryml",children:"application-docker.yml"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'spring:\n  datasource:\n    url: ${SPRING_DATASOURCE_URL:jdbc:mysql://localhost:3306/myapp}\n    username: ${SPRING_DATASOURCE_USERNAME:root}\n    password: ${SPRING_DATASOURCE_PASSWORD:password}\n    hikari:\n      maximum-pool-size: 20\n      minimum-idle: 5\n  \n  redis:\n    host: ${SPRING_REDIS_HOST:localhost}\n    port: ${SPRING_REDIS_PORT:6379}\n  \n  jpa:\n    hibernate:\n      ddl-auto: validate\n    show-sql: false\n    properties:\n      hibernate:\n        format_sql: true\n\nlogging:\n  level:\n    root: INFO\n    com.example: DEBUG\n  file:\n    name: /app/logs/application.log\n  pattern:\n    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"\n    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: health,info,metrics,prometheus\n  endpoint:\n    health:\n      show-details: always\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u6784\u5efa\u548c\u8fd0\u884c",children:"\u6784\u5efa\u548c\u8fd0\u884c"}),"\n",(0,i.jsx)(e.h3,{id:"\u6784\u5efa\u955c\u50cf",children:"\u6784\u5efa\u955c\u50cf"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u6784\u5efa Spring Boot\u5e94\u7528\nmvn clean package\n\n# \u6784\u5efa Docker \u955c\u50cf\ndocker build -t myapp:1.0.0 .\n\n# \u67e5\u770b\u955c\u50cf\ndocker images\n\n# \u8fd0\u884c\u5bb9\u5668\ndocker run -d -p 8080:8080 --name myapp myapp:1.0.0\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u4f7f\u7528-docker-compose",children:"\u4f7f\u7528 Docker Compose"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u542f\u52a8\u6240\u6709\u670d\u52a1\ndocker-compose up -d\n\n# \u67e5\u770b\u65e5\u5fd7\ndocker-compose logs -f app\n\n# \u505c\u6b62\u670d\u52a1\ndocker-compose down\n\n# \u505c\u6b62\u5e76\u5220\u9664\u5377\ndocker-compose down -v\n\n# \u91cd\u65b0\u6784\u5efa\u5e76\u542f\u52a8\ndocker-compose up -d --build\n"})}),"\n",(0,i.jsx)(e.h2,{id:"kubernetes-\u90e8\u7f72\u57fa\u7840",children:"Kubernetes \u90e8\u7f72\u57fa\u7840"}),"\n",(0,i.jsx)(e.h3,{id:"deployment",children:"Deployment"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: myapp\n  labels:\n    app: myapp\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: myapp\n  template:\n    metadata:\n      labels:\n        app: myapp\n    spec:\n      containers:\n      - name: myapp\n        image: myapp:1.0.0\n        ports:\n        - containerPort: 8080\n        env:\n        - name: SPRING_PROFILES_ACTIVE\n          value: "prod"\n        - name: SPRING_DATASOURCE_URL\n          valueFrom:\n            secretKeyRef:\n              name: db-secret\n              key: url\n        resources:\n          requests:\n            memory: "256Mi"\n            cpu: "250m"\n          limits:\n            memory: "512Mi"\n            cpu: "500m"\n        livenessProbe:\n          httpGet:\n            path: /actuator/health/liveness\n            port: 8080\n          initialDelaySeconds: 60\n          periodSeconds: 10\n        readinessProbe:\n          httpGet:\n            path: /actuator/health/readiness\n            port: 8080\n          initialDelaySeconds: 30\n          periodSeconds: 5\n'})}),"\n",(0,i.jsx)(e.h3,{id:"service",children:"Service"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: myapp-service\nspec:\n  selector:\n    app: myapp\n  ports:\n  - protocol: TCP\n    port: 80\n    targetPort: 8080\n  type: LoadBalancer\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.p,{children:["[!TIP]\n",(0,i.jsx)(e.strong,{children:"Docker \u5bb9\u5668\u5316\u6700\u4f73\u5b9e\u8df5"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4f7f\u7528\u591a\u9636\u6bb5\u6784\u5efa"})," - \u51cf\u5c0f\u955c\u50cf\u4f53\u79ef"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5206\u5c42\u6784\u5efa"})," - \u5229\u7528 Docker \u7f13\u5b58\u52a0\u901f\u6784\u5efa"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u975e root \u7528\u6237"})," - \u63d0\u9ad8\u5b89\u5168\u6027"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5065\u5eb7\u68c0\u67e5"})," - \u786e\u4fdd\u5bb9\u5668\u5065\u5eb7\u8fd0\u884c"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8d44\u6e90\u9650\u5236"})," - \u8bbe\u7f6e\u5185\u5b58\u548c CPU \u9650\u5236"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u65e5\u5fd7\u7ba1\u7406"})," - \u8f93\u51fa\u65e5\u5fd7\u5230\u6807\u51c6\u8f93\u51fa"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u73af\u5883\u53d8\u91cf"})," - \u4f7f\u7528\u73af\u5883\u53d8\u91cf\u914d\u7f6e"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Dockerfile"})," - \u5b9a\u4e49\u955c\u50cf\u6784\u5efa\u8fc7\u7a0b"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Docker Compose"})," - \u7ba1\u7406\u591a\u5bb9\u5668\u5e94\u7528"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u73af\u5883\u53d8\u91cf"})," - \u914d\u7f6e\u5bb9\u5668\u5316\u5e94\u7528"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Kubernetes"})," - \u751f\u4ea7\u73af\u5883\u5bb9\u5668\u7f16\u6392"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u4e0b\u4e00\u6b65\u5b66\u4e60 ",(0,i.jsx)(e.a,{href:"./file-upload",children:"\u6587\u4ef6\u4e0a\u4f20\u4e0b\u8f7d"}),"\u3002"]})]})}function p(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(c,{...n})}):c(n)}},48885:(n,e,r)=>{r.d(e,{R:()=>l,x:()=>a});var s=r(99378);const i={},o=s.createContext(i);function l(n){const e=s.useContext(o);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:l(n.components),s.createElement(o.Provider,{value:e},n.children)}}}]);
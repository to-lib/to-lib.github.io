"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[6233],{48885:(e,n,a)=>{a.d(n,{R:()=>r,x:()=>t});var c=a(99378);const i={},l=c.createContext(i);function r(e){const n=c.useContext(l);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),c.createElement(l.Provider,{value:n},e.children)}},79310:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>o});const c=JSON.parse('{"id":"rabbitmq/java-client","title":"Java \u5ba2\u6237\u7aef","description":"RabbitMQ Java \u5ba2\u6237\u7aef\uff08amqp-client\uff09\u8fde\u63a5\u3001\u53d1\u5e03\u3001\u6d88\u8d39\u4e0e\u786e\u8ba4","source":"@site/docs/rabbitmq/java-client.md","sourceDirName":"rabbitmq","slug":"/rabbitmq/java-client","permalink":"/docs/rabbitmq/java-client","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/rabbitmq/java-client.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Java \u5ba2\u6237\u7aef","description":"RabbitMQ Java \u5ba2\u6237\u7aef\uff08amqp-client\uff09\u8fde\u63a5\u3001\u53d1\u5e03\u3001\u6d88\u8d39\u4e0e\u786e\u8ba4"},"sidebar":"rabbitmq","previous":{"title":"\u5feb\u901f\u5f00\u59cb","permalink":"/docs/rabbitmq/quick-start"},"next":{"title":"\u751f\u4ea7\u8005\u6307\u5357","permalink":"/docs/rabbitmq/producer"}}');var i=a(22714),l=a(48885);const r={sidebar_position:6,title:"Java \u5ba2\u6237\u7aef",description:"RabbitMQ Java \u5ba2\u6237\u7aef\uff08amqp-client\uff09\u8fde\u63a5\u3001\u53d1\u5e03\u3001\u6d88\u8d39\u4e0e\u786e\u8ba4"},t="Java \u5ba2\u6237\u7aef",s={},o=[{value:"Maven \u4f9d\u8d56",id:"maven-\u4f9d\u8d56",level:2},{value:"\u8fde\u63a5\uff08Connection\uff09\u4e0e\u901a\u9053\uff08Channel\uff09",id:"\u8fde\u63a5connection\u4e0e\u901a\u9053channel",level:2},{value:"\u751f\u4ea7\u8005\uff1a\u53d1\u5e03\u786e\u8ba4\uff08Publisher Confirms\uff09",id:"\u751f\u4ea7\u8005\u53d1\u5e03\u786e\u8ba4publisher-confirms",level:2},{value:"mandatory / ReturnListener\uff08\u65e0\u6cd5\u8def\u7531\u65f6\u56de\u8c03\uff09",id:"mandatory--returnlistener\u65e0\u6cd5\u8def\u7531\u65f6\u56de\u8c03",level:2},{value:"\u6d88\u8d39\u8005\uff1a\u624b\u52a8\u786e\u8ba4\uff08Manual Ack\uff09",id:"\u6d88\u8d39\u8005\u624b\u52a8\u786e\u8ba4manual-ack",level:2},{value:"basicReject vs basicNack",id:"basicreject-vs-basicnack",level:2},{value:"Pull \u6a21\u5f0f\uff1abasicGet",id:"pull-\u6a21\u5f0fbasicget",level:2},{value:"\u5e38\u89c1\u5751",id:"\u5e38\u89c1\u5751",level:2},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"java-\u5ba2\u6237\u7aef",children:"Java \u5ba2\u6237\u7aef"})}),"\n",(0,i.jsxs)(n.p,{children:["\u672c\u6587\u805a\u7126 RabbitMQ Java \u539f\u751f\u5ba2\u6237\u7aef ",(0,i.jsx)(n.code,{children:"com.rabbitmq:amqp-client"}),"\uff08\u975e Spring\uff09\u3002\u5b83\u66f4\u8d34\u8fd1\u534f\u8bae\uff0c\u9002\u5408\u7406\u89e3\u5e95\u5c42\u884c\u4e3a\u4e0e\u6392\u969c\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"maven-\u4f9d\u8d56",children:"Maven \u4f9d\u8d56"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<dependency>\n  <groupId>com.rabbitmq</groupId>\n  <artifactId>amqp-client</artifactId>\n  <version>5.20.0</version>\n</dependency>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u8fde\u63a5connection\u4e0e\u901a\u9053channel",children:"\u8fde\u63a5\uff08Connection\uff09\u4e0e\u901a\u9053\uff08Channel\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'ConnectionFactory factory = new ConnectionFactory();\nfactory.setHost("localhost");\nfactory.setPort(5672);\nfactory.setUsername("guest");\nfactory.setPassword("guest");\nfactory.setVirtualHost("/");\n\nfactory.setRequestedHeartbeat(60);\nfactory.setConnectionTimeout(30_000);\nfactory.setAutomaticRecoveryEnabled(true);\n\ntry (Connection connection = factory.newConnection("java-client");\n     Channel channel = connection.createChannel()) {\n\n    channel.queueDeclare("q.demo", true, false, false, null);\n    channel.basicPublish("", "q.demo", null, "hello".getBytes());\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u751f\u4ea7\u8005\u53d1\u5e03\u786e\u8ba4publisher-confirms",children:"\u751f\u4ea7\u8005\uff1a\u53d1\u5e03\u786e\u8ba4\uff08Publisher Confirms\uff09"}),"\n",(0,i.jsx)(n.p,{children:"\u5efa\u8bae\u5728\u53ef\u9760\u6027\u8981\u6c42\u9ad8\u65f6\u5f00\u542f confirm\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'channel.confirmSelect();\nchannel.basicPublish("", "q.demo", null, "msg".getBytes());\nif (!channel.waitForConfirms(5_000)) {\n    throw new RuntimeException("publish not confirmed");\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u66f4\u9ad8\u541e\u5410\u5efa\u8bae\u4f7f\u7528\u5f02\u6b65 confirm\uff08\u89c1 ",(0,i.jsx)(n.code,{children:"producer"})," \u9875\u9762\uff09\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"mandatory--returnlistener\u65e0\u6cd5\u8def\u7531\u65f6\u56de\u8c03",children:"mandatory / ReturnListener\uff08\u65e0\u6cd5\u8def\u7531\u65f6\u56de\u8c03\uff09"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u6d88\u606f\u5230\u8fbe\u4ea4\u6362\u673a\u4f46\u65e0\u6cd5\u8def\u7531\u5230\u4efb\u4f55\u961f\u5217\u65f6\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'channel.addReturnListener((replyCode, replyText, exchange, routingKey, properties, body) -> {\n    System.err.println("Returned: " + replyText);\n});\n\nchannel.basicPublish("some.exchange", "no.such.key", true, null, "msg".getBytes());\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u53e6\u4e00\u79cd\u662f\u4f7f\u7528\u5907\u7528\u4ea4\u6362\u673a\uff08\u89c1 ",(0,i.jsx)(n.code,{children:"exchanges"}),"\uff09\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6d88\u8d39\u8005\u624b\u52a8\u786e\u8ba4manual-ack",children:"\u6d88\u8d39\u8005\uff1a\u624b\u52a8\u786e\u8ba4\uff08Manual Ack\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'channel.basicQos(10);\n\nDeliverCallback callback = (tag, delivery) -> {\n    long deliveryTag = delivery.getEnvelope().getDeliveryTag();\n    try {\n        // \u4e1a\u52a1\u5904\u7406\n        channel.basicAck(deliveryTag, false);\n    } catch (Exception e) {\n        // \u53ef\u9009\u62e9 requeue=true \u8fdb\u884c\u91cd\u8bd5\uff0c\u4f46\u8981\u907f\u514d\u6bd2\u4e38\u6d88\u606f\u65e0\u9650\u91cd\u8bd5\n        channel.basicNack(deliveryTag, false, false);\n    }\n};\n\nchannel.basicConsume("q.demo", false, callback, tag -> {});\n'})}),"\n",(0,i.jsx)(n.h2,{id:"basicreject-vs-basicnack",children:"basicReject vs basicNack"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"basicReject(tag, requeue)"}),"\uff1a\u5355\u6761\u62d2\u7edd"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"basicNack(tag, multiple, requeue)"}),"\uff1a\u53ef\u6279\u91cf\u62d2\u7edd"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u4e00\u822c\u7528 ",(0,i.jsx)(n.code,{children:"basicNack"})," \u66f4\u7075\u6d3b\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"pull-\u6a21\u5f0fbasicget",children:"Pull \u6a21\u5f0f\uff1abasicGet"}),"\n",(0,i.jsx)(n.p,{children:"\u4e0d\u63a8\u8350\u9ad8\u541e\u5410\u573a\u666f\uff0c\u4f46\u9002\u5408\u8c03\u8bd5\u6216\u4f4e\u9891\u4efb\u52a1\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'GetResponse resp = channel.basicGet("q.demo", false);\nif (resp != null) {\n    try {\n        // process\n        channel.basicAck(resp.getEnvelope().getDeliveryTag(), false);\n    } catch (Exception e) {\n        channel.basicNack(resp.getEnvelope().getDeliveryTag(), false, true);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5e38\u89c1\u5751",children:"\u5e38\u89c1\u5751"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Channel \u975e\u7ebf\u7a0b\u5b89\u5168"}),"\uff1a\u6bcf\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u72ec\u7acb Channel"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u8fde\u63a5\u6570\u8fc7\u591a"}),"\uff1a\u4f18\u5148\u590d\u7528 Connection\uff0c\u7528\u591a Channel"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u81ea\u52a8\u6062\u590d\u4e0d\u7b49\u4e8e\u4e1a\u52a1\u7ea7\u91cd\u8bd5"}),"\uff1a\u8fde\u63a5\u6062\u590d\u540e\u4ecd\u9700\u8003\u8651\u201c\u6d88\u606f\u662f\u5426\u91cd\u590d/\u662f\u5426\u4e22\u5931\u201d\u7684\u4e1a\u52a1\u8bed\u4e49"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\ud83d\udcbb ",(0,i.jsx)(n.a,{href:"/docs/rabbitmq/producer",children:"\u751f\u4ea7\u8005\u6307\u5357"})," - confirm/return/\u5e8f\u5217\u5316/\u91cd\u8bd5"]}),"\n",(0,i.jsxs)(n.li,{children:["\ud83d\udcca ",(0,i.jsx)(n.a,{href:"/docs/rabbitmq/consumer",children:"\u6d88\u8d39\u8005\u6307\u5357"})," - ack/nack/requeue\u3001\u9884\u53d6\u4e0e\u91cd\u8bd5"]}),"\n",(0,i.jsxs)(n.li,{children:["\ud83c\udfaf ",(0,i.jsx)(n.a,{href:"/docs/rabbitmq/core-concepts",children:"\u6838\u5fc3\u6982\u5ff5"})," - Connection/Channel/Queue/Exchange"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);
"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[1],{48885:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var l=s(99378);const i={},r=l.createContext(i);function t(e){const n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),l.createElement(r.Provider,{value:n},e.children)}},75001:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>a});const l=JSON.parse('{"id":"rocketmq/performance-optimization","title":"\u6027\u80fd\u4f18\u5316","description":"RocketMQ \u6027\u80fd\u8c03\u4f18\u6307\u5357","source":"@site/docs/rocketmq/performance-optimization.md","sourceDirName":"rocketmq","slug":"/rocketmq/performance-optimization","permalink":"/docs/rocketmq/performance-optimization","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/rocketmq/performance-optimization.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_position":13,"title":"\u6027\u80fd\u4f18\u5316","description":"RocketMQ \u6027\u80fd\u8c03\u4f18\u6307\u5357"},"sidebar":"rocketmq","previous":{"title":"\u96c6\u7fa4\u7ba1\u7406","permalink":"/docs/rocketmq/cluster-management"},"next":{"title":"\u6700\u4f73\u5b9e\u8df5","permalink":"/docs/rocketmq/best-practices"}}');var i=s(22714),r=s(48885);const t={sidebar_position:13,title:"\u6027\u80fd\u4f18\u5316",description:"RocketMQ \u6027\u80fd\u8c03\u4f18\u6307\u5357"},c="RocketMQ \u6027\u80fd\u4f18\u5316",d={},a=[{value:"\u6027\u80fd\u6307\u6807",id:"\u6027\u80fd\u6307\u6807",level:2},{value:"\u5173\u952e\u6307\u6807",id:"\u5173\u952e\u6307\u6807",level:3},{value:"\u6027\u80fd\u6d4b\u8bd5\u5de5\u5177",id:"\u6027\u80fd\u6d4b\u8bd5\u5de5\u5177",level:3},{value:"\u53d1\u9001\u7aef\u4f18\u5316",id:"\u53d1\u9001\u7aef\u4f18\u5316",level:2},{value:"1. \u4f7f\u7528\u5f02\u6b65\u53d1\u9001",id:"1-\u4f7f\u7528\u5f02\u6b65\u53d1\u9001",level:3},{value:"2. \u6279\u91cf\u53d1\u9001",id:"2-\u6279\u91cf\u53d1\u9001",level:3},{value:"3. \u6d88\u606f\u538b\u7f29",id:"3-\u6d88\u606f\u538b\u7f29",level:3},{value:"4. \u591a\u7ebf\u7a0b\u53d1\u9001",id:"4-\u591a\u7ebf\u7a0b\u53d1\u9001",level:3},{value:"5. \u9884\u70ed\u8fde\u63a5",id:"5-\u9884\u70ed\u8fde\u63a5",level:3},{value:"\u53d1\u9001\u7aef\u53c2\u6570\u8c03\u4f18",id:"\u53d1\u9001\u7aef\u53c2\u6570\u8c03\u4f18",level:3},{value:"\u6d88\u8d39\u7aef\u4f18\u5316",id:"\u6d88\u8d39\u7aef\u4f18\u5316",level:2},{value:"1. \u589e\u52a0\u6d88\u8d39\u7ebf\u7a0b",id:"1-\u589e\u52a0\u6d88\u8d39\u7ebf\u7a0b",level:3},{value:"2. \u6279\u91cf\u6d88\u8d39",id:"2-\u6279\u91cf\u6d88\u8d39",level:3},{value:"3. \u5e76\u884c\u6d88\u8d39\u591a\u4e2a Queue",id:"3-\u5e76\u884c\u6d88\u8d39\u591a\u4e2a-queue",level:3},{value:"4. \u5f02\u6b65\u5904\u7406\u8017\u65f6\u64cd\u4f5c",id:"4-\u5f02\u6b65\u5904\u7406\u8017\u65f6\u64cd\u4f5c",level:3},{value:"5. Pull \u6a21\u5f0f\u7cbe\u7ec6\u63a7\u5236",id:"5-pull-\u6a21\u5f0f\u7cbe\u7ec6\u63a7\u5236",level:3},{value:"\u6d88\u8d39\u7aef\u53c2\u6570\u8c03\u4f18",id:"\u6d88\u8d39\u7aef\u53c2\u6570\u8c03\u4f18",level:3},{value:"Broker \u4f18\u5316",id:"broker-\u4f18\u5316",level:2},{value:"\u5b58\u50a8\u53c2\u6570",id:"\u5b58\u50a8\u53c2\u6570",level:3},{value:"\u7ebf\u7a0b\u6c60\u53c2\u6570",id:"\u7ebf\u7a0b\u6c60\u53c2\u6570",level:3},{value:"\u5185\u5b58\u53c2\u6570",id:"\u5185\u5b58\u53c2\u6570",level:3},{value:"JVM \u4f18\u5316",id:"jvm-\u4f18\u5316",level:2},{value:"\u751f\u4ea7\u73af\u5883 JVM \u53c2\u6570",id:"\u751f\u4ea7\u73af\u5883-jvm-\u53c2\u6570",level:3},{value:"\u5ba2\u6237\u7aef JVM \u53c2\u6570",id:"\u5ba2\u6237\u7aef-jvm-\u53c2\u6570",level:3},{value:"\u64cd\u4f5c\u7cfb\u7edf\u4f18\u5316",id:"\u64cd\u4f5c\u7cfb\u7edf\u4f18\u5316",level:2},{value:"Linux \u5185\u6838\u53c2\u6570",id:"linux-\u5185\u6838\u53c2\u6570",level:3},{value:"\u6587\u4ef6\u63cf\u8ff0\u7b26\u9650\u5236",id:"\u6587\u4ef6\u63cf\u8ff0\u7b26\u9650\u5236",level:3},{value:"\u78c1\u76d8 I/O \u4f18\u5316",id:"\u78c1\u76d8-io-\u4f18\u5316",level:3},{value:"\u7f51\u7edc\u4f18\u5316",id:"\u7f51\u7edc\u4f18\u5316",level:2},{value:"\u7f51\u7edc\u914d\u7f6e",id:"\u7f51\u7edc\u914d\u7f6e",level:3},{value:"\u5ba2\u6237\u7aef\u914d\u7f6e",id:"\u5ba2\u6237\u7aef\u914d\u7f6e",level:3},{value:"\u6027\u80fd\u5bf9\u6bd4",id:"\u6027\u80fd\u5bf9\u6bd4",level:2},{value:"\u5237\u76d8\u6a21\u5f0f\u5bf9\u6bd4",id:"\u5237\u76d8\u6a21\u5f0f\u5bf9\u6bd4",level:3},{value:"\u590d\u5236\u6a21\u5f0f\u5bf9\u6bd4",id:"\u590d\u5236\u6a21\u5f0f\u5bf9\u6bd4",level:3},{value:"\u53d1\u9001\u65b9\u5f0f\u5bf9\u6bd4",id:"\u53d1\u9001\u65b9\u5f0f\u5bf9\u6bd4",level:3},{value:"\u6027\u80fd\u8c03\u4f18\u6e05\u5355",id:"\u6027\u80fd\u8c03\u4f18\u6e05\u5355",level:2},{value:"\u53d1\u9001\u7aef",id:"\u53d1\u9001\u7aef",level:3},{value:"\u6d88\u8d39\u7aef",id:"\u6d88\u8d39\u7aef",level:3},{value:"Broker",id:"broker",level:3},{value:"\u7cfb\u7edf",id:"\u7cfb\u7edf",level:3},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"rocketmq-\u6027\u80fd\u4f18\u5316",children:"RocketMQ \u6027\u80fd\u4f18\u5316"})}),"\n",(0,i.jsx)(n.p,{children:"\u672c\u6587\u6863\u4ecb\u7ecd RocketMQ \u5404\u5c42\u9762\u7684\u6027\u80fd\u4f18\u5316\u7b56\u7565\uff0c\u5e2e\u52a9\u4f60\u63d0\u5347\u6d88\u606f\u7cfb\u7edf\u7684\u541e\u5410\u91cf\u548c\u964d\u4f4e\u5ef6\u8fdf\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u6027\u80fd\u6307\u6807",children:"\u6027\u80fd\u6307\u6807"}),"\n",(0,i.jsx)(n.h3,{id:"\u5173\u952e\u6307\u6807",children:"\u5173\u952e\u6307\u6807"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u6307\u6807"}),(0,i.jsx)(n.th,{children:"\u8bf4\u660e"}),(0,i.jsx)(n.th,{children:"\u53c2\u8003\u503c"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TPS"}),(0,i.jsx)(n.td,{children:"\u6bcf\u79d2\u6d88\u606f\u541e\u5410\u91cf"}),(0,i.jsx)(n.td,{children:"\u5355\u673a 10 \u4e07+"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u5ef6\u8fdf"}),(0,i.jsx)(n.td,{children:"\u6d88\u606f\u7aef\u5230\u7aef\u5ef6\u8fdf"}),(0,i.jsx)(n.td,{children:"\u6beb\u79d2\u7ea7"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u5806\u79ef"}),(0,i.jsx)(n.td,{children:"\u672a\u6d88\u8d39\u6d88\u606f\u6570\u91cf"}),(0,i.jsx)(n.td,{children:"\u8d8a\u5c0f\u8d8a\u597d"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u6210\u529f\u7387"}),(0,i.jsx)(n.td,{children:"\u53d1\u9001/\u6d88\u8d39\u6210\u529f\u7387"}),(0,i.jsx)(n.td,{children:"99.99%+"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\u6027\u80fd\u6d4b\u8bd5\u5de5\u5177",children:"\u6027\u80fd\u6d4b\u8bd5\u5de5\u5177"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# RocketMQ \u81ea\u5e26\u7684\u6027\u80fd\u6d4b\u8bd5\u5de5\u5177\n# \u751f\u4ea7\u8005\u6d4b\u8bd5\nsh bin/tools.sh org.apache.rocketmq.example.benchmark.Producer \\\n    -t BenchmarkTopic -w 64 -s 1024\n\n# \u6d88\u8d39\u8005\u6d4b\u8bd5\nsh bin/tools.sh org.apache.rocketmq.example.benchmark.Consumer \\\n    -t BenchmarkTopic -g BenchmarkConsumer\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u53d1\u9001\u7aef\u4f18\u5316",children:"\u53d1\u9001\u7aef\u4f18\u5316"}),"\n",(0,i.jsx)(n.h3,{id:"1-\u4f7f\u7528\u5f02\u6b65\u53d1\u9001",children:"1. \u4f7f\u7528\u5f02\u6b65\u53d1\u9001"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// \u2705 \u5f02\u6b65\u53d1\u9001\u63d0\u5347\u541e\u5410\u91cf\nCountDownLatch latch = new CountDownLatch(messageCount);\nfor (int i = 0; i < messageCount; i++) {\n    producer.send(msg, new SendCallback() {\n        @Override\n        public void onSuccess(SendResult result) {\n            latch.countDown();\n        }\n        @Override\n        public void onException(Throwable e) {\n            latch.countDown();\n            failedMessages.add(msg);\n        }\n    });\n}\nlatch.await();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-\u6279\u91cf\u53d1\u9001",children:"2. \u6279\u91cf\u53d1\u9001"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u2705 \u6279\u91cf\u53d1\u9001\u51cf\u5c11\u7f51\u7edc\u5f80\u8fd4\nList<Message> messages = new ArrayList<>();\nfor (int i = 0; i < 100; i++) {\n    messages.add(new Message("TopicTest", ("Message " + i).getBytes()));\n}\n\n// \u6ce8\u610f\uff1a\u603b\u5927\u5c0f\u4e0d\u8d85\u8fc7 4MB\nSendResult result = producer.send(messages);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"3-\u6d88\u606f\u538b\u7f29",children:"3. \u6d88\u606f\u538b\u7f29"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u5927\u4e8e 4KB \u81ea\u52a8\u538b\u7f29\nproducer.setCompressMsgBodyOverHowmuch(4096);\n\n// \u4e5f\u53ef\u4ee5\u624b\u52a8\u538b\u7f29\nbyte[] compressed = compress(body);\nMessage msg = new Message("TopicTest", compressed);\nmsg.putUserProperty("compressed", "true");\n'})}),"\n",(0,i.jsx)(n.h3,{id:"4-\u591a\u7ebf\u7a0b\u53d1\u9001",children:"4. \u591a\u7ebf\u7a0b\u53d1\u9001"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u4f7f\u7528\u7ebf\u7a0b\u6c60\u5e76\u53d1\u53d1\u9001\nExecutorService executor = Executors.newFixedThreadPool(\n    Runtime.getRuntime().availableProcessors() * 2);\n\nfor (Message msg : messages) {\n    executor.submit(() -> {\n        try {\n            producer.send(msg);\n        } catch (Exception e) {\n            log.error("\u53d1\u9001\u5931\u8d25", e);\n        }\n    });\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"5-\u9884\u70ed\u8fde\u63a5",children:"5. \u9884\u70ed\u8fde\u63a5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u542f\u52a8\u65f6\u9884\u70ed\nproducer.start();\n\n// \u53d1\u9001\u9884\u70ed\u6d88\u606f\nfor (int i = 0; i < 10; i++) {\n    Message warmupMsg = new Message("WarmupTopic", "warmup".getBytes());\n    try {\n        producer.send(warmupMsg, 1000);\n    } catch (Exception e) {\n        // \u5ffd\u7565\u9884\u70ed\u6d88\u606f\u5931\u8d25\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u53d1\u9001\u7aef\u53c2\u6570\u8c03\u4f18",children:"\u53d1\u9001\u7aef\u53c2\u6570\u8c03\u4f18"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// \u53d1\u9001\u8d85\u65f6\uff08\u6839\u636e\u7f51\u7edc\u60c5\u51b5\uff09\nproducer.setSendMsgTimeout(3000);\n\n// \u91cd\u8bd5\u6b21\u6570\uff08\u51cf\u5c11\u91cd\u8bd5\u63d0\u5347\u6027\u80fd\uff0c\u964d\u4f4e\u53ef\u9760\u6027\uff09\nproducer.setRetryTimesWhenSendFailed(1);\nproducer.setRetryTimesWhenSendAsyncFailed(1);\n\n// \u662f\u5426\u7b49\u5f85\u5b58\u50a8\u5b8c\u6210\n// SEND_OK: \u5237\u76d8+\u590d\u5236\u5b8c\u6210\n// SLAVE_NOT_AVAILABLE: \u53ea\u8981\u4e3b\u8282\u70b9\u6210\u529f\nproducer.setRetryAnotherBrokerWhenNotStoreOK(false);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6d88\u8d39\u7aef\u4f18\u5316",children:"\u6d88\u8d39\u7aef\u4f18\u5316"}),"\n",(0,i.jsx)(n.h3,{id:"1-\u589e\u52a0\u6d88\u8d39\u7ebf\u7a0b",children:"1. \u589e\u52a0\u6d88\u8d39\u7ebf\u7a0b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// \u6839\u636e\u4e1a\u52a1\u7c7b\u578b\u8c03\u6574\n// CPU \u5bc6\u96c6\u578b\uff1aCPU \u6838\u5fc3\u6570 + 1\n// IO \u5bc6\u96c6\u578b\uff1aCPU \u6838\u5fc3\u6570 * 2 \u6216\u66f4\u591a\nconsumer.setConsumeThreadMin(20);\nconsumer.setConsumeThreadMax(64);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-\u6279\u91cf\u6d88\u8d39",children:"2. \u6279\u91cf\u6d88\u8d39"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// \u6279\u91cf\u62c9\u53d6\nconsumer.setPullBatchSize(32);\n\n// \u6279\u91cf\u6d88\u8d39\nconsumer.setConsumeMessageBatchMaxSize(10);\n\nconsumer.registerMessageListener((MessageListenerConcurrently) (msgs, ctx) -> {\n    // \u6279\u91cf\u5904\u7406\n    List<Order> orders = msgs.stream()\n        .map(msg -> JSON.parseObject(msg.getBody(), Order.class))\n        .collect(Collectors.toList());\n\n    orderService.batchProcess(orders);\n    return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-\u5e76\u884c\u6d88\u8d39\u591a\u4e2a-queue",children:"3. \u5e76\u884c\u6d88\u8d39\u591a\u4e2a Queue"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// \u589e\u52a0 Topic \u7684 Queue \u6570\u91cf\n// Queue \u6570\u91cf >= \u6d88\u8d39\u8005\u5b9e\u4f8b\u6570 \xd7 \u6d88\u8d39\u7ebf\u7a0b\u6570\nsh bin/mqadmin updateTopic -n localhost:9876 -t TopicTest -r 16 -w 16\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-\u5f02\u6b65\u5904\u7406\u8017\u65f6\u64cd\u4f5c",children:"4. \u5f02\u6b65\u5904\u7406\u8017\u65f6\u64cd\u4f5c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// \u6d88\u8d39\u7aef\u5f02\u6b65\u5904\u7406\nExecutorService asyncExecutor = Executors.newFixedThreadPool(10);\n\nconsumer.registerMessageListener((MessageListenerConcurrently) (msgs, ctx) -> {\n    for (MessageExt msg : msgs) {\n        // \u5f02\u6b65\u5904\u7406\u8017\u65f6\u64cd\u4f5c\n        asyncExecutor.submit(() -> {\n            processWithExternalService(msg);\n        });\n    }\n    // \u7acb\u5373\u8fd4\u56de\u6210\u529f\uff0c\u5f02\u6b65\u5904\u7406\n    return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;\n});\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,i.jsx)(n.strong,{children:"\u6ce8\u610f\uff1a"})," \u5f02\u6b65\u5904\u7406\u9700\u8981\u81ea\u884c\u4fdd\u8bc1\u53ef\u9760\u6027\uff0c\u6d88\u606f\u53ef\u80fd\u4e22\u5931"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"5-pull-\u6a21\u5f0f\u7cbe\u7ec6\u63a7\u5236",children:"5. Pull \u6a21\u5f0f\u7cbe\u7ec6\u63a7\u5236"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'DefaultLitePullConsumer consumer = new DefaultLitePullConsumer("PullGroup");\nconsumer.subscribe("TopicTest", "*");\nconsumer.start();\n\nwhile (true) {\n    // \u63a7\u5236\u62c9\u53d6\u9891\u7387\u548c\u6570\u91cf\n    List<MessageExt> msgs = consumer.poll(1000);\n\n    if (msgs.isEmpty()) {\n        Thread.sleep(100);  // \u65e0\u6d88\u606f\u65f6\u4f11\u7720\n        continue;\n    }\n\n    // \u6279\u91cf\u5904\u7406\n    batchProcess(msgs);\n    consumer.commitSync();\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u6d88\u8d39\u7aef\u53c2\u6570\u8c03\u4f18",children:"\u6d88\u8d39\u7aef\u53c2\u6570\u8c03\u4f18"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// \u62c9\u53d6\u95f4\u9694\nconsumer.setPullInterval(0);  // 0 \u8868\u793a\u7acb\u5373\u62c9\u53d6\n\n// \u6bcf\u6b21\u62c9\u53d6\u6570\u91cf\nconsumer.setPullBatchSize(32);\n\n// \u6d88\u8d39\u8d85\u65f6\u65f6\u95f4\uff08\u5206\u949f\uff09\nconsumer.setConsumeTimeout(15);\n\n// \u6d88\u8d39\u8d77\u59cb\u4f4d\u7f6e\nconsumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_LAST_OFFSET);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"broker-\u4f18\u5316",children:"Broker \u4f18\u5316"}),"\n",(0,i.jsx)(n.h3,{id:"\u5b58\u50a8\u53c2\u6570",children:"\u5b58\u50a8\u53c2\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-properties",children:"# broker.conf\n\n# \u5f02\u6b65\u5237\u76d8\uff08\u6027\u80fd\u4f18\u5148\uff09\nflushDiskType=ASYNC_FLUSH\n\n# \u5237\u76d8\u95f4\u9694\uff08\u6beb\u79d2\uff09\nflushIntervalCommitLog=500\n\n# \u5f02\u6b65\u590d\u5236\uff08\u6027\u80fd\u4f18\u5148\uff09\nbrokerRole=ASYNC_MASTER\n\n# \u6d88\u606f\u5b58\u50a8\u8def\u5f84\uff08\u4f7f\u7528 SSD\uff09\nstorePathRootDir=/ssd/rocketmq/store\nstorePathCommitLog=/ssd/rocketmq/store/commitlog\n\n# CommitLog \u6587\u4ef6\u5927\u5c0f\uff08\u9ed8\u8ba4 1GB\uff09\nmapedFileSizeCommitLog=1073741824\n\n# ConsumeQueue \u6587\u4ef6\u5927\u5c0f\nmapedFileSizeConsumeQueue=6000000\n\n# \u542f\u7528 transientStorePool\uff08\u5806\u5916\u5185\u5b58\uff09\ntransientStorePoolEnable=true\ntransientStorePoolSize=5\n\n# \u9884\u5206\u914d MappedFile\nwarmMapedFileEnable=true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u7ebf\u7a0b\u6c60\u53c2\u6570",children:"\u7ebf\u7a0b\u6c60\u53c2\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-properties",children:"# \u53d1\u9001\u6d88\u606f\u7ebf\u7a0b\u6570\nsendMessageThreadPoolNums=16\n\n# \u62c9\u53d6\u6d88\u606f\u7ebf\u7a0b\u6570\npullMessageThreadPoolNums=32\n\n# \u67e5\u8be2\u6d88\u606f\u7ebf\u7a0b\u6570\nqueryMessageThreadPoolNums=8\n\n# \u5904\u7406 Consumer \u7ba1\u7406\u7ebf\u7a0b\u6570\nconsumerManageThreadPoolNums=32\n\n# \u5904\u7406\u5fc3\u8df3\u7ebf\u7a0b\u6570\nheartbeatThreadPoolNums=8\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5185\u5b58\u53c2\u6570",children:"\u5185\u5b58\u53c2\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-properties",children:"# \u6700\u5927\u53ef\u5b58\u50a8\u6d88\u606f\u6bd4\u4f8b\naccessMessageInMemoryMaxRatio=40\n\n# \u6e05\u7406\u8fc7\u671f\u6587\u4ef6\u65f6\u95f4\uff08\u51cc\u6668 4 \u70b9\uff09\ndeleteWhen=04\n\n# \u6d88\u606f\u4fdd\u7559\u65f6\u95f4\uff08\u5c0f\u65f6\uff09\nfileReservedTime=72\n\n# \u78c1\u76d8\u4f7f\u7528\u9608\u503c\ndiskMaxUsedSpaceRatio=75\n"})}),"\n",(0,i.jsx)(n.h2,{id:"jvm-\u4f18\u5316",children:"JVM \u4f18\u5316"}),"\n",(0,i.jsx)(n.h3,{id:"\u751f\u4ea7\u73af\u5883-jvm-\u53c2\u6570",children:"\u751f\u4ea7\u73af\u5883 JVM \u53c2\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# runbroker.sh \u4fee\u6539\n\n# \u5806\u5185\u5b58\uff08\u6839\u636e\u7269\u7406\u5185\u5b58\u8c03\u6574\uff09\nJAVA_OPT="${JAVA_OPT} -server -Xms16g -Xmx16g"\n\n# \u65b0\u751f\u4ee3\u5927\u5c0f\uff08\u5806\u5185\u5b58\u7684 1/3 ~ 1/2\uff09\nJAVA_OPT="${JAVA_OPT} -Xmn8g"\n\n# \u6c38\u4e45\u4ee3/\u5143\u7a7a\u95f4\nJAVA_OPT="${JAVA_OPT} -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m"\n\n# GC \u53c2\u6570\uff08G1 \u5783\u573e\u6536\u96c6\u5668\uff09\nJAVA_OPT="${JAVA_OPT} -XX:+UseG1GC"\nJAVA_OPT="${JAVA_OPT} -XX:MaxGCPauseMillis=100"\nJAVA_OPT="${JAVA_OPT} -XX:InitiatingHeapOccupancyPercent=45"\n\n# GC \u65e5\u5fd7\nJAVA_OPT="${JAVA_OPT} -Xlog:gc*:file=/var/log/rocketmq/gc.log:time,uptime:filecount=5,filesize=100M"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u5ba2\u6237\u7aef-jvm-\u53c2\u6570",children:"\u5ba2\u6237\u7aef JVM \u53c2\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u751f\u4ea7\u8005/\u6d88\u8d39\u8005\u5e94\u7528\n\n# \u9002\u5f53\u7684\u5806\u5185\u5b58\n-Xms4g -Xmx4g\n\n# G1 \u5783\u573e\u6536\u96c6\u5668\n-XX:+UseG1GC\n-XX:MaxGCPauseMillis=50\n\n# \u51cf\u5c11 GC \u65e5\u5fd7\n-Xlog:gc:file=/var/log/app/gc.log:time\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u64cd\u4f5c\u7cfb\u7edf\u4f18\u5316",children:"\u64cd\u4f5c\u7cfb\u7edf\u4f18\u5316"}),"\n",(0,i.jsx)(n.h3,{id:"linux-\u5185\u6838\u53c2\u6570",children:"Linux \u5185\u6838\u53c2\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# /etc/sysctl.conf\n\n# \u6587\u4ef6\u63cf\u8ff0\u7b26\u9650\u5236\nfs.file-max = 1000000\n\n# \u7f51\u7edc\u53c2\u6570\nnet.core.somaxconn = 65535\nnet.core.netdev_max_backlog = 65535\n\n# TCP \u53c2\u6570\nnet.ipv4.tcp_max_syn_backlog = 65535\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_tw_recycle = 0\nnet.ipv4.tcp_fin_timeout = 10\nnet.ipv4.tcp_keepalive_time = 600\nnet.ipv4.tcp_max_tw_buckets = 500000\n\n# \u5185\u5b58\u53c2\u6570\nvm.swappiness = 10\nvm.max_map_count = 655360\nvm.dirty_ratio = 40\nvm.dirty_background_ratio = 10\n\n# \u5e94\u7528\u914d\u7f6e\nsysctl -p\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u6587\u4ef6\u63cf\u8ff0\u7b26\u9650\u5236",children:"\u6587\u4ef6\u63cf\u8ff0\u7b26\u9650\u5236"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# /etc/security/limits.conf\n* soft nofile 655360\n* hard nofile 655360\n* soft nproc 655360\n* hard nproc 655360\n\n# \u751f\u6548\nulimit -n 655360\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u78c1\u76d8-io-\u4f18\u5316",children:"\u78c1\u76d8 I/O \u4f18\u5316"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u4f7f\u7528 SSD\n# \u6302\u8f7d\u53c2\u6570\nmount -o noatime,nodiratime /dev/sdb1 /data/rocketmq\n\n# I/O \u8c03\u5ea6\u5668\uff08SSD \u4f7f\u7528 noop/none\uff09\necho noop > /sys/block/sda/queue/scheduler\n\n# \u9884\u8bfb\u53d6\u5927\u5c0f\nblockdev --setra 16384 /dev/sda\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u7f51\u7edc\u4f18\u5316",children:"\u7f51\u7edc\u4f18\u5316"}),"\n",(0,i.jsx)(n.h3,{id:"\u7f51\u7edc\u914d\u7f6e",children:"\u7f51\u7edc\u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u589e\u52a0\u7f13\u51b2\u533a\u5927\u5c0f\nnet.core.rmem_max = 16777216\nnet.core.wmem_max = 16777216\nnet.core.rmem_default = 1048576\nnet.core.wmem_default = 1048576\n\n# TCP \u7f13\u51b2\u533a\nnet.ipv4.tcp_rmem = 4096 1048576 16777216\nnet.ipv4.tcp_wmem = 4096 1048576 16777216\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5ba2\u6237\u7aef\u914d\u7f6e",children:"\u5ba2\u6237\u7aef\u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u4f7f\u7528 VIP \u901a\u9053\nSystem.setProperty(MixAll.SEND_MESSAGE_WITH_VIP_CHANNEL_PROPERTY, "true");\n\n// \u8fde\u63a5\u8d85\u65f6\nproducer.setVipChannelEnabled(true);\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u6027\u80fd\u5bf9\u6bd4",children:"\u6027\u80fd\u5bf9\u6bd4"}),"\n",(0,i.jsx)(n.h3,{id:"\u5237\u76d8\u6a21\u5f0f\u5bf9\u6bd4",children:"\u5237\u76d8\u6a21\u5f0f\u5bf9\u6bd4"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u6a21\u5f0f"}),(0,i.jsx)(n.th,{children:"TPS"}),(0,i.jsx)(n.th,{children:"\u5ef6\u8fdf"}),(0,i.jsx)(n.th,{children:"\u53ef\u9760\u6027"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u540c\u6b65\u5237\u76d8"}),(0,i.jsx)(n.td,{children:"5 \u4e07"}),(0,i.jsx)(n.td,{children:"10ms+"}),(0,i.jsx)(n.td,{children:"\u9ad8"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u5f02\u6b65\u5237\u76d8"}),(0,i.jsx)(n.td,{children:"10 \u4e07+"}),(0,i.jsx)(n.td,{children:"1ms"}),(0,i.jsx)(n.td,{children:"\u4e2d"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\u590d\u5236\u6a21\u5f0f\u5bf9\u6bd4",children:"\u590d\u5236\u6a21\u5f0f\u5bf9\u6bd4"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u6a21\u5f0f"}),(0,i.jsx)(n.th,{children:"TPS"}),(0,i.jsx)(n.th,{children:"\u5ef6\u8fdf"}),(0,i.jsx)(n.th,{children:"\u53ef\u9760\u6027"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u540c\u6b65\u590d\u5236"}),(0,i.jsx)(n.td,{children:"8 \u4e07"}),(0,i.jsx)(n.td,{children:"5ms+"}),(0,i.jsx)(n.td,{children:"\u9ad8"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u5f02\u6b65\u590d\u5236"}),(0,i.jsx)(n.td,{children:"10 \u4e07+"}),(0,i.jsx)(n.td,{children:"1ms"}),(0,i.jsx)(n.td,{children:"\u4e2d"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\u53d1\u9001\u65b9\u5f0f\u5bf9\u6bd4",children:"\u53d1\u9001\u65b9\u5f0f\u5bf9\u6bd4"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u65b9\u5f0f"}),(0,i.jsx)(n.th,{children:"TPS"}),(0,i.jsx)(n.th,{children:"\u9002\u7528\u573a\u666f"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u540c\u6b65\u53d1\u9001"}),(0,i.jsx)(n.td,{children:"3 \u4e07"}),(0,i.jsx)(n.td,{children:"\u91cd\u8981\u6d88\u606f"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u5f02\u6b65\u53d1\u9001"}),(0,i.jsx)(n.td,{children:"10 \u4e07+"}),(0,i.jsx)(n.td,{children:"\u9ad8\u541e\u5410"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u5355\u5411\u53d1\u9001"}),(0,i.jsx)(n.td,{children:"15 \u4e07+"}),(0,i.jsx)(n.td,{children:"\u65e5\u5fd7\u7c7b"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"\u6027\u80fd\u8c03\u4f18\u6e05\u5355",children:"\u6027\u80fd\u8c03\u4f18\u6e05\u5355"}),"\n",(0,i.jsx)(n.h3,{id:"\u53d1\u9001\u7aef",children:"\u53d1\u9001\u7aef"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u4f7f\u7528\u5f02\u6b65\u53d1\u9001"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5f00\u542f\u6279\u91cf\u53d1\u9001"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5408\u7406\u8bbe\u7f6e\u91cd\u8bd5\u6b21\u6570"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u591a\u7ebf\u7a0b\u5e76\u53d1\u53d1\u9001"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u6d88\u606f\u5927\u5c0f\u63a7\u5236\u5728 1MB \u4ee5\u5185"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u6d88\u8d39\u7aef",children:"\u6d88\u8d39\u7aef"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u589e\u52a0\u6d88\u8d39\u7ebf\u7a0b\u6570"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u6279\u91cf\u62c9\u53d6\u548c\u6d88\u8d39"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Queue \u6570\u91cf >= \u6d88\u8d39\u8005\u6570"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5f02\u6b65\u5904\u7406\u8017\u65f6\u64cd\u4f5c"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5b9e\u73b0\u6d88\u8d39\u5e42\u7b49"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"broker",children:"Broker"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u4f7f\u7528 SSD \u5b58\u50a8"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5f02\u6b65\u5237\u76d8\uff08\u975e\u91d1\u878d\u573a\u666f\uff09"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u8c03\u6574\u7ebf\u7a0b\u6c60\u53c2\u6570"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5f00\u542f transientStorePool"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5408\u7406\u8bbe\u7f6e\u5185\u5b58\u53c2\u6570"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u7cfb\u7edf",children:"\u7cfb\u7edf"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u8c03\u6574\u6587\u4ef6\u63cf\u8ff0\u7b26\u9650\u5236"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u4f18\u5316\u7f51\u7edc\u53c2\u6570"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u4f7f\u7528 G1/ZGC \u5783\u573e\u6536\u96c6\u5668"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5173\u95ed swap"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\ud83d\udcca ",(0,i.jsx)(n.a,{href:"/docs/rocketmq/monitoring",children:"\u76d1\u63a7\u8fd0\u7ef4"})," - \u5efa\u8bbe\u76d1\u63a7\u4f53\u7cfb"]}),"\n",(0,i.jsxs)(n.li,{children:["\ud83c\udfd7\ufe0f ",(0,i.jsx)(n.a,{href:"/docs/rocketmq/cluster-management",children:"\u96c6\u7fa4\u7ba1\u7406"})," - \u96c6\u7fa4\u90e8\u7f72\u4e0e\u8fd0\u7ef4"]}),"\n",(0,i.jsxs)(n.li,{children:["\u2705 ",(0,i.jsx)(n.a,{href:"/docs/rocketmq/best-practices",children:"\u6700\u4f73\u5b9e\u8df5"})," - \u751f\u4ea7\u73af\u5883\u5b9e\u8df5"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://rocketmq.apache.org/docs/bestPractice/",children:"RocketMQ \u6027\u80fd\u8c03\u4f18"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://rocketmq.apache.org/docs/benchmark/",children:"RocketMQ \u5b98\u65b9 Benchmark"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);
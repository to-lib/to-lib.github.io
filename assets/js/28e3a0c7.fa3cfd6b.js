"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[16032],{48885:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>a});var i=s(99378);const c={},l=i.createContext(c);function r(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:r(e.components),i.createElement(l.Provider,{value:n},e.children)}},54185:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>o,frontMatter:()=>r,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"ffmpeg/encoding-parameters","title":"\u7f16\u7801\u53c2\u6570\u4e0e\u7801\u63a7","description":"CRF/ABR/2pass\u3001GOP\u3001\u50cf\u7d20\u683c\u5f0f\u3001faststart \u7b49\u5e38\u7528\u7f16\u7801\u7b56\u7565","source":"@site/docs/ffmpeg/encoding-parameters.md","sourceDirName":"ffmpeg","slug":"/ffmpeg/encoding-parameters","permalink":"/docs/ffmpeg/encoding-parameters","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/ffmpeg/encoding-parameters.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_position":13,"title":"\u7f16\u7801\u53c2\u6570\u4e0e\u7801\u63a7","description":"CRF/ABR/2pass\u3001GOP\u3001\u50cf\u7d20\u683c\u5f0f\u3001faststart \u7b49\u5e38\u7528\u7f16\u7801\u7b56\u7565"},"sidebar":"ffmpeg","previous":{"title":"\u97f3\u9891\u5904\u7406","permalink":"/docs/ffmpeg/audio-processing"},"next":{"title":"\u62fc\u63a5\u4e0e\u5207\u7247","permalink":"/docs/ffmpeg/concat-and-split"}}');var c=s(22714),l=s(48885);const r={sidebar_position:13,title:"\u7f16\u7801\u53c2\u6570\u4e0e\u7801\u63a7",description:"CRF/ABR/2pass\u3001GOP\u3001\u50cf\u7d20\u683c\u5f0f\u3001faststart \u7b49\u5e38\u7528\u7f16\u7801\u7b56\u7565"},a="\u7f16\u7801\u53c2\u6570\u4e0e\u7801\u63a7",d={},t=[{value:"\u8d28\u91cf\u4f18\u5148\uff1aCRF\uff08\u63a8\u8350\uff09",id:"\u8d28\u91cf\u4f18\u5148crf\u63a8\u8350",level:2},{value:"\u7801\u7387\u4f18\u5148\uff1aABR / CBR",id:"\u7801\u7387\u4f18\u5148abr--cbr",level:2},{value:"\u76ee\u6807\u7801\u7387",id:"\u76ee\u6807\u7801\u7387",level:3},{value:"\u4e24\u904d\u7f16\u7801\uff082-pass\uff09",id:"\u4e24\u904d\u7f16\u78012-pass",level:3},{value:"GOP \u4e0e\u5173\u952e\u5e27",id:"gop-\u4e0e\u5173\u952e\u5e27",level:2},{value:"\u50cf\u7d20\u683c\u5f0f\u4e0e\u517c\u5bb9\u6027",id:"\u50cf\u7d20\u683c\u5f0f\u4e0e\u517c\u5bb9\u6027",level:2},{value:"Web \u5206\u53d1\uff1afaststart",id:"web-\u5206\u53d1faststart",level:2},{value:"\u5206\u8fa8\u7387/\u5e27\u7387\u4e0e\u4f53\u79ef",id:"\u5206\u8fa8\u7387\u5e27\u7387\u4e0e\u4f53\u79ef",level:2},{value:"\u97f3\u9891\u53c2\u6570\u5efa\u8bae",id:"\u97f3\u9891\u53c2\u6570\u5efa\u8bae",level:2}];function p(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"\u7f16\u7801\u53c2\u6570\u4e0e\u7801\u63a7",children:"\u7f16\u7801\u53c2\u6570\u4e0e\u7801\u63a7"})}),"\n",(0,c.jsx)(n.p,{children:"\u8fd9\u9875\u805a\u7126\u201c\u600e\u4e48\u628a\u89c6\u9891\u538b\u5f97\u66f4\u5c0f\u3001\u540c\u65f6\u4fdd\u6301\u53ef\u63a5\u53d7\u753b\u8d28\u201d\uff0c\u4ee5\u53ca\u5206\u53d1\u5e38\u89c1\u517c\u5bb9\u6027\u53c2\u6570\u3002"}),"\n",(0,c.jsx)(n.h2,{id:"\u8d28\u91cf\u4f18\u5148crf\u63a8\u8350",children:"\u8d28\u91cf\u4f18\u5148\uff1aCRF\uff08\u63a8\u8350\uff09"}),"\n",(0,c.jsxs)(n.p,{children:["\u4ee5 ",(0,c.jsx)(n.code,{children:"libx264"})," \u4e3a\u4f8b\uff1a"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# \u5e38\u89c1\u901a\u7528\u914d\u7f6e\nffmpeg -i input.mp4 \\\n  -c:v libx264 -crf 23 -preset medium \\\n  -c:a aac -b:a 128k \\\n  out.mp4\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"-crf"}),"\uff1a0-51\uff0c\u8d8a\u5c0f\u8d28\u91cf\u8d8a\u597d\u3001\u4f53\u79ef\u8d8a\u5927"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"-preset"}),"\uff1a\u901f\u5ea6/\u538b\u7f29\u7387\u6743\u8861\uff0c\u8d8a\u6162\u538b\u5f97\u8d8a\u5c0f"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"\u5e38\u7528\u7ecf\u9a8c\uff1a"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\u89c6\u89c9\u65e0\u660e\u663e\u635f\u5931\uff1a",(0,c.jsx)(n.code,{children:"crf 18-20"})]}),"\n",(0,c.jsxs)(n.li,{children:["\u7efc\u5408\u5e73\u8861\uff1a",(0,c.jsx)(n.code,{children:"crf 21-24"})]}),"\n",(0,c.jsxs)(n.li,{children:["\u660e\u663e\u538b\u7f29\uff1a",(0,c.jsx)(n.code,{children:"crf 25-28"})]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"\u7801\u7387\u4f18\u5148abr--cbr",children:"\u7801\u7387\u4f18\u5148\uff1aABR / CBR"}),"\n",(0,c.jsx)(n.h3,{id:"\u76ee\u6807\u7801\u7387",children:"\u76ee\u6807\u7801\u7387"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"ffmpeg -i input.mp4 -c:v libx264 -b:v 2M -maxrate 2.5M -bufsize 5M -c:a aac -b:a 128k out.mp4\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"-b:v"}),"\uff1a\u5e73\u5747\u76ee\u6807\u7801\u7387"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"-maxrate"})," / ",(0,c.jsx)(n.code,{children:"-bufsize"}),"\uff1aVBV\uff0c\u9650\u5236\u77ac\u65f6\u7801\u7387\uff0c\u9002\u5408\u76f4\u64ad/\u4e25\u683c\u5e26\u5bbd"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"\u4e24\u904d\u7f16\u78012-pass",children:"\u4e24\u904d\u7f16\u7801\uff082-pass\uff09"}),"\n",(0,c.jsx)(n.p,{children:"\u9002\u7528\u4e8e\uff1a\u7ed9\u5b9a\u6587\u4ef6\u5927\u5c0f/\u7801\u7387\u9884\u7b97\u65f6\u63d0\u5347\u8d28\u91cf\u3002"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# pass 1\nffmpeg -y -i input.mp4 -c:v libx264 -b:v 2M -pass 1 -an -f null /dev/null\n\n# pass 2\nffmpeg -i input.mp4 -c:v libx264 -b:v 2M -pass 2 -c:a aac -b:a 128k out.mp4\n"})}),"\n",(0,c.jsx)(n.h2,{id:"gop-\u4e0e\u5173\u952e\u5e27",children:"GOP \u4e0e\u5173\u952e\u5e27"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"-g"}),"\uff1a\u5173\u952e\u5e27\u95f4\u9694\uff08\u5355\u4f4d\uff1a\u5e27\uff09"]}),"\n",(0,c.jsx)(n.li,{children:"\u5bf9\u76f4\u64ad/\u5feb\u8fdb\u62d6\u52a8/\u5207\u7247\u90fd\u5f88\u91cd\u8981"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# 30fps \u4e0b\u6bcf 2 \u79d2\u4e00\u4e2a\u5173\u952e\u5e27\nffmpeg -i input.mp4 -c:v libx264 -g 60 -keyint_min 60 -sc_threshold 0 -c:a aac out.mp4\n"})}),"\n",(0,c.jsx)(n.h2,{id:"\u50cf\u7d20\u683c\u5f0f\u4e0e\u517c\u5bb9\u6027",children:"\u50cf\u7d20\u683c\u5f0f\u4e0e\u517c\u5bb9\u6027"}),"\n",(0,c.jsxs)(n.p,{children:["\u6700\u901a\u7528\u7684\u50cf\u7d20\u683c\u5f0f\u901a\u5e38\u662f ",(0,c.jsx)(n.code,{children:"yuv420p"}),"\u3002"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# \u5f3a\u5236 yuv420p\uff0c\u63d0\u5347\u8001\u8bbe\u5907\u517c\u5bb9\u6027\nffmpeg -i input.mp4 -c:v libx264 -pix_fmt yuv420p -c:a aac out.mp4\n"})}),"\n",(0,c.jsx)(n.h2,{id:"web-\u5206\u53d1faststart",children:"Web \u5206\u53d1\uff1afaststart"}),"\n",(0,c.jsx)(n.p,{children:"MP4 \u9ed8\u8ba4\u53ef\u80fd\u628a moov \u653e\u5728\u6587\u4ef6\u5c3e\uff0c\u5bfc\u81f4\u8fb9\u4e0b\u8fb9\u64ad\u4f53\u9a8c\u5dee\u3002"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"ffmpeg -i input.mp4 -c copy -movflags +faststart out.mp4\n"})}),"\n",(0,c.jsx)(n.h2,{id:"\u5206\u8fa8\u7387\u5e27\u7387\u4e0e\u4f53\u79ef",children:"\u5206\u8fa8\u7387/\u5e27\u7387\u4e0e\u4f53\u79ef"}),"\n",(0,c.jsxs)(n.p,{children:["\u964d\u4f4e\u5206\u8fa8\u7387\u901a\u5e38\u6bd4\u76f2\u76ee\u63d0\u9ad8 ",(0,c.jsx)(n.code,{children:"crf"})," \u66f4\u6709\u6548\u3002"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# \u964d\u5230 720p\nffmpeg -i input.mp4 -vf scale=-2:720 -c:v libx264 -crf 23 -preset medium -c:a aac out.mp4\n"})}),"\n",(0,c.jsx)(n.h2,{id:"\u97f3\u9891\u53c2\u6570\u5efa\u8bae",children:"\u97f3\u9891\u53c2\u6570\u5efa\u8bae"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\u4e00\u822c\u5206\u53d1\uff1aAAC ",(0,c.jsx)(n.code,{children:"128k"})," / ",(0,c.jsx)(n.code,{children:"160k"})]}),"\n",(0,c.jsxs)(n.li,{children:["\u8bed\u97f3\u4e3a\u4e3b\uff1a",(0,c.jsx)(n.code,{children:"96k"})," \u4e5f\u53ef"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"ffmpeg -i input.mp4 -c:v libx264 -crf 23 -preset medium -c:a aac -b:a 128k out.mp4\n"})})]})}function o(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(p,{...e})}):p(e)}}}]);
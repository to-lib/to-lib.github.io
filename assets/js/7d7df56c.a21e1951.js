"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[95581],{8424:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>o,frontMatter:()=>r,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"c/c-cpp-interop","title":"C \u4e0e C++ \u4e92\u64cd\u4f5c","description":"C \u548c C++ \u53ef\u4ee5\u5f88\u597d\u5730\u534f\u540c\u5de5\u4f5c\uff0c\u4e86\u89e3\u5982\u4f55\u6b63\u786e\u6df7\u5408\u4f7f\u7528\u3002","source":"@site/docs/c/c-cpp-interop.md","sourceDirName":"c","slug":"/c/c-cpp-interop","permalink":"/docs/c/c-cpp-interop","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/c/c-cpp-interop.md","tags":[],"version":"current","sidebarPosition":24,"frontMatter":{"sidebar_position":24,"title":"C \u4e0e C++ \u4e92\u64cd\u4f5c"},"sidebar":"c","previous":{"title":"C11/C17 \u65b0\u7279\u6027","permalink":"/docs/c/c11-c17-features"},"next":{"title":"\u9879\u76ee\u5b9e\u6218","permalink":"/docs/c/practical-projects"}}');var c=i(22714),d=i(48885);const r={sidebar_position:24,title:"C \u4e0e C++ \u4e92\u64cd\u4f5c"},s="C \u4e0e C++ \u4e92\u64cd\u4f5c",l={},a=[{value:"extern &quot;C&quot; \u57fa\u7840",id:"extern-c-\u57fa\u7840",level:2},{value:"\u4e3a\u4ec0\u4e48\u9700\u8981 extern &quot;C&quot;",id:"\u4e3a\u4ec0\u4e48\u9700\u8981-extern-c",level:3},{value:"\u57fa\u672c\u7528\u6cd5",id:"\u57fa\u672c\u7528\u6cd5",level:3},{value:"\u4ece C++ \u8c03\u7528 C \u4ee3\u7801",id:"\u4ece-c-\u8c03\u7528-c-\u4ee3\u7801",level:2},{value:"C \u5e93\u5934\u6587\u4ef6 (math_utils.h)",id:"c-\u5e93\u5934\u6587\u4ef6-math_utilsh",level:3},{value:"C \u5b9e\u73b0 (math_utils.c)",id:"c-\u5b9e\u73b0-math_utilsc",level:3},{value:"C++ \u4f7f\u7528 (main.cpp)",id:"c-\u4f7f\u7528-maincpp",level:3},{value:"\u7f16\u8bd1",id:"\u7f16\u8bd1",level:3},{value:"\u4ece C \u8c03\u7528 C++ \u4ee3\u7801",id:"\u4ece-c-\u8c03\u7528-c-\u4ee3\u7801-1",level:2},{value:"C++ \u5b9e\u73b0\u9700\u8981\u5305\u88c5",id:"c-\u5b9e\u73b0\u9700\u8981\u5305\u88c5",level:3},{value:"C++ \u5934\u6587\u4ef6 (string_utils.h)",id:"c-\u5934\u6587\u4ef6-string_utilsh",level:3},{value:"C \u4f7f\u7528 (main.c)",id:"c-\u4f7f\u7528-mainc",level:3},{value:"\u7f16\u8bd1",id:"\u7f16\u8bd1-1",level:3},{value:"C++ \u7c7b\u7684 C \u63a5\u53e3",id:"c-\u7c7b\u7684-c-\u63a5\u53e3",level:2},{value:"C++ \u7c7b",id:"c-\u7c7b",level:3},{value:"C \u4f7f\u7528",id:"c-\u4f7f\u7528",level:3},{value:"\u56de\u8c03\u51fd\u6570",id:"\u56de\u8c03\u51fd\u6570",level:2},{value:"C++ \u8c03\u7528\u5e26\u56de\u8c03\u7684 C \u51fd\u6570",id:"c-\u8c03\u7528\u5e26\u56de\u8c03\u7684-c-\u51fd\u6570",level:3},{value:"\u5e38\u89c1\u9677\u9631",id:"\u5e38\u89c1\u9677\u9631",level:2},{value:"1. \u5f02\u5e38\u5904\u7406",id:"1-\u5f02\u5e38\u5904\u7406",level:3},{value:"2. \u5185\u5b58\u7ba1\u7406",id:"2-\u5185\u5b58\u7ba1\u7406",level:3},{value:"3. \u7ed3\u6784\u4f53\u5bf9\u9f50",id:"3-\u7ed3\u6784\u4f53\u5bf9\u9f50",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2}];function h(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,d.R)(),...n.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(e.header,{children:(0,c.jsx)(e.h1,{id:"c-\u4e0e-c-\u4e92\u64cd\u4f5c",children:"C \u4e0e C++ \u4e92\u64cd\u4f5c"})}),"\n",(0,c.jsx)(e.p,{children:"C \u548c C++ \u53ef\u4ee5\u5f88\u597d\u5730\u534f\u540c\u5de5\u4f5c\uff0c\u4e86\u89e3\u5982\u4f55\u6b63\u786e\u6df7\u5408\u4f7f\u7528\u3002"}),"\n",(0,c.jsx)(e.h2,{id:"extern-c-\u57fa\u7840",children:'extern "C" \u57fa\u7840'}),"\n",(0,c.jsx)(e.h3,{id:"\u4e3a\u4ec0\u4e48\u9700\u8981-extern-c",children:'\u4e3a\u4ec0\u4e48\u9700\u8981 extern "C"'}),"\n",(0,c.jsx)(e.p,{children:"C++ \u4f7f\u7528\u540d\u79f0\u4fee\u9970\uff08name mangling\uff09\u652f\u6301\u51fd\u6570\u91cd\u8f7d\uff1a"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-cpp",children:"// C++ \u4e2d add(int, int) \u53ef\u80fd\u88ab\u7f16\u8bd1\u4e3a _Z3addii\nint add(int a, int b);\nint add(double a, double b);\n\n// C \u4e2d\u6ca1\u6709\u540d\u79f0\u4fee\u9970\uff0cadd \u5c31\u662f add\n"})}),"\n",(0,c.jsxs)(e.p,{children:[(0,c.jsx)(e.code,{children:'extern "C"'})," \u544a\u8bc9 C++ \u7f16\u8bd1\u5668\u4f7f\u7528 C \u8bed\u8a00\u7684\u94fe\u63a5\u7ea6\u5b9a\u3002"]}),"\n",(0,c.jsx)(e.h3,{id:"\u57fa\u672c\u7528\u6cd5",children:"\u57fa\u672c\u7528\u6cd5"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-cpp",children:'// \u5728 C++ \u4e2d\u58f0\u660e C \u51fd\u6570\nextern "C" {\n    int c_function(int x);\n    void another_c_func(void);\n}\n\n// \u6216\u8005\u5355\u4e2a\u51fd\u6570\nextern "C" int c_function(int x);\n'})}),"\n",(0,c.jsx)(e.h2,{id:"\u4ece-c-\u8c03\u7528-c-\u4ee3\u7801",children:"\u4ece C++ \u8c03\u7528 C \u4ee3\u7801"}),"\n",(0,c.jsx)(e.h3,{id:"c-\u5e93\u5934\u6587\u4ef6-math_utilsh",children:"C \u5e93\u5934\u6587\u4ef6 (math_utils.h)"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-c",children:'#ifndef MATH_UTILS_H\n#define MATH_UTILS_H\n\n#ifdef __cplusplus\nextern "C" {\n#endif\n\nint add(int a, int b);\nint subtract(int a, int b);\ndouble divide(double a, double b);\n\n#ifdef __cplusplus\n}\n#endif\n\n#endif\n'})}),"\n",(0,c.jsx)(e.h3,{id:"c-\u5b9e\u73b0-math_utilsc",children:"C \u5b9e\u73b0 (math_utils.c)"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-c",children:'#include "math_utils.h"\n\nint add(int a, int b) {\n    return a + b;\n}\n\nint subtract(int a, int b) {\n    return a - b;\n}\n\ndouble divide(double a, double b) {\n    return b != 0 ? a / b : 0;\n}\n'})}),"\n",(0,c.jsx)(e.h3,{id:"c-\u4f7f\u7528-maincpp",children:"C++ \u4f7f\u7528 (main.cpp)"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-cpp",children:'#include <iostream>\n#include "math_utils.h"\n\nint main() {\n    std::cout << "10 + 5 = " << add(10, 5) << std::endl;\n    std::cout << "10 / 3 = " << divide(10, 3) << std::endl;\n    return 0;\n}\n'})}),"\n",(0,c.jsx)(e.h3,{id:"\u7f16\u8bd1",children:"\u7f16\u8bd1"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"gcc -c math_utils.c -o math_utils.o\ng++ -c main.cpp -o main.o\ng++ math_utils.o main.o -o program\n"})}),"\n",(0,c.jsx)(e.h2,{id:"\u4ece-c-\u8c03\u7528-c-\u4ee3\u7801-1",children:"\u4ece C \u8c03\u7528 C++ \u4ee3\u7801"}),"\n",(0,c.jsx)(e.h3,{id:"c-\u5b9e\u73b0\u9700\u8981\u5305\u88c5",children:"C++ \u5b9e\u73b0\u9700\u8981\u5305\u88c5"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-cpp",children:'// string_utils.cpp\n#include <string>\n#include <cstring>\n\n// C++ \u5b9e\u73b0\nstd::string cpp_reverse(const std::string& s) {\n    return std::string(s.rbegin(), s.rend());\n}\n\n// C \u63a5\u53e3\u5305\u88c5\nextern "C" {\n    char* reverse_string(const char* s) {\n        std::string result = cpp_reverse(s);\n        char* ret = (char*)malloc(result.length() + 1);\n        strcpy(ret, result.c_str());\n        return ret;  // \u8c03\u7528\u8005\u8d1f\u8d23\u91ca\u653e\n    }\n\n    void free_string(char* s) {\n        free(s);\n    }\n}\n'})}),"\n",(0,c.jsx)(e.h3,{id:"c-\u5934\u6587\u4ef6-string_utilsh",children:"C++ \u5934\u6587\u4ef6 (string_utils.h)"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-c",children:'#ifndef STRING_UTILS_H\n#define STRING_UTILS_H\n\n#ifdef __cplusplus\nextern "C" {\n#endif\n\nchar* reverse_string(const char* s);\nvoid free_string(char* s);\n\n#ifdef __cplusplus\n}\n#endif\n\n#endif\n'})}),"\n",(0,c.jsx)(e.h3,{id:"c-\u4f7f\u7528-mainc",children:"C \u4f7f\u7528 (main.c)"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n#include "string_utils.h"\n\nint main(void) {\n    char* reversed = reverse_string("Hello");\n    printf("\u53cd\u8f6c: %s\\n", reversed);\n    free_string(reversed);\n    return 0;\n}\n'})}),"\n",(0,c.jsx)(e.h3,{id:"\u7f16\u8bd1-1",children:"\u7f16\u8bd1"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"g++ -c string_utils.cpp -o string_utils.o\ngcc -c main.c -o main.o\ng++ string_utils.o main.o -o program  # \u7528 g++ \u94fe\u63a5\n"})}),"\n",(0,c.jsx)(e.h2,{id:"c-\u7c7b\u7684-c-\u63a5\u53e3",children:"C++ \u7c7b\u7684 C \u63a5\u53e3"}),"\n",(0,c.jsx)(e.h3,{id:"c-\u7c7b",children:"C++ \u7c7b"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-cpp",children:'// widget.cpp\n#include <string>\n\nclass Widget {\npublic:\n    Widget(int id) : id_(id), name_("Widget") {}\n\n    void setName(const std::string& name) { name_ = name; }\n    std::string getName() const { return name_; }\n    int getId() const { return id_; }\n\nprivate:\n    int id_;\n    std::string name_;\n};\n\n// C \u63a5\u53e3\nextern "C" {\n    typedef void* WidgetHandle;\n\n    WidgetHandle widget_create(int id) {\n        return new Widget(id);\n    }\n\n    void widget_destroy(WidgetHandle h) {\n        delete static_cast<Widget*>(h);\n    }\n\n    void widget_set_name(WidgetHandle h, const char* name) {\n        static_cast<Widget*>(h)->setName(name);\n    }\n\n    const char* widget_get_name(WidgetHandle h) {\n        static Widget* w = static_cast<Widget*>(h);\n        static std::string name;\n        name = w->getName();\n        return name.c_str();\n    }\n\n    int widget_get_id(WidgetHandle h) {\n        return static_cast<Widget*>(h)->getId();\n    }\n}\n'})}),"\n",(0,c.jsx)(e.h3,{id:"c-\u4f7f\u7528",children:"C \u4f7f\u7528"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n\ntypedef void* WidgetHandle;\n\nWidgetHandle widget_create(int id);\nvoid widget_destroy(WidgetHandle h);\nvoid widget_set_name(WidgetHandle h, const char* name);\nconst char* widget_get_name(WidgetHandle h);\nint widget_get_id(WidgetHandle h);\n\nint main(void) {\n    WidgetHandle w = widget_create(42);\n    widget_set_name(w, "MyWidget");\n\n    printf("ID: %d\\n", widget_get_id(w));\n    printf("Name: %s\\n", widget_get_name(w));\n\n    widget_destroy(w);\n    return 0;\n}\n'})}),"\n",(0,c.jsx)(e.h2,{id:"\u56de\u8c03\u51fd\u6570",children:"\u56de\u8c03\u51fd\u6570"}),"\n",(0,c.jsx)(e.h3,{id:"c-\u8c03\u7528\u5e26\u56de\u8c03\u7684-c-\u51fd\u6570",children:"C++ \u8c03\u7528\u5e26\u56de\u8c03\u7684 C \u51fd\u6570"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-c",children:"// c_lib.h\ntypedef void (*Callback)(int result, void* user_data);\n\nvoid async_compute(int input, Callback cb, void* user_data);\n"})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-cpp",children:'// main.cpp\n#include <iostream>\nextern "C" {\n    #include "c_lib.h"\n}\n\nvoid my_callback(int result, void* user_data) {\n    int* counter = static_cast<int*>(user_data);\n    std::cout << "Result: " << result << std::endl;\n    (*counter)++;\n}\n\nint main() {\n    int counter = 0;\n    async_compute(42, my_callback, &counter);\n    return 0;\n}\n'})}),"\n",(0,c.jsx)(e.h2,{id:"\u5e38\u89c1\u9677\u9631",children:"\u5e38\u89c1\u9677\u9631"}),"\n",(0,c.jsx)(e.h3,{id:"1-\u5f02\u5e38\u5904\u7406",children:"1. \u5f02\u5e38\u5904\u7406"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-cpp",children:'// C++ \u5f02\u5e38\u4e0d\u80fd\u4f20\u9012\u5230 C \u4ee3\u7801\nextern "C" int safe_divide(int a, int b) {\n    try {\n        if (b == 0) throw std::runtime_error("\u9664\u96f6");\n        return a / b;\n    } catch (...) {\n        return 0;  // \u5fc5\u987b\u5728 C++ \u4fa7\u6355\u83b7\n    }\n}\n'})}),"\n",(0,c.jsx)(e.h3,{id:"2-\u5185\u5b58\u7ba1\u7406",children:"2. \u5185\u5b58\u7ba1\u7406"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-cpp",children:'// C++ new/delete \u548c C malloc/free \u4e0d\u80fd\u6df7\u7528\nextern "C" {\n    // \u9519\u8bef\n    char* create_string() {\n        return new char[100];  // C \u4ee3\u7801\u7528 free \u91ca\u653e\u4f1a\u51fa\u9519\n    }\n\n    // \u6b63\u786e\n    char* create_string() {\n        return (char*)malloc(100);\n    }\n}\n'})}),"\n",(0,c.jsx)(e.h3,{id:"3-\u7ed3\u6784\u4f53\u5bf9\u9f50",children:"3. \u7ed3\u6784\u4f53\u5bf9\u9f50"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-c",children:"// \u786e\u4fdd\u4e24\u8fb9\u4f7f\u7528\u76f8\u540c\u7684\u5bf9\u9f50\n#pragma pack(push, 1)\nstruct SharedData {\n    char type;\n    int value;\n};\n#pragma pack(pop)\n"})}),"\n",(0,c.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,c.jsxs)(e.ol,{children:["\n",(0,c.jsxs)(e.li,{children:[(0,c.jsxs)(e.strong,{children:["\u4f7f\u7528 ",(0,c.jsx)(e.code,{children:"#ifdef __cplusplus"})]})," \u4fdd\u62a4\u5934\u6587\u4ef6"]}),"\n",(0,c.jsx)(e.li,{children:(0,c.jsx)(e.strong,{children:"C++ \u5f02\u5e38\u4e0d\u80fd\u8de8\u8d8a C \u8fb9\u754c"})}),"\n",(0,c.jsx)(e.li,{children:(0,c.jsx)(e.strong,{children:"\u4f7f\u7528\u4e0d\u900f\u660e\u6307\u9488\uff08handle\uff09\u5c01\u88c5 C++ \u5bf9\u8c61"})}),"\n",(0,c.jsx)(e.li,{children:(0,c.jsx)(e.strong,{children:"\u7edf\u4e00\u5185\u5b58\u5206\u914d\u65b9\u5f0f"})}),"\n",(0,c.jsx)(e.li,{children:(0,c.jsxs)(e.strong,{children:["\u7528 ",(0,c.jsx)(e.code,{children:"g++"})," \u94fe\u63a5\u6df7\u5408\u4ee3\u7801"]})}),"\n"]}),"\n",(0,c.jsx)(e.p,{children:"\u8ba9 C \u548c C++ \u548c\u8c10\u5171\u5904\uff01\ud83e\udd1d"})]})}function o(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,c.jsx)(e,{...n,children:(0,c.jsx)(h,{...n})}):h(n)}},48885:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>s});var t=i(99378);const c={},d=t.createContext(c);function r(n){const e=t.useContext(d);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(c):n.components||c:r(n.components),t.createElement(d.Provider,{value:e},n.children)}}}]);
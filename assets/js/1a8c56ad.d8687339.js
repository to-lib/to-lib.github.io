"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[4420],{20667:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>o,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"rabbitmq/quick-reference","title":"\u5feb\u901f\u53c2\u8003","description":"RabbitMQ \u547d\u4ee4\u548c\u914d\u7f6e\u901f\u67e5","source":"@site/docs/rabbitmq/quick-reference.md","sourceDirName":"rabbitmq","slug":"/rabbitmq/quick-reference","permalink":"/docs/rabbitmq/quick-reference","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/rabbitmq/quick-reference.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_position":13,"title":"\u5feb\u901f\u53c2\u8003","description":"RabbitMQ \u547d\u4ee4\u548c\u914d\u7f6e\u901f\u67e5"},"sidebar":"rabbitmq","previous":{"title":"\u76d1\u63a7\u8fd0\u7ef4","permalink":"/docs/rabbitmq/monitoring"},"next":{"title":"\u5e38\u89c1\u95ee\u9898","permalink":"/docs/rabbitmq/faq"}}');var i=s(22714),l=s(48885);const t={sidebar_position:13,title:"\u5feb\u901f\u53c2\u8003",description:"RabbitMQ \u547d\u4ee4\u548c\u914d\u7f6e\u901f\u67e5"},a="RabbitMQ \u5feb\u901f\u53c2\u8003",c={},d=[{value:"\u670d\u52a1\u7ba1\u7406",id:"\u670d\u52a1\u7ba1\u7406",level:2},{value:"\u7528\u6237\u7ba1\u7406",id:"\u7528\u6237\u7ba1\u7406",level:2},{value:"\u961f\u5217\u7ba1\u7406",id:"\u961f\u5217\u7ba1\u7406",level:2},{value:"\u4ea4\u6362\u673a\u7ba1\u7406",id:"\u4ea4\u6362\u673a\u7ba1\u7406",level:2},{value:"\u8fde\u63a5\u7ba1\u7406",id:"\u8fde\u63a5\u7ba1\u7406",level:2},{value:"\u63d2\u4ef6\u7ba1\u7406",id:"\u63d2\u4ef6\u7ba1\u7406",level:2},{value:"\u7b56\u7565\u914d\u7f6e",id:"\u7b56\u7565\u914d\u7f6e",level:2},{value:"Java \u901f\u67e5",id:"java-\u901f\u67e5",level:2},{value:"\u8fde\u63a5",id:"\u8fde\u63a5",level:3},{value:"\u58f0\u660e",id:"\u58f0\u660e",level:3},{value:"\u53d1\u9001",id:"\u53d1\u9001",level:3},{value:"\u6d88\u8d39",id:"\u6d88\u8d39",level:3},{value:"\u786e\u8ba4",id:"\u786e\u8ba4",level:3},{value:"\u9ed8\u8ba4\u7aef\u53e3",id:"\u9ed8\u8ba4\u7aef\u53e3",level:2},{value:"\u5e38\u7528\u914d\u7f6e",id:"\u5e38\u7528\u914d\u7f6e",level:2},{value:"\u961f\u5217\u53c2\u6570",id:"\u961f\u5217\u53c2\u6570",level:2},{value:"Docker \u547d\u4ee4",id:"docker-\u547d\u4ee4",level:2},{value:"Spring Boot \u914d\u7f6e",id:"spring-boot-\u914d\u7f6e",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"rabbitmq-\u5feb\u901f\u53c2\u8003",children:"RabbitMQ \u5feb\u901f\u53c2\u8003"})}),"\n",(0,i.jsx)(n.h2,{id:"\u670d\u52a1\u7ba1\u7406",children:"\u670d\u52a1\u7ba1\u7406"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u542f\u52a8/\u505c\u6b62/\u91cd\u542f\nsudo systemctl start rabbitmq-server\nsudo systemctl stop rabbitmq-server\nsudo systemctl restart rabbitmq-server\n\n# \u72b6\u6001\u68c0\u67e5\nrabbitmqctl status\nrabbitmqctl cluster_status\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u7528\u6237\u7ba1\u7406",children:"\u7528\u6237\u7ba1\u7406"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# \u6dfb\u52a0\u7528\u6237\nrabbitmqctl add_user <user> <password>\n\n# \u5220\u9664\u7528\u6237\nrabbitmqctl delete_user <user>\n\n# \u4fee\u6539\u5bc6\u7801\nrabbitmqctl change_password <user> <new_password>\n\n# \u8bbe\u7f6e\u7ba1\u7406\u5458\nrabbitmqctl set_user_tags <user> administrator\n\n# \u8bbe\u7f6e\u6743\u9650\nrabbitmqctl set_permissions -p / <user> ".*" ".*" ".*"\n\n# \u67e5\u770b\u7528\u6237\nrabbitmqctl list_users\nrabbitmqctl list_permissions\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u961f\u5217\u7ba1\u7406",children:"\u961f\u5217\u7ba1\u7406"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u5217\u51fa\u961f\u5217\nrabbitmqctl list_queues\nrabbitmqctl list_queues name messages consumers\n\n# \u6e05\u7a7a\u961f\u5217\nrabbitmqctl purge_queue <queue>\n\n# \u5220\u9664\u961f\u5217\nrabbitmqctl delete_queue <queue>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u4ea4\u6362\u673a\u7ba1\u7406",children:"\u4ea4\u6362\u673a\u7ba1\u7406"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u5217\u51fa\u4ea4\u6362\u673a\nrabbitmqctl list_exchanges\n\n# \u5217\u51fa\u7ed1\u5b9a\nrabbitmqctl list_bindings\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u8fde\u63a5\u7ba1\u7406",children:"\u8fde\u63a5\u7ba1\u7406"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u5217\u51fa\u8fde\u63a5\nrabbitmqctl list_connections\n\n# \u5217\u51fa\u901a\u9053\nrabbitmqctl list_channels\n\n# \u5173\u95ed\u8fde\u63a5\nrabbitmqctl close_connection <name>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u63d2\u4ef6\u7ba1\u7406",children:"\u63d2\u4ef6\u7ba1\u7406"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u5217\u51fa\u63d2\u4ef6\nrabbitmq-plugins list\n\n# \u542f\u7528/\u7981\u7528\nrabbitmq-plugins enable rabbitmq_management\nrabbitmq-plugins disable rabbitmq_management\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u7b56\u7565\u914d\u7f6e",children:"\u7b56\u7565\u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# \u955c\u50cf\u961f\u5217\nrabbitmqctl set_policy ha-all ".*" \'{"ha-mode":"all"}\'\n\n# \u6d88\u606f TTL\nrabbitmqctl set_policy ttl ".*" \'{"message-ttl":60000}\'\n\n# \u5217\u51fa/\u5220\u9664\u7b56\u7565\nrabbitmqctl list_policies\nrabbitmqctl clear_policy <name>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"java-\u901f\u67e5",children:"Java \u901f\u67e5"}),"\n",(0,i.jsx)(n.h3,{id:"\u8fde\u63a5",children:"\u8fde\u63a5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'ConnectionFactory factory = new ConnectionFactory();\nfactory.setHost("localhost");\nfactory.setPort(5672);\nfactory.setUsername("guest");\nfactory.setPassword("guest");\nConnection connection = factory.newConnection();\nChannel channel = connection.createChannel();\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u58f0\u660e",children:"\u58f0\u660e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u961f\u5217\nchannel.queueDeclare("queue", true, false, false, null);\n\n// \u4ea4\u6362\u673a\nchannel.exchangeDeclare("exchange", "direct", true);\n\n// \u7ed1\u5b9a\nchannel.queueBind("queue", "exchange", "routing-key");\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u53d1\u9001",children:"\u53d1\u9001"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'channel.basicPublish("exchange", "key",\n    MessageProperties.PERSISTENT_TEXT_PLAIN,\n    message.getBytes());\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u6d88\u8d39",children:"\u6d88\u8d39"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'channel.basicQos(10);\nchannel.basicConsume("queue", false,\n    (tag, delivery) -> {\n        process(delivery.getBody());\n        channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);\n    },\n    tag -> {});\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u786e\u8ba4",children:"\u786e\u8ba4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// \u53d1\u5e03\u786e\u8ba4\nchannel.confirmSelect();\nchannel.waitForConfirms(5000);\n\n// \u6d88\u8d39\u786e\u8ba4\nchannel.basicAck(deliveryTag, false);\nchannel.basicNack(deliveryTag, false, true);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u9ed8\u8ba4\u7aef\u53e3",children:"\u9ed8\u8ba4\u7aef\u53e3"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u7aef\u53e3"}),(0,i.jsx)(n.th,{children:"\u7528\u9014"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5672"}),(0,i.jsx)(n.td,{children:"AMQP"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"15672"}),(0,i.jsx)(n.td,{children:"\u7ba1\u7406\u754c\u9762"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"25672"}),(0,i.jsx)(n.td,{children:"\u96c6\u7fa4\u901a\u4fe1"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"4369"}),(0,i.jsx)(n.td,{children:"epmd"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"15692"}),(0,i.jsx)(n.td,{children:"Prometheus"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"\u5e38\u7528\u914d\u7f6e",children:"\u5e38\u7528\u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",children:"# rabbitmq.conf\n\n# \u5185\u5b58\u9650\u5236\nvm_memory_high_watermark.relative = 0.6\n\n# \u78c1\u76d8\u9650\u5236\ndisk_free_limit.relative = 2.0\n\n# \u5fc3\u8df3\nheartbeat = 60\n\n# \u901a\u9053\u9650\u5236\nchannel_max = 2047\n\n# \u65e5\u5fd7\nlog.file.level = info\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u961f\u5217\u53c2\u6570",children:"\u961f\u5217\u53c2\u6570"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u53c2\u6570"}),(0,i.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"x-message-ttl"})}),(0,i.jsx)(n.td,{children:"\u6d88\u606f\u8fc7\u671f\u65f6\u95f4 (ms)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"x-expires"})}),(0,i.jsx)(n.td,{children:"\u961f\u5217\u8fc7\u671f\u65f6\u95f4 (ms)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"x-max-length"})}),(0,i.jsx)(n.td,{children:"\u6700\u5927\u6d88\u606f\u6570"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"x-max-length-bytes"})}),(0,i.jsx)(n.td,{children:"\u6700\u5927\u5b57\u8282\u6570"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"x-dead-letter-exchange"})}),(0,i.jsx)(n.td,{children:"\u6b7b\u4fe1\u4ea4\u6362\u673a"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"x-dead-letter-routing-key"})}),(0,i.jsx)(n.td,{children:"\u6b7b\u4fe1\u8def\u7531\u952e"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"x-max-priority"})}),(0,i.jsx)(n.td,{children:"\u6700\u5927\u4f18\u5148\u7ea7"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"x-queue-mode"})}),(0,i.jsx)(n.td,{children:"\u961f\u5217\u6a21\u5f0f (lazy)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"x-queue-type"})}),(0,i.jsx)(n.td,{children:"\u961f\u5217\u7c7b\u578b (quorum/stream)"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"docker-\u547d\u4ee4",children:"Docker \u547d\u4ee4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u542f\u52a8\ndocker run -d --name rabbitmq \\\n  -p 5672:5672 -p 15672:15672 \\\n  rabbitmq:3-management\n\n# \u67e5\u770b\u65e5\u5fd7\ndocker logs -f rabbitmq\n\n# \u8fdb\u5165\u5bb9\u5668\ndocker exec -it rabbitmq bash\n"})}),"\n",(0,i.jsx)(n.h2,{id:"spring-boot-\u914d\u7f6e",children:"Spring Boot \u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"spring:\n  rabbitmq:\n    host: localhost\n    port: 5672\n    username: guest\n    password: guest\n    virtual-host: /\n    listener:\n      simple:\n        prefetch: 10\n        acknowledge-mode: manual\n"})})]})}function o(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},48885:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var r=s(99378);const i={},l=r.createContext(i);function t(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);
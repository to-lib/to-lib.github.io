"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[3594],{580:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>c,toc:()=>d});const c=JSON.parse('{"id":"rust/smart-pointers","title":"\u667a\u80fd\u6307\u9488","description":"\u667a\u80fd\u6307\u9488\u662f\u62e5\u6709\u6570\u636e\u6240\u6709\u6743\u5e76\u63d0\u4f9b\u989d\u5916\u529f\u80fd\u7684\u6570\u636e\u7ed3\u6784\u3002","source":"@site/docs/rust/smart-pointers.md","sourceDirName":"rust","slug":"/rust/smart-pointers","permalink":"/docs/rust/smart-pointers","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/rust/smart-pointers.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"\u667a\u80fd\u6307\u9488"},"sidebar":"rust","previous":{"title":"\u5e76\u53d1\u7f16\u7a0b","permalink":"/docs/rust/concurrency"}}');var t=l(2714),s=l(1266);const r={sidebar_position:8,title:"\u667a\u80fd\u6307\u9488"},i="\u667a\u80fd\u6307\u9488",o={},d=[{value:"<code>Box&lt;T&gt;</code>",id:"boxt",level:2},{value:"\u57fa\u672c\u4f7f\u7528",id:"\u57fa\u672c\u4f7f\u7528",level:3},{value:"\u9012\u5f52\u7c7b\u578b",id:"\u9012\u5f52\u7c7b\u578b",level:3},{value:"<code>Rc&lt;T&gt;</code>",id:"rct",level:2},{value:"<code>RefCell&lt;T&gt;</code>",id:"refcellt",level:2},{value:"<code>Rc&lt;RefCell&lt;T&gt;&gt;</code>",id:"rcrefcellt",level:3},{value:"<code>Weak&lt;T&gt;</code>",id:"weakt",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\u667a\u80fd\u6307\u9488",children:"\u667a\u80fd\u6307\u9488"})}),"\n",(0,t.jsx)(n.p,{children:"\u667a\u80fd\u6307\u9488\u662f\u62e5\u6709\u6570\u636e\u6240\u6709\u6743\u5e76\u63d0\u4f9b\u989d\u5916\u529f\u80fd\u7684\u6570\u636e\u7ed3\u6784\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"boxt",children:(0,t.jsx)(n.code,{children:"Box<T>"})}),"\n",(0,t.jsx)(n.h3,{id:"\u57fa\u672c\u4f7f\u7528",children:"\u57fa\u672c\u4f7f\u7528"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:'fn main() {\n    let b = Box::new(5);\n    println!("b = {}", b);\n}  // b \u79bb\u5f00\u4f5c\u7528\u57df\uff0c\u5806\u4e0a\u7684\u6570\u636e\u88ab\u91ca\u653e\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u9012\u5f52\u7c7b\u578b",children:"\u9012\u5f52\u7c7b\u578b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:"enum List {\n    Cons(i32, Box<List>),\n    Nil,\n}\n\nuse List::{Cons, Nil};\n\nfn main() {\n    let list = Cons(1, Box::new(Cons(2, Box::new(Cons(3, Box::new(Nil))))));\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"rct",children:(0,t.jsx)(n.code,{children:"Rc<T>"})}),"\n",(0,t.jsx)(n.p,{children:"\u5f15\u7528\u8ba1\u6570\u667a\u80fd\u6307\u9488\uff0c\u5141\u8bb8\u591a\u4e2a\u6240\u6709\u8005\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:'use std::rc::Rc;\n\nenum List {\n    Cons(i32, Rc<List>),\n    Nil,\n}\n\nuse List::{Cons, Nil};\n\nfn main() {\n    let a = Rc::new(Cons(5, Rc::new(Cons(10, Rc::new(Nil)))));\n    println!("\u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&a));  // 1\n    \n    let b = Cons(3, Rc::clone(&a));\n    println!("\u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&a));  // 2\n    \n    {\n        let c = Cons(4, Rc::clone(&a));\n        println!("\u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&a));  // 3\n    }\n    \n    println!("\u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&a));  // 2\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"refcellt",children:(0,t.jsx)(n.code,{children:"RefCell<T>"})}),"\n",(0,t.jsx)(n.p,{children:"\u5185\u90e8\u53ef\u53d8\u6027\u6a21\u5f0f\uff0c\u8fd0\u884c\u65f6\u68c0\u67e5\u501f\u7528\u89c4\u5219\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:'use std::cell::RefCell;\n\nfn main() {\n    let x = RefCell::new(5);\n    \n    *x.borrow_mut() += 1;\n    \n    println!("x = {:?}", x.borrow());\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"rcrefcellt",children:(0,t.jsx)(n.code,{children:"Rc<RefCell<T>>"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:'use std::cell::RefCell;\nuse std::rc::Rc;\n\n#[derive(Debug)]\nenum List {\n    Cons(Rc<RefCell<i32>>, Rc<List>),\n    Nil,\n}\n\nuse List::{Cons, Nil};\n\nfn main() {\n    let value = Rc::new(RefCell::new(5));\n    \n    let a = Rc::new(Cons(Rc::clone(&value), Rc::new(Nil)));\n    let b = Cons(Rc::new(RefCell::new(6)), Rc::clone(&a));\n    let c = Cons(Rc::new(RefCell::new(10)), Rc::clone(&a));\n    \n    *value.borrow_mut() += 10;\n    \n    println!("a = {:?}", a);\n    println!("b = {:?}", b);\n    println!("c = {:?}", c);\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"weakt",children:(0,t.jsx)(n.code,{children:"Weak<T>"})}),"\n",(0,t.jsx)(n.p,{children:"\u5f31\u5f15\u7528\uff0c\u4e0d\u589e\u52a0\u5f15\u7528\u8ba1\u6570\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:"use std::cell::RefCell;\nuse std::rc::{Rc, Weak};\n\n#[derive(Debug)]\nstruct Node {\n    value: i32,\n    parent: RefCell<Weak<Node>>,\n    children: RefCell<Vec<Rc<Node>>>,\n}\n\nfn main() {\n    let leaf = Rc::new(Node {\n        value: 3,\n        parent: RefCell::new(Weak::new()),\n        children: RefCell::new(vec![]),\n    });\n    \n    let branch = Rc::new(Node {\n        value: 5,\n        parent: RefCell::new(Weak::new()),\n        children: RefCell::new(vec![Rc::clone(&leaf)]),\n    });\n    \n    *leaf.parent.borrow_mut() = Rc::downgrade(&branch);\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.code,{children:"Box<T>"}),"\uff1a\u5806\u5206\u914d"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.code,{children:"Rc<T>"}),"\uff1a\u5f15\u7528\u8ba1\u6570"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.code,{children:"RefCell<T>"}),"\uff1a\u5185\u90e8\u53ef\u53d8\u6027"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.code,{children:"Weak<T>"}),"\uff1a\u5f31\u5f15\u7528"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u8fd9\u4e9b\u662f Rust \u7f16\u7a0b\u7684\u6838\u5fc3\u4e3b\u9898\u3002\u7ee7\u7eed\u63a2\u7d22 Rust \u751f\u6001\u7cfb\u7edf\u5427\uff01"})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},1266:(e,n,l)=>{l.d(n,{R:()=>r,x:()=>i});var c=l(9378);const t={},s=c.createContext(t);function r(e){const n=c.useContext(s);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),c.createElement(s.Provider,{value:n},e.children)}}}]);
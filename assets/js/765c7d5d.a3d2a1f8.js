"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[74530],{48885:(n,e,l)=>{l.d(e,{R:()=>r,x:()=>c});var s=l(99378);const i={},d=s.createContext(i);function r(n){const e=s.useContext(d);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),s.createElement(d.Provider,{value:e},n.children)}},49621:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>h,contentTitle:()=>c,default:()=>a,frontMatter:()=>r,metadata:()=>s,toc:()=>x});const s=JSON.parse('{"id":"mysql/transactions","title":"\u4e8b\u52a1\u5904\u7406","description":"[!TIP] > \u6570\u636e\u4e00\u81f4\u6027\u4fdd\u969c: \u4e8b\u52a1\u662f\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\u548c\u5b8c\u6574\u6027\u7684\u6838\u5fc3\u673a\u5236\u3002\u7406\u89e3 ACID \u7279\u6027\u3001\u9694\u79bb\u7ea7\u522b\u548c\u9501\u673a\u5236\u662f\u638c\u63e1 MySQL \u7684\u5173\u952e\u3002","source":"@site/docs/mysql/transactions.md","sourceDirName":"mysql","slug":"/mysql/transactions","permalink":"/docs/mysql/transactions","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/mysql/transactions.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"\u4e8b\u52a1\u5904\u7406"},"sidebar":"mysql","previous":{"title":"\u7d22\u5f15\u4f18\u5316","permalink":"/docs/mysql/indexes"},"next":{"title":"\u9501\u673a\u5236\u8be6\u89e3","permalink":"/docs/mysql/locks"}}');var i=l(22714),d=l(48885);const r={sidebar_position:6,title:"\u4e8b\u52a1\u5904\u7406"},c="MySQL \u4e8b\u52a1\u5904\u7406",h={},x=[{value:"\u4e8b\u52a1\u57fa\u7840",id:"\u4e8b\u52a1\u57fa\u7840",level:2},{value:"\u4ec0\u4e48\u662f\u4e8b\u52a1",id:"\u4ec0\u4e48\u662f\u4e8b\u52a1",level:3},{value:"ACID \u7279\u6027",id:"acid-\u7279\u6027",level:3},{value:"Atomicity (\u539f\u5b50\u6027)",id:"atomicity-\u539f\u5b50\u6027",level:4},{value:"Consistency (\u4e00\u81f4\u6027)",id:"consistency-\u4e00\u81f4\u6027",level:4},{value:"Isolation (\u9694\u79bb\u6027)",id:"isolation-\u9694\u79bb\u6027",level:4},{value:"Durability (\u6301\u4e45\u6027)",id:"durability-\u6301\u4e45\u6027",level:4},{value:"\u4e8b\u52a1\u64cd\u4f5c",id:"\u4e8b\u52a1\u64cd\u4f5c",level:2},{value:"\u5f00\u542f\u4e8b\u52a1",id:"\u5f00\u542f\u4e8b\u52a1",level:3},{value:"\u63d0\u4ea4\u4e8b\u52a1",id:"\u63d0\u4ea4\u4e8b\u52a1",level:3},{value:"\u56de\u6eda\u4e8b\u52a1",id:"\u56de\u6eda\u4e8b\u52a1",level:3},{value:"\u4fdd\u5b58\u70b9",id:"\u4fdd\u5b58\u70b9",level:3},{value:"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b",id:"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b",level:2},{value:"\u56db\u5927\u9694\u79bb\u7ea7\u522b",id:"\u56db\u5927\u9694\u79bb\u7ea7\u522b",level:3},{value:"\u5e76\u53d1\u95ee\u9898",id:"\u5e76\u53d1\u95ee\u9898",level:3},{value:"\u810f\u8bfb (Dirty Read)",id:"\u810f\u8bfb-dirty-read",level:4},{value:"\u4e0d\u53ef\u91cd\u590d\u8bfb (Non-Repeatable Read)",id:"\u4e0d\u53ef\u91cd\u590d\u8bfb-non-repeatable-read",level:4},{value:"\u5e7b\u8bfb (Phantom Read)",id:"\u5e7b\u8bfb-phantom-read",level:4},{value:"\u8bbe\u7f6e\u9694\u79bb\u7ea7\u522b",id:"\u8bbe\u7f6e\u9694\u79bb\u7ea7\u522b",level:3},{value:"\u9694\u79bb\u7ea7\u522b\u793a\u4f8b",id:"\u9694\u79bb\u7ea7\u522b\u793a\u4f8b",level:3},{value:"READ UNCOMMITTED",id:"read-uncommitted",level:4},{value:"READ COMMITTED",id:"read-committed",level:4},{value:"REPEATABLE READ (MySQL \u9ed8\u8ba4)",id:"repeatable-read-mysql-\u9ed8\u8ba4",level:4},{value:"\u9501\u673a\u5236",id:"\u9501\u673a\u5236",level:2},{value:"\u9501\u7684\u5206\u7c7b",id:"\u9501\u7684\u5206\u7c7b",level:3},{value:"\u6309\u9501\u7c92\u5ea6\u5206\u7c7b",id:"\u6309\u9501\u7c92\u5ea6\u5206\u7c7b",level:4},{value:"\u6309\u9501\u6a21\u5f0f\u5206\u7c7b",id:"\u6309\u9501\u6a21\u5f0f\u5206\u7c7b",level:4},{value:"\u8868\u9501",id:"\u8868\u9501",level:3},{value:"\u884c\u9501 (InnoDB)",id:"\u884c\u9501-innodb",level:3},{value:"\u5171\u4eab\u9501 (S \u9501)",id:"\u5171\u4eab\u9501-s-\u9501",level:4},{value:"\u6392\u5b83\u9501 (X \u9501)",id:"\u6392\u5b83\u9501-x-\u9501",level:4},{value:"\u610f\u5411\u9501",id:"\u610f\u5411\u9501",level:4},{value:"\u95f4\u9699\u9501 (Gap Lock)",id:"\u95f4\u9699\u9501-gap-lock",level:3},{value:"Next-Key Lock",id:"next-key-lock",level:3},{value:"\u6b7b\u9501",id:"\u6b7b\u9501",level:2},{value:"\u4ec0\u4e48\u662f\u6b7b\u9501",id:"\u4ec0\u4e48\u662f\u6b7b\u9501",level:3},{value:"\u67e5\u770b\u6b7b\u9501",id:"\u67e5\u770b\u6b7b\u9501",level:3},{value:"\u907f\u514d\u6b7b\u9501",id:"\u907f\u514d\u6b7b\u9501",level:3},{value:"MVCC (\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236)",id:"mvcc-\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236",level:2},{value:"MVCC \u539f\u7406",id:"mvcc-\u539f\u7406",level:3},{value:"\u9690\u85cf\u5217",id:"\u9690\u85cf\u5217",level:3},{value:"\u7248\u672c\u94fe\u4e0e Undo Log",id:"\u7248\u672c\u94fe\u4e0e-undo-log",level:3},{value:"Read View\uff08\u8bfb\u89c6\u56fe\uff09",id:"read-view\u8bfb\u89c6\u56fe",level:3},{value:"Read View \u6838\u5fc3\u5b57\u6bb5",id:"read-view-\u6838\u5fc3\u5b57\u6bb5",level:4},{value:"\u53ef\u89c1\u6027\u5224\u65ad\u7b97\u6cd5",id:"\u53ef\u89c1\u6027\u5224\u65ad\u7b97\u6cd5",level:4},{value:"\u53ef\u89c1\u6027\u5224\u65ad\u793a\u4f8b",id:"\u53ef\u89c1\u6027\u5224\u65ad\u793a\u4f8b",level:4},{value:"\u5feb\u7167\u8bfb vs \u5f53\u524d\u8bfb",id:"\u5feb\u7167\u8bfb-vs-\u5f53\u524d\u8bfb",level:3},{value:"\u5feb\u7167\u8bfb\uff08Snapshot Read\uff09",id:"\u5feb\u7167\u8bfbsnapshot-read",level:4},{value:"\u5f53\u524d\u8bfb\uff08Current Read\uff09",id:"\u5f53\u524d\u8bfbcurrent-read",level:4},{value:"\u5feb\u7167\u8bfb\u4e0e\u5f53\u524d\u8bfb\u5bf9\u6bd4\u793a\u4f8b",id:"\u5feb\u7167\u8bfb\u4e0e\u5f53\u524d\u8bfb\u5bf9\u6bd4\u793a\u4f8b",level:4},{value:"\u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\u7684 MVCC",id:"\u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\u7684-mvcc",level:3},{value:"READ COMMITTED (RC)",id:"read-committed-rc",level:4},{value:"REPEATABLE READ (RR)",id:"repeatable-read-rr",level:4},{value:"RC vs RR \u5bf9\u6bd4\u793a\u4f8b",id:"rc-vs-rr-\u5bf9\u6bd4\u793a\u4f8b",level:4},{value:"MVCC \u89e3\u51b3\u7684\u95ee\u9898",id:"mvcc-\u89e3\u51b3\u7684\u95ee\u9898",level:3},{value:"MVCC \u603b\u7ed3",id:"mvcc-\u603b\u7ed3",level:3},{value:"\u4e8b\u52a1\u65e5\u5fd7",id:"\u4e8b\u52a1\u65e5\u5fd7",level:2},{value:"\u4e09\u5927\u65e5\u5fd7\u5bf9\u6bd4",id:"\u4e09\u5927\u65e5\u5fd7\u5bf9\u6bd4",level:3},{value:"Undo Log (\u56de\u6eda\u65e5\u5fd7)",id:"undo-log-\u56de\u6eda\u65e5\u5fd7",level:3},{value:"Redo Log (\u91cd\u505a\u65e5\u5fd7)",id:"redo-log-\u91cd\u505a\u65e5\u5fd7",level:3},{value:"Binlog (\u4e8c\u8fdb\u5236\u65e5\u5fd7)",id:"binlog-\u4e8c\u8fdb\u5236\u65e5\u5fd7",level:3},{value:"\u5199\u5165\u6d41\u7a0b &amp; \u4e24\u9636\u6bb5\u63d0\u4ea4 (2PC)",id:"\u5199\u5165\u6d41\u7a0b--\u4e24\u9636\u6bb5\u63d0\u4ea4-2pc",level:3},{value:"\u5199\u5165\u6d41\u7a0b\u56fe\u89e3 (Buffer to Disk)",id:"\u5199\u5165\u6d41\u7a0b\u56fe\u89e3-buffer-to-disk",level:4},{value:"2PC \u6d41\u7a0b\u8be6\u89e3",id:"2pc-\u6d41\u7a0b\u8be6\u89e3",level:4},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u4e8b\u52a1\u4f7f\u7528\u89c4\u8303",id:"\u4e8b\u52a1\u4f7f\u7528\u89c4\u8303",level:3},{value:"\u793a\u4f8b\uff1a\u89c4\u8303\u7684\u4e8b\u52a1\u5904\u7406",id:"\u793a\u4f8b\u89c4\u8303\u7684\u4e8b\u52a1\u5904\u7406",level:3},{value:"\u9519\u8bef\u5904\u7406",id:"\u9519\u8bef\u5904\u7406",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function t(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"mysql-\u4e8b\u52a1\u5904\u7406",children:"MySQL \u4e8b\u52a1\u5904\u7406"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.p,{children:["[!TIP] > ",(0,i.jsx)(e.strong,{children:"\u6570\u636e\u4e00\u81f4\u6027\u4fdd\u969c"}),": \u4e8b\u52a1\u662f\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\u548c\u5b8c\u6574\u6027\u7684\u6838\u5fc3\u673a\u5236\u3002\u7406\u89e3 ACID \u7279\u6027\u3001\u9694\u79bb\u7ea7\u522b\u548c\u9501\u673a\u5236\u662f\u638c\u63e1 MySQL \u7684\u5173\u952e\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u4e8b\u52a1\u57fa\u7840",children:"\u4e8b\u52a1\u57fa\u7840"}),"\n",(0,i.jsx)(e.h3,{id:"\u4ec0\u4e48\u662f\u4e8b\u52a1",children:"\u4ec0\u4e48\u662f\u4e8b\u52a1"}),"\n",(0,i.jsx)(e.p,{children:"\u4e8b\u52a1\u662f\u4e00\u7ec4 SQL \u64cd\u4f5c\u7684\u96c6\u5408\uff0c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002\u7ecf\u5178\u4f8b\u5b50\uff1a\u94f6\u884c\u8f6c\u8d26\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u8f6c\u8d26\u793a\u4f8b\nSTART TRANSACTION;\n\nUPDATE accounts SET balance = balance - 100 WHERE user_id = 1;  -- \u6263\u6b3e\nUPDATE accounts SET balance = balance + 100 WHERE user_id = 2;  -- \u5165\u8d26\n\nCOMMIT;  -- \u63d0\u4ea4\u4e8b\u52a1\n"})}),"\n",(0,i.jsx)(e.h3,{id:"acid-\u7279\u6027",children:"ACID \u7279\u6027"}),"\n",(0,i.jsx)(e.h4,{id:"atomicity-\u539f\u5b50\u6027",children:"Atomicity (\u539f\u5b50\u6027)"}),"\n",(0,i.jsx)(e.p,{children:"\u4e8b\u52a1\u662f\u4e0d\u53ef\u5206\u5272\u7684\u6700\u5c0f\u5355\u4f4d\uff0c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"START TRANSACTION;\n\nINSERT INTO orders (user_id, amount) VALUES (1, 100);\nINSERT INTO order_items (order_id, product_id) VALUES (LAST_INSERT_ID(), 10);\n\n-- \u5982\u679c\u4efb\u4f55\u4e00\u6761\u5931\u8d25\uff0c\u6574\u4e2a\u4e8b\u52a1\u56de\u6eda\nROLLBACK;  -- \u6216 COMMIT;\n"})}),"\n",(0,i.jsx)(e.h4,{id:"consistency-\u4e00\u81f4\u6027",children:"Consistency (\u4e00\u81f4\u6027)"}),"\n",(0,i.jsx)(e.p,{children:"\u4e8b\u52a1\u524d\u540e\uff0c\u6570\u636e\u4fdd\u6301\u4e00\u81f4\u72b6\u6001\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u8f6c\u8d26\u524d\u540e\uff0c\u603b\u91d1\u989d\u4e0d\u53d8\n-- A: 1000, B: 500, Total: 1500\n-- A: 900,  B: 600, Total: 1500 (\u4e00\u81f4)\n"})}),"\n",(0,i.jsx)(e.h4,{id:"isolation-\u9694\u79bb\u6027",children:"Isolation (\u9694\u79bb\u6027)"}),"\n",(0,i.jsx)(e.p,{children:"\u5e76\u53d1\u4e8b\u52a1\u4e4b\u95f4\u76f8\u4e92\u9694\u79bb\uff0c\u4e92\u4e0d\u5e72\u6270\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4e8b\u52a11\nSTART TRANSACTION;\nUPDATE accounts SET balance = balance - 100 WHERE id = 1;\n-- ... \u5176\u4ed6\u64cd\u4f5c\n\n-- \u4e8b\u52a12 \u770b\u4e0d\u5230\u4e8b\u52a11\u672a\u63d0\u4ea4\u7684\u4fee\u6539\nSTART TRANSACTION;\nSELECT balance FROM accounts WHERE id = 1;  -- \u770b\u5230\u539f\u59cb\u503c\n"})}),"\n",(0,i.jsx)(e.h4,{id:"durability-\u6301\u4e45\u6027",children:"Durability (\u6301\u4e45\u6027)"}),"\n",(0,i.jsx)(e.p,{children:"\u4e8b\u52a1\u4e00\u65e6\u63d0\u4ea4\uff0c\u4fee\u6539\u6c38\u4e45\u4fdd\u5b58\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"COMMIT;  -- \u63d0\u4ea4\u540e\uff0c\u5373\u4f7f\u6570\u636e\u5e93\u5d29\u6e83\uff0c\u6570\u636e\u4e5f\u4e0d\u4f1a\u4e22\u5931\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u4e8b\u52a1\u64cd\u4f5c",children:"\u4e8b\u52a1\u64cd\u4f5c"}),"\n",(0,i.jsx)(e.h3,{id:"\u5f00\u542f\u4e8b\u52a1",children:"\u5f00\u542f\u4e8b\u52a1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u65b9\u5f0f1\uff1a\u663e\u5f0f\u5f00\u542f\nSTART TRANSACTION;\n-- \u6216\nBEGIN;\n\n-- \u65b9\u5f0f2\uff1a\u8bbe\u7f6e\u81ea\u52a8\u63d0\u4ea4\nSET autocommit = 0;  -- \u5173\u95ed\u81ea\u52a8\u63d0\u4ea4\n-- \u4e4b\u540e\u6bcf\u6761 SQL \u90fd\u5728\u4e8b\u52a1\u4e2d\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u63d0\u4ea4\u4e8b\u52a1",children:"\u63d0\u4ea4\u4e8b\u52a1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"COMMIT;  -- \u63d0\u4ea4\u6240\u6709\u4fee\u6539\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u56de\u6eda\u4e8b\u52a1",children:"\u56de\u6eda\u4e8b\u52a1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"ROLLBACK;  -- \u64a4\u9500\u6240\u6709\u4fee\u6539\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u4fdd\u5b58\u70b9",children:"\u4fdd\u5b58\u70b9"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:'START TRANSACTION;\n\nINSERT INTO users (username) VALUES (\'\u5f20\u4e09\');\nSAVEPOINT sp1;  -- \u4fdd\u5b58\u70b91\n\nINSERT INTO users (username) VALUES (\'\u674e\u56db\');\nSAVEPOINT sp2;  -- \u4fdd\u5b58\u70b92\n\nINSERT INTO users (username) VALUES (\'\u738b\u4e94\');\n\nROLLBACK TO sp2;  -- \u56de\u6eda\u5230\u4fdd\u5b58\u70b92\uff08\u64a4\u9500"\u738b\u4e94"\uff09\nROLLBACK TO sp1;  -- \u56de\u6eda\u5230\u4fdd\u5b58\u70b91\uff08\u64a4\u9500"\u674e\u56db"\u548c"\u738b\u4e94"\uff09\n\nCOMMIT;  -- \u53ea\u63d0\u4ea4"\u5f20\u4e09"\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b",children:"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b"}),"\n",(0,i.jsx)(e.h3,{id:"\u56db\u5927\u9694\u79bb\u7ea7\u522b",children:"\u56db\u5927\u9694\u79bb\u7ea7\u522b"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u9694\u79bb\u7ea7\u522b"}),(0,i.jsx)(e.th,{children:"\u810f\u8bfb"}),(0,i.jsx)(e.th,{children:"\u4e0d\u53ef\u91cd\u590d\u8bfb"}),(0,i.jsx)(e.th,{children:"\u5e7b\u8bfb"}),(0,i.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"READ UNCOMMITTED"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u8bfb\u672a\u63d0\u4ea4"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"READ COMMITTED"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u8bfb\u5df2\u63d0\u4ea4"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"REPEATABLE READ"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u53ef\u91cd\u590d\u8bfb\uff08MySQL \u9ed8\u8ba4\uff09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"SERIALIZABLE"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u4e32\u884c\u5316"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"\u5e76\u53d1\u95ee\u9898",children:"\u5e76\u53d1\u95ee\u9898"}),"\n",(0,i.jsx)(e.h4,{id:"\u810f\u8bfb-dirty-read",children:"\u810f\u8bfb (Dirty Read)"}),"\n",(0,i.jsx)(e.p,{children:"\u8bfb\u53d6\u5230\u5176\u4ed6\u4e8b\u52a1\u672a\u63d0\u4ea4\u7684\u6570\u636e\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4e8b\u52a1A\nSTART TRANSACTION;\nUPDATE accounts SET balance = 1000 WHERE id = 1;\n-- \u672a\u63d0\u4ea4\n\n-- \u4e8b\u52a1B\uff08READ UNCOMMITTED\uff09\nSTART TRANSACTION;\nSELECT balance FROM accounts WHERE id = 1;  -- \u8bfb\u52301000\uff08\u810f\u8bfb\uff09\n\n-- \u4e8b\u52a1A\u56de\u6eda\nROLLBACK;  -- balance \u6062\u590d\u539f\u503c\uff0c\u4e8b\u52a1B\u8bfb\u5230\u7684\u6570\u636e\u65e0\u6548\n"})}),"\n",(0,i.jsx)(e.h4,{id:"\u4e0d\u53ef\u91cd\u590d\u8bfb-non-repeatable-read",children:"\u4e0d\u53ef\u91cd\u590d\u8bfb (Non-Repeatable Read)"}),"\n",(0,i.jsx)(e.p,{children:"\u540c\u4e00\u4e8b\u52a1\u4e2d\uff0c\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6570\u636e\u7ed3\u679c\u4e0d\u540c\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4e8b\u52a1A\nSTART TRANSACTION;\nSELECT balance FROM accounts WHERE id = 1;  -- \u8bfb\u5230500\n\n-- \u4e8b\u52a1B\nSTART TRANSACTION;\nUPDATE accounts SET balance = 1000 WHERE id = 1;\nCOMMIT;\n\n-- \u4e8b\u52a1A\nSELECT balance FROM accounts WHERE id = 1;  -- \u8bfb\u52301000\uff08\u4e0d\u53ef\u91cd\u590d\u8bfb\uff09\n"})}),"\n",(0,i.jsx)(e.h4,{id:"\u5e7b\u8bfb-phantom-read",children:"\u5e7b\u8bfb (Phantom Read)"}),"\n",(0,i.jsx)(e.p,{children:"\u540c\u4e00\u4e8b\u52a1\u4e2d\uff0c\u591a\u6b21\u67e5\u8be2\u8bb0\u5f55\u6570\u4e0d\u540c\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4e8b\u52a1A\nSTART TRANSACTION;\nSELECT COUNT(*) FROM users WHERE age > 18;  -- \u7ed3\u679c\uff1a100\n\n-- \u4e8b\u52a1B\nSTART TRANSACTION;\nINSERT INTO users (age) VALUES (20);\nCOMMIT;\n\n-- \u4e8b\u52a1A\nSELECT COUNT(*) FROM users WHERE age > 18;  -- \u7ed3\u679c\uff1a101\uff08\u5e7b\u8bfb\uff09\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u8bbe\u7f6e\u9694\u79bb\u7ea7\u522b",children:"\u8bbe\u7f6e\u9694\u79bb\u7ea7\u522b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u67e5\u770b\u5168\u5c40\u9694\u79bb\u7ea7\u522b\nSELECT @@global.transaction_isolation;\n\n-- \u67e5\u770b\u4f1a\u8bdd\u9694\u79bb\u7ea7\u522b\nSELECT @@transaction_isolation;\n\n-- \u8bbe\u7f6e\u4f1a\u8bdd\u9694\u79bb\u7ea7\u522b\nSET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;\nSET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;\nSET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;\n\n-- \u8bbe\u7f6e\u5168\u5c40\u9694\u79bb\u7ea7\u522b\nSET GLOBAL TRANSACTION ISOLATION LEVEL REPEATABLE READ;\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u9694\u79bb\u7ea7\u522b\u793a\u4f8b",children:"\u9694\u79bb\u7ea7\u522b\u793a\u4f8b"}),"\n",(0,i.jsx)(e.h4,{id:"read-uncommitted",children:"READ UNCOMMITTED"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4f1a\u8bdd1\nSET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;\nSTART TRANSACTION;\nSELECT balance FROM accounts WHERE id = 1;  -- 500\n\n-- \u4f1a\u8bdd2\nSTART TRANSACTION;\nUPDATE accounts SET balance = 1000 WHERE id = 1;  -- \u672a\u63d0\u4ea4\n\n-- \u4f1a\u8bdd1\nSELECT balance FROM accounts WHERE id = 1;  -- 1000\uff08\u810f\u8bfb\uff09\n"})}),"\n",(0,i.jsx)(e.h4,{id:"read-committed",children:"READ COMMITTED"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4f1a\u8bdd1\nSET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;\nSTART TRANSACTION;\nSELECT balance FROM accounts WHERE id = 1;  -- 500\n\n-- \u4f1a\u8bdd2\nSTART TRANSACTION;\nUPDATE accounts SET balance = 1000 WHERE id = 1;\nCOMMIT;\n\n-- \u4f1a\u8bdd1\nSELECT balance FROM accounts WHERE id = 1;  -- 1000\uff08\u4e0d\u53ef\u91cd\u590d\u8bfb\uff0c\u4f46\u4e0d\u662f\u810f\u8bfb\uff09\n"})}),"\n",(0,i.jsx)(e.h4,{id:"repeatable-read-mysql-\u9ed8\u8ba4",children:"REPEATABLE READ (MySQL \u9ed8\u8ba4)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4f1a\u8bdd1\nSET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;\nSTART TRANSACTION;\nSELECT balance FROM accounts WHERE id = 1;  -- 500\n\n-- \u4f1a\u8bdd2\nSTART TRANSACTION;\nUPDATE accounts SET balance = 1000 WHERE id = 1;\nCOMMIT;\n\n-- \u4f1a\u8bdd1\nSELECT balance FROM accounts WHERE id = 1;  -- \u4ecd\u7136\u662f 500\uff08\u53ef\u91cd\u590d\u8bfb\uff09\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u9501\u673a\u5236",children:"\u9501\u673a\u5236"}),"\n",(0,i.jsx)(e.h3,{id:"\u9501\u7684\u5206\u7c7b",children:"\u9501\u7684\u5206\u7c7b"}),"\n",(0,i.jsx)(e.h4,{id:"\u6309\u9501\u7c92\u5ea6\u5206\u7c7b",children:"\u6309\u9501\u7c92\u5ea6\u5206\u7c7b"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8868\u9501"})," - \u9501\u5b9a\u6574\u5f20\u8868"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u884c\u9501"})," - \u9501\u5b9a\u7279\u5b9a\u884c\uff08InnoDB \u652f\u6301\uff09"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9875\u9501"})," - \u9501\u5b9a\u6570\u636e\u9875"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"\u6309\u9501\u6a21\u5f0f\u5206\u7c7b",children:"\u6309\u9501\u6a21\u5f0f\u5206\u7c7b"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5171\u4eab\u9501 (S \u9501)"})," - \u8bfb\u9501\uff0c\u591a\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u540c\u65f6\u6301\u6709"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6392\u5b83\u9501 (X \u9501)"})," - \u5199\u9501\uff0c\u72ec\u5360\u8bbf\u95ee"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u8868\u9501",children:"\u8868\u9501"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u52a0\u8bfb\u9501\nLOCK TABLES users READ;\nSELECT * FROM users;  -- \u5141\u8bb8\nUPDATE users SET age = 25;  -- \u62a5\u9519\uff08\u53ea\u8bfb\uff09\nUNLOCK TABLES;\n\n-- \u52a0\u5199\u9501\nLOCK TABLES users WRITE;\nSELECT * FROM users;  -- \u5141\u8bb8\nUPDATE users SET age = 25;  -- \u5141\u8bb8\nUNLOCK TABLES;\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u884c\u9501-innodb",children:"\u884c\u9501 (InnoDB)"}),"\n",(0,i.jsx)(e.h4,{id:"\u5171\u4eab\u9501-s-\u9501",children:"\u5171\u4eab\u9501 (S \u9501)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u52a0\u5171\u4eab\u9501\nSTART TRANSACTION;\nSELECT * FROM users WHERE id = 1 LOCK IN SHARE MODE;\n\n-- \u5176\u4ed6\u4e8b\u52a1\u53ef\u4ee5\u8bfb\uff0c\u4f46\u4e0d\u80fd\u5199\n-- \u5176\u4ed6\u4e8b\u52a1: SELECT * FROM users WHERE id = 1;  -- \u6210\u529f\n-- \u5176\u4ed6\u4e8b\u52a1: UPDATE users SET age = 25 WHERE id = 1;  -- \u7b49\u5f85\n"})}),"\n",(0,i.jsx)(e.h4,{id:"\u6392\u5b83\u9501-x-\u9501",children:"\u6392\u5b83\u9501 (X \u9501)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u52a0\u6392\u5b83\u9501\nSTART TRANSACTION;\nSELECT * FROM users WHERE id = 1 FOR UPDATE;\n\n-- \u5176\u4ed6\u4e8b\u52a1\u4e0d\u80fd\u8bfb\uff08\u52a0\u9501\u8bfb\uff09\u4e5f\u4e0d\u80fd\u5199\n-- \u5176\u4ed6\u4e8b\u52a1: SELECT * FROM users WHERE id = 1 FOR UPDATE;  -- \u7b49\u5f85\n-- \u5176\u4ed6\u4e8b\u52a1: UPDATE users SET age = 25 WHERE id = 1;  -- \u7b49\u5f85\n"})}),"\n",(0,i.jsx)(e.h4,{id:"\u610f\u5411\u9501",children:"\u610f\u5411\u9501"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u610f\u5411\u5171\u4eab\u9501 (IS)"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u610f\u5411\u6392\u5b83\u9501 (IX)"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- InnoDB \u81ea\u52a8\u52a0\u610f\u5411\u9501\n-- \u884c\u9501\u4e4b\u524d\u5148\u52a0\u8868\u7ea7\u610f\u5411\u9501\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u95f4\u9699\u9501-gap-lock",children:"\u95f4\u9699\u9501 (Gap Lock)"}),"\n",(0,i.jsx)(e.p,{children:"\u9632\u6b62\u5e7b\u8bfb\uff0c\u9501\u5b9a\u7d22\u5f15\u8303\u56f4\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- REPEATABLE READ \u9694\u79bb\u7ea7\u522b\u4e0b\nSTART TRANSACTION;\nSELECT * FROM users WHERE id BETWEEN 10 AND 20 FOR UPDATE;\n\n-- \u9501\u5b9a (10, 20) \u8303\u56f4\uff0c\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id=15 \u7684\u8bb0\u5f55\n-- \u5176\u4ed6\u4e8b\u52a1: INSERT INTO users (id, username) VALUES (15, '\u5f20\u4e09');  -- \u7b49\u5f85\n"})}),"\n",(0,i.jsx)(e.h3,{id:"next-key-lock",children:"Next-Key Lock"}),"\n",(0,i.jsx)(e.p,{children:"\u884c\u9501 + \u95f4\u9699\u9501\uff0cInnoDB \u9ed8\u8ba4\u4f7f\u7528\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u9501\u5b9a\u8bb0\u5f55 + \u8bb0\u5f55\u524d\u7684\u95f4\u9699\nSTART TRANSACTION;\nSELECT * FROM users WHERE id >= 10 FOR UPDATE;\n-- \u9501\u5b9a id=10 \u7684\u8bb0\u5f55 + (\u524d\u4e00\u6761\u8bb0\u5f55, 10] \u7684\u95f4\u9699\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u6b7b\u9501",children:"\u6b7b\u9501"}),"\n",(0,i.jsx)(e.h3,{id:"\u4ec0\u4e48\u662f\u6b7b\u9501",children:"\u4ec0\u4e48\u662f\u6b7b\u9501"}),"\n",(0,i.jsx)(e.p,{children:"\u4e24\u4e2a\u6216\u591a\u4e2a\u4e8b\u52a1\u4e92\u76f8\u7b49\u5f85\u5bf9\u65b9\u91ca\u653e\u9501\uff0c\u5f62\u6210\u5faa\u73af\u7b49\u5f85\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4e8b\u52a1A\nSTART TRANSACTION;\nUPDATE accounts SET balance = balance - 100 WHERE id = 1;  -- \u9501\u5b9a id=1\n-- \u7b49\u5f85\u9501\u5b9a id=2\nUPDATE accounts SET balance = balance + 100 WHERE id = 2;\n\n-- \u4e8b\u52a1B\nSTART TRANSACTION;\nUPDATE accounts SET balance = balance - 50 WHERE id = 2;  -- \u9501\u5b9a id=2\n-- \u7b49\u5f85\u9501\u5b9a id=1\nUPDATE accounts SET balance = balance + 50 WHERE id = 1;\n\n-- \u6b7b\u9501\uff01MySQL \u4f1a\u81ea\u52a8\u68c0\u6d4b\u5e76\u56de\u6eda\u5176\u4e2d\u4e00\u4e2a\u4e8b\u52a1\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u67e5\u770b\u6b7b\u9501",children:"\u67e5\u770b\u6b7b\u9501"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u67e5\u770b\u6700\u8fd1\u4e00\u6b21 InnoDB \u6b7b\u9501\u4fe1\u606f\nSHOW ENGINE INNODB STATUS\\G\n\n-- \u67e5\u770b\u9501\u7b49\u5f85\u60c5\u51b5\nSELECT * FROM performance_schema.data_locks;\nSELECT * FROM performance_schema.data_lock_waits;\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u907f\u514d\u6b7b\u9501",children:"\u907f\u514d\u6b7b\u9501"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.p,{children:["[!IMPORTANT] > ",(0,i.jsx)(e.strong,{children:"\u6b7b\u9501\u9884\u9632\u7b56\u7565"}),":"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u6309\u76f8\u540c\u987a\u5e8f\u8bbf\u95ee\u8868\u548c\u884c"}),"\n",(0,i.jsx)(e.li,{children:"\u5c3d\u91cf\u4f7f\u7528\u7d22\u5f15\u8bbf\u95ee\u6570\u636e"}),"\n",(0,i.jsx)(e.li,{children:"\u51cf\u5c11\u4e8b\u52a1\u6301\u6709\u9501\u7684\u65f6\u95f4"}),"\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528\u8f83\u4f4e\u7684\u9694\u79bb\u7ea7\u522b"}),"\n",(0,i.jsx)(e.li,{children:"\u5408\u7406\u8bbe\u7f6e\u9501\u7b49\u5f85\u8d85\u65f6"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u8bbe\u7f6e\u9501\u7b49\u5f85\u8d85\u65f6\nSET innodb_lock_wait_timeout = 50;  -- 50\u79d2\n\n-- \u7edf\u4e00\u8bbf\u95ee\u987a\u5e8f\n-- \u2705 \u597d\uff1a\u6309 ID \u5347\u5e8f\u8bbf\u95ee\nSTART TRANSACTION;\nUPDATE accounts SET balance = balance - 100 WHERE id = 1;\nUPDATE accounts SET balance = balance + 100 WHERE id = 2;\nCOMMIT;\n\n-- \u274c \u4e0d\u597d\uff1a\u4e0d\u540c\u4e8b\u52a1\u6309\u4e0d\u540c\u987a\u5e8f\u8bbf\u95ee\n-- \u4e8b\u52a1A: \u51481\u540e2\n-- \u4e8b\u52a1B: \u51482\u540e1  -- \u53ef\u80fd\u6b7b\u9501\n"})}),"\n",(0,i.jsx)(e.h2,{id:"mvcc-\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236",children:"MVCC (\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236)"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.p,{children:["[!TIP]\n",(0,i.jsx)(e.strong,{children:"\u6838\u5fc3\u6982\u5ff5"}),": MVCC\uff08Multi-Version Concurrency Control\uff09\u662f InnoDB \u5b9e\u73b0\u9ad8\u5e76\u53d1\u7684\u6838\u5fc3\u673a\u5236\uff0c\u901a\u8fc7\u4fdd\u5b58\u6570\u636e\u7684\u591a\u4e2a\u7248\u672c\uff0c\u8ba9\u8bfb\u5199\u64cd\u4f5c\u4e92\u4e0d\u963b\u585e\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"mvcc-\u539f\u7406",children:"MVCC \u539f\u7406"}),"\n",(0,i.jsx)(e.p,{children:"InnoDB \u4f7f\u7528 MVCC \u5b9e\u73b0\u975e\u9501\u5b9a\u8bfb\uff0c\u63d0\u9ad8\u5e76\u53d1\u6027\u80fd\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u591a\u7248\u672c\u5b58\u50a8"})," - \u6bcf\u884c\u8bb0\u5f55\u4fdd\u5b58\u591a\u4e2a\u5386\u53f2\u7248\u672c"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7248\u672c\u53ef\u89c1\u6027\u5224\u65ad"})," - \u4e8b\u52a1\u6839\u636e\u89c4\u5219\u5224\u65ad\u54ea\u4e2a\u7248\u672c\u53ef\u89c1"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8bfb\u5199\u4e0d\u963b\u585e"})," - \u8bfb\u64cd\u4f5c\u4e0d\u52a0\u9501\uff0c\u4e0e\u5199\u64cd\u4f5c\u4e92\u4e0d\u5e72\u6270"]}),"\n"]}),"\n",(0,i.jsx)(e.mermaid,{value:"graph LR\n    A[\u4e8b\u52a1\u8bfb\u53d6] --\x3e B{\u5224\u65ad\u7248\u672c\u53ef\u89c1\u6027}\n    B --\x3e|\u53ef\u89c1| C[\u8fd4\u56de\u8be5\u7248\u672c\u6570\u636e]\n    B --\x3e|\u4e0d\u53ef\u89c1| D[\u6cbf\u7248\u672c\u94fe\u67e5\u627e]\n    D --\x3e B"}),"\n",(0,i.jsx)(e.h3,{id:"\u9690\u85cf\u5217",children:"\u9690\u85cf\u5217"}),"\n",(0,i.jsx)(e.p,{children:"InnoDB \u4e3a\u6bcf\u884c\u8bb0\u5f55\u81ea\u52a8\u6dfb\u52a0\u4e09\u4e2a\u9690\u85cf\u5217\uff1a"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u9690\u85cf\u5217"}),(0,i.jsx)(e.th,{children:"\u5927\u5c0f"}),(0,i.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"DB_TRX_ID"})}),(0,i.jsx)(e.td,{children:"6 \u5b57\u8282"}),(0,i.jsx)(e.td,{children:"\u6700\u8fd1\u4fee\u6539\u8be5\u884c\u7684\u4e8b\u52a1 ID"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"DB_ROLL_PTR"})}),(0,i.jsx)(e.td,{children:"7 \u5b57\u8282"}),(0,i.jsx)(e.td,{children:"\u56de\u6eda\u6307\u9488\uff0c\u6307\u5411 Undo Log \u4e2d\u7684\u524d\u4e00\u4e2a\u7248\u672c"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"DB_ROW_ID"})}),(0,i.jsx)(e.td,{children:"6 \u5b57\u8282"}),(0,i.jsx)(e.td,{children:"\u9690\u85cf\u4e3b\u952e\uff08\u4ec5\u5f53\u8868\u6ca1\u6709\u4e3b\u952e\u65f6\u751f\u6210\uff09"})]})]})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u5b9e\u9645\u5b58\u50a8\u7ed3\u6784\u793a\u610f\n-- | id | name | age | DB_TRX_ID | DB_ROLL_PTR | DB_ROW_ID |\n-- | 1  | \u5f20\u4e09 | 25  | 100       | 0x12345     | 1         |\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u7248\u672c\u94fe\u4e0e-undo-log",children:"\u7248\u672c\u94fe\u4e0e Undo Log"}),"\n",(0,i.jsx)(e.p,{children:"\u6bcf\u6b21\u66f4\u65b0\u8bb0\u5f55\u65f6\uff0cInnoDB \u4f1a\uff1a"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u5c06\u65e7\u7248\u672c\u5199\u5165 Undo Log"}),"\n",(0,i.jsx)(e.li,{children:"\u7528 DB_ROLL_PTR \u6307\u5411\u65e7\u7248\u672c"}),"\n",(0,i.jsx)(e.li,{children:"\u5f62\u6210\u7248\u672c\u94fe\uff08\u94fe\u8868\u7ed3\u6784\uff09"}),"\n"]}),"\n",(0,i.jsx)(e.mermaid,{value:'graph LR\n    subgraph \u5f53\u524d\u6570\u636e\n        A["id=1, name=\u738b\u4e94, age=30<br/>trx_id=300"]\n    end\n    subgraph Undo Log\n        B["id=1, name=\u674e\u56db, age=28<br/>trx_id=200"]\n        C["id=1, name=\u5f20\u4e09, age=25<br/>trx_id=100"]\n    end\n    A --\x3e|roll_ptr| B\n    B --\x3e|roll_ptr| C\n    C --\x3e|roll_ptr| D[NULL]'}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7248\u672c\u94fe\u67e5\u627e\u8fc7\u7a0b"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u4ece\u6700\u65b0\u7248\u672c\u5f00\u59cb"}),"\n",(0,i.jsx)(e.li,{children:"\u68c0\u67e5\u8be5\u7248\u672c\u5bf9\u5f53\u524d\u4e8b\u52a1\u662f\u5426\u53ef\u89c1"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679c\u4e0d\u53ef\u89c1\uff0c\u6cbf roll_ptr \u627e\u4e0a\u4e00\u4e2a\u7248\u672c"}),"\n",(0,i.jsx)(e.li,{children:"\u76f4\u5230\u627e\u5230\u53ef\u89c1\u7248\u672c\u6216\u5230\u8fbe\u94fe\u5c3e"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"read-view\u8bfb\u89c6\u56fe",children:"Read View\uff08\u8bfb\u89c6\u56fe\uff09"}),"\n",(0,i.jsx)(e.p,{children:"Read View \u662f\u4e8b\u52a1\u8fdb\u884c\u5feb\u7167\u8bfb\u65f6\u4ea7\u751f\u7684\u8bfb\u89c6\u56fe\uff0c\u7528\u4e8e\u5224\u65ad\u7248\u672c\u53ef\u89c1\u6027\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"read-view-\u6838\u5fc3\u5b57\u6bb5",children:"Read View \u6838\u5fc3\u5b57\u6bb5"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u5b57\u6bb5"}),(0,i.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"m_ids"})}),(0,i.jsx)(e.td,{children:"\u521b\u5efa Read View \u65f6\uff0c\u6d3b\u8dc3\uff08\u672a\u63d0\u4ea4\uff09\u7684\u4e8b\u52a1 ID \u5217\u8868"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"min_trx_id"})}),(0,i.jsx)(e.td,{children:"m_ids \u4e2d\u7684\u6700\u5c0f\u503c\uff0c\u5c0f\u4e8e\u5b83\u7684\u4e8b\u52a1\u90fd\u5df2\u63d0\u4ea4"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"max_trx_id"})}),(0,i.jsx)(e.td,{children:"\u521b\u5efa Read View \u65f6\uff0c\u7cfb\u7edf\u5e94\u5206\u914d\u7ed9\u4e0b\u4e00\u4e2a\u4e8b\u52a1\u7684 ID"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"creator_trx_id"})}),(0,i.jsx)(e.td,{children:"\u521b\u5efa\u8be5 Read View \u7684\u4e8b\u52a1 ID"})]})]})]}),"\n",(0,i.jsx)(e.h4,{id:"\u53ef\u89c1\u6027\u5224\u65ad\u7b97\u6cd5",children:"\u53ef\u89c1\u6027\u5224\u65ad\u7b97\u6cd5"}),"\n",(0,i.jsxs)(e.p,{children:["\u5bf9\u4e8e\u67d0\u4e2a\u6570\u636e\u7248\u672c\uff0c\u5176 ",(0,i.jsx)(e.code,{children:"trx_id"})," \u7684\u53ef\u89c1\u6027\u5224\u65ad\u89c4\u5219\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"1. \u5982\u679c trx_id == creator_trx_id\n   \u2192 \u53ef\u89c1\uff08\u81ea\u5df1\u4fee\u6539\u7684\u6570\u636e\uff09\n\n2. \u5982\u679c trx_id < min_trx_id\n   \u2192 \u53ef\u89c1\uff08\u8be5\u4e8b\u52a1\u5728\u521b\u5efa Read View \u524d\u5df2\u63d0\u4ea4\uff09\n\n3. \u5982\u679c trx_id >= max_trx_id\n   \u2192 \u4e0d\u53ef\u89c1\uff08\u8be5\u4e8b\u52a1\u5728\u521b\u5efa Read View \u540e\u624d\u5f00\u59cb\uff09\n\n4. \u5982\u679c min_trx_id <= trx_id < max_trx_id\n   \u2192 \u5982\u679c trx_id \u5728 m_ids \u4e2d\uff1a\u4e0d\u53ef\u89c1\uff08\u8be5\u4e8b\u52a1\u8fd8\u672a\u63d0\u4ea4\uff09\n   \u2192 \u5982\u679c trx_id \u4e0d\u5728 m_ids \u4e2d\uff1a\u53ef\u89c1\uff08\u8be5\u4e8b\u52a1\u5df2\u63d0\u4ea4\uff09\n"})}),"\n",(0,i.jsx)(e.mermaid,{value:"flowchart TD\n    A[\u83b7\u53d6\u7248\u672c trx_id] --\x3e B{trx_id == creator_trx_id?}\n    B --\x3e|\u662f| C[\u2705 \u53ef\u89c1]\n    B --\x3e|\u5426| D{trx_id < min_trx_id?}\n    D --\x3e|\u662f| C\n    D --\x3e|\u5426| E{trx_id >= max_trx_id?}\n    E --\x3e|\u662f| F[\u274c \u4e0d\u53ef\u89c1]\n    E --\x3e|\u5426| G{trx_id \u5728 m_ids \u4e2d?}\n    G --\x3e|\u662f| F\n    G --\x3e|\u5426| C"}),"\n",(0,i.jsx)(e.h4,{id:"\u53ef\u89c1\u6027\u5224\u65ad\u793a\u4f8b",children:"\u53ef\u89c1\u6027\u5224\u65ad\u793a\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u5047\u8bbe\u5f53\u524d\u6d3b\u8dc3\u4e8b\u52a1\uff1atrx_id = 100, 200, 300\n-- \u4e8b\u52a1 300 \u521b\u5efa Read View \u65f6\uff1a\n--   m_ids = [100, 200, 300]\n--   min_trx_id = 100\n--   max_trx_id = 301\n--   creator_trx_id = 300\n\n-- \u5224\u65ad\u4e0d\u540c\u7248\u672c\u7684\u53ef\u89c1\u6027\uff1a\n-- trx_id = 50  \u2192 50 < 100 \u2192 \u53ef\u89c1\uff08\u65e9\u5df2\u63d0\u4ea4\uff09\n-- trx_id = 100 \u2192 100 \u5728 m_ids \u4e2d \u2192 \u4e0d\u53ef\u89c1\uff08\u672a\u63d0\u4ea4\uff09\n-- trx_id = 150 \u2192 150 \u4e0d\u5728 m_ids \u4e2d \u2192 \u53ef\u89c1\uff08\u5df2\u63d0\u4ea4\uff09\n-- trx_id = 300 \u2192 \u7b49\u4e8e creator_trx_id \u2192 \u53ef\u89c1\uff08\u81ea\u5df1\u7684\u4fee\u6539\uff09\n-- trx_id = 400 \u2192 400 >= 301 \u2192 \u4e0d\u53ef\u89c1\uff08\u672a\u6765\u4e8b\u52a1\uff09\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u5feb\u7167\u8bfb-vs-\u5f53\u524d\u8bfb",children:"\u5feb\u7167\u8bfb vs \u5f53\u524d\u8bfb"}),"\n",(0,i.jsx)(e.p,{children:"MVCC \u4e2d\u6709\u4e24\u79cd\u8bfb\u53d6\u65b9\u5f0f\uff1a"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7c7b\u578b"}),(0,i.jsx)(e.th,{children:"\u8bf4\u660e"}),(0,i.jsx)(e.th,{children:"\u662f\u5426\u52a0\u9501"}),(0,i.jsx)(e.th,{children:"SQL \u793a\u4f8b"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u5feb\u7167\u8bfb"})}),(0,i.jsx)(e.td,{children:"\u8bfb\u53d6 Read View \u53ef\u89c1\u7684\u7248\u672c"}),(0,i.jsx)(e.td,{children:"\u274c \u4e0d\u52a0\u9501"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"SELECT * FROM t"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u5f53\u524d\u8bfb"})}),(0,i.jsx)(e.td,{children:"\u8bfb\u53d6\u6700\u65b0\u5df2\u63d0\u4ea4\u7684\u7248\u672c"}),(0,i.jsx)(e.td,{children:"\u2705 \u52a0\u9501"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"SELECT ... FOR UPDATE"})})]})]})]}),"\n",(0,i.jsx)(e.h4,{id:"\u5feb\u7167\u8bfbsnapshot-read",children:"\u5feb\u7167\u8bfb\uff08Snapshot Read\uff09"}),"\n",(0,i.jsx)(e.p,{children:"\u666e\u901a\u7684 SELECT \u8bed\u53e5\uff0c\u4e0d\u52a0\u9501\uff0c\u8bfb\u53d6\u5386\u53f2\u7248\u672c\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u5feb\u7167\u8bfb\u793a\u4f8b\nSTART TRANSACTION;\nSELECT * FROM users WHERE id = 1;  -- \u5feb\u7167\u8bfb\uff0c\u4e0d\u52a0\u9501\n-- \u5373\u4f7f\u5176\u4ed6\u4e8b\u52a1\u4fee\u6539\u4e86 id=1 \u7684\u6570\u636e\u5e76\u63d0\u4ea4\uff0c\u8fd9\u91cc\u4ecd\u8bfb\u53d6\u65e7\u7248\u672c\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7279\u70b9"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4e0d\u52a0\u4efb\u4f55\u9501"}),"\n",(0,i.jsx)(e.li,{children:"\u53ef\u80fd\u8bfb\u53d6\u5386\u53f2\u7248\u672c"}),"\n",(0,i.jsx)(e.li,{children:"\u5e76\u53d1\u6027\u80fd\u6700\u597d"}),"\n",(0,i.jsx)(e.li,{children:"REPEATABLE READ \u4e0b\u5b9e\u73b0\u53ef\u91cd\u590d\u8bfb"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"\u5f53\u524d\u8bfbcurrent-read",children:"\u5f53\u524d\u8bfb\uff08Current Read\uff09"}),"\n",(0,i.jsx)(e.p,{children:"\u9700\u8981\u8bfb\u53d6\u6700\u65b0\u6570\u636e\u5e76\u52a0\u9501\u7684\u64cd\u4f5c\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u5f53\u524d\u8bfb\u793a\u4f8b\nSELECT * FROM users WHERE id = 1 LOCK IN SHARE MODE;  -- \u52a0 S \u9501\nSELECT * FROM users WHERE id = 1 FOR UPDATE;          -- \u52a0 X \u9501\nUPDATE users SET age = 26 WHERE id = 1;               -- \u52a0 X \u9501\nDELETE FROM users WHERE id = 1;                       -- \u52a0 X \u9501\nINSERT INTO users VALUES (...);                       -- \u52a0 X \u9501\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7279\u70b9"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8bfb\u53d6\u6700\u65b0\u5df2\u63d0\u4ea4\u7248\u672c"}),"\n",(0,i.jsx)(e.li,{children:"\u4f1a\u52a0\u9501\uff08\u5171\u4eab\u9501\u6216\u6392\u5b83\u9501\uff09"}),"\n",(0,i.jsx)(e.li,{children:"\u5176\u4ed6\u4e8b\u52a1\u7684\u5199\u64cd\u4f5c\u4f1a\u88ab\u963b\u585e"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"\u5feb\u7167\u8bfb\u4e0e\u5f53\u524d\u8bfb\u5bf9\u6bd4\u793a\u4f8b",children:"\u5feb\u7167\u8bfb\u4e0e\u5f53\u524d\u8bfb\u5bf9\u6bd4\u793a\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4f1a\u8bdd 1\nSTART TRANSACTION;  -- \u4e8b\u52a1\u5f00\u59cb\uff0c\u6b64\u65f6 age = 25\nSELECT age FROM users WHERE id = 1;  -- \u5feb\u7167\u8bfb\uff1a25\n\n-- \u4f1a\u8bdd 2\nUPDATE users SET age = 30 WHERE id = 1;\nCOMMIT;  -- \u63d0\u4ea4\u4fee\u6539\n\n-- \u4f1a\u8bdd 1\uff08\u7ee7\u7eed\uff09\nSELECT age FROM users WHERE id = 1;              -- \u5feb\u7167\u8bfb\uff1a25\uff08\u8bfb\u5386\u53f2\u7248\u672c\uff09\nSELECT age FROM users WHERE id = 1 FOR UPDATE;  -- \u5f53\u524d\u8bfb\uff1a30\uff08\u8bfb\u6700\u65b0\u7248\u672c\uff09\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\u7684-mvcc",children:"\u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\u7684 MVCC"}),"\n",(0,i.jsx)(e.p,{children:"MVCC \u7684\u884c\u4e3a\u5728\u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\u6709\u6240\u4e0d\u540c\uff1a"}),"\n",(0,i.jsx)(e.h4,{id:"read-committed-rc",children:"READ COMMITTED (RC)"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6bcf\u6b21 SELECT \u90fd\u521b\u5efa\u65b0\u7684 Read View"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- RC \u9694\u79bb\u7ea7\u522b\nSET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;\n\nSTART TRANSACTION;  -- trx_id = 100\n\nSELECT * FROM users WHERE id = 1;  -- Read View 1\uff1a\u770b\u5230\u5f53\u524d\u5df2\u63d0\u4ea4\u7684\u6570\u636e\n\n-- \u5176\u4ed6\u4e8b\u52a1\u63d0\u4ea4\u4e86\u4fee\u6539\n\nSELECT * FROM users WHERE id = 1;  -- Read View 2\uff1a\u80fd\u770b\u5230\u65b0\u63d0\u4ea4\u7684\u6570\u636e\uff08\u4e0d\u53ef\u91cd\u590d\u8bfb\uff09\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7279\u70b9"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6bcf\u6b21\u67e5\u8be2\u90fd\u80fd\u770b\u5230\u6700\u65b0\u5df2\u63d0\u4ea4\u7684\u6570\u636e"}),"\n",(0,i.jsx)(e.li,{children:"\u5b58\u5728\u4e0d\u53ef\u91cd\u590d\u8bfb\u95ee\u9898"}),"\n",(0,i.jsx)(e.li,{children:"\u4e0d\u5b58\u5728\u810f\u8bfb\u95ee\u9898"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"repeatable-read-rr",children:"REPEATABLE READ (RR)"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7b2c\u4e00\u6b21 SELECT \u65f6\u521b\u5efa Read View\uff0c\u540e\u7eed\u590d\u7528"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- RR \u9694\u79bb\u7ea7\u522b\uff08MySQL \u9ed8\u8ba4\uff09\nSET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;\n\nSTART TRANSACTION;  -- trx_id = 100\n\nSELECT * FROM users WHERE id = 1;  -- \u521b\u5efa Read View\uff0c\u5e76\u590d\u7528\n\n-- \u5176\u4ed6\u4e8b\u52a1\u63d0\u4ea4\u4e86\u4fee\u6539\n\nSELECT * FROM users WHERE id = 1;  -- \u4f7f\u7528\u540c\u4e00\u4e2a Read View\uff0c\u7ed3\u679c\u4e0d\u53d8\uff08\u53ef\u91cd\u590d\u8bfb\uff09\n\nCOMMIT;\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7279\u70b9"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4e8b\u52a1\u5185\u591a\u6b21\u8bfb\u53d6\u7ed3\u679c\u4e00\u81f4"}),"\n",(0,i.jsx)(e.li,{children:"\u89e3\u51b3\u4e0d\u53ef\u91cd\u590d\u8bfb\u95ee\u9898"}),"\n",(0,i.jsx)(e.li,{children:"\u901a\u8fc7 Next-Key Lock \u89e3\u51b3\u90e8\u5206\u5e7b\u8bfb\u95ee\u9898"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"rc-vs-rr-\u5bf9\u6bd4\u793a\u4f8b",children:"RC vs RR \u5bf9\u6bd4\u793a\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u521d\u59cb\u6570\u636e\uff1ausers \u8868 id=1, name='\u5f20\u4e09', age=25\n\n-- ============ READ COMMITTED ============\n-- \u4f1a\u8bdd1 (RC)                          -- \u4f1a\u8bdd2\nSET SESSION TRANSACTION ISOLATION      \nLEVEL READ COMMITTED;                  \nSTART TRANSACTION;                     \nSELECT age FROM users WHERE id=1;      \n-- \u7ed3\u679c: 25                            \n                                       UPDATE users SET age=30 WHERE id=1;\n                                       COMMIT;\nSELECT age FROM users WHERE id=1;      \n-- \u7ed3\u679c: 30 (\u80fd\u770b\u5230\u4f1a\u8bdd2\u7684\u63d0\u4ea4)        \n\n-- ============ REPEATABLE READ ============\n-- \u4f1a\u8bdd1 (RR)                          -- \u4f1a\u8bdd2\nSET SESSION TRANSACTION ISOLATION      \nLEVEL REPEATABLE READ;                 \nSTART TRANSACTION;                     \nSELECT age FROM users WHERE id=1;      \n-- \u7ed3\u679c: 25                            \n                                       UPDATE users SET age=30 WHERE id=1;\n                                       COMMIT;\nSELECT age FROM users WHERE id=1;      \n-- \u7ed3\u679c: 25 (\u53ef\u91cd\u590d\u8bfb\uff0c\u770b\u4e0d\u5230\u4f1a\u8bdd2\u7684\u63d0\u4ea4)\n"})}),"\n",(0,i.jsx)(e.h3,{id:"mvcc-\u89e3\u51b3\u7684\u95ee\u9898",children:"MVCC \u89e3\u51b3\u7684\u95ee\u9898"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u95ee\u9898"}),(0,i.jsx)(e.th,{children:"MVCC \u5982\u4f55\u89e3\u51b3"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u810f\u8bfb"})}),(0,i.jsx)(e.td,{children:"Read View \u53ea\u80fd\u770b\u5230\u5df2\u63d0\u4ea4\u4e8b\u52a1\u7684\u4fee\u6539"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u4e0d\u53ef\u91cd\u590d\u8bfb"})}),(0,i.jsx)(e.td,{children:"RR \u7ea7\u522b\u4e0b\u590d\u7528\u540c\u4e00\u4e2a Read View"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u5e7b\u8bfb\uff08\u90e8\u5206\uff09"})}),(0,i.jsx)(e.td,{children:"\u5feb\u7167\u8bfb\u901a\u8fc7 Read View \u89e3\u51b3\uff1b\u5f53\u524d\u8bfb\u901a\u8fc7 Next-Key Lock \u89e3\u51b3"})]})]})]}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.p,{children:["[!WARNING]\n",(0,i.jsx)(e.strong,{children:"MVCC \u7684\u5c40\u9650\u6027"}),"\uff1aMVCC \u53ea\u80fd\u89e3\u51b3\u5feb\u7167\u8bfb\u7684\u5e7b\u8bfb\u95ee\u9898\u3002\u5bf9\u4e8e\u5f53\u524d\u8bfb\uff08",(0,i.jsx)(e.code,{children:"SELECT ... FOR UPDATE"}),"\uff09\uff0c\u9700\u8981\u4f9d\u8d56 Next-Key Lock\uff08\u95f4\u9699\u9501 + \u884c\u9501\uff09\u6765\u9632\u6b62\u5e7b\u8bfb\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"mvcc-\u603b\u7ed3",children:"MVCC \u603b\u7ed3"}),"\n",(0,i.jsx)(e.mermaid,{value:"graph TB\n    subgraph MVCC\u6838\u5fc3\u7ec4\u4ef6\n        A[\u9690\u85cf\u5217<br/>DB_TRX_ID / DB_ROLL_PTR]\n        B[Undo Log<br/>\u7248\u672c\u94fe]\n        C[Read View<br/>\u53ef\u89c1\u6027\u5224\u65ad]\n    end\n    \n    subgraph \u8bfb\u53d6\u65b9\u5f0f\n        D[\u5feb\u7167\u8bfb<br/>\u4e0d\u52a0\u9501\uff0c\u8bfb\u5386\u53f2\u7248\u672c]\n        E[\u5f53\u524d\u8bfb<br/>\u52a0\u9501\uff0c\u8bfb\u6700\u65b0\u7248\u672c]\n    end\n    \n    A --\x3e B\n    B --\x3e C\n    C --\x3e D\n    C --\x3e E"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"MVCC \u6838\u5fc3\u8981\u70b9"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u2705 \u901a\u8fc7 ",(0,i.jsx)(e.strong,{children:"Undo Log"})," \u4fdd\u5b58\u5386\u53f2\u7248\u672c\uff0c\u5f62\u6210\u7248\u672c\u94fe"]}),"\n",(0,i.jsxs)(e.li,{children:["\u2705 \u901a\u8fc7 ",(0,i.jsx)(e.strong,{children:"\u9690\u85cf\u5217"})," \u8bb0\u5f55\u4e8b\u52a1\u4fe1\u606f\u548c\u7248\u672c\u6307\u9488"]}),"\n",(0,i.jsxs)(e.li,{children:["\u2705 \u901a\u8fc7 ",(0,i.jsx)(e.strong,{children:"Read View"})," \u5224\u65ad\u7248\u672c\u53ef\u89c1\u6027"]}),"\n",(0,i.jsxs)(e.li,{children:["\u2705 ",(0,i.jsx)(e.strong,{children:"\u5feb\u7167\u8bfb"}),"\u4e0d\u52a0\u9501\uff0c",(0,i.jsx)(e.strong,{children:"\u5f53\u524d\u8bfb"}),"\u9700\u52a0\u9501"]}),"\n",(0,i.jsxs)(e.li,{children:["\u2705 ",(0,i.jsx)(e.strong,{children:"RR"})," \u590d\u7528 Read View\uff0c",(0,i.jsx)(e.strong,{children:"RC"})," \u6bcf\u6b21\u521b\u5efa\u65b0\u7684 Read View"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u4e8b\u52a1\u65e5\u5fd7",children:"\u4e8b\u52a1\u65e5\u5fd7"}),"\n",(0,i.jsx)(e.p,{children:"MySQL \u7684\u5f3a\u5927\u4e4b\u5904\u4e0d\u4ec5\u5728\u4e8e SQL \u5904\u7406\uff0c\u66f4\u5728\u4e8e\u5176\u65e5\u5fd7\u7cfb\u7edf\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u5b89\u5168\u6027\u548c\u4e00\u81f4\u6027\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"\u4e09\u5927\u65e5\u5fd7\u5bf9\u6bd4",children:"\u4e09\u5927\u65e5\u5fd7\u5bf9\u6bd4"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u7279\u6027"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Undo Log (\u56de\u6eda\u65e5\u5fd7)"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Redo Log (\u91cd\u505a\u65e5\u5fd7)"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Binlog (\u5f52\u6863\u65e5\u5fd7)"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.strong,{children:"\u4f5c\u7528"})}),(0,i.jsxs)(e.td,{style:{textAlign:"left"},children:["\u4fdd\u8bc1\u4e8b\u52a1",(0,i.jsx)(e.strong,{children:"\u539f\u5b50\u6027"})," (Atomicity)"]}),(0,i.jsxs)(e.td,{style:{textAlign:"left"},children:["\u4fdd\u8bc1\u4e8b\u52a1",(0,i.jsx)(e.strong,{children:"\u6301\u4e45\u6027"})," (Durability)"]}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"\u6570\u636e\u5907\u4efd\u3001\u4e3b\u4ece\u590d\u5236"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.strong,{children:"\u5c42\u7ea7"})}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"\u5b58\u50a8\u5f15\u64ce\u5c42 (InnoDB)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"\u5b58\u50a8\u5f15\u64ce\u5c42 (InnoDB)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"Server \u5c42 (\u901a\u7528)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.strong,{children:"\u5185\u5bb9"})}),(0,i.jsxs)(e.td,{style:{textAlign:"left"},children:[(0,i.jsx)(e.strong,{children:"\u903b\u8f91\u65e5\u5fd7"})," (\u8bb0\u5f55\u76f8\u53cd SQL)"]}),(0,i.jsxs)(e.td,{style:{textAlign:"left"},children:[(0,i.jsx)(e.strong,{children:"\u7269\u7406\u65e5\u5fd7"})," (\u8bb0\u5f55\u9875\u4fee\u6539)"]}),(0,i.jsxs)(e.td,{style:{textAlign:"left"},children:[(0,i.jsx)(e.strong,{children:"\u903b\u8f91\u65e5\u5fd7"})," (SQL / \u6570\u636e\u884c)"]})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.strong,{children:"\u5199\u5165\u65f6\u673a"})}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"\u4e8b\u52a1\u8fdb\u884c\u4e2d\uff0c\u751a\u81f3\u63d0\u4ea4\u524d"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"\u4e8b\u52a1\u63d0\u4ea4\u65f6 (Write-Ahead Log)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"\u4e8b\u52a1\u63d0\u4ea4\u65f6"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:(0,i.jsx)(e.strong,{children:"\u91ca\u653e"})}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"\u4e8b\u52a1\u63d0\u4ea4\u540e (MVCC \u9700\u4fdd\u7559)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"\u4e8b\u52a1\u843d\u76d8\u540e"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"\u8bbe\u7f6e\u7684\u8fc7\u671f\u65f6\u95f4\u540e"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"undo-log-\u56de\u6eda\u65e5\u5fd7",children:"Undo Log (\u56de\u6eda\u65e5\u5fd7)"}),"\n",(0,i.jsx)(e.p,{children:'Undo Log \u8bb0\u5f55\u4e86\u4e8b\u52a1\u4fee\u6539\u6570\u636e\u7684"\u53cd\u5411\u64cd\u4f5c"\u3002'}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u539f\u5b50\u6027\u4fdd\u969c"}),"\uff1a\u5982\u679c\u4e8b\u52a1\u6267\u884c\u5931\u8d25\u6216\u8c03\u7528 ROLLBACK\uff0cMySQL \u5229\u7528 Undo Log \u5c06\u6570\u636e\u6062\u590d\u5230\u4e8b\u52a1\u5f00\u59cb\u524d\u7684\u72b6\u6001\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"MVCC \u652f\u6491"}),"\uff1a\u5728 MVCC \u4e2d\uff0cUndo Log \u5b58\u50a8\u4e86\u6570\u636e\u7684\u5386\u53f2\u7248\u672c\uff08\u7248\u672c\u94fe\uff09\uff0c\u4f7f\u5f97\u4e0d\u540c\u4e8b\u52a1\u53ef\u4ee5\u8bfb\u53d6\u5230\u4e0d\u540c\u65f6\u95f4\u70b9\u7684\u6570\u636e\u5feb\u7167\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u793a\u4f8b\uff1aUndo Log \u903b\u8f91\n-- \u6267\u884c\uff1aUPDATE users SET age = 20 WHERE id = 1;\n-- \u8bb0\u5f55\uff1aUPDATE users SET age = 19 WHERE id = 1; (\u53cd\u5411\u64cd\u4f5c)\n"})}),"\n",(0,i.jsx)(e.h3,{id:"redo-log-\u91cd\u505a\u65e5\u5fd7",children:"Redo Log (\u91cd\u505a\u65e5\u5fd7)"}),"\n",(0,i.jsx)(e.p,{children:"Redo Log \u662f InnoDB \u7279\u6709\u7684\u65e5\u5fd7\uff0c\u7528\u4e8e\u4fdd\u8bc1 Crash-Safe \u80fd\u529b\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7269\u7406\u65e5\u5fd7"}),'\uff1a\u8bb0\u5f55\u7684\u662f"\u5728\u67d0\u4e2a\u6570\u636e\u9875\u4e0a\u505a\u4e86\u4ec0\u4e48\u4fee\u6539"\u3002']}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"WAL \u6280\u672f"}),"\uff1aWrite-Ahead Logging\uff0c\u5148\u5199\u65e5\u5fd7\uff0c\u518d\u5199\u78c1\u76d8\u3002\u5373\u4fbf\u6570\u636e\u5e93\u5f02\u5e38\u91cd\u542f\uff0c\u901a\u8fc7 Redo Log \u4e5f\u80fd\u6062\u590d\u672a\u843d\u76d8\u7684\u6570\u636e\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5faa\u73af\u5199\u5165"}),"\uff1aRedo Log \u6587\u4ef6\u7ec4\u662f\u56fa\u5b9a\u5927\u5c0f\u7684\uff0c\u5faa\u73af\u5199\u5165\u3002\u5f53\u5199\u6ee1\u65f6\uff0c\u9700\u8981\u5c06 Checkpoint \u63a8\u8fdb\uff0c\u5f3a\u5236\u5c06\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.mermaid,{value:"graph LR\n    A[Write Pos] --\x3e|\u5199\u5165| B((Redo Log File))\n    B --\x3e|\u540c\u6b65| C[Checkpoint]\n    C -.->|\u64e6\u9664\u65e7\u8bb0\u5f55| A"}),"\n",(0,i.jsx)(e.h3,{id:"binlog-\u4e8c\u8fdb\u5236\u65e5\u5fd7",children:"Binlog (\u4e8c\u8fdb\u5236\u65e5\u5fd7)"}),"\n",(0,i.jsx)(e.p,{children:"Binlog \u8bb0\u5f55\u4e86\u6570\u636e\u5e93\u6240\u6709 DDL \u548c DML \u8bed\u53e5\uff08\u9664\u4e86\u67e5\u8be2\u8bed\u53e5\uff09\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4e3b\u4ece\u590d\u5236"}),"\uff1a\u4ece\u5e93\u901a\u8fc7\u8bfb\u53d6\u4e3b\u5e93\u7684 Binlog \u6765\u540c\u6b65\u6570\u636e\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6570\u636e\u6062\u590d"}),"\uff1a\u901a\u8fc7 mysqlbinlog \u5de5\u5177\u53ef\u4ee5\u6062\u590d\u6570\u636e\u5230\u4efb\u610f\u65f6\u95f4\u70b9\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u683c\u5f0f"}),"\uff1a\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"STATEMENT"}),"\uff1a\u8bb0\u5f55 SQL \u8bed\u53e5 (\u53ef\u80fd\u9020\u6210\u4e3b\u4ece\u4e0d\u4e00\u81f4\uff0c\u5982 ",(0,i.jsx)(e.code,{children:"rand()"}),")"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"ROW"}),"\uff1a\u8bb0\u5f55\u6bcf\u884c\u6570\u636e\u7684\u5177\u4f53\u53d8\u66f4 (\u6700\u5b89\u5168\uff0c\u4f46\u65e5\u5fd7\u91cf\u5927)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"MIXED"}),"\uff1a\u6df7\u5408\u6a21\u5f0f"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u5199\u5165\u6d41\u7a0b--\u4e24\u9636\u6bb5\u63d0\u4ea4-2pc",children:"\u5199\u5165\u6d41\u7a0b & \u4e24\u9636\u6bb5\u63d0\u4ea4 (2PC)"}),"\n",(0,i.jsxs)(e.p,{children:["\u4e3a\u4e86\u4fdd\u8bc1 Redo Log \u548c Binlog \u7684\u4e00\u81f4\u6027\uff0cMySQL \u4f7f\u7528\u4e86",(0,i.jsx)(e.strong,{children:"\u4e24\u9636\u6bb5\u63d0\u4ea4 (Two-Phase Commit)"}),"\u3002"]}),"\n",(0,i.jsx)(e.h4,{id:"\u5199\u5165\u6d41\u7a0b\u56fe\u89e3-buffer-to-disk",children:"\u5199\u5165\u6d41\u7a0b\u56fe\u89e3 (Buffer to Disk)"}),"\n",(0,i.jsx)(e.p,{children:"\u4ee5\u4e0b\u6d41\u7a0b\u56fe\u5c55\u793a\u4e86\u6570\u636e\u4ece\u5185\u5b58\u7f13\u51b2\u533a\u6700\u7ec8\u843d\u76d8\u7684\u5b8c\u6574\u8fc7\u7a0b\uff1a"}),"\n",(0,i.jsx)(e.mermaid,{value:'flowchart TD\n    Start(["\u4e8b\u52a1\u5f00\u59cb"]) --\x3e Undo["\u5199\u5165 Undo Log Buffer"]\n    Undo --\x3e Exec["\u6267\u884c\u6570\u636e\u66f4\u65b0 (\u4fee\u6539 Buffer Pool)"]\n    Exec --\x3e RedoPrep["\u5199\u5165 Redo Log Buffer (Prepare \u72b6\u6001)"]\n    \n    subgraph Commit["\u63d0\u4ea4\u9636\u6bb5 2PC"]\n        direction TB\n        RedoPrep --\x3e Binlog["\u5199\u5165 Binlog Cache"]\n        Binlog --\x3e PersistBin{"Sync Binlog?"}\n        PersistBin --\x3e|Yes| FlushBin["fsync Binlog"]\n        FlushBin --\x3e PersistRedo{"Sync Redo?"}\n        PersistRedo --\x3e|Yes| FlushRedo["fsync Redo Log (Commit \u72b6\u6001)"]\n    end\n    \n    FlushRedo --\x3e End(["\u4e8b\u52a1\u7ed3\u675f"])'}),"\n",(0,i.jsx)(e.p,{children:"\u5982\u679c\u4e0d\u4f7f\u7528 2PC\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5148\u5199 Redo \u5373\u4f7f Crash\uff1aRedo \u6709\u8bb0\u5f55\uff0cBinlog \u65e0 -> \u4e3b\u5e93\u6709\u6570\u636e\uff0c\u4ece\u5e93\u4e22\u5931\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u5148\u5199 Binlog \u5373\u4f7f Crash\uff1aBinlog \u6709\u8bb0\u5f55\uff0cRedo \u65e0 -> \u4e3b\u5e93\u6ca1\u6570\u636e\uff0c\u4ece\u5e93\u591a\u6570\u636e\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"2pc-\u6d41\u7a0b\u8be6\u89e3",children:"2PC \u6d41\u7a0b\u8be6\u89e3"}),"\n",(0,i.jsx)(e.mermaid,{value:"sequenceDiagram\n    participant C as Client\n    participant S as Server (Executor)\n    participant E as Engine (InnoDB)\n    participant B as Binlog\n    participant R as Redo Log\n\n    C->>S: UPDATE T SET v=2 WHERE id=1\n    S->>E: \u6267\u884c\u66f4\u65b0\n    E->>E: \u5199\u5165 Undo Log\n    E->>E: \u66f4\u65b0\u5185\u5b58\u6570\u636e\n    E->>R: \u5199\u5165 Redo Log (Prepare)\n    Note right of R: \u72b6\u6001: PREPARE\n    E--\x3e>S: \u5b8c\u6210\n    S->>B: \u5199\u5165 Binlog\n    S->>E: \u63d0\u4ea4\u4e8b\u52a1\n    E->>R: \u5199\u5165 Redo Log (Commit)\n    Note right of R: \u72b6\u6001: COMMIT\n    E--\x3e>S: \u8fd4\u56de\u6210\u529f\n    S--\x3e>C: Update Success"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Prepare \u9636\u6bb5"}),"\uff1aEngine \u5c06\u4e8b\u52a1\u5199\u5165 Redo Log\uff0c\u5e76\u6807\u8bb0\u4e3a ",(0,i.jsx)(e.code,{children:"PREPARE"})," \u72b6\u6001\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Binlog \u9636\u6bb5"}),"\uff1aServer \u5c06\u4e8b\u52a1\u5199\u5165 Binlog\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Commit \u9636\u6bb5"}),"\uff1aServer \u901a\u77e5 Engine \u63d0\u4ea4\uff0cEngine \u5c06 Redo Log \u6807\u8bb0\u4e3a ",(0,i.jsx)(e.code,{children:"COMMIT"})," \u72b6\u6001\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5d29\u6e83\u6062\u590d\u89c4\u5219"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5982\u679c\u6709 Binlog \u4e14\u5b8c\u6574 -> \u63d0\u4ea4\u4e8b\u52a1"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679c\u6ca1\u6709 Binlog \u6216\u4e0d\u5b8c\u6574 -> \u56de\u6eda\u4e8b\u52a1"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsx)(e.h3,{id:"\u4e8b\u52a1\u4f7f\u7528\u89c4\u8303",children:"\u4e8b\u52a1\u4f7f\u7528\u89c4\u8303"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.p,{children:["[!IMPORTANT] > ",(0,i.jsx)(e.strong,{children:"\u4e8b\u52a1\u6700\u4f73\u5b9e\u8df5"}),":"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u4fdd\u6301\u4e8b\u52a1\u7b80\u77ed\uff0c\u51cf\u5c11\u9501\u6301\u6709\u65f6\u95f4"}),"\n",(0,i.jsx)(e.li,{children:"\u907f\u514d\u5728\u4e8b\u52a1\u4e2d\u6267\u884c\u8017\u65f6\u64cd\u4f5c\uff08\u5982\u7f51\u7edc\u8bf7\u6c42\uff09"}),"\n",(0,i.jsx)(e.li,{children:"\u5408\u7406\u9009\u62e9\u9694\u79bb\u7ea7\u522b\uff08\u4e00\u822c\u7528\u9ed8\u8ba4\u7684 REPEATABLE READ\uff09"}),"\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528\u7d22\u5f15\u8bbf\u95ee\u6570\u636e\uff0c\u51cf\u5c11\u9501\u8303\u56f4"}),"\n",(0,i.jsx)(e.li,{children:"\u7edf\u4e00\u8bbf\u95ee\u987a\u5e8f\uff0c\u907f\u514d\u6b7b\u9501"}),"\n",(0,i.jsx)(e.li,{children:"\u53ca\u65f6\u63d0\u4ea4\u6216\u56de\u6eda\u4e8b\u52a1"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u793a\u4f8b\u89c4\u8303\u7684\u4e8b\u52a1\u5904\u7406",children:"\u793a\u4f8b\uff1a\u89c4\u8303\u7684\u4e8b\u52a1\u5904\u7406"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u2705 \u597d\u7684\u4e8b\u52a1\nSTART TRANSACTION;\n-- 1. \u5feb\u901f\u6267\u884c\nUPDATE accounts SET balance = balance - 100 WHERE user_id = 1;\nUPDATE accounts SET balance = balance + 100 WHERE user_id = 2;\n-- 2. \u53ca\u65f6\u63d0\u4ea4\nCOMMIT;\n\n-- \u274c \u4e0d\u597d\u7684\u4e8b\u52a1\nSTART TRANSACTION;\n-- 1. \u8017\u65f6\u64cd\u4f5c\nSELECT * FROM large_table;  -- \u5168\u8868\u626b\u63cf\n-- 2. \u5916\u90e8\u8c03\u7528\n-- \u8c03\u7528\u5916\u90e8 API\uff08\u7f51\u7edc\u5ef6\u8fdf\uff09\n-- 3. \u957f\u65f6\u95f4\u6301\u6709\u9501\n-- ... \u5176\u4ed6\u64cd\u4f5c\nCOMMIT;\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4f7f\u7528\u5b58\u50a8\u8fc7\u7a0b\u5904\u7406\u4e8b\u52a1\u548c\u9519\u8bef\nDELIMITER //\n\nCREATE PROCEDURE transfer_money(\n    IN from_user_id INT,\n    IN to_user_id INT,\n    IN amount DECIMAL(10,2)\n)\nBEGIN\n    DECLARE EXIT HANDLER FOR SQLEXCEPTION\n    BEGIN\n        ROLLBACK;  -- \u53d1\u751f\u9519\u8bef\u65f6\u56de\u6eda\n    END;\n\n    START TRANSACTION;\n\n    UPDATE accounts SET balance = balance - amount WHERE user_id = from_user_id;\n    UPDATE accounts SET balance = balance + amount WHERE user_id = to_user_id;\n\n    COMMIT;  -- \u6210\u529f\u65f6\u63d0\u4ea4\nEND//\n\nDELIMITER ;\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,i.jsx)(e.p,{children:"\u672c\u6587\u8be6\u7ec6\u4ecb\u7ecd\u4e86 MySQL \u4e8b\u52a1\u5904\u7406\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u2705 ACID \u7279\u6027\uff1a\u539f\u5b50\u6027\u3001\u4e00\u81f4\u6027\u3001\u9694\u79bb\u6027\u3001\u6301\u4e45\u6027"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 \u4e8b\u52a1\u64cd\u4f5c\uff1aBEGIN\u3001COMMIT\u3001ROLLBACK\u3001SAVEPOINT"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 \u9694\u79bb\u7ea7\u522b\uff1aREAD UNCOMMITTED\u3001READ COMMITTED\u3001REPEATABLE READ\u3001SERIALIZABLE"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 \u9501\u673a\u5236\uff1a\u8868\u9501\u3001\u884c\u9501\u3001\u95f4\u9699\u9501\u3001Next-Key Lock"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 \u6b7b\u9501\u68c0\u6d4b\u548c\u907f\u514d"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 MVCC \u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 \u4e8b\u52a1\u65e5\u5fd7\uff1aUndo Log\u3001Redo Log\u3001Binlog"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u638c\u63e1\u4e8b\u52a1\u5904\u7406\u540e\uff0c\u53ef\u4ee5\u7ee7\u7eed\u5b66\u4e60 ",(0,i.jsx)(e.a,{href:"/docs/mysql/performance-optimization",children:"\u6027\u80fd\u4f18\u5316"}),"\uff01"]})]})}function a(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(t,{...n})}):t(n)}}}]);
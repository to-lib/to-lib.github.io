"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[62045],{48885:(n,e,d)=>{d.d(e,{R:()=>c,x:()=>i});var s=d(99378);const r={},l=s.createContext(r);function c(n){const e=s.useContext(l);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),s.createElement(l.Provider,{value:e},n.children)}},87197:(n,e,d)=>{d.r(e),d.d(e,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"docker/advanced-networking","title":"\u9ad8\u7ea7\u7f51\u7edc","description":"IPVLAN\u3001\u5bb9\u5668 DNS \u539f\u7406\u4e0e IPv6 \u53cc\u6808\u914d\u7f6e","source":"@site/docs/docker/advanced-networking.md","sourceDirName":"docker","slug":"/docker/advanced-networking","permalink":"/docs/docker/advanced-networking","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/docker/advanced-networking.md","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20,"title":"\u9ad8\u7ea7\u7f51\u7edc","description":"IPVLAN\u3001\u5bb9\u5668 DNS \u539f\u7406\u4e0e IPv6 \u53cc\u6808\u914d\u7f6e"}}');var r=d(22714),l=d(48885);const c={sidebar_position:20,title:"\u9ad8\u7ea7\u7f51\u7edc",description:"IPVLAN\u3001\u5bb9\u5668 DNS \u539f\u7406\u4e0e IPv6 \u53cc\u6808\u914d\u7f6e"},i="\u9ad8\u7ea7\u7f51\u7edc",a={},o=[{value:"IPVLAN \u7f51\u7edc",id:"ipvlan-\u7f51\u7edc",level:2},{value:"IPVLAN vs Macvlan",id:"ipvlan-vs-macvlan",level:3},{value:"IPVLAN L2 \u6a21\u5f0f",id:"ipvlan-l2-\u6a21\u5f0f",level:3},{value:"IPVLAN L3 \u6a21\u5f0f",id:"ipvlan-l3-\u6a21\u5f0f",level:3},{value:"\u5bb9\u5668 DNS \u539f\u7406",id:"\u5bb9\u5668-dns-\u539f\u7406",level:2},{value:"\u5185\u7f6e DNS \u670d\u52a1\u5668",id:"\u5185\u7f6e-dns-\u670d\u52a1\u5668",level:3},{value:"DNS \u89e3\u6790\u6d41\u7a0b",id:"dns-\u89e3\u6790\u6d41\u7a0b",level:3},{value:"\u81ea\u5b9a\u4e49 DNS \u914d\u7f6e",id:"\u81ea\u5b9a\u4e49-dns-\u914d\u7f6e",level:3},{value:"\u5168\u5c40 DNS \u914d\u7f6e",id:"\u5168\u5c40-dns-\u914d\u7f6e",level:3},{value:"Docker Compose DNS",id:"docker-compose-dns",level:3},{value:"IPv6 \u652f\u6301",id:"ipv6-\u652f\u6301",level:2},{value:"\u542f\u7528 IPv6",id:"\u542f\u7528-ipv6",level:3},{value:"\u521b\u5efa IPv6 \u7f51\u7edc",id:"\u521b\u5efa-ipv6-\u7f51\u7edc",level:3},{value:"Docker Compose IPv6",id:"docker-compose-ipv6",level:3},{value:"\u7f51\u7edc\u6027\u80fd\u4f18\u5316",id:"\u7f51\u7edc\u6027\u80fd\u4f18\u5316",level:2},{value:"\u4f7f\u7528 host \u7f51\u7edc",id:"\u4f7f\u7528-host-\u7f51\u7edc",level:3},{value:"\u8c03\u6574 MTU",id:"\u8c03\u6574-mtu",level:3},{value:"\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u5171\u4eab",id:"\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u5171\u4eab",level:3},{value:"\u7f51\u7edc\u6545\u969c\u6392\u67e5",id:"\u7f51\u7edc\u6545\u969c\u6392\u67e5",level:2},{value:"\u5e38\u7528\u8bca\u65ad\u547d\u4ee4",id:"\u5e38\u7528\u8bca\u65ad\u547d\u4ee4",level:3},{value:"\u4f7f\u7528 netshoot \u5de5\u5177",id:"\u4f7f\u7528-netshoot-\u5de5\u5177",level:3},{value:"\u68c0\u67e5 iptables \u89c4\u5219",id:"\u68c0\u67e5-iptables-\u89c4\u5219",level:3}];function t(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"\u9ad8\u7ea7\u7f51\u7edc",children:"\u9ad8\u7ea7\u7f51\u7edc"})}),"\n",(0,r.jsx)(e.p,{children:"\u6df1\u5165\u7406\u89e3 Docker \u7f51\u7edc\u7684\u9ad8\u7ea7\u7279\u6027\u548c\u914d\u7f6e\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"ipvlan-\u7f51\u7edc",children:"IPVLAN \u7f51\u7edc"}),"\n",(0,r.jsx)(e.p,{children:"IPVLAN \u5141\u8bb8\u5bb9\u5668\u76f4\u63a5\u4f7f\u7528\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u7684 IP \u5730\u5740\uff0c\u65e0\u9700 NAT\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"ipvlan-vs-macvlan",children:"IPVLAN vs Macvlan"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u7279\u6027"}),(0,r.jsx)(e.th,{children:"IPVLAN"}),(0,r.jsx)(e.th,{children:"Macvlan"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"MAC \u5730\u5740"}),(0,r.jsx)(e.td,{children:"\u5171\u4eab\u4e3b\u673a MAC"}),(0,r.jsx)(e.td,{children:"\u6bcf\u4e2a\u5bb9\u5668\u72ec\u7acb MAC"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u4ea4\u6362\u673a\u517c\u5bb9"}),(0,r.jsx)(e.td,{children:"\u66f4\u597d"}),(0,r.jsx)(e.td,{children:"\u53ef\u80fd\u89e6\u53d1\u7aef\u53e3\u5b89\u5168"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6027\u80fd"}),(0,r.jsx)(e.td,{children:"\u7565\u9ad8"}),(0,r.jsx)(e.td,{children:"\u9ad8"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u9002\u7528\u573a\u666f"}),(0,r.jsx)(e.td,{children:"\u4e91\u73af\u5883\u3001MAC \u9650\u5236\u573a\u666f"}),(0,r.jsx)(e.td,{children:"\u9700\u8981\u72ec\u7acb MAC \u7684\u573a\u666f"})]})]})]}),"\n",(0,r.jsx)(e.h3,{id:"ipvlan-l2-\u6a21\u5f0f",children:"IPVLAN L2 \u6a21\u5f0f"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u521b\u5efa IPVLAN L2 \u7f51\u7edc\ndocker network create -d ipvlan \\\n  --subnet=192.168.1.0/24 \\\n  --gateway=192.168.1.1 \\\n  -o parent=eth0 \\\n  -o ipvlan_mode=l2 \\\n  ipvlan-l2\n\n# \u8fd0\u884c\u5bb9\u5668\ndocker run -d --network ipvlan-l2 --ip 192.168.1.100 nginx\n"})}),"\n",(0,r.jsx)(e.h3,{id:"ipvlan-l3-\u6a21\u5f0f",children:"IPVLAN L3 \u6a21\u5f0f"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u521b\u5efa IPVLAN L3 \u7f51\u7edc\ndocker network create -d ipvlan \\\n  --subnet=10.10.10.0/24 \\\n  -o parent=eth0 \\\n  -o ipvlan_mode=l3 \\\n  ipvlan-l3\n\n# L3 \u6a21\u5f0f\u9700\u8981\u5728\u8def\u7531\u5668\u4e0a\u914d\u7f6e\u8def\u7531\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u5bb9\u5668-dns-\u539f\u7406",children:"\u5bb9\u5668 DNS \u539f\u7406"}),"\n",(0,r.jsx)(e.p,{children:"Docker \u5185\u7f6e DNS \u670d\u52a1\u5668\u4e3a\u5bb9\u5668\u63d0\u4f9b\u540d\u79f0\u89e3\u6790\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u5185\u7f6e-dns-\u670d\u52a1\u5668",children:"\u5185\u7f6e DNS \u670d\u52a1\u5668"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  Container                       \u2502\n\u2502  /etc/resolv.conf:                              \u2502\n\u2502  nameserver 127.0.0.11                          \u2502\n\u2502  options ndots:0                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502 DNS Query\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           Docker Embedded DNS (127.0.0.11)       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502 1. \u68c0\u67e5\u5bb9\u5668\u540d/\u670d\u52a1\u540d/\u7f51\u7edc\u522b\u540d            \u2502    \u2502\n\u2502  \u2502 2. \u68c0\u67e5 --link \u914d\u7f6e                     \u2502    \u2502\n\u2502  \u2502 3. \u8f6c\u53d1\u5230\u5916\u90e8 DNS                       \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(e.h3,{id:"dns-\u89e3\u6790\u6d41\u7a0b",children:"DNS \u89e3\u6790\u6d41\u7a0b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u5bb9\u5668 DNS \u914d\u7f6e\ndocker exec container cat /etc/resolv.conf\n\n# \u6d4b\u8bd5 DNS \u89e3\u6790\ndocker exec container nslookup other-container\n\n# \u67e5\u770b DNS \u89e3\u6790\u8be6\u60c5\ndocker exec container dig other-container\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u81ea\u5b9a\u4e49-dns-\u914d\u7f6e",children:"\u81ea\u5b9a\u4e49 DNS \u914d\u7f6e"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u8fd0\u884c\u65f6\u6307\u5b9a DNS\ndocker run --dns 8.8.8.8 --dns 8.8.4.4 nginx\n\n# \u6307\u5b9a DNS \u641c\u7d22\u57df\ndocker run --dns-search example.com nginx\n\n# \u6dfb\u52a0 hosts \u8bb0\u5f55\ndocker run --add-host db.local:192.168.1.100 nginx\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u5168\u5c40-dns-\u914d\u7f6e",children:"\u5168\u5c40 DNS \u914d\u7f6e"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'// /etc/docker/daemon.json\n{\n  "dns": ["8.8.8.8", "8.8.4.4"],\n  "dns-search": ["example.com"],\n  "dns-opts": ["ndots:1"]\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"docker-compose-dns",children:"Docker Compose DNS"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'services:\n  app:\n    image: myapp\n    dns:\n      - 8.8.8.8\n      - 8.8.4.4\n    dns_search:\n      - example.com\n    extra_hosts:\n      - "db.local:192.168.1.100"\n    networks:\n      mynet:\n        aliases:\n          - app.local\n          - api.local\n'})}),"\n",(0,r.jsx)(e.h2,{id:"ipv6-\u652f\u6301",children:"IPv6 \u652f\u6301"}),"\n",(0,r.jsx)(e.h3,{id:"\u542f\u7528-ipv6",children:"\u542f\u7528 IPv6"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'// /etc/docker/daemon.json\n{\n  "ipv6": true,\n  "fixed-cidr-v6": "2001:db8:1::/64"\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u91cd\u542f Docker\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"sudo systemctl restart docker\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u521b\u5efa-ipv6-\u7f51\u7edc",children:"\u521b\u5efa IPv6 \u7f51\u7edc"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u521b\u5efa\u53cc\u6808\u7f51\u7edc\ndocker network create \\\n  --ipv6 \\\n  --subnet=172.20.0.0/16 \\\n  --subnet=2001:db8:2::/64 \\\n  dual-stack\n\n# \u8fd0\u884c\u5bb9\u5668\ndocker run -d --network dual-stack nginx\n\n# \u9a8c\u8bc1 IPv6\ndocker exec container ip -6 addr\n"})}),"\n",(0,r.jsx)(e.h3,{id:"docker-compose-ipv6",children:"Docker Compose IPv6"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'version: "3.8"\n\nservices:\n  web:\n    image: nginx\n    networks:\n      dual-stack:\n        ipv4_address: 172.20.0.10\n        ipv6_address: 2001:db8:2::10\n\nnetworks:\n  dual-stack:\n    enable_ipv6: true\n    ipam:\n      config:\n        - subnet: 172.20.0.0/16\n        - subnet: 2001:db8:2::/64\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u7f51\u7edc\u6027\u80fd\u4f18\u5316",children:"\u7f51\u7edc\u6027\u80fd\u4f18\u5316"}),"\n",(0,r.jsx)(e.h3,{id:"\u4f7f\u7528-host-\u7f51\u7edc",children:"\u4f7f\u7528 host \u7f51\u7edc"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u6700\u9ad8\u6027\u80fd\uff0c\u65e0\u7f51\u7edc\u9694\u79bb\ndocker run --network host nginx\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u8c03\u6574-mtu",children:"\u8c03\u6574 MTU"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'// /etc/docker/daemon.json\n{\n  "mtu": 9000  // Jumbo frames\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u5171\u4eab",children:"\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u5171\u4eab"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u591a\u4e2a\u5bb9\u5668\u5171\u4eab\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\ndocker run -d --name web nginx\ndocker run -d --network container:web redis\n# redis \u4e0e web \u5171\u4eab\u7f51\u7edc\uff0c\u53ef\u901a\u8fc7 localhost \u901a\u4fe1\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u7f51\u7edc\u6545\u969c\u6392\u67e5",children:"\u7f51\u7edc\u6545\u969c\u6392\u67e5"}),"\n",(0,r.jsx)(e.h3,{id:"\u5e38\u7528\u8bca\u65ad\u547d\u4ee4",children:"\u5e38\u7528\u8bca\u65ad\u547d\u4ee4"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u7f51\u7edc\u8be6\u60c5\ndocker network inspect bridge\n\n# \u67e5\u770b\u5bb9\u5668\u7f51\u7edc\u914d\u7f6e\ndocker inspect --format '{{json .NetworkSettings}}' container | jq\n\n# \u5bb9\u5668\u5185\u7f51\u7edc\u8bca\u65ad\ndocker exec container ip addr\ndocker exec container ip route\ndocker exec container netstat -tlnp\ndocker exec container ss -tlnp\n\n# \u6293\u5305\u5206\u6790\ndocker run --net=host --privileged -v /tmp:/tmp \\\n  nicolaka/netshoot tcpdump -i docker0 -w /tmp/capture.pcap\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u4f7f\u7528-netshoot-\u5de5\u5177",children:"\u4f7f\u7528 netshoot \u5de5\u5177"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u8fd0\u884c\u7f51\u7edc\u8bca\u65ad\u5bb9\u5668\ndocker run -it --net container:target_container \\\n  nicolaka/netshoot\n\n# \u53ef\u7528\u5de5\u5177\uff1aping, curl, dig, nslookup, tcpdump, iperf, netstat \u7b49\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u68c0\u67e5-iptables-\u89c4\u5219",children:"\u68c0\u67e5 iptables \u89c4\u5219"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b Docker \u76f8\u5173\u7684 iptables \u89c4\u5219\nsudo iptables -L -n -t nat\nsudo iptables -L -n -t filter\n\n# \u67e5\u770b DOCKER \u94fe\nsudo iptables -L DOCKER -n -v\n"})})]})}function h(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(t,{...n})}):t(n)}}}]);
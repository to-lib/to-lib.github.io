"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[7961],{48885:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>a});var t=s(99378);const r={},o=t.createContext(r);function i(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:n},e.children)}},94978:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"springboot/testing","title":"Spring Boot \u6d4b\u8bd5","description":"[!TIP]","source":"@site/docs/springboot/testing.md","sourceDirName":"springboot","slug":"/springboot/testing","permalink":"/docs/springboot/testing","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/springboot/testing.md","tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"sidebar_position":14},"sidebar":"springboot","previous":{"title":"\u6d88\u606f\u961f\u5217","permalink":"/docs/springboot/message-queue"},"next":{"title":"security","permalink":"/docs/springboot/security"}}');var r=s(22714),o=s(48885);const i={sidebar_position:14},a="Spring Boot \u6d4b\u8bd5",c={},l=[{value:"\u6d4b\u8bd5\u4f9d\u8d56",id:"\u6d4b\u8bd5\u4f9d\u8d56",level:2},{value:"\u5355\u5143\u6d4b\u8bd5",id:"\u5355\u5143\u6d4b\u8bd5",level:2},{value:"\u57fa\u672c\u5355\u5143\u6d4b\u8bd5",id:"\u57fa\u672c\u5355\u5143\u6d4b\u8bd5",level:3},{value:"\u4f7f\u7528 Mockito",id:"\u4f7f\u7528-mockito",level:3},{value:"Spring Boot \u96c6\u6210\u6d4b\u8bd5",id:"spring-boot-\u96c6\u6210\u6d4b\u8bd5",level:2},{value:"@SpringBootTest",id:"springboottest",level:3},{value:"WebEnvironment \u914d\u7f6e",id:"webenvironment-\u914d\u7f6e",level:3},{value:"Web \u5c42\u6d4b\u8bd5",id:"web-\u5c42\u6d4b\u8bd5",level:2},{value:"MockMvc \u6d4b\u8bd5",id:"mockmvc-\u6d4b\u8bd5",level:3},{value:"TestRestTemplate \u6d4b\u8bd5",id:"testresttemplate-\u6d4b\u8bd5",level:3},{value:"WebTestClient \u6d4b\u8bd5\uff08\u54cd\u5e94\u5f0f\uff09",id:"webtestclient-\u6d4b\u8bd5\u54cd\u5e94\u5f0f",level:3},{value:"\u6570\u636e\u5c42\u6d4b\u8bd5",id:"\u6570\u636e\u5c42\u6d4b\u8bd5",level:2},{value:"@DataJpaTest",id:"datajpatest",level:3},{value:"\u6d4b\u8bd5\u914d\u7f6e",id:"\u6d4b\u8bd5\u914d\u7f6e",level:2},{value:"\u6d4b\u8bd5\u914d\u7f6e\u6587\u4ef6",id:"\u6d4b\u8bd5\u914d\u7f6e\u6587\u4ef6",level:3},{value:"\u81ea\u5b9a\u4e49\u6d4b\u8bd5\u914d\u7f6e",id:"\u81ea\u5b9a\u4e49\u6d4b\u8bd5\u914d\u7f6e",level:3},{value:"Testcontainers",id:"testcontainers",level:2},{value:"\u4f9d\u8d56",id:"\u4f9d\u8d56",level:3},{value:"MySQL Testcontainer",id:"mysql-testcontainer",level:3},{value:"\u6d4b\u8bd5\u5207\u7247",id:"\u6d4b\u8bd5\u5207\u7247",level:2},{value:"@JsonTest \u793a\u4f8b",id:"jsontest-\u793a\u4f8b",level:3},{value:"\u6027\u80fd\u6d4b\u8bd5",id:"\u6027\u80fd\u6d4b\u8bd5",level:2},{value:"JMH \u57fa\u51c6\u6d4b\u8bd5",id:"jmh-\u57fa\u51c6\u6d4b\u8bd5",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u6d4b\u8bd5\u547d\u540d\u89c4\u8303",id:"\u6d4b\u8bd5\u547d\u540d\u89c4\u8303",level:3},{value:"\u6d4b\u8bd5\u6570\u636e\u51c6\u5907",id:"\u6d4b\u8bd5\u6570\u636e\u51c6\u5907",level:3},{value:"\u6d4b\u8bd5\u8986\u76d6\u7387",id:"\u6d4b\u8bd5\u8986\u76d6\u7387",level:2},{value:"JaCoCo \u914d\u7f6e",id:"jacoco-\u914d\u7f6e",level:3},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"spring-boot-\u6d4b\u8bd5",children:"Spring Boot \u6d4b\u8bd5"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["[!TIP]\n",(0,r.jsx)(n.strong,{children:"\u6d4b\u8bd5\u91d1\u5b57\u5854\u539f\u5219"}),": \u5355\u5143\u6d4b\u8bd5\uff0870%\uff09> \u96c6\u6210\u6d4b\u8bd5\uff0820%\uff09> \u7aef\u5230\u7aef\u6d4b\u8bd5\uff0810%\uff09\u3002\u597d\u7684\u6d4b\u8bd5\u8986\u76d6\u7387\u662f\u9ad8\u8d28\u91cf\u4ee3\u7801\u7684\u4fdd\u8bc1\uff01"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u6d4b\u8bd5\u4f9d\u8d56",children:"\u6d4b\u8bd5\u4f9d\u8d56"}),"\n",(0,r.jsxs)(n.p,{children:["Spring Boot \u63d0\u4f9b\u4e86 ",(0,r.jsx)(n.code,{children:"spring-boot-starter-test"})," \u4f9d\u8d56\uff0c\u5305\u542b\u4e86\u5e38\u7528\u7684\u6d4b\u8bd5\u5e93\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-test</artifactId>\n    <scope>test</scope>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u4e2a Starter \u5305\u542b\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"JUnit 5"})," - \u5355\u5143\u6d4b\u8bd5\u6846\u67b6"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Spring Test"})," - Spring \u96c6\u6210\u6d4b\u8bd5\u652f\u6301"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"AssertJ"})," - \u6d41\u5f0f\u65ad\u8a00\u5e93"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Hamcrest"})," - \u5339\u914d\u5668\u5e93"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mockito"})," - Mock \u6846\u67b6"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"JSONassert"})," - JSON \u65ad\u8a00"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"JsonPath"})," - JSON \u8def\u5f84\u8868\u8fbe\u5f0f"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u5355\u5143\u6d4b\u8bd5",children:"\u5355\u5143\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h3,{id:"\u57fa\u672c\u5355\u5143\u6d4b\u8bd5",children:"\u57fa\u672c\u5355\u5143\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.DisplayName;\nimport static org.assertj.core.api.Assertions.assertThat;\n\n@DisplayName("\u7528\u6237\u670d\u52a1\u6d4b\u8bd5")\nclass UserServiceTest {\n    \n    @Test\n    @DisplayName("\u5e94\u8be5\u6b63\u786e\u521b\u5efa\u7528\u6237")\n    void shouldCreateUser() {\n        // Given - \u51c6\u5907\u6d4b\u8bd5\u6570\u636e\n        String username = "john";\n        String email = "john@example.com";\n        \n        // When - \u6267\u884c\u6d4b\u8bd5\u903b\u8f91\n        User user = new User(username, email);\n        \n        // Then - \u9a8c\u8bc1\u7ed3\u679c\n        assertThat(user.getUsername()).isEqualTo(username);\n        assertThat(user.getEmail()).isEqualTo(email);\n        assertThat(user.getId()).isNull();\n    }\n    \n    @Test\n    @DisplayName("\u7a7a\u7528\u6237\u540d\u5e94\u8be5\u629b\u51fa\u5f02\u5e38")\n    void shouldThrowExceptionForNullUsername() {\n        assertThatThrownBy(() -> new User(null, "test@example.com"))\n            .isInstanceOf(IllegalArgumentException.class)\n            .hasMessage("Username cannot be null");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u4f7f\u7528-mockito",children:"\u4f7f\u7528 Mockito"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.extension.ExtendWith;\nimport org.mockito.InjectMocks;\nimport org.mockito.Mock;\nimport org.mockito.junit.jupiter.MockitoExtension;\nimport static org.mockito.Mockito.*;\nimport static org.assertj.core.api.Assertions.assertThat;\n\n@ExtendWith(MockitoExtension.class)\nclass UserServiceTest {\n    \n    @Mock\n    private UserRepository userRepository;\n    \n    @InjectMocks\n    private UserService userService;\n    \n    private User testUser;\n    \n    @BeforeEach\n    void setUp() {\n        testUser = new User("john", "john@example.com");\n        testUser.setId(1L);\n    }\n    \n    @Test\n    @DisplayName("\u5e94\u8be5\u901a\u8fc7ID\u67e5\u627e\u7528\u6237")\n    void shouldFindUserById() {\n        // Given\n        when(userRepository.findById(1L))\n            .thenReturn(Optional.of(testUser));\n        \n        // When\n        User found = userService.findById(1L);\n        \n        // Then\n        assertThat(found).isNotNull();\n        assertThat(found.getUsername()).isEqualTo("john");\n        verify(userRepository, times(1)).findById(1L);\n    }\n    \n    @Test\n    @DisplayName("\u5e94\u8be5\u4fdd\u5b58\u7528\u6237")\n    void shouldSaveUser() {\n        // Given\n        User newUser = new User("jane", "jane@example.com");\n        when(userRepository.save(any(User.class)))\n            .thenReturn(newUser);\n        \n        // When\n        User saved = userService.save(newUser);\n        \n        // Then\n        assertThat(saved).isNotNull();\n        assertThat(saved.getUsername()).isEqualTo("jane");\n        verify(userRepository).save(newUser);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"spring-boot-\u96c6\u6210\u6d4b\u8bd5",children:"Spring Boot \u96c6\u6210\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h3,{id:"springboottest",children:"@SpringBootTest"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.test.context.ActiveProfiles;\n\n@SpringBootTest\n@ActiveProfiles("test")\nclass UserServiceIntegrationTest {\n    \n    @Autowired\n    private UserService userService;\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    @Test\n    void shouldSaveAndRetrieveUser() {\n        // Given\n        User user = new User("john", "john@example.com");\n        \n        // When\n        User saved = userService.save(user);\n        User found = userService.findById(saved.getId());\n        \n        // Then\n        assertThat(found).isNotNull();\n        assertThat(found.getUsername()).isEqualTo("john");\n        assertThat(found.getEmail()).isEqualTo("john@example.com");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"webenvironment-\u914d\u7f6e",children:"WebEnvironment \u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"// 1. Mock \u73af\u5883\uff08\u9ed8\u8ba4\uff09- \u4e0d\u542f\u52a8\u771f\u5b9e\u670d\u52a1\u5668\n@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.MOCK)\n\n// 2. \u968f\u673a\u7aef\u53e3 - \u542f\u52a8\u771f\u5b9e\u670d\u52a1\u5668\uff0c\u4f7f\u7528\u968f\u673a\u7aef\u53e3\n@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)\n\n// 3. \u5b9a\u4e49\u7aef\u53e3 - \u542f\u52a8\u771f\u5b9e\u670d\u52a1\u5668\uff0c\u4f7f\u7528\u6307\u5b9a\u7aef\u53e3\n@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT)\n\n// 4. \u4e0d\u542f\u52a8 Web \u73af\u5883\n@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.NONE)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"web-\u5c42\u6d4b\u8bd5",children:"Web \u5c42\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h3,{id:"mockmvc-\u6d4b\u8bd5",children:"MockMvc \u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;\nimport org.springframework.boot.test.mock.mockito.MockBean;\nimport org.springframework.http.MediaType;\nimport org.springframework.test.web.servlet.MockMvc;\n\nimport static org.mockito.ArgumentMatchers.any;\nimport static org.mockito.Mockito.when;\nimport static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;\nimport static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;\nimport static org.hamcrest.Matchers.*;\n\n@WebMvcTest(UserController.class)\nclass UserControllerTest {\n    \n    @Autowired\n    private MockMvc mockMvc;\n    \n    @MockBean\n    private UserService userService;\n    \n    @Test\n    @DisplayName("GET /api/users/{id} \u5e94\u8be5\u8fd4\u56de\u7528\u6237")\n    void shouldReturnUser() throws Exception {\n        // Given\n        User user = new User("john", "john@example.com");\n        user.setId(1L);\n        when(userService.findById(1L)).thenReturn(user);\n        \n        // When & Then\n        mockMvc.perform(get("/api/users/1"))\n            .andExpect(status().isOk())\n            .andExpect(content().contentType(MediaType.APPLICATION_JSON))\n            .andExpect(jsonPath("$.id", is(1)))\n            .andExpect(jsonPath("$.username", is("john")))\n            .andExpect(jsonPath("$.email", is("john@example.com")));\n    }\n    \n    @Test\n    @DisplayName("POST /api/users \u5e94\u8be5\u521b\u5efa\u7528\u6237")\n    void shouldCreateUser() throws Exception {\n        // Given\n        User user = new User("jane", "jane@example.com");\n        user.setId(2L);\n        when(userService.save(any(User.class))).thenReturn(user);\n        \n        String userJson = """\n            {\n                "username": "jane",\n                "email": "jane@example.com"\n            }\n            """;\n        \n        // When & Then\n        mockMvc.perform(post("/api/users")\n                .contentType(MediaType.APPLICATION_JSON)\n                .content(userJson))\n            .andExpect(status().isCreated())\n            .andExpect(jsonPath("$.id", is(2)))\n            .andExpect(jsonPath("$.username", is("jane")));\n    }\n    \n    @Test\n    @DisplayName("GET /api/users/{id} \u7528\u6237\u4e0d\u5b58\u5728\u5e94\u8be5\u8fd4\u56de404")\n    void shouldReturn404WhenUserNotFound() throws Exception {\n        // Given\n        when(userService.findById(999L)).thenReturn(null);\n        \n        // When & Then\n        mockMvc.perform(get("/api/users/999"))\n            .andExpect(status().isNotFound());\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"testresttemplate-\u6d4b\u8bd5",children:"TestRestTemplate \u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.boot.test.web.client.TestRestTemplate;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.ResponseEntity;\n\n@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)\nclass UserControllerIntegrationTest {\n    \n    @Autowired\n    private TestRestTemplate restTemplate;\n    \n    @Test\n    void shouldCreateAndRetrieveUser() {\n        // Given\n        User newUser = new User("john", "john@example.com");\n        \n        // When - \u521b\u5efa\u7528\u6237\n        ResponseEntity<User> createResponse = restTemplate\n            .postForEntity("/api/users", newUser, User.class);\n        \n        // Then - \u9a8c\u8bc1\u521b\u5efa\n        assertThat(createResponse.getStatusCode()).isEqualTo(HttpStatus.CREATED);\n        User createdUser = createResponse.getBody();\n        assertThat(createdUser.getId()).isNotNull();\n        \n        // When - \u83b7\u53d6\u7528\u6237\n        ResponseEntity<User> getResponse = restTemplate\n            .getForEntity("/api/users/" + createdUser.getId(), User.class);\n        \n        // Then - \u9a8c\u8bc1\u83b7\u53d6\n        assertThat(getResponse.getStatusCode()).isEqualTo(HttpStatus.OK);\n        assertThat(getResponse.getBody().getUsername()).isEqualTo("john");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"webtestclient-\u6d4b\u8bd5\u54cd\u5e94\u5f0f",children:"WebTestClient \u6d4b\u8bd5\uff08\u54cd\u5e94\u5f0f\uff09"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.autoconfigure.web.reactive.AutoConfigureWebTestClient;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.test.web.reactive.server.WebTestClient;\n\n@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)\n@AutoConfigureWebTestClient\nclass UserControllerWebFluxTest {\n    \n    @Autowired\n    private WebTestClient webTestClient;\n    \n    @Test\n    void shouldGetUser() {\n        webTestClient.get()\n            .uri("/api/users/1")\n            .exchange()\n            .expectStatus().isOk()\n            .expectBody()\n            .jsonPath("$.username").isEqualTo("john")\n            .jsonPath("$.email").isEqualTo("john@example.com");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6570\u636e\u5c42\u6d4b\u8bd5",children:"\u6570\u636e\u5c42\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h3,{id:"datajpatest",children:"@DataJpaTest"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;\nimport org.springframework.boot.test.autoconfigure.orm.jpa.TestEntityManager;\n\n@DataJpaTest\nclass UserRepositoryTest {\n    \n    @Autowired\n    private TestEntityManager entityManager;\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    @Test\n    void shouldFindUserByUsername() {\n        // Given\n        User user = new User("john", "john@example.com");\n        entityManager.persist(user);\n        entityManager.flush();\n        \n        // When\n        User found = userRepository.findByUsername("john");\n        \n        // Then\n        assertThat(found).isNotNull();\n        assertThat(found.getUsername()).isEqualTo("john");\n        assertThat(found.getEmail()).isEqualTo("john@example.com");\n    }\n    \n    @Test\n    void shouldSaveUser() {\n        // Given\n        User user = new User("jane", "jane@example.com");\n        \n        // When\n        User saved = userRepository.save(user);\n        \n        // Then\n        assertThat(saved.getId()).isNotNull();\n        assertThat(userRepository.findById(saved.getId())).isPresent();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6d4b\u8bd5\u914d\u7f6e",children:"\u6d4b\u8bd5\u914d\u7f6e"}),"\n",(0,r.jsx)(n.h3,{id:"\u6d4b\u8bd5\u914d\u7f6e\u6587\u4ef6",children:"\u6d4b\u8bd5\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,r.jsxs)(n.p,{children:["\u521b\u5efa ",(0,r.jsx)(n.code,{children:"src/test/resources/application-test.yml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spring:\n  datasource:\n    url: jdbc:h2:mem:testdb\n    driver-class-name: org.h2.Driver\n    username: sa\n    password: \n  \n  jpa:\n    hibernate:\n      ddl-auto: create-drop\n    show-sql: true\n    properties:\n      hibernate:\n        format_sql: true\n  \n  h2:\n    console:\n      enabled: true\n\nlogging:\n  level:\n    org.springframework: INFO\n    com.example: DEBUG\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49\u6d4b\u8bd5\u914d\u7f6e",children:"\u81ea\u5b9a\u4e49\u6d4b\u8bd5\u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"import org.springframework.boot.test.context.TestConfiguration;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Primary;\n\n@TestConfiguration\npublic class TestConfig {\n    \n    @Bean\n    @Primary\n    public UserService testUserService() {\n        return new UserService() {\n            // \u6d4b\u8bd5\u4e13\u7528\u5b9e\u73b0\n        };\n    }\n}\n\n// \u5728\u6d4b\u8bd5\u7c7b\u4e2d\u4f7f\u7528\n@SpringBootTest\n@Import(TestConfig.class)\nclass MyTest {\n    // ...\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"testcontainers",children:"Testcontainers"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["[!IMPORTANT]\n",(0,r.jsx)(n.strong,{children:"\u771f\u5b9e\u73af\u5883\u6d4b\u8bd5"}),": Testcontainers \u5141\u8bb8\u5728 Docker \u5bb9\u5668\u4e2d\u8fd0\u884c\u771f\u5b9e\u7684\u6570\u636e\u5e93\u3001\u6d88\u606f\u961f\u5217\u7b49\u670d\u52a1\uff0c\u63d0\u4f9b\u66f4\u63a5\u8fd1\u751f\u4ea7\u73af\u5883\u7684\u6d4b\u8bd5\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u4f9d\u8d56",children:"\u4f9d\u8d56"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.testcontainers</groupId>\n    <artifactId>testcontainers</artifactId>\n    <version>1.19.3</version>\n    <scope>test</scope>\n</dependency>\n<dependency>\n    <groupId>org.testcontainers</groupId>\n    <artifactId>mysql</artifactId>\n    <version>1.19.3</version>\n    <scope>test</scope>\n</dependency>\n<dependency>\n    <groupId>org.testcontainers</groupId>\n    <artifactId>junit-jupiter</artifactId>\n    <version>1.19.3</version>\n    <scope>test</scope>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.h3,{id:"mysql-testcontainer",children:"MySQL Testcontainer"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.test.context.DynamicPropertyRegistry;\nimport org.springframework.test.context.DynamicPropertySource;\nimport org.testcontainers.containers.MySQLContainer;\nimport org.testcontainers.junit.jupiter.Container;\nimport org.testcontainers.junit.jupiter.Testcontainers;\n\n@SpringBootTest\n@Testcontainers\nclass UserRepositoryTestcontainersTest {\n    \n    @Container\n    static MySQLContainer<?> mysql = new MySQLContainer<>("mysql:8.0")\n        .withDatabaseName("testdb")\n        .withUsername("test")\n        .withPassword("test");\n    \n    @DynamicPropertySource\n    static void properties(DynamicPropertyRegistry registry) {\n        registry.add("spring.datasource.url", mysql::getJdbcUrl);\n        registry.add("spring.datasource.username", mysql::getUsername);\n        registry.add("spring.datasource.password", mysql::getPassword);\n    }\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    @Test\n    void shouldSaveToRealDatabase() {\n        // Given\n        User user = new User("john", "john@example.com");\n        \n        // When\n        User saved = userRepository.save(user);\n        \n        // Then\n        assertThat(saved.getId()).isNotNull();\n        assertThat(userRepository.findById(saved.getId())).isPresent();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6d4b\u8bd5\u5207\u7247",children:"\u6d4b\u8bd5\u5207\u7247"}),"\n",(0,r.jsx)(n.p,{children:"Spring Boot \u63d0\u4f9b\u4e86\u591a\u79cd\u6d4b\u8bd5\u5207\u7247\u6ce8\u89e3\uff0c\u53ea\u52a0\u8f7d\u5fc5\u8981\u7684\u7ec4\u4ef6\uff1a"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u6ce8\u89e3"}),(0,r.jsx)(n.th,{children:"\u7528\u9014"}),(0,r.jsx)(n.th,{children:"\u52a0\u8f7d\u7684\u7ec4\u4ef6"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"@WebMvcTest"})}),(0,r.jsx)(n.td,{children:"Web \u5c42\u6d4b\u8bd5"}),(0,r.jsx)(n.td,{children:"Controller, Filter, Advice"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"@DataJpaTest"})}),(0,r.jsx)(n.td,{children:"JPA \u6d4b\u8bd5"}),(0,r.jsx)(n.td,{children:"Repository, EntityManager"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"@DataMongoTest"})}),(0,r.jsx)(n.td,{children:"MongoDB \u6d4b\u8bd5"}),(0,r.jsx)(n.td,{children:"MongoDB Repository"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"@DataRedisTest"})}),(0,r.jsx)(n.td,{children:"Redis \u6d4b\u8bd5"}),(0,r.jsx)(n.td,{children:"Redis Repository"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"@RestClientTest"})}),(0,r.jsx)(n.td,{children:"REST Client \u6d4b\u8bd5"}),(0,r.jsx)(n.td,{children:"RestTemplate, WebClient"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"@JsonTest"})}),(0,r.jsx)(n.td,{children:"JSON \u5e8f\u5217\u5316\u6d4b\u8bd5"}),(0,r.jsx)(n.td,{children:"JSON \u6620\u5c04\u5668"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"jsontest-\u793a\u4f8b",children:"@JsonTest \u793a\u4f8b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.autoconfigure.json.JsonTest;\nimport org.springframework.boot.test.json.JacksonTester;\n\n@JsonTest\nclass UserJsonTest {\n    \n    @Autowired\n    private JacksonTester<User> json;\n    \n    @Test\n    void shouldSerialize() throws Exception {\n        // Given\n        User user = new User("john", "john@example.com");\n        user.setId(1L);\n        \n        // When & Then\n        assertThat(json.write(user))\n            .extractingJsonPathNumberValue("$.id").isEqualTo(1);\n        assertThat(json.write(user))\n            .extractingJsonPathStringValue("$.username").isEqualTo("john");\n    }\n    \n    @Test\n    void shouldDeserialize() throws Exception {\n        // Given\n        String content = """\n            {\n                "id": 1,\n                "username": "john",\n                "email": "john@example.com"\n            }\n            """;\n        \n        // When\n        User user = json.parse(content).getObject();\n        \n        // Then\n        assertThat(user.getId()).isEqualTo(1L);\n        assertThat(user.getUsername()).isEqualTo("john");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6027\u80fd\u6d4b\u8bd5",children:"\u6027\u80fd\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h3,{id:"jmh-\u57fa\u51c6\u6d4b\u8bd5",children:"JMH \u57fa\u51c6\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.openjdk.jmh</groupId>\n    <artifactId>jmh-core</artifactId>\n    <version>1.37</version>\n    <scope>test</scope>\n</dependency>\n<dependency>\n    <groupId>org.openjdk.jmh</groupId>\n    <artifactId>jmh-generator-annprocess</artifactId>\n    <version>1.37</version>\n    <scope>test</scope>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"import org.openjdk.jmh.annotations.*;\nimport java.util.concurrent.TimeUnit;\n\n@BenchmarkMode(Mode.AverageTime)\n@OutputTimeUnit(TimeUnit.MILLISECONDS)\n@State(Scope.Benchmark)\n@Fork(value = 1, warmups = 1)\n@Warmup(iterations = 3)\n@Measurement(iterations = 5)\npublic class UserServiceBenchmark {\n    \n    private UserService userService;\n    \n    @Setup\n    public void setup() {\n        userService = new UserService();\n    }\n    \n    @Benchmark\n    public void testFindUser() {\n        userService.findById(1L);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["[!TIP]\n",(0,r.jsx)(n.strong,{children:"\u6d4b\u8bd5\u6700\u4f73\u5b9e\u8df5"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9075\u5faa AAA \u6a21\u5f0f"})," - Arrange\uff08\u51c6\u5907\uff09\u3001Act\uff08\u6267\u884c\uff09\u3001Assert\uff08\u65ad\u8a00\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6d4b\u8bd5\u547d\u540d\u6e05\u6670"})," - \u4f7f\u7528 @DisplayName \u6216 should/when \u547d\u540d\u6cd5"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9694\u79bb\u6d4b\u8bd5"})," - \u6bcf\u4e2a\u6d4b\u8bd5\u72ec\u7acb\uff0c\u4e0d\u4f9d\u8d56\u6267\u884c\u987a\u5e8f"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5408\u7406\u4f7f\u7528 Mock"})," - \u53ea Mock \u5916\u90e8\u4f9d\u8d56"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6d4b\u8bd5\u8fb9\u754c\u6761\u4ef6"})," - \u7a7a\u503c\u3001\u5f02\u5e38\u3001\u8fb9\u754c\u503c"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6301\u7eed\u96c6\u6210"})," - \u5728 CI/CD \u4e2d\u81ea\u52a8\u8fd0\u884c\u6d4b\u8bd5"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u6d4b\u8bd5\u547d\u540d\u89c4\u8303",children:"\u6d4b\u8bd5\u547d\u540d\u89c4\u8303"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u65b9\u6cd51\uff1ashould/when \u547d\u540d\u6cd5\n@Test\nvoid shouldReturnUserWhenIdExists() { }\n\n@Test\nvoid shouldThrowExceptionWhenUsernameIsNull() { }\n\n// \u65b9\u6cd52\uff1agiven/when/then \u547d\u540d\u6cd5\n@Test\nvoid givenValidUser_whenSaving_thenSuccess() { }\n\n// \u65b9\u6cd53\uff1a\u4f7f\u7528 @DisplayName\n@Test\n@DisplayName("\u7528\u6237\u540d\u4e3a\u7a7a\u65f6\u5e94\u8be5\u629b\u51fa\u5f02\u5e38")\nvoid test1() { }\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u6d4b\u8bd5\u6570\u636e\u51c6\u5907",children:"\u6d4b\u8bd5\u6570\u636e\u51c6\u5907"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u4f7f\u7528 @BeforeEach \u51c6\u5907\u901a\u7528\u6570\u636e\n@BeforeEach\nvoid setUp() {\n    testUser = new User("john", "john@example.com");\n}\n\n// \u4f7f\u7528 Builder \u6a21\u5f0f\nUser user = User.builder()\n    .username("john")\n    .email("john@example.com")\n    .age(30)\n    .build();\n\n// \u4f7f\u7528\u6d4b\u8bd5\u6570\u636e\u5de5\u5382\npublic class UserTestFactory {\n    public static User createDefaultUser() {\n        return new User("john", "john@example.com");\n    }\n    \n    public static User createUserWithId(Long id) {\n        User user = createDefaultUser();\n        user.setId(id);\n        return user;\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6d4b\u8bd5\u8986\u76d6\u7387",children:"\u6d4b\u8bd5\u8986\u76d6\u7387"}),"\n",(0,r.jsx)(n.h3,{id:"jacoco-\u914d\u7f6e",children:"JaCoCo \u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<plugin>\n    <groupId>org.jacoco</groupId>\n    <artifactId>jacoco-maven-plugin</artifactId>\n    <version>0.8.11</version>\n    <executions>\n        <execution>\n            <goals>\n                <goal>prepare-agent</goal>\n            </goals>\n        </execution>\n        <execution>\n            <id>report</id>\n            <phase>test</phase>\n            <goals>\n                <goal>report</goal>\n            </goals>\n        </execution>\n    </executions>\n</plugin>\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u8fd0\u884c\u6d4b\u8bd5\u5e76\u751f\u6210\u62a5\u544a\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mvn clean test\nmvn jacoco:report\n\n# \u62a5\u544a\u4f4d\u7f6e\uff1atarget/site/jacoco/index.html\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Q: \u5355\u5143\u6d4b\u8bd5\u548c\u96c6\u6210\u6d4b\u8bd5\u7684\u533a\u522b\uff1f"}),(0,r.jsx)(n.br,{}),"\n","A: \u5355\u5143\u6d4b\u8bd5\u53ea\u6d4b\u8bd5\u5355\u4e2a\u7c7b/\u65b9\u6cd5\uff0c\u4f7f\u7528 Mock \u9694\u79bb\u4f9d\u8d56\uff1b\u96c6\u6210\u6d4b\u8bd5\u6d4b\u8bd5\u591a\u4e2a\u7ec4\u4ef6\u7684\u534f\u4f5c\uff0c\u4f7f\u7528\u771f\u5b9e\u6216\u63a5\u8fd1\u771f\u5b9e\u7684\u4f9d\u8d56\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Q: \u4f55\u65f6\u4f7f\u7528 @SpringBootTest\uff1f"}),(0,r.jsx)(n.br,{}),"\n","A: \u9700\u8981\u5b8c\u6574\u7684 Spring \u4e0a\u4e0b\u6587\u65f6\u4f7f\u7528\uff0c\u4f46\u4f1a\u5f71\u54cd\u6d4b\u8bd5\u901f\u5ea6\u3002\u4f18\u5148\u4f7f\u7528\u66f4\u8f7b\u91cf\u7684\u6d4b\u8bd5\u5207\u7247\uff08\u5982 @WebMvcTest\uff09\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Q: \u5982\u4f55\u52a0\u901f\u6d4b\u8bd5\uff1f"}),(0,r.jsx)(n.br,{}),"\n","A:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f7f\u7528\u6d4b\u8bd5\u5207\u7247\u800c\u975e\u5b8c\u6574\u7684 @SpringBootTest"}),"\n",(0,r.jsx)(n.li,{children:"\u5408\u7406\u4f7f\u7528 Mock"}),"\n",(0,r.jsx)(n.li,{children:"\u4f7f\u7528\u5185\u5b58\u6570\u636e\u5e93\uff08H2\uff09"}),"\n",(0,r.jsx)(n.li,{children:"\u5e76\u884c\u8fd0\u884c\u6d4b\u8bd5"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5355\u5143\u6d4b\u8bd5"})," - JUnit 5 + Mockito\uff0c\u6d4b\u8bd5\u5355\u4e2a\u7ec4\u4ef6"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u96c6\u6210\u6d4b\u8bd5"})," - @SpringBootTest\uff0c\u6d4b\u8bd5\u7ec4\u4ef6\u534f\u4f5c"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Web \u6d4b\u8bd5"})," - MockMvc/WebTestClient\uff0c\u6d4b\u8bd5 API"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6570\u636e\u6d4b\u8bd5"})," - @DataJpaTest\uff0c\u6d4b\u8bd5\u6570\u636e\u5c42"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Testcontainers"})," - \u771f\u5b9e\u73af\u5883\u6d4b\u8bd5"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6d4b\u8bd5\u8986\u76d6\u7387"})," - JaCoCo \u751f\u6210\u62a5\u544a"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4e0b\u4e00\u6b65\u5b66\u4e60 ",(0,r.jsx)(n.a,{href:"/docs/springboot/aop",children:"AOP \u9762\u5411\u5207\u9762\u7f16\u7a0b"}),"\u3002"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);
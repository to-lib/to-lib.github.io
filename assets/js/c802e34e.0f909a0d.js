"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[24133],{17327:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"linux/log-management","title":"\u65e5\u5fd7\u7ba1\u7406","description":"\u65e5\u5fd7\u662f\u7cfb\u7edf\u8fd0\u7ef4\u548c\u6545\u969c\u6392\u67e5\u7684\u91cd\u8981\u4f9d\u636e\uff0c\u7406\u89e3\u65e5\u5fd7\u7cfb\u7edf\u5bf9\u4e8e\u7cfb\u7edf\u7ba1\u7406\u81f3\u5173\u91cd\u8981\u3002","source":"@site/docs/linux/log-management.md","sourceDirName":"linux","slug":"/linux/log-management","permalink":"/docs/linux/log-management","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/linux/log-management.md","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12,"title":"\u65e5\u5fd7\u7ba1\u7406"},"sidebar":"linux","previous":{"title":"\u5b9a\u65f6\u4efb\u52a1","permalink":"/docs/linux/cron-scheduling"},"next":{"title":"\u78c1\u76d8\u548c\u5b58\u50a8\u7ba1\u7406","permalink":"/docs/linux/disk-management"}}');var r=l(22714),a=l(48885);const o={sidebar_position:12,title:"\u65e5\u5fd7\u7ba1\u7406"},i="Linux \u65e5\u5fd7\u7ba1\u7406",c={},d=[{value:"\u65e5\u5fd7\u7cfb\u7edf\u6982\u8ff0",id:"\u65e5\u5fd7\u7cfb\u7edf\u6982\u8ff0",level:2},{value:"\u65e5\u5fd7\u67b6\u6784",id:"\u65e5\u5fd7\u67b6\u6784",level:3},{value:"\u65e5\u5fd7\u7ea7\u522b",id:"\u65e5\u5fd7\u7ea7\u522b",level:3},{value:"\u7cfb\u7edf\u65e5\u5fd7\u6587\u4ef6",id:"\u7cfb\u7edf\u65e5\u5fd7\u6587\u4ef6",level:2},{value:"\u6807\u51c6\u65e5\u5fd7\u4f4d\u7f6e",id:"\u6807\u51c6\u65e5\u5fd7\u4f4d\u7f6e",level:3},{value:"\u67e5\u770b\u65e5\u5fd7",id:"\u67e5\u770b\u65e5\u5fd7",level:3},{value:"journalctl",id:"journalctl",level:2},{value:"\u57fa\u7840\u4f7f\u7528",id:"\u57fa\u7840\u4f7f\u7528",level:3},{value:"\u6309\u65f6\u95f4\u67e5\u8be2",id:"\u6309\u65f6\u95f4\u67e5\u8be2",level:3},{value:"\u6309\u670d\u52a1\u67e5\u8be2",id:"\u6309\u670d\u52a1\u67e5\u8be2",level:3},{value:"\u6309\u7ea7\u522b\u67e5\u8be2",id:"\u6309\u7ea7\u522b\u67e5\u8be2",level:3},{value:"\u6309\u8fdb\u7a0b\u67e5\u8be2",id:"\u6309\u8fdb\u7a0b\u67e5\u8be2",level:3},{value:"\u542f\u52a8\u65e5\u5fd7",id:"\u542f\u52a8\u65e5\u5fd7",level:3},{value:"\u5185\u6838\u65e5\u5fd7",id:"\u5185\u6838\u65e5\u5fd7",level:3},{value:"\u8f93\u51fa\u683c\u5f0f",id:"\u8f93\u51fa\u683c\u5f0f",level:3},{value:"\u65e5\u5fd7\u7ba1\u7406",id:"\u65e5\u5fd7\u7ba1\u7406",level:3},{value:"journald \u914d\u7f6e",id:"journald-\u914d\u7f6e",level:3},{value:"rsyslog",id:"rsyslog",level:2},{value:"rsyslog \u914d\u7f6e",id:"rsyslog-\u914d\u7f6e",level:3},{value:"rsyslog \u670d\u52a1",id:"rsyslog-\u670d\u52a1",level:3},{value:"\u65e5\u5fd7\u8f6e\u8f6c",id:"\u65e5\u5fd7\u8f6e\u8f6c",level:2},{value:"logrotate \u914d\u7f6e",id:"logrotate-\u914d\u7f6e",level:3},{value:"logrotate \u9009\u9879",id:"logrotate-\u9009\u9879",level:3},{value:"\u624b\u52a8\u6267\u884c\u8f6e\u8f6c",id:"\u624b\u52a8\u6267\u884c\u8f6e\u8f6c",level:3},{value:"\u5e94\u7528\u65e5\u5fd7",id:"\u5e94\u7528\u65e5\u5fd7",level:2},{value:"Nginx \u65e5\u5fd7",id:"nginx-\u65e5\u5fd7",level:3},{value:"Apache \u65e5\u5fd7",id:"apache-\u65e5\u5fd7",level:3},{value:"MySQL \u65e5\u5fd7",id:"mysql-\u65e5\u5fd7",level:3},{value:"\u65e5\u5fd7\u5206\u6790",id:"\u65e5\u5fd7\u5206\u6790",level:2},{value:"\u57fa\u7840\u5206\u6790",id:"\u57fa\u7840\u5206\u6790",level:3},{value:"\u4f7f\u7528\u5de5\u5177\u5206\u6790",id:"\u4f7f\u7528\u5de5\u5177\u5206\u6790",level:3},{value:"\u8fdc\u7a0b\u65e5\u5fd7",id:"\u8fdc\u7a0b\u65e5\u5fd7",level:2},{value:"\u914d\u7f6e\u8fdc\u7a0b\u65e5\u5fd7\u670d\u52a1\u5668",id:"\u914d\u7f6e\u8fdc\u7a0b\u65e5\u5fd7\u670d\u52a1\u5668",level:3},{value:"\u5ba2\u6237\u7aef\u914d\u7f6e\uff08\u53d1\u9001\u65e5\u5fd7\uff09",id:"\u5ba2\u6237\u7aef\u914d\u7f6e\u53d1\u9001\u65e5\u5fd7",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u65e5\u5fd7\u4fdd\u7559\u7b56\u7565",id:"1-\u65e5\u5fd7\u4fdd\u7559\u7b56\u7565",level:3},{value:"2. \u65e5\u5fd7\u76d1\u63a7",id:"2-\u65e5\u5fd7\u76d1\u63a7",level:3},{value:"3. \u96c6\u4e2d\u65e5\u5fd7\u7ba1\u7406",id:"3-\u96c6\u4e2d\u65e5\u5fd7\u7ba1\u7406",level:3},{value:"\u6545\u969c\u6392\u67e5",id:"\u6545\u969c\u6392\u67e5",level:2},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function t(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"linux-\u65e5\u5fd7\u7ba1\u7406",children:"Linux \u65e5\u5fd7\u7ba1\u7406"})}),"\n",(0,r.jsx)(e.p,{children:"\u65e5\u5fd7\u662f\u7cfb\u7edf\u8fd0\u7ef4\u548c\u6545\u969c\u6392\u67e5\u7684\u91cd\u8981\u4f9d\u636e\uff0c\u7406\u89e3\u65e5\u5fd7\u7cfb\u7edf\u5bf9\u4e8e\u7cfb\u7edf\u7ba1\u7406\u81f3\u5173\u91cd\u8981\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u65e5\u5fd7\u7cfb\u7edf\u6982\u8ff0",children:"\u65e5\u5fd7\u7cfb\u7edf\u6982\u8ff0"}),"\n",(0,r.jsx)(e.h3,{id:"\u65e5\u5fd7\u67b6\u6784",children:"\u65e5\u5fd7\u67b6\u6784"}),"\n",(0,r.jsx)(e.mermaid,{value:"graph LR\n    A[\u5e94\u7528\u7a0b\u5e8f] --\x3e B[syslog/journald]\n    B --\x3e C[\u65e5\u5fd7\u6587\u4ef6]\n    B --\x3e D[\u8fdc\u7a0b\u65e5\u5fd7\u670d\u52a1\u5668]\n    C --\x3e E[\u65e5\u5fd7\u5206\u6790\u5de5\u5177]"}),"\n",(0,r.jsx)(e.h3,{id:"\u65e5\u5fd7\u7ea7\u522b",children:"\u65e5\u5fd7\u7ea7\u522b"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u7ea7\u522b"}),(0,r.jsx)(e.th,{children:"\u503c"}),(0,r.jsx)(e.th,{children:"\u8bf4\u660e"}),(0,r.jsx)(e.th,{children:"\u7528\u9014"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"emerg"}),(0,r.jsx)(e.td,{children:"0"}),(0,r.jsx)(e.td,{children:"\u7d27\u6025"}),(0,r.jsx)(e.td,{children:"\u7cfb\u7edf\u4e0d\u53ef\u7528"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"alert"}),(0,r.jsx)(e.td,{children:"1"}),(0,r.jsx)(e.td,{children:"\u8b66\u62a5"}),(0,r.jsx)(e.td,{children:"\u5fc5\u987b\u7acb\u5373\u91c7\u53d6\u884c\u52a8"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"crit"}),(0,r.jsx)(e.td,{children:"2"}),(0,r.jsx)(e.td,{children:"\u4e25\u91cd"}),(0,r.jsx)(e.td,{children:"\u4e25\u91cd\u9519\u8bef"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"err"}),(0,r.jsx)(e.td,{children:"3"}),(0,r.jsx)(e.td,{children:"\u9519\u8bef"}),(0,r.jsx)(e.td,{children:"\u9519\u8bef\u6761\u4ef6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"warning"}),(0,r.jsx)(e.td,{children:"4"}),(0,r.jsx)(e.td,{children:"\u8b66\u544a"}),(0,r.jsx)(e.td,{children:"\u8b66\u544a\u6761\u4ef6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"notice"}),(0,r.jsx)(e.td,{children:"5"}),(0,r.jsx)(e.td,{children:"\u6ce8\u610f"}),(0,r.jsx)(e.td,{children:"\u6b63\u5e38\u4f46\u91cd\u8981"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"info"}),(0,r.jsx)(e.td,{children:"6"}),(0,r.jsx)(e.td,{children:"\u4fe1\u606f"}),(0,r.jsx)(e.td,{children:"\u4fe1\u606f\u6027\u6d88\u606f"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"debug"}),(0,r.jsx)(e.td,{children:"7"}),(0,r.jsx)(e.td,{children:"\u8c03\u8bd5"}),(0,r.jsx)(e.td,{children:"\u8c03\u8bd5\u6d88\u606f"})]})]})]}),"\n",(0,r.jsx)(e.h2,{id:"\u7cfb\u7edf\u65e5\u5fd7\u6587\u4ef6",children:"\u7cfb\u7edf\u65e5\u5fd7\u6587\u4ef6"}),"\n",(0,r.jsx)(e.h3,{id:"\u6807\u51c6\u65e5\u5fd7\u4f4d\u7f6e",children:"\u6807\u51c6\u65e5\u5fd7\u4f4d\u7f6e"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u4e3b\u8981\u65e5\u5fd7\u76ee\u5f55\n/var/log/\n\n# \u5e38\u89c1\u65e5\u5fd7\u6587\u4ef6\n/var/log/syslog          # \u7cfb\u7edf\u65e5\u5fd7\uff08Debian/Ubuntu\uff09\n/var/log/messages        # \u7cfb\u7edf\u65e5\u5fd7\uff08RHEL/CentOS\uff09\n/var/log/auth.log        # \u8ba4\u8bc1\u65e5\u5fd7\uff08Debian/Ubuntu\uff09\n/var/log/secure          # \u8ba4\u8bc1\u65e5\u5fd7\uff08RHEL/CentOS\uff09\n/var/log/kern.log        # \u5185\u6838\u65e5\u5fd7\n/var/log/dmesg           # \u542f\u52a8\u6d88\u606f\n/var/log/boot.log        # \u542f\u52a8\u65e5\u5fd7\n/var/log/cron            # \u8ba1\u5212\u4efb\u52a1\u65e5\u5fd7\n/var/log/maillog         # \u90ae\u4ef6\u65e5\u5fd7\n/var/log/httpd/          # Apache \u65e5\u5fd7\n/var/log/nginx/          # Nginx \u65e5\u5fd7\n/var/log/mysql/          # MySQL \u65e5\u5fd7\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u67e5\u770b\u65e5\u5fd7",children:"\u67e5\u770b\u65e5\u5fd7"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# \u67e5\u770b\u65e5\u5fd7\u6587\u4ef6\ncat /var/log/syslog\nless /var/log/syslog\ntail /var/log/syslog\n\n# \u5b9e\u65f6\u67e5\u770b\ntail -f /var/log/syslog\ntail -f /var/log/nginx/access.log\n\n# \u67e5\u770b\u6700\u540e N \u884c\ntail -n 100 /var/log/syslog\n\n# \u8fc7\u6ee4\u65e5\u5fd7\ngrep "error" /var/log/syslog\ngrep -i "failed" /var/log/auth.log\n\n# \u67e5\u770b\u5185\u6838\u542f\u52a8\u65e5\u5fd7\ndmesg\ndmesg | grep -i error\ndmesg | less\n\n# \u6e05\u7a7a dmesg \u7f13\u51b2\u533a\nsudo dmesg -c\n'})}),"\n",(0,r.jsx)(e.h2,{id:"journalctl",children:"journalctl"}),"\n",(0,r.jsx)(e.h3,{id:"\u57fa\u7840\u4f7f\u7528",children:"\u57fa\u7840\u4f7f\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u6240\u6709\u65e5\u5fd7\njournalctl\n\n# \u5206\u9875\u67e5\u770b\njournalctl | less\n\n# \u5b9e\u65f6\u67e5\u770b\njournalctl -f\n\n# \u53cd\u5411\u67e5\u770b\uff08\u6700\u65b0\u5728\u524d\uff09\njournalctl -r\n\n# \u67e5\u770b\u6700\u540e N \u884c\njournalctl -n 50\njournalctl -n 100\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u6309\u65f6\u95f4\u67e5\u8be2",children:"\u6309\u65f6\u95f4\u67e5\u8be2"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# \u67e5\u770b\u4eca\u5929\u7684\u65e5\u5fd7\njournalctl --since today\n\n# \u67e5\u770b\u6628\u5929\u7684\u65e5\u5fd7\njournalctl --since yesterday --until today\n\n# \u6307\u5b9a\u65f6\u95f4\u8303\u56f4\njournalctl --since "2024-12-10 09:00:00"\njournalctl --since "2024-12-10" --until "2024-12-11"\njournalctl --since "1 hour ago"\njournalctl --since "30 min ago"\n\n# \u76f8\u5bf9\u65f6\u95f4\njournalctl --since "-1h"        # \u6700\u8fd11\u5c0f\u65f6\njournalctl --since "-30m"       # \u6700\u8fd130\u5206\u949f\njournalctl --since "-1d"        # \u6700\u8fd11\u5929\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u6309\u670d\u52a1\u67e5\u8be2",children:"\u6309\u670d\u52a1\u67e5\u8be2"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u7279\u5b9a\u670d\u52a1\njournalctl -u nginx\njournalctl -u mysql\njournalctl -u ssh\n\n# \u5b9e\u65f6\u67e5\u770b\u670d\u52a1\u65e5\u5fd7\njournalctl -u nginx -f\n\n# \u591a\u4e2a\u670d\u52a1\njournalctl -u nginx -u mysql\n\n# \u67e5\u770b\u670d\u52a1\u6700\u65b0\u65e5\u5fd7\njournalctl -u nginx -n 50\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u6309\u7ea7\u522b\u67e5\u8be2",children:"\u6309\u7ea7\u522b\u67e5\u8be2"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u53ea\u770b\u9519\u8bef\njournalctl -p err\n\n# \u53ea\u770b\u9519\u8bef\u548c\u4e25\u91cd\njournalctl -p crit\n\n# \u53ea\u770b\u8b66\u544a\u53ca\u4ee5\u4e0a\njournalctl -p warning\n\n# \u7ea7\u522b\u8303\u56f4\njournalctl -p err..emerg\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u6309\u8fdb\u7a0b\u67e5\u8be2",children:"\u6309\u8fdb\u7a0b\u67e5\u8be2"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u6309 PID \u67e5\u8be2\njournalctl _PID=1234\n\n# \u6309\u53ef\u6267\u884c\u6587\u4ef6\njournalctl /usr/bin/nginx\n\n# \u6309\u7528\u6237\njournalctl _UID=1000\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u542f\u52a8\u65e5\u5fd7",children:"\u542f\u52a8\u65e5\u5fd7"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u672c\u6b21\u542f\u52a8\u65e5\u5fd7\njournalctl -b\n\n# \u67e5\u770b\u4e0a\u6b21\u542f\u52a8\u65e5\u5fd7\njournalctl -b -1\n\n# \u67e5\u770b\u524d\u4e24\u6b21\u542f\u52a8\u65e5\u5fd7\njournalctl -b -2\n\n# \u5217\u51fa\u6240\u6709\u542f\u52a8\u8bb0\u5f55\njournalctl --list-boots\n\n# \u6307\u5b9a\u542f\u52a8ID\u67e5\u8be2\njournalctl -b a1b2c3d4\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u5185\u6838\u65e5\u5fd7",children:"\u5185\u6838\u65e5\u5fd7"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u5185\u6838\u6d88\u606f\njournalctl -k\njournalctl --dmesg\n\n# \u672c\u6b21\u542f\u52a8\u7684\u5185\u6838\u6d88\u606f\njournalctl -k -b\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u8f93\u51fa\u683c\u5f0f",children:"\u8f93\u51fa\u683c\u5f0f"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u77ed\u683c\u5f0f\uff08\u9ed8\u8ba4\uff09\njournalctl -o short\n\n# \u8be6\u7ec6\u683c\u5f0f\njournalctl -o verbose\n\n# JSON \u683c\u5f0f\njournalctl -o json\njournalctl -o json-pretty\n\n# \u5bfc\u51fa\u683c\u5f0f\njournalctl -o export\n\n# \u53ea\u663e\u793a\u6d88\u606f\njournalctl -o cat\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u65e5\u5fd7\u7ba1\u7406",children:"\u65e5\u5fd7\u7ba1\u7406"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u65e5\u5fd7\u5360\u7528\u7a7a\u95f4\njournalctl --disk-usage\n\n# \u6e05\u7406\u65e5\u5fd7\uff08\u6309\u65f6\u95f4\uff09\nsudo journalctl --vacuum-time=7d     # \u4fdd\u75597\u5929\nsudo journalctl --vacuum-time=1month # \u4fdd\u75591\u4e2a\u6708\n\n# \u6e05\u7406\u65e5\u5fd7\uff08\u6309\u5927\u5c0f\uff09\nsudo journalctl --vacuum-size=1G     # \u4fdd\u75591GB\nsudo journalctl --vacuum-size=500M   # \u4fdd\u7559500MB\n\n# \u9a8c\u8bc1\u65e5\u5fd7\u5b8c\u6574\u6027\nsudo journalctl --verify\n"})}),"\n",(0,r.jsx)(e.h3,{id:"journald-\u914d\u7f6e",children:"journald \u914d\u7f6e"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u914d\u7f6e\u6587\u4ef6\n/etc/systemd/journald.conf\n\n# \u7f16\u8f91\u914d\u7f6e\nsudo vim /etc/systemd/journald.conf\n\n# \u5e38\u7528\u914d\u7f6e\n[Journal]\n# Storage=auto              # \u5b58\u50a8\u4f4d\u7f6e\uff08auto/volatile/persistent/none\uff09\n# Compress=yes              # \u538b\u7f29\n# SystemMaxUse=            # \u6700\u5927\u78c1\u76d8\u4f7f\u7528\n# SystemKeepFree=          # \u4fdd\u7559\u7a7a\u95f4\n# RuntimeMaxUse=           # \u8fd0\u884c\u65f6\u6700\u5927\u4f7f\u7528\n# MaxRetentionSec=         # \u6700\u957f\u4fdd\u7559\u65f6\u95f4\n# MaxFileSec=1month        # \u5355\u4e2a\u6587\u4ef6\u4fdd\u7559\u65f6\u95f4\n# ForwardToSyslog=yes      # \u8f6c\u53d1\u5230 syslog\n# ForwardToKMsg=no         # \u8f6c\u53d1\u5230\u5185\u6838\u65e5\u5fd7\n\n# \u91cd\u542f journald\nsudo systemctl restart systemd-journald\n"})}),"\n",(0,r.jsx)(e.h2,{id:"rsyslog",children:"rsyslog"}),"\n",(0,r.jsx)(e.h3,{id:"rsyslog-\u914d\u7f6e",children:"rsyslog \u914d\u7f6e"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u914d\u7f6e\u6587\u4ef6\n/etc/rsyslog.conf\n/etc/rsyslog.d/\n\n# \u914d\u7f6e\u683c\u5f0f\n# facility.priority  action\n# \u8bbe\u65bd.\u7ea7\u522b  \u52a8\u4f5c\n\n# \u793a\u4f8b\u914d\u7f6e\nsudo vim /etc/rsyslog.d/50-default.conf\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5e38\u7528\u914d\u7f6e\u793a\u4f8b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u6240\u6709\u65e5\u5fd7\u5230 /var/log/syslog\n*.*                         /var/log/syslog\n\n# \u8ba4\u8bc1\u65e5\u5fd7\nauth,authpriv.*             /var/log/auth.log\n\n# \u5185\u6838\u65e5\u5fd7\nkern.*                      /var/log/kern.log\n\n# \u90ae\u4ef6\u65e5\u5fd7\nmail.*                      /var/log/mail.log\n\n# \u7d27\u6025\u65e5\u5fd7\u53d1\u9001\u7ed9\u6240\u6709\u7528\u6237\n*.emerg                     :omusrmsg:*\n\n# \u8fdc\u7a0b\u65e5\u5fd7\u8bb0\u5f55\n*.* @@remote-host:514       # TCP\n*.* @remote-host:514        # UDP\n"})}),"\n",(0,r.jsx)(e.h3,{id:"rsyslog-\u670d\u52a1",children:"rsyslog \u670d\u52a1"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# \u91cd\u542f rsyslog\nsudo systemctl restart rsyslog\n\n# \u67e5\u770b\u72b6\u6001\nsudo systemctl status rsyslog\n\n# \u6d4b\u8bd5\u914d\u7f6e\nrsyslogd -N1\n\n# \u53d1\u9001\u6d4b\u8bd5\u65e5\u5fd7\nlogger "Test message"\nlogger -p local0.info "Test info message"\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u65e5\u5fd7\u8f6e\u8f6c",children:"\u65e5\u5fd7\u8f6e\u8f6c"}),"\n",(0,r.jsx)(e.h3,{id:"logrotate-\u914d\u7f6e",children:"logrotate \u914d\u7f6e"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u4e3b\u914d\u7f6e\u6587\u4ef6\n/etc/logrotate.conf\n\n# \u5355\u72ec\u914d\u7f6e\u76ee\u5f55\n/etc/logrotate.d/\n\n# \u67e5\u770b\u914d\u7f6e\ncat /etc/logrotate.conf\n\n# \u793a\u4f8b\u914d\u7f6e\n/var/log/nginx/*.log {\n    daily                    # \u6bcf\u5929\u8f6e\u8f6c\n    missingok               # \u6587\u4ef6\u4e0d\u5b58\u5728\u4e0d\u62a5\u9519\n    rotate 14               # \u4fdd\u755914\u4e2a\u5f52\u6863\n    compress                # \u538b\u7f29\n    delaycompress           # \u5ef6\u8fdf\u538b\u7f29\n    notifempty              # \u7a7a\u6587\u4ef6\u4e0d\u8f6e\u8f6c\n    create 0640 www-data adm  # \u521b\u5efa\u65b0\u6587\u4ef6\u7684\u6743\u9650\n    sharedscripts           # \u5171\u4eab\u811a\u672c\n    postrotate\n        if [ -f /var/run/nginx.pid ]; then\n            kill -USR1 `cat /var/run/nginx.pid`\n        fi\n    endscript\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"logrotate-\u9009\u9879",children:"logrotate \u9009\u9879"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u8f6e\u8f6c\u9891\u7387\ndaily           # \u6bcf\u5929\nweekly          # \u6bcf\u5468\nmonthly         # \u6bcf\u6708\nyearly          # \u6bcf\u5e74\n\n# \u8f6e\u8f6c\u6761\u4ef6\nsize 100M       # \u5927\u5c0f\u8fbe\u5230100MB\nrotate 7        # \u4fdd\u75597\u4e2a\u526f\u672c\nmaxage 30       # \u4fdd\u755930\u5929\n\n# \u538b\u7f29\u9009\u9879\ncompress        # \u538b\u7f29\nnocompress      # \u4e0d\u538b\u7f29\ndelaycompress   # \u5ef6\u8fdf\u4e00\u4e2a\u5468\u671f\u538b\u7f29\ncompresscmd gzip  # \u538b\u7f29\u547d\u4ee4\n\n# \u5176\u4ed6\u9009\u9879\nmissingok       # \u6587\u4ef6\u7f3a\u5931\u4e0d\u62a5\u9519\nnotifempty      # \u7a7a\u6587\u4ef6\u4e0d\u8f6e\u8f6c\ncreate mode owner group  # \u521b\u5efa\u65b0\u6587\u4ef6\ndateext         # \u4f7f\u7528\u65e5\u671f\u4f5c\u4e3a\u540e\u7f00\ncopytruncate    # \u590d\u5236\u540e\u6e05\u7a7a\u539f\u6587\u4ef6\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u624b\u52a8\u6267\u884c\u8f6e\u8f6c",children:"\u624b\u52a8\u6267\u884c\u8f6e\u8f6c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u6d4b\u8bd5\u914d\u7f6e\nsudo logrotate -d /etc/logrotate.conf\n\n# \u5f3a\u5236\u8f6e\u8f6c\nsudo logrotate -f /etc/logrotate.conf\n\n# \u8f6e\u8f6c\u7279\u5b9a\u914d\u7f6e\nsudo logrotate -f /etc/logrotate.d/nginx\n\n# \u67e5\u770b\u72b6\u6001\ncat /var/lib/logrotate/status\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u5e94\u7528\u65e5\u5fd7",children:"\u5e94\u7528\u65e5\u5fd7"}),"\n",(0,r.jsx)(e.h3,{id:"nginx-\u65e5\u5fd7",children:"Nginx \u65e5\u5fd7"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u8bbf\u95ee\u65e5\u5fd7\ntail -f /var/log/nginx/access.log\n\n# \u9519\u8bef\u65e5\u5fd7\ntail -f /var/log/nginx/error.log\n\n# \u65e5\u5fd7\u683c\u5f0f\u914d\u7f6e\n# /etc/nginx/nginx.conf\nlog_format main '$remote_addr - $remote_user [$time_local] '\n                '\"$request\" $status $body_bytes_sent '\n                '\"$http_referer\" \"$http_user_agent\"';\n\naccess_log /var/log/nginx/access.log main;\n"})}),"\n",(0,r.jsx)(e.h3,{id:"apache-\u65e5\u5fd7",children:"Apache \u65e5\u5fd7"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u8bbf\u95ee\u65e5\u5fd7\ntail -f /var/log/apache2/access.log\ntail -f /var/log/httpd/access_log\n\n# \u9519\u8bef\u65e5\u5fd7\ntail -f /var/log/apache2/error.log\ntail -f /var/log/httpd/error_log\n"})}),"\n",(0,r.jsx)(e.h3,{id:"mysql-\u65e5\u5fd7",children:"MySQL \u65e5\u5fd7"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u9519\u8bef\u65e5\u5fd7\n/var/log/mysql/error.log\n\n# \u6162\u67e5\u8be2\u65e5\u5fd7\n/var/log/mysql/mysql-slow.log\n\n# \u5f00\u542f\u6162\u67e5\u8be2\u65e5\u5fd7\uff08my.cnf\uff09\nslow_query_log = 1\nslow_query_log_file = /var/log/mysql/mysql-slow.log\nlong_query_time = 2\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u65e5\u5fd7\u5206\u6790",children:"\u65e5\u5fd7\u5206\u6790"}),"\n",(0,r.jsx)(e.h3,{id:"\u57fa\u7840\u5206\u6790",children:"\u57fa\u7840\u5206\u6790"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u7edf\u8ba1IP\u8bbf\u95ee\u6b21\u6570\nawk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -rn | head\n\n# \u7edf\u8ba1\u72b6\u6001\u7801\nawk '{print $9}' /var/log/nginx/access.log | sort | uniq -c | sort -rn\n\n# \u7edf\u8ba1\u8bbf\u95ee\u6700\u591a\u7684URL\nawk '{print $7}' /var/log/nginx/access.log | sort | uniq -c | sort -rn | head\n\n# \u7edf\u8ba1\u8bbf\u95ee\u6d41\u91cf\nawk '{sum+=$10} END {print sum/1024/1024 \" MB\"}' /var/log/nginx/access.log\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u4f7f\u7528\u5de5\u5177\u5206\u6790",children:"\u4f7f\u7528\u5de5\u5177\u5206\u6790"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# goaccess - \u5b9e\u65f6\u65e5\u5fd7\u5206\u6790\nsudo apt install goaccess\n\n# \u5206\u6790 Nginx \u65e5\u5fd7\ngoaccess /var/log/nginx/access.log\n\n# \u751f\u6210 HTML \u62a5\u544a\ngoaccess /var/log/nginx/access.log -o report.html --log-format=COMBINED\n\n# \u5b9e\u65f6\u5206\u6790\ntail -f /var/log/nginx/access.log | goaccess -\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u8fdc\u7a0b\u65e5\u5fd7",children:"\u8fdc\u7a0b\u65e5\u5fd7"}),"\n",(0,r.jsx)(e.h3,{id:"\u914d\u7f6e\u8fdc\u7a0b\u65e5\u5fd7\u670d\u52a1\u5668",children:"\u914d\u7f6e\u8fdc\u7a0b\u65e5\u5fd7\u670d\u52a1\u5668"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# \u670d\u52a1\u5668\u7aef\u914d\u7f6e\uff08\u63a5\u6536\u65e5\u5fd7\uff09\nsudo vim /etc/rsyslog.conf\n\n# \u542f\u7528 TCP \u63a5\u6536\nmodule(load="imtcp")\ninput(type="imtcp" port="514")\n\n# \u6216 UDP \u63a5\u6536\nmodule(load="imudp")\ninput(type="imudp" port="514")\n\n# \u91cd\u542f rsyslog\nsudo systemctl restart rsyslog\n\n# \u5f00\u653e\u9632\u706b\u5899\u7aef\u53e3\nsudo ufw allow 514/tcp\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u5ba2\u6237\u7aef\u914d\u7f6e\u53d1\u9001\u65e5\u5fd7",children:"\u5ba2\u6237\u7aef\u914d\u7f6e\uff08\u53d1\u9001\u65e5\u5fd7\uff09"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u7f16\u8f91\u5ba2\u6237\u7aef rsyslog \u914d\u7f6e\nsudo vim /etc/rsyslog.d/remote.conf\n\n# \u6dfb\u52a0\u8fdc\u7a0b\u65e5\u5fd7\u670d\u52a1\u5668\n*.* @@log-server:514      # TCP\n*.* @log-server:514       # UDP\n\n# \u91cd\u542f rsyslog\nsudo systemctl restart rsyslog\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u65e5\u5fd7\u4fdd\u7559\u7b56\u7565",children:"1. \u65e5\u5fd7\u4fdd\u7559\u7b56\u7565"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u2705 \u8bbe\u7f6e\u5408\u7406\u7684\u4fdd\u7559\u65f6\u95f4\n# - \u7cfb\u7edf\u65e5\u5fd7\uff1a30-90\u5929\n# - \u5e94\u7528\u65e5\u5fd7\uff1a7-30\u5929\n# - \u5ba1\u8ba1\u65e5\u5fd7\uff1a\u66f4\u957f\u65f6\u95f4\n\n# \u2705 \u5b9a\u671f\u6e05\u7406\n# - \u4f7f\u7528 logrotate\n# - \u4f7f\u7528 journalctl --vacuum-time\n"})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u65e5\u5fd7\u76d1\u63a7",children:"2. \u65e5\u5fd7\u76d1\u63a7"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# \u2705 \u76d1\u63a7\u5173\u952e\u65e5\u5fd7\n# - \u8ba4\u8bc1\u5931\u8d25\n# - \u7cfb\u7edf\u9519\u8bef\n# - \u670d\u52a1\u5d29\u6e83\n\n# \u793a\u4f8b\uff1a\u76d1\u63a7 SSH \u767b\u5f55\u5931\u8d25\ngrep "Failed password" /var/log/auth.log | tail -20\n'})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u96c6\u4e2d\u65e5\u5fd7\u7ba1\u7406",children:"3. \u96c6\u4e2d\u65e5\u5fd7\u7ba1\u7406"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u2705 \u4f7f\u7528\u96c6\u4e2d\u65e5\u5fd7\u7cfb\u7edf\n# - ELK Stack (Elasticsearch, Logstash, Kibana)\n# - Graylog\n# - Splunk\n# - Loki + Grafana\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u6545\u969c\u6392\u67e5",children:"\u6545\u969c\u6392\u67e5"}),"\n",(0,r.jsx)(e.h3,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u78c1\u76d8\u7a7a\u95f4\u88ab\u65e5\u5fd7\u5360\u6ee1\ndf -h\ndu -sh /var/log/*\nsudo journalctl --vacuum-size=500M\n\n# \u65e5\u5fd7\u670d\u52a1\u672a\u8fd0\u884c\nsudo systemctl status rsyslog\nsudo systemctl status systemd-journald\nsudo systemctl restart rsyslog\n\n# \u65e5\u5fd7\u6743\u9650\u95ee\u9898\nls -l /var/log/\nsudo chmod 640 /var/log/syslog\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,r.jsx)(e.p,{children:"\u672c\u6587\u4ecb\u7ecd\u4e86 Linux \u65e5\u5fd7\u7ba1\u7406\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u2705 \u7cfb\u7edf\u65e5\u5fd7\u6587\u4ef6\u548c\u67e5\u770b"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 journalctl \u8be6\u7ec6\u4f7f\u7528"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 rsyslog \u914d\u7f6e"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 \u65e5\u5fd7\u8f6e\u8f6c\uff08logrotate\uff09"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 \u5e94\u7528\u65e5\u5fd7\u7ba1\u7406"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 \u65e5\u5fd7\u5206\u6790\u548c\u8fdc\u7a0b\u65e5\u5fd7"}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["\u7ee7\u7eed\u5b66\u4e60 ",(0,r.jsx)(e.a,{href:"/docs/linux/disk-management",children:"\u78c1\u76d8\u7ba1\u7406"})," \u548c ",(0,r.jsx)(e.a,{href:"/docs/linux/performance-tuning",children:"\u6027\u80fd\u4f18\u5316"}),"\u3002"]})]})}function h(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(t,{...n})}):t(n)}},48885:(n,e,l)=>{l.d(e,{R:()=>o,x:()=>i});var s=l(99378);const r={},a=s.createContext(r);function o(n){const e=s.useContext(a);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:o(n.components),s.createElement(a.Provider,{value:e},n.children)}}}]);
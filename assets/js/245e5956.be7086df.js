"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[9196],{48885:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var t=s(99378);const r={},i=t.createContext(r);function a(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:n},e.children)}},97705:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"spring/testing","title":"Spring \u6d4b\u8bd5","description":"[!IMPORTANT]","source":"@site/docs/spring/spring-testing.md","sourceDirName":"spring","slug":"/spring/testing","permalink":"/docs/spring/testing","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/spring/spring-testing.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"id":"testing","title":"Spring \u6d4b\u8bd5","sidebar_label":"\u6d4b\u8bd5","sidebar_position":9},"sidebar":"spring","previous":{"title":"\u5b89\u5168\u57fa\u7840","permalink":"/docs/spring/security-basics"},"next":{"title":"\u5feb\u901f\u53c2\u8003","permalink":"/docs/spring/quick-reference"}}');var r=s(22714),i=s(48885);const a={id:"testing",title:"Spring \u6d4b\u8bd5",sidebar_label:"\u6d4b\u8bd5",sidebar_position:9},l="Spring \u6d4b\u8bd5",o={},c=[{value:"1. \u6d4b\u8bd5\u6982\u8ff0",id:"1-\u6d4b\u8bd5\u6982\u8ff0",level:2},{value:"1.1 \u6d4b\u8bd5\u7c7b\u578b",id:"11-\u6d4b\u8bd5\u7c7b\u578b",level:3},{value:"1.2 \u4f9d\u8d56\u914d\u7f6e",id:"12-\u4f9d\u8d56\u914d\u7f6e",level:3},{value:"2. \u5355\u5143\u6d4b\u8bd5",id:"2-\u5355\u5143\u6d4b\u8bd5",level:2},{value:"2.1 \u57fa\u672c\u5355\u5143\u6d4b\u8bd5",id:"21-\u57fa\u672c\u5355\u5143\u6d4b\u8bd5",level:3},{value:"2.2 Mockito \u5e38\u7528\u65b9\u6cd5",id:"22-mockito-\u5e38\u7528\u65b9\u6cd5",level:3},{value:"3. Spring \u96c6\u6210\u6d4b\u8bd5",id:"3-spring-\u96c6\u6210\u6d4b\u8bd5",level:2},{value:"3.1 @SpringBootTest",id:"31-springboottest",level:3},{value:"3.2 \u914d\u7f6e\u6d4b\u8bd5\u73af\u5883",id:"32-\u914d\u7f6e\u6d4b\u8bd5\u73af\u5883",level:3},{value:"3.3 @ActiveProfiles",id:"33-activeprofiles",level:3},{value:"4. Web \u5c42\u6d4b\u8bd5",id:"4-web-\u5c42\u6d4b\u8bd5",level:2},{value:"4.1 @WebMvcTest",id:"41-webmvctest",level:3},{value:"4.2 MockMvc \u8be6\u89e3",id:"42-mockmvc-\u8be6\u89e3",level:3},{value:"5. \u6570\u636e\u5c42\u6d4b\u8bd5",id:"5-\u6570\u636e\u5c42\u6d4b\u8bd5",level:2},{value:"5.1 @DataJpaTest",id:"51-datajpatest",level:3},{value:"5.2 \u4f7f\u7528\u5185\u5b58\u6570\u636e\u5e93",id:"52-\u4f7f\u7528\u5185\u5b58\u6570\u636e\u5e93",level:3},{value:"6. \u4e8b\u52a1\u6d4b\u8bd5",id:"6-\u4e8b\u52a1\u6d4b\u8bd5",level:2},{value:"6.1 @Transactional",id:"61-transactional",level:3},{value:"6.2 \u7981\u7528\u81ea\u52a8\u56de\u6eda",id:"62-\u7981\u7528\u81ea\u52a8\u56de\u6eda",level:3},{value:"7. REST \u6d4b\u8bd5",id:"7-rest-\u6d4b\u8bd5",level:2},{value:"7.1 TestRestTemplate",id:"71-testresttemplate",level:3},{value:"8. \u6d4b\u8bd5\u914d\u7f6e",id:"8-\u6d4b\u8bd5\u914d\u7f6e",level:2},{value:"8.1 @TestConfiguration",id:"81-testconfiguration",level:3},{value:"8.2 @MockBean vs @Mock",id:"82-mockbean-vs-mock",level:3},{value:"9. \u65ad\u8a00\u5e93",id:"9-\u65ad\u8a00\u5e93",level:2},{value:"9.1 JUnit \u65ad\u8a00",id:"91-junit-\u65ad\u8a00",level:3},{value:"9.2 AssertJ \u65ad\u8a00",id:"92-assertj-\u65ad\u8a00",level:3},{value:"10. \u6700\u4f73\u5b9e\u8df5",id:"10-\u6700\u4f73\u5b9e\u8df5",level:2},{value:"10.1 \u9075\u5faa AAA \u6a21\u5f0f",id:"101-\u9075\u5faa-aaa-\u6a21\u5f0f",level:3},{value:"10.2 \u4f7f\u7528\u6709\u610f\u4e49\u7684\u6d4b\u8bd5\u540d\u79f0",id:"102-\u4f7f\u7528\u6709\u610f\u4e49\u7684\u6d4b\u8bd5\u540d\u79f0",level:3},{value:"10.3 \u4e00\u4e2a\u6d4b\u8bd5\u53ea\u6d4b\u4e00\u4e2a\u573a\u666f",id:"103-\u4e00\u4e2a\u6d4b\u8bd5\u53ea\u6d4b\u4e00\u4e2a\u573a\u666f",level:3},{value:"10.4 \u907f\u514d\u6d4b\u8bd5\u79c1\u6709\u65b9\u6cd5",id:"104-\u907f\u514d\u6d4b\u8bd5\u79c1\u6709\u65b9\u6cd5",level:3},{value:"11. \u603b\u7ed3",id:"11-\u603b\u7ed3",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"spring-\u6d4b\u8bd5",children:"Spring \u6d4b\u8bd5"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["[!IMPORTANT]\n",(0,r.jsx)(n.strong,{children:"\u6d4b\u8bd5\u9a71\u52a8\u5f00\u53d1"}),": Spring TestContext Framework \u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u6d4b\u8bd5\u652f\u6301\u3002\u7406\u89e3\u4e0d\u540c\u6d4b\u8bd5\u6ce8\u89e3\u7684\u4f7f\u7528\u573a\u666f\u662f\u7f16\u5199\u9ad8\u8d28\u91cf\u6d4b\u8bd5\u7684\u5173\u952e\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"1-\u6d4b\u8bd5\u6982\u8ff0",children:"1. \u6d4b\u8bd5\u6982\u8ff0"}),"\n",(0,r.jsx)(n.p,{children:"Spring \u63d0\u4f9b\u4e86\u5b8c\u6574\u7684\u6d4b\u8bd5\u652f\u6301\uff0c\u53ef\u4ee5\u7f16\u5199\u5355\u5143\u6d4b\u8bd5\u548c\u96c6\u6210\u6d4b\u8bd5\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"11-\u6d4b\u8bd5\u7c7b\u578b",children:"1.1 \u6d4b\u8bd5\u7c7b\u578b"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u6d4b\u8bd5\u7c7b\u578b"}),(0,r.jsx)(n.th,{children:"\u8bf4\u660e"}),(0,r.jsx)(n.th,{children:"\u5de5\u5177"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u5355\u5143\u6d4b\u8bd5"})}),(0,r.jsx)(n.td,{children:"\u6d4b\u8bd5\u5355\u4e2a\u7c7b\u6216\u65b9\u6cd5"}),(0,r.jsx)(n.td,{children:"JUnit + Mockito"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u96c6\u6210\u6d4b\u8bd5"})}),(0,r.jsx)(n.td,{children:"\u6d4b\u8bd5\u591a\u4e2a\u7ec4\u4ef6\u534f\u4f5c"}),(0,r.jsx)(n.td,{children:"@SpringBootTest"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u5207\u7247\u6d4b\u8bd5"})}),(0,r.jsx)(n.td,{children:"\u6d4b\u8bd5\u7279\u5b9a\u5c42"}),(0,r.jsx)(n.td,{children:"@WebMvcTest, @DataJpaTest"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u7aef\u5230\u7aef\u6d4b\u8bd5"})}),(0,r.jsx)(n.td,{children:"\u6d4b\u8bd5\u5b8c\u6574\u6d41\u7a0b"}),(0,r.jsx)(n.td,{children:"TestRestTemplate"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"12-\u4f9d\u8d56\u914d\u7f6e",children:"1.2 \u4f9d\u8d56\u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-test</artifactId>\n    <scope>test</scope>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u81ea\u52a8\u5305\u542b\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"JUnit 5"}),"\n",(0,r.jsx)(n.li,{children:"Mockito"}),"\n",(0,r.jsx)(n.li,{children:"AssertJ"}),"\n",(0,r.jsx)(n.li,{children:"Hamcrest"}),"\n",(0,r.jsx)(n.li,{children:"Spring Test"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"2-\u5355\u5143\u6d4b\u8bd5",children:"2. \u5355\u5143\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h3,{id:"21-\u57fa\u672c\u5355\u5143\u6d4b\u8bd5",children:"2.1 \u57fa\u672c\u5355\u5143\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@ExtendWith(MockitoExtension.class)\nclass UserServiceTest {\n    \n    @Mock\n    private UserRepository userRepository;\n    \n    @InjectMocks\n    private UserService userService;\n    \n    @Test\n    void testFindUserById() {\n        // Arrange (\u51c6\u5907)\n        User mockUser = new User(1L, "John", "john@example.com");\n        when(userRepository.findById(1L)).thenReturn(Optional.of(mockUser));\n        \n        // Act (\u6267\u884c)\n        User result = userService.findById(1L);\n        \n        // Assert (\u65ad\u8a00)\n        assertNotNull(result);\n        assertEquals("John", result.getName());\n        assertEquals("john@example.com", result.getEmail());\n        \n        // Verify (\u9a8c\u8bc1)\n        verify(userRepository, times(1)).findById(1L);\n    }\n    \n    @Test\n    void testSaveUser() {\n        // Arrange\n        User newUser = new User(null, "Jane", "jane@example.com");\n        User savedUser = new User(2L, "Jane", "jane@example.com");\n        when(userRepository.save(any(User.class))).thenReturn(savedUser);\n        \n        // Act\n        User result = userService.save(newUser);\n        \n        // Assert\n        assertNotNull(result.getId());\n        assertEquals(2L, result.getId());\n        verify(userRepository).save(newUser);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"22-mockito-\u5e38\u7528\u65b9\u6cd5",children:"2.2 Mockito \u5e38\u7528\u65b9\u6cd5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@ExtendWith(MockitoExtension.class)\nclass MockitoExamplesTest {\n    \n    @Mock\n    private UserRepository userRepository;\n    \n    @Test\n    void mockitoExamples() {\n        // \u8fd4\u56de\u7279\u5b9a\u503c\n        when(userRepository.findById(1L))\n            .thenReturn(Optional.of(new User(1L, "John", "john@example.com")));\n        \n        // \u8fd4\u56de\u591a\u4e2a\u503c\uff08\u591a\u6b21\u8c03\u7528\uff09\n        when(userRepository.count())\n            .thenReturn(1L)\n            .thenReturn(2L)\n            .thenReturn(3L);\n        \n        // \u629b\u51fa\u5f02\u5e38\n        when(userRepository.findById(999L))\n            .thenThrow(new ResourceNotFoundException("User not found"));\n        \n        // \u53c2\u6570\u5339\u914d\u5668\n        when(userRepository.findById(anyLong()))\n            .thenReturn(Optional.of(new User()));\n        \n        // \u9a8c\u8bc1\u8c03\u7528\u6b21\u6570\n        verify(userRepository, times(1)).findById(1L);\n        verify(userRepository, never()).delete(any());\n        verify(userRepository, atLeast(1)).count();\n        verify(userRepository, atMost(3)).findAll();\n        \n        // \u9a8c\u8bc1\u53c2\u6570\n        ArgumentCaptor<User> userCaptor = ArgumentCaptor.forClass(User.class);\n        verify(userRepository).save(userCaptor.capture());\n        User capturedUser = userCaptor.getValue();\n        assertEquals("John", capturedUser.getName());\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"3-spring-\u96c6\u6210\u6d4b\u8bd5",children:"3. Spring \u96c6\u6210\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h3,{id:"31-springboottest",children:"3.1 @SpringBootTest"}),"\n",(0,r.jsx)(n.p,{children:"\u52a0\u8f7d\u5b8c\u6574\u7684\u5e94\u7528\u4e0a\u4e0b\u6587\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@SpringBootTest\nclass UserServiceIntegrationTest {\n    \n    @Autowired\n    private UserService userService;\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    @BeforeEach\n    void setUp() {\n        userRepository.deleteAll();\n    }\n    \n    @Test\n    void testUserRegistration() {\n        // \u6d4b\u8bd5\u5b8c\u6574\u7684\u7528\u6237\u6ce8\u518c\u6d41\u7a0b\n        User user = new User(null, "John", "john@example.com");\n        User saved = userService.registerUser(user);\n        \n        assertNotNull(saved.getId());\n        \n        // \u9a8c\u8bc1\u6570\u636e\u5e93\u4e2d\u786e\u5b9e\u4fdd\u5b58\u4e86\n        Optional<User> found = userRepository.findById(saved.getId());\n        assertTrue(found.isPresent());\n        assertEquals("John", found.get().getName());\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"32-\u914d\u7f6e\u6d4b\u8bd5\u73af\u5883",children:"3.2 \u914d\u7f6e\u6d4b\u8bd5\u73af\u5883"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u4f7f\u7528\u7279\u5b9a\u914d\u7f6e\u7c7b\n@SpringBootTest(classes = TestConfig.class)\nclass CustomConfigTest {\n}\n\n// \u8bbe\u7f6e\u73af\u5883\u5c5e\u6027\n@SpringBootTest(properties = {\n    "spring.datasource.url=jdbc:h2:mem:testdb",\n    "logging.level.root=WARN"\n})\nclass PropertyTest {\n}\n\n// \u4f7f\u7528\u968f\u673a\u7aef\u53e3\n@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)\nclass WebTest {\n    \n    @LocalServerPort\n    private int port;\n    \n    @Test\n    void testPort() {\n        System.out.println("Server port: " + port);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"33-activeprofiles",children:"3.3 @ActiveProfiles"}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528\u7279\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@SpringBootTest\n@ActiveProfiles("test")\nclass ProfileTest {\n    // \u4f1a\u52a0\u8f7d application-test.yml \u6216 application-test.properties\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# application-test.yml\nspring:\n  datasource:\n    url: jdbc:h2:mem:testdb\n  jpa:\n    hibernate:\n      ddl-auto: create-drop\n"})}),"\n",(0,r.jsx)(n.h2,{id:"4-web-\u5c42\u6d4b\u8bd5",children:"4. Web \u5c42\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h3,{id:"41-webmvctest",children:"4.1 @WebMvcTest"}),"\n",(0,r.jsx)(n.p,{children:"\u53ea\u52a0\u8f7d Web \u5c42\u7ec4\u4ef6\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@WebMvcTest(UserController.class)\nclass UserControllerTest {\n    \n    @Autowired\n    private MockMvc mockMvc;\n    \n    @MockBean\n    private UserService userService;\n    \n    @Test\n    void testGetUser() throws Exception {\n        // Arrange\n        User mockUser = new User(1L, "John", "john@example.com");\n        when(userService.findById(1L)).thenReturn(mockUser);\n        \n        // Act & Assert\n        mockMvc.perform(get("/api/users/1"))\n            .andExpect(status().isOk())\n            .andExpect(jsonPath("$.id").value(1))\n            .andExpect(jsonPath("$.name").value("John"))\n            .andExpect(jsonPath("$.email").value("john@example.com"));\n        \n        verify(userService).findById(1L);\n    }\n    \n    @Test\n    void testCreateUser() throws Exception {\n        // Arrange\n        User newUser = new User(null, "Jane", "jane@example.com");\n        User savedUser = new User(2L, "Jane", "jane@example.com");\n        when(userService.save(any(User.class))).thenReturn(savedUser);\n        \n        // Act & Assert\n        mockMvc.perform(post("/api/users")\n                .contentType(MediaType.APPLICATION_JSON)\n                .content("{\\"name\\":\\"Jane\\",\\"email\\":\\"jane@example.com\\"}"))\n            .andExpect(status().isCreated())\n            .andExpect(jsonPath("$.id").value(2))\n            .andExpect(jsonPath("$.name").value("Jane"));\n    }\n    \n    @Test\n    void testDeleteUser() throws Exception {\n        mockMvc.perform(delete("/api/users/1"))\n            .andExpect(status().isNoContent());\n        \n        verify(userService).deleteById(1L);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"42-mockmvc-\u8be6\u89e3",children:"4.2 MockMvc \u8be6\u89e3"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@WebMvcTest\nclass MockMvcExamplesTest {\n    \n    @Autowired\n    private MockMvc mockMvc;\n    \n    @Test\n    void mockMvcExamples() throws Exception {\n        mockMvc.perform(\n            get("/api/users")\n                .param("page", "0")\n                .param("size", "10")\n                .header("Authorization", "Bearer token")\n                .accept(MediaType.APPLICATION_JSON)\n        )\n        .andExpect(status().isOk())\n        .andExpect(content().contentType(MediaType.APPLICATION_JSON))\n        .andExpect(jsonPath("$.length()").value(10))\n        .andDo(print());  // \u6253\u5370\u8bf7\u6c42\u548c\u54cd\u5e94\u8be6\u60c5\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"5-\u6570\u636e\u5c42\u6d4b\u8bd5",children:"5. \u6570\u636e\u5c42\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h3,{id:"51-datajpatest",children:"5.1 @DataJpaTest"}),"\n",(0,r.jsx)(n.p,{children:"\u53ea\u52a0\u8f7d JPA \u7ec4\u4ef6\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@DataJpaTest\nclass UserRepositoryTest {\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    @Autowired\n    private TestEntityManager entityManager;\n    \n    @Test\n    void testFindByEmail() {\n        // Arrange\n        User user = new User(null, "John", "john@example.com");\n        entityManager.persist(user);\n        entityManager.flush();\n        \n        // Act\n        User found = userRepository.findByEmail("john@example.com");\n        \n        // Assert\n        assertNotNull(found);\n        assertEquals("John", found.getName());\n    }\n    \n    @Test\n    void testFindByAgeGreaterThan() {\n        // Arrange\n        entityManager.persist(new User(null, "John", "john@example.com", 25));\n        entityManager.persist(new User(null, "Jane", "jane@example.com", 30));\n        entityManager.persist(new User(null, "Bob", "bob@example.com", 20));\n        entityManager.flush();\n        \n        // Act\n        List<User> users = userRepository.findByAgeGreaterThan(22);\n        \n        // Assert\n        assertEquals(2, users.size());\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"52-\u4f7f\u7528\u5185\u5b58\u6570\u636e\u5e93",children:"5.2 \u4f7f\u7528\u5185\u5b58\u6570\u636e\u5e93"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"\x3c!-- H2 \u5185\u5b58\u6570\u636e\u5e93 --\x3e\n<dependency>\n    <groupId>com.h2database</groupId>\n    <artifactId>h2</artifactId>\n    <scope>test</scope>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# application-test.yml\nspring:\n  datasource:\n    url: jdbc:h2:mem:testdb\n    driver-class-name: org.h2.Driver\n  jpa:\n    hibernate:\n      ddl-auto: create-drop\n    show-sql: true\n"})}),"\n",(0,r.jsx)(n.h2,{id:"6-\u4e8b\u52a1\u6d4b\u8bd5",children:"6. \u4e8b\u52a1\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h3,{id:"61-transactional",children:"6.1 @Transactional"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@SpringBootTest\n@Transactional  // \u6d4b\u8bd5\u540e\u81ea\u52a8\u56de\u6eda\nclass TransactionalTest {\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    @Test\n    void testSaveUser() {\n        User user = new User(null, "John", "john@example.com");\n        userRepository.save(user);\n        \n        // \u6d4b\u8bd5\u5185\u53ef\u4ee5\u67e5\u5230\n        assertEquals(1, userRepository.count());\n        \n        // \u6d4b\u8bd5\u7ed3\u675f\u540e\u4f1a\u81ea\u52a8\u56de\u6eda\uff0c\u4e0d\u4f1a\u771f\u6b63\u4fdd\u5b58\u5230\u6570\u636e\u5e93\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"62-\u7981\u7528\u81ea\u52a8\u56de\u6eda",children:"6.2 \u7981\u7528\u81ea\u52a8\u56de\u6eda"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@SpringBootTest\nclass NoRollbackTest {\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    @Test\n    @Transactional\n    @Rollback(false)  // \u4e0d\u56de\u6eda\uff0c\u4fdd\u7559\u6570\u636e\n    void testSaveUserPermanently() {\n        User user = new User(null, "John", "john@example.com");\n        userRepository.save(user);\n    }\n    \n    @AfterEach\n    void cleanup() {\n        // \u624b\u52a8\u6e05\u7406\u6570\u636e\n        userRepository.deleteAll();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"7-rest-\u6d4b\u8bd5",children:"7. REST \u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h3,{id:"71-testresttemplate",children:"7.1 TestRestTemplate"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)\nclass UserRestTest {\n    \n    @Autowired\n    private TestRestTemplate restTemplate;\n    \n    @Test\n    void testGetUser() {\n        ResponseEntity<User> response = restTemplate.getForEntity(\n            "/api/users/1", \n            User.class\n        );\n        \n        assertEquals(HttpStatus.OK, response.getStatusCode());\n        assertNotNull(response.getBody());\n        assertEquals("John", response.getBody().getName());\n    }\n    \n    @Test\n    void testCreateUser() {\n        User newUser = new User(null, "Jane", "jane@example.com");\n        \n        ResponseEntity<User> response = restTemplate.postForEntity(\n            "/api/users",\n            newUser,\n            User.class\n        );\n        \n        assertEquals(HttpStatus.CREATED, response.getStatusCode());\n        assertNotNull(response.getBody().getId());\n    }\n    \n    @Test\n    void testUpdateUser() {\n        User updateUser = new User(1L, "John Updated", "john@example.com");\n        \n        restTemplate.put("/api/users/1", updateUser);\n        \n        // \u9a8c\u8bc1\u66f4\u65b0\n        ResponseEntity<User> response = restTemplate.getForEntity(\n            "/api/users/1",\n            User.class\n        );\n        assertEquals("John Updated", response.getBody().getName());\n    }\n    \n    @Test\n    void testDeleteUser() {\n        restTemplate.delete("/api/users/1");\n        \n        // \u9a8c\u8bc1\u5220\u9664\n        ResponseEntity<User> response = restTemplate.getForEntity(\n            "/api/users/1",\n            User.class\n        );\n        assertEquals(HttpStatus.NOT_FOUND, response.getStatusCode());\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"8-\u6d4b\u8bd5\u914d\u7f6e",children:"8. \u6d4b\u8bd5\u914d\u7f6e"}),"\n",(0,r.jsx)(n.h3,{id:"81-testconfiguration",children:"8.1 @TestConfiguration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@TestConfiguration\npublic class TestConfig {\n    \n    @Bean\n    public DataSource dataSource() {\n        return new EmbeddedDatabaseBuilder()\n            .setType(EmbeddedDatabaseType.H2)\n            .build();\n    }\n    \n    @Bean\n    public EmailService emailService() {\n        return new MockEmailService();  // \u6d4b\u8bd5\u7528\u7684 Mock \u5b9e\u73b0\n    }\n}\n\n@SpringBootTest\n@Import(TestConfig.class)\nclass ConfigTest {\n    // \u4f7f\u7528\u6d4b\u8bd5\u914d\u7f6e\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"82-mockbean-vs-mock",children:"8.2 @MockBean vs @Mock"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@SpringBootTest\nclass MockBeanExampleTest {\n    \n    // @MockBean - Spring \u5bb9\u5668\u4e2d\u7684 Mock\n    // \u4f1a\u66ff\u6362\u5bb9\u5668\u4e2d\u7684\u771f\u5b9e Bean\n    @MockBean\n    private EmailService emailService;\n    \n    @Autowired\n    private UserService userService;  // \u4f1a\u6ce8\u5165\u4e0a\u9762\u7684 MockBean\n    \n    @Test\n    void test() {\n        when(emailService.send(anyString())).thenReturn(true);\n        userService.registerUser(new User());\n        verify(emailService).send(anyString());\n    }\n}\n\n@ExtendWith(MockitoExtension.class)\nclass MockExampleTest {\n    \n    // @Mock - \u7eaf Mockito Mock\n    // \u4e0d\u5728 Spring \u5bb9\u5668\u4e2d\n    @Mock\n    private EmailService emailService;\n    \n    @InjectMocks\n    private UserService userService;  // \u624b\u52a8\u6ce8\u5165 Mock\n    \n    @Test\n    void test() {\n        when(emailService.send(anyString())).thenReturn(true);\n        userService.registerUser(new User());\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"9-\u65ad\u8a00\u5e93",children:"9. \u65ad\u8a00\u5e93"}),"\n",(0,r.jsx)(n.h3,{id:"91-junit-\u65ad\u8a00",children:"9.1 JUnit \u65ad\u8a00"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Test\nvoid junitAssertions() {\n    User user = new User(1L, "John", "john@example.com");\n    \n    assertEquals(1L, user.getId());\n    assertEquals("John", user.getName());\n    assertNotNull(user.getEmail());\n    assertTrue(user.getEmail().contains("@"));\n    assertFalse(user.getName().isEmpty());\n    \n    assertThrows(IllegalArgumentException.class, () -> {\n        user.setAge(-1);  // \u5047\u8bbe\u4f1a\u629b\u5f02\u5e38\n    });\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"92-assertj-\u65ad\u8a00",children:"9.2 AssertJ \u65ad\u8a00"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Test\nvoid assertJAssertions() {\n    User user = new User(1L, "John", "john@example.com");\n    \n    assertThat(user.getId()).isEqualTo(1L);\n    assertThat(user.getName()).isEqualTo("John").startsWith("J");\n    assertThat(user.getEmail()).isNotNull().contains("@");\n    \n    List<User> users = Arrays.asList(\n        new User(1L, "John", "john@example.com"),\n        new User(2L, "Jane", "jane@example.com")\n    );\n    \n    assertThat(users)\n        .hasSize(2)\n        .extracting(User::getName)\n        .containsExactly("John", "Jane");\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"10-\u6700\u4f73\u5b9e\u8df5",children:"10. \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsx)(n.h3,{id:"101-\u9075\u5faa-aaa-\u6a21\u5f0f",children:"10.1 \u9075\u5faa AAA \u6a21\u5f0f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Test\nvoid testExample() {\n    // Arrange - \u51c6\u5907\u6d4b\u8bd5\u6570\u636e\n    User user = new User(null, "John", "john@example.com");\n    when(userRepository.save(any())).thenReturn(user);\n    \n    // Act - \u6267\u884c\u88ab\u6d4b\u8bd5\u7684\u65b9\u6cd5\n    User result = userService.save(user);\n    \n    // Assert - \u9a8c\u8bc1\u7ed3\u679c\n    assertNotNull(result);\n    assertEquals("John", result.getName());\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"102-\u4f7f\u7528\u6709\u610f\u4e49\u7684\u6d4b\u8bd5\u540d\u79f0",children:"10.2 \u4f7f\u7528\u6709\u610f\u4e49\u7684\u6d4b\u8bd5\u540d\u79f0"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"// \u2705 \u597d\u7684\u547d\u540d\n@Test\nvoid shouldReturnUserWhenUserExists() { }\n\n@Test\nvoid shouldThrowExceptionWhenUserNotFound() { }\n\n// \u274c \u5dee\u7684\u547d\u540d\n@Test\nvoid test1() { }\n\n@Test\nvoid testUser() { }\n"})}),"\n",(0,r.jsx)(n.h3,{id:"103-\u4e00\u4e2a\u6d4b\u8bd5\u53ea\u6d4b\u4e00\u4e2a\u573a\u666f",children:"10.3 \u4e00\u4e2a\u6d4b\u8bd5\u53ea\u6d4b\u4e00\u4e2a\u573a\u666f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"// \u2705 \u63a8\u8350\uff1a\u6bcf\u4e2a\u6d4b\u8bd5\u65b9\u6cd5\u53ea\u6d4b\u4e00\u4e2a\u573a\u666f\n@Test\nvoid shouldReturnUserWhenIdExists() {\n    // \u6d4b\u8bd5\u6b63\u5e38\u60c5\u51b5\n}\n\n@Test\nvoid shouldThrowExceptionWhenIdNotExists() {\n    // \u6d4b\u8bd5\u5f02\u5e38\u60c5\u51b5\n}\n\n// \u274c \u907f\u514d\uff1a\u4e00\u4e2a\u6d4b\u8bd5\u65b9\u6cd5\u6d4b\u591a\u4e2a\u573a\u666f\n@Test\nvoid testFindUser() {\n    // \u6d4b\u8bd5\u591a\u79cd\u60c5\u51b5...\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"104-\u907f\u514d\u6d4b\u8bd5\u79c1\u6709\u65b9\u6cd5",children:"10.4 \u907f\u514d\u6d4b\u8bd5\u79c1\u6709\u65b9\u6cd5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"// \u2705 \u63a8\u8350\uff1a\u6d4b\u8bd5\u516c\u5171\u63a5\u53e3\n@Test\nvoid testPublicMethod() {\n    userService.registerUser(user);  // \u6d4b\u8bd5\u516c\u5171\u65b9\u6cd5\n}\n\n// \u274c \u907f\u514d\uff1a\u6d4b\u8bd5\u79c1\u6709\u65b9\u6cd5\n// \u79c1\u6709\u65b9\u6cd5\u5e94\u8be5\u901a\u8fc7\u516c\u5171\u65b9\u6cd5\u95f4\u63a5\u6d4b\u8bd5\n"})}),"\n",(0,r.jsx)(n.h2,{id:"11-\u603b\u7ed3",children:"11. \u603b\u7ed3"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u6ce8\u89e3"}),(0,r.jsx)(n.th,{children:"\u7528\u9014"}),(0,r.jsx)(n.th,{children:"\u52a0\u8f7d\u5185\u5bb9"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"@SpringBootTest"}),(0,r.jsx)(n.td,{children:"\u5b8c\u6574\u96c6\u6210\u6d4b\u8bd5"}),(0,r.jsx)(n.td,{children:"\u5b8c\u6574\u5e94\u7528\u4e0a\u4e0b\u6587"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"@WebMvcTest"}),(0,r.jsx)(n.td,{children:"Web \u5c42\u6d4b\u8bd5"}),(0,r.jsx)(n.td,{children:"\u4ec5 Web \u5c42"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"@DataJpaTest"}),(0,r.jsx)(n.td,{children:"\u6570\u636e\u5c42\u6d4b\u8bd5"}),(0,r.jsx)(n.td,{children:"\u4ec5 JPA \u7ec4\u4ef6"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"@MockBean"}),(0,r.jsx)(n.td,{children:"Spring Mock"}),(0,r.jsx)(n.td,{children:"\u5bb9\u5668\u4e2d\u7684 Mock Bean"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"@Mock"}),(0,r.jsx)(n.td,{children:"Mockito Mock"}),(0,r.jsx)(n.td,{children:"\u7eaf Mock \u5bf9\u8c61"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u5173\u952e\u8981\u70b9"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5355\u5143\u6d4b\u8bd5\u7528 Mockito\uff0c\u96c6\u6210\u6d4b\u8bd5\u7528 @SpringBootTest"}),"\n",(0,r.jsx)(n.li,{children:"\u4f7f\u7528\u5207\u7247\u6d4b\u8bd5\u63d0\u9ad8\u6d4b\u8bd5\u901f\u5ea6"}),"\n",(0,r.jsx)(n.li,{children:"\u9075\u5faa AAA \u6a21\u5f0f\u7f16\u5199\u6e05\u6670\u7684\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.li,{children:"\u4f7f\u7528\u5185\u5b58\u6570\u636e\u5e93\u8fdb\u884c\u6570\u636e\u5c42\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.li,{children:"\u6d4b\u8bd5\u5e94\u8be5\u5feb\u901f\u3001\u72ec\u7acb\u3001\u53ef\u91cd\u590d"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u4e0b\u4e00\u6b65"}),"\uff1a\u5b66\u4e60 ",(0,r.jsx)(n.a,{href:"./best-practices",children:"\u6700\u4f73\u5b9e\u8df5"})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);
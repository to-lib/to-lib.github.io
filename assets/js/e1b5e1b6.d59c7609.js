"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[59052],{48885:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>d});var l=s(99378);const a={},r=l.createContext(a);function i(e){const n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),l.createElement(r.Provider,{value:n},e.children)}},90065:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"postgres/performance-optimization","title":"\u6027\u80fd\u4f18\u5316","description":"\u6027\u80fd\u4f18\u5316\u662f\u6570\u636e\u5e93\u4f7f\u7528\u4e2d\u7684\u91cd\u8981\u73af\u8282\uff0c\u672c\u6587\u4ecb\u7ecd\u5e38\u89c1\u7684\u4f18\u5316\u7b56\u7565\u548c\u6280\u5de7\u3002","source":"@site/docs/postgres/performance-optimization.md","sourceDirName":"postgres","slug":"/postgres/performance-optimization","permalink":"/docs/postgres/performance-optimization","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/postgres/performance-optimization.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"\u6027\u80fd\u4f18\u5316"},"sidebar":"postgres","previous":{"title":"\u5b58\u50a8\u8fc7\u7a0b\u4e0e\u51fd\u6570","permalink":"/docs/postgres/stored-procedures"},"next":{"title":"\u76d1\u63a7\u4e0e\u6392\u969c","permalink":"/docs/postgres/monitoring-and-troubleshooting"}}');var a=s(22714),r=s(48885);const i={sidebar_position:7,title:"\u6027\u80fd\u4f18\u5316"},d="PostgreSQL \u6027\u80fd\u4f18\u5316",t={},c=[{value:"\ud83d\udcca \u6027\u80fd\u5206\u6790",id:"-\u6027\u80fd\u5206\u6790",level:2},{value:"1. EXPLAIN \u5206\u6790\u67e5\u8be2\u8ba1\u5212",id:"1-explain-\u5206\u6790\u67e5\u8be2\u8ba1\u5212",level:3},{value:"2. pg_stat_statements \u6269\u5c55",id:"2-pg_stat_statements-\u6269\u5c55",level:3},{value:"\ud83c\udfaf \u7d22\u5f15\u4f18\u5316",id:"-\u7d22\u5f15\u4f18\u5316",level:2},{value:"1. \u521b\u5efa\u5408\u9002\u7684\u7d22\u5f15",id:"1-\u521b\u5efa\u5408\u9002\u7684\u7d22\u5f15",level:3},{value:"2. \u67e5\u627e\u7f3a\u5931\u7684\u7d22\u5f15",id:"2-\u67e5\u627e\u7f3a\u5931\u7684\u7d22\u5f15",level:3},{value:"\ud83d\udd27 \u67e5\u8be2\u4f18\u5316",id:"-\u67e5\u8be2\u4f18\u5316",level:2},{value:"1. \u907f\u514d SELECT *",id:"1-\u907f\u514d-select-",level:3},{value:"2. \u4f7f\u7528 LIMIT",id:"2-\u4f7f\u7528-limit",level:3},{value:"3. \u907f\u514d\u5b50\u67e5\u8be2\uff0c\u4f7f\u7528 JOIN",id:"3-\u907f\u514d\u5b50\u67e5\u8be2\u4f7f\u7528-join",level:3},{value:"4. \u4f7f\u7528 EXISTS \u4ee3\u66ff IN",id:"4-\u4f7f\u7528-exists-\u4ee3\u66ff-in",level:3},{value:"\ud83d\udcbe \u914d\u7f6e\u4f18\u5316",id:"-\u914d\u7f6e\u4f18\u5316",level:2},{value:"1. \u5185\u5b58\u914d\u7f6e",id:"1-\u5185\u5b58\u914d\u7f6e",level:3},{value:"2. \u8fde\u63a5\u6c60\u914d\u7f6e",id:"2-\u8fde\u63a5\u6c60\u914d\u7f6e",level:3},{value:"3. WAL \u914d\u7f6e",id:"3-wal-\u914d\u7f6e",level:3},{value:"\ud83d\udd04 VACUUM \u548c ANALYZE",id:"-vacuum-\u548c-analyze",level:2},{value:"1. VACUUM",id:"1-vacuum",level:3},{value:"2. ANALYZE",id:"2-analyze",level:3},{value:"3. \u76d1\u63a7 VACUUM",id:"3-\u76d1\u63a7-vacuum",level:3},{value:"\ud83d\uddc2\ufe0f \u5206\u533a\u8868",id:"\ufe0f-\u5206\u533a\u8868",level:2},{value:"\u8303\u56f4\u5206\u533a",id:"\u8303\u56f4\u5206\u533a",level:3},{value:"\u5217\u8868\u5206\u533a",id:"\u5217\u8868\u5206\u533a",level:3},{value:"\ud83d\udcc8 \u7f13\u5b58\u7b56\u7565",id:"-\u7f13\u5b58\u7b56\u7565",level:2},{value:"1. \u67e5\u8be2\u7ed3\u679c\u7f13\u5b58",id:"1-\u67e5\u8be2\u7ed3\u679c\u7f13\u5b58",level:3},{value:"2. \u7269\u5316\u89c6\u56fe",id:"2-\u7269\u5316\u89c6\u56fe",level:3},{value:"\ud83c\udf93 \u8fde\u63a5\u4f18\u5316",id:"-\u8fde\u63a5\u4f18\u5316",level:2},{value:"1. \u4f7f\u7528\u8fde\u63a5\u6c60",id:"1-\u4f7f\u7528\u8fde\u63a5\u6c60",level:3},{value:"2. \u51cf\u5c11\u8fde\u63a5\u6570",id:"2-\u51cf\u5c11\u8fde\u63a5\u6570",level:3},{value:"\ud83d\udca1 \u6700\u4f73\u5b9e\u8df5",id:"-\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u6279\u91cf\u64cd\u4f5c",id:"1-\u6279\u91cf\u64cd\u4f5c",level:3},{value:"2. \u9884\u7f16\u8bd1\u8bed\u53e5",id:"2-\u9884\u7f16\u8bd1\u8bed\u53e5",level:3},{value:"3. \u907f\u514d N+1 \u67e5\u8be2\u95ee\u9898",id:"3-\u907f\u514d-n1-\u67e5\u8be2\u95ee\u9898",level:3},{value:"\ud83d\udcca \u76d1\u63a7\u6307\u6807",id:"-\u76d1\u63a7\u6307\u6807",level:2},{value:"1. \u7f13\u5b58\u547d\u4e2d\u7387",id:"1-\u7f13\u5b58\u547d\u4e2d\u7387",level:3},{value:"2. \u7d22\u5f15\u4f7f\u7528\u7387",id:"2-\u7d22\u5f15\u4f7f\u7528\u7387",level:3},{value:"3. \u8868\u5927\u5c0f",id:"3-\u8868\u5927\u5c0f",level:3},{value:"\ud83d\udcda \u76f8\u5173\u8d44\u6e90",id:"-\u76f8\u5173\u8d44\u6e90",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"postgresql-\u6027\u80fd\u4f18\u5316",children:"PostgreSQL \u6027\u80fd\u4f18\u5316"})}),"\n",(0,a.jsx)(n.p,{children:"\u6027\u80fd\u4f18\u5316\u662f\u6570\u636e\u5e93\u4f7f\u7528\u4e2d\u7684\u91cd\u8981\u73af\u8282\uff0c\u672c\u6587\u4ecb\u7ecd\u5e38\u89c1\u7684\u4f18\u5316\u7b56\u7565\u548c\u6280\u5de7\u3002"}),"\n",(0,a.jsx)(n.h2,{id:"-\u6027\u80fd\u5206\u6790",children:"\ud83d\udcca \u6027\u80fd\u5206\u6790"}),"\n",(0,a.jsx)(n.h3,{id:"1-explain-\u5206\u6790\u67e5\u8be2\u8ba1\u5212",children:"1. EXPLAIN \u5206\u6790\u67e5\u8be2\u8ba1\u5212"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u67e5\u770b\u67e5\u8be2\u8ba1\u5212\nEXPLAIN SELECT * FROM users WHERE age > 25;\n\n-- \u5b9e\u9645\u6267\u884c\u5e76\u5206\u6790\nEXPLAIN ANALYZE SELECT * FROM users WHERE age > 25;\n\n-- \u8be6\u7ec6\u8f93\u51fa\nEXPLAIN (ANALYZE, BUFFERS, VERBOSE)\nSELECT * FROM users WHERE age > 25;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-pg_stat_statements-\u6269\u5c55",children:"2. pg_stat_statements \u6269\u5c55"}),"\n",(0,a.jsx)(n.p,{children:"\u8ddf\u8e2a\u6240\u6709 SQL \u8bed\u53e5\u7684\u6267\u884c\u7edf\u8ba1\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u542f\u7528\u6269\u5c55\nCREATE EXTENSION pg_stat_statements;\n\n-- \u67e5\u770b\u6700\u6162\u7684\u67e5\u8be2\nSELECT\n    query,\n    calls,\n    total_exec_time,\n    mean_exec_time,\n    max_exec_time\nFROM pg_stat_statements\nORDER BY mean_exec_time DESC\nLIMIT 10;\n\n-- \u91cd\u7f6e\u7edf\u8ba1\nSELECT pg_stat_statements_reset();\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-\u7d22\u5f15\u4f18\u5316",children:"\ud83c\udfaf \u7d22\u5f15\u4f18\u5316"}),"\n",(0,a.jsx)(n.h3,{id:"1-\u521b\u5efa\u5408\u9002\u7684\u7d22\u5f15",children:"1. \u521b\u5efa\u5408\u9002\u7684\u7d22\u5f15"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u5355\u5217\u7d22\u5f15\nCREATE INDEX idx_users_email ON users(email);\n\n-- \u590d\u5408\u7d22\u5f15\nCREATE INDEX idx_users_name_age ON users(last_name, first_name);\n\n-- \u90e8\u5206\u7d22\u5f15\nCREATE INDEX idx_active_users ON users(username)\nWHERE is_active = true;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-\u67e5\u627e\u7f3a\u5931\u7684\u7d22\u5f15",children:"2. \u67e5\u627e\u7f3a\u5931\u7684\u7d22\u5f15"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"SELECT\n    schemaname,\n    tablename,\n    attname,\n    n_distinct,\n    correlation\nFROM pg_stats\nWHERE schemaname = 'public'\nAND n_distinct > 100\nORDER BY correlation;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-\u67e5\u8be2\u4f18\u5316",children:"\ud83d\udd27 \u67e5\u8be2\u4f18\u5316"}),"\n",(0,a.jsx)(n.h3,{id:"1-\u907f\u514d-select-",children:"1. \u907f\u514d SELECT *"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u274c \u4e0d\u597d\nSELECT * FROM users;\n\n-- \u2705 \u597d\nSELECT id, username, email FROM users;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-\u4f7f\u7528-limit",children:"2. \u4f7f\u7528 LIMIT"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u9650\u5236\u8fd4\u56de\u884c\u6570\nSELECT * FROM users ORDER BY created_at DESC LIMIT 10;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-\u907f\u514d\u5b50\u67e5\u8be2\u4f7f\u7528-join",children:"3. \u907f\u514d\u5b50\u67e5\u8be2\uff0c\u4f7f\u7528 JOIN"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u274c \u4e0d\u597d\nSELECT * FROM users\nWHERE id IN (SELECT user_id FROM orders WHERE total > 1000);\n\n-- \u2705 \u597d\nSELECT DISTINCT u.*\nFROM users u\nJOIN orders o ON u.id = o.user_id\nWHERE o.total > 1000;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"4-\u4f7f\u7528-exists-\u4ee3\u66ff-in",children:"4. \u4f7f\u7528 EXISTS \u4ee3\u66ff IN"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u274c \u4e0d\u597d\nSELECT * FROM users\nWHERE id IN (SELECT user_id FROM orders);\n\n-- \u2705 \u597d\nSELECT * FROM users u\nWHERE EXISTS (SELECT 1 FROM orders o WHERE o.user_id = u.id);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-\u914d\u7f6e\u4f18\u5316",children:"\ud83d\udcbe \u914d\u7f6e\u4f18\u5316"}),"\n",(0,a.jsx)(n.h3,{id:"1-\u5185\u5b58\u914d\u7f6e",children:"1. \u5185\u5b58\u914d\u7f6e"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u67e5\u770b\u5f53\u524d\u914d\u7f6e\nSHOW shared_buffers;\nSHOW work_mem;\nSHOW maintenance_work_mem;\n\n-- \u4fee\u6539\u914d\u7f6e\uff08postgresql.conf\uff09\nshared_buffers = 256MB          # \u5171\u4eab\u7f13\u51b2\u533a\uff08\u5efa\u8bae\u4e3a\u7cfb\u7edf\u5185\u5b58\u7684 25%\uff09\nwork_mem = 4MB                  # \u6bcf\u4e2a\u67e5\u8be2\u7684\u5de5\u4f5c\u5185\u5b58\nmaintenance_work_mem = 64MB     # \u7ef4\u62a4\u64cd\u4f5c\u7684\u5185\u5b58\neffective_cache_size = 1GB      # \u64cd\u4f5c\u7cfb\u7edf\u7f13\u5b58\u5927\u5c0f\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-\u8fde\u63a5\u6c60\u914d\u7f6e",children:"2. \u8fde\u63a5\u6c60\u914d\u7f6e"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"max_connections = 100           # \u6700\u5927\u8fde\u63a5\u6570\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u63a8\u8350\u4f7f\u7528\u8fde\u63a5\u6c60\uff1a"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"PgBouncer"}),"\n",(0,a.jsx)(n.li,{children:"Pgpool-II"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"3-wal-\u914d\u7f6e",children:"3. WAL \u914d\u7f6e"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"wal_buffers = 16MB\ncheckpoint_timeout = 10min\nmax_wal_size = 1GB\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-vacuum-\u548c-analyze",children:"\ud83d\udd04 VACUUM \u548c ANALYZE"}),"\n",(0,a.jsx)(n.h3,{id:"1-vacuum",children:"1. VACUUM"}),"\n",(0,a.jsx)(n.p,{children:"\u6e05\u7406\u6b7b\u5143\u7ec4\uff0c\u56de\u6536\u7a7a\u95f4\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u624b\u52a8 VACUUM\nVACUUM users;\n\n-- FULL VACUUM\uff08\u9501\u8868\uff0c\u614e\u7528\uff09\nVACUUM FULL users;\n\n-- \u81ea\u52a8 VACUUM\uff08\u63a8\u8350\uff09\nautovacuum = on\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-analyze",children:"2. ANALYZE"}),"\n",(0,a.jsx)(n.p,{children:"\u66f4\u65b0\u7edf\u8ba1\u4fe1\u606f\uff0c\u5e2e\u52a9\u67e5\u8be2\u4f18\u5316\u5668\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u5206\u6790\u8868\nANALYZE users;\n\n-- \u5206\u6790\u6240\u6709\u8868\nANALYZE;\n\n-- VACUUM + ANALYZE\nVACUUM ANALYZE users;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-\u76d1\u63a7-vacuum",children:"3. \u76d1\u63a7 VACUUM"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u67e5\u770b\u8868\u7684\u81a8\u80c0\u60c5\u51b5\nSELECT\n    schemaname,\n    tablename,\n    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size,\n    n_dead_tup,\n    n_live_tup,\n    ROUND(n_dead_tup * 100.0 / NULLIF(n_live_tup + n_dead_tup, 0), 2) as dead_ratio\nFROM pg_stat_user_tables\nORDER BY n_dead_tup DESC;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\ufe0f-\u5206\u533a\u8868",children:"\ud83d\uddc2\ufe0f \u5206\u533a\u8868"}),"\n",(0,a.jsx)(n.p,{children:"\u5bf9\u5927\u8868\u8fdb\u884c\u5206\u533a\uff0c\u63d0\u5347\u67e5\u8be2\u6027\u80fd\u3002"}),"\n",(0,a.jsx)(n.h3,{id:"\u8303\u56f4\u5206\u533a",children:"\u8303\u56f4\u5206\u533a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u521b\u5efa\u4e3b\u8868\nCREATE TABLE orders (\n    id SERIAL,\n    user_id INT,\n    total NUMERIC(10, 2),\n    created_at DATE NOT NULL\n) PARTITION BY RANGE (created_at);\n\n-- \u521b\u5efa\u5206\u533a\nCREATE TABLE orders_2024_q1 PARTITION OF orders\nFOR VALUES FROM ('2024-01-01') TO ('2024-04-01');\n\nCREATE TABLE orders_2024_q2 PARTITION OF orders\nFOR VALUES FROM ('2024-04-01') TO ('2024-07-01');\n\n-- \u67e5\u8be2\uff08\u81ea\u52a8\u4f7f\u7528\u5408\u9002\u7684\u5206\u533a\uff09\nSELECT * FROM orders WHERE created_at >= '2024-02-01';\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u5217\u8868\u5206\u533a",children:"\u5217\u8868\u5206\u533a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE users (\n    id SERIAL,\n    username VARCHAR(50),\n    country VARCHAR(2)\n) PARTITION BY LIST (country);\n\nCREATE TABLE users_cn PARTITION OF users FOR VALUES IN ('CN');\nCREATE TABLE users_us PARTITION OF users FOR VALUES IN ('US');\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-\u7f13\u5b58\u7b56\u7565",children:"\ud83d\udcc8 \u7f13\u5b58\u7b56\u7565"}),"\n",(0,a.jsx)(n.h3,{id:"1-\u67e5\u8be2\u7ed3\u679c\u7f13\u5b58",children:"1. \u67e5\u8be2\u7ed3\u679c\u7f13\u5b58"}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u5e94\u7528\u5c42\u4f7f\u7528 Redis \u7b49\u7f13\u5b58\u67e5\u8be2\u7ed3\u679c\u3002"}),"\n",(0,a.jsx)(n.h3,{id:"2-\u7269\u5316\u89c6\u56fe",children:"2. \u7269\u5316\u89c6\u56fe"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u521b\u5efa\u7269\u5316\u89c6\u56fe\nCREATE MATERIALIZED VIEW user_stats AS\nSELECT\n    DATE(created_at) as date,\n    COUNT(*) as user_count\nFROM users\nGROUP BY DATE(created_at);\n\n-- \u5237\u65b0\u7269\u5316\u89c6\u56fe\nREFRESH MATERIALIZED VIEW user_stats;\n\n-- \u5e76\u53d1\u5237\u65b0\uff08\u4e0d\u9501\u5b9a\uff09\nREFRESH MATERIALIZED VIEW CONCURRENTLY user_stats;\n\n-- \u521b\u5efa\u7d22\u5f15\nCREATE UNIQUE INDEX idx_user_stats_date ON user_stats(date);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-\u8fde\u63a5\u4f18\u5316",children:"\ud83c\udf93 \u8fde\u63a5\u4f18\u5316"}),"\n",(0,a.jsx)(n.h3,{id:"1-\u4f7f\u7528\u8fde\u63a5\u6c60",children:"1. \u4f7f\u7528\u8fde\u63a5\u6c60"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u5b89\u88c5 PgBouncer\nsudo apt-get install pgbouncer\n\n# \u914d\u7f6e pgbouncer.ini\n[databases]\nmydb = host=localhost port=5432 dbname=mydb\n\n[pgbouncer]\nlisten_port = 6432\nlisten_addr = *\nauth_type = md5\npool_mode = transaction\nmax_client_conn = 1000\ndefault_pool_size = 20\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-\u51cf\u5c11\u8fde\u63a5\u6570",children:"2. \u51cf\u5c11\u8fde\u63a5\u6570"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# \u4f7f\u7528\u8fde\u63a5\u6c60\nfrom psycopg2 import pool\n\nconnection_pool = pool.SimpleConnectionPool(\n    minconn=1,\n    maxconn=20,\n    host='localhost',\n    database='mydb'\n)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-\u6700\u4f73\u5b9e\u8df5",children:"\ud83d\udca1 \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,a.jsx)(n.h3,{id:"1-\u6279\u91cf\u64cd\u4f5c",children:"1. \u6279\u91cf\u64cd\u4f5c"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u274c \u4e0d\u597d\nINSERT INTO users (username) VALUES ('user1');\nINSERT INTO users (username) VALUES ('user2');\nINSERT INTO users (username) VALUES ('user3');\n\n-- \u2705 \u597d\nINSERT INTO users (username) VALUES\n('user1'),\n('user2'),\n('user3');\n\n-- \u6216\u4f7f\u7528 COPY\uff08\u6700\u5feb\uff09\nCOPY users (username) FROM '/path/to/data.csv' CSV;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-\u9884\u7f16\u8bd1\u8bed\u53e5",children:"2. \u9884\u7f16\u8bd1\u8bed\u53e5"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# \u4f7f\u7528\u53c2\u6570\u5316\u67e5\u8be2\ncursor.execute(\n    "SELECT * FROM users WHERE username = %s",\n    (username,)\n)\n'})}),"\n",(0,a.jsx)(n.h3,{id:"3-\u907f\u514d-n1-\u67e5\u8be2\u95ee\u9898",children:"3. \u907f\u514d N+1 \u67e5\u8be2\u95ee\u9898"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- \u274c N+1 \u67e5\u8be2\nSELECT * FROM users;  -- 1 \u6b21\u67e5\u8be2\n-- \u7136\u540e\u5bf9\u6bcf\u4e2a\u7528\u6237\u67e5\u8be2\u8ba2\u5355\uff08N \u6b21\uff09\nSELECT * FROM orders WHERE user_id = ?;\n\n-- \u2705 \u4f7f\u7528 JOIN\nSELECT u.*, o.*\nFROM users u\nLEFT JOIN orders o ON u.id = o.user_id;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-\u76d1\u63a7\u6307\u6807",children:"\ud83d\udcca \u76d1\u63a7\u6307\u6807"}),"\n",(0,a.jsx)(n.h3,{id:"1-\u7f13\u5b58\u547d\u4e2d\u7387",children:"1. \u7f13\u5b58\u547d\u4e2d\u7387"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"SELECT\n    sum(heap_blks_read) as heap_read,\n    sum(heap_blks_hit) as heap_hit,\n    sum(heap_blks_hit) / (sum(heap_blks_hit) + sum(heap_blks_read)) as ratio\nFROM pg_statio_user_tables;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-\u7d22\u5f15\u4f7f\u7528\u7387",children:"2. \u7d22\u5f15\u4f7f\u7528\u7387"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"SELECT\n    schemaname,\n    tablename,\n    indexname,\n    idx_scan,\n    idx_tup_read,\n    idx_tup_fetch\nFROM pg_stat_user_indexes\nORDER BY idx_scan DESC;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-\u8868\u5927\u5c0f",children:"3. \u8868\u5927\u5c0f"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"SELECT\n    schemaname,\n    tablename,\n    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size\nFROM pg_tables\nWHERE schemaname = 'public'\nORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-\u76f8\u5173\u8d44\u6e90",children:"\ud83d\udcda \u76f8\u5173\u8d44\u6e90"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/postgres/indexes",children:"\u7d22\u5f15\u4f18\u5316"})," - \u6df1\u5165\u4e86\u89e3\u7d22\u5f15"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/postgres/transactions",children:"\u4e8b\u52a1\u7ba1\u7406"})," - \u4e8b\u52a1\u548c\u5e76\u53d1"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/postgres/backup-recovery",children:"\u5907\u4efd\u6062\u590d"})," - \u6570\u636e\u5b89\u5168"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["\u4e0b\u4e00\u8282\uff1a",(0,a.jsx)(n.a,{href:"/docs/postgres/backup-recovery",children:"\u5907\u4efd\u6062\u590d"})]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}}}]);
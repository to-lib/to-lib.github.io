"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[4367],{48885:(n,e,s)=>{s.d(e,{R:()=>d,x:()=>c});var i=s(99378);const l={},r=i.createContext(l);function d(n){const e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:d(n.components),i.createElement(r.Provider,{value:e},n.children)}},63243:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"redis/sentinel","title":"Redis \u54e8\u5175\u6a21\u5f0f","description":"Redis Sentinel\uff08\u54e8\u5175\uff09\u662f Redis \u5b98\u65b9\u63d0\u4f9b\u7684\u9ad8\u53ef\u7528\u89e3\u51b3\u65b9\u6848\uff0c\u7528\u4e8e\u76d1\u63a7\u4e3b\u4ece\u67b6\u6784\uff0c\u5e76\u5728\u4e3b\u8282\u70b9\u6545\u969c\u65f6\u81ea\u52a8\u8fdb\u884c\u6545\u969c\u8f6c\u79fb\u3002","source":"@site/docs/redis/sentinel.md","sourceDirName":"redis","slug":"/redis/sentinel","permalink":"/docs/redis/sentinel","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/redis/sentinel.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Redis \u54e8\u5175\u6a21\u5f0f"},"sidebar":"redis","previous":{"title":"Redis \u4e3b\u4ece\u590d\u5236","permalink":"/docs/redis/replication"},"next":{"title":"Redis \u96c6\u7fa4","permalink":"/docs/redis/cluster"}}');var l=s(22714),r=s(48885);const d={sidebar_position:6,title:"Redis \u54e8\u5175\u6a21\u5f0f"},c="Redis \u54e8\u5175\u6a21\u5f0f",a={},t=[{value:"\u54e8\u5175\u7684\u4f5c\u7528",id:"\u54e8\u5175\u7684\u4f5c\u7528",level:2},{value:"\u6838\u5fc3\u529f\u80fd",id:"\u6838\u5fc3\u529f\u80fd",level:3},{value:"\u67b6\u6784",id:"\u67b6\u6784",level:3},{value:"\u914d\u7f6e\u54e8\u5175",id:"\u914d\u7f6e\u54e8\u5175",level:2},{value:"1. \u51c6\u5907 Redis \u4e3b\u4ece",id:"1-\u51c6\u5907-redis-\u4e3b\u4ece",level:3},{value:"2. \u914d\u7f6e\u54e8\u5175",id:"2-\u914d\u7f6e\u54e8\u5175",level:3},{value:"3. \u542f\u52a8\u54e8\u5175",id:"3-\u542f\u52a8\u54e8\u5175",level:3},{value:"4. \u67e5\u770b\u54e8\u5175\u72b6\u6001",id:"4-\u67e5\u770b\u54e8\u5175\u72b6\u6001",level:3},{value:"\u6545\u969c\u8f6c\u79fb\u6d41\u7a0b",id:"\u6545\u969c\u8f6c\u79fb\u6d41\u7a0b",level:2},{value:"\u4e3b\u8282\u70b9\u4e0b\u7ebf\u5224\u5b9a",id:"\u4e3b\u8282\u70b9\u4e0b\u7ebf\u5224\u5b9a",level:3},{value:"\u9009\u4e3e Leader",id:"\u9009\u4e3e-leader",level:3},{value:"\u9009\u62e9\u65b0\u4e3b\u8282\u70b9",id:"\u9009\u62e9\u65b0\u4e3b\u8282\u70b9",level:3},{value:"\u6545\u969c\u8f6c\u79fb\u6b65\u9aa4",id:"\u6545\u969c\u8f6c\u79fb\u6b65\u9aa4",level:3},{value:"\u5ba2\u6237\u7aef\u8fde\u63a5",id:"\u5ba2\u6237\u7aef\u8fde\u63a5",level:2},{value:"Java\uff08Jedis\uff09",id:"javajedis",level:3},{value:"Spring Boot",id:"spring-boot",level:3},{value:"\u54e8\u5175\u547d\u4ee4",id:"\u54e8\u5175\u547d\u4ee4",level:2},{value:"\u76d1\u63a7\u547d\u4ee4",id:"\u76d1\u63a7\u547d\u4ee4",level:3},{value:"\u7ba1\u7406\u547d\u4ee4",id:"\u7ba1\u7406\u547d\u4ee4",level:3},{value:"\u914d\u7f6e\u53c2\u6570\u8be6\u89e3",id:"\u914d\u7f6e\u53c2\u6570\u8be6\u89e3",level:2},{value:"\u76d1\u63a7\u914d\u7f6e",id:"\u76d1\u63a7\u914d\u7f6e",level:3},{value:"\u8ba4\u8bc1\u914d\u7f6e",id:"\u8ba4\u8bc1\u914d\u7f6e",level:3},{value:"\u8d85\u65f6\u914d\u7f6e",id:"\u8d85\u65f6\u914d\u7f6e",level:3},{value:"\u590d\u5236\u914d\u7f6e",id:"\u590d\u5236\u914d\u7f6e",level:3},{value:"\u901a\u77e5\u914d\u7f6e",id:"\u901a\u77e5\u914d\u7f6e",level:3},{value:"\u54e8\u5175\u96c6\u7fa4",id:"\u54e8\u5175\u96c6\u7fa4",level:2},{value:"\u90e8\u7f72\u5efa\u8bae",id:"\u90e8\u7f72\u5efa\u8bae",level:3},{value:"\u793a\u4f8b\uff1a3 \u54e8\u5175\u96c6\u7fa4",id:"\u793a\u4f8b3-\u54e8\u5175\u96c6\u7fa4",level:3},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:2},{value:"1. \u8111\u88c2\u95ee\u9898",id:"1-\u8111\u88c2\u95ee\u9898",level:3},{value:"2. \u54e8\u5175\u65e0\u6cd5\u8fde\u63a5\u4e3b\u8282\u70b9",id:"2-\u54e8\u5175\u65e0\u6cd5\u8fde\u63a5\u4e3b\u8282\u70b9",level:3},{value:"3. \u9891\u7e41\u6545\u969c\u8f6c\u79fb",id:"3-\u9891\u7e41\u6545\u969c\u8f6c\u79fb",level:3},{value:"4. \u6545\u969c\u8f6c\u79fb\u5931\u8d25",id:"4-\u6545\u969c\u8f6c\u79fb\u5931\u8d25",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u54e8\u5175\u6570\u91cf",id:"1-\u54e8\u5175\u6570\u91cf",level:3},{value:"2. quorum \u8bbe\u7f6e",id:"2-quorum-\u8bbe\u7f6e",level:3},{value:"3. \u8d85\u65f6\u914d\u7f6e",id:"3-\u8d85\u65f6\u914d\u7f6e",level:3},{value:"4. \u76d1\u63a7\u54e8\u5175",id:"4-\u76d1\u63a7\u54e8\u5175",level:3},{value:"5. \u6d4b\u8bd5\u6545\u969c\u8f6c\u79fb",id:"5-\u6d4b\u8bd5\u6545\u969c\u8f6c\u79fb",level:3},{value:"\u5c0f\u7ed3",id:"\u5c0f\u7ed3",level:2}];function o(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"redis-\u54e8\u5175\u6a21\u5f0f",children:"Redis \u54e8\u5175\u6a21\u5f0f"})}),"\n",(0,l.jsx)(e.p,{children:"Redis Sentinel\uff08\u54e8\u5175\uff09\u662f Redis \u5b98\u65b9\u63d0\u4f9b\u7684\u9ad8\u53ef\u7528\u89e3\u51b3\u65b9\u6848\uff0c\u7528\u4e8e\u76d1\u63a7\u4e3b\u4ece\u67b6\u6784\uff0c\u5e76\u5728\u4e3b\u8282\u70b9\u6545\u969c\u65f6\u81ea\u52a8\u8fdb\u884c\u6545\u969c\u8f6c\u79fb\u3002"}),"\n",(0,l.jsx)(e.h2,{id:"\u54e8\u5175\u7684\u4f5c\u7528",children:"\u54e8\u5175\u7684\u4f5c\u7528"}),"\n",(0,l.jsx)(e.h3,{id:"\u6838\u5fc3\u529f\u80fd",children:"\u6838\u5fc3\u529f\u80fd"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u76d1\u63a7\uff08Monitoring\uff09"})," - \u76d1\u63a7\u4e3b\u4ece\u8282\u70b9\u662f\u5426\u6b63\u5e38\u8fd0\u884c"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u901a\u77e5\uff08Notification\uff09"})," - \u53d1\u9001\u6545\u969c\u901a\u77e5"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\uff08Automatic Failover\uff09"})," - \u4e3b\u8282\u70b9\u6545\u969c\u65f6\uff0c\u81ea\u52a8\u63d0\u5347\u4ece\u8282\u70b9\u4e3a\u4e3b\u8282\u70b9"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u914d\u7f6e\u4e2d\u5fc3\uff08Configuration Provider\uff09"})," - \u5ba2\u6237\u7aef\u901a\u8fc7 Sentinel \u83b7\u53d6\u4e3b\u8282\u70b9\u5730\u5740"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u67b6\u6784",children:"\u67b6\u6784"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"        +----------+  +----------+  +----------+\n        | Sentinel1|  | Sentinel2|  | Sentinel3|\n        +----------+  +----------+  +----------+\n             |             |             |\n             +-------------+-------------+\n                           |\n        +------------------+------------------+\n        |                  |                  |\n    +--------+        +--------+        +--------+\n    | Master |-------\x3e| Slave1 |        | Slave2 |\n    +--------+        +--------+        +--------+\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u914d\u7f6e\u54e8\u5175",children:"\u914d\u7f6e\u54e8\u5175"}),"\n",(0,l.jsx)(e.h3,{id:"1-\u51c6\u5907-redis-\u4e3b\u4ece",children:"1. \u51c6\u5907 Redis \u4e3b\u4ece"}),"\n",(0,l.jsxs)(e.p,{children:["\u9996\u5148\u914d\u7f6e\u4e00\u4e2a\u4e3b\u4ece\u67b6\u6784\uff08\u53c2\u8003",(0,l.jsx)(e.a,{href:"/docs/redis/replication",children:"\u4e3b\u4ece\u590d\u5236"}),"\u7ae0\u8282\uff09\u3002"]}),"\n",(0,l.jsx)(e.h3,{id:"2-\u914d\u7f6e\u54e8\u5175",children:"2. \u914d\u7f6e\u54e8\u5175"}),"\n",(0,l.jsxs)(e.p,{children:["\u521b\u5efa ",(0,l.jsx)(e.code,{children:"sentinel.conf"})," \u914d\u7f6e\u6587\u4ef6\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-conf",children:'# \u54e8\u5175\u7aef\u53e3\nport 26379\n\n# \u540e\u53f0\u8fd0\u884c\ndaemonize yes\n\n# \u65e5\u5fd7\u6587\u4ef6\nlogfile "/var/log/redis/sentinel.log"\n\n# \u5de5\u4f5c\u76ee\u5f55\ndir /var/lib/redis\n\n# \u76d1\u63a7\u4e3b\u8282\u70b9\n# sentinel monitor <master-name> <ip> <port> <quorum>\n# quorum: \u5224\u5b9a\u4e3b\u8282\u70b9\u4e0b\u7ebf\u9700\u8981\u7684\u54e8\u5175\u6570\u91cf\nsentinel monitor mymaster 192.168.1.100 6379 2\n\n# \u4e3b\u8282\u70b9\u5bc6\u7801\nsentinel auth-pass mymaster mypassword\n\n# \u5224\u5b9a\u4e3b\u8282\u70b9\u4e0b\u7ebf\u65f6\u95f4\uff08\u6beb\u79d2\uff09\nsentinel down-after-milliseconds mymaster 30000\n\n# \u6545\u969c\u8f6c\u79fb\u8d85\u65f6\u65f6\u95f4\uff08\u6beb\u79d2\uff09\nsentinel failover-timeout mymaster 180000\n\n# \u540c\u65f6\u8fdb\u884c\u590d\u5236\u7684\u4ece\u8282\u70b9\u6570\u91cf\nsentinel parallel-syncs mymaster 1\n'})}),"\n",(0,l.jsx)(e.h3,{id:"3-\u542f\u52a8\u54e8\u5175",children:"3. \u542f\u52a8\u54e8\u5175"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u542f\u52a8\u54e8\u5175\nredis-sentinel /etc/redis/sentinel.conf\n\n# \u6216\u8005\nredis-server /etc/redis/sentinel.conf --sentinel\n"})}),"\n",(0,l.jsx)(e.h3,{id:"4-\u67e5\u770b\u54e8\u5175\u72b6\u6001",children:"4. \u67e5\u770b\u54e8\u5175\u72b6\u6001"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u8fde\u63a5\u54e8\u5175\nredis-cli -p 26379\n\n# \u67e5\u770b\u4e3b\u8282\u70b9\u4fe1\u606f\nSENTINEL master mymaster\n\n# \u67e5\u770b\u4ece\u8282\u70b9\u4fe1\u606f\nSENTINEL slaves mymaster\n\n# \u67e5\u770b\u5176\u4ed6\u54e8\u5175\u4fe1\u606f\nSENTINEL sentinels mymaster\n\n# \u67e5\u770b\u76d1\u63a7\u7684\u4e3b\u8282\u70b9\u5217\u8868\nSENTINEL masters\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u6545\u969c\u8f6c\u79fb\u6d41\u7a0b",children:"\u6545\u969c\u8f6c\u79fb\u6d41\u7a0b"}),"\n",(0,l.jsx)(e.h3,{id:"\u4e3b\u8282\u70b9\u4e0b\u7ebf\u5224\u5b9a",children:"\u4e3b\u8282\u70b9\u4e0b\u7ebf\u5224\u5b9a"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u4e3b\u89c2\u4e0b\u7ebf\uff08SDOWN\uff09"})," - \u5355\u4e2a\u54e8\u5175\u8ba4\u4e3a\u4e3b\u8282\u70b9\u4e0b\u7ebf"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5ba2\u89c2\u4e0b\u7ebf\uff08ODOWN\uff09"})," - \u8fbe\u5230 quorum \u6570\u91cf\u7684\u54e8\u5175\u8ba4\u4e3a\u4e3b\u8282\u70b9\u4e0b\u7ebf"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u9009\u4e3e-leader",children:"\u9009\u4e3e Leader"}),"\n",(0,l.jsx)(e.p,{children:"\u591a\u4e2a\u54e8\u5175\u901a\u8fc7 Raft \u7b97\u6cd5\u9009\u4e3e\u51fa\u4e00\u4e2a Leader \u54e8\u5175\u8d1f\u8d23\u6545\u969c\u8f6c\u79fb\u3002"}),"\n",(0,l.jsx)(e.h3,{id:"\u9009\u62e9\u65b0\u4e3b\u8282\u70b9",children:"\u9009\u62e9\u65b0\u4e3b\u8282\u70b9"}),"\n",(0,l.jsx)(e.p,{children:"Leader \u54e8\u5175\u6309\u4ee5\u4e0b\u89c4\u5219\u9009\u62e9\u65b0\u4e3b\u8282\u70b9\uff1a"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u8fc7\u6ee4\u6389\u4e0b\u7ebf\u7684\u4ece\u8282\u70b9"}),"\n",(0,l.jsx)(e.li,{children:"\u8fc7\u6ee4\u6389 5 \u79d2\u5185\u6ca1\u6709\u56de\u590d\u54e8\u5175 INFO \u547d\u4ee4\u7684\u4ece\u8282\u70b9"}),"\n",(0,l.jsx)(e.li,{children:"\u8fc7\u6ee4\u6389\u4e0e\u4e3b\u8282\u70b9\u65ad\u5f00\u8fde\u63a5\u65f6\u95f4\u8fc7\u957f\u7684\u4ece\u8282\u70b9"}),"\n",(0,l.jsxs)(e.li,{children:["\u9009\u62e9\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u4ece\u8282\u70b9\uff08",(0,l.jsx)(e.code,{children:"replica-priority"}),"\uff09"]}),"\n",(0,l.jsx)(e.li,{children:"\u5982\u679c\u4f18\u5148\u7ea7\u76f8\u540c\uff0c\u9009\u62e9\u590d\u5236\u504f\u79fb\u91cf\u6700\u5927\u7684\uff08\u6570\u636e\u6700\u65b0\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u5982\u679c\u504f\u79fb\u91cf\u76f8\u540c\uff0c\u9009\u62e9 runid \u6700\u5c0f\u7684"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u6545\u969c\u8f6c\u79fb\u6b65\u9aa4",children:"\u6545\u969c\u8f6c\u79fb\u6b65\u9aa4"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5728\u9009\u4e2d\u7684\u4ece\u8282\u70b9\u4e0a\u6267\u884c ",(0,l.jsx)(e.code,{children:"REPLICAOF NO ONE"})]}),"\n",(0,l.jsxs)(e.li,{children:["\u5411\u5176\u4ed6\u4ece\u8282\u70b9\u53d1\u9001 ",(0,l.jsx)(e.code,{children:"REPLICAOF <new-master-ip> <new-master-port>"})]}),"\n",(0,l.jsx)(e.li,{children:"\u66f4\u65b0\u54e8\u5175\u914d\u7f6e"}),"\n",(0,l.jsx)(e.li,{children:"\u7b49\u5f85\u65e7\u4e3b\u8282\u70b9\u6062\u590d\u540e\uff0c\u5c06\u5176\u8bbe\u7f6e\u4e3a\u4ece\u8282\u70b9"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u5ba2\u6237\u7aef\u8fde\u63a5",children:"\u5ba2\u6237\u7aef\u8fde\u63a5"}),"\n",(0,l.jsx)(e.h3,{id:"javajedis",children:"Java\uff08Jedis\uff09"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'import redis.clients.jedis.Jedis;\nimport redis.clients.jedis.JedisSentinelPool;\n\nimport java.util.HashSet;\nimport java.util.Set;\n\npublic class SentinelExample {\n    public static void main(String[] args) {\n        // \u54e8\u5175\u5730\u5740\n        Set<String> sentinels = new HashSet<>();\n        sentinels.add("192.168.1.201:26379");\n        sentinels.add("192.168.1.202:26379");\n        sentinels.add("192.168.1.203:26379");\n\n        // \u521b\u5efa\u54e8\u5175\u8fde\u63a5\u6c60\n        JedisSentinelPool pool = new JedisSentinelPool(\n            "mymaster",    // master name\n            sentinels,     // sentinel addresses\n            "mypassword"   // password\n        );\n\n        // \u83b7\u53d6\u8fde\u63a5\n        try (Jedis jedis = pool.getResource()) {\n            jedis.set("key", "value");\n            String value = jedis.get("key");\n            System.out.println(value);\n        }\n\n        pool.close();\n    }\n}\n'})}),"\n",(0,l.jsx)(e.h3,{id:"spring-boot",children:"Spring Boot"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-yaml",children:"spring:\n  redis:\n    sentinel:\n      master: mymaster\n      nodes:\n        - 192.168.1.201:26379\n        - 192.168.1.202:26379\n        - 192.168.1.203:26379\n    password: mypassword\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisConnectionFactory redisConnectionFactory() {\n        RedisSentinelConfiguration config = new RedisSentinelConfiguration()\n            .master("mymaster")\n            .sentinel("192.168.1.201", 26379)\n            .sentinel("192.168.1.202", 26379)\n            .sentinel("192.168.1.203", 26379);\n\n        return new LettuceConnectionFactory(config);\n    }\n}\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u54e8\u5175\u547d\u4ee4",children:"\u54e8\u5175\u547d\u4ee4"}),"\n",(0,l.jsx)(e.h3,{id:"\u76d1\u63a7\u547d\u4ee4",children:"\u76d1\u63a7\u547d\u4ee4"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u4e3b\u8282\u70b9\u4fe1\u606f\nSENTINEL master <master-name>\n\n# \u67e5\u770b\u6240\u6709\u4e3b\u8282\u70b9\nSENTINEL masters\n\n# \u67e5\u770b\u4ece\u8282\u70b9\nSENTINEL slaves <master-name>\n\n# \u67e5\u770b\u5176\u4ed6\u54e8\u5175\nSENTINEL sentinels <master-name>\n\n# \u83b7\u53d6\u4e3b\u8282\u70b9\u5730\u5740\nSENTINEL get-master-addr-by-name <master-name>\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u7ba1\u7406\u547d\u4ee4",children:"\u7ba1\u7406\u547d\u4ee4"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u624b\u52a8\u6545\u969c\u8f6c\u79fb\nSENTINEL failover <master-name>\n\n# \u91cd\u7f6e\u4e3b\u8282\u70b9\nSENTINEL reset <pattern>\n\n# \u79fb\u9664\u76d1\u63a7\nSENTINEL remove <master-name>\n\n# \u6dfb\u52a0\u76d1\u63a7\nSENTINEL monitor <master-name> <ip> <port> <quorum>\n\n# \u4fee\u6539\u914d\u7f6e\nSENTINEL set <master-name> <option> <value>\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u914d\u7f6e\u53c2\u6570\u8be6\u89e3",children:"\u914d\u7f6e\u53c2\u6570\u8be6\u89e3"}),"\n",(0,l.jsx)(e.h3,{id:"\u76d1\u63a7\u914d\u7f6e",children:"\u76d1\u63a7\u914d\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-conf",children:"# \u76d1\u63a7\u4e3b\u8282\u70b9\nsentinel monitor mymaster 192.168.1.100 6379 2\n\n# \u53c2\u6570\u8bf4\u660e\uff1a\n# mymaster: \u4e3b\u8282\u70b9\u540d\u79f0\uff08\u53ef\u81ea\u5b9a\u4e49\uff09\n# 192.168.1.100: \u4e3b\u8282\u70b9 IP\n# 6379: \u4e3b\u8282\u70b9\u7aef\u53e3\n# 2: quorum\uff08\u5224\u5b9a\u4e3b\u8282\u70b9\u4e0b\u7ebf\u9700\u8981\u7684\u54e8\u5175\u6570\u91cf\uff09\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u8ba4\u8bc1\u914d\u7f6e",children:"\u8ba4\u8bc1\u914d\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-conf",children:"# \u4e3b\u8282\u70b9\u5bc6\u7801\nsentinel auth-pass mymaster mypassword\n\n# \u5982\u679c\u4ece\u8282\u70b9\u5bc6\u7801\u4e0d\u540c\uff08\u4e00\u822c\u76f8\u540c\uff09\nsentinel auth-user mymaster <username>\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u8d85\u65f6\u914d\u7f6e",children:"\u8d85\u65f6\u914d\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-conf",children:"# \u4e3b\u8282\u70b9\u4e0b\u7ebf\u5224\u5b9a\u65f6\u95f4\uff08\u6beb\u79d2\uff09\n# \u54e8\u5175\u5728\u8fd9\u4e2a\u65f6\u95f4\u5185\u6ca1\u6709\u6536\u5230\u4e3b\u8282\u70b9\u7684\u6709\u6548\u56de\u590d\uff0c\u5219\u5224\u5b9a\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\nsentinel down-after-milliseconds mymaster 30000\n\n# \u6545\u969c\u8f6c\u79fb\u8d85\u65f6\u65f6\u95f4\uff08\u6beb\u79d2\uff09\nsentinel failover-timeout mymaster 180000\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u590d\u5236\u914d\u7f6e",children:"\u590d\u5236\u914d\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-conf",children:"# \u6545\u969c\u8f6c\u79fb\u671f\u95f4\uff0c\u540c\u65f6\u8fdb\u884c\u590d\u5236\u7684\u4ece\u8282\u70b9\u6570\u91cf\n# \u8bbe\u7f6e\u4e3a 1 \u53ef\u4ee5\u964d\u4f4e\u4e3b\u8282\u70b9\u538b\u529b\uff0c\u4f46\u590d\u5236\u65f6\u95f4\u66f4\u957f\nsentinel parallel-syncs mymaster 1\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u901a\u77e5\u914d\u7f6e",children:"\u901a\u77e5\u914d\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-conf",children:"# \u6545\u969c\u8f6c\u79fb\u65f6\u6267\u884c\u7684\u811a\u672c\nsentinel notification-script mymaster /path/to/notify.sh\n\n# \u6545\u969c\u8f6c\u79fb\u5b8c\u6210\u540e\u6267\u884c\u7684\u811a\u672c\nsentinel client-reconfig-script mymaster /path/to/reconfig.sh\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u54e8\u5175\u96c6\u7fa4",children:"\u54e8\u5175\u96c6\u7fa4"}),"\n",(0,l.jsx)(e.h3,{id:"\u90e8\u7f72\u5efa\u8bae",children:"\u90e8\u7f72\u5efa\u8bae"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5947\u6570\u4e2a\u54e8\u5175"})," - 3 \u4e2a\u6216 5 \u4e2a\uff0c\u907f\u514d\u8111\u88c2"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5206\u5e03\u5f0f\u90e8\u7f72"})," - \u90e8\u7f72\u5728\u4e0d\u540c\u7684\u7269\u7406\u673a\u6216\u53ef\u7528\u533a"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"quorum \u8bbe\u7f6e"})," - \u901a\u5e38\u8bbe\u7f6e\u4e3a ",(0,l.jsx)(e.code,{children:"n/2 + 1"})]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u793a\u4f8b3-\u54e8\u5175\u96c6\u7fa4",children:"\u793a\u4f8b\uff1a3 \u54e8\u5175\u96c6\u7fa4"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"Sentinel 1"}),"\uff08192.168.1.201\uff09\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-conf",children:"port 26379\nsentinel monitor mymaster 192.168.1.100 6379 2\nsentinel down-after-milliseconds mymaster 30000\nsentinel parallel-syncs mymaster 1\nsentinel failover-timeout mymaster 180000\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"Sentinel 2"}),"\uff08192.168.1.202\uff09\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-conf",children:"port 26379\nsentinel monitor mymaster 192.168.1.100 6379 2\nsentinel down-after-milliseconds mymaster 30000\nsentinel parallel-syncs mymaster 1\nsentinel failover-timeout mymaster 180000\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"Sentinel 3"}),"\uff08192.168.1.203\uff09\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-conf",children:"port 26379\nsentinel monitor mymaster 192.168.1.100 6379 2\nsentinel down-after-milliseconds mymaster 30000\nsentinel parallel-syncs mymaster 1\nsentinel failover-timeout mymaster 180000\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,l.jsx)(e.h3,{id:"1-\u8111\u88c2\u95ee\u9898",children:"1. \u8111\u88c2\u95ee\u9898"}),"\n",(0,l.jsx)(e.p,{children:"\u7f51\u7edc\u5206\u533a\u5bfc\u81f4\u51fa\u73b0\u591a\u4e2a\u4e3b\u8282\u70b9\u3002"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-conf",children:"# \u8981\u6c42\u81f3\u5c11 1 \u4e2a\u4ece\u8282\u70b9\u5728\u7ebf\nmin-replicas-to-write 1\n\n# \u8981\u6c42\u4ece\u8282\u70b9\u5ef6\u8fdf\u4e0d\u8d85\u8fc7 10 \u79d2\nmin-replicas-max-lag 10\n"})}),"\n",(0,l.jsx)(e.h3,{id:"2-\u54e8\u5175\u65e0\u6cd5\u8fde\u63a5\u4e3b\u8282\u70b9",children:"2. \u54e8\u5175\u65e0\u6cd5\u8fde\u63a5\u4e3b\u8282\u70b9"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u539f\u56e0"}),"\uff1a"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9632\u706b\u5899\u963b\u6b62"}),"\n",(0,l.jsx)(e.li,{children:"\u4e3b\u8282\u70b9\u5b95\u673a"}),"\n",(0,l.jsx)(e.li,{children:"\u7f51\u7edc\u95ee\u9898"}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u68c0\u67e5\u7f51\u7edc\u8fde\u901a\u6027\ntelnet 192.168.1.100 6379\n\n# \u68c0\u67e5\u9632\u706b\u5899\nsudo firewall-cmd --list-all\n"})}),"\n",(0,l.jsx)(e.h3,{id:"3-\u9891\u7e41\u6545\u969c\u8f6c\u79fb",children:"3. \u9891\u7e41\u6545\u969c\u8f6c\u79fb"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u539f\u56e0"}),"\uff1a"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"down-after-milliseconds"})," \u8bbe\u7f6e\u8fc7\u5c0f"]}),"\n",(0,l.jsx)(e.li,{children:"\u7f51\u7edc\u4e0d\u7a33\u5b9a"}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-conf",children:"# \u589e\u52a0\u5224\u5b9a\u65f6\u95f4\nsentinel down-after-milliseconds mymaster 60000\n"})}),"\n",(0,l.jsx)(e.h3,{id:"4-\u6545\u969c\u8f6c\u79fb\u5931\u8d25",children:"4. \u6545\u969c\u8f6c\u79fb\u5931\u8d25"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u539f\u56e0"}),"\uff1a"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6ca1\u6709\u53ef\u7528\u7684\u4ece\u8282\u70b9"}),"\n",(0,l.jsx)(e.li,{children:"\u4ece\u8282\u70b9\u6570\u636e\u592a\u65e7"}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u786e\u4fdd\u81f3\u5c11\u6709\u4e00\u4e2a\u5065\u5eb7\u7684\u4ece\u8282\u70b9"}),"\n",(0,l.jsx)(e.li,{children:"\u68c0\u67e5\u4ece\u8282\u70b9\u7684\u590d\u5236\u72b6\u6001"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,l.jsx)(e.h3,{id:"1-\u54e8\u5175\u6570\u91cf",children:"1. \u54e8\u5175\u6570\u91cf"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5c0f\u578b\u96c6\u7fa4"})," - 3 \u4e2a\u54e8\u5175"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u4e2d\u578b\u96c6\u7fa4"})," - 5 \u4e2a\u54e8\u5175"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5927\u578b\u96c6\u7fa4"})," - 7 \u4e2a\u54e8\u5175"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"2-quorum-\u8bbe\u7f6e",children:"2. quorum \u8bbe\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"quorum = \u54e8\u5175\u6570\u91cf / 2 + 1\n"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"3 \u4e2a\u54e8\u5175 - quorum = 2"}),"\n",(0,l.jsx)(e.li,{children:"5 \u4e2a\u54e8\u5175 - quorum = 3"}),"\n",(0,l.jsx)(e.li,{children:"7 \u4e2a\u54e8\u5175 - quorum = 4"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"3-\u8d85\u65f6\u914d\u7f6e",children:"3. \u8d85\u65f6\u914d\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-conf",children:"# \u4e3b\u8282\u70b9\u4e0b\u7ebf\u5224\u5b9a\u65f6\u95f4\uff1a30-60 \u79d2\nsentinel down-after-milliseconds mymaster 30000\n\n# \u6545\u969c\u8f6c\u79fb\u8d85\u65f6\uff1a3 \u5206\u949f\nsentinel failover-timeout mymaster 180000\n"})}),"\n",(0,l.jsx)(e.h3,{id:"4-\u76d1\u63a7\u54e8\u5175",children:"4. \u76d1\u63a7\u54e8\u5175"}),"\n",(0,l.jsx)(e.p,{children:"\u5b9a\u671f\u68c0\u67e5\u54e8\u5175\u72b6\u6001\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u54e8\u5175\u65e5\u5fd7\ntail -f /var/log/redis/sentinel.log\n\n# \u67e5\u770b\u4e3b\u8282\u70b9\u72b6\u6001\nredis-cli -p 26379 SENTINEL master mymaster\n"})}),"\n",(0,l.jsx)(e.h3,{id:"5-\u6d4b\u8bd5\u6545\u969c\u8f6c\u79fb",children:"5. \u6d4b\u8bd5\u6545\u969c\u8f6c\u79fb"}),"\n",(0,l.jsx)(e.p,{children:"\u5b9a\u671f\u8fdb\u884c\u6545\u969c\u8f6c\u79fb\u6f14\u7ec3\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u624b\u52a8\u89e6\u53d1\u6545\u969c\u8f6c\u79fb\nredis-cli -p 26379 SENTINEL failover mymaster\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u5c0f\u7ed3",children:"\u5c0f\u7ed3"}),"\n",(0,l.jsx)(e.p,{children:"Redis Sentinel \u63d0\u4f9b\u4e86\u81ea\u52a8\u5316\u7684\u9ad8\u53ef\u7528\u89e3\u51b3\u65b9\u6848\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u81ea\u52a8\u6545\u969c\u8f6c\u79fb"})," - \u4e3b\u8282\u70b9\u6545\u969c\u65f6\u81ea\u52a8\u5207\u6362"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u76d1\u63a7"})," - \u6301\u7eed\u76d1\u63a7\u4e3b\u4ece\u8282\u70b9\u72b6\u6001"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u914d\u7f6e\u4e2d\u5fc3"})," - \u5ba2\u6237\u7aef\u81ea\u52a8\u53d1\u73b0\u4e3b\u8282\u70b9"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u90e8\u7f72\u8981\u70b9\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5947\u6570\u4e2a\u54e8\u5175\uff083 \u4e2a\u6216 5 \u4e2a\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u5408\u7406\u8bbe\u7f6e quorum \u548c\u8d85\u65f6\u53c2\u6570"}),"\n",(0,l.jsx)(e.li,{children:"\u5206\u5e03\u5f0f\u90e8\u7f72\uff0c\u907f\u514d\u5355\u70b9\u6545\u969c"}),"\n",(0,l.jsx)(e.li,{children:"\u5b9a\u671f\u76d1\u63a7\u548c\u6f14\u7ec3\u6545\u969c\u8f6c\u79fb"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(o,{...n})}):o(n)}}}]);
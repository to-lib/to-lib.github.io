"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[8986],{48885:(n,e,i)=>{i.d(e,{R:()=>l,x:()=>t});var r=i(99378);const s={},a=r.createContext(s);function l(n){const e=r.useContext(a);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:l(n.components),r.createElement(a.Provider,{value:e},n.children)}},78217:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>t,default:()=>g,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"springcloud-alibaba/config-advanced","title":"Nacos \u914d\u7f6e\u4e2d\u5fc3\u9ad8\u7ea7\u7279\u6027","description":"[!TIP]","source":"@site/docs/springcloud-alibaba/config-advanced.md","sourceDirName":"springcloud-alibaba","slug":"/springcloud-alibaba/config-advanced","permalink":"/docs/springcloud-alibaba/config-advanced","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/springcloud-alibaba/config-advanced.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"id":"config-advanced","title":"Nacos \u914d\u7f6e\u4e2d\u5fc3\u9ad8\u7ea7\u7279\u6027","sidebar_label":"\u914d\u7f6e\u9ad8\u7ea7\u7279\u6027","sidebar_position":10},"sidebar":"springcloudAlibaba","previous":{"title":"Gateway \u7f51\u5173","permalink":"/docs/springcloud-alibaba/gateway"},"next":{"title":"\u670d\u52a1\u6cbb\u7406","permalink":"/docs/springcloud-alibaba/service-governance"}}');var s=i(22714),a=i(48885);const l={id:"config-advanced",title:"Nacos \u914d\u7f6e\u4e2d\u5fc3\u9ad8\u7ea7\u7279\u6027",sidebar_label:"\u914d\u7f6e\u9ad8\u7ea7\u7279\u6027",sidebar_position:10},t="Nacos \u914d\u7f6e\u4e2d\u5fc3\u9ad8\u7ea7\u7279\u6027",c={},d=[{value:"1. \u914d\u7f6e\u52a0\u5bc6",id:"1-\u914d\u7f6e\u52a0\u5bc6",level:2},{value:"\u4f7f\u7528 Jasypt \u52a0\u5bc6",id:"\u4f7f\u7528-jasypt-\u52a0\u5bc6",level:3},{value:"\u81ea\u5b9a\u4e49\u52a0\u5bc6\u89e3\u5bc6",id:"\u81ea\u5b9a\u4e49\u52a0\u5bc6\u89e3\u5bc6",level:3},{value:"2. \u914d\u7f6e\u7070\u5ea6\u53d1\u5e03",id:"2-\u914d\u7f6e\u7070\u5ea6\u53d1\u5e03",level:2},{value:"Beta \u53d1\u5e03",id:"beta-\u53d1\u5e03",level:3},{value:"\u91d1\u4e1d\u96c0\u53d1\u5e03",id:"\u91d1\u4e1d\u96c0\u53d1\u5e03",level:3},{value:"3. \u914d\u7f6e\u7248\u672c\u7ba1\u7406",id:"3-\u914d\u7f6e\u7248\u672c\u7ba1\u7406",level:2},{value:"\u67e5\u770b\u5386\u53f2\u7248\u672c",id:"\u67e5\u770b\u5386\u53f2\u7248\u672c",level:3},{value:"\u914d\u7f6e\u56de\u6eda",id:"\u914d\u7f6e\u56de\u6eda",level:3},{value:"4. \u914d\u7f6e\u76d1\u542c\u4e0e\u56de\u8c03",id:"4-\u914d\u7f6e\u76d1\u542c\u4e0e\u56de\u8c03",level:2},{value:"\u5b9e\u65f6\u76d1\u542c\u914d\u7f6e\u53d8\u66f4",id:"\u5b9e\u65f6\u76d1\u542c\u914d\u7f6e\u53d8\u66f4",level:3},{value:"\u914d\u7f6e\u53d8\u66f4\u901a\u77e5",id:"\u914d\u7f6e\u53d8\u66f4\u901a\u77e5",level:3},{value:"5. \u591a\u73af\u5883\u914d\u7f6e\u7ba1\u7406",id:"5-\u591a\u73af\u5883\u914d\u7f6e\u7ba1\u7406",level:2},{value:"\u914d\u7f6e\u5c42\u7ea7\u7ed3\u6784",id:"\u914d\u7f6e\u5c42\u7ea7\u7ed3\u6784",level:3},{value:"\u914d\u7f6e\u7ee7\u627f",id:"\u914d\u7f6e\u7ee7\u627f",level:3},{value:"\u914d\u7f6e\u4f18\u5148\u7ea7",id:"\u914d\u7f6e\u4f18\u5148\u7ea7",level:3},{value:"6. \u914d\u7f6e\u63a8\u9001",id:"6-\u914d\u7f6e\u63a8\u9001",level:2},{value:"\u670d\u52a1\u7aef\u63a8\u9001",id:"\u670d\u52a1\u7aef\u63a8\u9001",level:3},{value:"\u5ba2\u6237\u7aef\u62c9\u53d6",id:"\u5ba2\u6237\u7aef\u62c9\u53d6",level:3},{value:"7. \u914d\u7f6e\u5bfc\u5165\u5bfc\u51fa",id:"7-\u914d\u7f6e\u5bfc\u5165\u5bfc\u51fa",level:2},{value:"\u5bfc\u51fa\u914d\u7f6e",id:"\u5bfc\u51fa\u914d\u7f6e",level:3},{value:"\u5bfc\u5165\u914d\u7f6e",id:"\u5bfc\u5165\u914d\u7f6e",level:3},{value:"8. \u914d\u7f6e\u4e2d\u5fc3\u9ad8\u53ef\u7528",id:"8-\u914d\u7f6e\u4e2d\u5fc3\u9ad8\u53ef\u7528",level:2},{value:"\u96c6\u7fa4\u90e8\u7f72",id:"\u96c6\u7fa4\u90e8\u7f72",level:3},{value:"\u6570\u636e\u6301\u4e45\u5316",id:"\u6570\u636e\u6301\u4e45\u5316",level:3},{value:"\u6545\u969c\u8f6c\u79fb",id:"\u6545\u969c\u8f6c\u79fb",level:3},{value:"9. \u914d\u7f6e\u5ba1\u8ba1",id:"9-\u914d\u7f6e\u5ba1\u8ba1",level:2},{value:"\u64cd\u4f5c\u8bb0\u5f55",id:"\u64cd\u4f5c\u8bb0\u5f55",level:3},{value:"\u81ea\u5b9a\u4e49\u5ba1\u8ba1",id:"\u81ea\u5b9a\u4e49\u5ba1\u8ba1",level:3},{value:"10. \u6700\u4f73\u5b9e\u8df5",id:"10-\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u914d\u7f6e\u547d\u540d\u89c4\u8303",id:"\u914d\u7f6e\u547d\u540d\u89c4\u8303",level:3},{value:"\u914d\u7f6e\u5206\u7c7b",id:"\u914d\u7f6e\u5206\u7c7b",level:3},{value:"\u914d\u7f6e\u53d8\u66f4\u6d41\u7a0b",id:"\u914d\u7f6e\u53d8\u66f4\u6d41\u7a0b",level:3},{value:"\u5b89\u5168\u5efa\u8bae",id:"\u5b89\u5168\u5efa\u8bae",level:3}];function o(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"nacos-\u914d\u7f6e\u4e2d\u5fc3\u9ad8\u7ea7\u7279\u6027",children:"Nacos \u914d\u7f6e\u4e2d\u5fc3\u9ad8\u7ea7\u7279\u6027"})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:["[!TIP]\n",(0,s.jsx)(e.strong,{children:"\u6df1\u5165\u914d\u7f6e\u7ba1\u7406"}),": \u63a2\u7d22 Nacos \u914d\u7f6e\u4e2d\u5fc3\u7684\u9ad8\u7ea7\u529f\u80fd,\u5305\u62ec\u914d\u7f6e\u52a0\u5bc6\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u7248\u672c\u7ba1\u7406\u7b49\u4f01\u4e1a\u7ea7\u7279\u6027\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"1-\u914d\u7f6e\u52a0\u5bc6",children:"1. \u914d\u7f6e\u52a0\u5bc6"}),"\n",(0,s.jsx)(e.h3,{id:"\u4f7f\u7528-jasypt-\u52a0\u5bc6",children:"\u4f7f\u7528 Jasypt \u52a0\u5bc6"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6dfb\u52a0\u4f9d\u8d56"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-xml",children:"<dependency>\n    <groupId>com.github.ulisesbocchio</groupId>\n    <artifactId>jasypt-spring-boot-starter</artifactId>\n    <version>3.0.5</version>\n</dependency>\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u914d\u7f6e\u5bc6\u94a5"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"jasypt:\n  encryptor:\n    password: ${JASYPT_ENCRYPTOR_PASSWORD}  # \u4ece\u73af\u5883\u53d8\u91cf\u83b7\u53d6\n    algorithm: PBEWithMD5AndDES\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u52a0\u5bc6\u654f\u611f\u4fe1\u606f"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'import org.jasypt.encryption.StringEncryptor;\n\n@SpringBootTest\npublic class EncryptTest {\n\n    @Autowired\n    private StringEncryptor stringEncryptor;\n\n    @Test\n    public void testEncrypt() {\n        String password = "myPassword123";\n        String encrypted = stringEncryptor.encrypt(password);\n        System.out.println("\u52a0\u5bc6\u540e: " + encrypted);\n    }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5728 Nacos \u4e2d\u4f7f\u7528\u52a0\u5bc6\u914d\u7f6e"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"spring:\n  datasource:\n    password: ENC(G9FDaZ/oiJKdT7TqZvGmKg==)  # \u52a0\u5bc6\u540e\u7684\u5bc6\u7801\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u81ea\u5b9a\u4e49\u52a0\u5bc6\u89e3\u5bc6",children:"\u81ea\u5b9a\u4e49\u52a0\u5bc6\u89e3\u5bc6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"@Component\npublic class CustomEncryptor {\n\n    public String encrypt(String plainText) {\n        // \u81ea\u5b9a\u4e49\u52a0\u5bc6\u903b\u8f91\n        return Base64.getEncoder().encodeToString(plainText.getBytes());\n    }\n\n    public String decrypt(String encryptedText) {\n        // \u81ea\u5b9a\u4e49\u89e3\u5bc6\u903b\u8f91\n        return new String(Base64.getDecoder().decode(encryptedText));\n    }\n}\n\n@Component\npublic class EncryptedConfigProcessor implements EnvironmentPostProcessor {\n\n    @Override\n    public void postProcessEnvironment(ConfigurableEnvironment environment, \n                                       SpringApplication application) {\n        // \u5904\u7406\u52a0\u5bc6\u914d\u7f6e\n        for (PropertySource<?> propertySource : environment.getPropertySources()) {\n            if (propertySource instanceof MapPropertySource) {\n                processPropertySource((MapPropertySource) propertySource);\n            }\n        }\n    }\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"2-\u914d\u7f6e\u7070\u5ea6\u53d1\u5e03",children:"2. \u914d\u7f6e\u7070\u5ea6\u53d1\u5e03"}),"\n",(0,s.jsx)(e.h3,{id:"beta-\u53d1\u5e03",children:"Beta \u53d1\u5e03"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5728 Nacos \u63a7\u5236\u53f0\u64cd\u4f5c"}),":"]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u7f16\u8f91\u914d\u7f6e"}),"\n",(0,s.jsx)(e.li,{children:'\u70b9\u51fb"Beta\u53d1\u5e03"'}),"\n",(0,s.jsxs)(e.li,{children:["\u8f93\u5165 Beta IP \u5217\u8868 (\u5982: ",(0,s.jsx)(e.code,{children:"192.168.1.100,192.168.1.101"}),")"]}),"\n",(0,s.jsx)(e.li,{children:"\u53d1\u5e03 Beta \u914d\u7f6e"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u9a8c\u8bc1 Beta \u914d\u7f6e"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'@RestController\n@RefreshScope\npublic class ConfigController {\n\n    @Value("${app.version:\u9ed8\u8ba4\u7248\u672c}")\n    private String version;\n\n    @GetMapping("/config/version")\n    public String getVersion() {\n        return "\u5f53\u524d\u7248\u672c: " + version;\n    }\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u53d1\u5e03\u6d41\u7a0b"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"1. Beta\u53d1\u5e03 \u2192 \u9a8c\u8bc1 Beta \u73af\u5883\n2. \u6b63\u5f0f\u53d1\u5e03 \u2192 \u6240\u6709\u5b9e\u4f8b\u751f\u6548\n3. \u56de\u6eda \u2192 \u6062\u590d\u4e0a\u4e00\u7248\u672c\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u91d1\u4e1d\u96c0\u53d1\u5e03",children:"\u91d1\u4e1d\u96c0\u53d1\u5e03"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u81ea\u5b9a\u4e49\u91d1\u4e1d\u96c0\u7b56\u7565"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'@Component\npublic class CanaryConfigListener {\n\n    @Autowired\n    private NacosConfigManager nacosConfigManager;\n\n    @PostConstruct\n    public void init() throws NacosException {\n        String dataId = "app-config.yaml";\n        String group = "DEFAULT_GROUP";\n\n        // \u76d1\u542c\u914d\u7f6e\u53d8\u66f4\n        nacosConfigManager.getConfigService().addListener(\n            dataId,\n            group,\n            new Listener() {\n                @Override\n                public void receiveConfigInfo(String configInfo) {\n                    // \u91d1\u4e1d\u96c0\u7b56\u7565: \u968f\u673a 10% \u6d41\u91cf\u4f7f\u7528\u65b0\u914d\u7f6e\n                    if (Math.random() < 0.1) {\n                        applyNewConfig(configInfo);\n                    } else {\n                        applyOldConfig();\n                    }\n                }\n\n                @Override\n                public Executor getExecutor() {\n                    return null;\n                }\n            }\n        );\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"3-\u914d\u7f6e\u7248\u672c\u7ba1\u7406",children:"3. \u914d\u7f6e\u7248\u672c\u7ba1\u7406"}),"\n",(0,s.jsx)(e.h3,{id:"\u67e5\u770b\u5386\u53f2\u7248\u672c",children:"\u67e5\u770b\u5386\u53f2\u7248\u672c"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Nacos \u63a7\u5236\u53f0"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u914d\u7f6e\u7ba1\u7406 \u2192 \u914d\u7f6e\u5217\u8868 \u2192 \u70b9\u51fb\u914d\u7f6e \u2192 \u5386\u53f2\u7248\u672c"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"API \u65b9\u5f0f"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'@Service\npublic class ConfigHistoryService {\n\n    @Autowired\n    private NacosConfigProperties nacosConfigProperties;\n\n    public List<ConfigHistory> getConfigHistory(String dataId, String group) {\n        String serverAddr = nacosConfigProperties.getServerAddr();\n        String url = String.format(\n            "http://%s/nacos/v1/cs/history?dataId=%s&group=%s&search=accurate",\n            serverAddr, dataId, group\n        );\n\n        // \u8c03\u7528 API \u83b7\u53d6\u5386\u53f2\u7248\u672c\n        RestTemplate restTemplate = new RestTemplate();\n        return restTemplate.getForObject(url, List.class);\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u914d\u7f6e\u56de\u6eda",children:"\u914d\u7f6e\u56de\u6eda"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'public void rollbackConfig(String dataId, String group, String nid) {\n    String serverAddr = nacosConfigProperties.getServerAddr();\n    String url = String.format(\n        "http://%s/nacos/v1/cs/history?dataId=%s&group=%s&nid=%s&rollback=true",\n        serverAddr, dataId, group, nid\n    );\n\n    RestTemplate restTemplate = new RestTemplate();\n    restTemplate.postForObject(url, null, String.class);\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"4-\u914d\u7f6e\u76d1\u542c\u4e0e\u56de\u8c03",children:"4. \u914d\u7f6e\u76d1\u542c\u4e0e\u56de\u8c03"}),"\n",(0,s.jsx)(e.h3,{id:"\u5b9e\u65f6\u76d1\u542c\u914d\u7f6e\u53d8\u66f4",children:"\u5b9e\u65f6\u76d1\u542c\u914d\u7f6e\u53d8\u66f4"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'@Component\npublic class ConfigChangeListener {\n\n    @Autowired\n    private NacosConfigManager nacosConfigManager;\n\n    @PostConstruct\n    public void registerListener() throws NacosException {\n        String dataId = "user-service.yaml";\n        String group = "DEFAULT_GROUP";\n\n        nacosConfigManager.getConfigService().addListener(\n            dataId,\n            group,\n            new AbstractConfigChangeListener() {\n                @Override\n                public void receiveConfigChange(ConfigChangeEvent event) {\n                    for (ConfigChangeItem item : event.getChangeItems()) {\n                        log.info("\u914d\u7f6e\u53d8\u66f4: key={}, oldValue={}, newValue={}, type={}",\n                            item.getKey(),\n                            item.getOldValue(),\n                            item.getNewValue(),\n                            item.getType()\n                        );\n                        \n                        // \u6839\u636e\u53d8\u66f4\u7c7b\u578b\u5904\u7406\n                        switch (item.getType()) {\n                            case ADDED:\n                                handleAdded(item);\n                                break;\n                            case MODIFIED:\n                                handleModified(item);\n                                break;\n                            case DELETED:\n                                handleDeleted(item);\n                                break;\n                        }\n                    }\n                }\n            }\n        );\n    }\n\n    private void handleAdded(ConfigChangeItem item) {\n        log.info("\u65b0\u589e\u914d\u7f6e: {}", item.getKey());\n    }\n\n    private void handleModified(ConfigChangeItem item) {\n        log.info("\u4fee\u6539\u914d\u7f6e: {}", item.getKey());\n        // \u53ef\u4ee5\u89e6\u53d1\u7279\u5b9a\u903b\u8f91,\u5982\u6e05\u9664\u7f13\u5b58\n        if ("cache.enabled".equals(item.getKey())) {\n            clearCache();\n        }\n    }\n\n    private void handleDeleted(ConfigChangeItem item) {\n        log.info("\u5220\u9664\u914d\u7f6e: {}", item.getKey());\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u914d\u7f6e\u53d8\u66f4\u901a\u77e5",children:"\u914d\u7f6e\u53d8\u66f4\u901a\u77e5"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'@Component\npublic class ConfigChangeNotifier {\n\n    @Autowired\n    private JavaMailSender mailSender;\n\n    @EventListener\n    public void onConfigChange(ConfigChangeEvent event) {\n        // \u53d1\u9001\u90ae\u4ef6\u901a\u77e5\n        sendEmail("\u914d\u7f6e\u53d8\u66f4\u901a\u77e5", event.toString());\n\n        // \u53d1\u9001\u9489\u9489\u901a\u77e5\n        sendDingTalk("\u914d\u7f6e\u53d8\u66f4", event.toString());\n    }\n\n    private void sendEmail(String subject, String content) {\n        SimpleMailMessage message = new SimpleMailMessage();\n        message.setTo("ops@example.com");\n        message.setSubject(subject);\n        message.setText(content);\n        mailSender.send(message);\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"5-\u591a\u73af\u5883\u914d\u7f6e\u7ba1\u7406",children:"5. \u591a\u73af\u5883\u914d\u7f6e\u7ba1\u7406"}),"\n",(0,s.jsx)(e.h3,{id:"\u914d\u7f6e\u5c42\u7ea7\u7ed3\u6784",children:"\u914d\u7f6e\u5c42\u7ea7\u7ed3\u6784"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"Namespace (\u73af\u5883)\n\u251c\u2500\u2500 dev (\u5f00\u53d1)\n\u2502   \u251c\u2500\u2500 DEFAULT_GROUP\n\u2502   \u2502   \u251c\u2500\u2500 application.yaml (\u516c\u5171\u914d\u7f6e)\n\u2502   \u2502   \u251c\u2500\u2500 user-service.yaml\n\u2502   \u2502   \u2514\u2500\u2500 order-service.yaml\n\u2502   \u2514\u2500\u2500 DATABASE_GROUP\n\u2502       \u251c\u2500\u2500 mysql.yaml\n\u2502       \u2514\u2500\u2500 redis.yaml\n\u251c\u2500\u2500 test (\u6d4b\u8bd5)\n\u2514\u2500\u2500 prod (\u751f\u4ea7)\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u914d\u7f6e\u7ee7\u627f",children:"\u914d\u7f6e\u7ee7\u627f"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u516c\u5171\u914d\u7f6e (shared-config)"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'# common.yaml\nlogging:\n  level:\n    root: INFO\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: "*"\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5e94\u7528\u914d\u7f6e"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"spring:\n  cloud:\n    nacos:\n      config:\n        # \u5171\u4eab\u914d\u7f6e\n        shared-configs:\n          - data-id: common.yaml\n            group: COMMON_GROUP\n            refresh: true\n\n        # \u6269\u5c55\u914d\u7f6e\n        extension-configs:\n          - data-id: redis.yaml\n            group: MIDDLEWARE_GROUP\n            refresh: true\n          - data-id: mysql.yaml\n            group: DATABASE_GROUP\n            refresh: true\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u914d\u7f6e\u4f18\u5148\u7ea7",children:"\u914d\u7f6e\u4f18\u5148\u7ea7"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u52a0\u8f7d\u987a\u5e8f(\u4ece\u9ad8\u5230\u4f4e)"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"1. application-${profile}.${file-extension}\n2. application.${file-extension}\n3. extension-configs (\u4ece\u4e0b\u5230\u4e0a)\n4. shared-configs (\u4ece\u4e0b\u5230\u4e0a)\n5. bootstrap.yml\n"})}),"\n",(0,s.jsx)(e.h2,{id:"6-\u914d\u7f6e\u63a8\u9001",children:"6. \u914d\u7f6e\u63a8\u9001"}),"\n",(0,s.jsx)(e.h3,{id:"\u670d\u52a1\u7aef\u63a8\u9001",children:"\u670d\u52a1\u7aef\u63a8\u9001"}),"\n",(0,s.jsx)(e.p,{children:"Nacos \u4f7f\u7528\u957f\u8f6e\u8be2\u673a\u5236\u5b9e\u73b0\u914d\u7f6e\u5b9e\u65f6\u63a8\u9001:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// Nacos Client \u5185\u90e8\u5b9e\u73b0\npublic class ClientWorker {\n    \n    // \u957f\u8f6e\u8be2\n    private void checkUpdateDataIds(List<CacheData> cacheDatas, long timeout) {\n        // 1. \u6784\u5efa\u8bf7\u6c42\u53c2\u6570\n        StringBuilder sb = new StringBuilder();\n        for (CacheData cacheData : cacheDatas) {\n            sb.append(cacheData.dataId).append(WORD_SEPARATOR);\n            sb.append(cacheData.group).append(WORD_SEPARATOR);\n            sb.append(cacheData.getMd5()).append(LINE_SEPARATOR);\n        }\n\n        // 2. \u53d1\u9001\u957f\u8f6e\u8be2\u8bf7\u6c42(\u9ed8\u8ba430\u79d2)\n        String result = agent.httpPost(\n            Constants.CONFIG_CONTROLLER_PATH + "/listener",\n            headers,\n            params,\n            timeout\n        );\n\n        // 3. \u89e3\u6790\u53d8\u66f4\u7684\u914d\u7f6e\n        parseUpdateDataIdResponse(result);\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u5ba2\u6237\u7aef\u62c9\u53d6",children:"\u5ba2\u6237\u7aef\u62c9\u53d6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'@Service\npublic class ConfigPullService {\n\n    @Autowired\n    private ConfigService configService;\n\n    public String getConfig(String dataId, String group, long timeout) \n        throws NacosException {\n        return configService.getConfig(dataId, group, timeout);\n    }\n\n    @Scheduled(fixedRate = 60000)  // \u6bcf\u5206\u949f\u62c9\u53d6\u4e00\u6b21\n    public void pullConfig() {\n        try {\n            String config = getConfig("app-config.yaml", "DEFAULT_GROUP", 3000);\n            processConfig(config);\n        } catch (NacosException e) {\n            log.error("\u62c9\u53d6\u914d\u7f6e\u5931\u8d25", e);\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"7-\u914d\u7f6e\u5bfc\u5165\u5bfc\u51fa",children:"7. \u914d\u7f6e\u5bfc\u5165\u5bfc\u51fa"}),"\n",(0,s.jsx)(e.h3,{id:"\u5bfc\u51fa\u914d\u7f6e",children:"\u5bfc\u51fa\u914d\u7f6e"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'# \u5bfc\u51fa\u5355\u4e2a\u914d\u7f6e\ncurl -X GET "http://localhost:8848/nacos/v1/cs/configs?dataId=user-service.yaml&group=DEFAULT_GROUP" \\\n  > user-service.yaml\n\n# \u5bfc\u51fa\u6240\u6709\u914d\u7f6e (\u9700\u8981\u767b\u5f55)\n# \u5728 Nacos \u63a7\u5236\u53f0: \u914d\u7f6e\u7ba1\u7406 \u2192 \u5bfc\u51fa\u914d\u7f6e\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u5bfc\u5165\u914d\u7f6e",children:"\u5bfc\u5165\u914d\u7f6e"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6279\u91cf\u5bfc\u5165"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'@Service\npublic class ConfigImportService {\n\n    @Autowired\n    private ConfigService configService;\n\n    public void importConfigs(List<ConfigDTO> configs) {\n        for (ConfigDTO config : configs) {\n            try {\n                boolean result = configService.publishConfig(\n                    config.getDataId(),\n                    config.getGroup(),\n                    config.getContent(),\n                    config.getType()\n                );\n                \n                if (result) {\n                    log.info("\u5bfc\u5165\u914d\u7f6e\u6210\u529f: {}", config.getDataId());\n                } else {\n                    log.error("\u5bfc\u5165\u914d\u7f6e\u5931\u8d25: {}", config.getDataId());\n                }\n            } catch (NacosException e) {\n                log.error("\u5bfc\u5165\u914d\u7f6e\u5f02\u5e38: {}", config.getDataId(), e);\n            }\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"8-\u914d\u7f6e\u4e2d\u5fc3\u9ad8\u53ef\u7528",children:"8. \u914d\u7f6e\u4e2d\u5fc3\u9ad8\u53ef\u7528"}),"\n",(0,s.jsx)(e.h3,{id:"\u96c6\u7fa4\u90e8\u7f72",children:"\u96c6\u7fa4\u90e8\u7f72"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u96c6\u7fa4\u67b6\u6784"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"                  Load Balancer\n                       |\n      +----------------+----------------+\n      |                |                |\n   Nacos 1          Nacos 2         Nacos 3\n      |                |                |\n      +----------------+----------------+\n                       |\n                    MySQL (\u4e3b\u4ece)\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5ba2\u6237\u7aef\u914d\u7f6e"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"spring:\n  cloud:\n    nacos:\n      config:\n        server-addr: 192.168.1.101:8848,192.168.1.102:8848,192.168.1.103:8848\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u6570\u636e\u6301\u4e45\u5316",children:"\u6570\u636e\u6301\u4e45\u5316"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"MySQL \u914d\u7f6e"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-properties",children:"# application.properties\nspring.datasource.platform=mysql\n\ndb.num=1\ndb.url.0=jdbc:mysql://localhost:3306/nacos?characterEncoding=utf8\ndb.user.0=nacos\ndb.password.0=nacos\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u6545\u969c\u8f6c\u79fb",children:"\u6545\u969c\u8f6c\u79fb"}),"\n",(0,s.jsx)(e.p,{children:"Nacos Client \u652f\u6301\u81ea\u52a8\u6545\u969c\u8f6c\u79fb:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"// \u5f53\u67d0\u4e2a Nacos \u8282\u70b9\u6545\u969c\u65f6,\u81ea\u52a8\u5207\u6362\u5230\u5176\u4ed6\u8282\u70b9\npublic class ServerListManager {\n    \n    private void refreshServerListIfNeed() {\n        // \u68c0\u6d4b\u670d\u52a1\u5668\u5065\u5eb7\u72b6\u6001\n        for (String server : serverList) {\n            if (!isServerAvailable(server)) {\n                // \u4ece\u5217\u8868\u4e2d\u79fb\u9664\u6545\u969c\u8282\u70b9\n                serverList.remove(server);\n            }\n        }\n        \n        // \u9009\u62e9\u5065\u5eb7\u7684\u670d\u52a1\u5668\n        currentServer = selectHealthyServer();\n    }\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"9-\u914d\u7f6e\u5ba1\u8ba1",children:"9. \u914d\u7f6e\u5ba1\u8ba1"}),"\n",(0,s.jsx)(e.h3,{id:"\u64cd\u4f5c\u8bb0\u5f55",children:"\u64cd\u4f5c\u8bb0\u5f55"}),"\n",(0,s.jsx)(e.p,{children:"Nacos \u81ea\u52a8\u8bb0\u5f55\u6240\u6709\u914d\u7f6e\u64cd\u4f5c:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u67e5\u8be2\u914d\u7f6e\u64cd\u4f5c\u8bb0\u5f55\nSELECT * FROM config_info_aggr \nWHERE data_id = 'user-service.yaml'\nORDER BY gmt_modified DESC;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u81ea\u5b9a\u4e49\u5ba1\u8ba1",children:"\u81ea\u5b9a\u4e49\u5ba1\u8ba1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'@Aspect\n@Component\npublic class ConfigAuditAspect {\n\n    @Around("@annotation(com.example.ConfigOperation)")\n    public Object auditConfigOperation(ProceedingJoinPoint joinPoint) throws Throwable {\n        // \u8bb0\u5f55\u64cd\u4f5c\u524d\u72b6\u6001\n        String before = getCurrentConfig();\n        \n        // \u6267\u884c\u64cd\u4f5c\n        Object result = joinPoint.proceed();\n        \n        // \u8bb0\u5f55\u64cd\u4f5c\u540e\u72b6\u6001\n        String after = getCurrentConfig();\n        \n        // \u4fdd\u5b58\u5ba1\u8ba1\u65e5\u5fd7\n        saveAuditLog(before, after);\n        \n        return result;\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"10-\u6700\u4f73\u5b9e\u8df5",children:"10. \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsx)(e.h3,{id:"\u914d\u7f6e\u547d\u540d\u89c4\u8303",children:"\u914d\u7f6e\u547d\u540d\u89c4\u8303"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u683c\u5f0f: ${\u5e94\u7528\u540d}-${\u73af\u5883}.${\u6587\u4ef6\u6269\u5c55\u540d}\n\n\u793a\u4f8b:\nuser-service-dev.yaml\nuser-service-prod.yaml\norder-service-dev.yaml\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u914d\u7f6e\u5206\u7c7b",children:"\u914d\u7f6e\u5206\u7c7b"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u914d\u7f6e\u7c7b\u578b"}),(0,s.jsx)(e.th,{children:"\u5b58\u653e\u4f4d\u7f6e"}),(0,s.jsx)(e.th,{children:"\u5237\u65b0\u7b56\u7565"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u57fa\u7840\u914d\u7f6e"}),(0,s.jsx)(e.td,{children:"bootstrap.yml"}),(0,s.jsx)(e.td,{children:"\u4e0d\u5237\u65b0"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u4e1a\u52a1\u914d\u7f6e"}),(0,s.jsx)(e.td,{children:"Nacos\u5171\u4eab\u914d\u7f6e"}),(0,s.jsx)(e.td,{children:"\u52a8\u6001\u5237\u65b0"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u73af\u5883\u914d\u7f6e"}),(0,s.jsx)(e.td,{children:"Nacos\u6269\u5c55\u914d\u7f6e"}),(0,s.jsx)(e.td,{children:"\u52a8\u6001\u5237\u65b0"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u654f\u611f\u914d\u7f6e"}),(0,s.jsx)(e.td,{children:"\u73af\u5883\u53d8\u91cf"}),(0,s.jsx)(e.td,{children:"\u4e0d\u5237\u65b0"})]})]})]}),"\n",(0,s.jsx)(e.h3,{id:"\u914d\u7f6e\u53d8\u66f4\u6d41\u7a0b",children:"\u914d\u7f6e\u53d8\u66f4\u6d41\u7a0b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"1. \u5f00\u53d1\u73af\u5883\u6d4b\u8bd5\n2. \u6d4b\u8bd5\u73af\u5883\u9a8c\u8bc1\n3. \u7070\u5ea6\u53d1\u5e03(Beta)\n4. \u5168\u91cf\u53d1\u5e03\n5. \u76d1\u63a7\u89c2\u5bdf\n6. \u51fa\u73b0\u95ee\u9898\u7acb\u5373\u56de\u6eda\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u5b89\u5168\u5efa\u8bae",children:"\u5b89\u5168\u5efa\u8bae"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u2705 \u654f\u611f\u4fe1\u606f\u5fc5\u987b\u52a0\u5bc6"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u751f\u4ea7\u73af\u5883\u914d\u7f6e\u6743\u9650\u63a7\u5236"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u5f00\u542f\u64cd\u4f5c\u5ba1\u8ba1"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u5b9a\u671f\u5907\u4efd\u914d\u7f6e"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u4f7f\u7528 HTTPS"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5173\u952e\u8981\u70b9"}),":"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u914d\u7f6e\u52a0\u5bc6\u4fdd\u62a4\u654f\u611f\u4fe1\u606f"}),"\n",(0,s.jsx)(e.li,{children:"\u7070\u5ea6\u53d1\u5e03\u964d\u4f4e\u53d8\u66f4\u98ce\u9669"}),"\n",(0,s.jsx)(e.li,{children:"\u7248\u672c\u7ba1\u7406\u4fbf\u4e8e\u56de\u6eda"}),"\n",(0,s.jsx)(e.li,{children:"\u76d1\u542c\u673a\u5236\u5b9e\u65f6\u54cd\u5e94\u53d8\u66f4"}),"\n",(0,s.jsx)(e.li,{children:"\u96c6\u7fa4\u90e8\u7f72\u4fdd\u8bc1\u9ad8\u53ef\u7528"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4e0b\u4e00\u6b65"}),": \u5b66\u4e60 ",(0,s.jsx)(e.a,{href:"./service-governance",children:"\u670d\u52a1\u6cbb\u7406\u9ad8\u7ea7"})]})]})}function g(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(o,{...n})}):o(n)}}}]);
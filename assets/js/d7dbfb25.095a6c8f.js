"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[33945],{40526:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>i,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"podman/rootless","title":"Rootless \u6a21\u5f0f","description":"Podman Rootless \u5bb9\u5668\u8fd0\u884c\u8be6\u89e3","source":"@site/docs/podman/rootless.md","sourceDirName":"podman","slug":"/podman/rootless","permalink":"/docs/podman/rootless","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/podman/rootless.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Rootless \u6a21\u5f0f","description":"Podman Rootless \u5bb9\u5668\u8fd0\u884c\u8be6\u89e3"},"sidebar":"podman","previous":{"title":"Systemd \u96c6\u6210","permalink":"/docs/podman/systemd"},"next":{"title":"Docker \u8fc1\u79fb","permalink":"/docs/podman/docker-migration"}}');var t=s(22714),d=s(48885);const r={sidebar_position:5,title:"Rootless \u6a21\u5f0f",description:"Podman Rootless \u5bb9\u5668\u8fd0\u884c\u8be6\u89e3"},l="Podman Rootless \u6a21\u5f0f",i={},a=[{value:"\u914d\u7f6e Rootless",id:"\u914d\u7f6e-rootless",level:2},{value:"\u8bbe\u7f6e\u5b50 UID/GID",id:"\u8bbe\u7f6e\u5b50-uidgid",level:3},{value:"\u8fc1\u79fb\u5b58\u50a8",id:"\u8fc1\u79fb\u5b58\u50a8",level:3},{value:"Rootless \u8fd0\u884c",id:"rootless-\u8fd0\u884c",level:2},{value:"\u7aef\u53e3\u9650\u5236",id:"\u7aef\u53e3\u9650\u5236",level:2},{value:"\u5b58\u50a8\u914d\u7f6e",id:"\u5b58\u50a8\u914d\u7f6e",level:2},{value:"\u7f51\u7edc\u914d\u7f6e",id:"\u7f51\u7edc\u914d\u7f6e",level:2},{value:"\u4e0e Root \u6a21\u5f0f\u5bf9\u6bd4",id:"\u4e0e-root-\u6a21\u5f0f\u5bf9\u6bd4",level:2},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2}];function c(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,d.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"podman-rootless-\u6a21\u5f0f",children:"Podman Rootless \u6a21\u5f0f"})}),"\n",(0,t.jsx)(e.p,{children:"Rootless \u6a21\u5f0f\u662f Podman \u7684\u6838\u5fc3\u4f18\u52bf\uff0c\u5141\u8bb8\u975e root \u7528\u6237\u8fd0\u884c\u5bb9\u5668\uff0c\u63d0\u9ad8\u5b89\u5168\u6027\u3002"}),"\n",(0,t.jsx)(e.h2,{id:"\u914d\u7f6e-rootless",children:"\u914d\u7f6e Rootless"}),"\n",(0,t.jsx)(e.h3,{id:"\u8bbe\u7f6e\u5b50-uidgid",children:"\u8bbe\u7f6e\u5b50 UID/GID"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u5f53\u524d\u8bbe\u7f6e\ncat /etc/subuid\ncat /etc/subgid\n\n# \u6dfb\u52a0\u6620\u5c04\u8303\u56f4\nsudo usermod --add-subuids 100000-165535 $USER\nsudo usermod --add-subgids 100000-165535 $USER\n\n# \u9a8c\u8bc1\npodman unshare cat /proc/self/uid_map\n"})}),"\n",(0,t.jsx)(e.h3,{id:"\u8fc1\u79fb\u5b58\u50a8",children:"\u8fc1\u79fb\u5b58\u50a8"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u4ece root \u6a21\u5f0f\u8fc1\u79fb\npodman system migrate\n"})}),"\n",(0,t.jsx)(e.h2,{id:"rootless-\u8fd0\u884c",children:"Rootless \u8fd0\u884c"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u76f4\u63a5\u4ee5\u666e\u901a\u7528\u6237\u8fd0\u884c\npodman run -d -p 8080:80 nginx\n\n# \u67e5\u770b\u7528\u6237\u547d\u540d\u7a7a\u95f4\npodman unshare id\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u7aef\u53e3\u9650\u5236",children:"\u7aef\u53e3\u9650\u5236"}),"\n",(0,t.jsx)(e.p,{children:"\u975e root \u7528\u6237\u9ed8\u8ba4\u4e0d\u80fd\u7ed1\u5b9a 1024 \u4ee5\u4e0b\u7aef\u53e3\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u65b9\u6cd51\uff1a\u4f7f\u7528\u9ad8\u7aef\u53e3\npodman run -p 8080:80 nginx\n\n# \u65b9\u6cd52\uff1a\u4fee\u6539\u7cfb\u7edf\u8bbe\u7f6e\nsudo sysctl net.ipv4.ip_unprivileged_port_start=80\n\n# \u65b9\u6cd53\uff1a\u7aef\u53e3\u8f6c\u53d1\nsudo firewall-cmd --add-forward-port=port=80:proto=tcp:toport=8080\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u5b58\u50a8\u914d\u7f6e",children:"\u5b58\u50a8\u914d\u7f6e"}),"\n",(0,t.jsx)(e.p,{children:"Rootless \u5b58\u50a8\u4f4d\u4e8e\u7528\u6237\u76ee\u5f55\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u9ed8\u8ba4\u4f4d\u7f6e\n~/.local/share/containers/\n\n# \u914d\u7f6e\u6587\u4ef6\n~/.config/containers/storage.conf\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-toml",children:'[storage]\ndriver = "overlay"\n\n[storage.options.overlay]\nmount_program = "/usr/bin/fuse-overlayfs"\n'})}),"\n",(0,t.jsx)(e.h2,{id:"\u7f51\u7edc\u914d\u7f6e",children:"\u7f51\u7edc\u914d\u7f6e"}),"\n",(0,t.jsx)(e.p,{children:"Rootless \u4f7f\u7528 slirp4netns\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u7f51\u7edc\u6a21\u5f0f\npodman info | grep network\n\n# \u4f7f\u7528 pasta\uff08\u66f4\u9ad8\u6027\u80fd\uff09\npodman run --network pasta nginx\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u4e0e-root-\u6a21\u5f0f\u5bf9\u6bd4",children:"\u4e0e Root \u6a21\u5f0f\u5bf9\u6bd4"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"\u7279\u6027"}),(0,t.jsx)(e.th,{children:"Rootless"}),(0,t.jsx)(e.th,{children:"Root"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"\u5b89\u5168\u6027"}),(0,t.jsx)(e.td,{children:"\u66f4\u9ad8"}),(0,t.jsx)(e.td,{children:"\u8f83\u4f4e"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"\u7aef\u53e3"}),(0,t.jsx)(e.td,{children:">1024"}),(0,t.jsx)(e.td,{children:"\u6240\u6709"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"\u6027\u80fd"}),(0,t.jsx)(e.td,{children:"\u7565\u4f4e"}),(0,t.jsx)(e.td,{children:"\u66f4\u9ad8"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"\u5b58\u50a8\u4f4d\u7f6e"}),(0,t.jsx)(e.td,{children:"\u7528\u6237\u76ee\u5f55"}),(0,t.jsx)(e.td,{children:"\u7cfb\u7edf\u76ee\u5f55"})]})]})]}),"\n",(0,t.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"\u751f\u4ea7\u73af\u5883\u4f18\u5148\u4f7f\u7528 Rootless"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"\u914d\u7f6e\u8db3\u591f\u7684 subuid/subgid \u8303\u56f4"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"\u4f7f\u7528 overlay \u5b58\u50a8\u9a71\u52a8"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"\u8003\u8651\u4f7f\u7528 pasta \u7f51\u7edc\u63d0\u5347\u6027\u80fd"})}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(c,{...n})}):c(n)}},48885:(n,e,s)=>{s.d(e,{R:()=>r,x:()=>l});var o=s(99378);const t={},d=o.createContext(t);function r(n){const e=o.useContext(d);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:r(n.components),o.createElement(d.Provider,{value:e},n.children)}}}]);
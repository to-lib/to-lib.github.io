"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[70763],{12126:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"microservices/security","title":"\u5b89\u5168","description":"\u5fae\u670d\u52a1\u5b89\u5168 - mTLS\u3001OAuth2\u3001JWT\u3001\u5b89\u5168\u6700\u4f73\u5b9e\u8df5","source":"@site/docs/microservices/security.md","sourceDirName":"microservices","slug":"/microservices/security","permalink":"/docs/microservices/security","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/microservices/security.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"\u5b89\u5168","description":"\u5fae\u670d\u52a1\u5b89\u5168 - mTLS\u3001OAuth2\u3001JWT\u3001\u5b89\u5168\u6700\u4f73\u5b9e\u8df5"},"sidebar":"microservices","previous":{"title":"\u53ef\u89c2\u6d4b\u6027","permalink":"/docs/microservices/observability"},"next":{"title":"\u6700\u4f73\u5b9e\u8df5","permalink":"/docs/microservices/best-practices"}}');var i=t(22714),s=t(48885);const a={sidebar_position:7,title:"\u5b89\u5168",description:"\u5fae\u670d\u52a1\u5b89\u5168 - mTLS\u3001OAuth2\u3001JWT\u3001\u5b89\u5168\u6700\u4f73\u5b9e\u8df5"},l="\u5fae\u670d\u52a1\u5b89\u5168",c={},o=[{value:"\u670d\u52a1\u95f4\u8ba4\u8bc1\uff08mTLS\uff09",id:"\u670d\u52a1\u95f4\u8ba4\u8bc1mtls",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:3},{value:"Istio mTLS \u914d\u7f6e",id:"istio-mtls-\u914d\u7f6e",level:3},{value:"Spring Boot mTLS \u914d\u7f6e",id:"spring-boot-mtls-\u914d\u7f6e",level:3},{value:"API \u8ba4\u8bc1\u4e0e\u6388\u6743",id:"api-\u8ba4\u8bc1\u4e0e\u6388\u6743",level:2},{value:"OAuth2 + JWT",id:"oauth2--jwt",level:3},{value:"Spring Security OAuth2 \u914d\u7f6e",id:"spring-security-oauth2-\u914d\u7f6e",level:3},{value:"\u8d44\u6e90\u670d\u52a1\u5668\u914d\u7f6e",id:"\u8d44\u6e90\u670d\u52a1\u5668\u914d\u7f6e",level:3},{value:"JWT Token \u7ed3\u6784",id:"jwt-token-\u7ed3\u6784",level:3},{value:"API \u7f51\u5173 JWT \u9a8c\u8bc1",id:"api-\u7f51\u5173-jwt-\u9a8c\u8bc1",level:3},{value:"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5",id:"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u5b89\u5168\u6e05\u5355",id:"\u5b89\u5168\u6e05\u5355",level:3},{value:"\u5bc6\u94a5\u7ba1\u7406",id:"\u5bc6\u94a5\u7ba1\u7406",level:3},{value:"\u8f93\u5165\u9a8c\u8bc1",id:"\u8f93\u5165\u9a8c\u8bc1",level:3},{value:"\u5b89\u5168\u54cd\u5e94\u5934",id:"\u5b89\u5168\u54cd\u5e94\u5934",level:3},{value:"\u65e5\u5fd7\u8131\u654f",id:"\u65e5\u5fd7\u8131\u654f",level:3},{value:"RBAC \u6743\u9650\u63a7\u5236",id:"rbac-\u6743\u9650\u63a7\u5236",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u5fae\u670d\u52a1\u5b89\u5168",children:"\u5fae\u670d\u52a1\u5b89\u5168"})}),"\n",(0,i.jsx)(n.h2,{id:"\u670d\u52a1\u95f4\u8ba4\u8bc1mtls",children:"\u670d\u52a1\u95f4\u8ba4\u8bc1\uff08mTLS\uff09"}),"\n",(0,i.jsx)(n.h3,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,i.jsx)(n.p,{children:"mTLS\uff08\u53cc\u5411 TLS\uff09\u786e\u4fdd\u670d\u52a1\u95f4\u901a\u4fe1\u7684\u53cc\u5411\u8eab\u4efd\u9a8c\u8bc1\u548c\u52a0\u5bc6\u3002"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant A as \u670d\u52a1 A\n    participant B as \u670d\u52a1 B\n    \n    A->>B: 1. ClientHello\n    B->>A: 2. ServerHello + \u670d\u52a1\u5668\u8bc1\u4e66\n    A->>B: 3. \u9a8c\u8bc1\u670d\u52a1\u5668\u8bc1\u4e66\n    A->>B: 4. \u5ba2\u6237\u7aef\u8bc1\u4e66\n    B->>A: 5. \u9a8c\u8bc1\u5ba2\u6237\u7aef\u8bc1\u4e66\n    A->>B: 6. \u52a0\u5bc6\u901a\u4fe1"}),"\n",(0,i.jsx)(n.h3,{id:"istio-mtls-\u914d\u7f6e",children:"Istio mTLS \u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# PeerAuthentication - \u542f\u7528 mTLS\napiVersion: security.istio.io/v1beta1\nkind: PeerAuthentication\nmetadata:\n  name: default\n  namespace: production\nspec:\n  mtls:\n    mode: STRICT  # STRICT | PERMISSIVE | DISABLE\n\n---\n# DestinationRule - \u5ba2\u6237\u7aef mTLS\napiVersion: networking.istio.io/v1beta1\nkind: DestinationRule\nmetadata:\n  name: default\n  namespace: production\nspec:\n  host: "*.production.svc.cluster.local"\n  trafficPolicy:\n    tls:\n      mode: ISTIO_MUTUAL\n'})}),"\n",(0,i.jsx)(n.h3,{id:"spring-boot-mtls-\u914d\u7f6e",children:"Spring Boot mTLS \u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# application.yml\nserver:\n  ssl:\n    enabled: true\n    key-store: classpath:keystore.p12\n    key-store-password: ${SSL_KEYSTORE_PASSWORD}\n    key-store-type: PKCS12\n    client-auth: need  # \u8981\u6c42\u5ba2\u6237\u7aef\u8bc1\u4e66\n    trust-store: classpath:truststore.p12\n    trust-store-password: ${SSL_TRUSTSTORE_PASSWORD}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// RestTemplate \u914d\u7f6e mTLS\n@Configuration\npublic class RestTemplateConfig {\n    \n    @Bean\n    public RestTemplate restTemplate() throws Exception {\n        SSLContext sslContext = SSLContextBuilder.create()\n            .loadKeyMaterial(\n                new ClassPathResource("client.p12").getFile(),\n                "password".toCharArray(),\n                "password".toCharArray()\n            )\n            .loadTrustMaterial(\n                new ClassPathResource("truststore.p12").getFile(),\n                "password".toCharArray()\n            )\n            .build();\n        \n        HttpClient httpClient = HttpClients.custom()\n            .setSSLContext(sslContext)\n            .build();\n        \n        HttpComponentsClientHttpRequestFactory factory = \n            new HttpComponentsClientHttpRequestFactory(httpClient);\n        \n        return new RestTemplate(factory);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"api-\u8ba4\u8bc1\u4e0e\u6388\u6743",children:"API \u8ba4\u8bc1\u4e0e\u6388\u6743"}),"\n",(0,i.jsx)(n.h3,{id:"oauth2--jwt",children:"OAuth2 + JWT"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant C as \u5ba2\u6237\u7aef\n    participant G as API \u7f51\u5173\n    participant A as \u8ba4\u8bc1\u670d\u52a1\n    participant R as \u8d44\u6e90\u670d\u52a1\n    \n    C->>A: 1. \u767b\u5f55\u8bf7\u6c42\n    A->>C: 2. \u8fd4\u56de JWT Token\n    C->>G: 3. \u8bf7\u6c42 + JWT Token\n    G->>G: 4. \u9a8c\u8bc1 Token\n    G->>R: 5. \u8f6c\u53d1\u8bf7\u6c42\n    R->>C: 6. \u8fd4\u56de\u6570\u636e"}),"\n",(0,i.jsx)(n.h3,{id:"spring-security-oauth2-\u914d\u7f6e",children:"Spring Security OAuth2 \u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u8ba4\u8bc1\u670d\u52a1\u5668\u914d\u7f6e\n@Configuration\n@EnableAuthorizationServer\npublic class AuthServerConfig extends AuthorizationServerConfigurerAdapter {\n    \n    @Autowired\n    private AuthenticationManager authenticationManager;\n    \n    @Override\n    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {\n        clients.inMemory()\n            .withClient("web-client")\n            .secret(passwordEncoder.encode("secret"))\n            .authorizedGrantTypes("password", "refresh_token")\n            .scopes("read", "write")\n            .accessTokenValiditySeconds(3600)\n            .refreshTokenValiditySeconds(86400);\n    }\n    \n    @Override\n    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {\n        endpoints\n            .authenticationManager(authenticationManager)\n            .tokenStore(tokenStore())\n            .accessTokenConverter(jwtAccessTokenConverter());\n    }\n    \n    @Bean\n    public JwtAccessTokenConverter jwtAccessTokenConverter() {\n        JwtAccessTokenConverter converter = new JwtAccessTokenConverter();\n        converter.setSigningKey("your-secret-key");\n        return converter;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u8d44\u6e90\u670d\u52a1\u5668\u914d\u7f6e",children:"\u8d44\u6e90\u670d\u52a1\u5668\u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Configuration\n@EnableResourceServer\npublic class ResourceServerConfig extends ResourceServerConfigurerAdapter {\n    \n    @Override\n    public void configure(HttpSecurity http) throws Exception {\n        http.authorizeRequests()\n            .antMatchers("/api/public/**").permitAll()\n            .antMatchers("/api/admin/**").hasRole("ADMIN")\n            .antMatchers("/api/**").authenticated();\n    }\n    \n    @Override\n    public void configure(ResourceServerSecurityConfigurer resources) {\n        resources.tokenStore(tokenStore());\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"jwt-token-\u7ed3\u6784",children:"JWT Token \u7ed3\u6784"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'// Header\n{\n  "alg": "RS256",\n  "typ": "JWT"\n}\n\n// Payload\n{\n  "sub": "user123",\n  "name": "\u5f20\u4e09",\n  "roles": ["USER", "ADMIN"],\n  "iat": 1704067200,\n  "exp": 1704070800,\n  "iss": "auth-service"\n}\n\n// Signature\nRSASHA256(\n  base64UrlEncode(header) + "." + base64UrlEncode(payload),\n  privateKey\n)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"api-\u7f51\u5173-jwt-\u9a8c\u8bc1",children:"API \u7f51\u5173 JWT \u9a8c\u8bc1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// Spring Cloud Gateway JWT \u8fc7\u6ee4\u5668\n@Component\npublic class JwtAuthFilter implements GlobalFilter, Ordered {\n    \n    @Value("${jwt.secret}")\n    private String jwtSecret;\n    \n    @Override\n    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n        String path = exchange.getRequest().getPath().value();\n        \n        // \u767d\u540d\u5355\u8def\u5f84\n        if (isWhitelisted(path)) {\n            return chain.filter(exchange);\n        }\n        \n        String token = extractToken(exchange.getRequest());\n        if (token == null) {\n            return unauthorized(exchange);\n        }\n        \n        try {\n            Claims claims = Jwts.parserBuilder()\n                .setSigningKey(jwtSecret.getBytes())\n                .build()\n                .parseClaimsJws(token)\n                .getBody();\n            \n            // \u5c06\u7528\u6237\u4fe1\u606f\u4f20\u9012\u7ed9\u4e0b\u6e38\u670d\u52a1\n            ServerHttpRequest request = exchange.getRequest().mutate()\n                .header("X-User-Id", claims.getSubject())\n                .header("X-User-Roles", String.join(",", getRoles(claims)))\n                .build();\n            \n            return chain.filter(exchange.mutate().request(request).build());\n        } catch (JwtException e) {\n            return unauthorized(exchange);\n        }\n    }\n    \n    @Override\n    public int getOrder() {\n        return -100;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5",children:"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsx)(n.h3,{id:"\u5b89\u5168\u6e05\u5355",children:"\u5b89\u5168\u6e05\u5355"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u7c7b\u522b"}),(0,i.jsx)(n.th,{children:"\u5b9e\u8df5"}),(0,i.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"\u4f20\u8f93\u5b89\u5168"})}),(0,i.jsx)(n.td,{children:"\u4f7f\u7528 HTTPS/TLS"}),(0,i.jsx)(n.td,{children:"\u6240\u6709\u901a\u4fe1\u52a0\u5bc6"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"\u542f\u7528 mTLS"}),(0,i.jsx)(n.td,{children:"\u670d\u52a1\u95f4\u53cc\u5411\u8ba4\u8bc1"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"\u8ba4\u8bc1\u6388\u6743"})}),(0,i.jsx)(n.td,{children:"\u4f7f\u7528 OAuth2/JWT"}),(0,i.jsx)(n.td,{children:"\u6807\u51c6\u5316\u8ba4\u8bc1"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"\u6700\u5c0f\u6743\u9650\u539f\u5219"}),(0,i.jsx)(n.td,{children:"\u53ea\u6388\u4e88\u5fc5\u8981\u6743\u9650"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Token \u8fc7\u671f\u673a\u5236"}),(0,i.jsx)(n.td,{children:"\u8bbe\u7f6e\u5408\u7406\u8fc7\u671f\u65f6\u95f4"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"\u6570\u636e\u5b89\u5168"})}),(0,i.jsx)(n.td,{children:"\u654f\u611f\u6570\u636e\u52a0\u5bc6"}),(0,i.jsx)(n.td,{children:"\u6570\u636e\u5e93\u5b57\u6bb5\u52a0\u5bc6"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"\u5bc6\u94a5\u7ba1\u7406"}),(0,i.jsx)(n.td,{children:"\u4f7f\u7528 Vault \u7b49\u5de5\u5177"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"\u8f93\u5165\u9a8c\u8bc1"})}),(0,i.jsx)(n.td,{children:"\u53c2\u6570\u6821\u9a8c"}),(0,i.jsx)(n.td,{children:"\u9632\u6b62\u6ce8\u5165\u653b\u51fb"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"\u8bf7\u6c42\u9650\u6d41"}),(0,i.jsx)(n.td,{children:"\u9632\u6b62 DDoS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"\u65e5\u5fd7\u5ba1\u8ba1"})}),(0,i.jsx)(n.td,{children:"\u5b89\u5168\u65e5\u5fd7"}),(0,i.jsx)(n.td,{children:"\u8bb0\u5f55\u654f\u611f\u64cd\u4f5c"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"\u8131\u654f\u5904\u7406"}),(0,i.jsx)(n.td,{children:"\u65e5\u5fd7\u4e2d\u9690\u85cf\u654f\u611f\u4fe1\u606f"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\u5bc6\u94a5\u7ba1\u7406",children:"\u5bc6\u94a5\u7ba1\u7406"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u4f7f\u7528 HashiCorp Vault\n@Configuration\npublic class VaultConfig {\n    \n    @Bean\n    public VaultTemplate vaultTemplate() {\n        VaultEndpoint endpoint = VaultEndpoint.create("vault.example.com", 8200);\n        TokenAuthentication auth = new TokenAuthentication("your-token");\n        return new VaultTemplate(endpoint, auth);\n    }\n}\n\n@Service\npublic class SecretService {\n    \n    @Autowired\n    private VaultTemplate vaultTemplate;\n    \n    public String getSecret(String path) {\n        VaultResponseSupport<Map<String, Object>> response = \n            vaultTemplate.read("secret/data/" + path);\n        return (String) response.getData().get("value");\n    }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# Kubernetes Secret \u52a0\u5bc6\napiVersion: v1\nkind: Secret\nmetadata:\n  name: db-credentials\ntype: Opaque\ndata:\n  username: YWRtaW4=  # base64 \u7f16\u7801\n  password: cGFzc3dvcmQ=\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u8f93\u5165\u9a8c\u8bc1",children:"\u8f93\u5165\u9a8c\u8bc1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@RestController\n@Validated\npublic class UserController {\n    \n    @PostMapping("/users")\n    public User createUser(@Valid @RequestBody UserDTO dto) {\n        return userService.create(dto);\n    }\n}\n\npublic class UserDTO {\n    \n    @NotBlank(message = "\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a")\n    @Size(min = 3, max = 50, message = "\u7528\u6237\u540d\u957f\u5ea6 3-50")\n    @Pattern(regexp = "^[a-zA-Z0-9_]+$", message = "\u7528\u6237\u540d\u53ea\u80fd\u5305\u542b\u5b57\u6bcd\u6570\u5b57\u4e0b\u5212\u7ebf")\n    private String username;\n    \n    @NotBlank(message = "\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a")\n    @Email(message = "\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e")\n    private String email;\n    \n    @NotBlank(message = "\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a")\n    @Size(min = 8, message = "\u5bc6\u7801\u81f3\u5c11 8 \u4f4d")\n    private String password;\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u5b89\u5168\u54cd\u5e94\u5934",children:"\u5b89\u5168\u54cd\u5e94\u5934"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Configuration\npublic class SecurityHeadersConfig {\n    \n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http.headers()\n            .contentSecurityPolicy(\"default-src 'self'\")\n            .and()\n            .xssProtection()\n            .and()\n            .contentTypeOptions()\n            .and()\n            .frameOptions().deny()\n            .and()\n            .httpStrictTransportSecurity()\n                .includeSubDomains(true)\n                .maxAgeInSeconds(31536000);\n        \n        return http.build();\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u65e5\u5fd7\u8131\u654f",children:"\u65e5\u5fd7\u8131\u654f"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Aspect\n@Component\npublic class SensitiveDataMaskingAspect {\n    \n    @Around("@annotation(LogSensitive)")\n    public Object maskSensitiveData(ProceedingJoinPoint joinPoint) throws Throwable {\n        Object[] args = joinPoint.getArgs();\n        Object[] maskedArgs = Arrays.stream(args)\n            .map(this::maskIfSensitive)\n            .toArray();\n        \n        log.info("\u65b9\u6cd5\u8c03\u7528: {} \u53c2\u6570: {}", \n            joinPoint.getSignature().getName(), \n            Arrays.toString(maskedArgs));\n        \n        return joinPoint.proceed();\n    }\n    \n    private Object maskIfSensitive(Object obj) {\n        if (obj instanceof String) {\n            String str = (String) obj;\n            // \u624b\u673a\u53f7\u8131\u654f\n            if (str.matches("\\\\d{11}")) {\n                return str.substring(0, 3) + "****" + str.substring(7);\n            }\n            // \u90ae\u7bb1\u8131\u654f\n            if (str.contains("@")) {\n                int atIndex = str.indexOf("@");\n                return str.substring(0, 2) + "***" + str.substring(atIndex);\n            }\n        }\n        return obj;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"rbac-\u6743\u9650\u63a7\u5236",children:"RBAC \u6743\u9650\u63a7\u5236"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\n@PreAuthorize("hasRole(\'ADMIN\')")\n@GetMapping("/admin/users")\npublic List<User> getAllUsers() {\n    return userService.findAll();\n}\n\n@PreAuthorize("hasPermission(#id, \'User\', \'read\')")\n@GetMapping("/users/{id}")\npublic User getUser(@PathVariable Long id) {\n    return userService.findById(id);\n}\n\n// \u81ea\u5b9a\u4e49\u6743\u9650\u8bc4\u4f30\u5668\n@Component\npublic class CustomPermissionEvaluator implements PermissionEvaluator {\n    \n    @Override\n    public boolean hasPermission(Authentication auth, Object targetId, \n            Object targetType, Object permission) {\n        if (auth == null || targetType == null || permission == null) {\n            return false;\n        }\n        \n        String type = targetType.toString().toUpperCase();\n        return hasPrivilege(auth, type, permission.toString().toUpperCase());\n    }\n    \n    private boolean hasPrivilege(Authentication auth, String type, String permission) {\n        return auth.getAuthorities().stream()\n            .anyMatch(a -> a.getAuthority().equals(type + "_" + permission));\n    }\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},48885:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var r=t(99378);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);
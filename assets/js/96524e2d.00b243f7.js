"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[48304],{29174:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"ml/interpretability","title":"\ud83d\udd0d \u53ef\u89e3\u91ca\u6027","description":"\u7406\u89e3\u6a21\u578b\u4e3a\u4ec0\u4e48\u505a\u51fa\u8fd9\u6837\u7684\u9884\u6d4b\uff0c\u5bf9\u4e8e\u6a21\u578b\u8c03\u8bd5\u548c\u4e1a\u52a1\u4fe1\u4efb\u81f3\u5173\u91cd\u8981\u3002","source":"@site/docs/ml/interpretability.md","sourceDirName":"ml","slug":"/ml/interpretability","permalink":"/docs/ml/interpretability","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/ml/interpretability.md","tags":[],"version":"current","sidebarPosition":18,"frontMatter":{"sidebar_position":18,"title":"\ud83d\udd0d \u53ef\u89e3\u91ca\u6027"},"sidebar":"ml","previous":{"title":"\u2699\ufe0f \u6a21\u578b\u8c03\u4f18","permalink":"/docs/ml/model-tuning"},"next":{"title":"\ud83e\udd16 AutoML","permalink":"/docs/ml/automl"}}');var i=t(22714),r=t(48885);const s={sidebar_position:18,title:"\ud83d\udd0d \u53ef\u89e3\u91ca\u6027"},a="\u6a21\u578b\u53ef\u89e3\u91ca\u6027",d={},c=[{value:"\u7279\u5f81\u91cd\u8981\u6027",id:"\u7279\u5f81\u91cd\u8981\u6027",level:2},{value:"\u6811\u6a21\u578b\u5185\u7f6e\u91cd\u8981\u6027",id:"\u6811\u6a21\u578b\u5185\u7f6e\u91cd\u8981\u6027",level:3},{value:"\u6392\u5217\u91cd\u8981\u6027",id:"\u6392\u5217\u91cd\u8981\u6027",level:3},{value:"SHAP",id:"shap",level:2},{value:"\u5168\u5c40\u89e3\u91ca",id:"\u5168\u5c40\u89e3\u91ca",level:3},{value:"\u5355\u6837\u672c\u89e3\u91ca",id:"\u5355\u6837\u672c\u89e3\u91ca",level:3},{value:"\u7279\u5f81\u4ea4\u4e92",id:"\u7279\u5f81\u4ea4\u4e92",level:3},{value:"LIME",id:"lime",level:2},{value:"\u90e8\u5206\u4f9d\u8d56\u56fe (PDP)",id:"\u90e8\u5206\u4f9d\u8d56\u56fe-pdp",level:2},{value:"ICE \u56fe",id:"ice-\u56fe",level:2},{value:"\u65b9\u6cd5\u5bf9\u6bd4",id:"\u65b9\u6cd5\u5bf9\u6bd4",level:2},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u6a21\u578b\u53ef\u89e3\u91ca\u6027",children:"\u6a21\u578b\u53ef\u89e3\u91ca\u6027"})}),"\n",(0,i.jsx)(n.p,{children:"\u7406\u89e3\u6a21\u578b\u4e3a\u4ec0\u4e48\u505a\u51fa\u8fd9\u6837\u7684\u9884\u6d4b\uff0c\u5bf9\u4e8e\u6a21\u578b\u8c03\u8bd5\u548c\u4e1a\u52a1\u4fe1\u4efb\u81f3\u5173\u91cd\u8981\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u7279\u5f81\u91cd\u8981\u6027",children:"\u7279\u5f81\u91cd\u8981\u6027"}),"\n",(0,i.jsx)(n.h3,{id:"\u6811\u6a21\u578b\u5185\u7f6e\u91cd\u8981\u6027",children:"\u6811\u6a21\u578b\u5185\u7f6e\u91cd\u8981\u6027"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from sklearn.ensemble import RandomForestClassifier\nimport matplotlib.pyplot as plt\n\nrf = RandomForestClassifier(n_estimators=100)\nrf.fit(X_train, y_train)\n\n# \u7279\u5f81\u91cd\u8981\u6027\nimportance = pd.DataFrame({\n    'feature': feature_names,\n    'importance': rf.feature_importances_\n}).sort_values('importance', ascending=False)\n\n# \u53ef\u89c6\u5316\nplt.barh(importance['feature'][:10], importance['importance'][:10])\nplt.xlabel('\u91cd\u8981\u6027')\nplt.title('\u7279\u5f81\u91cd\u8981\u6027 Top 10')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u6392\u5217\u91cd\u8981\u6027",children:"\u6392\u5217\u91cd\u8981\u6027"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from sklearn.inspection import permutation_importance\n\nresult = permutation_importance(model, X_test, y_test, n_repeats=10)\n\nimportance = pd.DataFrame({\n    'feature': feature_names,\n    'importance': result.importances_mean,\n    'std': result.importances_std\n}).sort_values('importance', ascending=False)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"shap",children:"SHAP"}),"\n",(0,i.jsx)(n.p,{children:"SHAP (SHapley Additive exPlanations) \u57fa\u4e8e\u535a\u5f08\u8bba\uff0c\u4e3a\u6bcf\u4e2a\u7279\u5f81\u5206\u914d\u8d21\u732e\u503c\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import shap\n\n# \u521b\u5efa\u89e3\u91ca\u5668\nexplainer = shap.TreeExplainer(model)  # \u6811\u6a21\u578b\n# explainer = shap.KernelExplainer(model.predict, X_train[:100])  # \u901a\u7528\n\n# \u8ba1\u7b97 SHAP \u503c\nshap_values = explainer.shap_values(X_test)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5168\u5c40\u89e3\u91ca",children:"\u5168\u5c40\u89e3\u91ca"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u7279\u5f81\u91cd\u8981\u6027\u6c47\u603b\u56fe\nshap.summary_plot(shap_values, X_test, feature_names=feature_names)\n\n# \u6761\u5f62\u56fe\nshap.summary_plot(shap_values, X_test, plot_type='bar')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5355\u6837\u672c\u89e3\u91ca",children:"\u5355\u6837\u672c\u89e3\u91ca"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u7011\u5e03\u56fe - \u89e3\u91ca\u5355\u4e2a\u9884\u6d4b\nshap.waterfall_plot(shap.Explanation(\n    values=shap_values[0],\n    base_values=explainer.expected_value,\n    data=X_test.iloc[0],\n    feature_names=feature_names\n))\n\n# \u529b\u56fe\nshap.force_plot(explainer.expected_value, shap_values[0], X_test.iloc[0])\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u7279\u5f81\u4ea4\u4e92",children:"\u7279\u5f81\u4ea4\u4e92"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# \u4f9d\u8d56\u56fe\nshap.dependence_plot('feature_name', shap_values, X_test)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"lime",children:"LIME"}),"\n",(0,i.jsx)(n.p,{children:"LIME (Local Interpretable Model-agnostic Explanations) \u7528\u7b80\u5355\u6a21\u578b\u5c40\u90e8\u8fd1\u4f3c\u590d\u6742\u6a21\u578b\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from lime.lime_tabular import LimeTabularExplainer\n\nexplainer = LimeTabularExplainer(\n    X_train.values,\n    feature_names=feature_names,\n    class_names=['\u8d1f', '\u6b63'],\n    mode='classification'\n)\n\n# \u89e3\u91ca\u5355\u4e2a\u9884\u6d4b\nexp = explainer.explain_instance(\n    X_test.iloc[0].values,\n    model.predict_proba,\n    num_features=10\n)\n\nexp.show_in_notebook()\n# \u6216\u4fdd\u5b58\u4e3a HTML\nexp.save_to_file('explanation.html')\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u90e8\u5206\u4f9d\u8d56\u56fe-pdp",children:"\u90e8\u5206\u4f9d\u8d56\u56fe (PDP)"}),"\n",(0,i.jsx)(n.p,{children:"\u5c55\u793a\u7279\u5f81\u4e0e\u9884\u6d4b\u7684\u8fb9\u9645\u6548\u5e94\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from sklearn.inspection import PartialDependenceDisplay\n\n# \u5355\u7279\u5f81 PDP\nPartialDependenceDisplay.from_estimator(model, X_train, ['feature1', 'feature2'])\nplt.show()\n\n# \u53cc\u7279\u5f81\u4ea4\u4e92 PDP\nPartialDependenceDisplay.from_estimator(\n    model, X_train, [('feature1', 'feature2')]\n)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"ice-\u56fe",children:"ICE \u56fe"}),"\n",(0,i.jsx)(n.p,{children:"Individual Conditional Expectation - \u6bcf\u4e2a\u6837\u672c\u7684 PDP\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from sklearn.inspection import PartialDependenceDisplay\n\nPartialDependenceDisplay.from_estimator(\n    model, X_train, ['feature1'],\n    kind='both'  # \u540c\u65f6\u663e\u793a PDP \u548c ICE\n)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u65b9\u6cd5\u5bf9\u6bd4",children:"\u65b9\u6cd5\u5bf9\u6bd4"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u65b9\u6cd5"}),(0,i.jsx)(n.th,{children:"\u4f5c\u7528\u8303\u56f4"}),(0,i.jsx)(n.th,{children:"\u6a21\u578b\u65e0\u5173"}),(0,i.jsx)(n.th,{children:"\u8ba1\u7b97\u901f\u5ea6"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u7279\u5f81\u91cd\u8981\u6027"}),(0,i.jsx)(n.td,{children:"\u5168\u5c40"}),(0,i.jsx)(n.td,{children:"\u5426 (\u6811\u6a21\u578b)"}),(0,i.jsx)(n.td,{children:"\u5feb"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u6392\u5217\u91cd\u8981\u6027"}),(0,i.jsx)(n.td,{children:"\u5168\u5c40"}),(0,i.jsx)(n.td,{children:"\u662f"}),(0,i.jsx)(n.td,{children:"\u4e2d"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"SHAP"}),(0,i.jsx)(n.td,{children:"\u5168\u5c40+\u5c40\u90e8"}),(0,i.jsx)(n.td,{children:"\u662f"}),(0,i.jsx)(n.td,{children:"\u6162"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"LIME"}),(0,i.jsx)(n.td,{children:"\u5c40\u90e8"}),(0,i.jsx)(n.td,{children:"\u662f"}),(0,i.jsx)(n.td,{children:"\u4e2d"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"PDP"}),(0,i.jsx)(n.td,{children:"\u5168\u5c40"}),(0,i.jsx)(n.td,{children:"\u662f"}),(0,i.jsx)(n.td,{children:"\u4e2d"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u4ece\u7279\u5f81\u91cd\u8981\u6027\u5f00\u59cb"}),"\uff1a\u5feb\u901f\u4e86\u89e3\u54ea\u4e9b\u7279\u5f81\u91cd\u8981"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7528 SHAP \u6df1\u5165\u5206\u6790"}),"\uff1a\u7406\u89e3\u7279\u5f81\u5982\u4f55\u5f71\u54cd\u9884\u6d4b"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7528 LIME \u89e3\u91ca\u4e2a\u4f8b"}),"\uff1a\u5411\u4e1a\u52a1\u65b9\u89e3\u91ca\u5177\u4f53\u9884\u6d4b"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u4ea4\u53c9\u9a8c\u8bc1\u89e3\u91ca\u7ed3\u679c"}),"\uff1a\u4e0d\u540c\u65b9\u6cd5\u7ed3\u679c\u5e94\u8be5\u4e00\u81f4"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u8b66\u60d5\u76f8\u5173\u7279\u5f81"}),"\uff1a\u9ad8\u5ea6\u76f8\u5173\u7684\u7279\u5f81\u4f1a\u5206\u6563\u91cd\u8981\u6027"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},48885:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var l=t(99378);const i={},r=l.createContext(i);function s(e){const n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);
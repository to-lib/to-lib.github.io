"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[35285],{6110:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"redis/pipeline","title":"\u7ba1\u9053\u548c\u6279\u91cf\u64cd\u4f5c","description":"\u7ba1\u9053\uff08Pipeline\uff09\u548c\u6279\u91cf\u64cd\u4f5c\u662f Redis \u6027\u80fd\u4f18\u5316\u7684\u91cd\u8981\u624b\u6bb5\u3002","source":"@site/docs/redis/pipeline.md","sourceDirName":"redis","slug":"/redis/pipeline","permalink":"/docs/redis/pipeline","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/redis/pipeline.md","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12,"title":"\u7ba1\u9053\u548c\u6279\u91cf\u64cd\u4f5c"},"sidebar":"redis","previous":{"title":"Stream \u6570\u636e\u6d41","permalink":"/docs/redis/streams"},"next":{"title":"Lua \u811a\u672c","permalink":"/docs/redis/lua-scripting"}}');var s=i(22714),r=i(48885);const a={sidebar_position:12,title:"\u7ba1\u9053\u548c\u6279\u91cf\u64cd\u4f5c"},d="Redis \u7ba1\u9053\u548c\u6279\u91cf\u64cd\u4f5c",t={},c=[{value:"Pipeline \u7ba1\u9053",id:"pipeline-\u7ba1\u9053",level:2},{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5",level:3},{value:"Java \u5b9e\u73b0",id:"java-\u5b9e\u73b0",level:3},{value:"Jedis Pipeline",id:"jedis-pipeline",level:4},{value:"\u6027\u80fd\u5bf9\u6bd4",id:"\u6027\u80fd\u5bf9\u6bd4",level:4},{value:"Spring RedisTemplate",id:"spring-redistemplate",level:3},{value:"\u6279\u91cf\u64cd\u4f5c\u547d\u4ee4",id:"\u6279\u91cf\u64cd\u4f5c\u547d\u4ee4",level:2},{value:"MSET - \u6279\u91cf\u8bbe\u7f6e",id:"mset---\u6279\u91cf\u8bbe\u7f6e",level:3},{value:"MGET - \u6279\u91cf\u83b7\u53d6",id:"mget---\u6279\u91cf\u83b7\u53d6",level:3},{value:"MSETNX - \u6279\u91cf\u8bbe\u7f6e\uff08\u4e0d\u5b58\u5728\u65f6\uff09",id:"msetnx---\u6279\u91cf\u8bbe\u7f6e\u4e0d\u5b58\u5728\u65f6",level:3},{value:"DEL - \u6279\u91cf\u5220\u9664",id:"del---\u6279\u91cf\u5220\u9664",level:3},{value:"EXISTS - \u6279\u91cf\u68c0\u67e5",id:"exists---\u6279\u91cf\u68c0\u67e5",level:3},{value:"Lua \u811a\u672c",id:"lua-\u811a\u672c",level:2},{value:"\u57fa\u672c\u7528\u6cd5",id:"\u57fa\u672c\u7528\u6cd5",level:3},{value:"Java \u8c03\u7528 Lua",id:"java-\u8c03\u7528-lua",level:3},{value:"SCRIPT LOAD / EVALSHA",id:"script-load--evalsha",level:3},{value:"\u5b9e\u6218\u6848\u4f8b",id:"\u5b9e\u6218\u6848\u4f8b",level:3},{value:"\u5206\u5e03\u5f0f\u9650\u6d41",id:"\u5206\u5e03\u5f0f\u9650\u6d41",level:4},{value:"\u5e93\u5b58\u6263\u51cf",id:"\u5e93\u5b58\u6263\u51cf",level:4},{value:"Transaction vs Pipeline vs Lua",id:"transaction-vs-pipeline-vs-lua",level:2},{value:"\u7279\u6027\u5bf9\u6bd4",id:"\u7279\u6027\u5bf9\u6bd4",level:3},{value:"Transaction\uff08MULTI/EXEC\uff09",id:"transactionmultiexec",level:3},{value:"Pipeline",id:"pipeline",level:3},{value:"Lua Script",id:"lua-script",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:2},{value:"1. \u5408\u7406\u6279\u91cf\u5927\u5c0f",id:"1-\u5408\u7406\u6279\u91cf\u5927\u5c0f",level:3},{value:"2. Pipeline + Transaction",id:"2-pipeline--transaction",level:3},{value:"3. Lua \u811a\u672c\u4f18\u5316",id:"3-lua-\u811a\u672c\u4f18\u5316",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"1. Pipeline \u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027",id:"1-pipeline-\u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027",level:3},{value:"2. Lua \u811a\u672c\u963b\u585e",id:"2-lua-\u811a\u672c\u963b\u585e",level:3},{value:"3. \u5185\u5b58\u5360\u7528",id:"3-\u5185\u5b58\u5360\u7528",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u6279\u91cf\u5bfc\u5165\u6570\u636e",id:"1-\u6279\u91cf\u5bfc\u5165\u6570\u636e",level:3},{value:"2. \u6279\u91cf\u5220\u9664",id:"2-\u6279\u91cf\u5220\u9664",level:3},{value:"3. \u539f\u5b50\u6027\u8ba1\u6570",id:"3-\u539f\u5b50\u6027\u8ba1\u6570",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function p(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"redis-\u7ba1\u9053\u548c\u6279\u91cf\u64cd\u4f5c",children:"Redis \u7ba1\u9053\u548c\u6279\u91cf\u64cd\u4f5c"})}),"\n",(0,s.jsx)(n.p,{children:"\u7ba1\u9053\uff08Pipeline\uff09\u548c\u6279\u91cf\u64cd\u4f5c\u662f Redis \u6027\u80fd\u4f18\u5316\u7684\u91cd\u8981\u624b\u6bb5\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"pipeline-\u7ba1\u9053",children:"Pipeline \u7ba1\u9053"}),"\n",(0,s.jsx)(n.h3,{id:"\u57fa\u672c\u6982\u5ff5",children:"\u57fa\u672c\u6982\u5ff5"}),"\n",(0,s.jsx)(n.p,{children:"Pipeline \u5141\u8bb8\u5ba2\u6237\u7aef\u4e00\u6b21\u6027\u53d1\u9001\u591a\u4e2a\u547d\u4ee4\uff0c\u7136\u540e\u4e00\u6b21\u6027\u8bfb\u53d6\u6240\u6709\u54cd\u5e94\uff0c\u51cf\u5c11\u7f51\u7edc\u5f80\u8fd4\u65f6\u95f4\uff08RTT\uff09\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u4f20\u7edf\u65b9\u5f0f\uff1a"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Client: SET key1 value1  \u2192  Server\nClient: \u2190 OK               Server\nClient: SET key2 value2  \u2192  Server\nClient: \u2190 OK               Server\n"})}),"\n",(0,s.jsx)(n.p,{children:"3 \u6b21\u7f51\u7edc\u5f80\u8fd4\uff0c\u8017\u65f6 = 3 * RTT"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pipeline \u65b9\u5f0f\uff1a"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Client: SET key1 value1  \u2192  Server\n        SET key2 value2  \u2192\n        SET key3 value3  \u2192\nClient: \u2190 OK               Server\n        \u2190 OK\n        \u2190 OK\n"})}),"\n",(0,s.jsx)(n.p,{children:"1 \u6b21\u7f51\u7edc\u5f80\u8fd4\uff0c\u8017\u65f6 = 1 * RTT"}),"\n",(0,s.jsx)(n.h3,{id:"java-\u5b9e\u73b0",children:"Java \u5b9e\u73b0"}),"\n",(0,s.jsx)(n.h4,{id:"jedis-pipeline",children:"Jedis Pipeline"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'import redis.clients.jedis.Jedis;\nimport redis.clients.jedis.Pipeline;\n\npublic class PipelineExample {\n    public static void main(String[] args) {\n        Jedis jedis = new Jedis("localhost", 6379);\n\n        // \u521b\u5efa Pipeline\n        Pipeline pipeline = jedis.pipelined();\n\n        // \u6279\u91cf\u6dfb\u52a0\u547d\u4ee4\n        for (int i = 0; i < 10000; i++) {\n            pipeline.set("key" + i, "value" + i);\n        }\n\n        // \u6267\u884c\u5e76\u83b7\u53d6\u7ed3\u679c\n        List<Object> results = pipeline.syncAndReturnAll();\n\n        System.out.println("\u6267\u884c\u4e86 " + results.size() + " \u4e2a\u547d\u4ee4");\n\n        jedis.close();\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"\u6027\u80fd\u5bf9\u6bd4",children:"\u6027\u80fd\u5bf9\u6bd4"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u666e\u901a\u65b9\u5f0f\nlong start = System.currentTimeMillis();\nfor (int i = 0; i < 10000; i++) {\n    jedis.set("key" + i, "value" + i);\n}\nlong normalTime = System.currentTimeMillis() - start;\nSystem.out.println("\u666e\u901a\u65b9\u5f0f: " + normalTime + "ms");\n\n// Pipeline \u65b9\u5f0f\nstart = System.currentTimeMillis();\nPipeline pipeline = jedis.pipelined();\nfor (int i = 0; i < 10000; i++) {\n    pipeline.set("key" + i, "value" + i);\n}\npipeline.sync();\nlong pipelineTime = System.currentTimeMillis() - start;\nSystem.out.println("Pipeline: " + pipelineTime + "ms");\nSystem.out.println("\u63d0\u5347: " + (normalTime / pipelineTime) + "x");\n'})}),"\n",(0,s.jsx)(n.h3,{id:"spring-redistemplate",children:"Spring RedisTemplate"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@Autowired\nprivate RedisTemplate<String, String> redisTemplate;\n\npublic void batchSet(Map<String, String> data) {\n    redisTemplate.executePipelined(new SessionCallback<Object>() {\n        @Override\n        public <K, V> Object execute(RedisOperations<K, V> operations) {\n            data.forEach((k, v) -> operations.opsForValue().set(k, v));\n            return null;\n        }\n    });\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6279\u91cf\u64cd\u4f5c\u547d\u4ee4",children:"\u6279\u91cf\u64cd\u4f5c\u547d\u4ee4"}),"\n",(0,s.jsx)(n.h3,{id:"mset---\u6279\u91cf\u8bbe\u7f6e",children:"MSET - \u6279\u91cf\u8bbe\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u4e00\u6b21\u8bbe\u7f6e\u591a\u4e2a\u952e\u503c\u5bf9\nMSET key1 "value1" key2 "value2" key3 "value3"\n\n# \u8fd4\u56de\uff1aOK\n'})}),"\n",(0,s.jsx)(n.h3,{id:"mget---\u6279\u91cf\u83b7\u53d6",children:"MGET - \u6279\u91cf\u83b7\u53d6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u4e00\u6b21\u83b7\u53d6\u591a\u4e2a\u503c\nMGET key1 key2 key3\n\n# \u8fd4\u56de\u6570\u7ec4\n1) "value1"\n2) "value2"\n3) "value3"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"msetnx---\u6279\u91cf\u8bbe\u7f6e\u4e0d\u5b58\u5728\u65f6",children:"MSETNX - \u6279\u91cf\u8bbe\u7f6e\uff08\u4e0d\u5b58\u5728\u65f6\uff09"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u6240\u6709\u952e\u90fd\u4e0d\u5b58\u5728\u65f6\u624d\u8bbe\u7f6e\nMSETNX key1 "value1" key2 "value2"\n\n# \u8fd4\u56de\uff1a1\uff08\u6210\u529f\uff09\u6216 0\uff08\u5931\u8d25\uff09\n'})}),"\n",(0,s.jsx)(n.h3,{id:"del---\u6279\u91cf\u5220\u9664",children:"DEL - \u6279\u91cf\u5220\u9664"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u5220\u9664\u591a\u4e2a\u952e\nDEL key1 key2 key3\n\n# \u8fd4\u56de\uff1a\u5220\u9664\u7684\u952e\u6570\u91cf\n"})}),"\n",(0,s.jsx)(n.h3,{id:"exists---\u6279\u91cf\u68c0\u67e5",children:"EXISTS - \u6279\u91cf\u68c0\u67e5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u68c0\u67e5\u591a\u4e2a\u952e\u662f\u5426\u5b58\u5728\nEXISTS key1 key2 key3\n\n# \u8fd4\u56de\uff1a\u5b58\u5728\u7684\u952e\u6570\u91cf\n"})}),"\n",(0,s.jsx)(n.h2,{id:"lua-\u811a\u672c",children:"Lua \u811a\u672c"}),"\n",(0,s.jsx)(n.h3,{id:"\u57fa\u672c\u7528\u6cd5",children:"\u57fa\u672c\u7528\u6cd5"}),"\n",(0,s.jsx)(n.p,{children:"Lua \u811a\u672c\u5728 Redis \u670d\u52a1\u5668\u7aef\u539f\u5b50\u6027\u6267\u884c\uff0c\u9002\u5408\u590d\u6742\u7684\u6279\u91cf\u64cd\u4f5c\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# EVAL \u547d\u4ee4\nEVAL script numkeys key [key ...] arg [arg ...]\n\n# \u793a\u4f8b\uff1a\u6279\u91cf\u8bbe\u7f6e\u5e76\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\nEVAL \"\n  for i, key in ipairs(KEYS) do\n    redis.call('SET', key, ARGV[i])\n    redis.call('EXPIRE', key, 3600)\n  end\n  return #KEYS\n\" 3 key1 key2 key3 value1 value2 value3\n"})}),"\n",(0,s.jsx)(n.h3,{id:"java-\u8c03\u7528-lua",children:"Java \u8c03\u7528 Lua"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u52a0\u8f7d\u811a\u672c\nString script =\n    "for i, key in ipairs(KEYS) do " +\n    "  redis.call(\'SET\', key, ARGV[i]) " +\n    "  redis.call(\'EXPIRE\', key, ARGV[#ARGV]) " +\n    "end " +\n    "return #KEYS";\n\n// \u6267\u884c\u811a\u672c\nList<String> keys = Arrays.asList("user:1", "user:2", "user:3");\nList<String> args = Arrays.asList("Alice", "Bob", "Charlie", "3600");\n\nObject result = jedis.eval(\n    script,\n    keys,\n    args\n);\n\nSystem.out.println("\u8bbe\u7f6e\u4e86 " + result + " \u4e2a\u952e");\n'})}),"\n",(0,s.jsx)(n.h3,{id:"script-load--evalsha",children:"SCRIPT LOAD / EVALSHA"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// \u52a0\u8f7d\u811a\u672c\uff0c\u8fd4\u56de SHA1\nString sha = jedis.scriptLoad(script);\n\n// \u4f7f\u7528 SHA1 \u6267\u884c\uff08\u6027\u80fd\u66f4\u597d\uff09\nObject result = jedis.evalsha(sha, keys, args);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u5b9e\u6218\u6848\u4f8b",children:"\u5b9e\u6218\u6848\u4f8b"}),"\n",(0,s.jsx)(n.h4,{id:"\u5206\u5e03\u5f0f\u9650\u6d41",children:"\u5206\u5e03\u5f0f\u9650\u6d41"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"-- \u9650\u6d41\u811a\u672c\nlocal key = KEYS[1]\nlocal limit = tonumber(ARGV[1])\nlocal expire = tonumber(ARGV[2])\n\nlocal current = redis.call('GET', key)\n\nif current and tonumber(current) >= limit then\n    return 0  -- \u8d85\u8fc7\u9650\u5236\nend\n\nredis.call('INCR', key)\nredis.call('EXPIRE', key, expire)\nreturn 1  -- \u5141\u8bb8\u8bbf\u95ee\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'String script =\n    "local key = KEYS[1] " +\n    "local limit = tonumber(ARGV[1]) " +\n    "local expire = tonumber(ARGV[2]) " +\n    "local current = redis.call(\'GET\', key) " +\n    "if current and tonumber(current) >= limit then " +\n    "  return 0 " +\n    "end " +\n    "redis.call(\'INCR\', key) " +\n    "redis.call(\'EXPIRE\', key, expire) " +\n    "return 1";\n\nLong allowed = (Long) jedis.eval(\n    script,\n    Collections.singletonList("rate:limit:user:1001"),\n    Arrays.asList("10", "60")  // 60\u79d2\u5185\u6700\u591a10\u6b21\n);\n\nif (allowed == 1) {\n    System.out.println("\u5141\u8bb8\u8bbf\u95ee");\n} else {\n    System.out.println("\u8bbf\u95ee\u8fc7\u4e8e\u9891\u7e41");\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"\u5e93\u5b58\u6263\u51cf",children:"\u5e93\u5b58\u6263\u51cf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"-- \u6263\u51cf\u5e93\u5b58\u811a\u672c\nlocal key = KEYS[1]\nlocal quantity = tonumber(ARGV[1])\n\nlocal stock = redis.call('GET', key)\nif not stock or tonumber(stock) < quantity then\n    return 0  -- \u5e93\u5b58\u4e0d\u8db3\nend\n\nredis.call('DECRBY', key, quantity)\nreturn 1  -- \u6263\u51cf\u6210\u529f\n"})}),"\n",(0,s.jsx)(n.h2,{id:"transaction-vs-pipeline-vs-lua",children:"Transaction vs Pipeline vs Lua"}),"\n",(0,s.jsx)(n.h3,{id:"\u7279\u6027\u5bf9\u6bd4",children:"\u7279\u6027\u5bf9\u6bd4"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u7279\u6027"}),(0,s.jsx)(n.th,{children:"Transaction"}),(0,s.jsx)(n.th,{children:"Pipeline"}),(0,s.jsx)(n.th,{children:"Lua Script"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u539f\u5b50\u6027"}),(0,s.jsx)(n.td,{children:"\u2705 \u4fdd\u8bc1"}),(0,s.jsx)(n.td,{children:"\u274c \u4e0d\u4fdd\u8bc1"}),(0,s.jsx)(n.td,{children:"\u2705 \u4fdd\u8bc1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u6027\u80fd\u63d0\u5347"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50"}),(0,s.jsx)(n.td,{children:"\u2b50\u2b50\u2b50"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u590d\u6742\u903b\u8f91"}),(0,s.jsx)(n.td,{children:"\u274c \u4e0d\u652f\u6301"}),(0,s.jsx)(n.td,{children:"\u274c \u4e0d\u652f\u6301"}),(0,s.jsx)(n.td,{children:"\u2705 \u652f\u6301"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u9002\u7528\u573a\u666f"}),(0,s.jsx)(n.td,{children:"\u7b80\u5355\u4e8b\u52a1"}),(0,s.jsx)(n.td,{children:"\u6279\u91cf\u64cd\u4f5c"}),(0,s.jsx)(n.td,{children:"\u590d\u6742\u539f\u5b50\u64cd\u4f5c"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"transactionmultiexec",children:"Transaction\uff08MULTI/EXEC\uff09"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"MULTI\nSET key1 value1\nSET key2 value2\nINCR counter\nEXEC\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7279\u70b9\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4fdd\u8bc1\u539f\u5b50\u6027"}),"\n",(0,s.jsx)(n.li,{children:"\u4e0d\u652f\u6301\u6761\u4ef6\u5224\u65ad"}),"\n",(0,s.jsx)(n.li,{children:"\u547d\u4ee4\u5728 EXEC \u65f6\u4e00\u6b21\u6027\u6267\u884c"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"pipeline",children:"Pipeline"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Pipeline \u53ea\u662f\u6279\u91cf\u53d1\u9001\uff0c\u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027\nSET key1 value1\nSET key2 value2\nINCR counter\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7279\u70b9\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u51cf\u5c11\u7f51\u7edc\u5f80\u8fd4"}),"\n",(0,s.jsx)(n.li,{children:"\u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027"}),"\n",(0,s.jsx)(n.li,{children:"\u6027\u80fd\u6700\u597d"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"lua-script",children:"Lua Script"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"local result = redis.call('GET', KEYS[1])\nif tonumber(result) > 100 then\n    redis.call('SET', KEYS[1], 0)\n    return 1\nend\nreturn 0\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7279\u70b9\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u539f\u5b50\u6027\u6267\u884c"}),"\n",(0,s.jsx)(n.li,{children:"\u652f\u6301\u590d\u6742\u903b\u8f91"}),"\n",(0,s.jsx)(n.li,{children:"\u670d\u52a1\u5668\u7aef\u6267\u884c"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u5408\u7406\u6279\u91cf\u5927\u5c0f",children:"1. \u5408\u7406\u6279\u91cf\u5927\u5c0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u4e0d\u8981\u4e00\u6b21\u53d1\u9001\u8fc7\u591a\u547d\u4ee4\nint BATCH_SIZE = 1000;\n\nfor (int i = 0; i < totalCount; i += BATCH_SIZE) {\n    Pipeline pipeline = jedis.pipelined();\n\n    for (int j = i; j < Math.min(i + BATCH_SIZE, totalCount); j++) {\n        pipeline.set("key" + j, "value" + j);\n    }\n\n    pipeline.sync();\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-pipeline--transaction",children:"2. Pipeline + Transaction"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u7ed3\u5408 Pipeline \u548c Transaction\nPipeline pipeline = jedis.pipelined();\npipeline.multi();  // \u5f00\u59cb\u4e8b\u52a1\n\nfor (int i = 0; i < 1000; i++) {\n    pipeline.set("key" + i, "value" + i);\n}\n\npipeline.exec();  // \u6267\u884c\u4e8b\u52a1\npipeline.sync();  // \u540c\u6b65Pipeline\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-lua-\u811a\u672c\u4f18\u5316",children:"3. Lua \u811a\u672c\u4f18\u5316"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"-- \u907f\u514d\u5728\u5faa\u73af\u4e2d\u8c03\u7528 redis.call\n-- \u4e0d\u597d\nfor i = 1, 10000 do\n    redis.call('SET', 'key' .. i, 'value')\nend\n\n-- \u66f4\u597d\uff1a\u6279\u91cf\u64cd\u4f5c\nlocal keys = {}\nlocal values = {}\nfor i = 1, 10000 do\n    table.insert(keys, 'key' .. i)\n    table.insert(values, 'value')\nend\nredis.call('MSET', unpack(keys), unpack(values))\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,s.jsx)(n.h3,{id:"1-pipeline-\u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027",children:"1. Pipeline \u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u53ef\u80fd\u90e8\u5206\u6210\u529f\u3001\u90e8\u5206\u5931\u8d25\nPipeline pipeline = jedis.pipelined();\npipeline.set("key1", "value1");  // \u53ef\u80fd\u6210\u529f\n// \u5982\u679c\u8fd9\u91cc\u7f51\u7edc\u65ad\u5f00...\npipeline.set("key2", "value2");  // \u53ef\u80fd\u5931\u8d25\npipeline.sync();\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-lua-\u811a\u672c\u963b\u585e",children:"2. Lua \u811a\u672c\u963b\u585e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:"-- \u907f\u514d\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u811a\u672c\n-- \u4e0d\u597d\uff1a\u6b7b\u5faa\u73af\nwhile true do\n    redis.call('INCR', 'counter')\nend\n\n-- \u597d\uff1a\u6709\u660e\u786e\u7684\u7ed3\u675f\u6761\u4ef6\nfor i = 1, 1000 do\n    redis.call('INCR', 'counter')\nend\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u5185\u5b58\u5360\u7528",children:"3. \u5185\u5b58\u5360\u7528"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// Pipeline \u5728\u5ba2\u6237\u7aef\u7f13\u51b2\u6240\u6709\u547d\u4ee4\n// \u907f\u514d\u4e00\u6b21\u53d1\u9001\u8fc7\u591a\nPipeline pipeline = jedis.pipelined();\nfor (int i = 0; i < 1000000; i++) {  // 100\u4e07\u6761\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u95ee\u9898\n    pipeline.set("key" + i, "value" + i);\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u6279\u91cf\u5bfc\u5165\u6570\u636e",children:"1. \u6279\u91cf\u5bfc\u5165\u6570\u636e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'public void importData(List<Map<String, String>> dataList) {\n    int BATCH_SIZE = 1000;\n\n    for (int i = 0; i < dataList.size(); i += BATCH_SIZE) {\n        Pipeline pipeline = jedis.pipelined();\n\n        int end = Math.min(i + BATCH_SIZE, dataList.size());\n        for (int j = i; j < end; j++) {\n            Map<String, String> data = dataList.get(j);\n            pipeline.hmset("user:" + data.get("id"), data);\n        }\n\n        pipeline.sync();\n\n        System.out.println("\u5df2\u5bfc\u5165: " + end + "/" + dataList.size());\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u6279\u91cf\u5220\u9664",children:"2. \u6279\u91cf\u5220\u9664"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"public void deleteByPattern(String pattern) {\n    Set<String> keys = jedis.keys(pattern);\n\n    if (!keys.isEmpty()) {\n        Pipeline pipeline = jedis.pipelined();\n        keys.forEach(pipeline::del);\n        pipeline.sync();\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u539f\u5b50\u6027\u8ba1\u6570",children:"3. \u539f\u5b50\u6027\u8ba1\u6570"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u4f7f\u7528 Lua \u4fdd\u8bc1\u539f\u5b50\u6027\nString script =\n    "local current = redis.call(\'INCRBY\', KEYS[1], ARGV[1]) " +\n    "if current > tonumber(ARGV[2]) then " +\n    "  redis.call(\'SET\', KEYS[1], ARGV[2]) " +\n    "  return ARGV[2] " +\n    "end " +\n    "return current";\n\nLong count = (Long) jedis.eval(\n    script,\n    Collections.singletonList("counter"),\n    Arrays.asList("10", "1000")  // \u589e\u52a010\uff0c\u6700\u5927\u503c1000\n);\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Pipeline \u9002\u5408\u6279\u91cf\u64cd\u4f5c\uff0c\u6027\u80fd\u63d0\u5347\u663e\u8457"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Lua \u811a\u672c\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u652f\u6301\u590d\u6742\u903b\u8f91"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 \u5408\u7406\u9009\u62e9\u6279\u91cf\u5927\u5c0f\uff0c\u907f\u514d\u5185\u5b58\u95ee\u9898"}),"\n",(0,s.jsx)(n.li,{children:"\u26a0\ufe0f Pipeline \u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027"}),"\n",(0,s.jsx)(n.li,{children:"\u26a0\ufe0f Lua \u811a\u672c\u4f1a\u963b\u585e Redis"}),"\n",(0,s.jsx)(n.li,{children:"\ud83d\udca1 \u6839\u636e\u573a\u666f\u9009\u62e9\u5408\u9002\u7684\u6279\u91cf\u64cd\u4f5c\u65b9\u5f0f"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u638c\u63e1\u8fd9\u4e9b\u6280\u5de7\uff0c\u80fd\u5927\u5e45\u63d0\u5347 Redis \u6027\u80fd\uff01"})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},48885:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>d});var l=i(99378);const s={},r=l.createContext(s);function a(e){const n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);
"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[763],{5968:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>o,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"springcloud/hystrix","title":"Hystrix \u7194\u65ad\u5668","description":"[!WARNING] > Hystrix \u5df2\u8fdb\u5165\u7ef4\u62a4\u6a21\u5f0f: Netflix \u5df2\u5ba3\u5e03 Hystrix \u8fdb\u5165\u7ef4\u62a4\u6a21\u5f0f\uff0c\u4e0d\u518d\u79ef\u6781\u5f00\u53d1\u65b0\u529f\u80fd\u3002\u63a8\u8350\u4f7f\u7528 Resilience4j \u6216 Sentinel \u4f5c\u4e3a\u66ff\u4ee3\u65b9\u6848\u3002\u672c\u6587\u6863\u4ecd\u7136\u4fdd\u7559\u7528\u4e8e\u5b66\u4e60\u548c\u7ef4\u62a4\u73b0\u6709\u7cfb\u7edf\u3002","source":"@site/docs/springcloud/hystrix.md","sourceDirName":"springcloud","slug":"/springcloud/hystrix","permalink":"/docs/springcloud/hystrix","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/springcloud/hystrix.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"title":"Hystrix \u7194\u65ad\u5668","sidebar_label":"Hystrix","sidebar_position":8},"sidebar":"springcloud","previous":{"title":"Stream \u6d88\u606f\u9a71\u52a8","permalink":"/docs/springcloud/stream"},"next":{"title":"Sleuth","permalink":"/docs/springcloud/sleuth"}}');var s=r(22714),l=r(48885);const t={title:"Hystrix \u7194\u65ad\u5668",sidebar_label:"Hystrix",sidebar_position:8},d="Hystrix \u7194\u65ad\u5668",a={},c=[{value:"1. Hystrix \u7b80\u4ecb",id:"1-hystrix-\u7b80\u4ecb",level:2},{value:"\u4ec0\u4e48\u662f Hystrix\uff1f",id:"\u4ec0\u4e48\u662f-hystrix",level:3},{value:"\u6838\u5fc3\u529f\u80fd",id:"\u6838\u5fc3\u529f\u80fd",level:3},{value:"\u89e3\u51b3\u7684\u95ee\u9898",id:"\u89e3\u51b3\u7684\u95ee\u9898",level:3},{value:"2. \u5feb\u901f\u5f00\u59cb",id:"2-\u5feb\u901f\u5f00\u59cb",level:2},{value:"\u6dfb\u52a0\u4f9d\u8d56",id:"\u6dfb\u52a0\u4f9d\u8d56",level:3},{value:"\u542f\u7528 Hystrix",id:"\u542f\u7528-hystrix",level:3},{value:"\u4f7f\u7528 @HystrixCommand",id:"\u4f7f\u7528-hystrixcommand",level:3},{value:"3. \u7194\u65ad\u673a\u5236",id:"3-\u7194\u65ad\u673a\u5236",level:2},{value:"\u7194\u65ad\u5668\u72b6\u6001",id:"\u7194\u65ad\u5668\u72b6\u6001",level:3},{value:"\u4e09\u79cd\u72b6\u6001",id:"\u4e09\u79cd\u72b6\u6001",level:3},{value:"\u7194\u65ad\u914d\u7f6e",id:"\u7194\u65ad\u914d\u7f6e",level:3},{value:"4. \u964d\u7ea7\u7b56\u7565",id:"4-\u964d\u7ea7\u7b56\u7565",level:2},{value:"\u57fa\u672c\u964d\u7ea7",id:"\u57fa\u672c\u964d\u7ea7",level:3},{value:"\u964d\u7ea7\u94fe",id:"\u964d\u7ea7\u94fe",level:3},{value:"\u83b7\u53d6\u5f02\u5e38\u4fe1\u606f",id:"\u83b7\u53d6\u5f02\u5e38\u4fe1\u606f",level:3},{value:"5. \u9694\u79bb\u7b56\u7565",id:"5-\u9694\u79bb\u7b56\u7565",level:2},{value:"\u7ebf\u7a0b\u6c60\u9694\u79bb\uff08\u9ed8\u8ba4\uff09",id:"\u7ebf\u7a0b\u6c60\u9694\u79bb\u9ed8\u8ba4",level:3},{value:"\u4fe1\u53f7\u91cf\u9694\u79bb",id:"\u4fe1\u53f7\u91cf\u9694\u79bb",level:3},{value:"\u7ebf\u7a0b\u6c60 vs \u4fe1\u53f7\u91cf",id:"\u7ebf\u7a0b\u6c60-vs-\u4fe1\u53f7\u91cf",level:3},{value:"6. \u8d85\u65f6\u914d\u7f6e",id:"6-\u8d85\u65f6\u914d\u7f6e",level:2},{value:"7. \u8bf7\u6c42\u5408\u5e76",id:"7-\u8bf7\u6c42\u5408\u5e76",level:2},{value:"\u51cf\u5c11\u8bf7\u6c42\u6b21\u6570",id:"\u51cf\u5c11\u8bf7\u6c42\u6b21\u6570",level:3},{value:"8. \u8bf7\u6c42\u7f13\u5b58",id:"8-\u8bf7\u6c42\u7f13\u5b58",level:2},{value:"9. \u914d\u7f6e\u65b9\u5f0f",id:"9-\u914d\u7f6e\u65b9\u5f0f",level:2},{value:"\u5168\u5c40\u914d\u7f6e",id:"\u5168\u5c40\u914d\u7f6e",level:3},{value:"\u9488\u5bf9\u65b9\u6cd5\u914d\u7f6e",id:"\u9488\u5bf9\u65b9\u6cd5\u914d\u7f6e",level:3},{value:"10. Dashboard \u76d1\u63a7",id:"10-dashboard-\u76d1\u63a7",level:2},{value:"\u6dfb\u52a0\u4f9d\u8d56",id:"\u6dfb\u52a0\u4f9d\u8d56-1",level:3},{value:"\u542f\u7528 Dashboard",id:"\u542f\u7528-dashboard",level:3},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:3},{value:"11. Turbine \u805a\u5408\u76d1\u63a7",id:"11-turbine-\u805a\u5408\u76d1\u63a7",level:2},{value:"\u6dfb\u52a0\u4f9d\u8d56",id:"\u6dfb\u52a0\u4f9d\u8d56-2",level:3},{value:"\u542f\u7528 Turbine",id:"\u542f\u7528-turbine",level:3},{value:"\u914d\u7f6e",id:"\u914d\u7f6e-1",level:3},{value:"12. \u6700\u4f73\u5b9e\u8df5",id:"12-\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u8d85\u65f6\u914d\u7f6e",id:"\u8d85\u65f6\u914d\u7f6e",level:3},{value:"\u964d\u7ea7\u7b56\u7565",id:"\u964d\u7ea7\u7b56\u7565",level:3},{value:"\u9694\u79bb\u7b56\u7565\u9009\u62e9",id:"\u9694\u79bb\u7b56\u7565\u9009\u62e9",level:3},{value:"\u76d1\u63a7\u544a\u8b66",id:"\u76d1\u63a7\u544a\u8b66",level:3},{value:"13. \u5e38\u89c1\u95ee\u9898",id:"13-\u5e38\u89c1\u95ee\u9898",level:2},{value:"\u964d\u7ea7\u65b9\u6cd5\u4e0d\u751f\u6548",id:"\u964d\u7ea7\u65b9\u6cd5\u4e0d\u751f\u6548",level:3},{value:"\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e",id:"\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e",level:3},{value:"\u7ebf\u7a0b\u6c60\u9694\u79bb\u5bfc\u81f4 ThreadLocal \u4e22\u5931",id:"\u7ebf\u7a0b\u6c60\u9694\u79bb\u5bfc\u81f4-threadlocal-\u4e22\u5931",level:3},{value:"14. \u66ff\u4ee3\u65b9\u6848",id:"14-\u66ff\u4ee3\u65b9\u6848",level:2},{value:"Resilience4j",id:"resilience4j",level:3},{value:"Sentinel",id:"sentinel",level:3},{value:"15. \u603b\u7ed3",id:"15-\u603b\u7ed3",level:2}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"hystrix-\u7194\u65ad\u5668",children:"Hystrix \u7194\u65ad\u5668"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["[!WARNING] > ",(0,s.jsx)(n.strong,{children:"Hystrix \u5df2\u8fdb\u5165\u7ef4\u62a4\u6a21\u5f0f"}),": Netflix \u5df2\u5ba3\u5e03 Hystrix \u8fdb\u5165\u7ef4\u62a4\u6a21\u5f0f\uff0c\u4e0d\u518d\u79ef\u6781\u5f00\u53d1\u65b0\u529f\u80fd\u3002\u63a8\u8350\u4f7f\u7528 Resilience4j \u6216 Sentinel \u4f5c\u4e3a\u66ff\u4ee3\u65b9\u6848\u3002\u672c\u6587\u6863\u4ecd\u7136\u4fdd\u7559\u7528\u4e8e\u5b66\u4e60\u548c\u7ef4\u62a4\u73b0\u6709\u7cfb\u7edf\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["[!TIP] > ",(0,s.jsx)(n.strong,{children:"\u670d\u52a1\u5bb9\u9519\u4fdd\u62a4"}),": Hystrix \u63d0\u4f9b\u7194\u65ad\u3001\u964d\u7ea7\u3001\u9650\u6d41\u3001\u9694\u79bb\u7b49\u673a\u5236\uff0c\u4fdd\u62a4\u5fae\u670d\u52a1\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"1-hystrix-\u7b80\u4ecb",children:"1. Hystrix \u7b80\u4ecb"}),"\n",(0,s.jsx)(n.h3,{id:"\u4ec0\u4e48\u662f-hystrix",children:"\u4ec0\u4e48\u662f Hystrix\uff1f"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Hystrix"})," \u662f Netflix \u5f00\u6e90\u7684\u5bb9\u9519\u7ba1\u7406\u5de5\u5177\uff0c\u7528\u4e8e\u5904\u7406\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u5ef6\u8fdf\u548c\u5bb9\u9519\u95ee\u9898\uff0c\u9632\u6b62\u7ea7\u8054\u6545\u969c\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u6838\u5fc3\u529f\u80fd",children:"\u6838\u5fc3\u529f\u80fd"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u7194\u65ad"})," - \u5f53\u5931\u8d25\u7387\u8fbe\u5230\u9608\u503c\u65f6\uff0c\u5feb\u901f\u5931\u8d25"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u964d\u7ea7"})," - \u63d0\u4f9b\u5907\u7528\u54cd\u5e94"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u9650\u6d41"})," - \u63a7\u5236\u5e76\u53d1\u8bf7\u6c42\u6570"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u9694\u79bb"})," - \u7ebf\u7a0b\u6c60\u6216\u4fe1\u53f7\u91cf\u9694\u79bb"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u76d1\u63a7"})," - \u5b9e\u65f6\u76d1\u63a7\u548c\u5ea6\u91cf"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u89e3\u51b3\u7684\u95ee\u9898",children:"\u89e3\u51b3\u7684\u95ee\u9898"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u670d\u52a1A \u2192 \u670d\u52a1B \u2192 \u670d\u52a1C\uff08\u6545\u969c\uff09\n        \u2193\n    \u5927\u91cf\u8bf7\u6c42\u5806\u79ef\n        \u2193\n    \u670d\u52a1B\u8d44\u6e90\u8017\u5c3d\n        \u2193\n    \u670d\u52a1A\u4e5f\u53d7\u5f71\u54cd\n        \u2193\n    \u7ea7\u8054\u6545\u969c\n"})}),"\n",(0,s.jsx)(n.h2,{id:"2-\u5feb\u901f\u5f00\u59cb",children:"2. \u5feb\u901f\u5f00\u59cb"}),"\n",(0,s.jsx)(n.h3,{id:"\u6dfb\u52a0\u4f9d\u8d56",children:"\u6dfb\u52a0\u4f9d\u8d56"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>\n</dependency>\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u542f\u7528-hystrix",children:"\u542f\u7528 Hystrix"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@SpringBootApplication\n@EnableCircuitBreaker\npublic class OrderServiceApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(OrderServiceApplication.class, args);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-hystrixcommand",children:"\u4f7f\u7528 @HystrixCommand"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Service\npublic class UserService {\n\n    @Autowired\n    private RestTemplate restTemplate;\n\n    @HystrixCommand(fallbackMethod = "getDefaultUser")\n    public User getUser(Long id) {\n        String url = "http://user-service/users/" + id;\n        return restTemplate.getForObject(url, User.class);\n    }\n\n    // \u964d\u7ea7\u65b9\u6cd5\n    public User getDefaultUser(Long id) {\n        User user = new User();\n        user.setId(id);\n        user.setName("\u9ed8\u8ba4\u7528\u6237");\n        return user;\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"3-\u7194\u65ad\u673a\u5236",children:"3. \u7194\u65ad\u673a\u5236"}),"\n",(0,s.jsx)(n.h3,{id:"\u7194\u65ad\u5668\u72b6\u6001",children:"\u7194\u65ad\u5668\u72b6\u6001"}),"\n",(0,s.jsx)(n.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e Closed\n    Closed --\x3e Open: \u5931\u8d25\u7387\u8fbe\u5230\u9608\u503c\n    Open --\x3e HalfOpen: \u7b49\u5f85\u65f6\u95f4\u540e\n    HalfOpen --\x3e Closed: \u8bf7\u6c42\u6210\u529f\n    HalfOpen --\x3e Open: \u8bf7\u6c42\u5931\u8d25"}),"\n",(0,s.jsx)(n.h3,{id:"\u4e09\u79cd\u72b6\u6001",children:"\u4e09\u79cd\u72b6\u6001"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5173\u95ed\uff08Closed\uff09"})," - \u6b63\u5e38\u8c03\u7528\uff0c\u7edf\u8ba1\u5931\u8d25\u7387"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u6253\u5f00\uff08Open\uff09"})," - \u5feb\u901f\u5931\u8d25\uff0c\u8fd4\u56de\u964d\u7ea7\u7ed3\u679c"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u534a\u5f00\uff08Half-Open\uff09"})," - \u5c1d\u8bd5\u6062\u590d\uff0c\u53d1\u9001\u5c11\u91cf\u8bf7\u6c42\u6d4b\u8bd5"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u7194\u65ad\u914d\u7f6e",children:"\u7194\u65ad\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@HystrixCommand(\n    fallbackMethod = "getDefaultUser",\n    commandProperties = {\n        // \u6ed1\u52a8\u7a97\u53e3\u5927\u5c0f\uff08\u8bf7\u6c42\u6570\uff09\n        @HystrixProperty(name = "circuitBreaker.requestVolumeThreshold", value = "20"),\n        // \u9519\u8bef\u7387\u9608\u503c\uff08\u767e\u5206\u6bd4\uff09\n        @HystrixProperty(name = "circuitBreaker.errorThresholdPercentage", value = "50"),\n        // \u7194\u65ad\u540e\u7b49\u5f85\u65f6\u95f4\uff08\u6beb\u79d2\uff09\n        @HystrixProperty(name = "circuitBreaker.sleepWindowInMilliseconds", value = "5000"),\n        // \u542f\u7528\u7194\u65ad\u5668\n        @HystrixProperty(name = "circuitBreaker.enabled", value = "true")\n    }\n)\npublic User getUser(Long id) {\n    // ...\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"4-\u964d\u7ea7\u7b56\u7565",children:"4. \u964d\u7ea7\u7b56\u7565"}),"\n",(0,s.jsx)(n.h3,{id:"\u57fa\u672c\u964d\u7ea7",children:"\u57fa\u672c\u964d\u7ea7"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@HystrixCommand(fallbackMethod = "getDefaultUser")\npublic User getUser(Long id) {\n    return restTemplate.getForObject("http://user-service/users/" + id, User.class);\n}\n\npublic User getDefaultUser(Long id) {\n    return new User(id, "\u9ed8\u8ba4\u7528\u6237");\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u964d\u7ea7\u94fe",children:"\u964d\u7ea7\u94fe"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@HystrixCommand(\n    fallbackMethod = "fallback1",\n    commandProperties = {\n        @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds", value = "1000")\n    }\n)\npublic String getData() {\n    // \u4e3b\u65b9\u6cd5\n    return "data";\n}\n\n@HystrixCommand(fallbackMethod = "fallback2")\npublic String fallback1() {\n    // \u7b2c\u4e00\u7ea7\u964d\u7ea7\n    return "fallback1";\n}\n\npublic String fallback2() {\n    // \u6700\u7ec8\u964d\u7ea7\n    return "fallback2";\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u83b7\u53d6\u5f02\u5e38\u4fe1\u606f",children:"\u83b7\u53d6\u5f02\u5e38\u4fe1\u606f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@HystrixCommand(fallbackMethod = "getDefaultUser")\npublic User getUser(Long id) {\n    return restTemplate.getForObject("http://user-service/users/" + id, User.class);\n}\n\npublic User getDefaultUser(Long id, Throwable throwable) {\n    log.error("\u83b7\u53d6\u7528\u6237\u5931\u8d25: {}", throwable.getMessage());\n    return new User(id, "\u9ed8\u8ba4\u7528\u6237");\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"5-\u9694\u79bb\u7b56\u7565",children:"5. \u9694\u79bb\u7b56\u7565"}),"\n",(0,s.jsx)(n.h3,{id:"\u7ebf\u7a0b\u6c60\u9694\u79bb\u9ed8\u8ba4",children:"\u7ebf\u7a0b\u6c60\u9694\u79bb\uff08\u9ed8\u8ba4\uff09"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@HystrixCommand(\n    fallbackMethod = "getDefaultUser",\n    threadPoolKey = "userServiceThreadPool",\n    threadPoolProperties = {\n        // \u6838\u5fc3\u7ebf\u7a0b\u6570\n        @HystrixProperty(name = "coreSize", value = "10"),\n        // \u6700\u5927\u961f\u5217\u957f\u5ea6\n        @HystrixProperty(name = "maxQueueSize", value = "100"),\n        // \u961f\u5217\u62d2\u7edd\u9608\u503c\n        @HystrixProperty(name = "queueSizeRejectionThreshold", value = "80"),\n        // \u7ebf\u7a0b\u5b58\u6d3b\u65f6\u95f4\uff08\u5206\u949f\uff09\n        @HystrixProperty(name = "keepAliveTimeMinutes", value = "2")\n    }\n)\npublic User getUser(Long id) {\n    return restTemplate.getForObject("http://user-service/users/" + id, User.class);\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u4fe1\u53f7\u91cf\u9694\u79bb",children:"\u4fe1\u53f7\u91cf\u9694\u79bb"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@HystrixCommand(\n    fallbackMethod = "getDefaultUser",\n    commandProperties = {\n        // \u4f7f\u7528\u4fe1\u53f7\u91cf\u9694\u79bb\n        @HystrixProperty(name = "execution.isolation.strategy", value = "SEMAPHORE"),\n        // \u4fe1\u53f7\u91cf\u6570\u91cf\n        @HystrixProperty(name = "execution.isolation.semaphore.maxConcurrentRequests", value = "10")\n    }\n)\npublic User getUser(Long id) {\n    return restTemplate.getForObject("http://user-service/users/" + id, User.class);\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u7ebf\u7a0b\u6c60-vs-\u4fe1\u53f7\u91cf",children:"\u7ebf\u7a0b\u6c60 vs \u4fe1\u53f7\u91cf"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u7279\u6027"}),(0,s.jsx)(n.th,{children:"\u7ebf\u7a0b\u6c60\u9694\u79bb"}),(0,s.jsx)(n.th,{children:"\u4fe1\u53f7\u91cf\u9694\u79bb"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u9694\u79bb\u6027"}),(0,s.jsx)(n.td,{children:"\u5f3a"}),(0,s.jsx)(n.td,{children:"\u5f31"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u6027\u80fd\u5f00\u9500"}),(0,s.jsx)(n.td,{children:"\u9ad8\uff08\u7ebf\u7a0b\u5207\u6362\uff09"}),(0,s.jsx)(n.td,{children:"\u4f4e"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u8d85\u65f6\u652f\u6301"}),(0,s.jsx)(n.td,{children:"\u652f\u6301"}),(0,s.jsx)(n.td,{children:"\u4e0d\u652f\u6301"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u9002\u7528\u573a\u666f"}),(0,s.jsx)(n.td,{children:"\u7f51\u7edc\u8bf7\u6c42"}),(0,s.jsx)(n.td,{children:"\u5185\u5b58\u64cd\u4f5c"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"6-\u8d85\u65f6\u914d\u7f6e",children:"6. \u8d85\u65f6\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@HystrixCommand(\n    fallbackMethod = "getDefaultUser",\n    commandProperties = {\n        // \u542f\u7528\u8d85\u65f6\n        @HystrixProperty(name = "execution.timeout.enabled", value = "true"),\n        // \u8d85\u65f6\u65f6\u95f4\uff08\u6beb\u79d2\uff09\n        @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds", value = "3000")\n    }\n)\npublic User getUser(Long id) {\n    return restTemplate.getForObject("http://user-service/users/" + id, User.class);\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"7-\u8bf7\u6c42\u5408\u5e76",children:"7. \u8bf7\u6c42\u5408\u5e76"}),"\n",(0,s.jsx)(n.h3,{id:"\u51cf\u5c11\u8bf7\u6c42\u6b21\u6570",children:"\u51cf\u5c11\u8bf7\u6c42\u6b21\u6570"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@HystrixCollapser(\n    batchMethod = "getUsersBatch",\n    collapserProperties = {\n        // \u5408\u5e76\u65f6\u95f4\u7a97\u53e3\uff08\u6beb\u79d2\uff09\n        @HystrixProperty(name = "timerDelayInMilliseconds", value = "100"),\n        // \u6700\u5927\u5408\u5e76\u8bf7\u6c42\u6570\n        @HystrixProperty(name = "maxRequestsInBatch", value = "100")\n    }\n)\npublic Future<User> getUser(Long id) {\n    return null;\n}\n\n@HystrixCommand\npublic List<User> getUsersBatch(List<Long> ids) {\n    String url = "http://user-service/users?ids=" + String.join(",", ids.toString());\n    return restTemplate.getForObject(url, List.class);\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"8-\u8bf7\u6c42\u7f13\u5b58",children:"8. \u8bf7\u6c42\u7f13\u5b58"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Service\npublic class UserService {\n\n    @CacheResult\n    @HystrixCommand\n    public User getUser(@CacheKey Long id) {\n        return restTemplate.getForObject("http://user-service/users/" + id, User.class);\n    }\n\n    @CacheRemove(commandKey = "getUser")\n    @HystrixCommand\n    public void updateUser(@CacheKey Long id, User user) {\n        restTemplate.put("http://user-service/users/" + id, user);\n    }\n}\n\n// \u4f7f\u7528\npublic void demo() {\n    HystrixRequestContext context = HystrixRequestContext.initializeContext();\n    try {\n        User user1 = userService.getUser(1L); // \u8c03\u7528\u8fdc\u7a0b\u670d\u52a1\n        User user2 = userService.getUser(1L); // \u4f7f\u7528\u7f13\u5b58\n    } finally {\n        context.shutdown();\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"9-\u914d\u7f6e\u65b9\u5f0f",children:"9. \u914d\u7f6e\u65b9\u5f0f"}),"\n",(0,s.jsx)(n.h3,{id:"\u5168\u5c40\u914d\u7f6e",children:"\u5168\u5c40\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"hystrix:\n  command:\n    default:\n      execution:\n        isolation:\n          strategy: THREAD\n          thread:\n            timeoutInMilliseconds: 3000\n      circuitBreaker:\n        enabled: true\n        requestVolumeThreshold: 20\n        errorThresholdPercentage: 50\n        sleepWindowInMilliseconds: 5000\n\n  threadpool:\n    default:\n      coreSize: 10\n      maxQueueSize: 100\n      queueSizeRejectionThreshold: 80\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u9488\u5bf9\u65b9\u6cd5\u914d\u7f6e",children:"\u9488\u5bf9\u65b9\u6cd5\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"hystrix:\n  command:\n    getUser: # HystrixCommand \u7684 commandKey\n      execution:\n        isolation:\n          thread:\n            timeoutInMilliseconds: 5000\n"})}),"\n",(0,s.jsx)(n.h2,{id:"10-dashboard-\u76d1\u63a7",children:"10. Dashboard \u76d1\u63a7"}),"\n",(0,s.jsx)(n.h3,{id:"\u6dfb\u52a0\u4f9d\u8d56-1",children:"\u6dfb\u52a0\u4f9d\u8d56"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-netflix-hystrix-dashboard</artifactId>\n</dependency>\n\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-actuator</artifactId>\n</dependency>\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u542f\u7528-dashboard",children:"\u542f\u7528 Dashboard"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@SpringBootApplication\n@EnableHystrixDashboard\npublic class HystrixDashboardApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(HystrixDashboardApplication.class, args);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"management:\n  endpoints:\n    web:\n      exposure:\n        include: hystrix.stream\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u8bbf\u95ee\uff1a",(0,s.jsx)(n.code,{children:"http://localhost:8080/hystrix"})]}),"\n",(0,s.jsxs)(n.p,{children:["\u8f93\u5165\u76d1\u63a7\u6d41\u5730\u5740\uff1a",(0,s.jsx)(n.code,{children:"http://localhost:8080/actuator/hystrix.stream"})]}),"\n",(0,s.jsx)(n.h2,{id:"11-turbine-\u805a\u5408\u76d1\u63a7",children:"11. Turbine \u805a\u5408\u76d1\u63a7"}),"\n",(0,s.jsx)(n.h3,{id:"\u6dfb\u52a0\u4f9d\u8d56-2",children:"\u6dfb\u52a0\u4f9d\u8d56"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-netflix-turbine</artifactId>\n</dependency>\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u542f\u7528-turbine",children:"\u542f\u7528 Turbine"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@SpringBootApplication\n@EnableTurbine\npublic class TurbineApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(TurbineApplication.class, args);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u914d\u7f6e-1",children:"\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"turbine:\n  # \u805a\u5408\u7684\u670d\u52a1\u540d\n  app-config: user-service,order-service\n  # \u96c6\u7fa4\u540d\u79f0\n  cluster-name-expression: \"'default'\"\n  # \u805a\u5408\u540c\u540d\u6307\u6807\n  combine-host-port: true\n\neureka:\n  client:\n    service-url:\n      defaultZone: http://localhost:8761/eureka/\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u8bbf\u95ee\uff1a",(0,s.jsx)(n.code,{children:"http://localhost:8080/turbine.stream"})]}),"\n",(0,s.jsx)(n.h2,{id:"12-\u6700\u4f73\u5b9e\u8df5",children:"12. \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsx)(n.h3,{id:"\u8d85\u65f6\u914d\u7f6e",children:"\u8d85\u65f6\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Hystrix \u8d85\u65f6 > Ribbon \u8d85\u65f6 + \u91cd\u8bd5\u65f6\u95f4\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"hystrix:\n  command:\n    default:\n      execution:\n        isolation:\n          thread:\n            timeoutInMilliseconds: 10000\n\nribbon:\n  ConnectTimeout: 1000\n  ReadTimeout: 3000\n  MaxAutoRetries: 1\n  MaxAutoRetriesNextServer: 1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u964d\u7ea7\u7b56\u7565",children:"\u964d\u7ea7\u7b56\u7565"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u8fd4\u56de\u9ed8\u8ba4\u503c"}),"\n",(0,s.jsx)(n.li,{children:"\u8fd4\u56de\u7f13\u5b58\u6570\u636e"}),"\n",(0,s.jsx)(n.li,{children:"\u8fd4\u56de\u7a7a\u6570\u636e\u6216\u63d0\u793a\u4fe1\u606f"}),"\n",(0,s.jsx)(n.li,{children:"\u964d\u7ea7\u903b\u8f91\u8981\u7b80\u5355\u5feb\u901f"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u9694\u79bb\u7b56\u7565\u9009\u62e9",children:"\u9694\u79bb\u7b56\u7565\u9009\u62e9"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u7f51\u7edc\u8bf7\u6c42"})," - \u4f7f\u7528\u7ebf\u7a0b\u6c60\u9694\u79bb"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5185\u5b58\u64cd\u4f5c"})," - \u4f7f\u7528\u4fe1\u53f7\u91cf\u9694\u79bb"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u9ad8\u5e76\u53d1"})," - \u9002\u5f53\u589e\u52a0\u7ebf\u7a0b\u6c60\u5927\u5c0f"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u76d1\u63a7\u544a\u8b66",children:"\u76d1\u63a7\u544a\u8b66"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u76d1\u63a7\u5931\u8d25\u7387"}),"\n",(0,s.jsx)(n.li,{children:"\u76d1\u63a7\u54cd\u5e94\u65f6\u95f4"}),"\n",(0,s.jsx)(n.li,{children:"\u76d1\u63a7\u7194\u65ad\u5668\u72b6\u6001"}),"\n",(0,s.jsx)(n.li,{children:"\u8bbe\u7f6e\u5408\u7406\u7684\u544a\u8b66\u9608\u503c"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"13-\u5e38\u89c1\u95ee\u9898",children:"13. \u5e38\u89c1\u95ee\u9898"}),"\n",(0,s.jsx)(n.h3,{id:"\u964d\u7ea7\u65b9\u6cd5\u4e0d\u751f\u6548",children:"\u964d\u7ea7\u65b9\u6cd5\u4e0d\u751f\u6548"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u68c0\u67e5\u9879"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u964d\u7ea7\u65b9\u6cd5\u7b7e\u540d\u662f\u5426\u5339\u914d"}),"\n",(0,s.jsx)(n.li,{children:"\u964d\u7ea7\u65b9\u6cd5\u662f\u5426\u5728\u540c\u4e00\u4e2a\u7c7b\u4e2d"}),"\n",(0,s.jsx)(n.li,{children:"\u662f\u5426\u629b\u51fa\u4e86 HystrixBadRequestException"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e",children:"\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u6ce8\u610f"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Hystrix \u8d85\u65f6\u8981\u5927\u4e8e Ribbon \u8d85\u65f6"}),"\n",(0,s.jsx)(n.li,{children:"\u8003\u8651\u91cd\u8bd5\u6b21\u6570"}),"\n",(0,s.jsx)(n.li,{children:"\u4e0d\u540c\u63a5\u53e3\u8bbe\u7f6e\u4e0d\u540c\u8d85\u65f6\u65f6\u95f4"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u7ebf\u7a0b\u6c60\u9694\u79bb\u5bfc\u81f4-threadlocal-\u4e22\u5931",children:"\u7ebf\u7a0b\u6c60\u9694\u79bb\u5bfc\u81f4 ThreadLocal \u4e22\u5931"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u89e3\u51b3"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528\u4fe1\u53f7\u91cf\u9694\u79bb"}),"\n",(0,s.jsx)(n.li,{children:"\u6216\u4f7f\u7528 HystrixRequestContext \u4f20\u9012\u4e0a\u4e0b\u6587"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"14-\u66ff\u4ee3\u65b9\u6848",children:"14. \u66ff\u4ee3\u65b9\u6848"}),"\n",(0,s.jsx)(n.h3,{id:"resilience4j",children:"Resilience4j"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>io.github.resilience4j</groupId>\n    <artifactId>resilience4j-spring-boot2</artifactId>\n</dependency>\n"})}),"\n",(0,s.jsx)(n.h3,{id:"sentinel",children:"Sentinel"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>\n</dependency>\n"})}),"\n",(0,s.jsx)(n.h2,{id:"15-\u603b\u7ed3",children:"15. \u603b\u7ed3"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u529f\u80fd"}),(0,s.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u7194\u65ad"}),(0,s.jsx)(n.td,{children:"\u5feb\u901f\u5931\u8d25\uff0c\u9632\u6b62\u7ea7\u8054\u6545\u969c"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u964d\u7ea7"}),(0,s.jsx)(n.td,{children:"\u63d0\u4f9b\u5907\u7528\u54cd\u5e94"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u9694\u79bb"}),(0,s.jsx)(n.td,{children:"\u7ebf\u7a0b\u6c60\u6216\u4fe1\u53f7\u91cf\u9694\u79bb"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u9650\u6d41"}),(0,s.jsx)(n.td,{children:"\u63a7\u5236\u5e76\u53d1\u8bf7\u6c42\u6570"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u76d1\u63a7"}),(0,s.jsx)(n.td,{children:"Dashboard \u5b9e\u65f6\u76d1\u63a7"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u5173\u952e\u8981\u70b9"}),"\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Hystrix \u63d0\u4f9b\u5b8c\u6574\u7684\u5bb9\u9519\u89e3\u51b3\u65b9\u6848"}),"\n",(0,s.jsx)(n.li,{children:"\u7194\u65ad\u5668\u4fdd\u62a4\u7cfb\u7edf\u514d\u53d7\u7ea7\u8054\u6545\u969c"}),"\n",(0,s.jsx)(n.li,{children:"\u5408\u7406\u914d\u7f6e\u8d85\u65f6\u548c\u9694\u79bb\u7b56\u7565"}),"\n",(0,s.jsx)(n.li,{children:"\u5efa\u8bae\u8fc1\u79fb\u5230 Resilience4j \u6216 Sentinel"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u4e0b\u4e00\u6b65"}),"\uff1a\u5b66\u4e60 ",(0,s.jsx)(n.a,{href:"/docs/springcloud/sleuth",children:"Sleuth \u94fe\u8def\u8ffd\u8e2a"})]})]})}function o(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},48885:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>d});var i=r(99378);const s={},l=i.createContext(s);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);
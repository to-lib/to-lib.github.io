"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[72951],{48885:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>d});var l=i(99378);const r={},a=l.createContext(r);function s(e){const n=l.useContext(a);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),l.createElement(a.Provider,{value:n},e.children)}},54660:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"nginx/faq","title":"\u5e38\u89c1\u95ee\u9898","description":"Nginx \u5e38\u89c1\u95ee\u9898\u4e0e\u89e3\u51b3\u65b9\u6848","source":"@site/docs/nginx/faq.md","sourceDirName":"nginx","slug":"/nginx/faq","permalink":"/docs/nginx/faq","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/nginx/faq.md","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12,"title":"\u5e38\u89c1\u95ee\u9898","description":"Nginx \u5e38\u89c1\u95ee\u9898\u4e0e\u89e3\u51b3\u65b9\u6848"},"sidebar":"nginx","previous":{"title":"\u5feb\u901f\u53c2\u8003","permalink":"/docs/nginx/quick-reference"},"next":{"title":"\u9762\u8bd5\u95ee\u9898","permalink":"/docs/interview/nginx-interview-questions"}}');var r=i(22714),a=i(48885);const s={sidebar_position:12,title:"\u5e38\u89c1\u95ee\u9898",description:"Nginx \u5e38\u89c1\u95ee\u9898\u4e0e\u89e3\u51b3\u65b9\u6848"},d="\u5e38\u89c1\u95ee\u9898",t={},c=[{value:"\u5b89\u88c5\u4e0e\u542f\u52a8",id:"\u5b89\u88c5\u4e0e\u542f\u52a8",level:2},{value:"\u7aef\u53e3 80 \u88ab\u5360\u7528",id:"\u7aef\u53e3-80-\u88ab\u5360\u7528",level:3},{value:"\u6743\u9650\u4e0d\u8db3",id:"\u6743\u9650\u4e0d\u8db3",level:3},{value:"\u914d\u7f6e\u8bed\u6cd5\u9519\u8bef",id:"\u914d\u7f6e\u8bed\u6cd5\u9519\u8bef",level:3},{value:"\u4ee3\u7406\u95ee\u9898",id:"\u4ee3\u7406\u95ee\u9898",level:2},{value:"502 Bad Gateway",id:"502-bad-gateway",level:3},{value:"504 Gateway Timeout",id:"504-gateway-timeout",level:3},{value:"\u65e0\u6cd5\u83b7\u53d6\u771f\u5b9e IP",id:"\u65e0\u6cd5\u83b7\u53d6\u771f\u5b9e-ip",level:3},{value:"SSL \u95ee\u9898",id:"ssl-\u95ee\u9898",level:2},{value:"\u8bc1\u4e66\u94fe\u4e0d\u5b8c\u6574",id:"\u8bc1\u4e66\u94fe\u4e0d\u5b8c\u6574",level:3},{value:"\u6df7\u5408\u5185\u5bb9\u8b66\u544a",id:"\u6df7\u5408\u5185\u5bb9\u8b66\u544a",level:3},{value:"\u6027\u80fd\u95ee\u9898",id:"\u6027\u80fd\u95ee\u9898",level:2},{value:"Nginx \u8fdb\u7a0b CPU \u5360\u7528\u9ad8",id:"nginx-\u8fdb\u7a0b-cpu-\u5360\u7528\u9ad8",level:3},{value:"\u8fde\u63a5\u6570\u8017\u5c3d",id:"\u8fde\u63a5\u6570\u8017\u5c3d",level:3},{value:"\u65e5\u5fd7\u76f8\u5173",id:"\u65e5\u5fd7\u76f8\u5173",level:2},{value:"\u65e5\u5fd7\u589e\u957f\u8fc7\u5feb",id:"\u65e5\u5fd7\u589e\u957f\u8fc7\u5feb",level:3},{value:"\u5173\u95ed\u7279\u5b9a\u8def\u5f84\u65e5\u5fd7",id:"\u5173\u95ed\u7279\u5b9a\u8def\u5f84\u65e5\u5fd7",level:3},{value:"\u5e38\u7528\u6392\u67e5\u547d\u4ee4",id:"\u5e38\u7528\u6392\u67e5\u547d\u4ee4",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5b89\u88c5\u4e0e\u542f\u52a8",children:"\u5b89\u88c5\u4e0e\u542f\u52a8"}),"\n",(0,r.jsx)(n.h3,{id:"\u7aef\u53e3-80-\u88ab\u5360\u7528",children:"\u7aef\u53e3 80 \u88ab\u5360\u7528"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b\u7aef\u53e3\u5360\u7528\nsudo lsof -i :80\nsudo netstat -tlnp | grep :80\n\n# \u505c\u6b62\u5360\u7528\u8fdb\u7a0b\u6216\u4fee\u6539 Nginx \u7aef\u53e3\nlisten 8080;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u6743\u9650\u4e0d\u8db3",children:"\u6743\u9650\u4e0d\u8db3"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u786e\u4fdd\u76ee\u5f55\u6743\u9650\nsudo chown -R nginx:nginx /var/www/html\nsudo chmod -R 755 /var/www/html\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u914d\u7f6e\u8bed\u6cd5\u9519\u8bef",children:"\u914d\u7f6e\u8bed\u6cd5\u9519\u8bef"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# \u6d4b\u8bd5\u914d\u7f6e\nnginx -t\n\n# \u8f93\u51fa\u793a\u4f8b\nnginx: [emerg] unknown directive "servrr" in /etc/nginx/nginx.conf:10\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u4ee3\u7406\u95ee\u9898",children:"\u4ee3\u7406\u95ee\u9898"}),"\n",(0,r.jsx)(n.h3,{id:"502-bad-gateway",children:"502 Bad Gateway"}),"\n",(0,r.jsx)(n.p,{children:"\u5e38\u89c1\u539f\u56e0\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u540e\u7aef\u670d\u52a1\u672a\u542f\u52a8"}),"\n",(0,r.jsx)(n.li,{children:"\u540e\u7aef\u5730\u5740\u914d\u7f6e\u9519\u8bef"}),"\n",(0,r.jsx)(n.li,{children:"\u8d85\u65f6\u65f6\u95f4\u592a\u77ed"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"proxy_connect_timeout 60s;\nproxy_read_timeout 60s;\nproxy_send_timeout 60s;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"504-gateway-timeout",children:"504 Gateway Timeout"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"# \u589e\u52a0\u8d85\u65f6\u65f6\u95f4\nproxy_read_timeout 300s;\n\n# \u68c0\u67e5\u540e\u7aef\u670d\u52a1\u54cd\u5e94\u65f6\u95f4\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u65e0\u6cd5\u83b7\u53d6\u771f\u5b9e-ip",children:"\u65e0\u6cd5\u83b7\u53d6\u771f\u5b9e IP"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"proxy_set_header X-Real-IP $remote_addr;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n# \u591a\u5c42\u4ee3\u7406\nset_real_ip_from 10.0.0.0/8;\nreal_ip_header X-Forwarded-For;\nreal_ip_recursive on;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ssl-\u95ee\u9898",children:"SSL \u95ee\u9898"}),"\n",(0,r.jsx)(n.h3,{id:"\u8bc1\u4e66\u94fe\u4e0d\u5b8c\u6574",children:"\u8bc1\u4e66\u94fe\u4e0d\u5b8c\u6574"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"# \u5408\u5e76\u8bc1\u4e66\ncat domain.crt intermediate.crt > fullchain.crt\n\nssl_certificate /path/to/fullchain.crt;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u6df7\u5408\u5185\u5bb9\u8b66\u544a",children:"\u6df7\u5408\u5185\u5bb9\u8b66\u544a"}),"\n",(0,r.jsx)(n.p,{children:"\u786e\u4fdd\u6240\u6709\u8d44\u6e90\u90fd\u4f7f\u7528 HTTPS\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u6027\u80fd\u95ee\u9898",children:"\u6027\u80fd\u95ee\u9898"}),"\n",(0,r.jsx)(n.h3,{id:"nginx-\u8fdb\u7a0b-cpu-\u5360\u7528\u9ad8",children:"Nginx \u8fdb\u7a0b CPU \u5360\u7528\u9ad8"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"# \u68c0\u67e5 worker \u914d\u7f6e\nworker_processes auto;\nworker_connections 1024;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u8fde\u63a5\u6570\u8017\u5c3d",children:"\u8fde\u63a5\u6570\u8017\u5c3d"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u589e\u52a0\u7cfb\u7edf\u9650\u5236\nulimit -n 65535\n\n# nginx \u914d\u7f6e\nworker_rlimit_nofile 65535;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u65e5\u5fd7\u76f8\u5173",children:"\u65e5\u5fd7\u76f8\u5173"}),"\n",(0,r.jsx)(n.h3,{id:"\u65e5\u5fd7\u589e\u957f\u8fc7\u5feb",children:"\u65e5\u5fd7\u589e\u957f\u8fc7\u5feb"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u914d\u7f6e\u65e5\u5fd7\u8f6e\u8f6c\n# /etc/logrotate.d/nginx\n/var/log/nginx/*.log {\n    daily\n    rotate 7\n    compress\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5173\u95ed\u7279\u5b9a\u8def\u5f84\u65e5\u5fd7",children:"\u5173\u95ed\u7279\u5b9a\u8def\u5f84\u65e5\u5fd7"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"location /health {\n    access_log off;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5e38\u7528\u6392\u67e5\u547d\u4ee4",children:"\u5e38\u7528\u6392\u67e5\u547d\u4ee4"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b Nginx \u8fdb\u7a0b\nps aux | grep nginx\n\n# \u67e5\u770b\u9519\u8bef\u65e5\u5fd7\ntail -f /var/log/nginx/error.log\n\n# \u6d4b\u8bd5\u8fde\u63a5\ncurl -I http://localhost\n\n# \u67e5\u770b\u8fde\u63a5\u72b6\u6001\nnetstat -an | grep :80 | wc -l\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);
"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[1418],{2978:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"spring/aop","title":"\u9762\u5411\u5207\u9762\u7f16\u7a0b(AOP)","description":"[!IMPORTANT]","source":"@site/docs/spring/aop.md","sourceDirName":"spring","slug":"/spring/aop","permalink":"/docs/spring/aop","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/spring/aop.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"id":"aop","title":"\u9762\u5411\u5207\u9762\u7f16\u7a0b(AOP)","sidebar_label":"AOP","sidebar_position":5},"sidebar":"spring","previous":{"title":"Bean\u7ba1\u7406","permalink":"/docs/spring/bean-management"},"next":{"title":"\u4e8b\u52a1\u7ba1\u7406","permalink":"/docs/spring/transactions"}}');var r=i(22714),o=i(48885);const s={id:"aop",title:"\u9762\u5411\u5207\u9762\u7f16\u7a0b(AOP)",sidebar_label:"AOP",sidebar_position:5},c="\u9762\u5411\u5207\u9762\u7f16\u7a0b(AOP)",l={},a=[{value:"1.1 AOP\u7684\u597d\u5904",id:"11-aop\u7684\u597d\u5904",level:3},{value:"1.2 AOP\u7684\u6838\u5fc3\u6982\u5ff5",id:"12-aop\u7684\u6838\u5fc3\u6982\u5ff5",level:3},{value:"2. \u5207\u70b9\u8868\u8fbe\u5f0f",id:"2-\u5207\u70b9\u8868\u8fbe\u5f0f",level:2},{value:"2.1 execution\u8868\u8fbe\u5f0f\uff08\u6700\u5e38\u7528\uff09",id:"21-execution\u8868\u8fbe\u5f0f\u6700\u5e38\u7528",level:3},{value:"2.2 \u5176\u4ed6\u5207\u70b9\u7c7b\u578b",id:"22-\u5176\u4ed6\u5207\u70b9\u7c7b\u578b",level:3},{value:"2.3 \u5207\u70b9\u8868\u8fbe\u5f0f\u7684\u7ec4\u5408",id:"23-\u5207\u70b9\u8868\u8fbe\u5f0f\u7684\u7ec4\u5408",level:3},{value:"3. \u901a\u77e5(Advice)",id:"3-\u901a\u77e5advice",level:2},{value:"3.1 \u524d\u7f6e\u901a\u77e5(Before)",id:"31-\u524d\u7f6e\u901a\u77e5before",level:3},{value:"3.2 \u540e\u7f6e\u901a\u77e5(After)",id:"32-\u540e\u7f6e\u901a\u77e5after",level:3},{value:"3.3 \u8fd4\u56de\u901a\u77e5(AfterReturning)",id:"33-\u8fd4\u56de\u901a\u77e5afterreturning",level:3},{value:"3.4 \u5f02\u5e38\u901a\u77e5(AfterThrowing)",id:"34-\u5f02\u5e38\u901a\u77e5afterthrowing",level:3},{value:"3.5 \u73af\u7ed5\u901a\u77e5(Around)\uff08\u6700\u7075\u6d3b\uff09",id:"35-\u73af\u7ed5\u901a\u77e5around\u6700\u7075\u6d3b",level:3},{value:"4. \u5b9e\u6218\u793a\u4f8b",id:"4-\u5b9e\u6218\u793a\u4f8b",level:2},{value:"4.1 \u65e5\u5fd7\u5207\u9762",id:"41-\u65e5\u5fd7\u5207\u9762",level:3},{value:"4.2 \u6027\u80fd\u76d1\u63a7\u5207\u9762",id:"42-\u6027\u80fd\u76d1\u63a7\u5207\u9762",level:3},{value:"4.3 \u7f13\u5b58\u5207\u9762",id:"43-\u7f13\u5b58\u5207\u9762",level:3},{value:"4.4 \u4e8b\u52a1\u5207\u9762",id:"44-\u4e8b\u52a1\u5207\u9762",level:3},{value:"5. JoinPoint\u548cProceedingJoinPoint",id:"5-joinpoint\u548cproceedingjoinpoint",level:2},{value:"5.1 JoinPoint\uff08\u6240\u6709\u901a\u77e5\u90fd\u53ef\u7528\uff09",id:"51-joinpoint\u6240\u6709\u901a\u77e5\u90fd\u53ef\u7528",level:3},{value:"5.2 ProceedingJoinPoint\uff08\u4ec5\u5728@Around\u4e2d\u53ef\u7528\uff09",id:"52-proceedingjoinpoint\u4ec5\u5728around\u4e2d\u53ef\u7528",level:3},{value:"6. \u81ea\u5b9a\u4e49\u6ce8\u89e3\u5207\u9762",id:"6-\u81ea\u5b9a\u4e49\u6ce8\u89e3\u5207\u9762",level:2},{value:"6.1 \u521b\u5efa\u81ea\u5b9a\u4e49\u6ce8\u89e3",id:"61-\u521b\u5efa\u81ea\u5b9a\u4e49\u6ce8\u89e3",level:3},{value:"6.2 \u57fa\u4e8e\u6ce8\u89e3\u7684\u5207\u9762",id:"62-\u57fa\u4e8e\u6ce8\u89e3\u7684\u5207\u9762",level:3},{value:"6.3 \u4f7f\u7528\u81ea\u5b9a\u4e49\u6ce8\u89e3",id:"63-\u4f7f\u7528\u81ea\u5b9a\u4e49\u6ce8\u89e3",level:3},{value:"7. AOP\u7684\u6ce8\u610f\u4e8b\u9879",id:"7-aop\u7684\u6ce8\u610f\u4e8b\u9879",level:2},{value:"7.1 self-invocation\u95ee\u9898",id:"71-self-invocation\u95ee\u9898",level:3},{value:"7.2 \u4ee3\u7406\u7c7b\u578b",id:"72-\u4ee3\u7406\u7c7b\u578b",level:3},{value:"8. \u603b\u7ed3",id:"8-\u603b\u7ed3",level:2}];function d(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"\u9762\u5411\u5207\u9762\u7f16\u7a0baop",children:"\u9762\u5411\u5207\u9762\u7f16\u7a0b(AOP)"})}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.p,{children:["[!IMPORTANT]\n",(0,r.jsx)(e.strong,{children:"AOP \u6838\u5fc3\u4f5c\u7528"}),": AOP \u7528\u4e8e\u5206\u79bb\u6a2a\u5207\u5173\u6ce8\u70b9(\u65e5\u5fd7\u3001\u4e8b\u52a1\u3001\u5b89\u5168\u7b49),\u907f\u514d\u4ee3\u7801\u91cd\u590d\u3002\u7406\u89e3\u5207\u70b9(Pointcut)\u548c\u901a\u77e5(Advice)\u662f\u5173\u952e\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsxs)(e.strong,{children:["\u9762\u5411\u5207\u9762\u7f16\u7a0b(Aspect-Oriented Programming)",(0,r.jsx)(e.strong,{children:"\u662f\u4e00\u79cd\u7f16\u7a0b\u8303\u5f0f\uff0c\u5b83\u5c06\u6a2a\u5207\u5173\u6ce8\u70b9\uff08\u5982\u65e5\u5fd7\u3001\u4e8b\u52a1\u3001\u5b89\u5168\u7b49\uff09\u4ece\u4e1a\u52a1\u903b\u8f91\u4e2d\u5206\u79bb\u51fa\u6765\uff0c\u901a\u8fc7"}),"\u5207\u9762"]}),"\u6765\u7ba1\u7406\u8fd9\u4e9b\u5173\u6ce8\u70b9\u3002"]}),"\n",(0,r.jsx)(e.h3,{id:"11-aop\u7684\u597d\u5904",children:"1.1 AOP\u7684\u597d\u5904"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u964d\u4f4e\u4ee3\u7801\u8026\u5408\u5ea6"})," - \u4e1a\u52a1\u903b\u8f91\u548c\u6a2a\u5207\u5173\u6ce8\u70b9\u5206\u79bb"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u63d0\u9ad8\u4ee3\u7801\u91cd\u7528"})," - \u6a2a\u5207\u5173\u6ce8\u70b9\u53ef\u4ee5\u88ab\u591a\u4e2a\u6a21\u5757\u5171\u7528"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4fbf\u4e8e\u7ef4\u62a4"})," - \u4fee\u6539\u6a2a\u5207\u903b\u8f91\u53ea\u9700\u4fee\u6539\u4e00\u5904"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6613\u4e8e\u6d4b\u8bd5"})," - \u53ef\u4ee5\u72ec\u7acb\u6d4b\u8bd5\u4e1a\u52a1\u903b\u8f91"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"12-aop\u7684\u6838\u5fc3\u6982\u5ff5",children:"1.2 AOP\u7684\u6838\u5fc3\u6982\u5ff5"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u6982\u5ff5"}),(0,r.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Aspect"})}),(0,r.jsx)(e.td,{children:"\u5207\u9762\uff0c\u5305\u542b\u5207\u70b9\u548c\u901a\u77e5\u7684\u7ec4\u5408"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Joinpoint"})}),(0,r.jsx)(e.td,{children:"\u8fde\u63a5\u70b9\uff0c\u7a0b\u5e8f\u6267\u884c\u4e2d\u53ef\u4ee5\u8fdb\u884c\u62e6\u622a\u7684\u70b9\uff08\u5982\u65b9\u6cd5\u8c03\u7528\uff09"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Pointcut"})}),(0,r.jsx)(e.td,{children:"\u5207\u70b9\uff0c\u5339\u914d\u7279\u5b9a\u8fde\u63a5\u70b9\u7684\u8868\u8fbe\u5f0f"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Advice"})}),(0,r.jsx)(e.td,{children:"\u901a\u77e5\uff0c\u5728\u5207\u70b9\u5904\u6267\u884c\u7684\u4ee3\u7801"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Weaving"})}),(0,r.jsx)(e.td,{children:"\u7ec7\u5165\uff0c\u5c06\u5207\u9762\u4e0e\u76ee\u6807\u5bf9\u8c61\u7ed3\u5408\u7684\u8fc7\u7a0b"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Target"})}),(0,r.jsx)(e.td,{children:"\u76ee\u6807\u5bf9\u8c61\uff0c\u88ab\u4ee3\u7406\u7684\u5bf9\u8c61"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Proxy"})}),(0,r.jsx)(e.td,{children:"\u4ee3\u7406\u5bf9\u8c61\uff0c\u5305\u542b\u4e86\u5207\u9762\u903b\u8f91\u7684\u5bf9\u8c61"})]})]})]}),"\n",(0,r.jsx)(e.h2,{id:"2-\u5207\u70b9\u8868\u8fbe\u5f0f",children:"2. \u5207\u70b9\u8868\u8fbe\u5f0f"}),"\n",(0,r.jsx)(e.h3,{id:"21-execution\u8868\u8fbe\u5f0f\u6700\u5e38\u7528",children:"2.1 execution\u8868\u8fbe\u5f0f\uff08\u6700\u5e38\u7528\uff09"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'// \u8bed\u6cd5\uff1aexecution(\u4fee\u9970\u7b26 \u8fd4\u56de\u7c7b\u578b \u5305\u540d.\u7c7b\u540d.\u65b9\u6cd5\u540d(\u53c2\u6570))\n\n// \u5339\u914dUserService\u4e2d\u6240\u6709public\u65b9\u6cd5\n@Pointcut("execution(public * com.example.service.UserService.*(..))")\n\n// \u5339\u914dcom.example.service\u5305\u4e0b\u6240\u6709\u7c7b\u7684\u6240\u6709\u65b9\u6cd5\n@Pointcut("execution(* com.example.service.*.*(..))")\n\n// \u5339\u914d\u6240\u6709save\u65b9\u6cd5\n@Pointcut("execution(* *.save(..))")\n\n// \u5339\u914d\u8fd4\u56deUser\u5bf9\u8c61\u7684\u65b9\u6cd5\n@Pointcut("execution(com.example.entity.User com.example.service.*.*(..))")\n\n// \u5339\u914d\u53c2\u6570\u4e3aUser\u7684\u65b9\u6cd5\n@Pointcut("execution(* com.example.service.*.*(com.example.entity.User))")\n\n// \u5339\u914d\u4efb\u610f\u53c2\u6570\u4e2a\u6570\u7684\u65b9\u6cd5\n@Pointcut("execution(* com.example.service.*.*(..))")\n\n// \u5339\u914d\u5355\u4e2a\u53c2\u6570\u7684\u65b9\u6cd5\n@Pointcut("execution(* com.example.service.*.*(*))")\n'})}),"\n",(0,r.jsx)(e.h3,{id:"22-\u5176\u4ed6\u5207\u70b9\u7c7b\u578b",children:"2.2 \u5176\u4ed6\u5207\u70b9\u7c7b\u578b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'// within - \u5339\u914d\u7279\u5b9a\u7c7b\u4e2d\u7684\u65b9\u6cd5\n@Pointcut("within(com.example.service.UserService)")\n\n// target - \u5339\u914d\u4ee3\u7406\u5bf9\u8c61\u7684\u7c7b\u578b\n@Pointcut("target(com.example.service.UserService)")\n\n// args - \u5339\u914d\u53c2\u6570\u7c7b\u578b\n@Pointcut("args(com.example.entity.User)")\n\n// @annotation - \u5339\u914d\u6709\u7279\u5b9a\u6ce8\u89e3\u7684\u65b9\u6cd5\n@Pointcut("@annotation(com.example.annotation.LogExecution)")\n\n// @target - \u5339\u914d\u6709\u7279\u5b9a\u6ce8\u89e3\u7684\u7c7b\n@Pointcut("@target(com.example.annotation.Service)")\n'})}),"\n",(0,r.jsx)(e.h3,{id:"23-\u5207\u70b9\u8868\u8fbe\u5f0f\u7684\u7ec4\u5408",children:"2.3 \u5207\u70b9\u8868\u8fbe\u5f0f\u7684\u7ec4\u5408"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'// && - AND\n@Pointcut("execution(public * com.example.service.*.*(..)) && @annotation(com.example.annotation.Cacheable)")\n\n// || - OR\n@Pointcut("execution(public * *.save(..)) || execution(public * *.update(..))")\n\n// ! - NOT\n@Pointcut("execution(public * *.*(..)) && !execution(public * *.get(..))")\n'})}),"\n",(0,r.jsx)(e.h2,{id:"3-\u901a\u77e5advice",children:"3. \u901a\u77e5(Advice)"}),"\n",(0,r.jsx)(e.h3,{id:"31-\u524d\u7f6e\u901a\u77e5before",children:"3.1 \u524d\u7f6e\u901a\u77e5(Before)"}),"\n",(0,r.jsxs)(e.p,{children:["\u5728\u65b9\u6cd5\u6267\u884c",(0,r.jsx)(e.strong,{children:"\u4e4b\u524d"}),"\u6267\u884c\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@Aspect\n@Component\npublic class LoggingAspect {\n    \n    @Before("execution(* com.example.service.*.*(..))")\n    public void beforeMethod(JoinPoint joinPoint) {\n        String className = joinPoint.getTarget().getClass().getSimpleName();\n        String methodName = joinPoint.getSignature().getName();\n        Object[] args = joinPoint.getArgs();\n        \n        System.out.println(String.format(\n            "Calling: %s.%s with args: %s",\n            className, methodName, Arrays.toString(args)\n        ));\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"32-\u540e\u7f6e\u901a\u77e5after",children:"3.2 \u540e\u7f6e\u901a\u77e5(After)"}),"\n",(0,r.jsxs)(e.p,{children:["\u5728\u65b9\u6cd5\u6267\u884c",(0,r.jsx)(e.strong,{children:"\u4e4b\u540e"}),"\u6267\u884c\uff08\u65e0\u8bba\u6210\u529f\u8fd8\u662f\u5931\u8d25\uff09\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@After("execution(* com.example.service.*.*(..))")\npublic void afterMethod(JoinPoint joinPoint) {\n    String methodName = joinPoint.getSignature().getName();\n    System.out.println(methodName + " executed");\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"33-\u8fd4\u56de\u901a\u77e5afterreturning",children:"3.3 \u8fd4\u56de\u901a\u77e5(AfterReturning)"}),"\n",(0,r.jsxs)(e.p,{children:["\u5728\u65b9\u6cd5",(0,r.jsx)(e.strong,{children:"\u6210\u529f\u8fd4\u56de"}),"\u540e\u6267\u884c\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@AfterReturning(\n    pointcut = "execution(* com.example.service.UserService.*(..))",\n    returning = "result"\n)\npublic void afterReturning(JoinPoint joinPoint, Object result) {\n    String methodName = joinPoint.getSignature().getName();\n    System.out.println(String.format(\n        "%s returned: %s",\n        methodName, result\n    ));\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"34-\u5f02\u5e38\u901a\u77e5afterthrowing",children:"3.4 \u5f02\u5e38\u901a\u77e5(AfterThrowing)"}),"\n",(0,r.jsxs)(e.p,{children:["\u5728\u65b9\u6cd5",(0,r.jsx)(e.strong,{children:"\u629b\u51fa\u5f02\u5e38"}),"\u540e\u6267\u884c\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@AfterThrowing(\n    pointcut = "execution(* com.example.service.*.*(..))",\n    throwing = "ex"\n)\npublic void afterThrowing(JoinPoint joinPoint, Exception ex) {\n    String methodName = joinPoint.getSignature().getName();\n    System.out.println(String.format(\n        "Exception in %s: %s",\n        methodName, ex.getMessage()\n    ));\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"35-\u73af\u7ed5\u901a\u77e5around\u6700\u7075\u6d3b",children:"3.5 \u73af\u7ed5\u901a\u77e5(Around)\uff08\u6700\u7075\u6d3b\uff09"}),"\n",(0,r.jsxs)(e.p,{children:["\u5728\u65b9\u6cd5",(0,r.jsx)(e.strong,{children:"\u6267\u884c\u524d\u540e"}),"\u90fd\u53ef\u4ee5\u6267\u884c\uff0c\u53ef\u4ee5\u4fee\u6539\u53c2\u6570\u548c\u8fd4\u56de\u503c\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@Around("execution(* com.example.service.*.*(..))")\npublic Object aroundMethod(ProceedingJoinPoint joinPoint) throws Throwable {\n    String methodName = joinPoint.getSignature().getName();\n    \n    long startTime = System.currentTimeMillis();\n    \n    try {\n        // \u6267\u884c\u76ee\u6807\u65b9\u6cd5\n        Object result = joinPoint.proceed();\n        \n        long duration = System.currentTimeMillis() - startTime;\n        System.out.println(String.format(\n            "%s executed in %d ms, result: %s",\n            methodName, duration, result\n        ));\n        \n        return result;\n    } catch (Throwable ex) {\n        long duration = System.currentTimeMillis() - startTime;\n        System.out.println(String.format(\n            "%s failed after %d ms with exception: %s",\n            methodName, duration, ex.getMessage()\n        ));\n        throw ex;\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"4-\u5b9e\u6218\u793a\u4f8b",children:"4. \u5b9e\u6218\u793a\u4f8b"}),"\n",(0,r.jsx)(e.h3,{id:"41-\u65e5\u5fd7\u5207\u9762",children:"4.1 \u65e5\u5fd7\u5207\u9762"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@Aspect\n@Component\n@Slf4j\npublic class LoggingAspect {\n    \n    @Pointcut("execution(* com.example.service.*.*(..))")\n    public void serviceLayer() {}\n    \n    @Before("serviceLayer()")\n    public void logBefore(JoinPoint joinPoint) {\n        String methodName = joinPoint.getSignature().getName();\n        Object[] args = joinPoint.getArgs();\n        \n        log.info(">>> Method: {}, Arguments: {}", methodName, args);\n    }\n    \n    @AfterReturning(pointcut = "serviceLayer()", returning = "result")\n    public void logAfterReturning(JoinPoint joinPoint, Object result) {\n        String methodName = joinPoint.getSignature().getName();\n        \n        log.info("<<< Method: {}, Result: {}", methodName, result);\n    }\n    \n    @AfterThrowing(pointcut = "serviceLayer()", throwing = "ex")\n    public void logAfterThrowing(JoinPoint joinPoint, Exception ex) {\n        String methodName = joinPoint.getSignature().getName();\n        \n        log.error("!!! Method: {}, Exception: {}", methodName, ex.getMessage());\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"42-\u6027\u80fd\u76d1\u63a7\u5207\u9762",children:"4.2 \u6027\u80fd\u76d1\u63a7\u5207\u9762"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@Aspect\n@Component\npublic class PerformanceAspect {\n    \n    @Around("execution(* com.example.service.*.*(..))")\n    public Object monitorPerformance(ProceedingJoinPoint joinPoint) throws Throwable {\n        String methodName = joinPoint.getSignature().getName();\n        long startTime = System.currentTimeMillis();\n        \n        try {\n            Object result = joinPoint.proceed();\n            return result;\n        } finally {\n            long duration = System.currentTimeMillis() - startTime;\n            if (duration > 1000) {\n                log.warn("Method {} took {} ms (slow)", methodName, duration);\n            } else {\n                log.debug("Method {} took {} ms", methodName, duration);\n            }\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"43-\u7f13\u5b58\u5207\u9762",children:"4.3 \u7f13\u5b58\u5207\u9762"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@Aspect\n@Component\npublic class CachingAspect {\n    \n    private Map<String, Object> cache = new HashMap<>();\n    \n    @Around("@annotation(com.example.annotation.Cacheable)")\n    public Object cache(ProceedingJoinPoint joinPoint) throws Throwable {\n        String key = generateKey(joinPoint);\n        \n        // \u68c0\u67e5\u7f13\u5b58\n        if (cache.containsKey(key)) {\n            log.info("Cache hit: {}", key);\n            return cache.get(key);\n        }\n        \n        // \u6267\u884c\u65b9\u6cd5\n        Object result = joinPoint.proceed();\n        \n        // \u5b58\u5165\u7f13\u5b58\n        cache.put(key, result);\n        log.info("Cached: {}", key);\n        \n        return result;\n    }\n    \n    private String generateKey(ProceedingJoinPoint joinPoint) {\n        String methodName = joinPoint.getSignature().getName();\n        Object[] args = joinPoint.getArgs();\n        return methodName + "_" + Arrays.toString(args);\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"44-\u4e8b\u52a1\u5207\u9762",children:"4.4 \u4e8b\u52a1\u5207\u9762"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@Aspect\n@Component\npublic class TransactionAspect {\n    \n    @Autowired\n    private PlatformTransactionManager transactionManager;\n    \n    @Around("execution(* com.example.service.*.*(..))")\n    public Object manageTransaction(ProceedingJoinPoint joinPoint) throws Throwable {\n        TransactionStatus status = transactionManager.getTransaction(\n            new DefaultTransactionDefinition()\n        );\n        \n        try {\n            Object result = joinPoint.proceed();\n            transactionManager.commit(status);\n            return result;\n        } catch (Throwable ex) {\n            transactionManager.rollback(status);\n            throw ex;\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"5-joinpoint\u548cproceedingjoinpoint",children:"5. JoinPoint\u548cProceedingJoinPoint"}),"\n",(0,r.jsx)(e.h3,{id:"51-joinpoint\u6240\u6709\u901a\u77e5\u90fd\u53ef\u7528",children:"5.1 JoinPoint\uff08\u6240\u6709\u901a\u77e5\u90fd\u53ef\u7528\uff09"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@Before("execution(* com.example.service.*.*(..))")\npublic void before(JoinPoint joinPoint) {\n    // \u83b7\u53d6\u76ee\u6807\u5bf9\u8c61\n    Object target = joinPoint.getTarget();\n    \n    // \u83b7\u53d6\u65b9\u6cd5\u7b7e\u540d\n    MethodSignature signature = (MethodSignature) joinPoint.getSignature();\n    String methodName = signature.getName();\n    Class<?>[] parameterTypes = signature.getParameterTypes();\n    \n    // \u83b7\u53d6\u53c2\u6570\n    Object[] args = joinPoint.getArgs();\n    \n    // \u83b7\u53d6\u8fd4\u56de\u7c7b\u578b\n    Class<?> returnType = signature.getReturnType();\n    \n    // \u83b7\u53d6\u5f53\u524d\u6267\u884c\u70b9\n    StaticPart staticPart = joinPoint.getStaticPart();\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"52-proceedingjoinpoint\u4ec5\u5728around\u4e2d\u53ef\u7528",children:"5.2 ProceedingJoinPoint\uff08\u4ec5\u5728@Around\u4e2d\u53ef\u7528\uff09"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@Around("execution(* com.example.service.*.*(..))")\npublic Object around(ProceedingJoinPoint joinPoint) throws Throwable {\n    // \u5305\u542bJoinPoint\u7684\u6240\u6709\u65b9\u6cd5\n    \n    // \u6267\u884c\u76ee\u6807\u65b9\u6cd5\n    Object result = joinPoint.proceed();\n    \n    // \u6267\u884c\u5e26\u4fee\u6539\u53c2\u6570\u7684\u76ee\u6807\u65b9\u6cd5\n    Object resultWithArgs = joinPoint.proceed(new Object[]{/* new args */});\n    \n    return result;\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"6-\u81ea\u5b9a\u4e49\u6ce8\u89e3\u5207\u9762",children:"6. \u81ea\u5b9a\u4e49\u6ce8\u89e3\u5207\u9762"}),"\n",(0,r.jsx)(e.h3,{id:"61-\u521b\u5efa\u81ea\u5b9a\u4e49\u6ce8\u89e3",children:"6.1 \u521b\u5efa\u81ea\u5b9a\u4e49\u6ce8\u89e3"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface LogExecution {\n    String value() default "";\n}\n\n@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface Cacheable {\n    long ttl() default 3600;  // \u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"62-\u57fa\u4e8e\u6ce8\u89e3\u7684\u5207\u9762",children:"6.2 \u57fa\u4e8e\u6ce8\u89e3\u7684\u5207\u9762"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@Aspect\n@Component\npublic class AnnotationAspect {\n    \n    @Around("@annotation(logExecution)")\n    public Object logExecution(ProceedingJoinPoint joinPoint, LogExecution logExecution) throws Throwable {\n        String description = logExecution.value();\n        String methodName = joinPoint.getSignature().getName();\n        \n        long startTime = System.currentTimeMillis();\n        log.info("Executing {}: {}", methodName, description);\n        \n        try {\n            Object result = joinPoint.proceed();\n            long duration = System.currentTimeMillis() - startTime;\n            log.info("Completed {} in {} ms", methodName, duration);\n            return result;\n        } catch (Exception ex) {\n            log.error("Failed {}: {}", methodName, ex.getMessage());\n            throw ex;\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"63-\u4f7f\u7528\u81ea\u5b9a\u4e49\u6ce8\u89e3",children:"6.3 \u4f7f\u7528\u81ea\u5b9a\u4e49\u6ce8\u89e3"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@Service\npublic class UserService {\n    \n    @LogExecution("\u4fdd\u5b58\u7528\u6237")\n    public void saveUser(User user) {\n        // \u4e1a\u52a1\u903b\u8f91\n    }\n    \n    @Cacheable(ttl = 1800)\n    public User getUserById(Long id) {\n        // \u4e1a\u52a1\u903b\u8f91\n        return user;\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"7-aop\u7684\u6ce8\u610f\u4e8b\u9879",children:"7. AOP\u7684\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,r.jsx)(e.h3,{id:"71-self-invocation\u95ee\u9898",children:"7.1 self-invocation\u95ee\u9898"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"@Component\npublic class UserService {\n    \n    @Transactional\n    public void save(User user) {\n        // \u76f4\u63a5\u8c03\u7528\u5176\u4ed6\u65b9\u6cd5\n        update(user);  // \u274c update\u65b9\u6cd5\u7684@Transactional\u4e0d\u4f1a\u751f\u6548\n    }\n    \n    @Transactional\n    public void update(User user) {\n    }\n}\n\n// \u2705 \u89e3\u51b3\u65b9\u68481\uff1a\u6ce8\u5165\u81ea\u5df1\n@Component\npublic class UserService {\n    @Autowired\n    private UserService self;\n    \n    @Transactional\n    public void save(User user) {\n        self.update(user);  // \u2705 \u901a\u8fc7\u4ee3\u7406\u5bf9\u8c61\u8c03\u7528\n    }\n    \n    @Transactional\n    public void update(User user) {\n    }\n}\n\n// \u2705 \u89e3\u51b3\u65b9\u68482\uff1a\u4f7f\u7528AopContext\n@Component\npublic class UserService {\n    @Transactional\n    public void save(User user) {\n        UserService proxy = (UserService) AopContext.currentProxy();\n        proxy.update(user);\n    }\n    \n    @Transactional\n    public void update(User user) {\n    }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"72-\u4ee3\u7406\u7c7b\u578b",children:"7.2 \u4ee3\u7406\u7c7b\u578b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"// Spring\u9ed8\u8ba4\u4f7f\u7528JDK\u52a8\u6001\u4ee3\u7406\uff08\u9700\u8981\u63a5\u53e3\uff09\npublic interface UserService {\n    void save(User user);\n}\n\n@Service\npublic class UserServiceImpl implements UserService {\n    @Override\n    public void save(User user) {\n    }\n}\n\n// \u5982\u679c\u6ca1\u6709\u63a5\u53e3\uff0c\u4f7f\u7528CGLIB\u4ee3\u7406\n@Configuration\n@EnableAspectJAutoProxy(proxyTargetClass = true)  // \u5f3a\u5236\u4f7f\u7528CGLIB\npublic class AppConfig {\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"8-\u603b\u7ed3",children:"8. \u603b\u7ed3"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u6982\u5ff5"}),(0,r.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Aspect"}),(0,r.jsx)(e.td,{children:"\u5207\u9762\uff0c\u5305\u542b\u5207\u70b9\u548c\u901a\u77e5"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Pointcut"}),(0,r.jsx)(e.td,{children:"\u5207\u70b9\u8868\u8fbe\u5f0f\uff0c\u5b9a\u4e49\u4f55\u5904\u62e6\u622a"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Advice"}),(0,r.jsx)(e.td,{children:"\u901a\u77e5\uff0c\u5b9a\u4e49\u5982\u4f55\u62e6\u622a"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Weaving"}),(0,r.jsx)(e.td,{children:"\u7ec7\u5165\uff0c\u5c06\u5207\u9762\u5e94\u7528\u5230\u76ee\u6807"})]})]})]}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u901a\u77e5\u7c7b\u578b"}),(0,r.jsx)(e.th,{children:"\u65f6\u673a"}),(0,r.jsx)(e.th,{children:"\u4f7f\u7528\u573a\u666f"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Before"}),(0,r.jsx)(e.td,{children:"\u65b9\u6cd5\u524d"}),(0,r.jsx)(e.td,{children:"\u53c2\u6570\u9a8c\u8bc1\u3001\u6743\u9650\u68c0\u67e5"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"After"}),(0,r.jsx)(e.td,{children:"\u65b9\u6cd5\u540e"}),(0,r.jsx)(e.td,{children:"\u8d44\u6e90\u6e05\u7406\u3001\u65e5\u5fd7"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"AfterReturning"}),(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u540e"}),(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c\u5904\u7406"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"AfterThrowing"}),(0,r.jsx)(e.td,{children:"\u5f02\u5e38\u540e"}),(0,r.jsx)(e.td,{children:"\u5f02\u5e38\u5904\u7406\u3001\u65e5\u5fd7"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Around"}),(0,r.jsx)(e.td,{children:"\u524d\u540e\u90fd\u6267\u884c"}),(0,r.jsx)(e.td,{children:"\u6027\u80fd\u76d1\u63a7\u3001\u7f13\u5b58\u3001\u4e8b\u52a1"})]})]})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u5173\u952e\u8981\u70b9"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u4f18\u5148\u4f7f\u7528@Around\u5904\u7406\u590d\u6742\u903b\u8f91"}),"\n",(0,r.jsx)(e.li,{children:"\u4f7f\u7528\u81ea\u5b9a\u4e49\u6ce8\u89e3\u8ba9\u4ee3\u7801\u66f4\u6e05\u6670"}),"\n",(0,r.jsx)(e.li,{children:"\u6ce8\u610fself-invocation\u95ee\u9898"}),"\n",(0,r.jsx)(e.li,{children:"\u7406\u89e3\u4ee3\u7406\u7684\u5de5\u4f5c\u539f\u7406"}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u4e0b\u4e00\u6b65"}),"\uff1a\u5b66\u4e60",(0,r.jsx)(e.a,{href:"./transactions",children:"\u4e8b\u52a1\u7ba1\u7406"})]})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},48885:(n,e,i)=>{i.d(e,{R:()=>s,x:()=>c});var t=i(99378);const r={},o=t.createContext(r);function s(n){const e=t.useContext(o);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);
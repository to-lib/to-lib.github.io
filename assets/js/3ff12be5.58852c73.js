"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[77413],{13364:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"kubernetes/best-practices","title":"\u6700\u4f73\u5b9e\u8df5","description":"Kubernetes \u751f\u4ea7\u73af\u5883\u6700\u4f73\u5b9e\u8df5","source":"@site/docs/kubernetes/best-practices.md","sourceDirName":"kubernetes","slug":"/kubernetes/best-practices","permalink":"/docs/kubernetes/best-practices","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/kubernetes/best-practices.md","tags":[],"version":"current","sidebarPosition":15,"frontMatter":{"sidebar_position":15,"title":"\u6700\u4f73\u5b9e\u8df5","description":"Kubernetes \u751f\u4ea7\u73af\u5883\u6700\u4f73\u5b9e\u8df5"},"sidebar":"kubernetes","previous":{"title":"\u5feb\u901f\u53c2\u8003","permalink":"/docs/kubernetes/quick-reference"},"next":{"title":"\u6545\u969c\u6392\u67e5","permalink":"/docs/kubernetes/troubleshooting"}}');var t=s(22714),r=s(48885);const l={sidebar_position:15,title:"\u6700\u4f73\u5b9e\u8df5",description:"Kubernetes \u751f\u4ea7\u73af\u5883\u6700\u4f73\u5b9e\u8df5"},a="Kubernetes \u6700\u4f73\u5b9e\u8df5",d={},c=[{value:"\u8d44\u6e90\u914d\u7f6e",id:"\u8d44\u6e90\u914d\u7f6e",level:2},{value:"\u8bbe\u7f6e\u8d44\u6e90\u8bf7\u6c42\u548c\u9650\u5236",id:"\u8bbe\u7f6e\u8d44\u6e90\u8bf7\u6c42\u548c\u9650\u5236",level:3},{value:"\u8d44\u6e90\u914d\u989d",id:"\u8d44\u6e90\u914d\u989d",level:3},{value:"LimitRange",id:"limitrange",level:3},{value:"\u5065\u5eb7\u68c0\u67e5",id:"\u5065\u5eb7\u68c0\u67e5",level:2},{value:"\u4e09\u79cd\u63a2\u9488\u5b8c\u6574\u914d\u7f6e",id:"\u4e09\u79cd\u63a2\u9488\u5b8c\u6574\u914d\u7f6e",level:3},{value:"\u9ad8\u53ef\u7528\u8bbe\u8ba1",id:"\u9ad8\u53ef\u7528\u8bbe\u8ba1",level:2},{value:"Pod \u53cd\u4eb2\u548c\u6027",id:"pod-\u53cd\u4eb2\u548c\u6027",level:3},{value:"Pod \u4e2d\u65ad\u9884\u7b97",id:"pod-\u4e2d\u65ad\u9884\u7b97",level:3},{value:"\u62d3\u6251\u5206\u5e03\u7ea6\u675f",id:"\u62d3\u6251\u5206\u5e03\u7ea6\u675f",level:3},{value:"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5",id:"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5",level:2},{value:"Pod \u5b89\u5168\u4e0a\u4e0b\u6587",id:"pod-\u5b89\u5168\u4e0a\u4e0b\u6587",level:3},{value:"\u7f51\u7edc\u7b56\u7565\u9694\u79bb",id:"\u7f51\u7edc\u7b56\u7565\u9694\u79bb",level:3},{value:"Secret \u7ba1\u7406",id:"secret-\u7ba1\u7406",level:3},{value:"\u4f18\u96c5\u7ec8\u6b62",id:"\u4f18\u96c5\u7ec8\u6b62",level:2},{value:"\u914d\u7f6e\u4f18\u96c5\u7ec8\u6b62",id:"\u914d\u7f6e\u4f18\u96c5\u7ec8\u6b62",level:3},{value:"\u6807\u7b7e\u4e0e\u6ce8\u89e3",id:"\u6807\u7b7e\u4e0e\u6ce8\u89e3",level:2},{value:"\u6807\u7b7e\u89c4\u8303",id:"\u6807\u7b7e\u89c4\u8303",level:3},{value:"\u6ce8\u89e3\u6700\u4f73\u5b9e\u8df5",id:"\u6ce8\u89e3\u6700\u4f73\u5b9e\u8df5",level:3},{value:"\u65e5\u5fd7\u4e0e\u76d1\u63a7",id:"\u65e5\u5fd7\u4e0e\u76d1\u63a7",level:2},{value:"\u7ed3\u6784\u5316\u65e5\u5fd7",id:"\u7ed3\u6784\u5316\u65e5\u5fd7",level:3},{value:"\u76d1\u63a7\u6307\u6807\u66b4\u9732",id:"\u76d1\u63a7\u6307\u6807\u66b4\u9732",level:3},{value:"CI/CD \u96c6\u6210",id:"cicd-\u96c6\u6210",level:2},{value:"GitOps \u5de5\u4f5c\u6d41",id:"gitops-\u5de5\u4f5c\u6d41",level:3},{value:"\u955c\u50cf\u6807\u7b7e\u7b56\u7565",id:"\u955c\u50cf\u6807\u7b7e\u7b56\u7565",level:3},{value:"\u6210\u672c\u4f18\u5316",id:"\u6210\u672c\u4f18\u5316",level:2},{value:"\u8d44\u6e90\u4f18\u5316",id:"\u8d44\u6e90\u4f18\u5316",level:3},{value:"\u8282\u70b9\u6c60\u7b56\u7565",id:"\u8282\u70b9\u6c60\u7b56\u7565",level:3},{value:"\u5feb\u901f\u68c0\u67e5\u6e05\u5355",id:"\u5feb\u901f\u68c0\u67e5\u6e05\u5355",level:2},{value:"\u751f\u4ea7\u5c31\u7eea\u68c0\u67e5",id:"\u751f\u4ea7\u5c31\u7eea\u68c0\u67e5",level:3}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"kubernetes-\u6700\u4f73\u5b9e\u8df5",children:"Kubernetes \u6700\u4f73\u5b9e\u8df5"})}),"\n",(0,t.jsx)(n.h2,{id:"\u8d44\u6e90\u914d\u7f6e",children:"\u8d44\u6e90\u914d\u7f6e"}),"\n",(0,t.jsx)(n.h3,{id:"\u8bbe\u7f6e\u8d44\u6e90\u8bf7\u6c42\u548c\u9650\u5236",children:"\u8bbe\u7f6e\u8d44\u6e90\u8bf7\u6c42\u548c\u9650\u5236"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'spec:\n  containers:\n    - name: app\n      resources:\n        # \u8bf7\u6c42\uff1a\u8c03\u5ea6\u65f6\u4fdd\u8bc1\u7684\u8d44\u6e90\n        requests:\n          memory: "256Mi"\n          cpu: "250m"\n        # \u9650\u5236\uff1a\u8fd0\u884c\u65f6\u7684\u8d44\u6e90\u4e0a\u9650\n        limits:\n          memory: "512Mi"\n          cpu: "500m"\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u6700\u4f73\u5b9e\u8df5"}),"\uff1a"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u5efa\u8bae"}),(0,t.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u59cb\u7ec8\u8bbe\u7f6e requests"}),(0,t.jsx)(n.td,{children:"\u786e\u4fdd\u8c03\u5ea6\u5668\u80fd\u591f\u6b63\u786e\u5206\u914d\u8d44\u6e90"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"limits \u2264 2x requests"}),(0,t.jsx)(n.td,{children:"\u907f\u514d\u8fc7\u5ea6\u627f\u8bfa\u5bfc\u81f4\u8282\u70b9\u538b\u529b"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u5185\u5b58 limits = requests"}),(0,t.jsx)(n.td,{children:"\u9632\u6b62 OOMKilled\uff0c\u63d0\u9ad8\u7a33\u5b9a\u6027"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"CPU \u53ef\u9002\u5f53\u653e\u5bbd limits"}),(0,t.jsx)(n.td,{children:"CPU \u662f\u53ef\u538b\u7f29\u8d44\u6e90"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"\u8d44\u6e90\u914d\u989d",children:"\u8d44\u6e90\u914d\u989d"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: team-quota\n  namespace: team-a\nspec:\n  hard:\n    requests.cpu: "10"\n    requests.memory: "20Gi"\n    limits.cpu: "20"\n    limits.memory: "40Gi"\n    pods: "50"\n    services: "10"\n    secrets: "20"\n    configmaps: "20"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"limitrange",children:"LimitRange"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: LimitRange\nmetadata:\n  name: default-limits\n  namespace: production\nspec:\n  limits:\n    - default: # \u9ed8\u8ba4 limits\n        cpu: "500m"\n        memory: "512Mi"\n      defaultRequest: # \u9ed8\u8ba4 requests\n        cpu: "100m"\n        memory: "128Mi"\n      max: # \u6700\u5927\u503c\n        cpu: "2"\n        memory: "4Gi"\n      min: # \u6700\u5c0f\u503c\n        cpu: "50m"\n        memory: "64Mi"\n      type: Container\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u5065\u5eb7\u68c0\u67e5",children:"\u5065\u5eb7\u68c0\u67e5"}),"\n",(0,t.jsx)(n.h3,{id:"\u4e09\u79cd\u63a2\u9488\u5b8c\u6574\u914d\u7f6e",children:"\u4e09\u79cd\u63a2\u9488\u5b8c\u6574\u914d\u7f6e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"spec:\n  containers:\n    - name: app\n      image: my-app:1.0\n      # \u542f\u52a8\u63a2\u9488\uff1a\u5224\u65ad\u5e94\u7528\u662f\u5426\u542f\u52a8\u5b8c\u6210\n      startupProbe:\n        httpGet:\n          path: /healthz\n          port: 8080\n        initialDelaySeconds: 0\n        periodSeconds: 5\n        failureThreshold: 30 # \u5141\u8bb8\u542f\u52a8\u65f6\u95f4\uff1a5s \xd7 30 = 150s\n        successThreshold: 1\n\n      # \u5b58\u6d3b\u63a2\u9488\uff1a\u5224\u65ad\u5bb9\u5668\u662f\u5426\u9700\u8981\u91cd\u542f\n      livenessProbe:\n        httpGet:\n          path: /healthz\n          port: 8080\n        initialDelaySeconds: 0 # startupProbe \u6210\u529f\u540e\u7acb\u5373\u5f00\u59cb\n        periodSeconds: 10\n        timeoutSeconds: 5\n        failureThreshold: 3\n\n      # \u5c31\u7eea\u63a2\u9488\uff1a\u5224\u65ad\u662f\u5426\u53ef\u4ee5\u63a5\u6536\u6d41\u91cf\n      readinessProbe:\n        httpGet:\n          path: /ready\n          port: 8080\n        initialDelaySeconds: 0\n        periodSeconds: 5\n        timeoutSeconds: 3\n        failureThreshold: 3\n        successThreshold: 1\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u6700\u4f73\u5b9e\u8df5"}),"\uff1a"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u59cb\u7ec8\u914d\u7f6e readinessProbe"}),"\uff1a\u786e\u4fdd\u53ea\u6709\u5c31\u7eea\u7684 Pod \u63a5\u6536\u6d41\u91cf"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u6162\u542f\u52a8\u5e94\u7528\u4f7f\u7528 startupProbe"}),"\uff1a\u907f\u514d livenessProbe \u8bef\u6740\u542f\u52a8\u4e2d\u7684\u5bb9\u5668"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"livenessProbe \u9608\u503c\u8981\u5bbd\u677e"}),"\uff1a\u907f\u514d\u56e0\u4e34\u65f6\u95ee\u9898\u5bfc\u81f4\u4e0d\u5fc5\u8981\u7684\u91cd\u542f"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"health \u548c ready \u7aef\u70b9\u5206\u79bb"}),"\uff1a\u5065\u5eb7\u68c0\u67e5\u548c\u5c31\u7eea\u68c0\u67e5\u903b\u8f91\u4e0d\u540c"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u9ad8\u53ef\u7528\u8bbe\u8ba1",children:"\u9ad8\u53ef\u7528\u8bbe\u8ba1"}),"\n",(0,t.jsx)(n.h3,{id:"pod-\u53cd\u4eb2\u548c\u6027",children:"Pod \u53cd\u4eb2\u548c\u6027"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"spec:\n  affinity:\n    podAntiAffinity:\n      # \u5f3a\u5236\u5206\u6563\u5230\u4e0d\u540c\u8282\u70b9\n      requiredDuringSchedulingIgnoredDuringExecution:\n        - labelSelector:\n            matchLabels:\n              app: my-app\n          topologyKey: kubernetes.io/hostname\n      # \u5c3d\u91cf\u5206\u6563\u5230\u4e0d\u540c\u53ef\u7528\u533a\n      preferredDuringSchedulingIgnoredDuringExecution:\n        - weight: 100\n          podAffinityTerm:\n            labelSelector:\n              matchLabels:\n                app: my-app\n            topologyKey: topology.kubernetes.io/zone\n"})}),"\n",(0,t.jsx)(n.h3,{id:"pod-\u4e2d\u65ad\u9884\u7b97",children:"Pod \u4e2d\u65ad\u9884\u7b97"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: policy/v1\nkind: PodDisruptionBudget\nmetadata:\n  name: my-app-pdb\nspec:\n  # \u81f3\u5c11\u4fdd\u6301 2 \u4e2a\u53ef\u7528\n  minAvailable: 2\n  # \u6216\u8005\uff1a\u6700\u591a\u5141\u8bb8 1 \u4e2a\u4e0d\u53ef\u7528\n  # maxUnavailable: 1\n  selector:\n    matchLabels:\n      app: my-app\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u62d3\u6251\u5206\u5e03\u7ea6\u675f",children:"\u62d3\u6251\u5206\u5e03\u7ea6\u675f"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"spec:\n  topologySpreadConstraints:\n    # \u8de8\u53ef\u7528\u533a\u5206\u5e03\n    - maxSkew: 1\n      topologyKey: topology.kubernetes.io/zone\n      whenUnsatisfiable: DoNotSchedule\n      labelSelector:\n        matchLabels:\n          app: my-app\n    # \u8de8\u8282\u70b9\u5206\u5e03\n    - maxSkew: 2\n      topologyKey: kubernetes.io/hostname\n      whenUnsatisfiable: ScheduleAnyway\n      labelSelector:\n        matchLabels:\n          app: my-app\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5",children:"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,t.jsx)(n.h3,{id:"pod-\u5b89\u5168\u4e0a\u4e0b\u6587",children:"Pod \u5b89\u5168\u4e0a\u4e0b\u6587"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"spec:\n  securityContext:\n    runAsNonRoot: true\n    runAsUser: 1000\n    runAsGroup: 1000\n    fsGroup: 1000\n    seccompProfile:\n      type: RuntimeDefault\n  containers:\n    - name: app\n      securityContext:\n        allowPrivilegeEscalation: false\n        readOnlyRootFilesystem: true\n        capabilities:\n          drop:\n            - ALL\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u7f51\u7edc\u7b56\u7565\u9694\u79bb",children:"\u7f51\u7edc\u7b56\u7565\u9694\u79bb"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# \u9ed8\u8ba4\u62d2\u7edd\u6240\u6709\u5165\u7ad9\u6d41\u91cf\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: default-deny-ingress\n  namespace: production\nspec:\n  podSelector: {}\n  policyTypes:\n    - Ingress\n---\n# \u53ea\u5141\u8bb8\u540c\u547d\u540d\u7a7a\u95f4\u8bbf\u95ee\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-same-namespace\n  namespace: production\nspec:\n  podSelector: {}\n  policyTypes:\n    - Ingress\n  ingress:\n    - from:\n        - podSelector: {}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"secret-\u7ba1\u7406",children:"Secret \u7ba1\u7406"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# \u4f7f\u7528\u5916\u90e8 Secret \u7ba1\u7406\u5668\uff08\u5982 External Secrets Operator\uff09\napiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: app-secrets\nspec:\n  refreshInterval: 1h\n  secretStoreRef:\n    kind: ClusterSecretStore\n    name: vault\n  target:\n    name: app-secrets\n    creationPolicy: Owner\n  data:\n    - secretKey: database-password\n      remoteRef:\n        key: production/database\n        property: password\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u4f18\u96c5\u7ec8\u6b62",children:"\u4f18\u96c5\u7ec8\u6b62"}),"\n",(0,t.jsx)(n.h3,{id:"\u914d\u7f6e\u4f18\u96c5\u7ec8\u6b62",children:"\u914d\u7f6e\u4f18\u96c5\u7ec8\u6b62"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"spec:\n  terminationGracePeriodSeconds: 60 # \u7ed9\u4e88\u5145\u8db3\u7684\u7ec8\u6b62\u65f6\u95f4\n  containers:\n    - name: app\n      lifecycle:\n        preStop:\n          exec:\n            command:\n              - /bin/sh\n              - -c\n              - |\n                # \u901a\u77e5\u5e94\u7528\u505c\u6b62\u63a5\u6536\u65b0\u8bf7\u6c42\n                touch /tmp/shutdown\n                # \u7b49\u5f85\u73b0\u6709\u8bf7\u6c42\u5904\u7406\u5b8c\u6210\n                sleep 15\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u7ec8\u6b62\u6d41\u7a0b"}),"\uff1a"]}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant K as Kubernetes\n    participant P as Pod\n    participant E as Endpoint\n    participant A as App\n\n    K->>P: \u53d1\u9001 SIGTERM\n    K->>E: \u4ece Endpoints \u79fb\u9664\n    P->>A: \u6267\u884c preStop\n    A->>A: \u5904\u7406\u73b0\u6709\u8bf7\u6c42\n    A->>A: \u62d2\u7edd\u65b0\u8bf7\u6c42\n    Note over A: terminationGracePeriodSeconds\n    K->>P: \u53d1\u9001 SIGKILL\uff08\u8d85\u65f6\uff09"}),"\n",(0,t.jsx)(n.h2,{id:"\u6807\u7b7e\u4e0e\u6ce8\u89e3",children:"\u6807\u7b7e\u4e0e\u6ce8\u89e3"}),"\n",(0,t.jsx)(n.h3,{id:"\u6807\u7b7e\u89c4\u8303",children:"\u6807\u7b7e\u89c4\u8303"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'metadata:\n  labels:\n    # \u63a8\u8350\u6807\u7b7e\uff08Kubernetes \u5b98\u65b9\uff09\n    app.kubernetes.io/name: my-app\n    app.kubernetes.io/instance: my-app-prod\n    app.kubernetes.io/version: "1.0.0"\n    app.kubernetes.io/component: frontend\n    app.kubernetes.io/part-of: my-platform\n    app.kubernetes.io/managed-by: helm\n    # \u81ea\u5b9a\u4e49\u6807\u7b7e\n    environment: production\n    team: platform\n    cost-center: engineering\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u6ce8\u89e3\u6700\u4f73\u5b9e\u8df5",children:"\u6ce8\u89e3\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'metadata:\n  annotations:\n    # \u6587\u6863\u94fe\u63a5\n    docs.example.com/runbook: "https://wiki.example.com/runbooks/my-app"\n    # \u53d8\u66f4\u8bb0\u5f55\n    kubernetes.io/change-cause: "Update to version 1.0.0"\n    # \u544a\u8b66\u914d\u7f6e\n    prometheus.io/scrape: "true"\n    prometheus.io/port: "9090"\n    prometheus.io/path: "/metrics"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u65e5\u5fd7\u4e0e\u76d1\u63a7",children:"\u65e5\u5fd7\u4e0e\u76d1\u63a7"}),"\n",(0,t.jsx)(n.h3,{id:"\u7ed3\u6784\u5316\u65e5\u5fd7",children:"\u7ed3\u6784\u5316\u65e5\u5fd7"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'spec:\n  containers:\n    - name: app\n      env:\n        - name: LOG_FORMAT\n          value: "json"\n        - name: LOG_LEVEL\n          value: "info"\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u65e5\u5fd7\u683c\u5f0f\u5efa\u8bae"}),"\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "timestamp": "2024-01-15T10:30:00Z",\n  "level": "info",\n  "message": "Request processed",\n  "service": "my-app",\n  "trace_id": "abc123",\n  "duration_ms": 150\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u76d1\u63a7\u6307\u6807\u66b4\u9732",children:"\u76d1\u63a7\u6307\u6807\u66b4\u9732"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'spec:\n  containers:\n    - name: app\n      ports:\n        - name: metrics\n          containerPort: 9090\n          protocol: TCP\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: my-app\n  labels:\n    app: my-app\n  annotations:\n    prometheus.io/scrape: "true"\n    prometheus.io/port: "9090"\nspec:\n  ports:\n    - name: http\n      port: 80\n    - name: metrics\n      port: 9090\n'})}),"\n",(0,t.jsx)(n.h2,{id:"cicd-\u96c6\u6210",children:"CI/CD \u96c6\u6210"}),"\n",(0,t.jsx)(n.h3,{id:"gitops-\u5de5\u4f5c\u6d41",children:"GitOps \u5de5\u4f5c\u6d41"}),"\n",(0,t.jsx)(n.mermaid,{value:"graph LR\n    A[\u4ee3\u7801\u63d0\u4ea4] --\x3e B[CI \u6784\u5efa]\n    B --\x3e C[\u63a8\u9001\u955c\u50cf]\n    C --\x3e D[\u66f4\u65b0 Git \u914d\u7f6e]\n    D --\x3e E[ArgoCD/Flux \u540c\u6b65]\n    E --\x3e F[\u90e8\u7f72\u5230\u96c6\u7fa4]"}),"\n",(0,t.jsx)(n.h3,{id:"\u955c\u50cf\u6807\u7b7e\u7b56\u7565",children:"\u955c\u50cf\u6807\u7b7e\u7b56\u7565"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u7b56\u7565"}),(0,t.jsx)(n.th,{children:"\u793a\u4f8b"}),(0,t.jsx)(n.th,{children:"\u9002\u7528\u573a\u666f"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Git SHA"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"app:abc123"})}),(0,t.jsx)(n.td,{children:"\u7cbe\u786e\u8ffd\u6eaf"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u8bed\u4e49\u5316\u7248\u672c"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"app:1.2.3"})}),(0,t.jsx)(n.td,{children:"\u6b63\u5f0f\u53d1\u5e03"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u5206\u652f\u540d"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"app:main"})}),(0,t.jsx)(n.td,{children:"\u5f00\u53d1\u73af\u5883"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"latest"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"app:latest"})}),(0,t.jsx)(n.td,{children:"\u274c \u4e0d\u63a8\u8350"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"\u6210\u672c\u4f18\u5316",children:"\u6210\u672c\u4f18\u5316"}),"\n",(0,t.jsx)(n.h3,{id:"\u8d44\u6e90\u4f18\u5316",children:"\u8d44\u6e90\u4f18\u5316"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# \u4f7f\u7528 VPA \u81ea\u52a8\u8c03\u6574\u8d44\u6e90\napiVersion: autoscaling.k8s.io/v1\nkind: VerticalPodAutoscaler\nmetadata:\n  name: my-app-vpa\nspec:\n  targetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: my-app\n  updatePolicy:\n    updateMode: "Auto"\n  resourcePolicy:\n    containerPolicies:\n      - containerName: "*"\n        minAllowed:\n          cpu: "100m"\n          memory: "128Mi"\n        maxAllowed:\n          cpu: "2"\n          memory: "4Gi"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u8282\u70b9\u6c60\u7b56\u7565",children:"\u8282\u70b9\u6c60\u7b56\u7565"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u8282\u70b9\u7c7b\u578b"}),(0,t.jsx)(n.th,{children:"\u7528\u9014"}),(0,t.jsx)(n.th,{children:"\u6210\u672c"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u6309\u9700\u8282\u70b9"}),(0,t.jsx)(n.td,{children:"\u5173\u952e\u670d\u52a1"}),(0,t.jsx)(n.td,{children:"\u9ad8"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Spot/\u62a2\u5360\u5f0f"}),(0,t.jsx)(n.td,{children:"\u6279\u5904\u7406\u3001\u53ef\u4e2d\u65ad\u4efb\u52a1"}),(0,t.jsx)(n.td,{children:"\u4f4e"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"ARM \u8282\u70b9"}),(0,t.jsx)(n.td,{children:"\u9002\u914d\u5e94\u7528"}),(0,t.jsx)(n.td,{children:"\u4e2d"})]})]})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# \u4f7f\u7528 Spot \u8282\u70b9\nspec:\n  tolerations:\n    - key: "kubernetes.azure.com/scalesetpriority"\n      operator: "Equal"\n      value: "spot"\n      effect: "NoSchedule"\n  affinity:\n    nodeAffinity:\n      preferredDuringSchedulingIgnoredDuringExecution:\n        - weight: 1\n          preference:\n            matchExpressions:\n              - key: "kubernetes.azure.com/scalesetpriority"\n                operator: In\n                values:\n                  - "spot"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u5feb\u901f\u68c0\u67e5\u6e05\u5355",children:"\u5feb\u901f\u68c0\u67e5\u6e05\u5355"}),"\n",(0,t.jsx)(n.h3,{id:"\u751f\u4ea7\u5c31\u7eea\u68c0\u67e5",children:"\u751f\u4ea7\u5c31\u7eea\u68c0\u67e5"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u8bbe\u7f6e\u4e86\u8d44\u6e90\u8bf7\u6c42\u548c\u9650\u5236"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u914d\u7f6e\u4e86\u5065\u5eb7\u68c0\u67e5\uff08liveness/readiness\uff09"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u526f\u672c\u6570 \u2265 2"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u914d\u7f6e\u4e86 PodDisruptionBudget"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u4f7f\u7528\u4e86 Pod \u53cd\u4eb2\u548c\u6027"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5bb9\u5668\u4ee5\u975e root \u7528\u6237\u8fd0\u884c"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u914d\u7f6e\u4e86\u4f18\u96c5\u7ec8\u6b62"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u4f7f\u7528\u4e86\u6807\u51c6\u5316\u6807\u7b7e"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u66b4\u9732\u4e86\u76d1\u63a7\u6307\u6807"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u914d\u7f6e\u4e86\u65e5\u5fd7\u6536\u96c6"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},48885:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>a});var i=s(99378);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);
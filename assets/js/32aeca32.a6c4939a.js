"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[74357],{9106:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>o,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"kafka/performance-optimization","title":"\u6027\u80fd\u4f18\u5316","description":"Kafka \u6027\u80fd\u8c03\u4f18\u548c\u4f18\u5316\u7b56\u7565","source":"@site/docs/kafka/performance-optimization.md","sourceDirName":"kafka","slug":"/kafka/performance-optimization","permalink":"/docs/kafka/performance-optimization","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/kafka/performance-optimization.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"\u6027\u80fd\u4f18\u5316","description":"Kafka \u6027\u80fd\u8c03\u4f18\u548c\u4f18\u5316\u7b56\u7565"},"sidebar":"kafka","previous":{"title":"\u6d88\u606f\u5b58\u50a8\u673a\u5236","permalink":"/docs/kafka/message-storage"},"next":{"title":"\u6700\u4f73\u5b9e\u8df5","permalink":"/docs/kafka/best-practices"}}');var l=s(22714),r=s(48885);const d={sidebar_position:8,title:"\u6027\u80fd\u4f18\u5316",description:"Kafka \u6027\u80fd\u8c03\u4f18\u548c\u4f18\u5316\u7b56\u7565"},t="Kafka \u6027\u80fd\u4f18\u5316",c={},a=[{value:"\u6027\u80fd\u6307\u6807",id:"\u6027\u80fd\u6307\u6807",level:2},{value:"\u5173\u952e\u6307\u6807",id:"\u5173\u952e\u6307\u6807",level:3},{value:"\u76d1\u63a7\u547d\u4ee4",id:"\u76d1\u63a7\u547d\u4ee4",level:3},{value:"\u751f\u4ea7\u8005\u4f18\u5316",id:"\u751f\u4ea7\u8005\u4f18\u5316",level:2},{value:"\u6279\u91cf\u53d1\u9001\u914d\u7f6e",id:"\u6279\u91cf\u53d1\u9001\u914d\u7f6e",level:3},{value:"\u538b\u7f29\u5bf9\u6bd4",id:"\u538b\u7f29\u5bf9\u6bd4",level:3},{value:"\u5f02\u6b65\u53d1\u9001\u6700\u4f73\u5b9e\u8df5",id:"\u5f02\u6b65\u53d1\u9001\u6700\u4f73\u5b9e\u8df5",level:3},{value:"\u6d88\u8d39\u8005\u4f18\u5316",id:"\u6d88\u8d39\u8005\u4f18\u5316",level:2},{value:"\u6279\u91cf\u62c9\u53d6\u914d\u7f6e",id:"\u6279\u91cf\u62c9\u53d6\u914d\u7f6e",level:3},{value:"\u591a\u7ebf\u7a0b\u6d88\u8d39",id:"\u591a\u7ebf\u7a0b\u6d88\u8d39",level:3},{value:"\u6d88\u8d39\u8005\u79ef\u538b\u5904\u7406",id:"\u6d88\u8d39\u8005\u79ef\u538b\u5904\u7406",level:3},{value:"Broker \u4f18\u5316",id:"broker-\u4f18\u5316",level:2},{value:"\u65e5\u5fd7\u914d\u7f6e",id:"\u65e5\u5fd7\u914d\u7f6e",level:3},{value:"\u7f51\u7edc\u914d\u7f6e",id:"\u7f51\u7edc\u914d\u7f6e",level:3},{value:"\u526f\u672c\u914d\u7f6e",id:"\u526f\u672c\u914d\u7f6e",level:3},{value:"\u5206\u533a\u4f18\u5316",id:"\u5206\u533a\u4f18\u5316",level:2},{value:"\u5206\u533a\u6570\u8ba1\u7b97",id:"\u5206\u533a\u6570\u8ba1\u7b97",level:3},{value:"\u5206\u533a\u5206\u914d\u7b56\u7565",id:"\u5206\u533a\u5206\u914d\u7b56\u7565",level:3},{value:"\u64cd\u4f5c\u7cfb\u7edf\u4f18\u5316",id:"\u64cd\u4f5c\u7cfb\u7edf\u4f18\u5316",level:2},{value:"\u6587\u4ef6\u7cfb\u7edf",id:"\u6587\u4ef6\u7cfb\u7edf",level:3},{value:"\u5185\u6838\u53c2\u6570",id:"\u5185\u6838\u53c2\u6570",level:3},{value:"\u6587\u4ef6\u63cf\u8ff0\u7b26",id:"\u6587\u4ef6\u63cf\u8ff0\u7b26",level:3},{value:"JVM \u4f18\u5316",id:"jvm-\u4f18\u5316",level:2},{value:"G1GC \u914d\u7f6e",id:"g1gc-\u914d\u7f6e",level:3},{value:"\u5806\u5185\u5b58\u5efa\u8bae",id:"\u5806\u5185\u5b58\u5efa\u8bae",level:3},{value:"\u6027\u80fd\u6d4b\u8bd5",id:"\u6027\u80fd\u6d4b\u8bd5",level:2},{value:"\u751f\u4ea7\u8005\u6d4b\u8bd5",id:"\u751f\u4ea7\u8005\u6d4b\u8bd5",level:3},{value:"\u6d88\u8d39\u8005\u6d4b\u8bd5",id:"\u6d88\u8d39\u8005\u6d4b\u8bd5",level:3},{value:"\u7aef\u5230\u7aef\u5ef6\u8fdf\u6d4b\u8bd5",id:"\u7aef\u5230\u7aef\u5ef6\u8fdf\u6d4b\u8bd5",level:3},{value:"\u6027\u80fd\u4f18\u5316\u6e05\u5355",id:"\u6027\u80fd\u4f18\u5316\u6e05\u5355",level:2},{value:"\u751f\u4ea7\u8005",id:"\u751f\u4ea7\u8005",level:3},{value:"\u6d88\u8d39\u8005",id:"\u6d88\u8d39\u8005",level:3},{value:"Broker",id:"broker",level:3},{value:"\u64cd\u4f5c\u7cfb\u7edf",id:"\u64cd\u4f5c\u7cfb\u7edf",level:3},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"kafka-\u6027\u80fd\u4f18\u5316",children:"Kafka \u6027\u80fd\u4f18\u5316"})}),"\n",(0,l.jsx)(n.h2,{id:"\u6027\u80fd\u6307\u6807",children:"\u6027\u80fd\u6307\u6807"}),"\n",(0,l.jsx)(n.h3,{id:"\u5173\u952e\u6307\u6807",children:"\u5173\u952e\u6307\u6807"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u6307\u6807"}),(0,l.jsx)(n.th,{children:"\u8bf4\u660e"}),(0,l.jsx)(n.th,{children:"\u76ee\u6807\u503c"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u541e\u5410\u91cf"})}),(0,l.jsx)(n.td,{children:"\u6bcf\u79d2\u6d88\u606f\u6570/\u5b57\u8282\u6570"}),(0,l.jsx)(n.td,{children:"\u6839\u636e\u4e1a\u52a1\u9700\u6c42"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u5ef6\u8fdf"})}),(0,l.jsx)(n.td,{children:"\u7aef\u5230\u7aef\u5ef6\u8fdf"}),(0,l.jsx)(n.td,{children:"< 10ms (\u4f4e\u5ef6\u8fdf\u573a\u666f)"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u53ef\u7528\u6027"})}),(0,l.jsx)(n.td,{children:"\u96c6\u7fa4\u53ef\u7528\u65f6\u95f4\u6bd4\u4f8b"}),(0,l.jsx)(n.td,{children:"99.99%"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u590d\u5236\u5ef6\u8fdf"})}),(0,l.jsx)(n.td,{children:"Leader-Follower \u540c\u6b65\u5ef6\u8fdf"}),(0,l.jsx)(n.td,{children:"< 100ms"})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"\u76d1\u63a7\u547d\u4ee4",children:"\u76d1\u63a7\u547d\u4ee4"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u67e5\u770b Topic \u541e\u5410\u91cf\nkafka-consumer-groups.sh --describe \\\n  --group my-group \\\n  --bootstrap-server localhost:9092\n\n# \u6d88\u8d39\u8005\u5ef6\u8fdf\nkafka-consumer-groups.sh --describe \\\n  --group my-group \\\n  --bootstrap-server localhost:9092 | grep -E "LAG"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u751f\u4ea7\u8005\u4f18\u5316",children:"\u751f\u4ea7\u8005\u4f18\u5316"}),"\n",(0,l.jsx)(n.h3,{id:"\u6279\u91cf\u53d1\u9001\u914d\u7f6e",children:"\u6279\u91cf\u53d1\u9001\u914d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'Properties props = new Properties();\n\n// \u6279\u6b21\u5927\u5c0f\uff08\u9ed8\u8ba4 16KB\uff09\nprops.put("batch.size", 65536);  // 64KB\n\n// \u7b49\u5f85\u65f6\u95f4\uff08\u9ed8\u8ba4 0ms\uff09\nprops.put("linger.ms", 20);  // \u7b49\u5f85 20ms \u51d1\u6279\n\n// \u7f13\u51b2\u533a\u5927\u5c0f\nprops.put("buffer.memory", 67108864);  // 64MB\n\n// \u538b\u7f29\u7c7b\u578b\nprops.put("compression.type", "lz4");\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u538b\u7f29\u5bf9\u6bd4",children:"\u538b\u7f29\u5bf9\u6bd4"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u538b\u7f29\u7c7b\u578b"}),(0,l.jsx)(n.th,{children:"\u538b\u7f29\u7387"}),(0,l.jsx)(n.th,{children:"CPU \u6d88\u8017"}),(0,l.jsx)(n.th,{children:"\u63a8\u8350\u573a\u666f"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"none"})}),(0,l.jsx)(n.td,{children:"\u65e0"}),(0,l.jsx)(n.td,{children:"\u65e0"}),(0,l.jsx)(n.td,{children:"\u4f4e\u5ef6\u8fdf\uff0cCPU \u654f\u611f"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"gzip"})}),(0,l.jsx)(n.td,{children:"\u6700\u9ad8"}),(0,l.jsx)(n.td,{children:"\u9ad8"}),(0,l.jsx)(n.td,{children:"\u5e26\u5bbd\u53d7\u9650"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"snappy"})}),(0,l.jsx)(n.td,{children:"\u4e2d\u7b49"}),(0,l.jsx)(n.td,{children:"\u4f4e"}),(0,l.jsx)(n.td,{children:"\u5e73\u8861\u9009\u62e9"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"lz4"})}),(0,l.jsx)(n.td,{children:"\u4e2d\u7b49"}),(0,l.jsx)(n.td,{children:"\u6700\u4f4e"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u751f\u4ea7\u63a8\u8350"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"zstd"})}),(0,l.jsx)(n.td,{children:"\u9ad8"}),(0,l.jsx)(n.td,{children:"\u4e2d"}),(0,l.jsx)(n.td,{children:"\u5b58\u50a8\u4f18\u5316"})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"\u5f02\u6b65\u53d1\u9001\u6700\u4f73\u5b9e\u8df5",children:"\u5f02\u6b65\u53d1\u9001\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'// \u5f02\u6b65\u53d1\u9001 + \u56de\u8c03\nfor (int i = 0; i < 10000; i++) {\n    ProducerRecord<String, String> record =\n        new ProducerRecord<>("topic", "key-" + i, "value-" + i);\n\n    producer.send(record, (metadata, exception) -> {\n        if (exception != null) {\n            // \u8bb0\u5f55\u5931\u8d25\uff0c\u540e\u7eed\u91cd\u8bd5\n            logger.error("\u53d1\u9001\u5931\u8d25", exception);\n        }\n    });\n\n    // \u6bcf 1000 \u6761\u8bb0\u5f55 flush \u4e00\u6b21\uff08\u53ef\u9009\uff09\n    if (i % 1000 == 0) {\n        producer.flush();\n    }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u6d88\u8d39\u8005\u4f18\u5316",children:"\u6d88\u8d39\u8005\u4f18\u5316"}),"\n",(0,l.jsx)(n.h3,{id:"\u6279\u91cf\u62c9\u53d6\u914d\u7f6e",children:"\u6279\u91cf\u62c9\u53d6\u914d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'Properties props = new Properties();\n\n// \u5355\u6b21\u62c9\u53d6\u6700\u5927\u8bb0\u5f55\u6570\nprops.put("max.poll.records", 500);\n\n// \u62c9\u53d6\u6700\u5c0f\u5b57\u8282\u6570\nprops.put("fetch.min.bytes", 50000);  // 50KB\n\n// \u62c9\u53d6\u6700\u5927\u7b49\u5f85\u65f6\u95f4\nprops.put("fetch.max.wait.ms", 500);  // 500ms\n\n// \u5355\u6b21\u62c9\u53d6\u6700\u5927\u5b57\u8282\u6570\nprops.put("fetch.max.bytes", 52428800);  // 50MB\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u591a\u7ebf\u7a0b\u6d88\u8d39",children:"\u591a\u7ebf\u7a0b\u6d88\u8d39"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'// \u65b9\u6848\u4e00\uff1a\u591a\u7ebf\u7a0b\u5904\u7406\u6d88\u606f\nExecutorService executor = Executors.newFixedThreadPool(10);\n\nwhile (running) {\n    ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\n\n    for (ConsumerRecord<String, String> record : records) {\n        executor.submit(() -> processRecord(record));\n    }\n\n    consumer.commitAsync();\n}\n\n// \u65b9\u6848\u4e8c\uff1a\u591a\u6d88\u8d39\u8005\u5b9e\u4f8b\nint numConsumers = 3;\nfor (int i = 0; i < numConsumers; i++) {\n    new Thread(new ConsumerRunnable(props, "topic")).start();\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u6d88\u8d39\u8005\u79ef\u538b\u5904\u7406",children:"\u6d88\u8d39\u8005\u79ef\u538b\u5904\u7406"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'// \u8df3\u8fc7\u65e7\u6d88\u606f\uff0c\u76f4\u63a5\u6d88\u8d39\u6700\u65b0\nprops.put("auto.offset.reset", "latest");\n\n// \u6216\u8005\u4f7f\u7528 seekToEnd\nconsumer.seekToEnd(consumer.assignment());\n'})}),"\n",(0,l.jsx)(n.h2,{id:"broker-\u4f18\u5316",children:"Broker \u4f18\u5316"}),"\n",(0,l.jsx)(n.h3,{id:"\u65e5\u5fd7\u914d\u7f6e",children:"\u65e5\u5fd7\u914d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-properties",children:"# \u65e5\u5fd7\u6bb5\u5927\u5c0f\uff08\u9ed8\u8ba4 1GB\uff09\nlog.segment.bytes=1073741824\n\n# \u65e5\u5fd7\u4fdd\u7559\u65f6\u95f4\nlog.retention.hours=168\n\n# \u65e5\u5fd7\u6e05\u7406\u7b56\u7565\nlog.cleanup.policy=delete\n\n# \u65e5\u5fd7\u5237\u65b0\u7b56\u7565\nlog.flush.interval.messages=10000\nlog.flush.interval.ms=1000\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u7f51\u7edc\u914d\u7f6e",children:"\u7f51\u7edc\u914d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-properties",children:"# \u7f51\u7edc\u7ebf\u7a0b\u6570\nnum.network.threads=8\n\n# IO \u7ebf\u7a0b\u6570\nnum.io.threads=16\n\n# Socket \u7f13\u51b2\u533a\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u526f\u672c\u914d\u7f6e",children:"\u526f\u672c\u914d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-properties",children:"# \u526f\u672c\u62c9\u53d6\u7ebf\u7a0b\u6570\nnum.replica.fetchers=4\n\n# \u526f\u672c\u62c9\u53d6\u6700\u5927\u5b57\u8282\u6570\nreplica.fetch.max.bytes=10485760\n\n# \u526f\u672c\u62c9\u53d6\u7b49\u5f85\u65f6\u95f4\nreplica.fetch.wait.max.ms=500\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u5206\u533a\u4f18\u5316",children:"\u5206\u533a\u4f18\u5316"}),"\n",(0,l.jsx)(n.h3,{id:"\u5206\u533a\u6570\u8ba1\u7b97",children:"\u5206\u533a\u6570\u8ba1\u7b97"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"\u5206\u533a\u6570 = max(\u751f\u4ea7\u7aef\u541e\u5410\u91cf/\u5355\u5206\u533a\u751f\u4ea7\u541e\u5410\u91cf, \u6d88\u8d39\u7aef\u541e\u5410\u91cf/\u5355\u5206\u533a\u6d88\u8d39\u541e\u5410\u91cf)\n\n\u793a\u4f8b\uff1a\n- \u76ee\u6807\u541e\u5410\u91cf: 1000 MB/s\n- \u5355\u5206\u533a\u751f\u4ea7\u541e\u5410\u91cf: 100 MB/s\n- \u5355\u5206\u533a\u6d88\u8d39\u541e\u5410\u91cf: 50 MB/s\n- \u63a8\u8350\u5206\u533a\u6570 = max(10, 20) = 20\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u5206\u533a\u5206\u914d\u7b56\u7565",children:"\u5206\u533a\u5206\u914d\u7b56\u7565"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'// \u6d88\u8d39\u8005\u5206\u533a\u5206\u914d\u7b56\u7565\nprops.put("partition.assignment.strategy",\n    "org.apache.kafka.clients.consumer.CooperativeStickyAssignor");\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u64cd\u4f5c\u7cfb\u7edf\u4f18\u5316",children:"\u64cd\u4f5c\u7cfb\u7edf\u4f18\u5316"}),"\n",(0,l.jsx)(n.h3,{id:"\u6587\u4ef6\u7cfb\u7edf",children:"\u6587\u4ef6\u7cfb\u7edf"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u4f7f\u7528 XFS \u6587\u4ef6\u7cfb\u7edf\nmkfs.xfs /dev/sdb\n\n# \u6302\u8f7d\u9009\u9879\nmount -o noatime,nodiratime /dev/sdb /data/kafka\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u5185\u6838\u53c2\u6570",children:"\u5185\u6838\u53c2\u6570"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# /etc/sysctl.conf\n\n# \u865a\u62df\u5185\u5b58\nvm.swappiness=1\nvm.dirty_ratio=60\nvm.dirty_background_ratio=5\n\n# \u7f51\u7edc\nnet.core.wmem_max=2097152\nnet.core.rmem_max=2097152\nnet.ipv4.tcp_wmem=4096 65536 2048000\nnet.ipv4.tcp_rmem=4096 65536 2048000\nnet.core.netdev_max_backlog=50000\n\n# \u5e94\u7528\u914d\u7f6e\nsysctl -p\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u6587\u4ef6\u63cf\u8ff0\u7b26",children:"\u6587\u4ef6\u63cf\u8ff0\u7b26"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# /etc/security/limits.conf\n* soft nofile 100000\n* hard nofile 100000\n"})}),"\n",(0,l.jsx)(n.h2,{id:"jvm-\u4f18\u5316",children:"JVM \u4f18\u5316"}),"\n",(0,l.jsx)(n.h3,{id:"g1gc-\u914d\u7f6e",children:"G1GC \u914d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'export KAFKA_HEAP_OPTS="-Xms6g -Xmx6g"\nexport KAFKA_JVM_PERFORMANCE_OPTS="-server \\\n  -XX:+UseG1GC \\\n  -XX:MaxGCPauseMillis=20 \\\n  -XX:InitiatingHeapOccupancyPercent=35 \\\n  -XX:G1HeapRegionSize=16M \\\n  -XX:MinMetaspaceFreeRatio=50 \\\n  -XX:MaxMetaspaceFreeRatio=80"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u5806\u5185\u5b58\u5efa\u8bae",children:"\u5806\u5185\u5b58\u5efa\u8bae"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"OS \u5185\u5b58"}),(0,l.jsx)(n.th,{children:"Kafka \u5806\u5185\u5b58"}),(0,l.jsx)(n.th,{children:"\u9875\u7f13\u5b58"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"32 GB"}),(0,l.jsx)(n.td,{children:"6 GB"}),(0,l.jsx)(n.td,{children:"26 GB"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"64 GB"}),(0,l.jsx)(n.td,{children:"8 GB"}),(0,l.jsx)(n.td,{children:"56 GB"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"128 GB"}),(0,l.jsx)(n.td,{children:"12 GB"}),(0,l.jsx)(n.td,{children:"116 GB"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"\u6027\u80fd\u6d4b\u8bd5",children:"\u6027\u80fd\u6d4b\u8bd5"}),"\n",(0,l.jsx)(n.h3,{id:"\u751f\u4ea7\u8005\u6d4b\u8bd5",children:"\u751f\u4ea7\u8005\u6d4b\u8bd5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kafka-producer-perf-test.sh \\\n  --topic test-topic \\\n  --num-records 1000000 \\\n  --record-size 1000 \\\n  --throughput -1 \\\n  --producer-props \\\n    bootstrap.servers=localhost:9092 \\\n    batch.size=65536 \\\n    linger.ms=20 \\\n    compression.type=lz4\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u6d88\u8d39\u8005\u6d4b\u8bd5",children:"\u6d88\u8d39\u8005\u6d4b\u8bd5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kafka-consumer-perf-test.sh \\\n  --topic test-topic \\\n  --messages 1000000 \\\n  --threads 4 \\\n  --bootstrap-server localhost:9092\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u7aef\u5230\u7aef\u5ef6\u8fdf\u6d4b\u8bd5",children:"\u7aef\u5230\u7aef\u5ef6\u8fdf\u6d4b\u8bd5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kafka-run-class.sh kafka.tools.EndToEndLatency \\\n  localhost:9092 \\\n  test-topic \\\n  10000 \\\n  all \\\n  1024\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u6027\u80fd\u4f18\u5316\u6e05\u5355",children:"\u6027\u80fd\u4f18\u5316\u6e05\u5355"}),"\n",(0,l.jsx)(n.h3,{id:"\u751f\u4ea7\u8005",children:"\u751f\u4ea7\u8005"}),"\n",(0,l.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u914d\u7f6e\u5408\u9002\u7684 ",(0,l.jsx)(n.code,{children:"batch.size"}),"\uff0832-64KB\uff09"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u8bbe\u7f6e ",(0,l.jsx)(n.code,{children:"linger.ms"}),"\uff0810-20ms\uff09"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u542f\u7528\u538b\u7f29\uff08\u63a8\u8350 lz4\uff09"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u4f7f\u7528\u5f02\u6b65\u53d1\u9001 + \u56de\u8c03"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u6d88\u8d39\u8005",children:"\u6d88\u8d39\u8005"}),"\n",(0,l.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u589e\u52a0 ",(0,l.jsx)(n.code,{children:"max.poll.records"})]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u914d\u7f6e ",(0,l.jsx)(n.code,{children:"fetch.min.bytes"})]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u4f7f\u7528\u591a\u7ebf\u7a0b\u5904\u7406"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u5408\u7406\u8bbe\u7f6e\u6d88\u8d39\u8005\u6570\u91cf"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"broker",children:"Broker"}),"\n",(0,l.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u589e\u52a0\u7f51\u7edc\u548c IO \u7ebf\u7a0b"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u914d\u7f6e\u65e5\u5fd7\u6bb5\u5927\u5c0f"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u8c03\u6574\u526f\u672c\u62c9\u53d6\u53c2\u6570"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u4f7f\u7528 SSD \u5b58\u50a8"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u64cd\u4f5c\u7cfb\u7edf",children:"\u64cd\u4f5c\u7cfb\u7edf"}),"\n",(0,l.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u8c03\u6574\u6587\u4ef6\u63cf\u8ff0\u7b26\u9650\u5236"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u4f18\u5316\u865a\u62df\u5185\u5b58\u8bbe\u7f6e"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u914d\u7f6e\u7f51\u7edc\u53c2\u6570"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","\u4f7f\u7528 XFS \u6587\u4ef6\u7cfb\u7edf"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,l.jsx)(n.a,{href:"/docs/kafka/cluster-management",children:"\u96c6\u7fa4\u7ba1\u7406"})," - \u96c6\u7fa4\u90e8\u7f72\u548c\u7ba1\u7406"]}),"\n",(0,l.jsxs)(n.li,{children:["\ud83d\udd12 ",(0,l.jsx)(n.a,{href:"/docs/kafka/best-practices",children:"\u6700\u4f73\u5b9e\u8df5"})," - \u751f\u4ea7\u73af\u5883\u6700\u4f73\u5b9e\u8df5"]}),"\n",(0,l.jsxs)(n.li,{children:["\ud83d\udcca ",(0,l.jsx)(n.a,{href:"/docs/kafka/monitoring",children:"\u76d1\u63a7\u4e0e\u8fd0\u7ef4"})," - \u76d1\u63a7\u548c\u544a\u8b66"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://kafka.apache.org/documentation/#prodconfig",children:"Kafka \u6027\u80fd\u8c03\u4f18\u6307\u5357"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://engineering.linkedin.com/kafka",children:"LinkedIn Kafka \u8c03\u4f18\u5b9e\u8df5"})}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},48885:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>t});var i=s(99378);const l={},r=i.createContext(l);function d(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);
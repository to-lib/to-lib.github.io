"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[5640],{48885:(n,e,l)=>{l.d(e,{R:()=>d,x:()=>c});var s=l(99378);const i={},r=s.createContext(i);function d(n){const e=s.useContext(r);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:d(n.components),s.createElement(r.Provider,{value:e},n.children)}},59775:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>h,contentTitle:()=>c,default:()=>j,frontMatter:()=>d,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"redis/replication","title":"Redis \u4e3b\u4ece\u590d\u5236","description":"\u4e3b\u4ece\u590d\u5236\u662f Redis \u9ad8\u53ef\u7528\u67b6\u6784\u7684\u57fa\u7840\uff0c\u901a\u8fc7\u5c06\u6570\u636e\u4ece\u4e00\u4e2a Redis \u670d\u52a1\u5668\uff08\u4e3b\u8282\u70b9 Master\uff09\u590d\u5236\u5230\u591a\u4e2a Redis \u670d\u52a1\u5668\uff08\u4ece\u8282\u70b9 Slave\uff09\uff0c\u5b9e\u73b0\u6570\u636e\u5197\u4f59\u3001\u8bfb\u5199\u5206\u79bb\u548c\u6545\u969c\u6062\u590d\u3002","source":"@site/docs/redis/replication.md","sourceDirName":"redis","slug":"/redis/replication","permalink":"/docs/redis/replication","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/redis/replication.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Redis \u4e3b\u4ece\u590d\u5236"},"sidebar":"redis","previous":{"title":"Redis \u6301\u4e45\u5316","permalink":"/docs/redis/persistence"},"next":{"title":"Redis \u54e8\u5175\u6a21\u5f0f","permalink":"/docs/redis/sentinel"}}');var i=l(22714),r=l(48885);const d={sidebar_position:6,title:"Redis \u4e3b\u4ece\u590d\u5236"},c="Redis \u4e3b\u4ece\u590d\u5236",h={},a=[{value:"\u4e3b\u4ece\u590d\u5236\u539f\u7406",id:"\u4e3b\u4ece\u590d\u5236\u539f\u7406",level:2},{value:"\u590d\u5236\u6d41\u7a0b",id:"\u590d\u5236\u6d41\u7a0b",level:3},{value:"\u8be6\u7ec6\u8fc7\u7a0b",id:"\u8be6\u7ec6\u8fc7\u7a0b",level:3},{value:"\u914d\u7f6e\u4e3b\u4ece\u590d\u5236",id:"\u914d\u7f6e\u4e3b\u4ece\u590d\u5236",level:2},{value:"\u65b9\u5f0f\u4e00\uff1a\u914d\u7f6e\u6587\u4ef6",id:"\u65b9\u5f0f\u4e00\u914d\u7f6e\u6587\u4ef6",level:3},{value:"\u65b9\u5f0f\u4e8c\uff1a\u547d\u4ee4\u884c",id:"\u65b9\u5f0f\u4e8c\u547d\u4ee4\u884c",level:3},{value:"\u9a8c\u8bc1\u4e3b\u4ece\u72b6\u6001",id:"\u9a8c\u8bc1\u4e3b\u4ece\u72b6\u6001",level:3},{value:"\u590d\u5236\u6a21\u5f0f",id:"\u590d\u5236\u6a21\u5f0f",level:2},{value:"\u5168\u91cf\u590d\u5236",id:"\u5168\u91cf\u590d\u5236",level:3},{value:"\u90e8\u5206\u590d\u5236",id:"\u90e8\u5206\u590d\u5236",level:3},{value:"\u65e0\u76d8\u590d\u5236",id:"\u65e0\u76d8\u590d\u5236",level:3},{value:"\u8bfb\u5199\u5206\u79bb",id:"\u8bfb\u5199\u5206\u79bb",level:2},{value:"\u67b6\u6784",id:"\u67b6\u6784",level:3},{value:"\u5b9e\u73b0\u65b9\u5f0f",id:"\u5b9e\u73b0\u65b9\u5f0f",level:3},{value:"1. \u5e94\u7528\u5c42\u8def\u7531",id:"1-\u5e94\u7528\u5c42\u8def\u7531",level:4},{value:"2. \u4f7f\u7528 Redis Sentinel",id:"2-\u4f7f\u7528-redis-sentinel",level:4},{value:"3. \u4f7f\u7528\u4e2d\u95f4\u4ef6",id:"3-\u4f7f\u7528\u4e2d\u95f4\u4ef6",level:4},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:3},{value:"1. \u4e3b\u4ece\u5ef6\u8fdf",id:"1-\u4e3b\u4ece\u5ef6\u8fdf",level:4},{value:"2. \u6570\u636e\u4e0d\u4e00\u81f4",id:"2-\u6570\u636e\u4e0d\u4e00\u81f4",level:4},{value:"3. \u4ece\u8282\u70b9\u53ea\u8bfb",id:"3-\u4ece\u8282\u70b9\u53ea\u8bfb",level:4},{value:"\u4e3b\u4ece\u5207\u6362",id:"\u4e3b\u4ece\u5207\u6362",level:2},{value:"\u624b\u52a8\u5207\u6362",id:"\u624b\u52a8\u5207\u6362",level:3},{value:"\u81ea\u52a8\u5207\u6362",id:"\u81ea\u52a8\u5207\u6362",level:3},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:2},{value:"1. \u590d\u5236\u98ce\u66b4",id:"1-\u590d\u5236\u98ce\u66b4",level:3},{value:"2. \u590d\u5236\u8d85\u65f6",id:"2-\u590d\u5236\u8d85\u65f6",level:3},{value:"3. \u4e3b\u8282\u70b9\u5b95\u673a",id:"3-\u4e3b\u8282\u70b9\u5b95\u673a",level:3},{value:"4. \u4ece\u8282\u70b9\u8fc7\u591a",id:"4-\u4ece\u8282\u70b9\u8fc7\u591a",level:3},{value:"\u7ea7\u8054\u590d\u5236",id:"\u7ea7\u8054\u590d\u5236",level:2},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u914d\u7f6e\u6301\u4e45\u5316",id:"1-\u914d\u7f6e\u6301\u4e45\u5316",level:3},{value:"2. \u4ece\u8282\u70b9\u53ea\u8bfb",id:"2-\u4ece\u8282\u70b9\u53ea\u8bfb",level:3},{value:"3. \u5408\u7406\u914d\u7f6e\u590d\u5236\u53c2\u6570",id:"3-\u5408\u7406\u914d\u7f6e\u590d\u5236\u53c2\u6570",level:3},{value:"4. \u76d1\u63a7\u590d\u5236\u72b6\u6001",id:"4-\u76d1\u63a7\u590d\u5236\u72b6\u6001",level:3},{value:"5. \u4f7f\u7528 Sentinel \u6216 Cluster",id:"5-\u4f7f\u7528-sentinel-\u6216-cluster",level:3},{value:"\u5c0f\u7ed3",id:"\u5c0f\u7ed3",level:2}];function x(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"redis-\u4e3b\u4ece\u590d\u5236",children:"Redis \u4e3b\u4ece\u590d\u5236"})}),"\n",(0,i.jsx)(e.p,{children:"\u4e3b\u4ece\u590d\u5236\u662f Redis \u9ad8\u53ef\u7528\u67b6\u6784\u7684\u57fa\u7840\uff0c\u901a\u8fc7\u5c06\u6570\u636e\u4ece\u4e00\u4e2a Redis \u670d\u52a1\u5668\uff08\u4e3b\u8282\u70b9 Master\uff09\u590d\u5236\u5230\u591a\u4e2a Redis \u670d\u52a1\u5668\uff08\u4ece\u8282\u70b9 Slave\uff09\uff0c\u5b9e\u73b0\u6570\u636e\u5197\u4f59\u3001\u8bfb\u5199\u5206\u79bb\u548c\u6545\u969c\u6062\u590d\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"\u4e3b\u4ece\u590d\u5236\u539f\u7406",children:"\u4e3b\u4ece\u590d\u5236\u539f\u7406"}),"\n",(0,i.jsx)(e.h3,{id:"\u590d\u5236\u6d41\u7a0b",children:"\u590d\u5236\u6d41\u7a0b"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5efa\u7acb\u8fde\u63a5"})," - \u4ece\u8282\u70b9\u5411\u4e3b\u8282\u70b9\u53d1\u9001 ",(0,i.jsx)(e.code,{children:"PSYNC"})," \u547d\u4ee4"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5168\u91cf\u540c\u6b65"})," - \u4e3b\u8282\u70b9\u8fdb\u884c RDB \u5feb\u7167\uff0c\u53d1\u9001\u7ed9\u4ece\u8282\u70b9"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u589e\u91cf\u540c\u6b65"})," - \u4e3b\u8282\u70b9\u5c06\u5199\u547d\u4ee4\u53d1\u9001\u7ed9\u4ece\u8282\u70b9"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5fc3\u8df3\u68c0\u6d4b"})," - \u4ece\u8282\u70b9\u5b9a\u671f\u5411\u4e3b\u8282\u70b9\u53d1\u9001\u5fc3\u8df3"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u8be6\u7ec6\u8fc7\u7a0b",children:"\u8be6\u7ec6\u8fc7\u7a0b"}),"\n",(0,i.jsx)(e.mermaid,{value:"sequenceDiagram\n    participant Slave as \u4ece\u8282\u70b9\n    participant Master as \u4e3b\u8282\u70b9\n\n    Slave->>Master: PSYNC (\u590d\u5236\u8bf7\u6c42)\n    Master->>Master: BGSAVE (\u751f\u6210 RDB)\n    Master->>Slave: \u53d1\u9001 RDB \u6587\u4ef6\n    Slave->>Slave: \u6e05\u7a7a\u6570\u636e\uff0c\u52a0\u8f7d RDB\n    Master->>Slave: \u53d1\u9001\u7f13\u51b2\u533a\u547d\u4ee4\n    loop \u589e\u91cf\u540c\u6b65\n        Master->>Slave: \u6301\u7eed\u53d1\u9001\u5199\u547d\u4ee4\n    end\n    loop \u5fc3\u8df3\u68c0\u6d4b\n        Slave->>Master: REPLCONF ACK (\u5fc3\u8df3)\n    end"}),"\n",(0,i.jsx)(e.h2,{id:"\u914d\u7f6e\u4e3b\u4ece\u590d\u5236",children:"\u914d\u7f6e\u4e3b\u4ece\u590d\u5236"}),"\n",(0,i.jsx)(e.h3,{id:"\u65b9\u5f0f\u4e00\u914d\u7f6e\u6587\u4ef6",children:"\u65b9\u5f0f\u4e00\uff1a\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,i.jsxs)(e.p,{children:["\u5728\u4ece\u8282\u70b9\u7684 ",(0,i.jsx)(e.code,{children:"redis.conf"})," \u4e2d\u914d\u7f6e\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-conf",children:"# \u6307\u5b9a\u4e3b\u8282\u70b9\u5730\u5740\u548c\u7aef\u53e3\nreplicaof 192.168.1.100 6379\n\n# \u5982\u679c\u4e3b\u8282\u70b9\u8bbe\u7f6e\u4e86\u5bc6\u7801\nmasterauth mypassword\n\n# \u4ece\u8282\u70b9\u662f\u5426\u53ea\u8bfb\uff08\u63a8\u8350\uff09\nreplica-read-only yes\n\n# \u590d\u5236\u8d85\u65f6\u65f6\u95f4\nrepl-timeout 60\n\n# \u7981\u7528 TCP_NODELAY\uff08\u63d0\u9ad8\u590d\u5236\u6027\u80fd\uff09\nrepl-disable-tcp-nodelay no\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u65b9\u5f0f\u4e8c\u547d\u4ee4\u884c",children:"\u65b9\u5f0f\u4e8c\uff1a\u547d\u4ee4\u884c"}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u4ece\u8282\u70b9\u6267\u884c\u547d\u4ee4\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u8bbe\u7f6e\u4e3b\u8282\u70b9\nREPLICAOF 192.168.1.100 6379\n\n# \u5982\u679c\u4e3b\u8282\u70b9\u6709\u5bc6\u7801\nCONFIG SET masterauth mypassword\n\n# \u53d6\u6d88\u590d\u5236\uff08\u53d8\u4e3a\u4e3b\u8282\u70b9\uff09\nREPLICAOF NO ONE\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u9a8c\u8bc1\u4e3b\u4ece\u72b6\u6001",children:"\u9a8c\u8bc1\u4e3b\u4ece\u72b6\u6001"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4e3b\u8282\u70b9"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u590d\u5236\u4fe1\u606f\nINFO replication\n\n# \u8f93\u51fa\u793a\u4f8b\nrole:master\nconnected_slaves:2\nslave0:ip=192.168.1.101,port=6379,state=online,offset=123456\nslave1:ip=192.168.1.102,port=6379,state=online,offset=123456\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4ece\u8282\u70b9"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"INFO replication\n\n# \u8f93\u51fa\u793a\u4f8b\nrole:slave\nmaster_host:192.168.1.100\nmaster_port:6379\nmaster_link_status:up\nslave_read_only:1\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u590d\u5236\u6a21\u5f0f",children:"\u590d\u5236\u6a21\u5f0f"}),"\n",(0,i.jsx)(e.h3,{id:"\u5168\u91cf\u590d\u5236",children:"\u5168\u91cf\u590d\u5236"}),"\n",(0,i.jsx)(e.p,{children:"\u4ece\u8282\u70b9\u9996\u6b21\u8fde\u63a5\u4e3b\u8282\u70b9\uff0c\u6216\u957f\u65f6\u95f4\u65ad\u5f00\u91cd\u8fde\u540e\uff0c\u9700\u8981\u5168\u91cf\u590d\u5236\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8fc7\u7a0b"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4ece\u8282\u70b9\u53d1\u9001 ",(0,i.jsx)(e.code,{children:"PSYNC ? -1"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u4e3b\u8282\u70b9\u6267\u884c ",(0,i.jsx)(e.code,{children:"BGSAVE"})," \u751f\u6210 RDB"]}),"\n",(0,i.jsx)(e.li,{children:"\u4e3b\u8282\u70b9\u53d1\u9001 RDB \u6587\u4ef6\u7ed9\u4ece\u8282\u70b9"}),"\n",(0,i.jsx)(e.li,{children:"\u4ece\u8282\u70b9\u6e05\u7a7a\u65e7\u6570\u636e\uff0c\u52a0\u8f7d RDB"}),"\n",(0,i.jsx)(e.li,{children:"\u4e3b\u8282\u70b9\u53d1\u9001\u7f13\u51b2\u533a\u547d\u4ee4"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5f00\u9500"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4e3b\u8282\u70b9\uff1afork \u5b50\u8fdb\u7a0b\u3001\u78c1\u76d8 I/O\u3001\u7f51\u7edc I/O"}),"\n",(0,i.jsx)(e.li,{children:"\u4ece\u8282\u70b9\uff1a\u6e05\u7a7a\u6570\u636e\u3001\u52a0\u8f7d RDB"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u90e8\u5206\u590d\u5236",children:"\u90e8\u5206\u590d\u5236"}),"\n",(0,i.jsx)(e.p,{children:"\u4ece\u8282\u70b9\u77ed\u6682\u65ad\u5f00\u91cd\u8fde\u540e\uff0c\u53ea\u9700\u540c\u6b65\u65ad\u5f00\u671f\u95f4\u7684\u589e\u91cf\u6570\u636e\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8fc7\u7a0b"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4ece\u8282\u70b9\u53d1\u9001 ",(0,i.jsx)(e.code,{children:"PSYNC <runid> <offset>"})]}),"\n",(0,i.jsx)(e.li,{children:"\u4e3b\u8282\u70b9\u5224\u65ad offset \u662f\u5426\u5728\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u5185"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679c\u5728\uff0c\u53d1\u9001\u589e\u91cf\u6570\u636e\uff1b\u5426\u5219\u8fdb\u884c\u5168\u91cf\u590d\u5236"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-conf",children:"# \u9ed8\u8ba4 1MB\uff0c\u5efa\u8bae\u6839\u636e\u7f51\u7edc\u60c5\u51b5\u8c03\u6574\nrepl-backlog-size 1mb\n\n# \u4e3b\u8282\u70b9\u5728\u591a\u957f\u65f6\u95f4\u6ca1\u6709\u4ece\u8282\u70b9\u540e\u91ca\u653e\u7f13\u51b2\u533a\nrepl-backlog-ttl 3600\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u65e0\u76d8\u590d\u5236",children:"\u65e0\u76d8\u590d\u5236"}),"\n",(0,i.jsx)(e.p,{children:"\u4e3b\u8282\u70b9\u76f4\u63a5\u5c06 RDB \u6570\u636e\u6d41\u53d1\u9001\u7ed9\u4ece\u8282\u70b9\uff0c\u4e0d\u5199\u5165\u78c1\u76d8\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-conf",children:"# \u5f00\u542f\u65e0\u76d8\u590d\u5236\nrepl-diskless-sync yes\n\n# \u5ef6\u8fdf\u65f6\u95f4\uff08\u7b49\u5f85\u66f4\u591a\u4ece\u8282\u70b9\uff09\nrepl-diskless-sync-delay 5\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4f18\u70b9"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u51cf\u5c11\u78c1\u76d8 I/O"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u5408\u78c1\u76d8\u6027\u80fd\u5dee\u7684\u573a\u666f"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7f3a\u70b9"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4e3b\u8282\u70b9\u5185\u5b58\u5360\u7528\u9ad8"}),"\n",(0,i.jsx)(e.li,{children:"fork \u5f00\u9500\u4f9d\u7136\u5b58\u5728"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u8bfb\u5199\u5206\u79bb",children:"\u8bfb\u5199\u5206\u79bb"}),"\n",(0,i.jsx)(e.p,{children:"\u4e3b\u4ece\u590d\u5236\u7684\u5178\u578b\u5e94\u7528\u662f\u5b9e\u73b0\u8bfb\u5199\u5206\u79bb\uff0c\u4e3b\u8282\u70b9\u5904\u7406\u5199\u8bf7\u6c42\uff0c\u4ece\u8282\u70b9\u5904\u7406\u8bfb\u8bf7\u6c42\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"\u67b6\u6784",children:"\u67b6\u6784"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"               +----------+\n               |  Client  |\n               +----------+\n                     |\n         +-----------+------------+\n         |                        |\n    +----------+            +----------+\n    |  Master  | ---------\x3e |  Slave1  |\n    | (Write)  | ---------\x3e |  Slave2  |\n    +----------+            +----------+\n                              (Read)\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u5b9e\u73b0\u65b9\u5f0f",children:"\u5b9e\u73b0\u65b9\u5f0f"}),"\n",(0,i.jsx)(e.h4,{id:"1-\u5e94\u7528\u5c42\u8def\u7531",children:"1. \u5e94\u7528\u5c42\u8def\u7531"}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u5e94\u7528\u4ee3\u7801\u4e2d\u533a\u5206\u8bfb\u5199\u64cd\u4f5c\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class RedisService {\n    private Jedis master;  // \u4e3b\u8282\u70b9\n    private List<Jedis> slaves;  // \u4ece\u8282\u70b9\u5217\u8868\n\n    // \u5199\u64cd\u4f5c\n    public void set(String key, String value) {\n        master.set(key, value);\n    }\n\n    // \u8bfb\u64cd\u4f5c\uff08\u968f\u673a\u9009\u62e9\u4ece\u8282\u70b9\uff09\n    public String get(String key) {\n        Jedis slave = slaves.get(random.nextInt(slaves.size()));\n        return slave.get(key);\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"2-\u4f7f\u7528-redis-sentinel",children:"2. \u4f7f\u7528 Redis Sentinel"}),"\n",(0,i.jsx)(e.p,{children:"Sentinel \u81ea\u52a8\u7ba1\u7406\u4e3b\u4ece\u5207\u6362\uff0c\u5ba2\u6237\u7aef\u901a\u8fc7 Sentinel \u83b7\u53d6\u4e3b\u4ece\u8282\u70b9\u4fe1\u606f\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"3-\u4f7f\u7528\u4e2d\u95f4\u4ef6",children:"3. \u4f7f\u7528\u4e2d\u95f4\u4ef6"}),"\n",(0,i.jsx)(e.p,{children:"\u4f7f\u7528 Twemproxy\u3001Codis \u7b49\u4e2d\u95f4\u4ef6\u5b9e\u73b0\u8bfb\u5199\u5206\u79bb\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,i.jsx)(e.h4,{id:"1-\u4e3b\u4ece\u5ef6\u8fdf",children:"1. \u4e3b\u4ece\u5ef6\u8fdf"}),"\n",(0,i.jsx)(e.p,{children:"\u4e3b\u4ece\u590d\u5236\u662f\u5f02\u6b65\u7684\uff0c\u5b58\u5728\u6570\u636e\u5ef6\u8fdf\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u76d1\u63a7\u5ef6\u8fdf"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u4ece\u8282\u70b9\u6267\u884c\nINFO replication\n\n# \u67e5\u770b master_repl_offset \u548c slave_repl_offset \u5dee\u503c\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u9ad8\u7684\u8bfb\u64cd\u4f5c\uff0c\u4ece\u4e3b\u8282\u70b9\u8bfb\u53d6"}),"\n",(0,i.jsxs)(e.li,{children:["\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"WAIT"})," \u547d\u4ee4\u7b49\u5f85\u4ece\u8282\u70b9\u540c\u6b65"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5199\u5165\u6570\u636e\u540e\uff0c\u7b49\u5f85\u81f3\u5c11 2 \u4e2a\u4ece\u8282\u70b9\u540c\u6b65\uff0c\u8d85\u65f6 1000ms\nSET key value\nWAIT 2 1000\n"})}),"\n",(0,i.jsx)(e.h4,{id:"2-\u6570\u636e\u4e0d\u4e00\u81f4",children:"2. \u6570\u636e\u4e0d\u4e00\u81f4"}),"\n",(0,i.jsx)(e.p,{children:"\u4ece\u8282\u70b9\u6570\u636e\u53ef\u80fd\u843d\u540e\u4e8e\u4e3b\u8282\u70b9\uff0c\u8bfb\u5230\u65e7\u6570\u636e\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4e1a\u52a1\u5c42\u5bb9\u5fcd\u77ed\u6682\u4e0d\u4e00\u81f4"}),"\n",(0,i.jsx)(e.li,{children:"\u5173\u952e\u6570\u636e\u4ece\u4e3b\u8282\u70b9\u8bfb\u53d6"}),"\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528\u7248\u672c\u53f7\u6216\u65f6\u95f4\u6233\u6821\u9a8c\u6570\u636e"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"3-\u4ece\u8282\u70b9\u53ea\u8bfb",children:"3. \u4ece\u8282\u70b9\u53ea\u8bfb"}),"\n",(0,i.jsx)(e.p,{children:"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4ece\u8282\u70b9\u662f\u53ea\u8bfb\u7684\uff0c\u907f\u514d\u6570\u636e\u4e0d\u4e00\u81f4\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-conf",children:"replica-read-only yes\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u4e3b\u4ece\u5207\u6362",children:"\u4e3b\u4ece\u5207\u6362"}),"\n",(0,i.jsx)(e.h3,{id:"\u624b\u52a8\u5207\u6362",children:"\u624b\u52a8\u5207\u6362"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u63d0\u5347\u4ece\u8282\u70b9\u4e3a\u4e3b\u8282\u70b9"}),"\uff1a"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5728\u4ece\u8282\u70b9\u6267\u884c\nREPLICAOF NO ONE\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5176\u4ed6\u4ece\u8282\u70b9\u6307\u5411\u65b0\u4e3b\u8282\u70b9"}),"\uff1a"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5728\u5176\u4ed6\u4ece\u8282\u70b9\u6267\u884c\nREPLICAOF 192.168.1.101 6379\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"3",children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5e94\u7528\u66f4\u65b0\u914d\u7f6e"}),"\uff1a"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u66f4\u65b0\u5e94\u7528\u914d\u7f6e\uff0c\u6307\u5411\u65b0\u7684\u4e3b\u8282\u70b9\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"\u81ea\u52a8\u5207\u6362",children:"\u81ea\u52a8\u5207\u6362"}),"\n",(0,i.jsx)(e.p,{children:"\u4f7f\u7528 Redis Sentinel \u6216 Redis Cluster \u5b9e\u73b0\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,i.jsx)(e.h3,{id:"1-\u590d\u5236\u98ce\u66b4",children:"1. \u590d\u5236\u98ce\u66b4"}),"\n",(0,i.jsx)(e.p,{children:"\u591a\u4e2a\u4ece\u8282\u70b9\u540c\u65f6\u5411\u4e3b\u8282\u70b9\u8bf7\u6c42\u5168\u91cf\u590d\u5236\uff0c\u5bfc\u81f4\u4e3b\u8282\u70b9\u538b\u529b\u8fc7\u5927\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528\u7ea7\u8054\u590d\u5236\uff08\u4ece\u8282\u70b9\u7684\u4ece\u8282\u70b9\uff09"}),"\n",(0,i.jsx)(e.li,{children:"\u5206\u6279\u542f\u52a8\u4ece\u8282\u70b9"}),"\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528\u65e0\u76d8\u590d\u5236\u51cf\u5c11\u78c1\u76d8 I/O"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"2-\u590d\u5236\u8d85\u65f6",children:"2. \u590d\u5236\u8d85\u65f6"}),"\n",(0,i.jsx)(e.p,{children:"\u7f51\u7edc\u4e0d\u7a33\u5b9a\u6216\u4e3b\u8282\u70b9\u538b\u529b\u5927\uff0c\u5bfc\u81f4\u590d\u5236\u8d85\u65f6\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-conf",children:"# \u589e\u52a0\u8d85\u65f6\u65f6\u95f4\nrepl-timeout 60\n\n# \u589e\u52a0\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\nrepl-backlog-size 10mb\n"})}),"\n",(0,i.jsx)(e.h3,{id:"3-\u4e3b\u8282\u70b9\u5b95\u673a",children:"3. \u4e3b\u8282\u70b9\u5b95\u673a"}),"\n",(0,i.jsx)(e.p,{children:"\u4e3b\u8282\u70b9\u5b95\u673a\u540e\uff0c\u9700\u8981\u624b\u52a8\u6216\u81ea\u52a8\u5207\u6362\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528 Redis Sentinel \u81ea\u52a8\u6545\u969c\u8f6c\u79fb"}),"\n",(0,i.jsx)(e.li,{children:"\u914d\u7f6e\u4e3b\u8282\u70b9\u6301\u4e45\u5316\uff0c\u907f\u514d\u6570\u636e\u4e22\u5931"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"4-\u4ece\u8282\u70b9\u8fc7\u591a",children:"4. \u4ece\u8282\u70b9\u8fc7\u591a"}),"\n",(0,i.jsx)(e.p,{children:"\u4ece\u8282\u70b9\u8fc7\u591a\u4f1a\u589e\u52a0\u4e3b\u8282\u70b9\u7684\u590d\u5236\u5f00\u9500\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528\u7ea7\u8054\u590d\u5236"}),"\n",(0,i.jsx)(e.li,{children:"\u9650\u5236\u4ece\u8282\u70b9\u6570\u91cf\uff08\u4e00\u822c\u4e0d\u8d85\u8fc7 5 \u4e2a\uff09"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u7ea7\u8054\u590d\u5236",children:"\u7ea7\u8054\u590d\u5236"}),"\n",(0,i.jsx)(e.p,{children:"\u4ece\u8282\u70b9\u4e5f\u53ef\u4ee5\u6709\u81ea\u5df1\u7684\u4ece\u8282\u70b9\uff0c\u5f62\u6210\u7ea7\u8054\u590d\u5236\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"Master\n  |\nSlave1\n  |\nSlave2\n  |\nSlave3\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u914d\u7f6e"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# Slave2 \u590d\u5236 Slave1\nREPLICAOF 192.168.1.101 6379\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4f18\u70b9"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u51cf\u5c11\u4e3b\u8282\u70b9\u590d\u5236\u5f00\u9500"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u5408\u5927\u91cf\u4ece\u8282\u70b9\u573a\u666f"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7f3a\u70b9"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u589e\u52a0\u590d\u5236\u5ef6\u8fdf"}),"\n",(0,i.jsx)(e.li,{children:"\u4e2d\u95f4\u8282\u70b9\u6545\u969c\u5f71\u54cd\u4e0b\u6e38\u8282\u70b9"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsx)(e.h3,{id:"1-\u914d\u7f6e\u6301\u4e45\u5316",children:"1. \u914d\u7f6e\u6301\u4e45\u5316"}),"\n",(0,i.jsx)(e.p,{children:"\u4e3b\u8282\u70b9\u81f3\u5c11\u5f00\u542f\u4e00\u79cd\u6301\u4e45\u5316\u65b9\u5f0f\uff0c\u907f\u514d\u91cd\u542f\u540e\u6570\u636e\u4e22\u5931\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-conf",children:"# \u4e3b\u8282\u70b9\nappendonly yes\nappendfsync everysec\n"})}),"\n",(0,i.jsx)(e.h3,{id:"2-\u4ece\u8282\u70b9\u53ea\u8bfb",children:"2. \u4ece\u8282\u70b9\u53ea\u8bfb"}),"\n",(0,i.jsx)(e.p,{children:"\u907f\u514d\u4ece\u8282\u70b9\u5199\u5165\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-conf",children:"replica-read-only yes\n"})}),"\n",(0,i.jsx)(e.h3,{id:"3-\u5408\u7406\u914d\u7f6e\u590d\u5236\u53c2\u6570",children:"3. \u5408\u7406\u914d\u7f6e\u590d\u5236\u53c2\u6570"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-conf",children:"# \u590d\u5236\u8d85\u65f6\nrepl-timeout 60\n\n# \u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\uff08\u6839\u636e\u7f51\u7edc\u60c5\u51b5\u8c03\u6574\uff09\nrepl-backlog-size 10mb\n\n# \u7981\u7528 TCP_NODELAY\uff08\u51cf\u5c11\u7f51\u7edc\u5ef6\u8fdf\uff09\nrepl-disable-tcp-nodelay no\n"})}),"\n",(0,i.jsx)(e.h3,{id:"4-\u76d1\u63a7\u590d\u5236\u72b6\u6001",children:"4. \u76d1\u63a7\u590d\u5236\u72b6\u6001"}),"\n",(0,i.jsx)(e.p,{children:"\u5b9a\u671f\u68c0\u67e5\u590d\u5236\u72b6\u6001\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u4e3b\u8282\u70b9\nINFO replication\n\n# \u4ece\u8282\u70b9\nINFO replication\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5173\u952e\u6307\u6807"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"master_link_status"})," - \u4e3b\u4ece\u8fde\u63a5\u72b6\u6001"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"master_last_io_seconds_ago"})," - \u6700\u540e\u4e00\u6b21\u540c\u6b65\u65f6\u95f4"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"master_repl_offset"})," - \u4e3b\u8282\u70b9\u590d\u5236\u504f\u79fb\u91cf"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"slave_repl_offset"})," - \u4ece\u8282\u70b9\u590d\u5236\u504f\u79fb\u91cf"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"5-\u4f7f\u7528-sentinel-\u6216-cluster",children:"5. \u4f7f\u7528 Sentinel \u6216 Cluster"}),"\n",(0,i.jsx)(e.p,{children:"\u751f\u4ea7\u73af\u5883\u63a8\u8350\u4f7f\u7528 Redis Sentinel \u6216 Redis Cluster \u5b9e\u73b0\u9ad8\u53ef\u7528\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"\u5c0f\u7ed3",children:"\u5c0f\u7ed3"}),"\n",(0,i.jsx)(e.p,{children:"Redis \u4e3b\u4ece\u590d\u5236\u662f\u5b9e\u73b0\u9ad8\u53ef\u7528\u7684\u57fa\u7840\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6570\u636e\u5197\u4f59"})," - \u591a\u4e2a\u526f\u672c\uff0c\u63d0\u9ad8\u6570\u636e\u5b89\u5168\u6027"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8bfb\u5199\u5206\u79bb"})," - \u4e3b\u8282\u70b9\u5199\uff0c\u4ece\u8282\u70b9\u8bfb\uff0c\u63d0\u9ad8\u6027\u80fd"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6545\u969c\u6062\u590d"})," - \u4e3b\u8282\u70b9\u6545\u969c\u53ef\u63d0\u5347\u4ece\u8282\u70b9"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u4e3b\u4ece\u590d\u5236\u7684\u5173\u952e\u70b9\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7406\u89e3\u5168\u91cf\u590d\u5236\u548c\u90e8\u5206\u590d\u5236"}),"\n",(0,i.jsx)(e.li,{children:"\u5408\u7406\u914d\u7f6e\u590d\u5236\u53c2\u6570"}),"\n",(0,i.jsx)(e.li,{children:"\u6ce8\u610f\u4e3b\u4ece\u5ef6\u8fdf\u548c\u6570\u636e\u4e00\u81f4\u6027"}),"\n",(0,i.jsx)(e.li,{children:"\u751f\u4ea7\u73af\u5883\u4f7f\u7528 Sentinel \u6216 Cluster \u81ea\u52a8\u6545\u969c\u8f6c\u79fb"}),"\n"]})]})}function j(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(x,{...n})}):x(n)}}}]);
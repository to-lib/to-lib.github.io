"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[39927],{48885:(n,e,l)=>{l.d(e,{R:()=>d,x:()=>A});var T=l(99378);const s={},i=T.createContext(s);function d(n){const e=T.useContext(i);return T.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function A(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:d(n.components),T.createElement(i.Provider,{value:e},n.children)}},77326:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>r,contentTitle:()=>A,default:()=>I,frontMatter:()=>d,metadata:()=>T,toc:()=>E});const T=JSON.parse('{"id":"mysql/partitioning","title":"\u5206\u533a\u8868","description":"[!TIP] > \u5927\u8868\u4f18\u5316\u5229\u5668: \u5206\u533a\u8868\u53ef\u4ee5\u5c06\u5927\u8868\u6309\u4e00\u5b9a\u89c4\u5219\u5206\u5272\u6210\u591a\u4e2a\u5c0f\u8868\uff0c\u63d0\u5347\u67e5\u8be2\u6027\u80fd\u548c\u7ba1\u7406\u6548\u7387\u3002","source":"@site/docs/mysql/partitioning.md","sourceDirName":"mysql","slug":"/mysql/partitioning","permalink":"/docs/mysql/partitioning","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/mysql/partitioning.md","tags":[],"version":"current","sidebarPosition":15,"frontMatter":{"sidebar_position":15,"title":"\u5206\u533a\u8868"},"sidebar":"mysql","previous":{"title":"\u76d1\u63a7\u4e0e\u6392\u969c","permalink":"/docs/mysql/monitoring-and-troubleshooting"},"next":{"title":"\u4e3b\u4ece\u590d\u5236","permalink":"/docs/mysql/replication"}}');var s=l(22714),i=l(48885);const d={sidebar_position:15,title:"\u5206\u533a\u8868"},A="MySQL \u5206\u533a\u8868\u8be6\u89e3",r={},E=[{value:"\u5206\u533a\u8868\u6982\u8ff0",id:"\u5206\u533a\u8868\u6982\u8ff0",level:2},{value:"\u4ec0\u4e48\u662f\u5206\u533a\u8868",id:"\u4ec0\u4e48\u662f\u5206\u533a\u8868",level:3},{value:"\u5206\u533a\u4f18\u52bf",id:"\u5206\u533a\u4f18\u52bf",level:3},{value:"\u5206\u533a\u9650\u5236",id:"\u5206\u533a\u9650\u5236",level:3},{value:"\u5206\u533a\u7c7b\u578b",id:"\u5206\u533a\u7c7b\u578b",level:2},{value:"RANGE \u5206\u533a",id:"range-\u5206\u533a",level:3},{value:"RANGE COLUMNS \u5206\u533a",id:"range-columns-\u5206\u533a",level:3},{value:"LIST \u5206\u533a",id:"list-\u5206\u533a",level:3},{value:"HASH \u5206\u533a",id:"hash-\u5206\u533a",level:3},{value:"KEY \u5206\u533a",id:"key-\u5206\u533a",level:3},{value:"\u5b50\u5206\u533a",id:"\u5b50\u5206\u533a",level:2},{value:"\u590d\u5408\u5206\u533a",id:"\u590d\u5408\u5206\u533a",level:3},{value:"\u5206\u533a\u7ba1\u7406",id:"\u5206\u533a\u7ba1\u7406",level:2},{value:"\u67e5\u770b\u5206\u533a\u4fe1\u606f",id:"\u67e5\u770b\u5206\u533a\u4fe1\u606f",level:3},{value:"\u6dfb\u52a0\u5206\u533a",id:"\u6dfb\u52a0\u5206\u533a",level:3},{value:"\u5220\u9664\u5206\u533a",id:"\u5220\u9664\u5206\u533a",level:3},{value:"\u91cd\u7ec4\u5206\u533a",id:"\u91cd\u7ec4\u5206\u533a",level:3},{value:"\u4ea4\u6362\u5206\u533a",id:"\u4ea4\u6362\u5206\u533a",level:3},{value:"\u6e05\u7a7a\u5206\u533a",id:"\u6e05\u7a7a\u5206\u533a",level:3},{value:"\u5206\u533a\u88c1\u526a",id:"\u5206\u533a\u88c1\u526a",level:2},{value:"\u5206\u533a\u88c1\u526a\u539f\u7406",id:"\u5206\u533a\u88c1\u526a\u539f\u7406",level:3},{value:"\u4f18\u5316\u5206\u533a\u88c1\u526a",id:"\u4f18\u5316\u5206\u533a\u88c1\u526a",level:3},{value:"\u5206\u533a\u8868 vs \u5206\u8868",id:"\u5206\u533a\u8868-vs-\u5206\u8868",level:2},{value:"\u9009\u62e9\u5efa\u8bae",id:"\u9009\u62e9\u5efa\u8bae",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u5b9e\u6218\u6848\u4f8b",id:"\u5b9e\u6218\u6848\u4f8b",level:2},{value:"\u65e5\u5fd7\u8868\u5206\u533a",id:"\u65e5\u5fd7\u8868\u5206\u533a",level:3},{value:"\u8ba2\u5355\u8868\u5206\u533a",id:"\u8ba2\u5355\u8868\u5206\u533a",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function N(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"mysql-\u5206\u533a\u8868\u8be6\u89e3",children:"MySQL \u5206\u533a\u8868\u8be6\u89e3"})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:["[!TIP] > ",(0,s.jsx)(e.strong,{children:"\u5927\u8868\u4f18\u5316\u5229\u5668"}),": \u5206\u533a\u8868\u53ef\u4ee5\u5c06\u5927\u8868\u6309\u4e00\u5b9a\u89c4\u5219\u5206\u5272\u6210\u591a\u4e2a\u5c0f\u8868\uff0c\u63d0\u5347\u67e5\u8be2\u6027\u80fd\u548c\u7ba1\u7406\u6548\u7387\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u5206\u533a\u8868\u6982\u8ff0",children:"\u5206\u533a\u8868\u6982\u8ff0"}),"\n",(0,s.jsx)(e.h3,{id:"\u4ec0\u4e48\u662f\u5206\u533a\u8868",children:"\u4ec0\u4e48\u662f\u5206\u533a\u8868"}),"\n",(0,s.jsx)(e.p,{children:"\u5206\u533a\u8868\u5c06\u4e00\u5f20\u903b\u8f91\u4e0a\u7684\u5927\u8868\u6309\u7167\u4e00\u5b9a\u89c4\u5219\u5206\u5272\u6210\u591a\u4e2a\u7269\u7406\u5206\u533a\uff0c\u6bcf\u4e2a\u5206\u533a\u72ec\u7acb\u5b58\u50a8\u6570\u636e\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u5206\u533a\u4f18\u52bf",children:"\u5206\u533a\u4f18\u52bf"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u2705 \u63d0\u5347\u67e5\u8be2\u6027\u80fd\uff08\u5206\u533a\u88c1\u526a\uff09"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u4fbf\u4e8e\u6570\u636e\u7ba1\u7406\uff08\u6309\u5206\u533a\u5220\u9664/\u5f52\u6863\uff09"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u53ef\u4ee5\u8de8\u78c1\u76d8\u5b58\u50a8"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u4f18\u5316\u7ef4\u62a4\u64cd\u4f5c"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u5206\u533a\u9650\u5236",children:"\u5206\u533a\u9650\u5236"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u274c \u5206\u533a\u952e\u5fc5\u987b\u662f\u4e3b\u952e/\u552f\u4e00\u952e\u7684\u4e00\u90e8\u5206"}),"\n",(0,s.jsx)(e.li,{children:"\u274c \u6700\u591a 8192 \u4e2a\u5206\u533a"}),"\n",(0,s.jsx)(e.li,{children:"\u274c \u4e0d\u652f\u6301\u5916\u952e"}),"\n",(0,s.jsx)(e.li,{children:"\u274c \u4e0d\u652f\u6301\u5168\u6587\u7d22\u5f15"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u5206\u533a\u7c7b\u578b",children:"\u5206\u533a\u7c7b\u578b"}),"\n",(0,s.jsx)(e.h3,{id:"range-\u5206\u533a",children:"RANGE \u5206\u533a"}),"\n",(0,s.jsx)(e.p,{children:"\u6309\u8fde\u7eed\u8303\u56f4\u5206\u533a\uff0c\u6700\u5e38\u7528\u7684\u5206\u533a\u65b9\u5f0f\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u6309\u65e5\u671f\u8303\u56f4\u5206\u533a\nCREATE TABLE orders (\n    id BIGINT NOT NULL,\n    customer_id INT NOT NULL,\n    order_date DATE NOT NULL,\n    amount DECIMAL(10,2),\n    PRIMARY KEY (id, order_date)\n) PARTITION BY RANGE (YEAR(order_date)) (\n    PARTITION p2022 VALUES LESS THAN (2023),\n    PARTITION p2023 VALUES LESS THAN (2024),\n    PARTITION p2024 VALUES LESS THAN (2025),\n    PARTITION p2025 VALUES LESS THAN (2026),\n    PARTITION pmax VALUES LESS THAN MAXVALUE\n);\n\n-- \u6309 ID \u8303\u56f4\u5206\u533a\nCREATE TABLE users (\n    id BIGINT NOT NULL PRIMARY KEY,\n    username VARCHAR(50),\n    created_at DATETIME\n) PARTITION BY RANGE (id) (\n    PARTITION p0 VALUES LESS THAN (1000000),\n    PARTITION p1 VALUES LESS THAN (2000000),\n    PARTITION p2 VALUES LESS THAN (3000000),\n    PARTITION pmax VALUES LESS THAN MAXVALUE\n);\n"})}),"\n",(0,s.jsx)(e.h3,{id:"range-columns-\u5206\u533a",children:"RANGE COLUMNS \u5206\u533a"}),"\n",(0,s.jsx)(e.p,{children:"\u652f\u6301\u591a\u5217\u548c\u975e\u6574\u6570\u7c7b\u578b\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u6309\u65e5\u671f\u5217\u5206\u533a\uff08\u65e0\u9700\u51fd\u6570\u8f6c\u6362\uff09\nCREATE TABLE logs (\n    id BIGINT NOT NULL,\n    log_date DATE NOT NULL,\n    message TEXT,\n    PRIMARY KEY (id, log_date)\n) PARTITION BY RANGE COLUMNS (log_date) (\n    PARTITION p202401 VALUES LESS THAN ('2024-02-01'),\n    PARTITION p202402 VALUES LESS THAN ('2024-03-01'),\n    PARTITION p202403 VALUES LESS THAN ('2024-04-01'),\n    PARTITION pmax VALUES LESS THAN (MAXVALUE)\n);\n\n-- \u591a\u5217\u5206\u533a\nCREATE TABLE sales (\n    id BIGINT NOT NULL,\n    region VARCHAR(20) NOT NULL,\n    sale_date DATE NOT NULL,\n    amount DECIMAL(10,2),\n    PRIMARY KEY (id, region, sale_date)\n) PARTITION BY RANGE COLUMNS (region, sale_date) (\n    PARTITION p_east_2024 VALUES LESS THAN ('EAST', '2025-01-01'),\n    PARTITION p_west_2024 VALUES LESS THAN ('WEST', '2025-01-01'),\n    PARTITION pmax VALUES LESS THAN (MAXVALUE, MAXVALUE)\n);\n"})}),"\n",(0,s.jsx)(e.h3,{id:"list-\u5206\u533a",children:"LIST \u5206\u533a"}),"\n",(0,s.jsx)(e.p,{children:"\u6309\u79bb\u6563\u503c\u5217\u8868\u5206\u533a\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u6309\u5730\u533a\u5206\u533a\nCREATE TABLE customers (\n    id BIGINT NOT NULL,\n    name VARCHAR(100),\n    region_id INT NOT NULL,\n    PRIMARY KEY (id, region_id)\n) PARTITION BY LIST (region_id) (\n    PARTITION p_north VALUES IN (1, 2, 3),\n    PARTITION p_south VALUES IN (4, 5, 6),\n    PARTITION p_east VALUES IN (7, 8, 9),\n    PARTITION p_west VALUES IN (10, 11, 12)\n);\n\n-- LIST COLUMNS\uff08\u652f\u6301\u5b57\u7b26\u4e32\uff09\nCREATE TABLE products (\n    id BIGINT NOT NULL,\n    name VARCHAR(100),\n    category VARCHAR(20) NOT NULL,\n    PRIMARY KEY (id, category)\n) PARTITION BY LIST COLUMNS (category) (\n    PARTITION p_electronics VALUES IN ('phone', 'laptop', 'tablet'),\n    PARTITION p_clothing VALUES IN ('shirt', 'pants', 'shoes'),\n    PARTITION p_food VALUES IN ('fruit', 'vegetable', 'meat')\n);\n"})}),"\n",(0,s.jsx)(e.h3,{id:"hash-\u5206\u533a",children:"HASH \u5206\u533a"}),"\n",(0,s.jsx)(e.p,{children:"\u6309\u54c8\u5e0c\u503c\u5747\u5300\u5206\u5e03\u6570\u636e\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u6309\u7528\u6237 ID \u54c8\u5e0c\u5206\u533a\nCREATE TABLE user_actions (\n    id BIGINT NOT NULL,\n    user_id INT NOT NULL,\n    action VARCHAR(50),\n    created_at DATETIME,\n    PRIMARY KEY (id, user_id)\n) PARTITION BY HASH (user_id)\nPARTITIONS 8;\n\n-- LINEAR HASH\uff08\u7ebf\u6027\u54c8\u5e0c\uff0c\u6dfb\u52a0\u5206\u533a\u66f4\u5feb\uff09\nCREATE TABLE events (\n    id BIGINT NOT NULL,\n    event_type INT NOT NULL,\n    data JSON,\n    PRIMARY KEY (id, event_type)\n) PARTITION BY LINEAR HASH (event_type)\nPARTITIONS 4;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"key-\u5206\u533a",children:"KEY \u5206\u533a"}),"\n",(0,s.jsx)(e.p,{children:"\u7c7b\u4f3c HASH\uff0c\u4f46\u4f7f\u7528 MySQL \u5185\u90e8\u54c8\u5e0c\u51fd\u6570\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- KEY \u5206\u533a\uff08\u63a8\u8350\u7528\u4e8e\u5b57\u7b26\u4e32\uff09\nCREATE TABLE sessions (\n    session_id VARCHAR(64) NOT NULL,\n    user_id INT,\n    data TEXT,\n    expires_at DATETIME,\n    PRIMARY KEY (session_id)\n) PARTITION BY KEY (session_id)\nPARTITIONS 16;\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u5b50\u5206\u533a",children:"\u5b50\u5206\u533a"}),"\n",(0,s.jsx)(e.h3,{id:"\u590d\u5408\u5206\u533a",children:"\u590d\u5408\u5206\u533a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- RANGE + HASH \u5b50\u5206\u533a\nCREATE TABLE sales_log (\n    id BIGINT NOT NULL,\n    sale_date DATE NOT NULL,\n    store_id INT NOT NULL,\n    amount DECIMAL(10,2),\n    PRIMARY KEY (id, sale_date, store_id)\n) PARTITION BY RANGE (YEAR(sale_date))\nSUBPARTITION BY HASH (store_id)\nSUBPARTITIONS 4 (\n    PARTITION p2023 VALUES LESS THAN (2024),\n    PARTITION p2024 VALUES LESS THAN (2025),\n    PARTITION p2025 VALUES LESS THAN (2026)\n);\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u5206\u533a\u7ba1\u7406",children:"\u5206\u533a\u7ba1\u7406"}),"\n",(0,s.jsx)(e.h3,{id:"\u67e5\u770b\u5206\u533a\u4fe1\u606f",children:"\u67e5\u770b\u5206\u533a\u4fe1\u606f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u67e5\u770b\u8868\u7684\u5206\u533a\u4fe1\u606f\nSELECT\n    PARTITION_NAME,\n    PARTITION_ORDINAL_POSITION,\n    PARTITION_METHOD,\n    PARTITION_EXPRESSION,\n    PARTITION_DESCRIPTION,\n    TABLE_ROWS,\n    AVG_ROW_LENGTH,\n    DATA_LENGTH\nFROM information_schema.PARTITIONS\nWHERE TABLE_SCHEMA = 'your_database'\n  AND TABLE_NAME = 'your_table';\n\n-- \u67e5\u770b\u5206\u533a\u72b6\u6001\nSHOW CREATE TABLE orders\\G\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u6dfb\u52a0\u5206\u533a",children:"\u6dfb\u52a0\u5206\u533a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- RANGE \u5206\u533a\u6dfb\u52a0\nALTER TABLE orders ADD PARTITION (\n    PARTITION p2026 VALUES LESS THAN (2027)\n);\n\n-- \u6dfb\u52a0\u591a\u4e2a\u5206\u533a\nALTER TABLE orders ADD PARTITION (\n    PARTITION p2026 VALUES LESS THAN (2027),\n    PARTITION p2027 VALUES LESS THAN (2028)\n);\n\n-- LIST \u5206\u533a\u6dfb\u52a0\nALTER TABLE customers ADD PARTITION (\n    PARTITION p_central VALUES IN (13, 14, 15)\n);\n\n-- HASH/KEY \u589e\u52a0\u5206\u533a\u6570\nALTER TABLE user_actions ADD PARTITION PARTITIONS 4;\n-- \u5206\u533a\u6570\u4ece 8 \u589e\u52a0\u5230 12\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u5220\u9664\u5206\u533a",children:"\u5220\u9664\u5206\u533a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u5220\u9664\u5206\u533a\uff08\u6570\u636e\u4e00\u8d77\u5220\u9664\uff01\uff09\nALTER TABLE orders DROP PARTITION p2022;\n\n-- \u5220\u9664\u591a\u4e2a\u5206\u533a\nALTER TABLE orders DROP PARTITION p2022, p2023;\n\n-- HASH/KEY \u51cf\u5c11\u5206\u533a\u6570\nALTER TABLE user_actions COALESCE PARTITION 2;\n-- \u51cf\u5c11 2 \u4e2a\u5206\u533a\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u91cd\u7ec4\u5206\u533a",children:"\u91cd\u7ec4\u5206\u533a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u62c6\u5206\u5206\u533a\nALTER TABLE orders REORGANIZE PARTITION pmax INTO (\n    PARTITION p2026 VALUES LESS THAN (2027),\n    PARTITION pmax VALUES LESS THAN MAXVALUE\n);\n\n-- \u5408\u5e76\u5206\u533a\nALTER TABLE orders REORGANIZE PARTITION p2022, p2023 INTO (\n    PARTITION p_old VALUES LESS THAN (2024)\n);\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u4ea4\u6362\u5206\u533a",children:"\u4ea4\u6362\u5206\u533a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u521b\u5efa\u540c\u7ed3\u6784\u7684\u666e\u901a\u8868\nCREATE TABLE orders_archive LIKE orders;\nALTER TABLE orders_archive REMOVE PARTITIONING;\n\n-- \u4ea4\u6362\u5206\u533a\u6570\u636e\nALTER TABLE orders EXCHANGE PARTITION p2022 WITH TABLE orders_archive;\n-- p2022 \u5206\u533a\u7684\u6570\u636e\u79fb\u5230 orders_archive\n-- orders_archive \u8868\u7684\u6570\u636e\u79fb\u5230 p2022\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u6e05\u7a7a\u5206\u533a",children:"\u6e05\u7a7a\u5206\u533a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u6e05\u7a7a\u7279\u5b9a\u5206\u533a\u7684\u6570\u636e\uff08\u6bd4 DELETE \u5feb\u5f88\u591a\uff09\nALTER TABLE orders TRUNCATE PARTITION p2022;\n\n-- \u6e05\u7a7a\u591a\u4e2a\u5206\u533a\nALTER TABLE orders TRUNCATE PARTITION p2022, p2023;\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u5206\u533a\u88c1\u526a",children:"\u5206\u533a\u88c1\u526a"}),"\n",(0,s.jsx)(e.h3,{id:"\u5206\u533a\u88c1\u526a\u539f\u7406",children:"\u5206\u533a\u88c1\u526a\u539f\u7406"}),"\n",(0,s.jsx)(e.p,{children:"\u5f53\u67e5\u8be2\u6761\u4ef6\u5305\u542b\u5206\u533a\u952e\u65f6\uff0cMySQL \u53ea\u626b\u63cf\u76f8\u5173\u5206\u533a\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u67e5\u770b\u5206\u533a\u88c1\u526a\u6548\u679c\nEXPLAIN SELECT * FROM orders WHERE order_date = '2024-06-15';\n\n-- partitions \u5217\u663e\u793a\u53ea\u626b\u63cf p2024 \u5206\u533a\n\n-- \u6ca1\u6709\u5206\u533a\u88c1\u526a\uff08\u626b\u63cf\u6240\u6709\u5206\u533a\uff09\nEXPLAIN SELECT * FROM orders WHERE amount > 1000;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u4f18\u5316\u5206\u533a\u88c1\u526a",children:"\u4f18\u5316\u5206\u533a\u88c1\u526a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u2705 \u826f\u597d\u7684\u5206\u533a\u88c1\u526a\nSELECT * FROM orders WHERE order_date BETWEEN '2024-01-01' AND '2024-03-31';\n\n-- \u274c \u65e0\u6cd5\u5206\u533a\u88c1\u526a\nSELECT * FROM orders WHERE YEAR(order_date) = 2024;\n\n-- \u2705 \u6539\u5199\u540e\u53ef\u4ee5\u88c1\u526a\nSELECT * FROM orders\nWHERE order_date >= '2024-01-01' AND order_date < '2025-01-01';\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u5206\u533a\u8868-vs-\u5206\u8868",children:"\u5206\u533a\u8868 vs \u5206\u8868"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u7279\u6027"}),(0,s.jsx)(e.th,{children:"\u5206\u533a\u8868"}),(0,s.jsx)(e.th,{children:"\u5206\u8868"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u5b9e\u73b0\u65b9\u5f0f"}),(0,s.jsx)(e.td,{children:"MySQL \u5185\u7f6e"}),(0,s.jsx)(e.td,{children:"\u5e94\u7528\u5c42\u5b9e\u73b0"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u900f\u660e\u6027"}),(0,s.jsx)(e.td,{children:"\u5bf9\u5e94\u7528\u900f\u660e"}),(0,s.jsx)(e.td,{children:"\u9700\u8981\u4fee\u6539\u5e94\u7528"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u8de8\u5206\u533a\u67e5\u8be2"}),(0,s.jsx)(e.td,{children:"\u81ea\u52a8\u652f\u6301"}),(0,s.jsx)(e.td,{children:"\u9700\u8981\u624b\u52a8\u5904\u7406"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u5206\u5e03\u5f0f\u652f\u6301"}),(0,s.jsx)(e.td,{children:"\u4e0d\u652f\u6301"}),(0,s.jsx)(e.td,{children:"\u652f\u6301"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u6570\u636e\u91cf\u9650\u5236"}),(0,s.jsx)(e.td,{children:"\u5355\u5e93\u9650\u5236"}),(0,s.jsx)(e.td,{children:"\u53ef\u65e0\u9650\u6269\u5c55"})]})]})]}),"\n",(0,s.jsx)(e.h3,{id:"\u9009\u62e9\u5efa\u8bae",children:"\u9009\u62e9\u5efa\u8bae"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5206\u533a\u8868"}),"\uff1a\u5355\u8868\u6570\u636e\u91cf < 50 \u4ebf\uff0c\u4e0d\u9700\u8981\u5206\u5e03\u5f0f"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5206\u8868"}),"\uff1a\u6570\u636e\u91cf\u6781\u5927\uff0c\u9700\u8981\u5206\u5e03\u5f0f\u5b58\u50a8"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:["[!IMPORTANT] > ",(0,s.jsx)(e.strong,{children:"\u5206\u533a\u8868\u6700\u4f73\u5b9e\u8df5"}),":"]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u2705 \u5206\u533a\u952e\u9009\u62e9\u9ad8\u9891\u67e5\u8be2\u6761\u4ef6"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u4f7f\u7528 RANGE \u5206\u533a\u7ba1\u7406\u65f6\u5e8f\u6570\u636e"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u5b9a\u671f\u7ef4\u62a4\u5206\u533a\uff08\u6dfb\u52a0\u65b0\u5206\u533a\u3001\u5220\u9664\u65e7\u5206\u533a\uff09"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u786e\u4fdd\u67e5\u8be2\u6761\u4ef6\u5305\u542b\u5206\u533a\u952e"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u76d1\u63a7\u5404\u5206\u533a\u6570\u636e\u5206\u5e03"}),"\n",(0,s.jsx)(e.li,{children:"\u274c \u907f\u514d\u8fc7\u591a\u5206\u533a\uff08< 100 \u4e3a\u5b9c\uff09"}),"\n",(0,s.jsx)(e.li,{children:"\u274c \u907f\u514d\u8de8\u5206\u533a\u4e8b\u52a1"}),"\n",(0,s.jsx)(e.li,{children:"\u274c \u907f\u514d\u5728\u5206\u533a\u952e\u4e0a\u4f7f\u7528\u51fd\u6570"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u5b9e\u6218\u6848\u4f8b",children:"\u5b9e\u6218\u6848\u4f8b"}),"\n",(0,s.jsx)(e.h3,{id:"\u65e5\u5fd7\u8868\u5206\u533a",children:"\u65e5\u5fd7\u8868\u5206\u533a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u6309\u6708\u5206\u533a\u7684\u65e5\u5fd7\u8868\nCREATE TABLE app_logs (\n    id BIGINT NOT NULL AUTO_INCREMENT,\n    log_time DATETIME NOT NULL,\n    level ENUM('DEBUG', 'INFO', 'WARN', 'ERROR') NOT NULL,\n    message TEXT,\n    PRIMARY KEY (id, log_time)\n) PARTITION BY RANGE (TO_DAYS(log_time)) (\n    PARTITION p202401 VALUES LESS THAN (TO_DAYS('2024-02-01')),\n    PARTITION p202402 VALUES LESS THAN (TO_DAYS('2024-03-01')),\n    PARTITION p202403 VALUES LESS THAN (TO_DAYS('2024-04-01')),\n    PARTITION pmax VALUES LESS THAN MAXVALUE\n);\n\n-- \u5b9a\u671f\u6dfb\u52a0\u5206\u533a\u7684\u5b58\u50a8\u8fc7\u7a0b\nDELIMITER //\nCREATE PROCEDURE add_log_partition()\nBEGIN\n    DECLARE next_month DATE;\n    DECLARE partition_name VARCHAR(20);\n    DECLARE partition_value INT;\n\n    SET next_month = DATE_ADD(LAST_DAY(NOW()), INTERVAL 1 DAY);\n    SET partition_name = CONCAT('p', DATE_FORMAT(next_month, '%Y%m'));\n    SET partition_value = TO_DAYS(DATE_ADD(next_month, INTERVAL 1 MONTH));\n\n    SET @sql = CONCAT('ALTER TABLE app_logs REORGANIZE PARTITION pmax INTO (',\n        'PARTITION ', partition_name, ' VALUES LESS THAN (', partition_value, '),',\n        'PARTITION pmax VALUES LESS THAN MAXVALUE)');\n\n    PREPARE stmt FROM @sql;\n    EXECUTE stmt;\n    DEALLOCATE PREPARE stmt;\nEND//\nDELIMITER ;\n\n-- \u5b9a\u671f\u5220\u9664\u65e7\u5206\u533a\nALTER TABLE app_logs DROP PARTITION p202401;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u8ba2\u5355\u8868\u5206\u533a",children:"\u8ba2\u5355\u8868\u5206\u533a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u6309\u5e74\u4efd\u5206\u533a\u7684\u8ba2\u5355\u8868\nCREATE TABLE orders (\n    id BIGINT NOT NULL AUTO_INCREMENT,\n    order_no VARCHAR(32) NOT NULL,\n    user_id BIGINT NOT NULL,\n    order_date DATE NOT NULL,\n    status TINYINT NOT NULL DEFAULT 0,\n    total_amount DECIMAL(12,2),\n    PRIMARY KEY (id, order_date),\n    UNIQUE KEY uk_order_no (order_no, order_date),\n    KEY idx_user_id (user_id, order_date)\n) PARTITION BY RANGE (YEAR(order_date)) (\n    PARTITION p2022 VALUES LESS THAN (2023),\n    PARTITION p2023 VALUES LESS THAN (2024),\n    PARTITION p2024 VALUES LESS THAN (2025),\n    PARTITION p2025 VALUES LESS THAN (2026),\n    PARTITION pmax VALUES LESS THAN MAXVALUE\n);\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,s.jsx)(e.p,{children:"\u672c\u6587\u4ecb\u7ecd\u4e86 MySQL \u5206\u533a\u8868\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u2705 \u5206\u533a\u7c7b\u578b\uff1aRANGE\u3001LIST\u3001HASH\u3001KEY"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u5b50\u5206\u533a\u548c\u590d\u5408\u5206\u533a"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u5206\u533a\u7ba1\u7406\u64cd\u4f5c"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u5206\u533a\u88c1\u526a\u4f18\u5316"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u5206\u533a\u8868 vs \u5206\u8868"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u6700\u4f73\u5b9e\u8df5\u548c\u5b9e\u6218\u6848\u4f8b"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u7ee7\u7eed\u5b66\u4e60 ",(0,s.jsx)(e.a,{href:"/docs/mysql/performance-optimization",children:"\u6027\u80fd\u4f18\u5316"})," \u548c ",(0,s.jsx)(e.a,{href:"/docs/mysql/practical-examples",children:"\u5b9e\u6218\u6848\u4f8b"}),"\uff01"]})]})}function I(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(N,{...n})}):N(n)}}}]);
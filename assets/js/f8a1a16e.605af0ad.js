"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[35142],{14226:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"redis/spring-integration","title":"Spring Boot \u96c6\u6210","description":"\u672c\u6587\u8be6\u7ec6\u4ecb\u7ecd Spring Boot \u4e0e Redis \u7684\u6df1\u5ea6\u96c6\u6210\uff0c\u5305\u62ec Spring Data Redis\u3001\u7f13\u5b58\u6ce8\u89e3\u3001Session \u7ba1\u7406\u7b49\u6838\u5fc3\u529f\u80fd\u3002","source":"@site/docs/redis/spring-integration.md","sourceDirName":"redis","slug":"/redis/spring-integration","permalink":"/docs/redis/spring-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/redis/spring-integration.md","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20,"title":"Spring Boot \u96c6\u6210"},"sidebar":"redis","previous":{"title":"\u6700\u4f73\u5b9e\u8df5","permalink":"/docs/redis/best-practices"},"next":{"title":"\u5e38\u89c1\u4e1a\u52a1\u573a\u666f","permalink":"/docs/redis/common-scenarios"}}');var r=i(22714),t=i(48885);const l={sidebar_position:20,title:"Spring Boot \u96c6\u6210"},a="Redis \u4e0e Spring Boot \u96c6\u6210",d={},c=[{value:"\u5feb\u901f\u5f00\u59cb",id:"\u5feb\u901f\u5f00\u59cb",level:2},{value:"\u6dfb\u52a0\u4f9d\u8d56",id:"\u6dfb\u52a0\u4f9d\u8d56",level:3},{value:"\u57fa\u7840\u914d\u7f6e",id:"\u57fa\u7840\u914d\u7f6e",level:3},{value:"\u57fa\u672c\u4f7f\u7528",id:"\u57fa\u672c\u4f7f\u7528",level:3},{value:"RedisTemplate \u8be6\u89e3",id:"redistemplate-\u8be6\u89e3",level:2},{value:"StringRedisTemplate vs RedisTemplate",id:"stringredistemplate-vs-redistemplate",level:3},{value:"\u81ea\u5b9a\u4e49 RedisTemplate",id:"\u81ea\u5b9a\u4e49-redistemplate",level:3},{value:"\u64cd\u4f5c\u4e0d\u540c\u6570\u636e\u7c7b\u578b",id:"\u64cd\u4f5c\u4e0d\u540c\u6570\u636e\u7c7b\u578b",level:3},{value:"\u7f13\u5b58\u6ce8\u89e3",id:"\u7f13\u5b58\u6ce8\u89e3",level:2},{value:"\u542f\u7528\u7f13\u5b58",id:"\u542f\u7528\u7f13\u5b58",level:3},{value:"\u7f13\u5b58\u914d\u7f6e",id:"\u7f13\u5b58\u914d\u7f6e",level:3},{value:"@Cacheable - \u67e5\u8be2\u7f13\u5b58",id:"cacheable---\u67e5\u8be2\u7f13\u5b58",level:3},{value:"@CachePut - \u66f4\u65b0\u7f13\u5b58",id:"cacheput---\u66f4\u65b0\u7f13\u5b58",level:3},{value:"@CacheEvict - \u5220\u9664\u7f13\u5b58",id:"cacheevict---\u5220\u9664\u7f13\u5b58",level:3},{value:"@Caching - \u7ec4\u5408\u6ce8\u89e3",id:"caching---\u7ec4\u5408\u6ce8\u89e3",level:3},{value:"\u81ea\u5b9a\u4e49 KeyGenerator",id:"\u81ea\u5b9a\u4e49-keygenerator",level:3},{value:"Spring Session Redis",id:"spring-session-redis",level:2},{value:"\u6dfb\u52a0\u4f9d\u8d56",id:"\u6dfb\u52a0\u4f9d\u8d56-1",level:3},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:3},{value:"\u4f7f\u7528 Session",id:"\u4f7f\u7528-session",level:3},{value:"\u81ea\u5b9a\u4e49 Session \u5e8f\u5217\u5316",id:"\u81ea\u5b9a\u4e49-session-\u5e8f\u5217\u5316",level:3},{value:"\u6d88\u606f\u8ba2\u9605",id:"\u6d88\u606f\u8ba2\u9605",level:2},{value:"\u914d\u7f6e\u6d88\u606f\u76d1\u542c",id:"\u914d\u7f6e\u6d88\u606f\u76d1\u542c",level:3},{value:"\u6d88\u606f\u63a5\u6536\u5668",id:"\u6d88\u606f\u63a5\u6536\u5668",level:3},{value:"\u53d1\u9001\u6d88\u606f",id:"\u53d1\u9001\u6d88\u606f",level:3},{value:"\u96c6\u7fa4\u4e0e\u54e8\u5175\u914d\u7f6e",id:"\u96c6\u7fa4\u4e0e\u54e8\u5175\u914d\u7f6e",level:2},{value:"\u54e8\u5175\u6a21\u5f0f",id:"\u54e8\u5175\u6a21\u5f0f",level:3},{value:"\u96c6\u7fa4\u6a21\u5f0f",id:"\u96c6\u7fa4\u6a21\u5f0f",level:3},{value:"\u5206\u5e03\u5f0f\u9501",id:"\u5206\u5e03\u5f0f\u9501",level:2},{value:"\u4f7f\u7528 RedisTemplate \u5b9e\u73b0",id:"\u4f7f\u7528-redistemplate-\u5b9e\u73b0",level:3},{value:"\u4f7f\u7528\u793a\u4f8b",id:"\u4f7f\u7528\u793a\u4f8b",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u7f13\u5b58 Key \u8bbe\u8ba1",id:"1-\u7f13\u5b58-key-\u8bbe\u8ba1",level:3},{value:"2. \u9632\u6b62\u7f13\u5b58\u7a7f\u900f",id:"2-\u9632\u6b62\u7f13\u5b58\u7a7f\u900f",level:3},{value:"3. \u9632\u6b62\u7f13\u5b58\u51fb\u7a7f",id:"3-\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f",level:3},{value:"4. \u5065\u5eb7\u68c0\u67e5",id:"4-\u5065\u5eb7\u68c0\u67e5",level:3},{value:"\u5c0f\u7ed3",id:"\u5c0f\u7ed3",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"redis-\u4e0e-spring-boot-\u96c6\u6210",children:"Redis \u4e0e Spring Boot \u96c6\u6210"})}),"\n",(0,r.jsx)(n.p,{children:"\u672c\u6587\u8be6\u7ec6\u4ecb\u7ecd Spring Boot \u4e0e Redis \u7684\u6df1\u5ea6\u96c6\u6210\uff0c\u5305\u62ec Spring Data Redis\u3001\u7f13\u5b58\u6ce8\u89e3\u3001Session \u7ba1\u7406\u7b49\u6838\u5fc3\u529f\u80fd\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u5feb\u901f\u5f00\u59cb",children:"\u5feb\u901f\u5f00\u59cb"}),"\n",(0,r.jsx)(n.h3,{id:"\u6dfb\u52a0\u4f9d\u8d56",children:"\u6dfb\u52a0\u4f9d\u8d56"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-redis</artifactId>\n</dependency>\n\n\x3c!-- \u8fde\u63a5\u6c60\uff08\u53ef\u9009\uff0c\u63a8\u8350\u4f7f\u7528\uff09 --\x3e\n<dependency>\n    <groupId>org.apache.commons</groupId>\n    <artifactId>commons-pool2</artifactId>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u57fa\u7840\u914d\u7f6e",children:"\u57fa\u7840\u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# application.yml\nspring:\n  redis:\n    host: localhost\n    port: 6379\n    password: your_password\n    database: 0\n    timeout: 3000ms\n    \n    # Lettuce \u8fde\u63a5\u6c60\u914d\u7f6e\n    lettuce:\n      pool:\n        max-active: 100    # \u6700\u5927\u8fde\u63a5\u6570\n        max-idle: 20       # \u6700\u5927\u7a7a\u95f2\u8fde\u63a5\n        min-idle: 10       # \u6700\u5c0f\u7a7a\u95f2\u8fde\u63a5\n        max-wait: 3000ms   # \u83b7\u53d6\u8fde\u63a5\u6700\u5927\u7b49\u5f85\u65f6\u95f4\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u57fa\u672c\u4f7f\u7528",children:"\u57fa\u672c\u4f7f\u7528"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Service\npublic class RedisService {\n    \n    @Autowired\n    private StringRedisTemplate stringRedisTemplate;\n    \n    public void set(String key, String value) {\n        stringRedisTemplate.opsForValue().set(key, value);\n    }\n    \n    public String get(String key) {\n        return stringRedisTemplate.opsForValue().get(key);\n    }\n    \n    public void setWithExpire(String key, String value, long timeout) {\n        stringRedisTemplate.opsForValue().set(key, value, timeout, TimeUnit.SECONDS);\n    }\n    \n    public Boolean delete(String key) {\n        return stringRedisTemplate.delete(key);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"redistemplate-\u8be6\u89e3",children:"RedisTemplate \u8be6\u89e3"}),"\n",(0,r.jsx)(n.h3,{id:"stringredistemplate-vs-redistemplate",children:"StringRedisTemplate vs RedisTemplate"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u7279\u6027"}),(0,r.jsx)(n.th,{children:"StringRedisTemplate"}),(0,r.jsx)(n.th,{children:"RedisTemplate<Object, Object>"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u5e8f\u5217\u5316"}),(0,r.jsx)(n.td,{children:"String"}),(0,r.jsx)(n.td,{children:"JdkSerializationRedisSerializer"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u53ef\u8bfb\u6027"}),(0,r.jsx)(n.td,{children:"\u597d"}),(0,r.jsx)(n.td,{children:"\u5dee\uff08\u4e8c\u8fdb\u5236\uff09"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u8de8\u8bed\u8a00"}),(0,r.jsx)(n.td,{children:"\u662f"}),(0,r.jsx)(n.td,{children:"\u5426"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u9002\u7528\u573a\u666f"}),(0,r.jsx)(n.td,{children:"\u5b57\u7b26\u4e32\u64cd\u4f5c"}),(0,r.jsx)(n.td,{children:"Java \u5bf9\u8c61\u5b58\u50a8"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49-redistemplate",children:"\u81ea\u5b9a\u4e49 RedisTemplate"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Configuration\npublic class RedisConfig {\n    \n    @Bean\n    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {\n        RedisTemplate<String, Object> template = new RedisTemplate<>();\n        template.setConnectionFactory(factory);\n        \n        // JSON \u5e8f\u5217\u5316\u5668\n        Jackson2JsonRedisSerializer<Object> jsonSerializer = \n            new Jackson2JsonRedisSerializer<>(Object.class);\n        \n        ObjectMapper mapper = new ObjectMapper();\n        mapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);\n        mapper.activateDefaultTyping(\n            LaissezFaireSubTypeValidator.instance,\n            ObjectMapper.DefaultTyping.NON_FINAL\n        );\n        jsonSerializer.setObjectMapper(mapper);\n        \n        // String \u5e8f\u5217\u5316\u5668\n        StringRedisSerializer stringSerializer = new StringRedisSerializer();\n        \n        // \u8bbe\u7f6e\u5e8f\u5217\u5316\u5668\n        template.setKeySerializer(stringSerializer);\n        template.setHashKeySerializer(stringSerializer);\n        template.setValueSerializer(jsonSerializer);\n        template.setHashValueSerializer(jsonSerializer);\n        \n        template.afterPropertiesSet();\n        return template;\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u64cd\u4f5c\u4e0d\u540c\u6570\u636e\u7c7b\u578b",children:"\u64cd\u4f5c\u4e0d\u540c\u6570\u636e\u7c7b\u578b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Service\npublic class RedisService {\n    \n    @Autowired\n    private RedisTemplate<String, Object> redisTemplate;\n    \n    // ===== String \u64cd\u4f5c =====\n    public void setString(String key, Object value) {\n        redisTemplate.opsForValue().set(key, value);\n    }\n    \n    public void setStringWithExpire(String key, Object value, long timeout) {\n        redisTemplate.opsForValue().set(key, value, timeout, TimeUnit.SECONDS);\n    }\n    \n    public Object getString(String key) {\n        return redisTemplate.opsForValue().get(key);\n    }\n    \n    public Long increment(String key, long delta) {\n        return redisTemplate.opsForValue().increment(key, delta);\n    }\n    \n    // ===== Hash \u64cd\u4f5c =====\n    public void hSet(String key, String field, Object value) {\n        redisTemplate.opsForHash().put(key, field, value);\n    }\n    \n    public void hSetAll(String key, Map<String, Object> map) {\n        redisTemplate.opsForHash().putAll(key, map);\n    }\n    \n    public Object hGet(String key, String field) {\n        return redisTemplate.opsForHash().get(key, field);\n    }\n    \n    public Map<Object, Object> hGetAll(String key) {\n        return redisTemplate.opsForHash().entries(key);\n    }\n    \n    public void hDelete(String key, Object... fields) {\n        redisTemplate.opsForHash().delete(key, fields);\n    }\n    \n    // ===== List \u64cd\u4f5c =====\n    public Long lPush(String key, Object... values) {\n        return redisTemplate.opsForList().leftPushAll(key, values);\n    }\n    \n    public Object lPop(String key) {\n        return redisTemplate.opsForList().leftPop(key);\n    }\n    \n    public List<Object> lRange(String key, long start, long end) {\n        return redisTemplate.opsForList().range(key, start, end);\n    }\n    \n    public Long lSize(String key) {\n        return redisTemplate.opsForList().size(key);\n    }\n    \n    // ===== Set \u64cd\u4f5c =====\n    public Long sAdd(String key, Object... values) {\n        return redisTemplate.opsForSet().add(key, values);\n    }\n    \n    public Set<Object> sMembers(String key) {\n        return redisTemplate.opsForSet().members(key);\n    }\n    \n    public Boolean sIsMember(String key, Object value) {\n        return redisTemplate.opsForSet().isMember(key, value);\n    }\n    \n    public Long sRemove(String key, Object... values) {\n        return redisTemplate.opsForSet().remove(key, values);\n    }\n    \n    // ===== ZSet (Sorted Set) \u64cd\u4f5c =====\n    public Boolean zAdd(String key, Object value, double score) {\n        return redisTemplate.opsForZSet().add(key, value, score);\n    }\n    \n    public Set<Object> zRange(String key, long start, long end) {\n        return redisTemplate.opsForZSet().range(key, start, end);\n    }\n    \n    public Set<Object> zReverseRange(String key, long start, long end) {\n        return redisTemplate.opsForZSet().reverseRange(key, start, end);\n    }\n    \n    public Long zRank(String key, Object value) {\n        return redisTemplate.opsForZSet().rank(key, value);\n    }\n    \n    // ===== \u901a\u7528\u64cd\u4f5c =====\n    public Boolean delete(String key) {\n        return redisTemplate.delete(key);\n    }\n    \n    public Long delete(Collection<String> keys) {\n        return redisTemplate.delete(keys);\n    }\n    \n    public Boolean expire(String key, long timeout) {\n        return redisTemplate.expire(key, timeout, TimeUnit.SECONDS);\n    }\n    \n    public Long getExpire(String key) {\n        return redisTemplate.getExpire(key, TimeUnit.SECONDS);\n    }\n    \n    public Boolean hasKey(String key) {\n        return redisTemplate.hasKey(key);\n    }\n    \n    public Set<String> keys(String pattern) {\n        return redisTemplate.keys(pattern);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u7f13\u5b58\u6ce8\u89e3",children:"\u7f13\u5b58\u6ce8\u89e3"}),"\n",(0,r.jsx)(n.h3,{id:"\u542f\u7528\u7f13\u5b58",children:"\u542f\u7528\u7f13\u5b58"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@SpringBootApplication\n@EnableCaching\npublic class Application {\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u7f13\u5b58\u914d\u7f6e",children:"\u7f13\u5b58\u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Configuration\n@EnableCaching\npublic class CacheConfig {\n    \n    @Bean\n    public CacheManager cacheManager(RedisConnectionFactory factory) {\n        // \u9ed8\u8ba4\u914d\u7f6e\n        RedisCacheConfiguration defaultConfig = RedisCacheConfiguration.defaultCacheConfig()\n            .entryTtl(Duration.ofMinutes(30))  // \u9ed8\u8ba4\u8fc7\u671f\u65f6\u95f4\n            .disableCachingNullValues()        // \u4e0d\u7f13\u5b58 null \u503c\n            .serializeKeysWith(\n                RedisSerializationContext.SerializationPair.fromSerializer(new StringRedisSerializer())\n            )\n            .serializeValuesWith(\n                RedisSerializationContext.SerializationPair.fromSerializer(new GenericJackson2JsonRedisSerializer())\n            );\n        \n        // \u7279\u5b9a\u7f13\u5b58\u914d\u7f6e\n        Map<String, RedisCacheConfiguration> cacheConfigs = new HashMap<>();\n        cacheConfigs.put("users", defaultConfig.entryTtl(Duration.ofHours(1)));\n        cacheConfigs.put("products", defaultConfig.entryTtl(Duration.ofMinutes(10)));\n        cacheConfigs.put("sessions", defaultConfig.entryTtl(Duration.ofMinutes(30)));\n        \n        return RedisCacheManager.builder(factory)\n            .cacheDefaults(defaultConfig)\n            .withInitialCacheConfigurations(cacheConfigs)\n            .build();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"cacheable---\u67e5\u8be2\u7f13\u5b58",children:"@Cacheable - \u67e5\u8be2\u7f13\u5b58"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Service\npublic class UserService {\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    /**\n     * \u67e5\u8be2\u7528\u6237\uff08\u6709\u7f13\u5b58\u5219\u8fd4\u56de\u7f13\u5b58\uff0c\u65e0\u5219\u67e5\u8be2\u6570\u636e\u5e93\u5e76\u7f13\u5b58\uff09\n     */\n    @Cacheable(value = "users", key = "#id")\n    public User findById(Long id) {\n        return userRepository.findById(id).orElse(null);\n    }\n    \n    /**\n     * \u6761\u4ef6\u7f13\u5b58\uff08\u4ec5\u7f13\u5b58\u7528\u6237\u540d\u957f\u5ea6\u5927\u4e8e 2 \u7684\uff09\n     */\n    @Cacheable(value = "users", key = "#username", condition = "#username.length() > 2")\n    public User findByUsername(String username) {\n        return userRepository.findByUsername(username);\n    }\n    \n    /**\n     * \u7ed3\u679c\u6761\u4ef6\uff08\u4ec5\u7f13\u5b58\u975e\u7a7a\u7ed3\u679c\uff09\n     */\n    @Cacheable(value = "users", key = "#id", unless = "#result == null")\n    public User findByIdNullable(Long id) {\n        return userRepository.findById(id).orElse(null);\n    }\n    \n    /**\n     * \u590d\u6742 Key\n     */\n    @Cacheable(value = "users", key = "\'user:\' + #id + \':\' + #status")\n    public User findByIdAndStatus(Long id, String status) {\n        return userRepository.findByIdAndStatus(id, status);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"cacheput---\u66f4\u65b0\u7f13\u5b58",children:"@CachePut - \u66f4\u65b0\u7f13\u5b58"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'/**\n * \u66f4\u65b0\u7528\u6237\uff08\u540c\u65f6\u66f4\u65b0\u7f13\u5b58\uff09\n */\n@CachePut(value = "users", key = "#user.id")\npublic User update(User user) {\n    return userRepository.save(user);\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"cacheevict---\u5220\u9664\u7f13\u5b58",children:"@CacheEvict - \u5220\u9664\u7f13\u5b58"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'/**\n * \u5220\u9664\u7528\u6237\uff08\u540c\u65f6\u5220\u9664\u7f13\u5b58\uff09\n */\n@CacheEvict(value = "users", key = "#id")\npublic void deleteById(Long id) {\n    userRepository.deleteById(id);\n}\n\n/**\n * \u6e05\u7a7a\u6240\u6709\u7528\u6237\u7f13\u5b58\n */\n@CacheEvict(value = "users", allEntries = true)\npublic void clearCache() {\n    // \u4ec5\u6e05\u9664\u7f13\u5b58\n}\n\n/**\n * \u5728\u65b9\u6cd5\u6267\u884c\u524d\u5220\u9664\u7f13\u5b58\n */\n@CacheEvict(value = "users", key = "#id", beforeInvocation = true)\npublic void deleteWithPreEvict(Long id) {\n    userRepository.deleteById(id);\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"caching---\u7ec4\u5408\u6ce8\u89e3",children:"@Caching - \u7ec4\u5408\u6ce8\u89e3"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'/**\n * \u7ec4\u5408\u591a\u4e2a\u7f13\u5b58\u64cd\u4f5c\n */\n@Caching(\n    cacheable = {\n        @Cacheable(value = "users", key = "#id")\n    },\n    put = {\n        @CachePut(value = "users", key = "#result.username")\n    },\n    evict = {\n        @CacheEvict(value = "userList", allEntries = true)\n    }\n)\npublic User findAndCacheMultiple(Long id) {\n    return userRepository.findById(id).orElse(null);\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49-keygenerator",children:"\u81ea\u5b9a\u4e49 KeyGenerator"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class CacheConfig {\n    \n    @Bean("customKeyGenerator")\n    public KeyGenerator keyGenerator() {\n        return (target, method, params) -> {\n            StringBuilder sb = new StringBuilder();\n            sb.append(target.getClass().getSimpleName());\n            sb.append(":");\n            sb.append(method.getName());\n            sb.append(":");\n            for (Object param : params) {\n                sb.append(param.toString());\n                sb.append("_");\n            }\n            return sb.toString();\n        };\n    }\n}\n\n// \u4f7f\u7528\n@Cacheable(value = "users", keyGenerator = "customKeyGenerator")\npublic User findByConditions(Long id, String status) {\n    // ...\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"spring-session-redis",children:"Spring Session Redis"}),"\n",(0,r.jsx)(n.h3,{id:"\u6dfb\u52a0\u4f9d\u8d56-1",children:"\u6dfb\u52a0\u4f9d\u8d56"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.session</groupId>\n    <artifactId>spring-session-data-redis</artifactId>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spring:\n  session:\n    store-type: redis\n    timeout: 30m\n    redis:\n      namespace: spring:session\n      flush-mode: on_save\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Configuration\n@EnableRedisHttpSession(maxInactiveIntervalInSeconds = 1800)\npublic class SessionConfig {\n    // Session \u8fc7\u671f\u65f6\u95f4 30 \u5206\u949f\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4f7f\u7528-session",children:"\u4f7f\u7528 Session"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@RestController\npublic class SessionController {\n    \n    @GetMapping("/session/set")\n    public String setSession(HttpSession session) {\n        session.setAttribute("user", "\u5f20\u4e09");\n        session.setAttribute("loginTime", System.currentTimeMillis());\n        return "Session \u8bbe\u7f6e\u6210\u529f";\n    }\n    \n    @GetMapping("/session/get")\n    public Map<String, Object> getSession(HttpSession session) {\n        Map<String, Object> result = new HashMap<>();\n        result.put("user", session.getAttribute("user"));\n        result.put("loginTime", session.getAttribute("loginTime"));\n        result.put("sessionId", session.getId());\n        return result;\n    }\n    \n    @GetMapping("/session/invalidate")\n    public String invalidateSession(HttpSession session) {\n        session.invalidate();\n        return "Session \u5df2\u9500\u6bc1";\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49-session-\u5e8f\u5217\u5316",children:"\u81ea\u5b9a\u4e49 Session \u5e8f\u5217\u5316"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Configuration\npublic class SessionConfig {\n    \n    @Bean\n    public RedisSerializer<Object> springSessionDefaultRedisSerializer() {\n        return new GenericJackson2JsonRedisSerializer();\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6d88\u606f\u8ba2\u9605",children:"\u6d88\u606f\u8ba2\u9605"}),"\n",(0,r.jsx)(n.h3,{id:"\u914d\u7f6e\u6d88\u606f\u76d1\u542c",children:"\u914d\u7f6e\u6d88\u606f\u76d1\u542c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class RedisMessageConfig {\n    \n    @Bean\n    public RedisMessageListenerContainer container(\n            RedisConnectionFactory factory,\n            MessageListenerAdapter listenerAdapter) {\n        \n        RedisMessageListenerContainer container = new RedisMessageListenerContainer();\n        container.setConnectionFactory(factory);\n        \n        // \u8ba2\u9605 channel\n        container.addMessageListener(listenerAdapter, new ChannelTopic("channel:orders"));\n        container.addMessageListener(listenerAdapter, new PatternTopic("channel:*"));\n        \n        return container;\n    }\n    \n    @Bean\n    public MessageListenerAdapter listenerAdapter(RedisMessageReceiver receiver) {\n        return new MessageListenerAdapter(receiver, "onMessage");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u6d88\u606f\u63a5\u6536\u5668",children:"\u6d88\u606f\u63a5\u6536\u5668"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Component\npublic class RedisMessageReceiver {\n    \n    private static final Logger log = LoggerFactory.getLogger(RedisMessageReceiver.class);\n    \n    public void onMessage(String message, String channel) {\n        log.info("\u6536\u5230\u6d88\u606f: channel={}, message={}", channel, message);\n        // \u5904\u7406\u6d88\u606f\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u53d1\u9001\u6d88\u606f",children:"\u53d1\u9001\u6d88\u606f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Service\npublic class RedisPublisher {\n    \n    @Autowired\n    private StringRedisTemplate template;\n    \n    public void publish(String channel, String message) {\n        template.convertAndSend(channel, message);\n    }\n}\n\n// \u4f7f\u7528\nredisPublisher.publish("channel:orders", "\u65b0\u8ba2\u5355: #12345");\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u96c6\u7fa4\u4e0e\u54e8\u5175\u914d\u7f6e",children:"\u96c6\u7fa4\u4e0e\u54e8\u5175\u914d\u7f6e"}),"\n",(0,r.jsx)(n.h3,{id:"\u54e8\u5175\u6a21\u5f0f",children:"\u54e8\u5175\u6a21\u5f0f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spring:\n  redis:\n    sentinel:\n      master: mymaster\n      nodes:\n        - 192.168.1.101:26379\n        - 192.168.1.102:26379\n        - 192.168.1.103:26379\n    password: your_password\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u96c6\u7fa4\u6a21\u5f0f",children:"\u96c6\u7fa4\u6a21\u5f0f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"spring:\n  redis:\n    cluster:\n      nodes:\n        - 192.168.1.101:7001\n        - 192.168.1.102:7002\n        - 192.168.1.103:7003\n      max-redirects: 3\n    password: your_password\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5206\u5e03\u5f0f\u9501",children:"\u5206\u5e03\u5f0f\u9501"}),"\n",(0,r.jsx)(n.h3,{id:"\u4f7f\u7528-redistemplate-\u5b9e\u73b0",children:"\u4f7f\u7528 RedisTemplate \u5b9e\u73b0"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Component\npublic class RedisLock {\n    \n    @Autowired\n    private StringRedisTemplate template;\n    \n    /**\n     * \u83b7\u53d6\u9501\n     */\n    public boolean lock(String key, String value, long expireSeconds) {\n        Boolean success = template.opsForValue().setIfAbsent(\n            key, value, expireSeconds, TimeUnit.SECONDS\n        );\n        return Boolean.TRUE.equals(success);\n    }\n    \n    /**\n     * \u91ca\u653e\u9501\uff08Lua \u811a\u672c\u4fdd\u8bc1\u539f\u5b50\u6027\uff09\n     */\n    public boolean unlock(String key, String value) {\n        String script = \n            "if redis.call(\'get\', KEYS[1]) == ARGV[1] then " +\n            "    return redis.call(\'del\', KEYS[1]) " +\n            "else " +\n            "    return 0 " +\n            "end";\n        \n        Long result = template.execute(\n            new DefaultRedisScript<>(script, Long.class),\n            Collections.singletonList(key),\n            value\n        );\n        return Long.valueOf(1).equals(result);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u4f7f\u7528\u793a\u4f8b",children:"\u4f7f\u7528\u793a\u4f8b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Service\npublic class OrderService {\n    \n    @Autowired\n    private RedisLock redisLock;\n    \n    public void createOrder(Long productId) {\n        String lockKey = "lock:product:" + productId;\n        String lockValue = UUID.randomUUID().toString();\n        \n        if (redisLock.lock(lockKey, lockValue, 30)) {\n            try {\n                // \u4e1a\u52a1\u903b\u8f91\n                doCreateOrder(productId);\n            } finally {\n                redisLock.unlock(lockKey, lockValue);\n            }\n        } else {\n            throw new RuntimeException("\u83b7\u53d6\u9501\u5931\u8d25");\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsx)(n.h3,{id:"1-\u7f13\u5b58-key-\u8bbe\u8ba1",children:"1. \u7f13\u5b58 Key \u8bbe\u8ba1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u89c4\u8303\u7684 Key \u547d\u540d\npublic class CacheKeyConstants {\n    public static final String USER_PREFIX = "user:";\n    public static final String ORDER_PREFIX = "order:";\n    public static final String PRODUCT_PREFIX = "product:";\n    \n    public static String userKey(Long id) {\n        return USER_PREFIX + id;\n    }\n    \n    public static String orderKey(Long id) {\n        return ORDER_PREFIX + id;\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2-\u9632\u6b62\u7f13\u5b58\u7a7f\u900f",children:"2. \u9632\u6b62\u7f13\u5b58\u7a7f\u900f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Cacheable(value = "users", key = "#id", unless = "#result == null")\npublic User findById(Long id) {\n    User user = userRepository.findById(id).orElse(null);\n    if (user == null) {\n        // \u7f13\u5b58\u7a7a\u5bf9\u8c61\uff0c\u8bbe\u7f6e\u8f83\u77ed\u8fc7\u671f\u65f6\u95f4\n        redisTemplate.opsForValue().set("users:" + id, "null", 60, TimeUnit.SECONDS);\n    }\n    return user;\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f",children:"3. \u9632\u6b62\u7f13\u5b58\u51fb\u7a7f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public User findByIdWithLock(Long id) {\n    String key = "users:" + id;\n    User user = (User) redisTemplate.opsForValue().get(key);\n    \n    if (user == null) {\n        String lockKey = "lock:users:" + id;\n        if (redisLock.lock(lockKey, "1", 10)) {\n            try {\n                // \u53cc\u91cd\u68c0\u67e5\n                user = (User) redisTemplate.opsForValue().get(key);\n                if (user == null) {\n                    user = userRepository.findById(id).orElse(null);\n                    if (user != null) {\n                        redisTemplate.opsForValue().set(key, user, 1, TimeUnit.HOURS);\n                    }\n                }\n            } finally {\n                redisLock.unlock(lockKey, "1");\n            }\n        }\n    }\n    return user;\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"4-\u5065\u5eb7\u68c0\u67e5",children:"4. \u5065\u5eb7\u68c0\u67e5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Component\npublic class RedisHealthIndicator implements HealthIndicator {\n    \n    @Autowired\n    private StringRedisTemplate template;\n    \n    @Override\n    public Health health() {\n        try {\n            String result = template.getConnectionFactory()\n                .getConnection().ping();\n            if ("PONG".equals(result)) {\n                return Health.up()\n                    .withDetail("ping", "PONG")\n                    .build();\n            }\n        } catch (Exception e) {\n            return Health.down()\n                .withException(e)\n                .build();\n        }\n        return Health.down().build();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5c0f\u7ed3",children:"\u5c0f\u7ed3"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u529f\u80fd"}),(0,r.jsx)(n.th,{children:"\u5173\u952e\u7c7b/\u6ce8\u89e3"}),(0,r.jsx)(n.th,{children:"\u4f7f\u7528\u573a\u666f"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u57fa\u7840\u64cd\u4f5c"}),(0,r.jsx)(n.td,{children:"RedisTemplate"}),(0,r.jsx)(n.td,{children:"\u901a\u7528 Redis \u64cd\u4f5c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u7f13\u5b58"}),(0,r.jsx)(n.td,{children:"@Cacheable, @CacheEvict"}),(0,r.jsx)(n.td,{children:"\u65b9\u6cd5\u7ed3\u679c\u7f13\u5b58"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Session"}),(0,r.jsx)(n.td,{children:"@EnableRedisHttpSession"}),(0,r.jsx)(n.td,{children:"\u5206\u5e03\u5f0f Session"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u6d88\u606f"}),(0,r.jsx)(n.td,{children:"RedisMessageListenerContainer"}),(0,r.jsx)(n.td,{children:"\u53d1\u5e03\u8ba2\u9605"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u5206\u5e03\u5f0f\u9501"}),(0,r.jsx)(n.td,{children:"setIfAbsent + Lua"}),(0,r.jsx)(n.td,{children:"\u5e76\u53d1\u63a7\u5236"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u6700\u4f73\u5b9e\u8df5"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 \u4f7f\u7528 JSON \u5e8f\u5217\u5316\uff0c\u63d0\u9ad8\u53ef\u8bfb\u6027"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 \u914d\u7f6e\u5408\u7406\u7684\u8fde\u63a5\u6c60\u53c2\u6570"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 \u4f7f\u7528\u7f13\u5b58\u6ce8\u89e3\u7b80\u5316\u4ee3\u7801"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 \u6ce8\u610f\u7f13\u5b58\u7a7f\u900f\u3001\u51fb\u7a7f\u3001\u96ea\u5d29\u95ee\u9898"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 \u5b9e\u73b0\u5065\u5eb7\u68c0\u67e5\u548c\u76d1\u63a7"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},48885:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>a});var s=i(99378);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);
"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[16953],{8985:(n,e,o)=>{o.r(e),o.d(e,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"docker/docker-init","title":"Docker Init","description":"\u4f7f\u7528 docker init \u81ea\u52a8\u751f\u6210 Dockerfile \u548c Compose \u914d\u7f6e","source":"@site/docs/docker/docker-init.md","sourceDirName":"docker","slug":"/docker/docker-init","permalink":"/docs/docker/docker-init","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/docker/docker-init.md","tags":[],"version":"current","sidebarPosition":30,"frontMatter":{"sidebar_position":30,"title":"Docker Init","description":"\u4f7f\u7528 docker init \u81ea\u52a8\u751f\u6210 Dockerfile \u548c Compose \u914d\u7f6e"}}');var r=o(22714),i=o(48885);const s={sidebar_position:30,title:"Docker Init",description:"\u4f7f\u7528 docker init \u81ea\u52a8\u751f\u6210 Dockerfile \u548c Compose \u914d\u7f6e"},c="Docker Init",d={},l=[{value:"\u57fa\u672c\u4f7f\u7528",id:"\u57fa\u672c\u4f7f\u7528",level:2},{value:"\u652f\u6301\u7684\u9879\u76ee\u7c7b\u578b",id:"\u652f\u6301\u7684\u9879\u76ee\u7c7b\u578b",level:2},{value:"\u751f\u6210\u793a\u4f8b",id:"\u751f\u6210\u793a\u4f8b",level:2},{value:"Node.js \u9879\u76ee",id:"nodejs-\u9879\u76ee",level:3},{value:"Python \u9879\u76ee",id:"python-\u9879\u76ee",level:3},{value:"Go \u9879\u76ee",id:"go-\u9879\u76ee",level:3},{value:"\u751f\u6210\u7684 compose.yaml",id:"\u751f\u6210\u7684-composeyaml",level:2},{value:"\u751f\u6210\u7684 .dockerignore",id:"\u751f\u6210\u7684-dockerignore",level:2},{value:"\u81ea\u5b9a\u4e49\u6a21\u677f",id:"\u81ea\u5b9a\u4e49\u6a21\u677f",level:2},{value:"\u6700\u4f73\u5b9e\u8df5\u7279\u6027",id:"\u6700\u4f73\u5b9e\u8df5\u7279\u6027",level:2}];function a(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"docker-init",children:"Docker Init"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"docker init"})," \u662f Docker \u5b98\u65b9\u63d0\u4f9b\u7684 CLI \u5de5\u5177\uff0c\u53ef\u4ee5\u81ea\u52a8\u68c0\u6d4b\u9879\u76ee\u7c7b\u578b\u5e76\u751f\u6210\u6700\u4f73\u5b9e\u8df5\u7684 Dockerfile \u548c docker-compose.yml\u3002"]}),"\n",(0,r.jsx)(e.h2,{id:"\u57fa\u672c\u4f7f\u7528",children:"\u57fa\u672c\u4f7f\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u5728\u9879\u76ee\u6839\u76ee\u5f55\u8fd0\u884c\ndocker init\n\n# \u4ea4\u4e92\u5f0f\u9009\u62e9\u9879\u76ee\u7c7b\u578b\n? What application platform does your project use?\n  Go\n  Python\n  Node\n  Rust\n  ASP.NET Core\n  PHP with Apache\n  Java\n  Other\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u652f\u6301\u7684\u9879\u76ee\u7c7b\u578b",children:"\u652f\u6301\u7684\u9879\u76ee\u7c7b\u578b"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u7c7b\u578b"}),(0,r.jsx)(e.th,{children:"\u68c0\u6d4b\u65b9\u5f0f"}),(0,r.jsx)(e.th,{children:"\u751f\u6210\u6587\u4ef6"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Go"}),(0,r.jsx)(e.td,{children:"go.mod"}),(0,r.jsx)(e.td,{children:"Dockerfile, compose.yaml"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Python"}),(0,r.jsx)(e.td,{children:"requirements.txt, pyproject.toml"}),(0,r.jsx)(e.td,{children:"Dockerfile, compose.yaml"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Node"}),(0,r.jsx)(e.td,{children:"package.json"}),(0,r.jsx)(e.td,{children:"Dockerfile, compose.yaml"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Rust"}),(0,r.jsx)(e.td,{children:"Cargo.toml"}),(0,r.jsx)(e.td,{children:"Dockerfile, compose.yaml"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"ASP.NET"}),(0,r.jsx)(e.td,{children:"*.csproj"}),(0,r.jsx)(e.td,{children:"Dockerfile, compose.yaml"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"PHP"}),(0,r.jsx)(e.td,{children:"composer.json"}),(0,r.jsx)(e.td,{children:"Dockerfile, compose.yaml"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Java"}),(0,r.jsx)(e.td,{children:"pom.xml, build.gradle"}),(0,r.jsx)(e.td,{children:"Dockerfile, compose.yaml"})]})]})]}),"\n",(0,r.jsx)(e.h2,{id:"\u751f\u6210\u793a\u4f8b",children:"\u751f\u6210\u793a\u4f8b"}),"\n",(0,r.jsx)(e.h3,{id:"nodejs-\u9879\u76ee",children:"Node.js \u9879\u76ee"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ docker init\n\nWelcome to the Docker Init CLI!\n\nThis utility will walk you through creating the following files:\n  - .dockerignore\n  - Dockerfile\n  - compose.yaml\n\n? What application platform does your project use? Node\n? What version of Node do you want to use? 18\n? Which package manager do you want to use? npm\n? What command do you want to use to start the app? npm start\n? What port does your server listen on? 3000\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u751f\u6210\u7684 Dockerfile\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-dockerfile",children:"# syntax=docker/dockerfile:1\n\nARG NODE_VERSION=18\n\nFROM node:${NODE_VERSION}-alpine\n\nENV NODE_ENV production\n\nWORKDIR /usr/src/app\n\nRUN --mount=type=bind,source=package.json,target=package.json \\\n    --mount=type=bind,source=package-lock.json,target=package-lock.json \\\n    --mount=type=cache,target=/root/.npm \\\n    npm ci --omit=dev\n\nUSER node\n\nCOPY . .\n\nEXPOSE 3000\n\nCMD npm start\n"})}),"\n",(0,r.jsx)(e.h3,{id:"python-\u9879\u76ee",children:"Python \u9879\u76ee"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ docker init\n\n? What application platform does your project use? Python\n? What version of Python do you want to use? 3.11\n? What port does your server listen on? 8000\n? What is the command to run your app? python -m uvicorn main:app --host 0.0.0.0\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u751f\u6210\u7684 Dockerfile\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-dockerfile",children:'# syntax=docker/dockerfile:1\n\nARG PYTHON_VERSION=3.11\nFROM python:${PYTHON_VERSION}-slim as base\n\nENV PYTHONDONTWRITEBYTECODE=1\nENV PYTHONUNBUFFERED=1\n\nWORKDIR /app\n\nARG UID=10001\nRUN adduser \\\n    --disabled-password \\\n    --gecos "" \\\n    --home "/nonexistent" \\\n    --shell "/sbin/nologin" \\\n    --no-create-home \\\n    --uid "${UID}" \\\n    appuser\n\nRUN --mount=type=cache,target=/root/.cache/pip \\\n    --mount=type=bind,source=requirements.txt,target=requirements.txt \\\n    python -m pip install -r requirements.txt\n\nUSER appuser\n\nCOPY . .\n\nEXPOSE 8000\n\nCMD python -m uvicorn main:app --host 0.0.0.0\n'})}),"\n",(0,r.jsx)(e.h3,{id:"go-\u9879\u76ee",children:"Go \u9879\u76ee"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-dockerfile",children:'# syntax=docker/dockerfile:1\n\nARG GO_VERSION=1.21\nFROM golang:${GO_VERSION} AS build\nWORKDIR /src\n\nRUN --mount=type=cache,target=/go/pkg/mod/ \\\n    --mount=type=bind,source=go.sum,target=go.sum \\\n    --mount=type=bind,source=go.mod,target=go.mod \\\n    go mod download -x\n\nRUN --mount=type=cache,target=/go/pkg/mod/ \\\n    --mount=type=bind,target=. \\\n    CGO_ENABLED=0 go build -o /bin/server .\n\nFROM alpine:latest AS final\n\nRUN --mount=type=cache,target=/var/cache/apk \\\n    apk --update add ca-certificates tzdata && \\\n    update-ca-certificates\n\nARG UID=10001\nRUN adduser \\\n    --disabled-password \\\n    --gecos "" \\\n    --home "/nonexistent" \\\n    --shell "/sbin/nologin" \\\n    --no-create-home \\\n    --uid "${UID}" \\\n    appuser\nUSER appuser\n\nCOPY --from=build /bin/server /bin/\n\nEXPOSE 8080\n\nENTRYPOINT [ "/bin/server" ]\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u751f\u6210\u7684-composeyaml",children:"\u751f\u6210\u7684 compose.yaml"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"services:\n  server:\n    build:\n      context: .\n    ports:\n      - 3000:3000\n    environment:\n      NODE_ENV: production\n    develop:\n      watch:\n        - action: rebuild\n          path: .\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u751f\u6210\u7684-dockerignore",children:"\u751f\u6210\u7684 .dockerignore"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-plaintext",children:"# Include any files or directories that you don't want to be copied to your\n# container here (e.g., local build artifacts, temporary files, etc.).\n#\n# For more help, visit the .dockerignore file reference guide at\n# https://docs.docker.com/go/build-context-dockerignore/\n\n**/.DS_Store\n**/.classpath\n**/.dockerignore\n**/.env\n**/.git\n**/.gitignore\n**/.project\n**/.settings\n**/.toolstarget\n**/.vs\n**/.vscode\n**/*.*proj.user\n**/*.dbmdl\n**/*.jfm\n**/bin\n**/charts\n**/docker-compose*\n**/compose*\n**/Dockerfile*\n**/node_modules\n**/npm-debug.log\n**/obj\n**/secrets.dev.yaml\n**/values.dev.yaml\nLICENSE\nREADME.md\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u81ea\u5b9a\u4e49\u6a21\u677f",children:"\u81ea\u5b9a\u4e49\u6a21\u677f"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u53ef\u7528\u9009\u9879\ndocker init --help\n\n# \u6307\u5b9a\u9879\u76ee\u7c7b\u578b\uff08\u8df3\u8fc7\u4ea4\u4e92\uff09\ndocker init --type node\n\n# \u6307\u5b9a\u8f93\u51fa\u76ee\u5f55\ndocker init --output ./docker\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5\u7279\u6027",children:"\u6700\u4f73\u5b9e\u8df5\u7279\u6027"}),"\n",(0,r.jsx)(e.p,{children:"docker init \u751f\u6210\u7684\u914d\u7f6e\u5305\u542b\u591a\u9879\u6700\u4f73\u5b9e\u8df5\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u591a\u9636\u6bb5\u6784\u5efa"})," - \u51cf\u5c0f\u955c\u50cf\u4f53\u79ef"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u975e root \u7528\u6237"})," - \u63d0\u5347\u5b89\u5168\u6027"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"BuildKit \u7f13\u5b58"})," - \u52a0\u901f\u6784\u5efa"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:".dockerignore"})," - \u4f18\u5316\u6784\u5efa\u4e0a\u4e0b\u6587"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5065\u5eb7\u68c0\u67e5"})," - \u5bb9\u5668\u5065\u5eb7\u76d1\u63a7"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u73af\u5883\u53d8\u91cf"})," - \u914d\u7f6e\u5916\u90e8\u5316"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(a,{...n})}):a(n)}},48885:(n,e,o)=>{o.d(e,{R:()=>s,x:()=>c});var t=o(99378);const r={},i=t.createContext(r);function s(n){const e=t.useContext(i);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),t.createElement(i.Provider,{value:e},n.children)}}}]);
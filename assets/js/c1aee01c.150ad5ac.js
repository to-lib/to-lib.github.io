"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[16730],{46119:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"kubernetes/networking","title":"\u7f51\u7edc\u8be6\u89e3","description":"Kubernetes \u7f51\u7edc\u6a21\u578b\u4e0e CNI \u63d2\u4ef6\u8be6\u89e3","source":"@site/docs/kubernetes/networking.md","sourceDirName":"kubernetes","slug":"/kubernetes/networking","permalink":"/docs/kubernetes/networking","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/kubernetes/networking.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"\u7f51\u7edc\u8be6\u89e3","description":"Kubernetes \u7f51\u7edc\u6a21\u578b\u4e0e CNI \u63d2\u4ef6\u8be6\u89e3"},"sidebar":"kubernetes","previous":{"title":"\u5b58\u50a8\u7ba1\u7406","permalink":"/docs/kubernetes/storage"},"next":{"title":"RBAC \u6743\u9650\u63a7\u5236","permalink":"/docs/kubernetes/rbac"}}');var i=s(22714),l=s(48885);const t={sidebar_position:7,title:"\u7f51\u7edc\u8be6\u89e3",description:"Kubernetes \u7f51\u7edc\u6a21\u578b\u4e0e CNI \u63d2\u4ef6\u8be6\u89e3"},d="Kubernetes \u7f51\u7edc\u8be6\u89e3",c={},a=[{value:"\u7f51\u7edc\u6a21\u578b",id:"\u7f51\u7edc\u6a21\u578b",level:2},{value:"CNI \u63d2\u4ef6",id:"cni-\u63d2\u4ef6",level:2},{value:"\u5e38\u7528 CNI \u63d2\u4ef6\u5bf9\u6bd4",id:"\u5e38\u7528-cni-\u63d2\u4ef6\u5bf9\u6bd4",level:3},{value:"Calico \u5b89\u88c5",id:"calico-\u5b89\u88c5",level:3},{value:"Flannel \u5b89\u88c5",id:"flannel-\u5b89\u88c5",level:3},{value:"Cilium \u5b89\u88c5",id:"cilium-\u5b89\u88c5",level:3},{value:"kube-proxy \u6a21\u5f0f",id:"kube-proxy-\u6a21\u5f0f",level:2},{value:"iptables \u6a21\u5f0f\uff08\u9ed8\u8ba4\uff09",id:"iptables-\u6a21\u5f0f\u9ed8\u8ba4",level:3},{value:"IPVS \u6a21\u5f0f",id:"ipvs-\u6a21\u5f0f",level:3},{value:"\u6a21\u5f0f\u5bf9\u6bd4",id:"\u6a21\u5f0f\u5bf9\u6bd4",level:3},{value:"\u7f51\u7edc\u7b56\u7565",id:"\u7f51\u7edc\u7b56\u7565",level:2},{value:"\u9ed8\u8ba4\u62d2\u7edd\u6240\u6709\u5165\u7ad9\u6d41\u91cf",id:"\u9ed8\u8ba4\u62d2\u7edd\u6240\u6709\u5165\u7ad9\u6d41\u91cf",level:3},{value:"\u5141\u8bb8\u7279\u5b9a\u547d\u540d\u7a7a\u95f4\u8bbf\u95ee",id:"\u5141\u8bb8\u7279\u5b9a\u547d\u540d\u7a7a\u95f4\u8bbf\u95ee",level:3},{value:"\u9650\u5236\u51fa\u7ad9\u6d41\u91cf",id:"\u9650\u5236\u51fa\u7ad9\u6d41\u91cf",level:3},{value:"\u591a\u6761\u4ef6\u7ec4\u5408",id:"\u591a\u6761\u4ef6\u7ec4\u5408",level:3},{value:"Ingress Controller",id:"ingress-controller",level:2},{value:"NGINX Ingress Controller \u5b89\u88c5",id:"nginx-ingress-controller-\u5b89\u88c5",level:3},{value:"Ingress \u914d\u7f6e\u793a\u4f8b",id:"ingress-\u914d\u7f6e\u793a\u4f8b",level:3},{value:"\u5e38\u7528 Ingress \u6ce8\u89e3",id:"\u5e38\u7528-ingress-\u6ce8\u89e3",level:3},{value:"DNS \u670d\u52a1",id:"dns-\u670d\u52a1",level:2},{value:"CoreDNS \u914d\u7f6e",id:"coredns-\u914d\u7f6e",level:3},{value:"DNS \u8c03\u8bd5",id:"dns-\u8c03\u8bd5",level:3},{value:"\u7f51\u7edc\u6392\u67e5",id:"\u7f51\u7edc\u6392\u67e5",level:2},{value:"\u5e38\u7528\u6392\u67e5\u547d\u4ee4",id:"\u5e38\u7528\u6392\u67e5\u547d\u4ee4",level:3},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:3}];function o(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"kubernetes-\u7f51\u7edc\u8be6\u89e3",children:"Kubernetes \u7f51\u7edc\u8be6\u89e3"})}),"\n",(0,i.jsx)(e.h2,{id:"\u7f51\u7edc\u6a21\u578b",children:"\u7f51\u7edc\u6a21\u578b"}),"\n",(0,i.jsx)(e.p,{children:"Kubernetes \u7f51\u7edc\u6a21\u578b\u57fa\u4e8e\u4ee5\u4e0b\u6838\u5fc3\u539f\u5219\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6bcf\u4e2a Pod \u6709\u72ec\u7acb IP"}),"\uff1aPod \u5185\u6240\u6709\u5bb9\u5668\u5171\u4eab\u7f51\u7edc\u547d\u540d\u7a7a\u95f4"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Pod \u95f4\u76f4\u63a5\u901a\u4fe1"}),"\uff1a\u6240\u6709 Pod \u4e4b\u95f4\u53ef\u4ee5\u4e0d\u7ecf\u8fc7 NAT \u76f4\u63a5\u901a\u4fe1"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8282\u70b9\u4e0e Pod \u4e92\u901a"}),"\uff1a\u8282\u70b9\u53ef\u4ee5\u76f4\u63a5\u4e0e\u6240\u6709 Pod \u901a\u4fe1"]}),"\n"]}),"\n",(0,i.jsx)(e.mermaid,{value:'graph TB\n    subgraph "Node 1"\n        P1[Pod 1<br/>10.244.1.2]\n        P2[Pod 2<br/>10.244.1.3]\n    end\n\n    subgraph "Node 2"\n        P3[Pod 3<br/>10.244.2.2]\n        P4[Pod 4<br/>10.244.2.3]\n    end\n\n    P1 <--\x3e P3\n    P2 <--\x3e P4\n    P1 <--\x3e P2\n    P3 <--\x3e P4'}),"\n",(0,i.jsx)(e.h2,{id:"cni-\u63d2\u4ef6",children:"CNI \u63d2\u4ef6"}),"\n",(0,i.jsx)(e.p,{children:"CNI\uff08Container Network Interface\uff09\u662f Kubernetes \u7f51\u7edc\u7684\u6807\u51c6\u63a5\u53e3\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"\u5e38\u7528-cni-\u63d2\u4ef6\u5bf9\u6bd4",children:"\u5e38\u7528 CNI \u63d2\u4ef6\u5bf9\u6bd4"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u63d2\u4ef6"}),(0,i.jsx)(e.th,{children:"\u7279\u70b9"}),(0,i.jsx)(e.th,{children:"\u9002\u7528\u573a\u666f"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Calico"})}),(0,i.jsx)(e.td,{children:"\u9ad8\u6027\u80fd\uff0c\u652f\u6301\u7f51\u7edc\u7b56\u7565"}),(0,i.jsx)(e.td,{children:"\u751f\u4ea7\u73af\u5883\u9996\u9009"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Flannel"})}),(0,i.jsx)(e.td,{children:"\u7b80\u5355\u6613\u7528\uff0c\u914d\u7f6e\u5c11"}),(0,i.jsx)(e.td,{children:"\u5b66\u4e60\u548c\u5c0f\u89c4\u6a21\u96c6\u7fa4"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Cilium"})}),(0,i.jsx)(e.td,{children:"\u57fa\u4e8e eBPF\uff0c\u529f\u80fd\u5f3a\u5927"}),(0,i.jsx)(e.td,{children:"\u5927\u89c4\u6a21\u3001\u9ad8\u6027\u80fd\u9700\u6c42"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Weave"})}),(0,i.jsx)(e.td,{children:"\u52a0\u5bc6\u901a\u4fe1\uff0c\u6613\u4e8e\u5b89\u88c5"}),(0,i.jsx)(e.td,{children:"\u5b89\u5168\u8981\u6c42\u9ad8\u7684\u573a\u666f"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"calico-\u5b89\u88c5",children:"Calico \u5b89\u88c5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5 Calico\nkubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.26.0/manifests/calico.yaml\n\n# \u67e5\u770b Calico \u72b6\u6001\nkubectl get pods -n kube-system -l k8s-app=calico-node\n\n# \u5b89\u88c5 calicoctl\ncurl -L https://github.com/projectcalico/calico/releases/download/v3.26.0/calicoctl-linux-amd64 -o calicoctl\nchmod +x calicoctl\nsudo mv calicoctl /usr/local/bin/\n\n# \u67e5\u770b\u8282\u70b9\u72b6\u6001\ncalicoctl node status\n"})}),"\n",(0,i.jsx)(e.h3,{id:"flannel-\u5b89\u88c5",children:"Flannel \u5b89\u88c5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u521d\u59cb\u5316\u96c6\u7fa4\u65f6\u6307\u5b9a Pod \u7f51\u6bb5\nkubeadm init --pod-network-cidr=10.244.0.0/16\n\n# \u5b89\u88c5 Flannel\nkubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml\n\n# \u67e5\u770b Flannel \u72b6\u6001\nkubectl get pods -n kube-flannel\n"})}),"\n",(0,i.jsx)(e.h3,{id:"cilium-\u5b89\u88c5",children:"Cilium \u5b89\u88c5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u4f7f\u7528 Cilium CLI \u5b89\u88c5\ncurl -L --remote-name https://github.com/cilium/cilium-cli/releases/latest/download/cilium-linux-amd64.tar.gz\ntar xzvfC cilium-linux-amd64.tar.gz /usr/local/bin\n\n# \u5b89\u88c5 Cilium\ncilium install\n\n# \u67e5\u770b\u72b6\u6001\ncilium status\n\n# \u8fde\u901a\u6027\u6d4b\u8bd5\ncilium connectivity test\n"})}),"\n",(0,i.jsx)(e.h2,{id:"kube-proxy-\u6a21\u5f0f",children:"kube-proxy \u6a21\u5f0f"}),"\n",(0,i.jsx)(e.p,{children:"kube-proxy \u8d1f\u8d23\u5b9e\u73b0 Service \u7684\u8d1f\u8f7d\u5747\u8861\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"iptables-\u6a21\u5f0f\u9ed8\u8ba4",children:"iptables \u6a21\u5f0f\uff08\u9ed8\u8ba4\uff09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b iptables \u89c4\u5219\niptables -t nat -L -n | grep <service-name>\n\n# \u67e5\u770b Service \u7684 iptables \u94fe\niptables -t nat -L KUBE-SERVICES -n --line-numbers\n"})}),"\n",(0,i.jsx)(e.mermaid,{value:"graph LR\n    Client[\u5ba2\u6237\u7aef] --\x3e PREROUTING[PREROUTING]\n    PREROUTING --\x3e SERVICES[KUBE-SERVICES]\n    SERVICES --\x3e SVC[KUBE-SVC-xxx]\n    SVC --\x3e SEP1[KUBE-SEP-xxx<br/>Pod 1]\n    SVC --\x3e SEP2[KUBE-SEP-yyy<br/>Pod 2]"}),"\n",(0,i.jsx)(e.h3,{id:"ipvs-\u6a21\u5f0f",children:"IPVS \u6a21\u5f0f"}),"\n",(0,i.jsx)(e.p,{children:"IPVS\uff08IP Virtual Server\uff09\u63d0\u4f9b\u66f4\u597d\u7684\u6027\u80fd\u548c\u66f4\u591a\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u542f\u7528 IPVS \u6a21\u5f0f\n# \u7f16\u8f91 kube-proxy ConfigMap\nkubectl edit configmap kube-proxy -n kube-system\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'# kube-proxy \u914d\u7f6e\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: "ipvs"\nipvs:\n  scheduler: "rr" # \u8f6e\u8be2\u7b97\u6cd5\n  # \u5176\u4ed6\u7b97\u6cd5: lc(\u6700\u5c0f\u8fde\u63a5), dh(\u76ee\u6807\u54c8\u5e0c), sh(\u6e90\u54c8\u5e0c)\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u91cd\u542f kube-proxy\nkubectl rollout restart daemonset kube-proxy -n kube-system\n\n# \u67e5\u770b IPVS \u89c4\u5219\nipvsadm -Ln\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u6a21\u5f0f\u5bf9\u6bd4",children:"\u6a21\u5f0f\u5bf9\u6bd4"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"iptables"}),(0,i.jsx)(e.th,{children:"IPVS"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6027\u80fd"}),(0,i.jsx)(e.td,{children:"O(n) \u89c4\u5219\u5339\u914d"}),(0,i.jsx)(e.td,{children:"O(1) \u54c8\u5e0c\u67e5\u627e"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u89c4\u6a21"}),(0,i.jsx)(e.td,{children:"\u9002\u5408\u5c0f\u89c4\u6a21"}),(0,i.jsx)(e.td,{children:"\u9002\u5408\u5927\u89c4\u6a21"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u7b97\u6cd5"}),(0,i.jsx)(e.td,{children:"\u968f\u673a"}),(0,i.jsx)(e.td,{children:"\u591a\u79cd\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u8c03\u8bd5"}),(0,i.jsx)(e.td,{children:"iptables \u547d\u4ee4"}),(0,i.jsx)(e.td,{children:"ipvsadm \u547d\u4ee4"})]})]})]}),"\n",(0,i.jsx)(e.h2,{id:"\u7f51\u7edc\u7b56\u7565",children:"\u7f51\u7edc\u7b56\u7565"}),"\n",(0,i.jsx)(e.p,{children:"NetworkPolicy \u7528\u4e8e\u63a7\u5236 Pod \u95f4\u7684\u7f51\u7edc\u6d41\u91cf\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"\u9ed8\u8ba4\u62d2\u7edd\u6240\u6709\u5165\u7ad9\u6d41\u91cf",children:"\u9ed8\u8ba4\u62d2\u7edd\u6240\u6709\u5165\u7ad9\u6d41\u91cf"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: deny-all-ingress\n  namespace: production\nspec:\n  podSelector: {} # \u5339\u914d\u6240\u6709 Pod\n  policyTypes:\n    - Ingress\n  # \u4e0d\u6307\u5b9a ingress \u89c4\u5219\uff0c\u5373\u62d2\u7edd\u6240\u6709\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u5141\u8bb8\u7279\u5b9a\u547d\u540d\u7a7a\u95f4\u8bbf\u95ee",children:"\u5141\u8bb8\u7279\u5b9a\u547d\u540d\u7a7a\u95f4\u8bbf\u95ee"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-from-frontend\n  namespace: backend\nspec:\n  podSelector:\n    matchLabels:\n      app: api\n  policyTypes:\n    - Ingress\n  ingress:\n    - from:\n        - namespaceSelector:\n            matchLabels:\n              name: frontend\n      ports:\n        - protocol: TCP\n          port: 8080\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u9650\u5236\u51fa\u7ad9\u6d41\u91cf",children:"\u9650\u5236\u51fa\u7ad9\u6d41\u91cf"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: restrict-egress\n  namespace: production\nspec:\n  podSelector:\n    matchLabels:\n      app: web\n  policyTypes:\n    - Egress\n  egress:\n    # \u5141\u8bb8\u8bbf\u95ee DNS\n    - to:\n        - namespaceSelector: {}\n          podSelector:\n            matchLabels:\n              k8s-app: kube-dns\n      ports:\n        - protocol: UDP\n          port: 53\n    # \u5141\u8bb8\u8bbf\u95ee\u6570\u636e\u5e93\n    - to:\n        - podSelector:\n            matchLabels:\n              app: database\n      ports:\n        - protocol: TCP\n          port: 5432\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u591a\u6761\u4ef6\u7ec4\u5408",children:"\u591a\u6761\u4ef6\u7ec4\u5408"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: complex-policy\nspec:\n  podSelector:\n    matchLabels:\n      role: db\n  policyTypes:\n    - Ingress\n  ingress:\n    # \u6761\u4ef6 1: \u6765\u81ea frontend \u547d\u540d\u7a7a\u95f4\u4e14\u5e26\u6709 role=frontend \u6807\u7b7e\u7684 Pod\n    - from:\n        - namespaceSelector:\n            matchLabels:\n              name: frontend\n          podSelector:\n            matchLabels:\n              role: frontend\n      ports:\n        - protocol: TCP\n          port: 5432\n    # \u6761\u4ef6 2: \u6765\u81ea 10.0.0.0/24 \u7f51\u6bb5\n    - from:\n        - ipBlock:\n            cidr: 10.0.0.0/24\n            except:\n              - 10.0.0.1/32\n      ports:\n        - protocol: TCP\n          port: 5432\n"})}),"\n",(0,i.jsx)(e.h2,{id:"ingress-controller",children:"Ingress Controller"}),"\n",(0,i.jsx)(e.h3,{id:"nginx-ingress-controller-\u5b89\u88c5",children:"NGINX Ingress Controller \u5b89\u88c5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u4f7f\u7528 Helm \u5b89\u88c5\nhelm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\nhelm repo update\n\nhelm install ingress-nginx ingress-nginx/ingress-nginx \\\n  --namespace ingress-nginx \\\n  --create-namespace \\\n  --set controller.service.type=LoadBalancer\n\n# \u67e5\u770b\u72b6\u6001\nkubectl get pods -n ingress-nginx\nkubectl get svc -n ingress-nginx\n"})}),"\n",(0,i.jsx)(e.h3,{id:"ingress-\u914d\u7f6e\u793a\u4f8b",children:"Ingress \u914d\u7f6e\u793a\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: app-ingress\n  annotations:\n    nginx.ingress.kubernetes.io/rewrite-target: /\n    nginx.ingress.kubernetes.io/ssl-redirect: "true"\n    nginx.ingress.kubernetes.io/proxy-body-size: "50m"\n    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"\nspec:\n  ingressClassName: nginx\n  tls:\n    - hosts:\n        - app.example.com\n      secretName: app-tls-secret\n  rules:\n    - host: app.example.com\n      http:\n        paths:\n          - path: /api\n            pathType: Prefix\n            backend:\n              service:\n                name: api-service\n                port:\n                  number: 80\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: web-service\n                port:\n                  number: 80\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u5e38\u7528-ingress-\u6ce8\u89e3",children:"\u5e38\u7528 Ingress \u6ce8\u89e3"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u6ce8\u89e3"}),(0,i.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"nginx.ingress.kubernetes.io/rewrite-target"})}),(0,i.jsx)(e.td,{children:"URL \u91cd\u5199\u76ee\u6807"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"nginx.ingress.kubernetes.io/ssl-redirect"})}),(0,i.jsx)(e.td,{children:"\u5f3a\u5236 HTTPS \u8df3\u8f6c"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"nginx.ingress.kubernetes.io/proxy-body-size"})}),(0,i.jsx)(e.td,{children:"\u8bf7\u6c42\u4f53\u5927\u5c0f\u9650\u5236"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"nginx.ingress.kubernetes.io/proxy-read-timeout"})}),(0,i.jsx)(e.td,{children:"\u8bfb\u53d6\u8d85\u65f6\u65f6\u95f4"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"nginx.ingress.kubernetes.io/affinity"})}),(0,i.jsx)(e.td,{children:"\u4f1a\u8bdd\u4eb2\u548c\u6027"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"nginx.ingress.kubernetes.io/cors-allow-origin"})}),(0,i.jsx)(e.td,{children:"CORS \u5141\u8bb8\u6765\u6e90"})]})]})]}),"\n",(0,i.jsx)(e.h2,{id:"dns-\u670d\u52a1",children:"DNS \u670d\u52a1"}),"\n",(0,i.jsx)(e.h3,{id:"coredns-\u914d\u7f6e",children:"CoreDNS \u914d\u7f6e"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# \u67e5\u770b CoreDNS ConfigMap\nkubectl get configmap coredns -n kube-system -o yaml\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns\n  namespace: kube-system\ndata:\n  Corefile: |\n    .:53 {\n        errors\n        health {\n           lameduck 5s\n        }\n        ready\n        kubernetes cluster.local in-addr.arpa ip6.arpa {\n           pods insecure\n           fallthrough in-addr.arpa ip6.arpa\n           ttl 30\n        }\n        prometheus :9153\n        forward . /etc/resolv.conf {\n           max_concurrent 1000\n        }\n        cache 30\n        loop\n        reload\n        loadbalance\n    }\n"})}),"\n",(0,i.jsx)(e.h3,{id:"dns-\u8c03\u8bd5",children:"DNS \u8c03\u8bd5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u8fd0\u884c DNS \u8c03\u8bd5 Pod\nkubectl run dnsutils --image=registry.k8s.io/e2e-test-images/jessie-dnsutils:1.3 -it --rm -- /bin/sh\n\n# \u6d4b\u8bd5 DNS \u89e3\u6790\nnslookup kubernetes.default\nnslookup my-service.my-namespace.svc.cluster.local\n\n# \u67e5\u770b Pod \u7684 DNS \u914d\u7f6e\nkubectl exec <pod-name> -- cat /etc/resolv.conf\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u7f51\u7edc\u6392\u67e5",children:"\u7f51\u7edc\u6392\u67e5"}),"\n",(0,i.jsx)(e.h3,{id:"\u5e38\u7528\u6392\u67e5\u547d\u4ee4",children:"\u5e38\u7528\u6392\u67e5\u547d\u4ee4"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b Pod \u7f51\u7edc\u914d\u7f6e\nkubectl exec <pod-name> -- ip addr\nkubectl exec <pod-name> -- ip route\n\n# \u6d4b\u8bd5 Pod \u95f4\u8fde\u901a\u6027\nkubectl exec <pod-1> -- ping <pod-2-ip>\nkubectl exec <pod-1> -- curl <service-name>:<port>\n\n# \u67e5\u770b Service \u540e\u7aef\nkubectl get endpoints <service-name>\n\n# \u4f7f\u7528 netshoot \u8c03\u8bd5\nkubectl run netshoot --image=nicolaka/netshoot -it --rm -- /bin/bash\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u95ee\u9898"}),(0,i.jsx)(e.th,{children:"\u53ef\u80fd\u539f\u56e0"}),(0,i.jsx)(e.th,{children:"\u6392\u67e5\u65b9\u6cd5"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Pod \u65e0\u6cd5\u901a\u4fe1"}),(0,i.jsx)(e.td,{children:"CNI \u63d2\u4ef6\u95ee\u9898"}),(0,i.jsx)(e.td,{children:"\u68c0\u67e5 CNI Pod \u72b6\u6001"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Service \u4e0d\u53ef\u8fbe"}),(0,i.jsx)(e.td,{children:"kube-proxy \u95ee\u9898"}),(0,i.jsx)(e.td,{children:"\u68c0\u67e5 iptables/IPVS \u89c4\u5219"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"DNS \u89e3\u6790\u5931\u8d25"}),(0,i.jsx)(e.td,{children:"CoreDNS \u95ee\u9898"}),(0,i.jsx)(e.td,{children:"\u68c0\u67e5 CoreDNS Pod \u65e5\u5fd7"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5916\u90e8\u65e0\u6cd5\u8bbf\u95ee"}),(0,i.jsx)(e.td,{children:"Ingress \u914d\u7f6e\u95ee\u9898"}),(0,i.jsx)(e.td,{children:"\u68c0\u67e5 Ingress Controller \u65e5\u5fd7"})]})]})]})]})}function h(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}},48885:(n,e,s)=>{s.d(e,{R:()=>t,x:()=>d});var r=s(99378);const i={},l=r.createContext(i);function t(n){const e=r.useContext(l);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),r.createElement(l.Provider,{value:e},n.children)}}}]);
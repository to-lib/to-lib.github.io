"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[4095],{35203:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"rabbitmq/producer","title":"\u751f\u4ea7\u8005\u6307\u5357","description":"RabbitMQ \u751f\u4ea7\u8005\u5f00\u53d1\u6307\u5357","source":"@site/docs/rabbitmq/producer.md","sourceDirName":"rabbitmq","slug":"/rabbitmq/producer","permalink":"/docs/rabbitmq/producer","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/rabbitmq/producer.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"\u751f\u4ea7\u8005\u6307\u5357","description":"RabbitMQ \u751f\u4ea7\u8005\u5f00\u53d1\u6307\u5357"},"sidebar":"rabbitmq","previous":{"title":"\u6d88\u606f\u7c7b\u578b\u8be6\u89e3","permalink":"/docs/rabbitmq/message-types"},"next":{"title":"\u6d88\u8d39\u8005\u6307\u5357","permalink":"/docs/rabbitmq/consumer"}}');var r=a(22714),t=a(48885);const l={sidebar_position:5,title:"\u751f\u4ea7\u8005\u6307\u5357",description:"RabbitMQ \u751f\u4ea7\u8005\u5f00\u53d1\u6307\u5357"},s="RabbitMQ \u751f\u4ea7\u8005\u6307\u5357",c={},o=[{value:"\u751f\u4ea7\u8005\u57fa\u7840",id:"\u751f\u4ea7\u8005\u57fa\u7840",level:2},{value:"\u8fde\u63a5\u548c\u901a\u9053",id:"\u8fde\u63a5\u548c\u901a\u9053",level:3},{value:"\u53d1\u9001\u6d88\u606f",id:"\u53d1\u9001\u6d88\u606f",level:2},{value:"\u57fa\u672c\u53d1\u9001",id:"\u57fa\u672c\u53d1\u9001",level:3},{value:"\u53d1\u9001\u5230\u4ea4\u6362\u673a",id:"\u53d1\u9001\u5230\u4ea4\u6362\u673a",level:3},{value:"\u6d88\u606f\u5c5e\u6027",id:"\u6d88\u606f\u5c5e\u6027",level:3},{value:"\u6d88\u606f\u6301\u4e45\u5316",id:"\u6d88\u606f\u6301\u4e45\u5316",level:2},{value:"\u914d\u7f6e\u6301\u4e45\u5316",id:"\u914d\u7f6e\u6301\u4e45\u5316",level:3},{value:"\u53d1\u5e03\u786e\u8ba4",id:"\u53d1\u5e03\u786e\u8ba4",level:2},{value:"\u5355\u6761\u786e\u8ba4",id:"\u5355\u6761\u786e\u8ba4",level:3},{value:"\u6279\u91cf\u786e\u8ba4",id:"\u6279\u91cf\u786e\u8ba4",level:3},{value:"\u5f02\u6b65\u786e\u8ba4",id:"\u5f02\u6b65\u786e\u8ba4",level:3},{value:"\u6d88\u606f\u8fd4\u56de",id:"\u6d88\u606f\u8fd4\u56de",level:2},{value:"\u4ea4\u6362\u673a\u7c7b\u578b",id:"\u4ea4\u6362\u673a\u7c7b\u578b",level:2},{value:"Direct \u4ea4\u6362\u673a",id:"direct-\u4ea4\u6362\u673a",level:3},{value:"Fanout \u4ea4\u6362\u673a",id:"fanout-\u4ea4\u6362\u673a",level:3},{value:"Topic \u4ea4\u6362\u673a",id:"topic-\u4ea4\u6362\u673a",level:3},{value:"Spring Boot \u751f\u4ea7\u8005",id:"spring-boot-\u751f\u4ea7\u8005",level:2},{value:"\u914d\u7f6e\u7c7b",id:"\u914d\u7f6e\u7c7b",level:3},{value:"\u751f\u4ea7\u8005\u670d\u52a1",id:"\u751f\u4ea7\u8005\u670d\u52a1",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u8fde\u63a5\u7ba1\u7406",id:"1-\u8fde\u63a5\u7ba1\u7406",level:3},{value:"2. \u6d88\u606f\u5e8f\u5217\u5316",id:"2-\u6d88\u606f\u5e8f\u5217\u5316",level:3},{value:"3. \u9519\u8bef\u5904\u7406",id:"3-\u9519\u8bef\u5904\u7406",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:2},{value:"\u6279\u91cf\u53d1\u9001",id:"\u6279\u91cf\u53d1\u9001",level:3},{value:"\u901a\u9053\u590d\u7528",id:"\u901a\u9053\u590d\u7528",level:3},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"rabbitmq-\u751f\u4ea7\u8005\u6307\u5357",children:"RabbitMQ \u751f\u4ea7\u8005\u6307\u5357"})}),"\n",(0,r.jsx)(n.p,{children:"\u672c\u6307\u5357\u8be6\u7ec6\u4ecb\u7ecd RabbitMQ \u751f\u4ea7\u8005\u7684\u5f00\u53d1\u548c\u6700\u4f73\u5b9e\u8df5\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u751f\u4ea7\u8005\u57fa\u7840",children:"\u751f\u4ea7\u8005\u57fa\u7840"}),"\n",(0,r.jsx)(n.h3,{id:"\u8fde\u63a5\u548c\u901a\u9053",children:"\u8fde\u63a5\u548c\u901a\u9053"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import com.rabbitmq.client.*;\n\npublic class ProducerExample {\n    public static void main(String[] args) throws Exception {\n        // \u521b\u5efa\u8fde\u63a5\u5de5\u5382\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost("localhost");\n        factory.setPort(5672);\n        factory.setUsername("guest");\n        factory.setPassword("guest");\n        factory.setVirtualHost("/");\n\n        // \u8fde\u63a5\u914d\u7f6e\n        factory.setConnectionTimeout(30000);      // \u8fde\u63a5\u8d85\u65f6\n        factory.setRequestedHeartbeat(60);        // \u5fc3\u8df3\u95f4\u9694\n        factory.setAutomaticRecoveryEnabled(true); // \u81ea\u52a8\u6062\u590d\n\n        // \u521b\u5efa\u8fde\u63a5\n        Connection connection = factory.newConnection("my-producer");\n\n        // \u521b\u5efa\u901a\u9053\n        Channel channel = connection.createChannel();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u53d1\u9001\u6d88\u606f",children:"\u53d1\u9001\u6d88\u606f"}),"\n",(0,r.jsx)(n.h3,{id:"\u57fa\u672c\u53d1\u9001",children:"\u57fa\u672c\u53d1\u9001"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u58f0\u660e\u961f\u5217\nchannel.queueDeclare("my-queue", true, false, false, null);\n\n// \u53d1\u9001\u7b80\u5355\u6d88\u606f\nString message = "Hello World!";\nchannel.basicPublish("", "my-queue", null, message.getBytes("UTF-8"));\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u53d1\u9001\u5230\u4ea4\u6362\u673a",children:"\u53d1\u9001\u5230\u4ea4\u6362\u673a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u58f0\u660e\u4ea4\u6362\u673a\nchannel.exchangeDeclare("my-exchange", "direct", true);\n\n// \u58f0\u660e\u961f\u5217\u5e76\u7ed1\u5b9a\nchannel.queueDeclare("my-queue", true, false, false, null);\nchannel.queueBind("my-queue", "my-exchange", "routing-key");\n\n// \u53d1\u9001\u6d88\u606f\nchannel.basicPublish("my-exchange", "routing-key", null, message.getBytes());\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u6d88\u606f\u5c5e\u6027",children:"\u6d88\u606f\u5c5e\u6027"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u6784\u5efa\u6d88\u606f\u5c5e\u6027\nAMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()\n    .contentType("application/json")\n    .contentEncoding("UTF-8")\n    .deliveryMode(2)                    // \u6301\u4e45\u5316\n    .priority(5)                        // \u4f18\u5148\u7ea7 0-9\n    .correlationId(UUID.randomUUID().toString())\n    .replyTo("reply-queue")\n    .expiration("60000")                // TTL 60\u79d2\n    .messageId(UUID.randomUUID().toString())\n    .timestamp(new Date())\n    .type("order.created")\n    .userId("guest")\n    .appId("order-service")\n    .headers(Map.of("custom-header", "value"))\n    .build();\n\nchannel.basicPublish("my-exchange", "routing-key", properties, message.getBytes());\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6d88\u606f\u6301\u4e45\u5316",children:"\u6d88\u606f\u6301\u4e45\u5316"}),"\n",(0,r.jsx)(n.h3,{id:"\u914d\u7f6e\u6301\u4e45\u5316",children:"\u914d\u7f6e\u6301\u4e45\u5316"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// 1. \u58f0\u660e\u6301\u4e45\u5316\u961f\u5217\nboolean durable = true;\nchannel.queueDeclare("durable-queue", durable, false, false, null);\n\n// 2. \u58f0\u660e\u6301\u4e45\u5316\u4ea4\u6362\u673a\nchannel.exchangeDeclare("durable-exchange", "direct", true);\n\n// 3. \u53d1\u9001\u6301\u4e45\u5316\u6d88\u606f\nAMQP.BasicProperties props = MessageProperties.PERSISTENT_TEXT_PLAIN;\nchannel.basicPublish("", "durable-queue", props, message.getBytes());\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u53d1\u5e03\u786e\u8ba4",children:"\u53d1\u5e03\u786e\u8ba4"}),"\n",(0,r.jsx)(n.h3,{id:"\u5355\u6761\u786e\u8ba4",children:"\u5355\u6761\u786e\u8ba4"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u542f\u7528\u53d1\u5e03\u786e\u8ba4\nchannel.confirmSelect();\n\n// \u53d1\u9001\u6d88\u606f\nchannel.basicPublish("", "queue", null, message.getBytes());\n\n// \u7b49\u5f85\u786e\u8ba4\nif (channel.waitForConfirms(5000)) {\n    System.out.println("\u6d88\u606f\u5df2\u786e\u8ba4");\n} else {\n    System.out.println("\u6d88\u606f\u672a\u786e\u8ba4");\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u6279\u91cf\u786e\u8ba4",children:"\u6279\u91cf\u786e\u8ba4"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'channel.confirmSelect();\n\nint batchSize = 100;\nint outstandingMessageCount = 0;\n\nfor (int i = 0; i < 1000; i++) {\n    channel.basicPublish("", "queue", null, ("Message " + i).getBytes());\n    outstandingMessageCount++;\n\n    if (outstandingMessageCount >= batchSize) {\n        channel.waitForConfirmsOrDie(5000);\n        outstandingMessageCount = 0;\n    }\n}\n\n// \u786e\u8ba4\u5269\u4f59\u6d88\u606f\nif (outstandingMessageCount > 0) {\n    channel.waitForConfirmsOrDie(5000);\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u5f02\u6b65\u786e\u8ba4",children:"\u5f02\u6b65\u786e\u8ba4"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'channel.confirmSelect();\n\nConcurrentNavigableMap<Long, String> outstandingConfirms = new ConcurrentSkipListMap<>();\n\n// \u786e\u8ba4\u56de\u8c03\nConfirmCallback ackCallback = (sequenceNumber, multiple) -> {\n    if (multiple) {\n        ConcurrentNavigableMap<Long, String> confirmed =\n            outstandingConfirms.headMap(sequenceNumber, true);\n        confirmed.clear();\n    } else {\n        outstandingConfirms.remove(sequenceNumber);\n    }\n    System.out.println("Message confirmed: " + sequenceNumber);\n};\n\n// \u5426\u8ba4\u56de\u8c03\nConfirmCallback nackCallback = (sequenceNumber, multiple) -> {\n    String message = outstandingConfirms.get(sequenceNumber);\n    System.err.println("Message nacked: " + sequenceNumber + ", msg: " + message);\n    // \u91cd\u53d1\u903b\u8f91\n};\n\nchannel.addConfirmListener(ackCallback, nackCallback);\n\n// \u53d1\u9001\u6d88\u606f\nfor (int i = 0; i < 1000; i++) {\n    String message = "Message " + i;\n    outstandingConfirms.put(channel.getNextPublishSeqNo(), message);\n    channel.basicPublish("", "queue", null, message.getBytes());\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6d88\u606f\u8fd4\u56de",children:"\u6d88\u606f\u8fd4\u56de"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u6d88\u606f\u65e0\u6cd5\u8def\u7531\u65f6,\u53ef\u4ee5\u83b7\u53d6\u8fd4\u56de\u901a\u77e5:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u6dfb\u52a0\u8fd4\u56de\u76d1\u542c\u5668\nchannel.addReturnListener((replyCode, replyText, exchange, routingKey, properties, body) -> {\n    System.err.printf("\u6d88\u606f\u8fd4\u56de: code=%d, text=%s, exchange=%s, routingKey=%s%n",\n        replyCode, replyText, exchange, routingKey);\n    // \u5904\u7406\u65e0\u6cd5\u8def\u7531\u7684\u6d88\u606f\n});\n\n// \u53d1\u9001\u6d88\u606f\u65f6\u8bbe\u7f6e mandatory \u6807\u5fd7\nboolean mandatory = true;\nchannel.basicPublish("my-exchange", "invalid-key", mandatory, null, message.getBytes());\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u4ea4\u6362\u673a\u7c7b\u578b",children:"\u4ea4\u6362\u673a\u7c7b\u578b"}),"\n",(0,r.jsx)(n.h3,{id:"direct-\u4ea4\u6362\u673a",children:"Direct \u4ea4\u6362\u673a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u58f0\u660e Direct \u4ea4\u6362\u673a\nchannel.exchangeDeclare("direct-exchange", BuiltinExchangeType.DIRECT, true);\n\n// \u7ed1\u5b9a\u591a\u4e2a\u8def\u7531\u952e\nchannel.queueBind("error-queue", "direct-exchange", "error");\nchannel.queueBind("warning-queue", "direct-exchange", "warning");\nchannel.queueBind("info-queue", "direct-exchange", "info");\n\n// \u53d1\u9001\u5230\u6307\u5b9a\u8def\u7531\nchannel.basicPublish("direct-exchange", "error", null, "Error message".getBytes());\n'})}),"\n",(0,r.jsx)(n.h3,{id:"fanout-\u4ea4\u6362\u673a",children:"Fanout \u4ea4\u6362\u673a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u58f0\u660e Fanout \u4ea4\u6362\u673a\nchannel.exchangeDeclare("fanout-exchange", BuiltinExchangeType.FANOUT, true);\n\n// \u7ed1\u5b9a\u961f\u5217\uff08\u8def\u7531\u952e\u88ab\u5ffd\u7565\uff09\nchannel.queueBind("queue1", "fanout-exchange", "");\nchannel.queueBind("queue2", "fanout-exchange", "");\n\n// \u5e7f\u64ad\u6d88\u606f\nchannel.basicPublish("fanout-exchange", "", null, "Broadcast message".getBytes());\n'})}),"\n",(0,r.jsx)(n.h3,{id:"topic-\u4ea4\u6362\u673a",children:"Topic \u4ea4\u6362\u673a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u58f0\u660e Topic \u4ea4\u6362\u673a\nchannel.exchangeDeclare("topic-exchange", BuiltinExchangeType.TOPIC, true);\n\n// \u4f7f\u7528\u901a\u914d\u7b26\u7ed1\u5b9a\nchannel.queueBind("all-logs", "topic-exchange", "#");           // \u6240\u6709\u6d88\u606f\nchannel.queueBind("kern-logs", "topic-exchange", "kern.*");     // kern \u5f00\u5934\nchannel.queueBind("critical", "topic-exchange", "*.critical");  // critical \u7ed3\u5c3e\n\n// \u53d1\u9001\u6d88\u606f\nchannel.basicPublish("topic-exchange", "kern.critical", null, message.getBytes());\nchannel.basicPublish("topic-exchange", "app.info", null, message.getBytes());\n'})}),"\n",(0,r.jsx)(n.h2,{id:"spring-boot-\u751f\u4ea7\u8005",children:"Spring Boot \u751f\u4ea7\u8005"}),"\n",(0,r.jsx)(n.h3,{id:"\u914d\u7f6e\u7c7b",children:"\u914d\u7f6e\u7c7b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class RabbitProducerConfig {\n\n    @Bean\n    public RabbitTemplate rabbitTemplate(ConnectionFactory connectionFactory) {\n        RabbitTemplate template = new RabbitTemplate(connectionFactory);\n        template.setMessageConverter(jackson2JsonMessageConverter());\n\n        // \u53d1\u5e03\u786e\u8ba4\u56de\u8c03\n        template.setConfirmCallback((correlationData, ack, cause) -> {\n            if (ack) {\n                System.out.println("\u6d88\u606f\u786e\u8ba4\u6210\u529f");\n            } else {\n                System.err.println("\u6d88\u606f\u786e\u8ba4\u5931\u8d25: " + cause);\n            }\n        });\n\n        // \u6d88\u606f\u8fd4\u56de\u56de\u8c03\n        template.setReturnsCallback(returned -> {\n            System.err.printf("\u6d88\u606f\u8fd4\u56de: exchange=%s, routingKey=%s, replyCode=%d%n",\n                returned.getExchange(), returned.getRoutingKey(), returned.getReplyCode());\n        });\n\n        return template;\n    }\n\n    @Bean\n    public MessageConverter jackson2JsonMessageConverter() {\n        return new Jackson2JsonMessageConverter();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u751f\u4ea7\u8005\u670d\u52a1",children:"\u751f\u4ea7\u8005\u670d\u52a1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Service\n@Slf4j\npublic class OrderMessageProducer {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void sendOrder(Order order) {\n        CorrelationData correlationData = new CorrelationData(order.getId());\n\n        rabbitTemplate.convertAndSend(\n            "order-exchange",\n            "order.created",\n            order,\n            message -> {\n                message.getMessageProperties().setDeliveryMode(MessageDeliveryMode.PERSISTENT);\n                message.getMessageProperties().setPriority(5);\n                return message;\n            },\n            correlationData\n        );\n\n        log.info("\u8ba2\u5355\u6d88\u606f\u5df2\u53d1\u9001: {}", order.getId());\n    }\n\n    public void sendDelayedMessage(String message, long delayMs) {\n        rabbitTemplate.convertAndSend(\n            "delayed-exchange",\n            "delayed-key",\n            message,\n            msg -> {\n                msg.getMessageProperties().setDelay((int) delayMs);\n                return msg;\n            }\n        );\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsx)(n.h3,{id:"1-\u8fde\u63a5\u7ba1\u7406",children:"1. \u8fde\u63a5\u7ba1\u7406"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"// \u4f7f\u7528\u8fde\u63a5\u6c60\npublic class ConnectionPool {\n    private final ConnectionFactory factory;\n    private final List<Connection> connections;\n    private final int poolSize;\n\n    public ConnectionPool(ConnectionFactory factory, int poolSize) {\n        this.factory = factory;\n        this.poolSize = poolSize;\n        this.connections = new ArrayList<>(poolSize);\n        initPool();\n    }\n\n    private void initPool() {\n        for (int i = 0; i < poolSize; i++) {\n            connections.add(factory.newConnection());\n        }\n    }\n\n    public Connection getConnection() {\n        // \u8f6e\u8be2\u8fd4\u56de\u8fde\u63a5\n        return connections.get(ThreadLocalRandom.current().nextInt(poolSize));\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-\u6d88\u606f\u5e8f\u5217\u5316",children:"2. \u6d88\u606f\u5e8f\u5217\u5316"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u4f7f\u7528 JSON \u5e8f\u5217\u5316\nObjectMapper mapper = new ObjectMapper();\n\npublic void sendJson(Object data) throws Exception {\n    String json = mapper.writeValueAsString(data);\n\n    AMQP.BasicProperties props = new AMQP.BasicProperties.Builder()\n        .contentType("application/json")\n        .build();\n\n    channel.basicPublish("exchange", "key", props, json.getBytes("UTF-8"));\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-\u9519\u8bef\u5904\u7406",children:"3. \u9519\u8bef\u5904\u7406"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public void sendWithRetry(String message, int maxRetries) {\n    int retries = 0;\n    while (retries < maxRetries) {\n        try {\n            channel.confirmSelect();\n            channel.basicPublish("", "queue", null, message.getBytes());\n            if (channel.waitForConfirms(5000)) {\n                return; // \u53d1\u9001\u6210\u529f\n            }\n        } catch (Exception e) {\n            retries++;\n            if (retries >= maxRetries) {\n                throw new RuntimeException("\u53d1\u9001\u5931\u8d25\uff0c\u5df2\u91cd\u8bd5 " + maxRetries + " \u6b21", e);\n            }\n            try {\n                Thread.sleep(1000 * retries); // \u6307\u6570\u9000\u907f\n            } catch (InterruptedException ie) {\n                Thread.currentThread().interrupt();\n            }\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,r.jsx)(n.h3,{id:"\u6279\u91cf\u53d1\u9001",children:"\u6279\u91cf\u53d1\u9001"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u6279\u91cf\u53d1\u9001\u63d0\u5347\u6027\u80fd\npublic void batchSend(List<String> messages) throws Exception {\n    channel.confirmSelect();\n\n    for (String msg : messages) {\n        channel.basicPublish("", "queue", null, msg.getBytes());\n    }\n\n    channel.waitForConfirmsOrDie(10000);\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u901a\u9053\u590d\u7528",children:"\u901a\u9053\u590d\u7528"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u590d\u7528\u901a\u9053\u800c\u4e0d\u662f\u6bcf\u6b21\u521b\u5efa\u65b0\u901a\u9053\nprivate final ThreadLocal<Channel> channelHolder = ThreadLocal.withInitial(() -> {\n    try {\n        return connection.createChannel();\n    } catch (IOException e) {\n        throw new RuntimeException(e);\n    }\n});\n\npublic void send(String message) throws Exception {\n    Channel channel = channelHolder.get();\n    channel.basicPublish("", "queue", null, message.getBytes());\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\ud83d\udcd6 ",(0,r.jsx)(n.a,{href:"/docs/rabbitmq/consumer",children:"\u6d88\u8d39\u8005\u6307\u5357"})," - \u5b66\u4e60\u6d88\u8d39\u8005\u5f00\u53d1"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2699\ufe0f ",(0,r.jsx)(n.a,{href:"/docs/rabbitmq/cluster-management",children:"\u96c6\u7fa4\u7ba1\u7406"})," - \u4e86\u89e3\u96c6\u7fa4\u90e8\u7f72"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\ude80 ",(0,r.jsx)(n.a,{href:"/docs/rabbitmq/performance-optimization",children:"\u6027\u80fd\u4f18\u5316"})," - \u4f18\u5316\u751f\u4ea7\u8005\u6027\u80fd"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.rabbitmq.com/publishers.html",children:"RabbitMQ \u53d1\u5e03\u8005\u6307\u5357"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.rabbitmq.com/confirms.html",children:"\u53d1\u5e03\u786e\u8ba4"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},48885:(e,n,a)=>{a.d(n,{R:()=>l,x:()=>s});var i=a(99378);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);
"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[51761],{16376:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>p,frontMatter:()=>d,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"docker/production","title":"\u751f\u4ea7\u5b9e\u8df5","description":"\u5bb9\u5668\u7f16\u6392\u9009\u578b\u3001\u84dd\u7eff\u90e8\u7f72\u4e0e\u707e\u5907\u8fc1\u79fb","source":"@site/docs/docker/production.md","sourceDirName":"docker","slug":"/docker/production","permalink":"/docs/docker/production","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/docker/production.md","tags":[],"version":"current","sidebarPosition":24,"frontMatter":{"sidebar_position":24,"title":"\u751f\u4ea7\u5b9e\u8df5","description":"\u5bb9\u5668\u7f16\u6392\u9009\u578b\u3001\u84dd\u7eff\u90e8\u7f72\u4e0e\u707e\u5907\u8fc1\u79fb"},"sidebar":"docker","previous":{"title":"CI/CD \u96c6\u6210","permalink":"/docs/docker/cicd"},"next":{"title":"\u6027\u80fd\u8c03\u4f18","permalink":"/docs/docker/performance"}}');var s=r(22714),l=r(48885);const d={sidebar_position:24,title:"\u751f\u4ea7\u5b9e\u8df5",description:"\u5bb9\u5668\u7f16\u6392\u9009\u578b\u3001\u84dd\u7eff\u90e8\u7f72\u4e0e\u707e\u5907\u8fc1\u79fb"},c="\u751f\u4ea7\u5b9e\u8df5",i={},o=[{value:"\u7f16\u6392\u5de5\u5177\u9009\u578b",id:"\u7f16\u6392\u5de5\u5177\u9009\u578b",level:2},{value:"Docker Swarm vs Kubernetes",id:"docker-swarm-vs-kubernetes",level:3},{value:"\u9009\u578b\u5efa\u8bae",id:"\u9009\u578b\u5efa\u8bae",level:3},{value:"\u84dd\u7eff\u90e8\u7f72",id:"\u84dd\u7eff\u90e8\u7f72",level:2},{value:"\u4f7f\u7528 Docker Compose",id:"\u4f7f\u7528-docker-compose",level:3},{value:"\u4f7f\u7528 Docker Swarm",id:"\u4f7f\u7528-docker-swarm",level:3},{value:"\u91d1\u4e1d\u96c0\u90e8\u7f72",id:"\u91d1\u4e1d\u96c0\u90e8\u7f72",level:2},{value:"Docker Swarm \u5b9e\u73b0",id:"docker-swarm-\u5b9e\u73b0",level:3},{value:"\u4f7f\u7528 Traefik \u6743\u91cd\u8def\u7531",id:"\u4f7f\u7528-traefik-\u6743\u91cd\u8def\u7531",level:3},{value:"\u6eda\u52a8\u66f4\u65b0",id:"\u6eda\u52a8\u66f4\u65b0",level:2},{value:"Docker Swarm \u914d\u7f6e",id:"docker-swarm-\u914d\u7f6e",level:3},{value:"Docker Compose (Swarm mode)",id:"docker-compose-swarm-mode",level:3},{value:"\u5065\u5eb7\u68c0\u67e5",id:"\u5065\u5eb7\u68c0\u67e5",level:2},{value:"Dockerfile \u5065\u5eb7\u68c0\u67e5",id:"dockerfile-\u5065\u5eb7\u68c0\u67e5",level:3},{value:"Docker Compose \u5065\u5eb7\u68c0\u67e5",id:"docker-compose-\u5065\u5eb7\u68c0\u67e5",level:3},{value:"\u707e\u5907\u4e0e\u8fc1\u79fb",id:"\u707e\u5907\u4e0e\u8fc1\u79fb",level:2},{value:"\u6570\u636e\u5907\u4efd\u7b56\u7565",id:"\u6570\u636e\u5907\u4efd\u7b56\u7565",level:3},{value:"\u6570\u636e\u6062\u590d",id:"\u6570\u636e\u6062\u590d",level:3},{value:"\u8de8\u4e3b\u673a\u8fc1\u79fb",id:"\u8de8\u4e3b\u673a\u8fc1\u79fb",level:3},{value:"\u9ad8\u53ef\u7528\u914d\u7f6e",id:"\u9ad8\u53ef\u7528\u914d\u7f6e",level:2},{value:"Docker Swarm \u9ad8\u53ef\u7528",id:"docker-swarm-\u9ad8\u53ef\u7528",level:3},{value:"\u670d\u52a1\u9ad8\u53ef\u7528",id:"\u670d\u52a1\u9ad8\u53ef\u7528",level:3},{value:"\u76d1\u63a7\u544a\u8b66",id:"\u76d1\u63a7\u544a\u8b66",level:2},{value:"\u57fa\u7840\u76d1\u63a7\u6808",id:"\u57fa\u7840\u76d1\u63a7\u6808",level:3},{value:"\u544a\u8b66\u89c4\u5219\u793a\u4f8b",id:"\u544a\u8b66\u89c4\u5219\u793a\u4f8b",level:3}];function t(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u751f\u4ea7\u5b9e\u8df5",children:"\u751f\u4ea7\u5b9e\u8df5"})}),"\n",(0,s.jsx)(n.p,{children:"Docker \u5728\u751f\u4ea7\u73af\u5883\u4e2d\u7684\u6700\u4f73\u5b9e\u8df5\u548c\u90e8\u7f72\u7b56\u7565\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u7f16\u6392\u5de5\u5177\u9009\u578b",children:"\u7f16\u6392\u5de5\u5177\u9009\u578b"}),"\n",(0,s.jsx)(n.h3,{id:"docker-swarm-vs-kubernetes",children:"Docker Swarm vs Kubernetes"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u7279\u6027"}),(0,s.jsx)(n.th,{children:"Docker Swarm"}),(0,s.jsx)(n.th,{children:"Kubernetes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u5b66\u4e60\u66f2\u7ebf"}),(0,s.jsx)(n.td,{children:"\u4f4e"}),(0,s.jsx)(n.td,{children:"\u9ad8"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u5b89\u88c5\u590d\u6742\u5ea6"}),(0,s.jsx)(n.td,{children:"\u7b80\u5355"}),(0,s.jsx)(n.td,{children:"\u590d\u6742"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u529f\u80fd\u4e30\u5bcc\u5ea6"}),(0,s.jsx)(n.td,{children:"\u57fa\u7840"}),(0,s.jsx)(n.td,{children:"\u5168\u9762"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u793e\u533a\u751f\u6001"}),(0,s.jsx)(n.td,{children:"\u8f83\u5c0f"}),(0,s.jsx)(n.td,{children:"\u5e9e\u5927"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u9002\u7528\u89c4\u6a21"}),(0,s.jsx)(n.td,{children:"\u4e2d\u5c0f\u578b"}),(0,s.jsx)(n.td,{children:"\u4efb\u610f\u89c4\u6a21"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u9ad8\u53ef\u7528"}),(0,s.jsx)(n.td,{children:"\u652f\u6301"}),(0,s.jsx)(n.td,{children:"\u652f\u6301"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u670d\u52a1\u53d1\u73b0"}),(0,s.jsx)(n.td,{children:"\u5185\u7f6e"}),(0,s.jsx)(n.td,{children:"\u5185\u7f6e"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u8d1f\u8f7d\u5747\u8861"}),(0,s.jsx)(n.td,{children:"\u5185\u7f6e"}),(0,s.jsx)(n.td,{children:"\u5185\u7f6e + Ingress"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"\u9009\u578b\u5efa\u8bae",children:"\u9009\u578b\u5efa\u8bae"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u9009\u62e9 Docker Swarm\uff1a"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u56e2\u961f\u89c4\u6a21\u5c0f\uff0c\u8fd0\u7ef4\u80fd\u529b\u6709\u9650"}),"\n",(0,s.jsx)(n.li,{children:"\u5e94\u7528\u89c4\u6a21\u4e2d\u7b49\uff08\u51e0\u5341\u4e2a\u670d\u52a1\uff09"}),"\n",(0,s.jsx)(n.li,{children:"\u9700\u8981\u5feb\u901f\u4e0a\u624b"}),"\n",(0,s.jsx)(n.li,{children:"\u5df2\u6709 Docker Compose \u914d\u7f6e"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u9009\u62e9 Kubernetes\uff1a"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5927\u89c4\u6a21\u5fae\u670d\u52a1\u67b6\u6784"}),"\n",(0,s.jsx)(n.li,{children:"\u9700\u8981\u9ad8\u7ea7\u8c03\u5ea6\u7b56\u7565"}),"\n",(0,s.jsx)(n.li,{children:"\u591a\u4e91/\u6df7\u5408\u4e91\u90e8\u7f72"}),"\n",(0,s.jsx)(n.li,{children:"\u9700\u8981\u4e30\u5bcc\u7684\u751f\u6001\u5de5\u5177"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u84dd\u7eff\u90e8\u7f72",children:"\u84dd\u7eff\u90e8\u7f72"}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-docker-compose",children:"\u4f7f\u7528 Docker Compose"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'# docker-compose.blue.yml\nservices:\n  app:\n    image: myapp:v1\n    deploy:\n      replicas: 3\n    networks:\n      - app-network\n    labels:\n      - "traefik.http.routers.app.rule=Host(`app.example.com`)"\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'# docker-compose.green.yml\nservices:\n  app:\n    image: myapp:v2\n    deploy:\n      replicas: 3\n    networks:\n      - app-network\n    labels:\n      - "traefik.http.routers.app-green.rule=Host(`app.example.com`)"\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u90e8\u7f72\u6d41\u7a0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# 1. \u90e8\u7f72\u7eff\u8272\u73af\u5883\ndocker compose -f docker-compose.green.yml up -d\n\n# 2. \u6d4b\u8bd5\u7eff\u8272\u73af\u5883\ncurl http://green.app.example.com/health\n\n# 3. \u5207\u6362\u6d41\u91cf\uff08\u66f4\u65b0 Traefik \u914d\u7f6e\u6216 DNS\uff09\n\n# 4. \u786e\u8ba4\u65e0\u8bef\u540e\uff0c\u505c\u6b62\u84dd\u8272\u73af\u5883\ndocker compose -f docker-compose.blue.yml down\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-docker-swarm",children:"\u4f7f\u7528 Docker Swarm"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u521b\u5efa\u670d\u52a1\ndocker service create \\\n  --name app \\\n  --replicas 3 \\\n  --update-delay 10s \\\n  --update-parallelism 1 \\\n  myapp:v1\n\n# \u84dd\u7eff\u90e8\u7f72\uff1a\u521b\u5efa\u65b0\u670d\u52a1\ndocker service create \\\n  --name app-green \\\n  --replicas 3 \\\n  myapp:v2\n\n# \u6d4b\u8bd5\u540e\u5207\u6362\uff08\u66f4\u65b0\u8d1f\u8f7d\u5747\u8861\u5668\u6307\u5411\uff09\n\n# \u5220\u9664\u65e7\u670d\u52a1\ndocker service rm app\ndocker service update --name app app-green\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u91d1\u4e1d\u96c0\u90e8\u7f72",children:"\u91d1\u4e1d\u96c0\u90e8\u7f72"}),"\n",(0,s.jsx)(n.h3,{id:"docker-swarm-\u5b9e\u73b0",children:"Docker Swarm \u5b9e\u73b0"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u521d\u59cb\u90e8\u7f72\ndocker service create \\\n  --name app \\\n  --replicas 10 \\\n  myapp:v1\n\n# \u91d1\u4e1d\u96c0\uff1a\u66f4\u65b0\u90e8\u5206\u5b9e\u4f8b\ndocker service update \\\n  --replicas 10 \\\n  --update-parallelism 1 \\\n  --image myapp:v2 \\\n  app\n\n# \u89c2\u5bdf\u6307\u6807\uff0c\u786e\u8ba4\u65e0\u8bef\u540e\u7ee7\u7eed\ndocker service update \\\n  --update-parallelism 3 \\\n  --image myapp:v2 \\\n  app\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-traefik-\u6743\u91cd\u8def\u7531",children:"\u4f7f\u7528 Traefik \u6743\u91cd\u8def\u7531"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'services:\n  app-v1:\n    image: myapp:v1\n    labels:\n      - "traefik.http.services.app-v1.loadbalancer.server.weight=90"\n\n  app-v2:\n    image: myapp:v2\n    labels:\n      - "traefik.http.services.app-v2.loadbalancer.server.weight=10"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u6eda\u52a8\u66f4\u65b0",children:"\u6eda\u52a8\u66f4\u65b0"}),"\n",(0,s.jsx)(n.h3,{id:"docker-swarm-\u914d\u7f6e",children:"Docker Swarm \u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker service update \\\n  --update-delay 10s \\\n  --update-parallelism 2 \\\n  --update-failure-action rollback \\\n  --update-max-failure-ratio 0.2 \\\n  --image myapp:v2 \\\n  app\n"})}),"\n",(0,s.jsx)(n.h3,{id:"docker-compose-swarm-mode",children:"Docker Compose (Swarm mode)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"services:\n  app:\n    image: myapp:v2\n    deploy:\n      replicas: 6\n      update_config:\n        parallelism: 2\n        delay: 10s\n        failure_action: rollback\n        max_failure_ratio: 0.2\n        order: start-first\n      rollback_config:\n        parallelism: 1\n        delay: 5s\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u5065\u5eb7\u68c0\u67e5",children:"\u5065\u5eb7\u68c0\u67e5"}),"\n",(0,s.jsx)(n.h3,{id:"dockerfile-\u5065\u5eb7\u68c0\u67e5",children:"Dockerfile \u5065\u5eb7\u68c0\u67e5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \\\n  CMD curl -f http://localhost:8080/health || exit 1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"docker-compose-\u5065\u5eb7\u68c0\u67e5",children:"Docker Compose \u5065\u5eb7\u68c0\u67e5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'services:\n  app:\n    image: myapp\n    healthcheck:\n      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n    depends_on:\n      db:\n        condition: service_healthy\n\n  db:\n    image: postgres\n    healthcheck:\n      test: ["CMD-SHELL", "pg_isready -U postgres"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u707e\u5907\u4e0e\u8fc1\u79fb",children:"\u707e\u5907\u4e0e\u8fc1\u79fb"}),"\n",(0,s.jsx)(n.h3,{id:"\u6570\u636e\u5907\u4efd\u7b56\u7565",children:"\u6570\u636e\u5907\u4efd\u7b56\u7565"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u5b9a\u65f6\u5907\u4efd\u811a\u672c\n#!/bin/bash\nBACKUP_DIR=/backups/$(date +%Y%m%d)\nmkdir -p $BACKUP_DIR\n\n# \u5907\u4efd\u6570\u636e\u5377\nfor volume in $(docker volume ls -q); do\n  docker run --rm \\\n    -v $volume:/data \\\n    -v $BACKUP_DIR:/backup \\\n    alpine tar czf /backup/$volume.tar.gz -C /data .\ndone\n\n# \u5907\u4efd\u5bb9\u5668\u914d\u7f6e\ndocker inspect $(docker ps -aq) > $BACKUP_DIR/containers.json\n\n# \u6e05\u7406\u65e7\u5907\u4efd\uff08\u4fdd\u7559 7 \u5929\uff09\nfind /backups -type d -mtime +7 -exec rm -rf {} +\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u6570\u636e\u6062\u590d",children:"\u6570\u636e\u6062\u590d"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u6062\u590d\u6570\u636e\u5377\ndocker volume create mydata\ndocker run --rm \\\n  -v mydata:/data \\\n  -v /backups/20240101:/backup \\\n  alpine tar xzf /backup/mydata.tar.gz -C /data\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u8de8\u4e3b\u673a\u8fc1\u79fb",children:"\u8de8\u4e3b\u673a\u8fc1\u79fb"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u6e90\u4e3b\u673a\uff1a\u5bfc\u51fa\ndocker save myapp:latest | gzip > myapp.tar.gz\ndocker run --rm -v mydata:/data -v /tmp:/backup alpine \\\n  tar czf /backup/mydata.tar.gz -C /data .\n\n# \u4f20\u8f93\nscp myapp.tar.gz mydata.tar.gz user@newhost:/tmp/\n\n# \u76ee\u6807\u4e3b\u673a\uff1a\u5bfc\u5165\ndocker load < /tmp/myapp.tar.gz\ndocker volume create mydata\ndocker run --rm -v mydata:/data -v /tmp:/backup alpine \\\n  tar xzf /backup/mydata.tar.gz -C /data\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u9ad8\u53ef\u7528\u914d\u7f6e",children:"\u9ad8\u53ef\u7528\u914d\u7f6e"}),"\n",(0,s.jsx)(n.h3,{id:"docker-swarm-\u9ad8\u53ef\u7528",children:"Docker Swarm \u9ad8\u53ef\u7528"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u521d\u59cb\u5316 Swarm\uff08\u7b2c\u4e00\u4e2a manager\uff09\ndocker swarm init --advertise-addr 192.168.1.1\n\n# \u6dfb\u52a0 manager \u8282\u70b9\uff08\u81f3\u5c11 3 \u4e2a\u5b9e\u73b0\u9ad8\u53ef\u7528\uff09\ndocker swarm join-token manager\n# \u5728\u5176\u4ed6\u8282\u70b9\u6267\u884c\u8f93\u51fa\u7684\u547d\u4ee4\n\n# \u6dfb\u52a0 worker \u8282\u70b9\ndocker swarm join-token worker\n\n# \u67e5\u770b\u8282\u70b9\u72b6\u6001\ndocker node ls\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u670d\u52a1\u9ad8\u53ef\u7528",children:"\u670d\u52a1\u9ad8\u53ef\u7528"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"services:\n  app:\n    image: myapp\n    deploy:\n      replicas: 3\n      placement:\n        constraints:\n          - node.role == worker\n        preferences:\n          - spread: node.labels.zone\n      restart_policy:\n        condition: on-failure\n        delay: 5s\n        max_attempts: 3\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u76d1\u63a7\u544a\u8b66",children:"\u76d1\u63a7\u544a\u8b66"}),"\n",(0,s.jsx)(n.h3,{id:"\u57fa\u7840\u76d1\u63a7\u6808",children:"\u57fa\u7840\u76d1\u63a7\u6808"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'version: "3.8"\n\nservices:\n  prometheus:\n    image: prom/prometheus\n    volumes:\n      - ./prometheus.yml:/etc/prometheus/prometheus.yml\n    ports:\n      - "9090:9090"\n\n  alertmanager:\n    image: prom/alertmanager\n    volumes:\n      - ./alertmanager.yml:/etc/alertmanager/alertmanager.yml\n    ports:\n      - "9093:9093"\n\n  grafana:\n    image: grafana/grafana\n    ports:\n      - "3000:3000"\n    environment:\n      - GF_SECURITY_ADMIN_PASSWORD=admin\n\n  node-exporter:\n    image: prom/node-exporter\n    volumes:\n      - /proc:/host/proc:ro\n      - /sys:/host/sys:ro\n    command:\n      - \'--path.procfs=/host/proc\'\n      - \'--path.sysfs=/host/sys\'\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u544a\u8b66\u89c4\u5219\u793a\u4f8b",children:"\u544a\u8b66\u89c4\u5219\u793a\u4f8b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'# prometheus/alerts.yml\ngroups:\n  - name: container-alerts\n    rules:\n      - alert: ContainerHighCPU\n        expr: rate(container_cpu_usage_seconds_total[5m]) > 0.8\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: "Container CPU usage high"\n\n      - alert: ContainerHighMemory\n        expr: container_memory_usage_bytes / container_spec_memory_limit_bytes > 0.9\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: "Container memory usage high"\n\n      - alert: ContainerDown\n        expr: absent(container_last_seen{name=~".+"})\n        for: 1m\n        labels:\n          severity: critical\n        annotations:\n          summary: "Container is down"\n'})})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},48885:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>c});var a=r(99378);const s={},l=a.createContext(s);function d(e){const n=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),a.createElement(l.Provider,{value:n},e.children)}}}]);
"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[10901],{48885:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>l});var r=s(99378);const d={},t=r.createContext(d);function i(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:i(e.components),r.createElement(t.Provider,{value:n},e.children)}},62773:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>o,frontMatter:()=>i,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"rocketmq/message-types","title":"\u6d88\u606f\u7c7b\u578b","description":"RocketMQ \u5404\u79cd\u6d88\u606f\u7c7b\u578b\u8be6\u89e3\uff1a\u666e\u901a\u6d88\u606f\u3001\u987a\u5e8f\u6d88\u606f\u3001\u5ef6\u8fdf\u6d88\u606f\u3001\u4e8b\u52a1\u6d88\u606f","source":"@site/docs/rocketmq/message-types.md","sourceDirName":"rocketmq","slug":"/rocketmq/message-types","permalink":"/docs/rocketmq/message-types","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/rocketmq/message-types.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"\u6d88\u606f\u7c7b\u578b","description":"RocketMQ \u5404\u79cd\u6d88\u606f\u7c7b\u578b\u8be6\u89e3\uff1a\u666e\u901a\u6d88\u606f\u3001\u987a\u5e8f\u6d88\u606f\u3001\u5ef6\u8fdf\u6d88\u606f\u3001\u4e8b\u52a1\u6d88\u606f"},"sidebar":"rocketmq","previous":{"title":"\u6838\u5fc3\u6982\u5ff5","permalink":"/docs/rocketmq/core-concepts"},"next":{"title":"\u751f\u4ea7\u8005\u8be6\u89e3","permalink":"/docs/rocketmq/producer"}}');var d=s(22714),t=s(48885);const i={sidebar_position:7,title:"\u6d88\u606f\u7c7b\u578b",description:"RocketMQ \u5404\u79cd\u6d88\u606f\u7c7b\u578b\u8be6\u89e3\uff1a\u666e\u901a\u6d88\u606f\u3001\u987a\u5e8f\u6d88\u606f\u3001\u5ef6\u8fdf\u6d88\u606f\u3001\u4e8b\u52a1\u6d88\u606f"},l="RocketMQ \u6d88\u606f\u7c7b\u578b",c={},a=[{value:"\u6d88\u606f\u7c7b\u578b\u6982\u89c8",id:"\u6d88\u606f\u7c7b\u578b\u6982\u89c8",level:2},{value:"\u666e\u901a\u6d88\u606f",id:"\u666e\u901a\u6d88\u606f",level:2},{value:"\u53d1\u9001\u793a\u4f8b",id:"\u53d1\u9001\u793a\u4f8b",level:3},{value:"\u6d88\u8d39\u793a\u4f8b",id:"\u6d88\u8d39\u793a\u4f8b",level:3},{value:"\u987a\u5e8f\u6d88\u606f",id:"\u987a\u5e8f\u6d88\u606f",level:2},{value:"\u987a\u5e8f\u7c7b\u578b",id:"\u987a\u5e8f\u7c7b\u578b",level:3},{value:"\u5206\u533a\u987a\u5e8f\u793a\u4f8b",id:"\u5206\u533a\u987a\u5e8f\u793a\u4f8b",level:3},{value:"\u987a\u5e8f\u6d88\u8d39",id:"\u987a\u5e8f\u6d88\u8d39",level:3},{value:"\u987a\u5e8f\u6d88\u606f\u6d41\u7a0b",id:"\u987a\u5e8f\u6d88\u606f\u6d41\u7a0b",level:3},{value:"\u5ef6\u8fdf\u6d88\u606f",id:"\u5ef6\u8fdf\u6d88\u606f",level:2},{value:"\u5ef6\u8fdf\u7ea7\u522b",id:"\u5ef6\u8fdf\u7ea7\u522b",level:3},{value:"\u53d1\u9001\u5ef6\u8fdf\u6d88\u606f",id:"\u53d1\u9001\u5ef6\u8fdf\u6d88\u606f",level:3},{value:"\u5ef6\u8fdf\u6d88\u606f\u5e94\u7528\u573a\u666f",id:"\u5ef6\u8fdf\u6d88\u606f\u5e94\u7528\u573a\u666f",level:3},{value:"\u8ba2\u5355\u8d85\u65f6\u793a\u4f8b",id:"\u8ba2\u5355\u8d85\u65f6\u793a\u4f8b",level:3},{value:"\u4e8b\u52a1\u6d88\u606f",id:"\u4e8b\u52a1\u6d88\u606f",level:2},{value:"\u4e8b\u52a1\u6d88\u606f\u6d41\u7a0b",id:"\u4e8b\u52a1\u6d88\u606f\u6d41\u7a0b",level:3},{value:"\u4e8b\u52a1\u751f\u4ea7\u8005",id:"\u4e8b\u52a1\u751f\u4ea7\u8005",level:3},{value:"\u4e8b\u52a1\u6d88\u606f\u6700\u4f73\u5b9e\u8df5",id:"\u4e8b\u52a1\u6d88\u606f\u6700\u4f73\u5b9e\u8df5",level:3},{value:"\u6279\u91cf\u6d88\u606f",id:"\u6279\u91cf\u6d88\u606f",level:2},{value:"\u53d1\u9001\u6279\u91cf\u6d88\u606f",id:"\u53d1\u9001\u6279\u91cf\u6d88\u606f",level:3},{value:"\u6d88\u606f\u5206\u5272",id:"\u6d88\u606f\u5206\u5272",level:3},{value:"\u6279\u91cf\u6d88\u606f\u9650\u5236",id:"\u6279\u91cf\u6d88\u606f\u9650\u5236",level:3},{value:"\u6d88\u606f\u7c7b\u578b\u9009\u62e9\u6307\u5357",id:"\u6d88\u606f\u7c7b\u578b\u9009\u62e9\u6307\u5357",level:2},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"rocketmq-\u6d88\u606f\u7c7b\u578b",children:"RocketMQ \u6d88\u606f\u7c7b\u578b"})}),"\n",(0,d.jsx)(n.p,{children:"RocketMQ \u652f\u6301\u591a\u79cd\u6d88\u606f\u7c7b\u578b\uff0c\u6ee1\u8db3\u4e0d\u540c\u4e1a\u52a1\u573a\u666f\u7684\u9700\u6c42\u3002"}),"\n",(0,d.jsx)(n.h2,{id:"\u6d88\u606f\u7c7b\u578b\u6982\u89c8",children:"\u6d88\u606f\u7c7b\u578b\u6982\u89c8"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u7279\u70b9"}),(0,d.jsx)(n.th,{children:"\u4f7f\u7528\u573a\u666f"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u666e\u901a\u6d88\u606f"}),(0,d.jsx)(n.td,{children:"\u65e0\u7279\u6b8a\u5904\u7406"}),(0,d.jsx)(n.td,{children:"\u4e00\u822c\u4e1a\u52a1\u6d88\u606f"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u987a\u5e8f\u6d88\u606f"}),(0,d.jsx)(n.td,{children:"\u4fdd\u8bc1\u6d88\u8d39\u987a\u5e8f"}),(0,d.jsx)(n.td,{children:"\u8ba2\u5355\u6d41\u7a0b\u3001\u72b6\u6001\u53d8\u66f4"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u5ef6\u8fdf\u6d88\u606f"}),(0,d.jsx)(n.td,{children:"\u5ef6\u8fdf\u6295\u9012"}),(0,d.jsx)(n.td,{children:"\u5b9a\u65f6\u4efb\u52a1\u3001\u8d85\u65f6\u5904\u7406"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u4e8b\u52a1\u6d88\u606f"}),(0,d.jsx)(n.td,{children:"\u5206\u5e03\u5f0f\u4e8b\u52a1"}),(0,d.jsx)(n.td,{children:"\u8de8\u670d\u52a1\u6570\u636e\u4e00\u81f4\u6027"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u6279\u91cf\u6d88\u606f"}),(0,d.jsx)(n.td,{children:"\u6279\u91cf\u53d1\u9001"}),(0,d.jsx)(n.td,{children:"\u9ad8\u541e\u5410\u573a\u666f"})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"\u666e\u901a\u6d88\u606f",children:"\u666e\u901a\u6d88\u606f"}),"\n",(0,d.jsx)(n.p,{children:"\u6700\u57fa\u672c\u7684\u6d88\u606f\u7c7b\u578b\uff0c\u65e0\u7279\u6b8a\u5904\u7406\u903b\u8f91\u3002"}),"\n",(0,d.jsx)(n.h3,{id:"\u53d1\u9001\u793a\u4f8b",children:"\u53d1\u9001\u793a\u4f8b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'Message msg = new Message(\n    "TopicTest",           // Topic\n    "TagA",                // Tag\n    "OrderID001",          // Keys\n    "Hello RocketMQ".getBytes()  // Body\n);\n\nSendResult result = producer.send(msg);\n'})}),"\n",(0,d.jsx)(n.h3,{id:"\u6d88\u8d39\u793a\u4f8b",children:"\u6d88\u8d39\u793a\u4f8b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'consumer.subscribe("TopicTest", "*");\nconsumer.registerMessageListener((MessageListenerConcurrently) (msgs, context) -> {\n    for (MessageExt msg : msgs) {\n        System.out.println("\u6536\u5230\u6d88\u606f: " + new String(msg.getBody()));\n    }\n    return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;\n});\n'})}),"\n",(0,d.jsx)(n.h2,{id:"\u987a\u5e8f\u6d88\u606f",children:"\u987a\u5e8f\u6d88\u606f"}),"\n",(0,d.jsx)(n.p,{children:"\u4fdd\u8bc1\u6d88\u606f\u6309\u7167\u53d1\u9001\u987a\u5e8f\u88ab\u6d88\u8d39\u3002"}),"\n",(0,d.jsx)(n.h3,{id:"\u987a\u5e8f\u7c7b\u578b",children:"\u987a\u5e8f\u7c7b\u578b"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u8bf4\u660e"}),(0,d.jsx)(n.th,{children:"\u5b9e\u73b0\u65b9\u5f0f"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u5168\u5c40\u987a\u5e8f"}),(0,d.jsx)(n.td,{children:"\u6574\u4e2a Topic \u53ea\u6709\u4e00\u4e2a\u961f\u5217"}),(0,d.jsx)(n.td,{children:"\u5355 Queue"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u5206\u533a\u987a\u5e8f"}),(0,d.jsx)(n.td,{children:"\u540c\u4e00\u5206\u533a\u5185\u6709\u5e8f"}),(0,d.jsx)(n.td,{children:"\u6309\u4e1a\u52a1 Key \u8def\u7531"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"\u5206\u533a\u987a\u5e8f\u793a\u4f8b",children:"\u5206\u533a\u987a\u5e8f\u793a\u4f8b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'// \u751f\u4ea7\u8005\uff1a\u540c\u4e00\u8ba2\u5355\u53d1\u9001\u5230\u540c\u4e00 Queue\npublic void sendOrderly(String orderId, String status) throws Exception {\n    Message msg = new Message("OrderTopic", status,\n        String.format("%s: %s", orderId, status).getBytes());\n\n    // \u6839\u636e orderId \u9009\u62e9 Queue\n    SendResult result = producer.send(msg, (mqs, message, arg) -> {\n        String id = (String) arg;\n        int index = Math.abs(id.hashCode() % mqs.size());\n        return mqs.get(index);\n    }, orderId);\n\n    System.out.printf("\u8ba2\u5355 %s \u72b6\u6001 %s \u53d1\u9001\u6210\u529f%n", orderId, status);\n}\n\n// \u53d1\u9001\u8ba2\u5355\u6d41\u7a0b\u6d88\u606f\nsendOrderly("ORDER_001", "created");\nsendOrderly("ORDER_001", "paid");\nsendOrderly("ORDER_001", "shipped");\nsendOrderly("ORDER_001", "received");\n'})}),"\n",(0,d.jsx)(n.h3,{id:"\u987a\u5e8f\u6d88\u8d39",children:"\u987a\u5e8f\u6d88\u8d39"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'// \u5fc5\u987b\u4f7f\u7528 MessageListenerOrderly\nconsumer.registerMessageListener((MessageListenerOrderly) (msgs, context) -> {\n    for (MessageExt msg : msgs) {\n        System.out.printf("Queue:%d, \u6d88\u606f:%s%n",\n            msg.getQueueId(), new String(msg.getBody()));\n    }\n    return ConsumeOrderlyStatus.SUCCESS;\n});\n'})}),"\n",(0,d.jsx)(n.h3,{id:"\u987a\u5e8f\u6d88\u606f\u6d41\u7a0b",children:"\u987a\u5e8f\u6d88\u606f\u6d41\u7a0b"}),"\n",(0,d.jsx)(n.mermaid,{value:"graph LR\n    subgraph \u751f\u4ea7\u8005\n        O1[\u8ba2\u53551: \u521b\u5efa] --\x3e Q1[Queue 1]\n        O1_2[\u8ba2\u53551: \u652f\u4ed8] --\x3e Q1\n        O1_3[\u8ba2\u53551: \u53d1\u8d27] --\x3e Q1\n        O2[\u8ba2\u53552: \u521b\u5efa] --\x3e Q2[Queue 2]\n        O2_2[\u8ba2\u53552: \u652f\u4ed8] --\x3e Q2\n    end\n\n    subgraph \u6d88\u8d39\u8005\n        Q1 --\x3e C1[Consumer 1]\n        Q2 --\x3e C2[Consumer 2]\n    end\n\n    style Q1 fill:#1976d2,color:#fff\n    style Q2 fill:#2e7d32,color:#fff"}),"\n",(0,d.jsx)(n.h2,{id:"\u5ef6\u8fdf\u6d88\u606f",children:"\u5ef6\u8fdf\u6d88\u606f"}),"\n",(0,d.jsx)(n.p,{children:"\u6d88\u606f\u53d1\u9001\u540e\u4e0d\u7acb\u5373\u6295\u9012\uff0c\u800c\u662f\u5ef6\u8fdf\u4e00\u5b9a\u65f6\u95f4\u540e\u624d\u6295\u9012\u3002"}),"\n",(0,d.jsx)(n.h3,{id:"\u5ef6\u8fdf\u7ea7\u522b",children:"\u5ef6\u8fdf\u7ea7\u522b"}),"\n",(0,d.jsx)(n.p,{children:"RocketMQ \u5f00\u6e90\u7248\u672c\u652f\u6301 18 \u4e2a\u5ef6\u8fdf\u7ea7\u522b\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u7ea7\u522b"}),(0,d.jsx)(n.th,{children:"\u65f6\u95f4"}),(0,d.jsx)(n.th,{children:"\u7ea7\u522b"}),(0,d.jsx)(n.th,{children:"\u65f6\u95f4"}),(0,d.jsx)(n.th,{children:"\u7ea7\u522b"}),(0,d.jsx)(n.th,{children:"\u65f6\u95f4"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"1"}),(0,d.jsx)(n.td,{children:"1s"}),(0,d.jsx)(n.td,{children:"7"}),(0,d.jsx)(n.td,{children:"3m"}),(0,d.jsx)(n.td,{children:"13"}),(0,d.jsx)(n.td,{children:"9m"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"2"}),(0,d.jsx)(n.td,{children:"5s"}),(0,d.jsx)(n.td,{children:"8"}),(0,d.jsx)(n.td,{children:"4m"}),(0,d.jsx)(n.td,{children:"14"}),(0,d.jsx)(n.td,{children:"10m"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"3"}),(0,d.jsx)(n.td,{children:"10s"}),(0,d.jsx)(n.td,{children:"9"}),(0,d.jsx)(n.td,{children:"5m"}),(0,d.jsx)(n.td,{children:"15"}),(0,d.jsx)(n.td,{children:"20m"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"4"}),(0,d.jsx)(n.td,{children:"30s"}),(0,d.jsx)(n.td,{children:"10"}),(0,d.jsx)(n.td,{children:"6m"}),(0,d.jsx)(n.td,{children:"16"}),(0,d.jsx)(n.td,{children:"30m"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"5"}),(0,d.jsx)(n.td,{children:"1m"}),(0,d.jsx)(n.td,{children:"11"}),(0,d.jsx)(n.td,{children:"7m"}),(0,d.jsx)(n.td,{children:"17"}),(0,d.jsx)(n.td,{children:"1h"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"6"}),(0,d.jsx)(n.td,{children:"2m"}),(0,d.jsx)(n.td,{children:"12"}),(0,d.jsx)(n.td,{children:"8m"}),(0,d.jsx)(n.td,{children:"18"}),(0,d.jsx)(n.td,{children:"2h"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"\u53d1\u9001\u5ef6\u8fdf\u6d88\u606f",children:"\u53d1\u9001\u5ef6\u8fdf\u6d88\u606f"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'Message msg = new Message("TopicTest", "TagA", "Delay Message".getBytes());\n\n// \u8bbe\u7f6e\u5ef6\u8fdf\u7ea7\u522b 3 = 10 \u79d2\nmsg.setDelayTimeLevel(3);\n\nSendResult result = producer.send(msg);\nSystem.out.println("\u5ef6\u8fdf\u6d88\u606f\u53d1\u9001\u6210\u529f: " + result.getMsgId());\n'})}),"\n",(0,d.jsx)(n.h3,{id:"\u5ef6\u8fdf\u6d88\u606f\u5e94\u7528\u573a\u666f",children:"\u5ef6\u8fdf\u6d88\u606f\u5e94\u7528\u573a\u666f"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u573a\u666f"}),(0,d.jsx)(n.th,{children:"\u5ef6\u8fdf\u65f6\u95f4"}),(0,d.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u8ba2\u5355\u8d85\u65f6\u53d6\u6d88"}),(0,d.jsx)(n.td,{children:"30min"}),(0,d.jsx)(n.td,{children:"\u672a\u652f\u4ed8\u8ba2\u5355\u81ea\u52a8\u53d6\u6d88"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u77ed\u4fe1\u9a8c\u8bc1\u7801\u8fc7\u671f"}),(0,d.jsx)(n.td,{children:"5min"}),(0,d.jsx)(n.td,{children:"\u9a8c\u8bc1\u7801\u5230\u671f\u63d0\u9192"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u4f1a\u8bae\u63d0\u9192"}),(0,d.jsx)(n.td,{children:"\u63d0\u524d 10min"}),(0,d.jsx)(n.td,{children:"\u4f1a\u8bae\u5f00\u59cb\u524d\u63d0\u9192"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u5b9a\u65f6\u4efb\u52a1"}),(0,d.jsx)(n.td,{children:"\u81ea\u5b9a\u4e49"}),(0,d.jsx)(n.td,{children:"\u66ff\u4ee3\u90e8\u5206\u5b9a\u65f6\u4efb\u52a1"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"\u8ba2\u5355\u8d85\u65f6\u793a\u4f8b",children:"\u8ba2\u5355\u8d85\u65f6\u793a\u4f8b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'// \u521b\u5efa\u8ba2\u5355\u540e\u53d1\u9001\u5ef6\u8fdf\u6d88\u606f\npublic void createOrder(Order order) {\n    // 1. \u4fdd\u5b58\u8ba2\u5355\n    orderDao.save(order);\n\n    // 2. \u53d1\u9001\u5ef6\u8fdf\u6d88\u606f\uff0830\u5206\u949f\u540e\u68c0\u67e5\uff09\n    Message msg = new Message("OrderTimeoutTopic", "timeout",\n        order.getOrderId().getBytes());\n    msg.setDelayTimeLevel(16);  // 30 \u5206\u949f\n\n    producer.send(msg);\n}\n\n// \u6d88\u8d39\u8005\u68c0\u67e5\u8ba2\u5355\u72b6\u6001\nconsumer.subscribe("OrderTimeoutTopic", "*");\nconsumer.registerMessageListener((MessageListenerConcurrently) (msgs, context) -> {\n    for (MessageExt msg : msgs) {\n        String orderId = new String(msg.getBody());\n        Order order = orderDao.findById(orderId);\n\n        if (order != null && order.getStatus().equals("unpaid")) {\n            // \u53d6\u6d88\u8ba2\u5355\n            orderService.cancel(orderId);\n        }\n    }\n    return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;\n});\n'})}),"\n",(0,d.jsx)(n.h2,{id:"\u4e8b\u52a1\u6d88\u606f",children:"\u4e8b\u52a1\u6d88\u606f"}),"\n",(0,d.jsx)(n.p,{children:"\u4fdd\u8bc1\u672c\u5730\u4e8b\u52a1\u4e0e\u6d88\u606f\u53d1\u9001\u7684\u4e00\u81f4\u6027\u3002"}),"\n",(0,d.jsx)(n.h3,{id:"\u4e8b\u52a1\u6d88\u606f\u6d41\u7a0b",children:"\u4e8b\u52a1\u6d88\u606f\u6d41\u7a0b"}),"\n",(0,d.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant P as Producer\n    participant B as Broker\n    participant DB as \u6570\u636e\u5e93\n\n    P->>B: 1. \u53d1\u9001\u534a\u6d88\u606f\n    B--\x3e>P: 2. \u8fd4\u56de\u53d1\u9001\u7ed3\u679c\n    P->>DB: 3. \u6267\u884c\u672c\u5730\u4e8b\u52a1\n    DB--\x3e>P: 4. \u4e8b\u52a1\u7ed3\u679c\n\n    alt \u4e8b\u52a1\u6210\u529f\n        P->>B: 5a. Commit\n        B->>Consumer: \u6295\u9012\u6d88\u606f\n    else \u4e8b\u52a1\u5931\u8d25\n        P->>B: 5b. Rollback\n        B->>B: \u5220\u9664\u6d88\u606f\n    else \u72b6\u6001\u672a\u77e5\n        B->>P: 6. \u56de\u67e5\u4e8b\u52a1\u72b6\u6001\n        P->>DB: 7. \u67e5\u8be2\u4e8b\u52a1\u7ed3\u679c\n        P->>B: 8. Commit/Rollback\n    end"}),"\n",(0,d.jsx)(n.h3,{id:"\u4e8b\u52a1\u751f\u4ea7\u8005",children:"\u4e8b\u52a1\u751f\u4ea7\u8005"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'TransactionMQProducer producer = new TransactionMQProducer("TransactionGroup");\nproducer.setNamesrvAddr("localhost:9876");\n\n// \u8bbe\u7f6e\u4e8b\u52a1\u76d1\u542c\u5668\nproducer.setTransactionListener(new TransactionListener() {\n\n    @Override\n    public LocalTransactionState executeLocalTransaction(Message msg, Object arg) {\n        // \u6267\u884c\u672c\u5730\u4e8b\u52a1\n        String orderId = msg.getKeys();\n        try {\n            orderService.createOrder(orderId);\n            return LocalTransactionState.COMMIT_MESSAGE;\n        } catch (Exception e) {\n            return LocalTransactionState.ROLLBACK_MESSAGE;\n        }\n    }\n\n    @Override\n    public LocalTransactionState checkLocalTransaction(MessageExt msg) {\n        // \u56de\u67e5\u4e8b\u52a1\u72b6\u6001\n        String orderId = msg.getKeys();\n        Order order = orderDao.findById(orderId);\n\n        if (order != null) {\n            return LocalTransactionState.COMMIT_MESSAGE;\n        } else {\n            return LocalTransactionState.ROLLBACK_MESSAGE;\n        }\n    }\n});\n\nproducer.start();\n\n// \u53d1\u9001\u4e8b\u52a1\u6d88\u606f\nMessage msg = new Message("OrderTopic", "create",\n    "Order created".getBytes());\nmsg.setKeys("ORDER_001");\n\nTransactionSendResult result = producer.sendMessageInTransaction(msg, null);\n'})}),"\n",(0,d.jsx)(n.h3,{id:"\u4e8b\u52a1\u6d88\u606f\u6700\u4f73\u5b9e\u8df5",children:"\u4e8b\u52a1\u6d88\u606f\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u672c\u5730\u4e8b\u52a1\u8868"}),"\uff1a\u8bb0\u5f55\u4e8b\u52a1\u6267\u884c\u72b6\u6001\uff0c\u4fbf\u4e8e\u56de\u67e5"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u5e42\u7b49\u5904\u7406"}),"\uff1a\u6d88\u606f\u53ef\u80fd\u91cd\u590d\u6295\u9012"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u8d85\u65f6\u8bbe\u7f6e"}),"\uff1a\u5408\u7406\u8bbe\u7f6e\u56de\u67e5\u8d85\u65f6\u65f6\u95f4"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:"// \u672c\u5730\u4e8b\u52a1\u8868\nCREATE TABLE transaction_log (\n    id BIGINT PRIMARY KEY,\n    msg_id VARCHAR(64) NOT NULL,\n    status VARCHAR(16) NOT NULL,  -- PENDING, COMMITTED, ROLLED_BACK\n    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n"})}),"\n",(0,d.jsx)(n.h2,{id:"\u6279\u91cf\u6d88\u606f",children:"\u6279\u91cf\u6d88\u606f"}),"\n",(0,d.jsx)(n.p,{children:"\u4e00\u6b21\u53d1\u9001\u591a\u6761\u6d88\u606f\uff0c\u63d0\u9ad8\u53d1\u9001\u6548\u7387\u3002"}),"\n",(0,d.jsx)(n.h3,{id:"\u53d1\u9001\u6279\u91cf\u6d88\u606f",children:"\u53d1\u9001\u6279\u91cf\u6d88\u606f"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'List<Message> messages = new ArrayList<>();\n\nfor (int i = 0; i < 100; i++) {\n    messages.add(new Message("TopicTest", "TagA",\n        ("Message " + i).getBytes()));\n}\n\n// \u76f4\u63a5\u53d1\u9001\uff08\u6ce8\u610f\u603b\u5927\u5c0f\u4e0d\u8d85\u8fc7 4MB\uff09\nSendResult result = producer.send(messages);\n'})}),"\n",(0,d.jsx)(n.h3,{id:"\u6d88\u606f\u5206\u5272",children:"\u6d88\u606f\u5206\u5272"}),"\n",(0,d.jsx)(n.p,{children:"\u5f53\u6d88\u606f\u603b\u5927\u5c0f\u8d85\u8fc7\u9650\u5236\u65f6\uff0c\u9700\u8981\u5206\u5272\u53d1\u9001\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:"public class MessageSplitter implements Iterator<List<Message>> {\n    private static final int MAX_SIZE = 4 * 1024 * 1024; // 4MB\n    private final List<Message> messages;\n    private int index;\n\n    public MessageSplitter(List<Message> messages) {\n        this.messages = messages;\n    }\n\n    @Override\n    public boolean hasNext() {\n        return index < messages.size();\n    }\n\n    @Override\n    public List<Message> next() {\n        int totalSize = 0;\n        int start = index;\n\n        while (index < messages.size()) {\n            Message msg = messages.get(index);\n            int size = msg.getBody().length + msg.getTopic().length() + 20;\n\n            if (totalSize + size > MAX_SIZE) {\n                break;\n            }\n\n            totalSize += size;\n            index++;\n        }\n\n        return messages.subList(start, index);\n    }\n}\n\n// \u4f7f\u7528\u5206\u5272\u5668\nMessageSplitter splitter = new MessageSplitter(messages);\nwhile (splitter.hasNext()) {\n    List<Message> batch = splitter.next();\n    producer.send(batch);\n}\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u6279\u91cf\u6d88\u606f\u9650\u5236",children:"\u6279\u91cf\u6d88\u606f\u9650\u5236"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u9650\u5236"}),(0,d.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u540c\u4e00 Topic"}),(0,d.jsx)(n.td,{children:"\u6279\u91cf\u6d88\u606f\u5fc5\u987b\u53d1\u9001\u5230\u540c\u4e00 Topic"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u603b\u5927\u5c0f"}),(0,d.jsx)(n.td,{children:"\u4e0d\u8d85\u8fc7 4MB"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u4e0d\u652f\u6301\u5ef6\u8fdf"}),(0,d.jsx)(n.td,{children:"\u6279\u91cf\u6d88\u606f\u4e0d\u652f\u6301\u5ef6\u8fdf\u6295\u9012"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u4e0d\u652f\u6301\u4e8b\u52a1"}),(0,d.jsx)(n.td,{children:"\u6279\u91cf\u6d88\u606f\u4e0d\u652f\u6301\u4e8b\u52a1"})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"\u6d88\u606f\u7c7b\u578b\u9009\u62e9\u6307\u5357",children:"\u6d88\u606f\u7c7b\u578b\u9009\u62e9\u6307\u5357"}),"\n",(0,d.jsx)(n.mermaid,{value:"graph TD\n    Start[\u4e1a\u52a1\u9700\u6c42] --\x3e Q1{\u9700\u8981\u4fdd\u8bc1\u987a\u5e8f?}\n    Q1 --\x3e|\u662f| Orderly[\u987a\u5e8f\u6d88\u606f]\n    Q1 --\x3e|\u5426| Q2{\u9700\u8981\u5ef6\u8fdf\u6295\u9012?}\n    Q2 --\x3e|\u662f| Delay[\u5ef6\u8fdf\u6d88\u606f]\n    Q2 --\x3e|\u5426| Q3{\u9700\u8981\u5206\u5e03\u5f0f\u4e8b\u52a1?}\n    Q3 --\x3e|\u662f| Transaction[\u4e8b\u52a1\u6d88\u606f]\n    Q3 --\x3e|\u5426| Q4{\u9700\u8981\u9ad8\u541e\u5410?}\n    Q4 --\x3e|\u662f| Batch[\u6279\u91cf\u6d88\u606f]\n    Q4 --\x3e|\u5426| Normal[\u666e\u901a\u6d88\u606f]\n\n    style Orderly fill:#1976d2,color:#fff\n    style Delay fill:#ff9800,color:#fff\n    style Transaction fill:#d32f2f,color:#fff\n    style Batch fill:#2e7d32,color:#fff\n    style Normal fill:#9e9e9e,color:#fff"}),"\n",(0,d.jsx)(n.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\ud83d\udcbb ",(0,d.jsx)(n.a,{href:"/docs/rocketmq/producer",children:"\u751f\u4ea7\u8005\u8be6\u89e3"})," - \u6df1\u5165\u5b66\u4e60\u6d88\u606f\u53d1\u9001"]}),"\n",(0,d.jsxs)(n.li,{children:["\ud83d\udcca ",(0,d.jsx)(n.a,{href:"/docs/rocketmq/consumer",children:"\u6d88\u8d39\u8005\u8be6\u89e3"})," - \u6df1\u5165\u5b66\u4e60\u6d88\u606f\u6d88\u8d39"]}),"\n",(0,d.jsxs)(n.li,{children:["\ud83d\udccb ",(0,d.jsx)(n.a,{href:"/docs/rocketmq/quick-reference",children:"\u5feb\u901f\u53c2\u8003"})," - \u5e38\u7528 API \u901f\u67e5"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://rocketmq.apache.org/docs/featureBehavior/",children:"RocketMQ \u6d88\u606f\u7c7b\u578b\u5b98\u65b9\u6587\u6863"})}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}}}]);
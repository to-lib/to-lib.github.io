"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[247],{47091:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"springboot/cache-management","title":"\u7f13\u5b58\u7ba1\u7406","description":"[!TIP]","source":"@site/docs/springboot/cache-management.md","sourceDirName":"springboot","slug":"/springboot/cache-management","permalink":"/docs/springboot/cache-management","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/springboot/cache-management.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9},"sidebar":"springboot","previous":{"title":"\u6570\u636e\u8bbf\u95ee","permalink":"/docs/springboot/data-access"},"next":{"title":"\u5f02\u6b65\u5904\u7406","permalink":"/docs/springboot/async"}}');var s=r(22714),a=r(48885);const t={sidebar_position:9},l="\u7f13\u5b58\u7ba1\u7406",c={},o=[{value:"\u542f\u7528\u7f13\u5b58",id:"\u542f\u7528\u7f13\u5b58",level:2},{value:"\u914d\u7f6e\u7f13\u5b58",id:"\u914d\u7f6e\u7f13\u5b58",level:3},{value:"\u4f7f\u7528\u7f13\u5b58\u6ce8\u89e3",id:"\u4f7f\u7528\u7f13\u5b58\u6ce8\u89e3",level:2},{value:"@Cacheable - \u8bfb\u7f13\u5b58",id:"cacheable---\u8bfb\u7f13\u5b58",level:3},{value:"@CachePut - \u5199\u7f13\u5b58",id:"cacheput---\u5199\u7f13\u5b58",level:3},{value:"@CacheEvict - \u6e05\u9664\u7f13\u5b58",id:"cacheevict---\u6e05\u9664\u7f13\u5b58",level:3},{value:"@Caching - \u7ec4\u5408\u6ce8\u89e3",id:"caching---\u7ec4\u5408\u6ce8\u89e3",level:3},{value:"Redis \u7f13\u5b58",id:"redis-\u7f13\u5b58",level:2},{value:"\u4f9d\u8d56\u914d\u7f6e",id:"\u4f9d\u8d56\u914d\u7f6e",level:3},{value:"Redis \u914d\u7f6e",id:"redis-\u914d\u7f6e",level:3},{value:"\u4f7f\u7528 Redis \u4f5c\u4e3a\u7f13\u5b58",id:"\u4f7f\u7528-redis-\u4f5c\u4e3a\u7f13\u5b58",level:3},{value:"Redis \u76f4\u63a5\u64cd\u4f5c",id:"redis-\u76f4\u63a5\u64cd\u4f5c",level:3},{value:"Caffeine \u7f13\u5b58",id:"caffeine-\u7f13\u5b58",level:2},{value:"\u4f9d\u8d56\u914d\u7f6e",id:"\u4f9d\u8d56\u914d\u7f6e-1",level:3},{value:"\u914d\u7f6e Caffeine",id:"\u914d\u7f6e-caffeine",level:3},{value:"\u4f7f\u7528 Caffeine",id:"\u4f7f\u7528-caffeine",level:3},{value:"\u7f13\u5b58\u66f4\u65b0\u7b56\u7565",id:"\u7f13\u5b58\u66f4\u65b0\u7b56\u7565",level:2},{value:"\u65c1\u8def\u7f13\u5b58\uff08Cache Aside\uff09",id:"\u65c1\u8def\u7f13\u5b58cache-aside",level:3},{value:"\u5199\u7a7f\uff08Write Through\uff09",id:"\u5199\u7a7fwrite-through",level:3},{value:"\u5199\u56de\uff08Write Behind\uff09",id:"\u5199\u56dewrite-behind",level:3},{value:"\u7f13\u5b58\u7a7f\u900f\u548c\u96ea\u5d29",id:"\u7f13\u5b58\u7a7f\u900f\u548c\u96ea\u5d29",level:2},{value:"\u7f13\u5b58\u7a7f\u900f\u89e3\u51b3\u65b9\u6848",id:"\u7f13\u5b58\u7a7f\u900f\u89e3\u51b3\u65b9\u6848",level:3},{value:"\u7f13\u5b58\u96ea\u5d29\u89e3\u51b3\u65b9\u6848",id:"\u7f13\u5b58\u96ea\u5d29\u89e3\u51b3\u65b9\u6848",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u7f13\u5b58\u7ba1\u7406",children:"\u7f13\u5b58\u7ba1\u7406"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["[!TIP]\n",(0,s.jsx)(n.strong,{children:"\u7f13\u5b58\u662f\u6027\u80fd\u4f18\u5316\u7684\u5229\u5668"}),": Spring Cache \u62bd\u8c61\u5c42\u652f\u6301 Redis\u3001Caffeine \u7b49\u591a\u79cd\u7f13\u5b58\u5b9e\u73b0\u3002\u5408\u7406\u4f7f\u7528\u7f13\u5b58\u53ef\u663e\u8457\u63d0\u5347\u6027\u80fd\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u542f\u7528\u7f13\u5b58",children:"\u542f\u7528\u7f13\u5b58"}),"\n",(0,s.jsx)(n.h3,{id:"\u914d\u7f6e\u7f13\u5b58",children:"\u914d\u7f6e\u7f13\u5b58"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'import org.springframework.cache.annotation.EnableCaching;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.cache.CacheManager;\nimport org.springframework.cache.concurrent.ConcurrentMapCacheManager;\n\n@Configuration\n@EnableCaching\npublic class CacheConfig {\n    \n    @Bean\n    public CacheManager cacheManager() {\n        // \u4f7f\u7528\u5185\u5b58\u7f13\u5b58\u7ba1\u7406\u5668\n        return new ConcurrentMapCacheManager("users", "posts", "comments");\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u4f7f\u7528\u7f13\u5b58\u6ce8\u89e3",children:"\u4f7f\u7528\u7f13\u5b58\u6ce8\u89e3"}),"\n",(0,s.jsx)(n.h3,{id:"cacheable---\u8bfb\u7f13\u5b58",children:"@Cacheable - \u8bfb\u7f13\u5b58"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'import org.springframework.cache.annotation.Cacheable;\n\n@Service\npublic class UserService {\n    \n    // \u4ece\u7f13\u5b58\u8bfb\u53d6\uff0c\u5982\u679c\u7f13\u5b58\u4e2d\u6ca1\u6709\u5219\u8c03\u7528\u65b9\u6cd5\u5e76\u7f13\u5b58\u7ed3\u679c\n    @Cacheable(value = "users", key = "#id")\n    public User getUserById(Long id) {\n        System.out.println("\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u7528\u6237: " + id);\n        return userRepository.findById(id).orElse(null);\n    }\n    \n    // \u4f7f\u7528\u6761\u4ef6\u7f13\u5b58\n    @Cacheable(value = "users", key = "#id", \n               condition = "#id > 0", \n               unless = "#result == null")\n    public User getActiveUser(Long id) {\n        return userRepository.findById(id).orElse(null);\n    }\n    \n    // \u81ea\u5b9a\u4e49\u7f13\u5b58 key\n    @Cacheable(value = "usersByEmail", key = "\'email:\' + #email")\n    public User getUserByEmail(String email) {\n        return userRepository.findByEmail(email);\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"cacheput---\u5199\u7f13\u5b58",children:"@CachePut - \u5199\u7f13\u5b58"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'import org.springframework.cache.annotation.CachePut;\n\n@Service\npublic class UserService {\n    \n    // \u6bcf\u6b21\u90fd\u6267\u884c\u65b9\u6cd5\uff0c\u5e76\u66f4\u65b0\u7f13\u5b58\n    @CachePut(value = "users", key = "#result.id")\n    public User createUser(User user) {\n        return userRepository.save(user);\n    }\n    \n    // \u66f4\u65b0\u7528\u6237\u5e76\u66f4\u65b0\u7f13\u5b58\n    @CachePut(value = "users", key = "#id")\n    public User updateUser(Long id, User userDetails) {\n        User user = userRepository.findById(id).orElseThrow();\n        user.setName(userDetails.getName());\n        user.setEmail(userDetails.getEmail());\n        return userRepository.save(user);\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"cacheevict---\u6e05\u9664\u7f13\u5b58",children:"@CacheEvict - \u6e05\u9664\u7f13\u5b58"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'import org.springframework.cache.annotation.CacheEvict;\n\n@Service\npublic class UserService {\n    \n    // \u5220\u9664\u5355\u4e2a\u7f13\u5b58\n    @CacheEvict(value = "users", key = "#id")\n    public void deleteUser(Long id) {\n        userRepository.deleteById(id);\n    }\n    \n    // \u6e05\u9664\u6240\u6709\u7f13\u5b58\n    @CacheEvict(value = "users", allEntries = true)\n    public void clearAllUsers() {\n        // \u6e05\u9664 users \u7f13\u5b58\u4e2d\u7684\u6240\u6709\u6761\u76ee\n    }\n    \n    // \u5220\u9664\u524d\u6e05\u9664\u7f13\u5b58\n    @CacheEvict(value = "users", key = "#id", beforeInvocation = true)\n    public void deleteUserBefore(Long id) {\n        userRepository.deleteById(id);\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"caching---\u7ec4\u5408\u6ce8\u89e3",children:"@Caching - \u7ec4\u5408\u6ce8\u89e3"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'import org.springframework.cache.annotation.Caching;\n\n@Service\npublic class UserService {\n    \n    // \u540c\u65f6\u66f4\u65b0\u591a\u4e2a\u7f13\u5b58\n    @Caching(\n        cacheable = {\n            @Cacheable(value = "users", key = "#id")\n        },\n        put = {\n            @CachePut(value = "usersByEmail", key = "#result.email")\n        }\n    )\n    public User getUserById(Long id) {\n        return userRepository.findById(id).orElse(null);\n    }\n    \n    // \u5220\u9664\u591a\u4e2a\u7f13\u5b58\n    @Caching(\n        evict = {\n            @CacheEvict(value = "users", key = "#id"),\n            @CacheEvict(value = "usersByEmail", key = "#user.email")\n        }\n    )\n    public void deleteUser(Long id, User user) {\n        userRepository.deleteById(id);\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"redis-\u7f13\u5b58",children:"Redis \u7f13\u5b58"}),"\n",(0,s.jsx)(n.h3,{id:"\u4f9d\u8d56\u914d\u7f6e",children:"\u4f9d\u8d56\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-redis</artifactId>\n</dependency>\n\n<dependency>\n    <groupId>redis.clients</groupId>\n    <artifactId>jedis</artifactId>\n</dependency>\n"})}),"\n",(0,s.jsx)(n.h3,{id:"redis-\u914d\u7f6e",children:"Redis \u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spring:\n  redis:\n    host: localhost\n    port: 6379\n    password: \n    database: 0\n    timeout: 2000ms\n    jedis:\n      pool:\n        max-active: 8\n        max-idle: 8\n        min-idle: 0\n        max-wait: -1ms\n  \n  cache:\n    type: redis\n    redis:\n      time-to-live: 600000  # 10 \u5206\u949f\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-redis-\u4f5c\u4e3a\u7f13\u5b58",children:"\u4f7f\u7528 Redis \u4f5c\u4e3a\u7f13\u5b58"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"import org.springframework.cache.annotation.EnableCaching;\nimport org.springframework.cache.CacheManager;\nimport org.springframework.data.redis.cache.RedisCacheManager;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\n@EnableCaching\npublic class RedisConfig {\n    \n    @Bean\n    public CacheManager cacheManager(RedisConnectionFactory connectionFactory) {\n        return RedisCacheManager.create(connectionFactory);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"redis-\u76f4\u63a5\u64cd\u4f5c",children:"Redis \u76f4\u63a5\u64cd\u4f5c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"import org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.StringRedisTemplate;\n\n@Service\npublic class RedisService {\n    \n    @Autowired\n    private StringRedisTemplate stringRedisTemplate;\n    \n    @Autowired\n    private RedisTemplate<String, Object> redisTemplate;\n    \n    // \u5b57\u7b26\u4e32\u64cd\u4f5c\n    public void setString(String key, String value) {\n        stringRedisTemplate.opsForValue().set(key, value);\n    }\n    \n    public String getString(String key) {\n        return stringRedisTemplate.opsForValue().get(key);\n    }\n    \n    // \u5bf9\u8c61\u64cd\u4f5c\n    public void setUser(String key, User user) {\n        redisTemplate.opsForValue().set(key, user);\n    }\n    \n    public User getUser(String key) {\n        return (User) redisTemplate.opsForValue().get(key);\n    }\n    \n    // \u5217\u8868\u64cd\u4f5c\n    public void pushList(String key, String value) {\n        redisTemplate.opsForList().rightPush(key, value);\n    }\n    \n    public List<Object> getList(String key) {\n        return redisTemplate.opsForList().range(key, 0, -1);\n    }\n    \n    // \u96c6\u5408\u64cd\u4f5c\n    public void addSet(String key, String value) {\n        redisTemplate.opsForSet().add(key, value);\n    }\n    \n    public Set<Object> getSet(String key) {\n        return redisTemplate.opsForSet().members(key);\n    }\n    \n    // Hash \u64cd\u4f5c\n    public void setHash(String key, String field, String value) {\n        redisTemplate.opsForHash().put(key, field, value);\n    }\n    \n    public Object getHash(String key, String field) {\n        return redisTemplate.opsForHash().get(key, field);\n    }\n    \n    // \u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\n    public void setWithExpire(String key, String value, long timeout, TimeUnit unit) {\n        stringRedisTemplate.opsForValue().set(key, value, timeout, unit);\n    }\n    \n    // \u5220\u9664\n    public void delete(String key) {\n        redisTemplate.delete(key);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"caffeine-\u7f13\u5b58",children:"Caffeine \u7f13\u5b58"}),"\n",(0,s.jsx)(n.h3,{id:"\u4f9d\u8d56\u914d\u7f6e-1",children:"\u4f9d\u8d56\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>com.github.ben-manes.caffeine</groupId>\n    <artifactId>caffeine</artifactId>\n</dependency>\n\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-cache</artifactId>\n</dependency>\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u914d\u7f6e-caffeine",children:"\u914d\u7f6e Caffeine"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cache:\n    type: caffeine\n    caffeine:\n      spec: maximumSize=500,expireAfterWrite=10m\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-caffeine",children:"\u4f7f\u7528 Caffeine"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'import com.github.benmanes.caffeine.cache.Caffeine;\nimport org.springframework.cache.CacheManager;\nimport org.springframework.cache.caffeine.CaffeineCacheManager;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport java.util.concurrent.TimeUnit;\n\n@Configuration\npublic class CaffeineConfig {\n    \n    @Bean\n    public CacheManager cacheManager() {\n        CaffeineCacheManager cacheManager = new CaffeineCacheManager("users", "posts");\n        cacheManager.setCaffeine(Caffeine.newBuilder()\n                .maximumSize(1000)                           // \u6700\u5927\u7f13\u5b58\u6570\n                .expireAfterWrite(10, TimeUnit.MINUTES)      // \u5199\u5165\u540e10\u5206\u949f\u8fc7\u671f\n                .recordStats());                             // \u8bb0\u5f55\u7edf\u8ba1\u4fe1\u606f\n        return cacheManager;\n    }\n}\n\n@Service\npublic class UserService {\n    \n    @Cacheable(value = "users", key = "#id")\n    public User getUser(Long id) {\n        return userRepository.findById(id).orElse(null);\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u7f13\u5b58\u66f4\u65b0\u7b56\u7565",children:"\u7f13\u5b58\u66f4\u65b0\u7b56\u7565"}),"\n",(0,s.jsx)(n.h3,{id:"\u65c1\u8def\u7f13\u5b58cache-aside",children:"\u65c1\u8def\u7f13\u5b58\uff08Cache Aside\uff09"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Service\npublic class UserService {\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    @Autowired\n    private StringRedisTemplate redisTemplate;\n    \n    public User getUser(Long id) {\n        String key = "user:" + id;\n        \n        // 1. \u67e5\u8be2\u7f13\u5b58\n        User user = (User) redisTemplate.opsForValue().get(key);\n        \n        // 2. \u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u67e5\u8be2\u6570\u636e\u5e93\n        if (user == null) {\n            user = userRepository.findById(id).orElse(null);\n            \n            // 3. \u5199\u5165\u7f13\u5b58\n            if (user != null) {\n                redisTemplate.opsForValue().set(key, user, 10, TimeUnit.MINUTES);\n            }\n        }\n        \n        return user;\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u5199\u7a7fwrite-through",children:"\u5199\u7a7f\uff08Write Through\uff09"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Service\npublic class UserService {\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    @Autowired\n    private RedisTemplate<String, Object> redisTemplate;\n    \n    public User updateUser(Long id, User userDetails) {\n        // 1. \u66f4\u65b0\u6570\u636e\u5e93\n        User user = userRepository.findById(id).orElseThrow();\n        user.setName(userDetails.getName());\n        user.setEmail(userDetails.getEmail());\n        User savedUser = userRepository.save(user);\n        \n        // 2. \u66f4\u65b0\u7f13\u5b58\n        String key = "user:" + id;\n        redisTemplate.opsForValue().set(key, savedUser, 10, TimeUnit.MINUTES);\n        \n        return savedUser;\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u5199\u56dewrite-behind",children:"\u5199\u56de\uff08Write Behind\uff09"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Service\npublic class UserService {\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    @Autowired\n    private RedisTemplate<String, Object> redisTemplate;\n    \n    public User updateUser(Long id, User userDetails) {\n        // 1. \u76f4\u63a5\u66f4\u65b0\u7f13\u5b58\n        String key = "user:" + id;\n        User user = new User(id, userDetails.getName(), userDetails.getEmail());\n        redisTemplate.opsForValue().set(key, user, 10, TimeUnit.MINUTES);\n        \n        // 2. \u5f02\u6b65\u66f4\u65b0\u6570\u636e\u5e93\n        updateDatabaseAsync(id, user);\n        \n        return user;\n    }\n    \n    @Async\n    public void updateDatabaseAsync(Long id, User user) {\n        try {\n            Thread.sleep(1000);  // \u6a21\u62df\u5f02\u6b65\u5ef6\u8fdf\n            userRepository.save(user);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u7f13\u5b58\u7a7f\u900f\u548c\u96ea\u5d29",children:"\u7f13\u5b58\u7a7f\u900f\u548c\u96ea\u5d29"}),"\n",(0,s.jsx)(n.h3,{id:"\u7f13\u5b58\u7a7f\u900f\u89e3\u51b3\u65b9\u6848",children:"\u7f13\u5b58\u7a7f\u900f\u89e3\u51b3\u65b9\u6848"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Service\npublic class UserService {\n    \n    private static final String CACHE_NULL_VALUE = "null";\n    \n    @Autowired\n    private RedisTemplate<String, Object> redisTemplate;\n    \n    public User getUser(Long id) {\n        String key = "user:" + id;\n        \n        Object cached = redisTemplate.opsForValue().get(key);\n        \n        // \u7f13\u5b58\u4e2d\u5b58\u5728\u503c\uff08\u5305\u62ec null\uff09\n        if (cached != null) {\n            return CACHE_NULL_VALUE.equals(cached) ? null : (User) cached;\n        }\n        \n        User user = userRepository.findById(id).orElse(null);\n        \n        // \u7f13\u5b58 null \u503c\uff0c\u9632\u6b62\u7a7f\u900f\n        Object valueToCache = user != null ? user : CACHE_NULL_VALUE;\n        redisTemplate.opsForValue().set(key, valueToCache, 5, TimeUnit.MINUTES);\n        \n        return user;\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u7f13\u5b58\u96ea\u5d29\u89e3\u51b3\u65b9\u6848",children:"\u7f13\u5b58\u96ea\u5d29\u89e3\u51b3\u65b9\u6848"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Service\npublic class UserService {\n    \n    public User getUser(Long id) {\n        String key = "user:" + id;\n        \n        User user = (User) redisTemplate.opsForValue().get(key);\n        \n        if (user == null) {\n            user = userRepository.findById(id).orElse(null);\n            \n            if (user != null) {\n                // \u968f\u673a\u8fc7\u671f\u65f6\u95f4\uff0c\u907f\u514d\u5927\u91cf\u7f13\u5b58\u540c\u65f6\u8fc7\u671f\n                long timeout = 10 + new Random().nextInt(5);  // 10-15 \u5206\u949f\n                redisTemplate.opsForValue().set(key, user, timeout, TimeUnit.MINUTES);\n            }\n        }\n        \n        return user;\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,s.jsx)(n.p,{children:"\u7f13\u5b58\u7684\u5173\u952e\u70b9\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u9009\u62e9\u5408\u9002\u7684\u7f13\u5b58"})," - \u672c\u5730\u7f13\u5b58\uff08Caffeine\uff09\u6216\u5206\u5e03\u5f0f\u7f13\u5b58\uff08Redis\uff09"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5408\u7406\u8bbe\u7f6e TTL"})," - \u907f\u514d\u7f13\u5b58\u8fc7\u671f\u592a\u5feb\u6216\u592a\u6162"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u66f4\u65b0\u7b56\u7565"})," - \u65c1\u8def\u3001\u5199\u7a7f\u3001\u5199\u56de\u7b49\uff0c\u6839\u636e\u573a\u666f\u9009\u62e9"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5904\u7406\u8fb9\u754c\u60c5\u51b5"})," - \u7f13\u5b58\u7a7f\u900f\u3001\u96ea\u5d29\u3001\u51fb\u7a7f"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u76d1\u63a7\u6307\u6807"})," - \u7f13\u5b58\u547d\u4e2d\u7387\u3001\u5927\u5c0f\u7b49"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4e0b\u4e00\u6b65\u5b66\u4e60 ",(0,s.jsx)(n.a,{href:"/docs/springboot/scheduling",children:"\u5b9a\u65f6\u4efb\u52a1\u548c\u5f02\u6b65"}),"\u3002"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},48885:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>l});var i=r(99378);const s={},a=i.createContext(s);function t(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);
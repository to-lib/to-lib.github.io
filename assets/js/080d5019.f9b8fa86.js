"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[7798],{48885:(e,n,l)=>{l.d(n,{R:()=>o,x:()=>t});var r=l(99378);const i={},s=r.createContext(i);function o(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:n},e.children)}},75135:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"docker/plugins","title":"Docker Plugins","description":"\u7f51\u7edc\u3001\u5b58\u50a8\u4e0e\u6388\u6743\u63d2\u4ef6\u7684\u4f7f\u7528\u4e0e\u5f00\u53d1","source":"@site/docs/docker/plugins.md","sourceDirName":"docker","slug":"/docker/plugins","permalink":"/docs/docker/plugins","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/docker/plugins.md","tags":[],"version":"current","sidebarPosition":27,"frontMatter":{"sidebar_position":27,"title":"Docker Plugins","description":"\u7f51\u7edc\u3001\u5b58\u50a8\u4e0e\u6388\u6743\u63d2\u4ef6\u7684\u4f7f\u7528\u4e0e\u5f00\u53d1"}}');var i=l(22714),s=l(48885);const o={sidebar_position:27,title:"Docker Plugins",description:"\u7f51\u7edc\u3001\u5b58\u50a8\u4e0e\u6388\u6743\u63d2\u4ef6\u7684\u4f7f\u7528\u4e0e\u5f00\u53d1"},t="Docker Plugins",d={},c=[{value:"\u63d2\u4ef6\u7c7b\u578b",id:"\u63d2\u4ef6\u7c7b\u578b",level:2},{value:"\u63d2\u4ef6\u7ba1\u7406",id:"\u63d2\u4ef6\u7ba1\u7406",level:2},{value:"\u57fa\u672c\u547d\u4ee4",id:"\u57fa\u672c\u547d\u4ee4",level:3},{value:"\u5b89\u88c5\u65f6\u914d\u7f6e",id:"\u5b89\u88c5\u65f6\u914d\u7f6e",level:3},{value:"\u5b58\u50a8\u63d2\u4ef6",id:"\u5b58\u50a8\u63d2\u4ef6",level:2},{value:"SSHFS \u63d2\u4ef6",id:"sshfs-\u63d2\u4ef6",level:3},{value:"NFS \u63d2\u4ef6",id:"nfs-\u63d2\u4ef6",level:3},{value:"REX-Ray \u63d2\u4ef6",id:"rex-ray-\u63d2\u4ef6",level:3},{value:"\u7f51\u7edc\u63d2\u4ef6",id:"\u7f51\u7edc\u63d2\u4ef6",level:2},{value:"Weave Net",id:"weave-net",level:3},{value:"Calico",id:"calico",level:3},{value:"\u6388\u6743\u63d2\u4ef6",id:"\u6388\u6743\u63d2\u4ef6",level:2},{value:"OPA (Open Policy Agent)",id:"opa-open-policy-agent",level:3},{value:"\u5f00\u53d1\u81ea\u5b9a\u4e49\u63d2\u4ef6",id:"\u5f00\u53d1\u81ea\u5b9a\u4e49\u63d2\u4ef6",level:2},{value:"\u63d2\u4ef6\u7ed3\u6784",id:"\u63d2\u4ef6\u7ed3\u6784",level:3},{value:"config.json \u793a\u4f8b",id:"configjson-\u793a\u4f8b",level:3},{value:"Volume \u63d2\u4ef6\u63a5\u53e3",id:"volume-\u63d2\u4ef6\u63a5\u53e3",level:3},{value:"\u6784\u5efa\u548c\u5b89\u88c5\u63d2\u4ef6",id:"\u6784\u5efa\u548c\u5b89\u88c5\u63d2\u4ef6",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"docker-plugins",children:"Docker Plugins"})}),"\n",(0,i.jsx)(n.p,{children:"Docker \u63d2\u4ef6\u7cfb\u7edf\u5141\u8bb8\u6269\u5c55 Docker \u7684\u7f51\u7edc\u3001\u5b58\u50a8\u548c\u6388\u6743\u529f\u80fd\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u63d2\u4ef6\u7c7b\u578b",children:"\u63d2\u4ef6\u7c7b\u578b"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,i.jsx)(n.th,{children:"\u8bf4\u660e"}),(0,i.jsx)(n.th,{children:"\u793a\u4f8b"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Volume"})}),(0,i.jsx)(n.td,{children:"\u5b58\u50a8\u9a71\u52a8\u63d2\u4ef6"}),(0,i.jsx)(n.td,{children:"NFS\u3001GlusterFS\u3001Ceph"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Network"})}),(0,i.jsx)(n.td,{children:"\u7f51\u7edc\u9a71\u52a8\u63d2\u4ef6"}),(0,i.jsx)(n.td,{children:"Weave\u3001Calico"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Authorization"})}),(0,i.jsx)(n.td,{children:"\u6388\u6743\u63d2\u4ef6"}),(0,i.jsx)(n.td,{children:"OPA\u3001Casbin"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Log"})}),(0,i.jsx)(n.td,{children:"\u65e5\u5fd7\u9a71\u52a8\u63d2\u4ef6"}),(0,i.jsx)(n.td,{children:"Splunk\u3001Datadog"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"\u63d2\u4ef6\u7ba1\u7406",children:"\u63d2\u4ef6\u7ba1\u7406"}),"\n",(0,i.jsx)(n.h3,{id:"\u57fa\u672c\u547d\u4ee4",children:"\u57fa\u672c\u547d\u4ee4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u641c\u7d22\u63d2\u4ef6\ndocker plugin search volume\n\n# \u5b89\u88c5\u63d2\u4ef6\ndocker plugin install vieux/sshfs\n\n# \u5217\u51fa\u5df2\u5b89\u88c5\u63d2\u4ef6\ndocker plugin ls\n\n# \u67e5\u770b\u63d2\u4ef6\u8be6\u60c5\ndocker plugin inspect vieux/sshfs\n\n# \u542f\u7528/\u7981\u7528\u63d2\u4ef6\ndocker plugin enable vieux/sshfs\ndocker plugin disable vieux/sshfs\n\n# \u5220\u9664\u63d2\u4ef6\ndocker plugin rm vieux/sshfs\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5b89\u88c5\u65f6\u914d\u7f6e",children:"\u5b89\u88c5\u65f6\u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u6388\u4e88\u6743\u9650\ndocker plugin install vieux/sshfs --grant-all-permissions\n\n# \u8bbe\u7f6e\u914d\u7f6e\u9879\ndocker plugin install vieux/sshfs DEBUG=1\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5b58\u50a8\u63d2\u4ef6",children:"\u5b58\u50a8\u63d2\u4ef6"}),"\n",(0,i.jsx)(n.h3,{id:"sshfs-\u63d2\u4ef6",children:"SSHFS \u63d2\u4ef6"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u5b89\u88c5\ndocker plugin install vieux/sshfs\n\n# \u521b\u5efa\u5377\ndocker volume create -d vieux/sshfs \\\n  -o sshcmd=user@host:/path \\\n  -o password=secret \\\n  sshvolume\n\n# \u4f7f\u7528\u5377\ndocker run -v sshvolume:/data alpine ls /data\n"})}),"\n",(0,i.jsx)(n.h3,{id:"nfs-\u63d2\u4ef6",children:"NFS \u63d2\u4ef6"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u4f7f\u7528\u672c\u5730\u9a71\u52a8\u7684 NFS \u652f\u6301\ndocker volume create \\\n  --driver local \\\n  --opt type=nfs \\\n  --opt o=addr=192.168.1.100,rw \\\n  --opt device=:/shared \\\n  nfs-vol\n"})}),"\n",(0,i.jsx)(n.h3,{id:"rex-ray-\u63d2\u4ef6",children:"REX-Ray \u63d2\u4ef6"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u5b89\u88c5 AWS EBS \u63d2\u4ef6\ndocker plugin install rexray/ebs \\\n  EBS_ACCESSKEY=xxx \\\n  EBS_SECRETKEY=xxx\n\n# \u521b\u5efa EBS \u5377\ndocker volume create -d rexray/ebs --opt=size=100 ebs-vol\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u7f51\u7edc\u63d2\u4ef6",children:"\u7f51\u7edc\u63d2\u4ef6"}),"\n",(0,i.jsx)(n.h3,{id:"weave-net",children:"Weave Net"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u5b89\u88c5 Weave\ncurl -L git.io/weave -o /usr/local/bin/weave\nchmod +x /usr/local/bin/weave\nweave launch\n\n# \u521b\u5efa Weave \u7f51\u7edc\ndocker network create --driver weave mynet\n\n# \u8fd0\u884c\u5bb9\u5668\ndocker run --network weave -d nginx\n"})}),"\n",(0,i.jsx)(n.h3,{id:"calico",children:"Calico"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Calico \u901a\u5e38\u4e0e Kubernetes \u4e00\u8d77\u4f7f\u7528\n# \u72ec\u7acb\u4f7f\u7528\u9700\u8981 etcd\n\n# \u521b\u5efa Calico \u7f51\u7edc\ndocker network create --driver calico --ipam-driver calico-ipam calico-net\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6388\u6743\u63d2\u4ef6",children:"\u6388\u6743\u63d2\u4ef6"}),"\n",(0,i.jsx)(n.h3,{id:"opa-open-policy-agent",children:"OPA (Open Policy Agent)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# \u5b89\u88c5 OPA \u63d2\u4ef6\ndocker plugin install openpolicyagent/opa-docker-authz-v2:0.4\n\n# \u914d\u7f6e Docker daemon\n# /etc/docker/daemon.json\n{\n  "authorization-plugins": ["openpolicyagent/opa-docker-authz-v2:0.4"]\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u7b56\u7565\u793a\u4f8b\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rego",children:'# policy.rego\npackage docker.authz\n\ndefault allow = false\n\n# \u5141\u8bb8\u8bfb\u53d6\u64cd\u4f5c\nallow {\n    input.Method == "GET"\n}\n\n# \u7981\u6b62\u7279\u6743\u5bb9\u5668\nallow {\n    input.Method == "POST"\n    input.Path == "/containers/create"\n    not input.Body.HostConfig.Privileged\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5f00\u53d1\u81ea\u5b9a\u4e49\u63d2\u4ef6",children:"\u5f00\u53d1\u81ea\u5b9a\u4e49\u63d2\u4ef6"}),"\n",(0,i.jsx)(n.h3,{id:"\u63d2\u4ef6\u7ed3\u6784",children:"\u63d2\u4ef6\u7ed3\u6784"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"my-plugin/\n\u251c\u2500\u2500 config.json      # \u63d2\u4ef6\u914d\u7f6e\n\u251c\u2500\u2500 rootfs/          # \u63d2\u4ef6\u6587\u4ef6\u7cfb\u7edf\n\u2502   \u2514\u2500\u2500 plugin-binary\n\u2514\u2500\u2500 Dockerfile\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configjson-\u793a\u4f8b",children:"config.json \u793a\u4f8b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "description": "My custom volume plugin",\n  "documentation": "https://example.com/docs",\n  "entrypoint": ["/plugin-binary"],\n  "interface": {\n    "types": ["docker.volumedriver/1.0"],\n    "socket": "plugin.sock"\n  },\n  "network": {\n    "type": "host"\n  },\n  "mounts": [\n    {\n      "source": "/var/lib/docker/plugins/",\n      "destination": "/mnt/state",\n      "type": "bind"\n    }\n  ],\n  "env": [\n    {\n      "name": "DEBUG",\n      "description": "Enable debug logging",\n      "value": "0"\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"volume-\u63d2\u4ef6\u63a5\u53e3",children:"Volume \u63d2\u4ef6\u63a5\u53e3"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// Go \u5b9e\u73b0\u793a\u4f8b\npackage main\n\nimport (\n    "github.com/docker/go-plugins-helpers/volume"\n)\n\ntype MyDriver struct {\n    volumes map[string]string\n}\n\nfunc (d *MyDriver) Create(req *volume.CreateRequest) error {\n    d.volumes[req.Name] = "/data/" + req.Name\n    return nil\n}\n\nfunc (d *MyDriver) Remove(req *volume.RemoveRequest) error {\n    delete(d.volumes, req.Name)\n    return nil\n}\n\nfunc (d *MyDriver) Mount(req *volume.MountRequest) (*volume.MountResponse, error) {\n    return &volume.MountResponse{Mountpoint: d.volumes[req.Name]}, nil\n}\n\nfunc (d *MyDriver) Unmount(req *volume.UnmountRequest) error {\n    return nil\n}\n\nfunc (d *MyDriver) Path(req *volume.PathRequest) (*volume.PathResponse, error) {\n    return &volume.PathResponse{Mountpoint: d.volumes[req.Name]}, nil\n}\n\nfunc (d *MyDriver) Get(req *volume.GetRequest) (*volume.GetResponse, error) {\n    return &volume.GetResponse{Volume: &volume.Volume{Name: req.Name}}, nil\n}\n\nfunc (d *MyDriver) List() (*volume.ListResponse, error) {\n    var vols []*volume.Volume\n    for name := range d.volumes {\n        vols = append(vols, &volume.Volume{Name: name})\n    }\n    return &volume.ListResponse{Volumes: vols}, nil\n}\n\nfunc (d *MyDriver) Capabilities() *volume.CapabilitiesResponse {\n    return &volume.CapabilitiesResponse{Capabilities: volume.Capability{Scope: "local"}}\n}\n\nfunc main() {\n    driver := &MyDriver{volumes: make(map[string]string)}\n    handler := volume.NewHandler(driver)\n    handler.ServeUnix("my-plugin", 0)\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u6784\u5efa\u548c\u5b89\u88c5\u63d2\u4ef6",children:"\u6784\u5efa\u548c\u5b89\u88c5\u63d2\u4ef6"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u6784\u5efa\u63d2\u4ef6\ndocker build -t my-plugin .\n\n# \u521b\u5efa\u63d2\u4ef6\ndocker plugin create my-plugin ./my-plugin\n\n# \u542f\u7528\u63d2\u4ef6\ndocker plugin enable my-plugin\n\n# \u6d4b\u8bd5\ndocker volume create -d my-plugin test-vol\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);
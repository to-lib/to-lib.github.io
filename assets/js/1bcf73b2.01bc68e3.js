"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[76155],{48885:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var l=s(99378);const r={},i=l.createContext(r);function t(e){const n=l.useContext(i);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),l.createElement(i.Provider,{value:n},e.children)}},88490:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"nginx/ssl-tls","title":"SSL/TLS \u914d\u7f6e","description":"Nginx HTTPS \u914d\u7f6e\u4e0e SSL \u8bc1\u4e66\u7ba1\u7406","source":"@site/docs/nginx/ssl-tls.md","sourceDirName":"nginx","slug":"/nginx/ssl-tls","permalink":"/docs/nginx/ssl-tls","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/nginx/ssl-tls.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"SSL/TLS \u914d\u7f6e","description":"Nginx HTTPS \u914d\u7f6e\u4e0e SSL \u8bc1\u4e66\u7ba1\u7406"},"sidebar":"nginx","previous":{"title":"\u8d1f\u8f7d\u5747\u8861","permalink":"/docs/nginx/load-balancing"},"next":{"title":"\u65e5\u5fd7\u914d\u7f6e","permalink":"/docs/nginx/logging"}}');var r=s(22714),i=s(48885);const t={sidebar_position:7,title:"SSL/TLS \u914d\u7f6e",description:"Nginx HTTPS \u914d\u7f6e\u4e0e SSL \u8bc1\u4e66\u7ba1\u7406"},a="SSL/TLS \u914d\u7f6e",c={},d=[{value:"SSL/TLS \u6982\u8ff0",id:"ssltls-\u6982\u8ff0",level:2},{value:"TLS \u63e1\u624b\u6d41\u7a0b",id:"tls-\u63e1\u624b\u6d41\u7a0b",level:3},{value:"\u8bc1\u4e66\u7c7b\u578b",id:"\u8bc1\u4e66\u7c7b\u578b",level:3},{value:"\u57fa\u672c HTTPS \u914d\u7f6e",id:"\u57fa\u672c-https-\u914d\u7f6e",level:2},{value:"HTTP \u91cd\u5b9a\u5411\u5230 HTTPS",id:"http-\u91cd\u5b9a\u5411\u5230-https",level:2},{value:"SSL \u4f18\u5316\u914d\u7f6e",id:"ssl-\u4f18\u5316\u914d\u7f6e",level:2},{value:"\u751f\u6210 DH \u53c2\u6570",id:"\u751f\u6210-dh-\u53c2\u6570",level:3},{value:"Let&#39;s Encrypt \u8bc1\u4e66",id:"lets-encrypt-\u8bc1\u4e66",level:2},{value:"\u81ea\u52a8\u7eed\u671f\u914d\u7f6e",id:"\u81ea\u52a8\u7eed\u671f\u914d\u7f6e",level:3},{value:"\u81ea\u7b7e\u540d\u8bc1\u4e66",id:"\u81ea\u7b7e\u540d\u8bc1\u4e66",level:2},{value:"\u751f\u6210\u81ea\u7b7e\u540d\u8bc1\u4e66",id:"\u751f\u6210\u81ea\u7b7e\u540d\u8bc1\u4e66",level:3},{value:"\u5e26 SAN \u7684\u8bc1\u4e66\uff08\u591a\u57df\u540d\uff09",id:"\u5e26-san-\u7684\u8bc1\u4e66\u591a\u57df\u540d",level:3},{value:"\u53cc\u5411\u8ba4\u8bc1\uff08mTLS\uff09",id:"\u53cc\u5411\u8ba4\u8bc1mtls",level:2},{value:"\u751f\u6210\u5ba2\u6237\u7aef\u8bc1\u4e66",id:"\u751f\u6210\u5ba2\u6237\u7aef\u8bc1\u4e66",level:3},{value:"\u5b89\u5168\u54cd\u5e94\u5934",id:"\u5b89\u5168\u54cd\u5e94\u5934",level:2},{value:"SSL Labs \u8bc4\u7ea7\u4f18\u5316",id:"ssl-labs-\u8bc4\u7ea7\u4f18\u5316",level:2},{value:"\u591a\u57df\u540d SSL \u914d\u7f6e",id:"\u591a\u57df\u540d-ssl-\u914d\u7f6e",level:2},{value:"SNI\uff08Server Name Indication\uff09",id:"sniserver-name-indication",level:3},{value:"\u901a\u914d\u7b26\u8bc1\u4e66",id:"\u901a\u914d\u7b26\u8bc1\u4e66",level:3},{value:"\u8bc1\u4e66\u94fe\u9a8c\u8bc1",id:"\u8bc1\u4e66\u94fe\u9a8c\u8bc1",level:2},{value:"\u5b8c\u6574 HTTPS \u914d\u7f6e",id:"\u5b8c\u6574-https-\u914d\u7f6e",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"ssltls-\u914d\u7f6e",children:"SSL/TLS \u914d\u7f6e"})}),"\n",(0,r.jsx)(n.h2,{id:"ssltls-\u6982\u8ff0",children:"SSL/TLS \u6982\u8ff0"}),"\n",(0,r.jsx)(n.h3,{id:"tls-\u63e1\u624b\u6d41\u7a0b",children:"TLS \u63e1\u624b\u6d41\u7a0b"}),"\n",(0,r.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant C as \u5ba2\u6237\u7aef\n    participant S as \u670d\u52a1\u5668\n\n    C->>S: 1. Client Hello (\u652f\u6301\u7684\u534f\u8bae\u3001\u52a0\u5bc6\u5957\u4ef6)\n    S->>C: 2. Server Hello (\u9009\u5b9a\u534f\u8bae\u3001\u52a0\u5bc6\u5957\u4ef6)\n    S->>C: 3. \u8bc1\u4e66 + Server Key Exchange\n    S->>C: 4. Server Hello Done\n    C->>S: 5. Client Key Exchange\n    C->>S: 6. Change Cipher Spec\n    C->>S: 7. Encrypted Handshake Message\n    S->>C: 8. Change Cipher Spec\n    S->>C: 9. Encrypted Handshake Message\n    Note over C,S: \u52a0\u5bc6\u901a\u4fe1\u5f00\u59cb"}),"\n",(0,r.jsx)(n.h3,{id:"\u8bc1\u4e66\u7c7b\u578b",children:"\u8bc1\u4e66\u7c7b\u578b"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,r.jsx)(n.th,{children:"\u5168\u79f0"}),(0,r.jsx)(n.th,{children:"\u9a8c\u8bc1\u5185\u5bb9"}),(0,r.jsx)(n.th,{children:"\u9002\u7528\u573a\u666f"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"DV"})}),(0,r.jsx)(n.td,{children:"Domain Validation"}),(0,r.jsx)(n.td,{children:"\u4ec5\u9a8c\u8bc1\u57df\u540d\u6240\u6709\u6743"}),(0,r.jsx)(n.td,{children:"\u4e2a\u4eba\u535a\u5ba2"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"OV"})}),(0,r.jsx)(n.td,{children:"Organization Validation"}),(0,r.jsx)(n.td,{children:"\u9a8c\u8bc1\u57df\u540d+\u4f01\u4e1a\u4fe1\u606f"}),(0,r.jsx)(n.td,{children:"\u4f01\u4e1a\u7f51\u7ad9"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"EV"})}),(0,r.jsx)(n.td,{children:"Extended Validation"}),(0,r.jsx)(n.td,{children:"\u4e25\u683c\u9a8c\u8bc1\u4f01\u4e1a\u8eab\u4efd"}),(0,r.jsx)(n.td,{children:"\u91d1\u878d\u3001\u7535\u5546"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"\u57fa\u672c-https-\u914d\u7f6e",children:"\u57fa\u672c HTTPS \u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"server {\n    listen 443 ssl http2;\n    server_name example.com;\n\n    ssl_certificate /etc/nginx/ssl/example.com.crt;\n    ssl_certificate_key /etc/nginx/ssl/example.com.key;\n\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_prefer_server_ciphers on;\n\n    root /var/www/html;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"http-\u91cd\u5b9a\u5411\u5230-https",children:"HTTP \u91cd\u5b9a\u5411\u5230 HTTPS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"server {\n    listen 80;\n    server_name example.com www.example.com;\n    return 301 https://$host$request_uri;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ssl-\u4f18\u5316\u914d\u7f6e",children:"SSL \u4f18\u5316\u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"ssl_protocols TLSv1.2 TLSv1.3;\nssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384;\nssl_prefer_server_ciphers on;\n\n# Session \u7f13\u5b58\uff08\u6027\u80fd\u4f18\u5316\uff09\nssl_session_cache shared:SSL:10m;\nssl_session_timeout 1d;\nssl_session_tickets off;\n\n# OCSP Stapling\uff08\u52a0\u901f\u8bc1\u4e66\u9a8c\u8bc1\uff09\nssl_stapling on;\nssl_stapling_verify on;\nresolver 8.8.8.8 8.8.4.4 valid=300s;\nresolver_timeout 5s;\n\n# DH \u53c2\u6570\uff08\u53ef\u9009\uff0c\u66f4\u5b89\u5168\uff09\nssl_dhparam /etc/nginx/ssl/dhparam.pem;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u751f\u6210-dh-\u53c2\u6570",children:"\u751f\u6210 DH \u53c2\u6570"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"openssl dhparam -out /etc/nginx/ssl/dhparam.pem 2048\n"})}),"\n",(0,r.jsx)(n.h2,{id:"lets-encrypt-\u8bc1\u4e66",children:"Let's Encrypt \u8bc1\u4e66"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u5b89\u88c5 Certbot\nsudo apt install certbot python3-certbot-nginx\n\n# \u83b7\u53d6\u8bc1\u4e66\nsudo certbot --nginx -d example.com -d www.example.com\n\n# \u6d4b\u8bd5\u81ea\u52a8\u7eed\u671f\nsudo certbot renew --dry-run\n\n# \u67e5\u770b\u8bc1\u4e66\u4fe1\u606f\nsudo certbot certificates\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u81ea\u52a8\u7eed\u671f\u914d\u7f6e",children:"\u81ea\u52a8\u7eed\u671f\u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# /etc/cron.d/certbot\n0 0,12 * * * root certbot renew --quiet --post-hook "systemctl reload nginx"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u81ea\u7b7e\u540d\u8bc1\u4e66",children:"\u81ea\u7b7e\u540d\u8bc1\u4e66"}),"\n",(0,r.jsx)(n.h3,{id:"\u751f\u6210\u81ea\u7b7e\u540d\u8bc1\u4e66",children:"\u751f\u6210\u81ea\u7b7e\u540d\u8bc1\u4e66"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# \u751f\u6210\u79c1\u94a5\nopenssl genrsa -out server.key 2048\n\n# \u751f\u6210\u8bc1\u4e66\u7b7e\u540d\u8bf7\u6c42\uff08CSR\uff09\nopenssl req -new -key server.key -out server.csr \\\n    -subj "/C=CN/ST=Beijing/L=Beijing/O=Example/CN=example.com"\n\n# \u751f\u6210\u81ea\u7b7e\u540d\u8bc1\u4e66\uff08\u6709\u6548\u671f 365 \u5929\uff09\nopenssl x509 -req -days 365 -in server.csr \\\n    -signkey server.key -out server.crt\n\n# \u4e00\u6b65\u751f\u6210\uff08\u63a8\u8350\u6d4b\u8bd5\u73af\u5883\uff09\nopenssl req -x509 -nodes -days 365 -newkey rsa:2048 \\\n    -keyout server.key -out server.crt \\\n    -subj "/C=CN/ST=Beijing/L=Beijing/O=Example/CN=example.com"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u5e26-san-\u7684\u8bc1\u4e66\u591a\u57df\u540d",children:"\u5e26 SAN \u7684\u8bc1\u4e66\uff08\u591a\u57df\u540d\uff09"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u521b\u5efa\u914d\u7f6e\u6587\u4ef6 san.cnf\ncat > san.cnf << EOF\n[req]\ndistinguished_name = req_distinguished_name\nreq_extensions = v3_req\nprompt = no\n\n[req_distinguished_name]\nC = CN\nST = Beijing\nL = Beijing\nO = Example\nCN = example.com\n\n[v3_req]\nbasicConstraints = CA:FALSE\nkeyUsage = nonRepudiation, digitalSignature, keyEncipherment\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1 = example.com\nDNS.2 = www.example.com\nDNS.3 = api.example.com\nIP.1 = 192.168.1.100\nEOF\n\n# \u751f\u6210\u8bc1\u4e66\nopenssl req -x509 -nodes -days 365 -newkey rsa:2048 \\\n    -keyout server.key -out server.crt \\\n    -config san.cnf -extensions v3_req\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u53cc\u5411\u8ba4\u8bc1mtls",children:"\u53cc\u5411\u8ba4\u8bc1\uff08mTLS\uff09"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"server {\n    listen 443 ssl http2;\n    server_name secure.example.com;\n\n    # \u670d\u52a1\u5668\u8bc1\u4e66\n    ssl_certificate /etc/nginx/ssl/server.crt;\n    ssl_certificate_key /etc/nginx/ssl/server.key;\n\n    # \u5ba2\u6237\u7aef\u8bc1\u4e66\u9a8c\u8bc1\n    ssl_client_certificate /etc/nginx/ssl/ca.crt;\n    ssl_verify_client on;  # \u5f3a\u5236\u9a8c\u8bc1\n    # ssl_verify_client optional;  # \u53ef\u9009\u9a8c\u8bc1\n    ssl_verify_depth 2;\n\n    location / {\n        # \u83b7\u53d6\u5ba2\u6237\u7aef\u8bc1\u4e66\u4fe1\u606f\n        proxy_set_header X-SSL-Client-Cert $ssl_client_cert;\n        proxy_set_header X-SSL-Client-DN $ssl_client_s_dn;\n        proxy_set_header X-SSL-Client-Verify $ssl_client_verify;\n\n        proxy_pass http://backend;\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u751f\u6210\u5ba2\u6237\u7aef\u8bc1\u4e66",children:"\u751f\u6210\u5ba2\u6237\u7aef\u8bc1\u4e66"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# \u521b\u5efa CA\nopenssl genrsa -out ca.key 2048\nopenssl req -new -x509 -days 3650 -key ca.key -out ca.crt \\\n    -subj "/C=CN/ST=Beijing/O=Example CA/CN=Example CA"\n\n# \u521b\u5efa\u5ba2\u6237\u7aef\u8bc1\u4e66\nopenssl genrsa -out client.key 2048\nopenssl req -new -key client.key -out client.csr \\\n    -subj "/C=CN/ST=Beijing/O=Example/CN=client1"\nopenssl x509 -req -days 365 -in client.csr \\\n    -CA ca.crt -CAkey ca.key -CAcreateserial -out client.crt\n\n# \u5bfc\u51fa PKCS12 \u683c\u5f0f\uff08\u7528\u4e8e\u6d4f\u89c8\u5668\u5bfc\u5165\uff09\nopenssl pkcs12 -export -out client.p12 \\\n    -inkey client.key -in client.crt -certfile ca.crt\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5b89\u5168\u54cd\u5e94\u5934",children:"\u5b89\u5168\u54cd\u5e94\u5934"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"# HSTS \u5f3a\u5236 HTTPS\nadd_header Strict-Transport-Security \"max-age=31536000; includeSubDomains; preload\" always;\n\n# \u9632\u6b62\u70b9\u51fb\u52ab\u6301\nadd_header X-Frame-Options SAMEORIGIN always;\n\n# \u9632\u6b62 XSS\nadd_header X-XSS-Protection \"1; mode=block\" always;\n\n# \u9632\u6b62 MIME \u7c7b\u578b\u55c5\u63a2\nadd_header X-Content-Type-Options nosniff always;\n\n# \u5185\u5bb9\u5b89\u5168\u7b56\u7565\nadd_header Content-Security-Policy \"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';\" always;\n\n# Referrer \u7b56\u7565\nadd_header Referrer-Policy \"strict-origin-when-cross-origin\" always;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ssl-labs-\u8bc4\u7ea7\u4f18\u5316",children:"SSL Labs \u8bc4\u7ea7\u4f18\u5316"}),"\n",(0,r.jsx)(n.p,{children:"\u83b7\u5f97 A+ \u8bc4\u7ea7\u7684\u914d\u7f6e\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'server {\n    listen 443 ssl http2;\n    server_name example.com;\n\n    # \u8bc1\u4e66\n    ssl_certificate /etc/nginx/ssl/fullchain.pem;\n    ssl_certificate_key /etc/nginx/ssl/privkey.pem;\n\n    # \u534f\u8bae\u7248\u672c\uff08\u7981\u7528\u65e7\u7248\u672c\uff09\n    ssl_protocols TLSv1.2 TLSv1.3;\n\n    # \u52a0\u5bc6\u5957\u4ef6\uff08Mozilla Intermediate \u914d\u7f6e\uff09\n    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;\n    ssl_prefer_server_ciphers off;\n\n    # ECDH \u66f2\u7ebf\n    ssl_ecdh_curve X25519:prime256v1:secp384r1;\n\n    # Session\n    ssl_session_cache shared:SSL:10m;\n    ssl_session_timeout 1d;\n    ssl_session_tickets off;\n\n    # OCSP Stapling\n    ssl_stapling on;\n    ssl_stapling_verify on;\n    ssl_trusted_certificate /etc/nginx/ssl/chain.pem;\n    resolver 8.8.8.8 8.8.4.4 valid=300s;\n\n    # HSTS\uff08A+ \u5fc5\u9700\uff09\n    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;\n\n    root /var/www/html;\n    index index.html;\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u591a\u57df\u540d-ssl-\u914d\u7f6e",children:"\u591a\u57df\u540d SSL \u914d\u7f6e"}),"\n",(0,r.jsx)(n.h3,{id:"sniserver-name-indication",children:"SNI\uff08Server Name Indication\uff09"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"# \u591a\u4e2a\u865a\u62df\u4e3b\u673a\u4f7f\u7528\u4e0d\u540c\u8bc1\u4e66\nserver {\n    listen 443 ssl http2;\n    server_name site1.example.com;\n    ssl_certificate /etc/nginx/ssl/site1.crt;\n    ssl_certificate_key /etc/nginx/ssl/site1.key;\n}\n\nserver {\n    listen 443 ssl http2;\n    server_name site2.example.com;\n    ssl_certificate /etc/nginx/ssl/site2.crt;\n    ssl_certificate_key /etc/nginx/ssl/site2.key;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u901a\u914d\u7b26\u8bc1\u4e66",children:"\u901a\u914d\u7b26\u8bc1\u4e66"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:"server {\n    listen 443 ssl http2;\n    server_name *.example.com;\n    ssl_certificate /etc/nginx/ssl/wildcard.example.com.crt;\n    ssl_certificate_key /etc/nginx/ssl/wildcard.example.com.key;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u8bc1\u4e66\u94fe\u9a8c\u8bc1",children:"\u8bc1\u4e66\u94fe\u9a8c\u8bc1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u9a8c\u8bc1\u8bc1\u4e66\u94fe\u5b8c\u6574\u6027\nopenssl verify -CAfile ca.crt server.crt\n\n# \u67e5\u770b\u8bc1\u4e66\u4fe1\u606f\nopenssl x509 -in server.crt -noout -text\n\n# \u6d4b\u8bd5 SSL \u8fde\u63a5\nopenssl s_client -connect example.com:443 -servername example.com\n\n# \u67e5\u770b\u5b8c\u6574\u8bc1\u4e66\u94fe\nopenssl s_client -connect example.com:443 -showcerts\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5b8c\u6574-https-\u914d\u7f6e",children:"\u5b8c\u6574 HTTPS \u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'server {\n    listen 80;\n    server_name example.com www.example.com;\n    return 301 https://example.com$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n    server_name www.example.com;\n    return 301 https://example.com$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n    server_name example.com;\n\n    # SSL \u8bc1\u4e66\n    ssl_certificate /etc/nginx/ssl/fullchain.pem;\n    ssl_certificate_key /etc/nginx/ssl/privkey.pem;\n\n    # SSL \u4f18\u5316\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384;\n    ssl_prefer_server_ciphers off;\n\n    ssl_session_cache shared:SSL:10m;\n    ssl_session_timeout 1d;\n\n    ssl_stapling on;\n    ssl_stapling_verify on;\n\n    # \u5b89\u5168\u5934\n    add_header Strict-Transport-Security "max-age=31536000" always;\n    add_header X-Frame-Options SAMEORIGIN always;\n    add_header X-Content-Type-Options nosniff always;\n\n    root /var/www/html;\n    index index.html;\n\n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);
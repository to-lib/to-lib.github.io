"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[69022],{48885:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>a});var i=s(99378);const l={},r=i.createContext(l);function d(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),i.createElement(r.Provider,{value:n},e.children)}},60522:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>x,frontMatter:()=>d,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"postgres/indexes","title":"\u7d22\u5f15\u4f18\u5316","description":"\u7d22\u5f15\u662f\u63d0\u5347\u6570\u636e\u5e93\u67e5\u8be2\u6027\u80fd\u7684\u5173\u952e\u3002\u5408\u7406\u4f7f\u7528\u7d22\u5f15\u53ef\u4ee5\u5927\u5e45\u63d0\u5347\u67e5\u8be2\u901f\u5ea6\u3002","source":"@site/docs/postgres/indexes.md","sourceDirName":"postgres","slug":"/postgres/indexes","permalink":"/docs/postgres/indexes","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/postgres/indexes.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"\u7d22\u5f15\u4f18\u5316"},"sidebar":"postgres","previous":{"title":"SQL \u8bed\u6cd5","permalink":"/docs/postgres/sql-syntax"},"next":{"title":"\u4e8b\u52a1\u7ba1\u7406","permalink":"/docs/postgres/transactions"}}');var l=s(22714),r=s(48885);const d={sidebar_position:5,title:"\u7d22\u5f15\u4f18\u5316"},a="PostgreSQL \u7d22\u5f15\u4f18\u5316",c={},h=[{value:"\ud83d\udcd6 \u7d22\u5f15\u57fa\u7840",id:"-\u7d22\u5f15\u57fa\u7840",level:2},{value:"\u4ec0\u4e48\u662f\u7d22\u5f15\uff1f",id:"\u4ec0\u4e48\u662f\u7d22\u5f15",level:3},{value:"\u4f55\u65f6\u4f7f\u7528\u7d22\u5f15\uff1f",id:"\u4f55\u65f6\u4f7f\u7528\u7d22\u5f15",level:3},{value:"\ud83c\udfaf \u7d22\u5f15\u7c7b\u578b",id:"-\u7d22\u5f15\u7c7b\u578b",level:2},{value:"1. B-Tree \u7d22\u5f15\uff08\u9ed8\u8ba4\uff09",id:"1-b-tree-\u7d22\u5f15\u9ed8\u8ba4",level:3},{value:"2. Hash \u7d22\u5f15",id:"2-hash-\u7d22\u5f15",level:3},{value:"3. GIN \u7d22\u5f15\uff08\u5012\u6392\u7d22\u5f15\uff09",id:"3-gin-\u7d22\u5f15\u5012\u6392\u7d22\u5f15",level:3},{value:"4. GiST \u7d22\u5f15",id:"4-gist-\u7d22\u5f15",level:3},{value:"5. BRIN \u7d22\u5f15",id:"5-brin-\u7d22\u5f15",level:3},{value:"\ud83d\udd27 \u521b\u5efa\u548c\u7ba1\u7406\u7d22\u5f15",id:"-\u521b\u5efa\u548c\u7ba1\u7406\u7d22\u5f15",level:2},{value:"\u521b\u5efa\u7d22\u5f15",id:"\u521b\u5efa\u7d22\u5f15",level:3},{value:"\u5220\u9664\u7d22\u5f15",id:"\u5220\u9664\u7d22\u5f15",level:3},{value:"\u91cd\u5efa\u7d22\u5f15",id:"\u91cd\u5efa\u7d22\u5f15",level:3},{value:"\ud83d\udcca \u590d\u5408\u7d22\u5f15",id:"-\u590d\u5408\u7d22\u5f15",level:2},{value:"\u5217\u987a\u5e8f\u5f88\u91cd\u8981",id:"\u5217\u987a\u5e8f\u5f88\u91cd\u8981",level:3},{value:"\u8986\u76d6\u7d22\u5f15",id:"\u8986\u76d6\u7d22\u5f15",level:3},{value:"\ud83c\udf93 \u90e8\u5206\u7d22\u5f15",id:"-\u90e8\u5206\u7d22\u5f15",level:2},{value:"\ud83e\uddea \u8868\u8fbe\u5f0f\u7d22\u5f15",id:"-\u8868\u8fbe\u5f0f\u7d22\u5f15",level:2},{value:"\ud83d\udcc8 \u67e5\u8be2\u5206\u6790",id:"-\u67e5\u8be2\u5206\u6790",level:2},{value:"EXPLAIN - \u67e5\u770b\u67e5\u8be2\u8ba1\u5212",id:"explain---\u67e5\u770b\u67e5\u8be2\u8ba1\u5212",level:3},{value:"EXPLAIN ANALYZE - \u5b9e\u9645\u6267\u884c\u5e76\u5206\u6790",id:"explain-analyze---\u5b9e\u9645\u6267\u884c\u5e76\u5206\u6790",level:3},{value:"\u5173\u952e\u6307\u6807",id:"\u5173\u952e\u6307\u6807",level:3},{value:"\ud83d\udca1 \u4f18\u5316\u6280\u5de7",id:"-\u4f18\u5316\u6280\u5de7",level:2},{value:"1. \u907f\u514d\u7d22\u5f15\u5931\u6548",id:"1-\u907f\u514d\u7d22\u5f15\u5931\u6548",level:3},{value:"2. \u9009\u62e9\u5408\u9002\u7684\u7d22\u5f15\u7c7b\u578b",id:"2-\u9009\u62e9\u5408\u9002\u7684\u7d22\u5f15\u7c7b\u578b",level:3},{value:"3. \u76d1\u63a7\u7d22\u5f15\u4f7f\u7528\u60c5\u51b5",id:"3-\u76d1\u63a7\u7d22\u5f15\u4f7f\u7528\u60c5\u51b5",level:3},{value:"\u26a0\ufe0f \u6ce8\u610f\u4e8b\u9879",id:"\ufe0f-\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\ud83d\udcda \u76f8\u5173\u8d44\u6e90",id:"-\u76f8\u5173\u8d44\u6e90",level:2}];function E(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"postgresql-\u7d22\u5f15\u4f18\u5316",children:"PostgreSQL \u7d22\u5f15\u4f18\u5316"})}),"\n",(0,l.jsx)(n.p,{children:"\u7d22\u5f15\u662f\u63d0\u5347\u6570\u636e\u5e93\u67e5\u8be2\u6027\u80fd\u7684\u5173\u952e\u3002\u5408\u7406\u4f7f\u7528\u7d22\u5f15\u53ef\u4ee5\u5927\u5e45\u63d0\u5347\u67e5\u8be2\u901f\u5ea6\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"-\u7d22\u5f15\u57fa\u7840",children:"\ud83d\udcd6 \u7d22\u5f15\u57fa\u7840"}),"\n",(0,l.jsx)(n.h3,{id:"\u4ec0\u4e48\u662f\u7d22\u5f15",children:"\u4ec0\u4e48\u662f\u7d22\u5f15\uff1f"}),"\n",(0,l.jsx)(n.p,{children:"\u7d22\u5f15\u662f\u6570\u636e\u5e93\u8868\u4e2d\u4e00\u5217\u6216\u591a\u5217\u7684\u503c\u7684\u6392\u5e8f\u526f\u672c\uff0c\u7528\u4e8e\u5feb\u901f\u5b9a\u4f4d\u6570\u636e\u3002"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u7c7b\u6bd4"}),"\uff1a\u7d22\u5f15\u5c31\u50cf\u4e66\u7684\u76ee\u5f55\uff0c\u53ef\u4ee5\u5feb\u901f\u627e\u5230\u5185\u5bb9\uff0c\u800c\u4e0d\u7528\u7ffb\u9605\u6574\u672c\u4e66\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"\u4f55\u65f6\u4f7f\u7528\u7d22\u5f15",children:"\u4f55\u65f6\u4f7f\u7528\u7d22\u5f15\uff1f"}),"\n",(0,l.jsxs)(n.p,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"\u5e94\u8be5\u521b\u5efa\u7d22\u5f15\uff1a"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"WHERE \u5b50\u53e5\u4e2d\u9891\u7e41\u67e5\u8be2\u7684\u5217"}),"\n",(0,l.jsx)(n.li,{children:"JOIN \u6761\u4ef6\u4e2d\u7684\u5217"}),"\n",(0,l.jsx)(n.li,{children:"ORDER BY \u548c GROUP BY \u4f7f\u7528\u7684\u5217"}),"\n",(0,l.jsx)(n.li,{children:"\u5916\u952e\u5217"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u274c ",(0,l.jsx)(n.strong,{children:"\u4e0d\u5e94\u521b\u5efa\u7d22\u5f15\uff1a"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5c0f\u8868\uff08\u5168\u8868\u626b\u63cf\u66f4\u5feb\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u9891\u7e41\u66f4\u65b0\u7684\u5217"}),"\n",(0,l.jsx)(n.li,{children:"\u5305\u542b\u5927\u91cf NULL \u503c\u7684\u5217"}),"\n",(0,l.jsx)(n.li,{children:"\u8fd4\u56de\u5927\u90e8\u5206\u884c\u7684\u67e5\u8be2"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"-\u7d22\u5f15\u7c7b\u578b",children:"\ud83c\udfaf \u7d22\u5f15\u7c7b\u578b"}),"\n",(0,l.jsx)(n.h3,{id:"1-b-tree-\u7d22\u5f15\u9ed8\u8ba4",children:"1. B-Tree \u7d22\u5f15\uff08\u9ed8\u8ba4\uff09"}),"\n",(0,l.jsx)(n.p,{children:"\u6700\u5e38\u7528\u7684\u7d22\u5f15\u7c7b\u578b\uff0c\u9002\u7528\u4e8e\u5927\u591a\u6570\u573a\u666f\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u521b\u5efa B-Tree \u7d22\u5f15\nCREATE INDEX idx_users_username ON users(username);\n\n-- \u7b49\u4ef7\u4e8e\nCREATE INDEX idx_users_username ON users USING BTREE (username);\n\n-- \u9002\u7528\u573a\u666f\nSELECT * FROM users WHERE username = 'john';\nSELECT * FROM users WHERE username > 'a' AND username < 'z';\nSELECT * FROM users ORDER BY username;\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7279\u70b9\uff1a"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u652f\u6301 ",(0,l.jsx)(n.code,{children:"<, <=, =, >=, >"})," \u64cd\u4f5c\u7b26"]}),"\n",(0,l.jsxs)(n.li,{children:["\u652f\u6301 ",(0,l.jsx)(n.code,{children:"BETWEEN, IN, IS NULL"})]}),"\n",(0,l.jsx)(n.li,{children:"\u652f\u6301\u6392\u5e8f\u64cd\u4f5c"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"2-hash-\u7d22\u5f15",children:"2. Hash \u7d22\u5f15"}),"\n",(0,l.jsx)(n.p,{children:"\u9002\u7528\u4e8e\u7b49\u503c\u67e5\u8be2\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX idx_users_email ON users USING HASH (email);\n\n-- \u9002\u7528\u573a\u666f\nSELECT * FROM users WHERE email = 'john@example.com';\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7279\u70b9\uff1a"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u53ea\u652f\u6301 ",(0,l.jsx)(n.code,{children:"="})," \u64cd\u4f5c\u7b26"]}),"\n",(0,l.jsx)(n.li,{children:"\u6bd4 B-Tree \u7a0d\u5feb"}),"\n",(0,l.jsx)(n.li,{children:"\u4e0d\u652f\u6301\u6392\u5e8f"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"3-gin-\u7d22\u5f15\u5012\u6392\u7d22\u5f15",children:"3. GIN \u7d22\u5f15\uff08\u5012\u6392\u7d22\u5f15\uff09"}),"\n",(0,l.jsx)(n.p,{children:"\u9002\u7528\u4e8e\u6570\u7ec4\u3001JSON\u3001\u5168\u6587\u641c\u7d22\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- JSON \u7d22\u5f15\nCREATE INDEX idx_users_metadata ON users USING GIN (metadata);\n\n-- \u6570\u7ec4\u7d22\u5f15\nCREATE INDEX idx_posts_tags ON posts USING GIN (tags);\n\n-- \u5168\u6587\u641c\u7d22\u7d22\u5f15\nCREATE INDEX idx_articles_tsv ON articles USING GIN (tsv);\n\n-- \u67e5\u8be2\nSELECT * FROM users WHERE metadata @> '{\"city\": \"Beijing\"}';\nSELECT * FROM posts WHERE tags @> ARRAY['postgresql'];\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7279\u70b9\uff1a"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u9002\u5408\u591a\u503c\u5217\uff08\u6570\u7ec4\u3001JSON\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u5168\u6587\u641c\u7d22"}),"\n",(0,l.jsx)(n.li,{children:"\u521b\u5efa\u6162\uff0c\u67e5\u8be2\u5feb"}),"\n",(0,l.jsx)(n.li,{children:"\u5360\u7528\u7a7a\u95f4\u5927"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"4-gist-\u7d22\u5f15",children:"4. GiST \u7d22\u5f15"}),"\n",(0,l.jsx)(n.p,{children:"\u9002\u7528\u4e8e\u51e0\u4f55\u6570\u636e\u3001\u5168\u6587\u641c\u7d22\u3001\u8303\u56f4\u7c7b\u578b\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u51e0\u4f55\u7d22\u5f15\nCREATE INDEX idx_locations_coords ON locations USING GIST (coordinates);\n\n-- \u8303\u56f4\u7c7b\u578b\u7d22\u5f15\nCREATE INDEX idx_events_daterange ON events USING GIST (date_range);\n\n-- \u67e5\u8be2\nSELECT * FROM events WHERE date_range @> '2024-01-15'::DATE;\n"})}),"\n",(0,l.jsx)(n.h3,{id:"5-brin-\u7d22\u5f15",children:"5. BRIN \u7d22\u5f15"}),"\n",(0,l.jsx)(n.p,{children:"\u9002\u7528\u4e8e\u5927\u8868\u4e2d\u5177\u6709\u81ea\u7136\u987a\u5e8f\u7684\u5217\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX idx_logs_created_at ON logs USING BRIN (created_at);\n\n-- \u9002\u7528\u573a\u666f\nSELECT * FROM logs WHERE created_at > '2024-01-01';\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7279\u70b9\uff1a"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5360\u7528\u7a7a\u95f4\u6781\u5c0f"}),"\n",(0,l.jsx)(n.li,{children:"\u9002\u5408\u65f6\u5e8f\u6570\u636e"}),"\n",(0,l.jsx)(n.li,{children:"\u521b\u5efa\u548c\u7ef4\u62a4\u5feb"}),"\n",(0,l.jsx)(n.li,{children:"\u67e5\u8be2\u6027\u80fd\u4e2d\u7b49"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"-\u521b\u5efa\u548c\u7ba1\u7406\u7d22\u5f15",children:"\ud83d\udd27 \u521b\u5efa\u548c\u7ba1\u7406\u7d22\u5f15"}),"\n",(0,l.jsx)(n.h3,{id:"\u521b\u5efa\u7d22\u5f15",children:"\u521b\u5efa\u7d22\u5f15"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u5355\u5217\u7d22\u5f15\nCREATE INDEX idx_users_email ON users(email);\n\n-- \u591a\u5217\u7d22\u5f15\uff08\u590d\u5408\u7d22\u5f15\uff09\nCREATE INDEX idx_users_name_age ON users(last_name, first_name, age);\n\n-- \u552f\u4e00\u7d22\u5f15\nCREATE UNIQUE INDEX idx_users_username ON users(username);\n\n-- \u90e8\u5206\u7d22\u5f15\nCREATE INDEX idx_active_users ON users(username)\nWHERE is_active = true;\n\n-- \u8868\u8fbe\u5f0f\u7d22\u5f15\nCREATE INDEX idx_users_lower_email ON users(LOWER(email));\n\n-- \u5e76\u53d1\u521b\u5efa\u7d22\u5f15\uff08\u4e0d\u963b\u585e\u5199\u64cd\u4f5c\uff09\nCREATE INDEX CONCURRENTLY idx_users_email ON users(email);\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u5220\u9664\u7d22\u5f15",children:"\u5220\u9664\u7d22\u5f15"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"DROP INDEX idx_users_email;\n\n-- \u5e76\u53d1\u5220\u9664\nDROP INDEX CONCURRENTLY idx_users_email;\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u91cd\u5efa\u7d22\u5f15",children:"\u91cd\u5efa\u7d22\u5f15"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u91cd\u5efa\u5355\u4e2a\u7d22\u5f15\nREINDEX INDEX idx_users_email;\n\n-- \u91cd\u5efa\u8868\u7684\u6240\u6709\u7d22\u5f15\nREINDEX TABLE users;\n\n-- \u91cd\u5efa\u6570\u636e\u5e93\u7684\u6240\u6709\u7d22\u5f15\nREINDEX DATABASE myapp;\n\n-- \u5e76\u53d1\u91cd\u5efa\nREINDEX INDEX CONCURRENTLY idx_users_email;\n"})}),"\n",(0,l.jsx)(n.h2,{id:"-\u590d\u5408\u7d22\u5f15",children:"\ud83d\udcca \u590d\u5408\u7d22\u5f15"}),"\n",(0,l.jsx)(n.h3,{id:"\u5217\u987a\u5e8f\u5f88\u91cd\u8981",children:"\u5217\u987a\u5e8f\u5f88\u91cd\u8981"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u7d22\u5f15\uff1a(last_name, first_name)\nCREATE INDEX idx_users_name ON users(last_name, first_name);\n\n-- \u2705 \u53ef\u4ee5\u4f7f\u7528\u7d22\u5f15\nSELECT * FROM users WHERE last_name = 'Smith';\nSELECT * FROM users WHERE last_name = 'Smith' AND first_name = 'John';\n\n-- \u274c \u4e0d\u80fd\u4f7f\u7528\u7d22\u5f15\nSELECT * FROM users WHERE first_name = 'John';\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u539f\u5219"}),"\uff1a"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u6700\u5de6\u524d\u7f00\u539f\u5219"}),"\n",(0,l.jsx)(n.li,{children:"\u9009\u62e9\u6027\u9ad8\u7684\u5217\u653e\u524d\u9762"}),"\n",(0,l.jsx)(n.li,{children:"\u5e38\u7528\u4e8e\u7b49\u503c\u67e5\u8be2\u7684\u5217\u653e\u524d\u9762"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u8986\u76d6\u7d22\u5f15",children:"\u8986\u76d6\u7d22\u5f15"}),"\n",(0,l.jsx)(n.p,{children:"\u7d22\u5f15\u5305\u542b\u67e5\u8be2\u9700\u8981\u7684\u6240\u6709\u5217\uff0c\u65e0\u9700\u56de\u8868\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u521b\u5efa\u8986\u76d6\u7d22\u5f15\nCREATE INDEX idx_users_username_email ON users(username, email);\n\n-- \u76f4\u63a5\u4ece\u7d22\u5f15\u83b7\u53d6\u6570\u636e\nSELECT username, email FROM users WHERE username = 'john';\n"})}),"\n",(0,l.jsx)(n.h2,{id:"-\u90e8\u5206\u7d22\u5f15",children:"\ud83c\udf93 \u90e8\u5206\u7d22\u5f15"}),"\n",(0,l.jsx)(n.p,{children:"\u53ea\u5bf9\u8868\u7684\u4e00\u90e8\u5206\u521b\u5efa\u7d22\u5f15\uff0c\u8282\u7701\u7a7a\u95f4\u548c\u63d0\u5347\u6027\u80fd\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u53ea\u7d22\u5f15\u6d3b\u8dc3\u7528\u6237\nCREATE INDEX idx_active_users ON users(username)\nWHERE is_active = true;\n\n-- \u53ea\u7d22\u5f15\u6700\u8fd1\u7684\u8ba2\u5355\nCREATE INDEX idx_recent_orders ON orders(created_at)\nWHERE created_at > '2024-01-01';\n\n-- \u67e5\u8be2\u5fc5\u987b\u5305\u542b\u76f8\u540c\u6761\u4ef6\nSELECT * FROM users\nWHERE username = 'john' AND is_active = true;\n"})}),"\n",(0,l.jsx)(n.h2,{id:"-\u8868\u8fbe\u5f0f\u7d22\u5f15",children:"\ud83e\uddea \u8868\u8fbe\u5f0f\u7d22\u5f15"}),"\n",(0,l.jsx)(n.p,{children:"\u5bf9\u5217\u7684\u8868\u8fbe\u5f0f\u521b\u5efa\u7d22\u5f15\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u5927\u5c0f\u5199\u4e0d\u654f\u611f\u641c\u7d22\nCREATE INDEX idx_users_lower_email ON users(LOWER(email));\n\nSELECT * FROM users WHERE LOWER(email) = 'john@example.com';\n\n-- JSON \u5b57\u6bb5\u7d22\u5f15\nCREATE INDEX idx_users_metadata_city ON users((metadata->>'city'));\n\nSELECT * FROM users WHERE metadata->>'city' = 'Beijing';\n"})}),"\n",(0,l.jsx)(n.h2,{id:"-\u67e5\u8be2\u5206\u6790",children:"\ud83d\udcc8 \u67e5\u8be2\u5206\u6790"}),"\n",(0,l.jsx)(n.h3,{id:"explain---\u67e5\u770b\u67e5\u8be2\u8ba1\u5212",children:"EXPLAIN - \u67e5\u770b\u67e5\u8be2\u8ba1\u5212"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"EXPLAIN SELECT * FROM users WHERE username = 'john';\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8f93\u51fa\u793a\u4f8b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Seq Scan on users  (cost=0.00..35.50 rows=10 width=524)\n  Filter: (username = 'john'::text)\n"})}),"\n",(0,l.jsx)(n.h3,{id:"explain-analyze---\u5b9e\u9645\u6267\u884c\u5e76\u5206\u6790",children:"EXPLAIN ANALYZE - \u5b9e\u9645\u6267\u884c\u5e76\u5206\u6790"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"EXPLAIN ANALYZE SELECT * FROM users WHERE username = 'john';\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8f93\u51fa\u793a\u4f8b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Index Scan using idx_users_username on users  (cost=0.15..8.17 rows=1 width=524)\n  (actual time=0.025..0.026 rows=1 loops=1)\n  Index Cond: (username = 'john'::text)\nPlanning Time: 0.123 ms\nExecution Time: 0.045 ms\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u5173\u952e\u6307\u6807",children:"\u5173\u952e\u6307\u6807"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Seq Scan"}),"\uff1a\u5168\u8868\u626b\u63cf\uff08\u6162\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Index Scan"}),"\uff1a\u7d22\u5f15\u626b\u63cf\uff08\u5feb\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"cost"}),"\uff1a\u4f30\u7b97\u6210\u672c"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"rows"}),"\uff1a\u4f30\u7b97\u884c\u6570"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"actual time"}),"\uff1a\u5b9e\u9645\u6267\u884c\u65f6\u95f4"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"loops"}),"\uff1a\u6267\u884c\u6b21\u6570"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"-\u4f18\u5316\u6280\u5de7",children:"\ud83d\udca1 \u4f18\u5316\u6280\u5de7"}),"\n",(0,l.jsx)(n.h3,{id:"1-\u907f\u514d\u7d22\u5f15\u5931\u6548",children:"1. \u907f\u514d\u7d22\u5f15\u5931\u6548"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u274c \u5728\u7d22\u5f15\u5217\u4e0a\u4f7f\u7528\u51fd\u6570\nSELECT * FROM users WHERE UPPER(username) = 'JOHN';\n\n-- \u2705 \u4f7f\u7528\u8868\u8fbe\u5f0f\u7d22\u5f15\nCREATE INDEX idx_users_upper_username ON users(UPPER(username));\nSELECT * FROM users WHERE UPPER(username) = 'JOHN';\n\n-- \u274c \u4f7f\u7528 OR \u8fde\u63a5\u4e0d\u540c\u5217\nSELECT * FROM users WHERE username = 'john' OR email = 'john@example.com';\n\n-- \u2705 \u4f7f\u7528 UNION\nSELECT * FROM users WHERE username = 'john'\nUNION\nSELECT * FROM users WHERE email = 'john@example.com';\n\n-- \u274c \u4f7f\u7528 NOT IN\nSELECT * FROM users WHERE id NOT IN (1, 2, 3);\n\n-- \u2705 \u4f7f\u7528 NOT EXISTS\nSELECT * FROM users u\nWHERE NOT EXISTS (\n    SELECT 1 FROM blacklist b WHERE b.user_id = u.id\n);\n"})}),"\n",(0,l.jsx)(n.h3,{id:"2-\u9009\u62e9\u5408\u9002\u7684\u7d22\u5f15\u7c7b\u578b",children:"2. \u9009\u62e9\u5408\u9002\u7684\u7d22\u5f15\u7c7b\u578b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u7b49\u503c\u67e5\u8be2\uff1aB-Tree \u6216 Hash\nCREATE INDEX idx_users_id ON users USING BTREE (id);\n\n-- JSON \u67e5\u8be2\uff1aGIN\nCREATE INDEX idx_users_metadata ON users USING GIN (metadata);\n\n-- \u51e0\u4f55\u6570\u636e\uff1aGiST\nCREATE INDEX idx_locations_coords ON locations USING GIST (coordinates);\n\n-- \u65f6\u5e8f\u6570\u636e\uff1aBRIN\nCREATE INDEX idx_logs_created_at ON logs USING BRIN (created_at);\n"})}),"\n",(0,l.jsx)(n.h3,{id:"3-\u76d1\u63a7\u7d22\u5f15\u4f7f\u7528\u60c5\u51b5",children:"3. \u76d1\u63a7\u7d22\u5f15\u4f7f\u7528\u60c5\u51b5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u67e5\u770b\u8868\u7684\u7d22\u5f15\nSELECT\n    indexname,\n    indexdef\nFROM pg_indexes\nWHERE tablename = 'users';\n\n-- \u67e5\u770b\u7d22\u5f15\u5927\u5c0f\nSELECT\n    indexname,\n    pg_size_pretty(pg_relation_size(indexrelid)) as size\nFROM pg_stat_user_indexes\nWHERE schemaname = 'public';\n\n-- \u67e5\u770b\u672a\u4f7f\u7528\u7684\u7d22\u5f15\nSELECT\n    schemaname,\n    tablename,\n    indexname,\n    idx_scan\nFROM pg_stat_user_indexes\nWHERE idx_scan = 0\nAND indexrelname NOT LIKE 'pg_toast%';\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\ufe0f-\u6ce8\u610f\u4e8b\u9879",children:"\u26a0\ufe0f \u6ce8\u610f\u4e8b\u9879"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7d22\u5f15\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5360\u7528\u5b58\u50a8\u7a7a\u95f4"}),"\n",(0,l.jsx)(n.li,{children:"\u5f71\u54cd\u5199\u5165\u6027\u80fd"}),"\n",(0,l.jsx)(n.li,{children:"\u9700\u8981\u7ef4\u62a4\u6210\u672c"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u5b9a\u671f\u7ef4\u62a4\u7d22\u5f15"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"VACUUM ANALYZE users;  -- \u66f4\u65b0\u7edf\u8ba1\u4fe1\u606f\nREINDEX TABLE users;    -- \u91cd\u5efa\u7d22\u5f15\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u521b\u5efa\u7d22\u5f15\u65f6\u52a0\u9501"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u4f7f\u7528 CONCURRENTLY \u907f\u514d\u9501\u8868\nCREATE INDEX CONCURRENTLY idx_users_email ON users(email);\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"-\u76f8\u5173\u8d44\u6e90",children:"\ud83d\udcda \u76f8\u5173\u8d44\u6e90"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/postgres/sql-syntax",children:"SQL \u8bed\u6cd5"})," - \u5b66\u4e60 SQL \u67e5\u8be2"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/postgres/performance-optimization",children:"\u6027\u80fd\u4f18\u5316"})," - \u5168\u9762\u4f18\u5316\u6307\u5357"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/postgres/transactions",children:"\u4e8b\u52a1\u7ba1\u7406"})," - \u4e86\u89e3\u4e8b\u52a1"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u4e0b\u4e00\u8282\uff1a",(0,l.jsx)(n.a,{href:"/docs/postgres/transactions",children:"\u4e8b\u52a1\u7ba1\u7406"})]})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(E,{...e})}):E(e)}}}]);
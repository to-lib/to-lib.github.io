"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[8531],{48885:(e,n,l)=>{l.d(n,{R:()=>r,x:()=>c});var i=l(99378);const s={},d=i.createContext(s);function r(e){const n=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(d.Provider,{value:n},e.children)}},64735:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>t,frontMatter:()=>r,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"redis/performance-optimization","title":"Redis \u6027\u80fd\u4f18\u5316","description":"\u5168\u9762\u7684 Redis \u6027\u80fd\u4f18\u5316\u6307\u5357\uff0c\u6db5\u76d6\u5185\u5b58\u3001\u7f51\u7edc\u3001\u547d\u4ee4\u7b49\u591a\u4e2a\u65b9\u9762\u3002","source":"@site/docs/redis/performance-optimization.md","sourceDirName":"redis","slug":"/redis/performance-optimization","permalink":"/docs/redis/performance-optimization","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/redis/performance-optimization.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"title":"Redis \u6027\u80fd\u4f18\u5316"},"sidebar":"redis","previous":{"title":"Redis \u7f13\u5b58\u7b56\u7565","permalink":"/docs/redis/cache-strategies"},"next":{"title":"\u6700\u4f73\u5b9e\u8df5","permalink":"/docs/redis/best-practices"}}');var s=l(22714),d=l(48885);const r={sidebar_position:10,title:"Redis \u6027\u80fd\u4f18\u5316"},c="Redis \u6027\u80fd\u4f18\u5316",a={},h=[{value:"\u5185\u5b58\u4f18\u5316",id:"\u5185\u5b58\u4f18\u5316",level:2},{value:"1. \u9009\u62e9\u5408\u9002\u7684\u6570\u636e\u7ed3\u6784",id:"1-\u9009\u62e9\u5408\u9002\u7684\u6570\u636e\u7ed3\u6784",level:3},{value:"2. \u538b\u7f29\u5927\u503c",id:"2-\u538b\u7f29\u5927\u503c",level:3},{value:"3. \u63a7\u5236\u96c6\u5408\u5927\u5c0f",id:"3-\u63a7\u5236\u96c6\u5408\u5927\u5c0f",level:3},{value:"4. \u8bbe\u7f6e maxmemory",id:"4-\u8bbe\u7f6e-maxmemory",level:3},{value:"5. \u76d1\u63a7\u5185\u5b58\u4f7f\u7528",id:"5-\u76d1\u63a7\u5185\u5b58\u4f7f\u7528",level:3},{value:"6. \u6e05\u7406\u65e0\u7528\u6570\u636e",id:"6-\u6e05\u7406\u65e0\u7528\u6570\u636e",level:3},{value:"\u547d\u4ee4\u4f18\u5316",id:"\u547d\u4ee4\u4f18\u5316",level:2},{value:"1. \u907f\u514d\u4f7f\u7528\u5371\u9669\u547d\u4ee4",id:"1-\u907f\u514d\u4f7f\u7528\u5371\u9669\u547d\u4ee4",level:3},{value:"2. \u4f7f\u7528 Pipeline",id:"2-\u4f7f\u7528-pipeline",level:3},{value:"3. \u6279\u91cf\u64cd\u4f5c",id:"3-\u6279\u91cf\u64cd\u4f5c",level:3},{value:"4. \u907f\u514d\u5927\u952e",id:"4-\u907f\u514d\u5927\u952e",level:3},{value:"5. \u4f7f\u7528 Lua \u811a\u672c",id:"5-\u4f7f\u7528-lua-\u811a\u672c",level:3},{value:"\u7f51\u7edc\u4f18\u5316",id:"\u7f51\u7edc\u4f18\u5316",level:2},{value:"1. \u4f7f\u7528\u8fde\u63a5\u6c60",id:"1-\u4f7f\u7528\u8fde\u63a5\u6c60",level:3},{value:"2. \u7981\u7528 TCP_NODELAY",id:"2-\u7981\u7528-tcp_nodelay",level:3},{value:"3. \u8c03\u6574\u8d85\u65f6\u65f6\u95f4",id:"3-\u8c03\u6574\u8d85\u65f6\u65f6\u95f4",level:3},{value:"4. \u538b\u7f29\u6570\u636e",id:"4-\u538b\u7f29\u6570\u636e",level:3},{value:"\u6301\u4e45\u5316\u4f18\u5316",id:"\u6301\u4e45\u5316\u4f18\u5316",level:2},{value:"1. \u9009\u62e9\u5408\u9002\u7684\u6301\u4e45\u5316\u65b9\u5f0f",id:"1-\u9009\u62e9\u5408\u9002\u7684\u6301\u4e45\u5316\u65b9\u5f0f",level:3},{value:"2. fork \u4f18\u5316",id:"2-fork-\u4f18\u5316",level:3},{value:"3. AOF \u91cd\u5199\u4f18\u5316",id:"3-aof-\u91cd\u5199\u4f18\u5316",level:3},{value:"\u6162\u67e5\u8be2\u5206\u6790",id:"\u6162\u67e5\u8be2\u5206\u6790",level:2},{value:"1. \u914d\u7f6e\u6162\u67e5\u8be2",id:"1-\u914d\u7f6e\u6162\u67e5\u8be2",level:3},{value:"2. \u67e5\u770b\u6162\u67e5\u8be2",id:"2-\u67e5\u770b\u6162\u67e5\u8be2",level:3},{value:"3. \u5206\u6790\u6162\u67e5\u8be2",id:"3-\u5206\u6790\u6162\u67e5\u8be2",level:3},{value:"\u76d1\u63a7\u548c\u8bca\u65ad",id:"\u76d1\u63a7\u548c\u8bca\u65ad",level:2},{value:"1. INFO \u547d\u4ee4",id:"1-info-\u547d\u4ee4",level:3},{value:"2. \u76d1\u63a7\u5173\u952e\u6307\u6807",id:"2-\u76d1\u63a7\u5173\u952e\u6307\u6807",level:3},{value:"3. \u4f7f\u7528 MONITOR",id:"3-\u4f7f\u7528-monitor",level:3},{value:"4. redis-cli \u5de5\u5177",id:"4-redis-cli-\u5de5\u5177",level:3},{value:"\u9ad8\u53ef\u7528\u4f18\u5316",id:"\u9ad8\u53ef\u7528\u4f18\u5316",level:2},{value:"1. \u4e3b\u4ece\u590d\u5236\u4f18\u5316",id:"1-\u4e3b\u4ece\u590d\u5236\u4f18\u5316",level:3},{value:"2. \u54e8\u5175\u4f18\u5316",id:"2-\u54e8\u5175\u4f18\u5316",level:3},{value:"3. \u96c6\u7fa4\u4f18\u5316",id:"3-\u96c6\u7fa4\u4f18\u5316",level:3},{value:"\u914d\u7f6e\u4f18\u5316",id:"\u914d\u7f6e\u4f18\u5316",level:2},{value:"1. \u5185\u5b58\u914d\u7f6e",id:"1-\u5185\u5b58\u914d\u7f6e",level:3},{value:"2. \u7ebf\u7a0b\u914d\u7f6e",id:"2-\u7ebf\u7a0b\u914d\u7f6e",level:3},{value:"3. \u7cfb\u7edf\u914d\u7f6e",id:"3-\u7cfb\u7edf\u914d\u7f6e",level:3},{value:"\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3",id:"\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3",level:2},{value:"1. \u5185\u5b58\u4f18\u5316",id:"1-\u5185\u5b58\u4f18\u5316",level:3},{value:"2. \u547d\u4ee4\u4f18\u5316",id:"2-\u547d\u4ee4\u4f18\u5316",level:3},{value:"3. \u7f51\u7edc\u4f18\u5316",id:"3-\u7f51\u7edc\u4f18\u5316",level:3},{value:"4. \u6301\u4e45\u5316\u4f18\u5316",id:"4-\u6301\u4e45\u5316\u4f18\u5316",level:3},{value:"5. \u76d1\u63a7",id:"5-\u76d1\u63a7",level:3},{value:"\u6027\u80fd\u6d4b\u8bd5",id:"\u6027\u80fd\u6d4b\u8bd5",level:2},{value:"\u4f7f\u7528 redis-benchmark",id:"\u4f7f\u7528-redis-benchmark",level:3},{value:"\u89e3\u8bfb\u6d4b\u8bd5\u7ed3\u679c",id:"\u89e3\u8bfb\u6d4b\u8bd5\u7ed3\u679c",level:3},{value:"\u5c0f\u7ed3",id:"\u5c0f\u7ed3",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"redis-\u6027\u80fd\u4f18\u5316",children:"Redis \u6027\u80fd\u4f18\u5316"})}),"\n",(0,s.jsx)(n.p,{children:"\u5168\u9762\u7684 Redis \u6027\u80fd\u4f18\u5316\u6307\u5357\uff0c\u6db5\u76d6\u5185\u5b58\u3001\u7f51\u7edc\u3001\u547d\u4ee4\u7b49\u591a\u4e2a\u65b9\u9762\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u5185\u5b58\u4f18\u5316",children:"\u5185\u5b58\u4f18\u5316"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u9009\u62e9\u5408\u9002\u7684\u6570\u636e\u7ed3\u6784",children:"1. \u9009\u62e9\u5408\u9002\u7684\u6570\u636e\u7ed3\u6784"}),"\n",(0,s.jsx)(n.p,{children:"\u4e0d\u540c\u6570\u636e\u7ed3\u6784\u7684\u5185\u5b58\u5360\u7528\u5dee\u5f02\u5f88\u5927\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u274c \u4f7f\u7528 String \u5b58\u50a8\u5bf9\u8c61\uff08\u5360\u7528\u5185\u5b58\u5927\uff09\nSET user:1001 \'{"name":"\u5f20\u4e09","age":25,"city":"\u5317\u4eac"}\'\n\n# \u2705 \u4f7f\u7528 Hash \u5b58\u50a8\u5bf9\u8c61\uff08\u5360\u7528\u5185\u5b58\u5c0f\uff09\nHMSET user:1001 name "\u5f20\u4e09" age 25 city "\u5317\u4eac"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u538b\u7f29\u5927\u503c",children:"2. \u538b\u7f29\u5927\u503c"}),"\n",(0,s.jsx)(n.p,{children:"\u5bf9\u4e8e\u5927\u503c\uff0c\u4f7f\u7528\u538b\u7f29\u7b97\u6cd5\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u538b\u7f29\u540e\u5b58\u50a8\nString data = largeData;\nbyte[] compressed = compress(data);  // GZIP\u3001LZ4 \u7b49\nredis.set("key", compressed);\n\n// \u8bfb\u53d6\u65f6\u89e3\u538b\nbyte[] compressed = redis.get("key");\nString data = decompress(compressed);\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u63a7\u5236\u96c6\u5408\u5927\u5c0f",children:"3. \u63a7\u5236\u96c6\u5408\u5927\u5c0f"}),"\n",(0,s.jsx)(n.p,{children:"\u907f\u514d\u5355\u4e2a\u952e\u5305\u542b\u8fc7\u591a\u5143\u7d20\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u274c \u5355\u4e2a Hash \u5305\u542b 100 \u4e07\u6761\u6570\u636e\nHSET big_hash field1 value1\nHSET big_hash field2 value2\n# ... 100 \u4e07\u6b21\n\n# \u2705 \u5206\u7247\u5b58\u50a8\n# hash_0: 0-9999\n# hash_1: 10000-19999\nHSET user:hash:0 1001 "data"\nHSET user:hash:1 10001 "data"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-\u8bbe\u7f6e-maxmemory",children:"4. \u8bbe\u7f6e maxmemory"}),"\n",(0,s.jsx)(n.p,{children:"\u9650\u5236 Redis \u4f7f\u7528\u7684\u6700\u5927\u5185\u5b58\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"# \u6700\u5927\u5185\u5b58 2GB\nmaxmemory 2gb\n\n# \u5185\u5b58\u6dd8\u6c70\u7b56\u7565\nmaxmemory-policy allkeys-lru\n"})}),"\n",(0,s.jsx)(n.h3,{id:"5-\u76d1\u63a7\u5185\u5b58\u4f7f\u7528",children:"5. \u76d1\u63a7\u5185\u5b58\u4f7f\u7528"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\nINFO memory\n\n# \u5173\u952e\u6307\u6807\n# used_memory: \u5df2\u4f7f\u7528\u5185\u5b58\n# used_memory_rss: \u64cd\u4f5c\u7cfb\u7edf\u5206\u914d\u7684\u5185\u5b58\n# mem_fragmentation_ratio: \u5185\u5b58\u788e\u7247\u7387\n"})}),"\n",(0,s.jsx)(n.h3,{id:"6-\u6e05\u7406\u65e0\u7528\u6570\u636e",children:"6. \u6e05\u7406\u65e0\u7528\u6570\u636e"}),"\n",(0,s.jsx)(n.p,{children:"\u5b9a\u671f\u6e05\u7406\u8fc7\u671f\u548c\u65e0\u7528\u7684\u6570\u636e\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u627e\u5e76\u5220\u9664\u7a7a\u503c\nSCAN 0 MATCH * COUNT 100\n\n# \u8bbe\u7f6e\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\nEXPIRE key 3600\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u547d\u4ee4\u4f18\u5316",children:"\u547d\u4ee4\u4f18\u5316"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u907f\u514d\u4f7f\u7528\u5371\u9669\u547d\u4ee4",children:"1. \u907f\u514d\u4f7f\u7528\u5371\u9669\u547d\u4ee4"}),"\n",(0,s.jsx)(n.p,{children:"\u67d0\u4e9b\u547d\u4ee4\u4f1a\u963b\u585e Redis\uff0c\u5f71\u54cd\u6027\u80fd\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u274c \u614e\u7528\u547d\u4ee4\uff08\u751f\u4ea7\u73af\u5883\u7981\u7528\uff09\nKEYS *           # \u904d\u5386\u6240\u6709\u952e\uff0c\u963b\u585e\nFLUSHALL         # \u6e05\u7a7a\u6240\u6709\u6570\u636e\nFLUSHDB          # \u6e05\u7a7a\u5f53\u524d\u6570\u636e\u5e93\nSORT large_list  # \u6392\u5e8f\u5927\u5217\u8868\n\n# \u2705 \u66ff\u4ee3\u65b9\u6848\nSCAN 0 MATCH pattern COUNT 100  # \u4ee3\u66ff KEYS\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u4f7f\u7528-pipeline",children:"2. \u4f7f\u7528 Pipeline"}),"\n",(0,s.jsx)(n.p,{children:"\u51cf\u5c11\u7f51\u7edc\u5f80\u8fd4\u6b21\u6570\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u274c \u9010\u4e2a\u6267\u884c\uff081000 \u6b21\u7f51\u7edc\u5f80\u8fd4\uff09\nfor (int i = 0; i < 1000; i++) {\n    jedis.set("key" + i, "value" + i);\n}\n\n// \u2705 \u4f7f\u7528 Pipeline\uff081 \u6b21\u7f51\u7edc\u5f80\u8fd4\uff09\nPipeline pipeline = jedis.pipelined();\nfor (int i = 0; i < 1000; i++) {\n    pipeline.set("key" + i, "value" + i);\n}\npipeline.sync();\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u6279\u91cf\u64cd\u4f5c",children:"3. \u6279\u91cf\u64cd\u4f5c"}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528\u6279\u91cf\u547d\u4ee4\u4ee3\u66ff\u591a\u6b21\u5355\u4e2a\u64cd\u4f5c\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u274c \u591a\u6b21 GET\nGET key1\nGET key2\nGET key3\n\n# \u2705 \u4f7f\u7528 MGET\nMGET key1 key2 key3\n\n# \u274c \u591a\u6b21 SET\nSET key1 value1\nSET key2 value2\n\n# \u2705 \u4f7f\u7528 MSET\nMSET key1 value1 key2 value2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-\u907f\u514d\u5927\u952e",children:"4. \u907f\u514d\u5927\u952e"}),"\n",(0,s.jsx)(n.p,{children:"\u5927\u952e\u64cd\u4f5c\u4f1a\u963b\u585e Redis\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"String\uff1a\u4e0d\u8d85\u8fc7 10KB"}),"\n",(0,s.jsx)(n.li,{children:"List\u3001Set\u3001Hash\u3001Sorted Set\uff1a\u5143\u7d20\u4e0d\u8d85\u8fc7 1 \u4e07"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u627e\u5927\u952e\nredis-cli --bigkeys\n\n# \u5206\u6790\u5927\u952e\u5360\u7528\nMEMORY USAGE key\n"})}),"\n",(0,s.jsx)(n.h3,{id:"5-\u4f7f\u7528-lua-\u811a\u672c",children:"5. \u4f7f\u7528 Lua \u811a\u672c"}),"\n",(0,s.jsx)(n.p,{children:"\u51cf\u5c11\u7f51\u7edc\u5f80\u8fd4\uff0c\u4fdd\u8bc1\u539f\u5b50\u6027\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u274c \u591a\u6b21\u5f80\u8fd4\nWATCH key\nGET key\nMULTI\nSET key new_value\nEXEC\n\n# \u2705 Lua \u811a\u672c\uff08\u4e00\u6b21\u5f80\u8fd4\uff09\nEVAL \"redis.call('SET', KEYS[1], ARGV[1])\" 1 key new_value\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u7f51\u7edc\u4f18\u5316",children:"\u7f51\u7edc\u4f18\u5316"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u4f7f\u7528\u8fde\u63a5\u6c60",children:"1. \u4f7f\u7528\u8fde\u63a5\u6c60"}),"\n",(0,s.jsx)(n.p,{children:"\u907f\u514d\u9891\u7e41\u521b\u5efa\u8fde\u63a5\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// Jedis \u8fde\u63a5\u6c60\nJedisPoolConfig config = new JedisPoolConfig();\nconfig.setMaxTotal(100);\nconfig.setMaxIdle(20);\nconfig.setMinIdle(10);\nconfig.setTestOnBorrow(true);\n\nJedisPool pool = new JedisPool(config, "localhost", 6379);\n\n// \u4f7f\u7528\ntry (Jedis jedis = pool.getResource()) {\n    jedis.set("key", "value");\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u7981\u7528-tcp_nodelay",children:"2. \u7981\u7528 TCP_NODELAY"}),"\n",(0,s.jsx)(n.p,{children:"\u4e3b\u4ece\u590d\u5236\u65f6\u7981\u7528\uff0c\u51cf\u5c11\u7f51\u7edc\u5ef6\u8fdf\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"# \u4e3b\u4ece\u590d\u5236\u7981\u7528 Nagle \u7b97\u6cd5\nrepl-disable-tcp-nodelay no\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u8c03\u6574\u8d85\u65f6\u65f6\u95f4",children:"3. \u8c03\u6574\u8d85\u65f6\u65f6\u95f4"}),"\n",(0,s.jsx)(n.p,{children:"\u907f\u514d\u957f\u65f6\u95f4\u7b49\u5f85\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u8bbe\u7f6e\u8fde\u63a5\u8d85\u65f6\u548c\u8bfb\u53d6\u8d85\u65f6\nJedis jedis = new Jedis("localhost", 6379, 2000, 5000);\n// \u8fde\u63a5\u8d85\u65f6 2 \u79d2\uff0c\u8bfb\u53d6\u8d85\u65f6 5 \u79d2\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-\u538b\u7f29\u6570\u636e",children:"4. \u538b\u7f29\u6570\u636e"}),"\n",(0,s.jsx)(n.p,{children:"\u4f20\u8f93\u5927\u6570\u636e\u65f6\u538b\u7f29\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// \u5ba2\u6237\u7aef\u538b\u7f29\nbyte[] data = compress(largeData);\njedis.set(key.getBytes(), data);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6301\u4e45\u5316\u4f18\u5316",children:"\u6301\u4e45\u5316\u4f18\u5316"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u9009\u62e9\u5408\u9002\u7684\u6301\u4e45\u5316\u65b9\u5f0f",children:"1. \u9009\u62e9\u5408\u9002\u7684\u6301\u4e45\u5316\u65b9\u5f0f"}),"\n",(0,s.jsx)(n.p,{children:"\u6839\u636e\u573a\u666f\u9009\u62e9\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"# \u7f13\u5b58\u573a\u666f\uff1a\u5173\u95ed\u6216\u4ec5 RDB\nappendonly no\nsave 900 1\n\n# \u6570\u636e\u5b89\u5168\u573a\u666f\uff1aAOF + RDB\nappendonly yes\nappendfsync everysec\nsave 900 1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-fork-\u4f18\u5316",children:"2. fork \u4f18\u5316"}),"\n",(0,s.jsx)(n.p,{children:"\u51cf\u5c11 fork \u5f00\u9500\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"# \u4f7f\u7528\u65e0\u76d8\u590d\u5236\uff08\u78c1\u76d8\u6162\u65f6\uff09\nrepl-diskless-sync yes\n\n# \u4f18\u5316\u5185\u5b58\u5206\u914d\u5668\n# \u4f7f\u7528 jemalloc\uff08\u9ed8\u8ba4\u5df2\u4f7f\u7528\uff09\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-aof-\u91cd\u5199\u4f18\u5316",children:"3. AOF \u91cd\u5199\u4f18\u5316"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"# \u907f\u514d\u9891\u7e41\u91cd\u5199\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n\n# \u91cd\u5199\u65f6\u4e0d\u540c\u6b65\uff08\u63d0\u9ad8\u6027\u80fd\uff0c\u7565\u5fae\u964d\u4f4e\u5b89\u5168\u6027\uff09\nno-appendfsync-on-rewrite yes\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6162\u67e5\u8be2\u5206\u6790",children:"\u6162\u67e5\u8be2\u5206\u6790"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u914d\u7f6e\u6162\u67e5\u8be2",children:"1. \u914d\u7f6e\u6162\u67e5\u8be2"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"# \u6162\u67e5\u8be2\u9608\u503c\uff08\u5fae\u79d2\uff0c10000 = 10 \u6beb\u79d2\uff09\nslowlog-log-slower-than 10000\n\n# \u6162\u67e5\u8be2\u65e5\u5fd7\u6700\u5927\u957f\u5ea6\nslowlog-max-len 128\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u67e5\u770b\u6162\u67e5\u8be2",children:"2. \u67e5\u770b\u6162\u67e5\u8be2"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b\u6162\u67e5\u8be2\u65e5\u5fd7\nSLOWLOG GET 10\n\n# \u6162\u67e5\u8be2\u65e5\u5fd7\u957f\u5ea6\nSLOWLOG LEN\n\n# \u6e05\u7a7a\u6162\u67e5\u8be2\u65e5\u5fd7\nSLOWLOG RESET\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u5206\u6790\u6162\u67e5\u8be2",children:"3. \u5206\u6790\u6162\u67e5\u8be2"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'127.0.0.1:6379> SLOWLOG GET 5\n1) 1) (integer) 6  # \u65e5\u5fd7 ID\n   2) (integer) 1670000000  # \u65f6\u95f4\u6233\n   3) (integer) 12000  # \u6267\u884c\u65f6\u95f4\uff08\u5fae\u79d2\uff09\n   4) 1) "KEYS"  # \u547d\u4ee4\n      2) "*"\n   5) "127.0.0.1:6379"  # \u5ba2\u6237\u7aef\u5730\u5740\n   6) ""\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u76d1\u63a7\u548c\u8bca\u65ad",children:"\u76d1\u63a7\u548c\u8bca\u65ad"}),"\n",(0,s.jsx)(n.h3,{id:"1-info-\u547d\u4ee4",children:"1. INFO \u547d\u4ee4"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b\u670d\u52a1\u5668\u4fe1\u606f\nINFO\n\n# \u67e5\u770b\u7279\u5b9a\u90e8\u5206\nINFO server      # \u670d\u52a1\u5668\u4fe1\u606f\nINFO clients     # \u5ba2\u6237\u7aef\u4fe1\u606f\nINFO memory      # \u5185\u5b58\u4fe1\u606f\nINFO persistence # \u6301\u4e45\u5316\u4fe1\u606f\nINFO stats       # \u7edf\u8ba1\u4fe1\u606f\nINFO replication # \u590d\u5236\u4fe1\u606f\nINFO cpu         # CPU \u4fe1\u606f\nINFO commandstats # \u547d\u4ee4\u7edf\u8ba1\nINFO cluster     # \u96c6\u7fa4\u4fe1\u606f\nINFO keyspace    # \u952e\u7a7a\u95f4\u4fe1\u606f\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u76d1\u63a7\u5173\u952e\u6307\u6807",children:"2. \u76d1\u63a7\u5173\u952e\u6307\u6807"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u5185\u5b58\u788e\u7247\u7387\nINFO memory | grep mem_fragmentation_ratio\n# \u6b63\u5e38\uff1a1.0-1.5\uff0c\u8fc7\u9ad8\u9700\u8981\u91cd\u542f\n\n# \u7f13\u5b58\u547d\u4e2d\u7387\nINFO stats | grep keyspace\n# hits / (hits + misses)\n\n# \u5ba2\u6237\u7aef\u8fde\u63a5\u6570\nINFO clients | grep connected_clients\n\n# OPS\uff08\u6bcf\u79d2\u64cd\u4f5c\u6570\uff09\nINFO stats | grep instantaneous_ops_per_sec\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u4f7f\u7528-monitor",children:"3. \u4f7f\u7528 MONITOR"}),"\n",(0,s.jsx)(n.p,{children:"\u5b9e\u65f6\u67e5\u770b Redis \u6267\u884c\u7684\u547d\u4ee4\uff08\u6027\u80fd\u5f00\u9500\u5927\uff0c\u4ec5\u8c03\u8bd5\u4f7f\u7528\uff09\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"MONITOR\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-redis-cli-\u5de5\u5177",children:"4. redis-cli \u5de5\u5177"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u67e5\u770b\u7edf\u8ba1\u4fe1\u606f\nredis-cli --stat\n\n# \u67e5\u770b\u5927\u952e\nredis-cli --bigkeys\n\n# \u67e5\u770b\u5185\u5b58\u4f7f\u7528\nredis-cli --memkeys\n\n# \u626b\u63cf\u952e\nredis-cli --scan --pattern "user:*"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u9ad8\u53ef\u7528\u4f18\u5316",children:"\u9ad8\u53ef\u7528\u4f18\u5316"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u4e3b\u4ece\u590d\u5236\u4f18\u5316",children:"1. \u4e3b\u4ece\u590d\u5236\u4f18\u5316"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"# \u590d\u5236\u8d85\u65f6\nrepl-timeout 60\n\n# \u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\uff08\u6839\u636e\u7f51\u7edc\u60c5\u51b5\u8c03\u6574\uff09\nrepl-backlog-size 10mb\n\n# \u7981\u7528 TCP_NODELAY\nrepl-disable-tcp-nodelay no\n\n# \u4ece\u8282\u70b9\u53ea\u8bfb\nreplica-read-only yes\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u54e8\u5175\u4f18\u5316",children:"2. \u54e8\u5175\u4f18\u5316"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"# \u9002\u5f53\u589e\u52a0\u4e0b\u7ebf\u5224\u5b9a\u65f6\u95f4\nsentinel down-after-milliseconds mymaster 30000\n\n# \u63a7\u5236\u5e76\u884c\u590d\u5236\u6570\u91cf\nsentinel parallel-syncs mymaster 1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u96c6\u7fa4\u4f18\u5316",children:"3. \u96c6\u7fa4\u4f18\u5316"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"# \u8282\u70b9\u8d85\u65f6\ncluster-node-timeout 15000\n\n# \u5141\u8bb8\u4ece\u8282\u70b9\u5728\u4e3b\u8282\u70b9\u4e0b\u7ebf\u65f6\u63d0\u4f9b\u8bfb\u670d\u52a1\ncluster-allow-reads-when-down no\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u914d\u7f6e\u4f18\u5316",children:"\u914d\u7f6e\u4f18\u5316"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u5185\u5b58\u914d\u7f6e",children:"1. \u5185\u5b58\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"# \u6700\u5927\u5185\u5b58\nmaxmemory 2gb\n\n# \u6dd8\u6c70\u7b56\u7565\nmaxmemory-policy allkeys-lru\n\n# \u91c7\u6837\u6570\u91cf\uff08LRU/LFU \u7b97\u6cd5\uff09\nmaxmemory-samples 5\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u7ebf\u7a0b\u914d\u7f6e",children:"2. \u7ebf\u7a0b\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-conf",children:"# Redis 6.0+ \u591a\u7ebf\u7a0b I/O\nio-threads 4\nio-threads-do-reads yes\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u7cfb\u7edf\u914d\u7f6e",children:"3. \u7cfb\u7edf\u914d\u7f6e"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Linux \u5185\u6838\u53c2\u6570"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u5173\u95ed\u900f\u660e\u5927\u9875\necho never > /sys/kernel/mm/transparent_hugepage/enabled\n\n# \u4fee\u6539 overcommit_memory\necho 1 > /proc/sys/vm/overcommit_memory\n\n# \u589e\u52a0\u6700\u5927\u6587\u4ef6\u63cf\u8ff0\u7b26\nulimit -n 65535\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3",children:"\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u5185\u5b58\u4f18\u5316",children:"1. \u5185\u5b58\u4f18\u5316"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u9009\u62e9\u5408\u9002\u7684\u6570\u636e\u7ed3\u6784"}),"\n",(0,s.jsx)(n.li,{children:"\u63a7\u5236\u96c6\u5408\u5927\u5c0f\uff08\u5206\u7247\u5b58\u50a8\uff09"}),"\n",(0,s.jsx)(n.li,{children:"\u8bbe\u7f6e maxmemory \u548c\u6dd8\u6c70\u7b56\u7565"}),"\n",(0,s.jsx)(n.li,{children:"\u538b\u7f29\u5927\u503c"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-\u547d\u4ee4\u4f18\u5316",children:"2. \u547d\u4ee4\u4f18\u5316"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u907f\u514d KEYS\u3001FLUSHALL \u7b49\u5371\u9669\u547d\u4ee4"}),"\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528 Pipeline \u548c\u6279\u91cf\u547d\u4ee4"}),"\n",(0,s.jsx)(n.li,{children:"\u907f\u514d\u5927\u952e"}),"\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528 Lua \u811a\u672c"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-\u7f51\u7edc\u4f18\u5316",children:"3. \u7f51\u7edc\u4f18\u5316"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528\u8fde\u63a5\u6c60"}),"\n",(0,s.jsx)(n.li,{children:"\u6279\u91cf\u64cd\u4f5c\u51cf\u5c11\u5f80\u8fd4"}),"\n",(0,s.jsx)(n.li,{children:"\u538b\u7f29\u5927\u6570\u636e"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"4-\u6301\u4e45\u5316\u4f18\u5316",children:"4. \u6301\u4e45\u5316\u4f18\u5316"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6839\u636e\u573a\u666f\u9009\u62e9\u6301\u4e45\u5316\u65b9\u5f0f"}),"\n",(0,s.jsx)(n.li,{children:"\u4f18\u5316 fork \u548c AOF \u91cd\u5199"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"5-\u76d1\u63a7",children:"5. \u76d1\u63a7"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5b9a\u671f\u67e5\u770b INFO\u3001SLOWLOG"}),"\n",(0,s.jsx)(n.li,{children:"\u76d1\u63a7\u5185\u5b58\u3001\u547d\u4e2d\u7387\u3001OPS"}),"\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528\u5de5\u5177\u5206\u6790\u6027\u80fd"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u6027\u80fd\u6d4b\u8bd5",children:"\u6027\u80fd\u6d4b\u8bd5"}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-redis-benchmark",children:"\u4f7f\u7528 redis-benchmark"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u57fa\u51c6\u6d4b\u8bd5\nredis-benchmark -h 127.0.0.1 -p 6379 -c 100 -n 100000\n\n# \u6d4b\u8bd5\u7279\u5b9a\u547d\u4ee4\nredis-benchmark -t set,get -n 100000 -q\n\n# \u4f7f\u7528 Pipeline\nredis-benchmark -t set -n 1000000 -P 16\n\n# \u6d4b\u8bd5\u5927\u952e\nredis-benchmark -t set -d 10240 -n 100000\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u89e3\u8bfb\u6d4b\u8bd5\u7ed3\u679c",children:"\u89e3\u8bfb\u6d4b\u8bd5\u7ed3\u679c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"SET: 85000.00 requests per second\nGET: 90000.00 requests per second\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"QPS"}),"\uff1a\u6bcf\u79d2\u67e5\u8be2\u6570\uff08requests per second\uff09"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5ef6\u8fdf"}),"\uff1aP50\u3001P95\u3001P99 \u5ef6\u8fdf"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u5c0f\u7ed3",children:"\u5c0f\u7ed3"}),"\n",(0,s.jsx)(n.p,{children:"Redis \u6027\u80fd\u4f18\u5316\u8981\u70b9\uff1a"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u5185\u5b58"}),"\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u9009\u62e9\u5408\u9002\u7684\u6570\u636e\u7ed3\u6784"}),"\n",(0,s.jsx)(n.li,{children:"\u63a7\u5236\u96c6\u5408\u5927\u5c0f"}),"\n",(0,s.jsx)(n.li,{children:"\u8bbe\u7f6e\u6dd8\u6c70\u7b56\u7565"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u547d\u4ee4"}),"\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u907f\u514d\u5371\u9669\u547d\u4ee4"}),"\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528 Pipeline \u548c\u6279\u91cf\u64cd\u4f5c"}),"\n",(0,s.jsx)(n.li,{children:"\u907f\u514d\u5927\u952e"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u7f51\u7edc"}),"\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528\u8fde\u63a5\u6c60"}),"\n",(0,s.jsx)(n.li,{children:"\u51cf\u5c11\u5f80\u8fd4\u6b21\u6570"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u76d1\u63a7"}),"\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"INFO\u3001SLOWLOG"}),"\n",(0,s.jsx)(n.li,{children:"\u5185\u5b58\u788e\u7247\u7387\u3001\u547d\u4e2d\u7387"}),"\n",(0,s.jsx)(n.li,{children:"redis-benchmark \u6d4b\u8bd5"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u914d\u7f6e"}),"\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5408\u7406\u7684\u6301\u4e45\u5316\u7b56\u7565"}),"\n",(0,s.jsx)(n.li,{children:"\u591a\u7ebf\u7a0b I/O\uff08Redis 6.0+\uff09"}),"\n",(0,s.jsx)(n.li,{children:"\u7cfb\u7edf\u5185\u6838\u53c2\u6570\u8c03\u4f18"}),"\n"]})]})}function t(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);
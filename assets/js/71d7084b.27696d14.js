"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[85938],{24610:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>d,frontMatter:()=>t,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"mybatis/spring-integration","title":"MyBatis Spring \u96c6\u6210","description":"\u672c\u7ae0\u4ecb\u7ecd MyBatis \u4e0e Spring/Spring Boot \u7684\u96c6\u6210\u65b9\u5f0f\uff0c\u5305\u62ec\u914d\u7f6e\u3001\u4e8b\u52a1\u7ba1\u7406\u548c\u591a\u6570\u636e\u6e90\u914d\u7f6e\u3002","source":"@site/docs/mybatis/spring-integration.md","sourceDirName":"mybatis","slug":"/mybatis/spring-integration","permalink":"/docs/mybatis/spring-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/mybatis/spring-integration.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"MyBatis Spring \u96c6\u6210"},"sidebar":"mybatis","previous":{"title":"MyBatis \u7f13\u5b58\u673a\u5236","permalink":"/docs/mybatis/caching"},"next":{"title":"MyBatis \u63d2\u4ef6\u673a\u5236","permalink":"/docs/mybatis/plugins"}}');var i=a(22714),s=a(48885);const t={sidebar_position:8,title:"MyBatis Spring \u96c6\u6210"},c="MyBatis Spring \u96c6\u6210",o={},l=[{value:"Spring Boot \u96c6\u6210",id:"spring-boot-\u96c6\u6210",level:2},{value:"\u6dfb\u52a0\u4f9d\u8d56",id:"\u6dfb\u52a0\u4f9d\u8d56",level:3},{value:"\u914d\u7f6e\u6587\u4ef6",id:"\u914d\u7f6e\u6587\u4ef6",level:3},{value:"\u9879\u76ee\u7ed3\u6784",id:"\u9879\u76ee\u7ed3\u6784",level:3},{value:"Mapper \u63a5\u53e3",id:"mapper-\u63a5\u53e3",level:3},{value:"Mapper \u626b\u63cf",id:"mapper-\u626b\u63cf",level:3},{value:"Service \u5c42\u4f7f\u7528",id:"service-\u5c42\u4f7f\u7528",level:3},{value:"\u4f20\u7edf Spring \u96c6\u6210",id:"\u4f20\u7edf-spring-\u96c6\u6210",level:2},{value:"\u6dfb\u52a0\u4f9d\u8d56",id:"\u6dfb\u52a0\u4f9d\u8d56-1",level:3},{value:"XML \u914d\u7f6e\u65b9\u5f0f",id:"xml-\u914d\u7f6e\u65b9\u5f0f",level:3},{value:"Java \u914d\u7f6e\u65b9\u5f0f",id:"java-\u914d\u7f6e\u65b9\u5f0f",level:3},{value:"\u4e8b\u52a1\u7ba1\u7406",id:"\u4e8b\u52a1\u7ba1\u7406",level:2},{value:"@Transactional \u6ce8\u89e3",id:"transactional-\u6ce8\u89e3",level:3},{value:"\u4e8b\u52a1\u4f20\u64ad\u884c\u4e3a",id:"\u4e8b\u52a1\u4f20\u64ad\u884c\u4e3a",level:3},{value:"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b",id:"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b",level:3},{value:"\u7f16\u7a0b\u5f0f\u4e8b\u52a1",id:"\u7f16\u7a0b\u5f0f\u4e8b\u52a1",level:3},{value:"\u591a\u6570\u636e\u6e90\u914d\u7f6e",id:"\u591a\u6570\u636e\u6e90\u914d\u7f6e",level:2},{value:"\u914d\u7f6e\u6587\u4ef6",id:"\u914d\u7f6e\u6587\u4ef6-1",level:3},{value:"\u6570\u636e\u6e90\u914d\u7f6e\u7c7b",id:"\u6570\u636e\u6e90\u914d\u7f6e\u7c7b",level:3},{value:"\u4e3b\u6570\u636e\u6e90 MyBatis \u914d\u7f6e",id:"\u4e3b\u6570\u636e\u6e90-mybatis-\u914d\u7f6e",level:3},{value:"\u4ece\u6570\u636e\u6e90 MyBatis \u914d\u7f6e",id:"\u4ece\u6570\u636e\u6e90-mybatis-\u914d\u7f6e",level:3},{value:"\u4f7f\u7528\u591a\u6570\u636e\u6e90",id:"\u4f7f\u7528\u591a\u6570\u636e\u6e90",level:3},{value:"\u52a8\u6001\u6570\u636e\u6e90",id:"\u52a8\u6001\u6570\u636e\u6e90",level:2},{value:"\u52a8\u6001\u6570\u636e\u6e90\u5b9e\u73b0",id:"\u52a8\u6001\u6570\u636e\u6e90\u5b9e\u73b0",level:3},{value:"\u914d\u7f6e\u52a8\u6001\u6570\u636e\u6e90",id:"\u914d\u7f6e\u52a8\u6001\u6570\u636e\u6e90",level:3},{value:"\u4f7f\u7528\u6ce8\u89e3\u5207\u6362\u6570\u636e\u6e90",id:"\u4f7f\u7528\u6ce8\u89e3\u5207\u6362\u6570\u636e\u6e90",level:3},{value:"\u5b8c\u6574\u9879\u76ee\u793a\u4f8b",id:"\u5b8c\u6574\u9879\u76ee\u793a\u4f8b",level:2},{value:"pom.xml",id:"pomxml",level:3},{value:"\u542f\u52a8\u7c7b",id:"\u542f\u52a8\u7c7b",level:3},{value:"\u5b9e\u4f53\u7c7b",id:"\u5b9e\u4f53\u7c7b",level:3},{value:"Mapper \u63a5\u53e3",id:"mapper-\u63a5\u53e3-1",level:3},{value:"Mapper XML",id:"mapper-xml",level:3},{value:"Service \u5c42",id:"service-\u5c42",level:3},{value:"\u76f8\u5173\u94fe\u63a5",id:"\u76f8\u5173\u94fe\u63a5",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"mybatis-spring-\u96c6\u6210",children:"MyBatis Spring \u96c6\u6210"})}),"\n",(0,i.jsx)(n.p,{children:"\u672c\u7ae0\u4ecb\u7ecd MyBatis \u4e0e Spring/Spring Boot \u7684\u96c6\u6210\u65b9\u5f0f\uff0c\u5305\u62ec\u914d\u7f6e\u3001\u4e8b\u52a1\u7ba1\u7406\u548c\u591a\u6570\u636e\u6e90\u914d\u7f6e\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"spring-boot-\u96c6\u6210",children:"Spring Boot \u96c6\u6210"}),"\n",(0,i.jsx)(n.h3,{id:"\u6dfb\u52a0\u4f9d\u8d56",children:"\u6dfb\u52a0\u4f9d\u8d56"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<dependencies>\n    \x3c!-- MyBatis Spring Boot Starter --\x3e\n    <dependency>\n        <groupId>org.mybatis.spring.boot</groupId>\n        <artifactId>mybatis-spring-boot-starter</artifactId>\n        <version>3.0.3</version>\n    </dependency>\n    \n    \x3c!-- MySQL \u9a71\u52a8 --\x3e\n    <dependency>\n        <groupId>com.mysql</groupId>\n        <artifactId>mysql-connector-j</artifactId>\n        <scope>runtime</scope>\n    </dependency>\n</dependencies>\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u914d\u7f6e\u6587\u4ef6",children:"\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"application.yml:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"spring:\n  datasource:\n    url: jdbc:mysql://localhost:3306/mydb?useSSL=false&serverTimezone=UTC\n    username: root\n    password: 123456\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    # HikariCP \u8fde\u63a5\u6c60\u914d\u7f6e\n    hikari:\n      minimum-idle: 5\n      maximum-pool-size: 20\n      idle-timeout: 30000\n      connection-timeout: 30000\n      max-lifetime: 1800000\n\nmybatis:\n  # Mapper XML \u6587\u4ef6\u4f4d\u7f6e\n  mapper-locations: classpath:mapper/*.xml\n  # \u5b9e\u4f53\u7c7b\u5305\u8def\u5f84\uff08\u7c7b\u578b\u522b\u540d\uff09\n  type-aliases-package: com.example.entity\n  # MyBatis \u914d\u7f6e\u6587\u4ef6\uff08\u53ef\u9009\uff09\n  config-location: classpath:mybatis-config.xml\n  configuration:\n    # \u9a7c\u5cf0\u547d\u540d\u6620\u5c04\n    map-underscore-to-camel-case: true\n    # \u65e5\u5fd7\u5b9e\u73b0\n    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl\n    # \u7f13\u5b58\n    cache-enabled: true\n    # \u5ef6\u8fdf\u52a0\u8f7d\n    lazy-loading-enabled: false\n    # \u7a7a\u503c\u8c03\u7528 setter\n    call-setters-on-nulls: true\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"application.properties:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-properties",children:"# \u6570\u636e\u6e90\u914d\u7f6e\nspring.datasource.url=jdbc:mysql://localhost:3306/mydb\nspring.datasource.username=root\nspring.datasource.password=123456\nspring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver\n\n# MyBatis \u914d\u7f6e\nmybatis.mapper-locations=classpath:mapper/*.xml\nmybatis.type-aliases-package=com.example.entity\nmybatis.configuration.map-underscore-to-camel-case=true\nmybatis.configuration.log-impl=org.apache.ibatis.logging.slf4j.Slf4jImpl\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u9879\u76ee\u7ed3\u6784",children:"\u9879\u76ee\u7ed3\u6784"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"src/main/java\n\u251c\u2500\u2500 com.example\n\u2502   \u251c\u2500\u2500 Application.java\n\u2502   \u251c\u2500\u2500 entity\n\u2502   \u2502   \u2514\u2500\u2500 User.java\n\u2502   \u251c\u2500\u2500 mapper\n\u2502   \u2502   \u2514\u2500\u2500 UserMapper.java\n\u2502   \u2514\u2500\u2500 service\n\u2502       \u2514\u2500\u2500 UserService.java\nsrc/main/resources\n\u251c\u2500\u2500 application.yml\n\u251c\u2500\u2500 mapper\n\u2502   \u2514\u2500\u2500 UserMapper.xml\n\u2514\u2500\u2500 mybatis-config.xml (\u53ef\u9009)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"mapper-\u63a5\u53e3",children:"Mapper \u63a5\u53e3"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.mapper;\n\nimport com.example.entity.User;\nimport org.apache.ibatis.annotations.*;\n\nimport java.util.List;\n\n@Mapper  // \u6807\u8bb0\u4e3a Mapper \u63a5\u53e3\npublic interface UserMapper {\n    \n    @Select("SELECT * FROM user WHERE id = #{id}")\n    User selectById(Long id);\n    \n    List<User> selectByCondition(UserQuery query);\n    \n    @Insert("INSERT INTO user(name, email) VALUES(#{name}, #{email})")\n    @Options(useGeneratedKeys = true, keyProperty = "id")\n    int insert(User user);\n    \n    int update(User user);\n    \n    @Delete("DELETE FROM user WHERE id = #{id}")\n    int deleteById(Long id);\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"mapper-\u626b\u63cf",children:"Mapper \u626b\u63cf"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u65b9\u5f0f\u4e00\uff1a@Mapper \u6ce8\u89e3"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Mapper\npublic interface UserMapper {\n    // ...\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u65b9\u5f0f\u4e8c\uff1a@MapperScan \u6ce8\u89e3\uff08\u63a8\u8350\uff09"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@SpringBootApplication\n@MapperScan("com.example.mapper")  // \u626b\u63cf Mapper \u5305\npublic class Application {\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u65b9\u5f0f\u4e09\uff1a\u591a\u5305\u626b\u63cf"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@MapperScan(basePackages = {\n    "com.example.mapper",\n    "com.example.repository"\n})\npublic class Application {\n    // ...\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"service-\u5c42\u4f7f\u7528",children:"Service \u5c42\u4f7f\u7528"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Service\npublic class UserService {\n    \n    @Autowired\n    private UserMapper userMapper;\n    \n    public User getById(Long id) {\n        return userMapper.selectById(id);\n    }\n    \n    @Transactional\n    public void createUser(User user) {\n        userMapper.insert(user);\n    }\n    \n    @Transactional\n    public void updateUser(User user) {\n        userMapper.update(user);\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u4f20\u7edf-spring-\u96c6\u6210",children:"\u4f20\u7edf Spring \u96c6\u6210"}),"\n",(0,i.jsx)(n.h3,{id:"\u6dfb\u52a0\u4f9d\u8d56-1",children:"\u6dfb\u52a0\u4f9d\u8d56"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<dependencies>\n    <dependency>\n        <groupId>org.mybatis</groupId>\n        <artifactId>mybatis</artifactId>\n        <version>3.5.16</version>\n    </dependency>\n    <dependency>\n        <groupId>org.mybatis</groupId>\n        <artifactId>mybatis-spring</artifactId>\n        <version>3.0.3</version>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework</groupId>\n        <artifactId>spring-jdbc</artifactId>\n        <version>6.1.5</version>\n    </dependency>\n</dependencies>\n"})}),"\n",(0,i.jsx)(n.h3,{id:"xml-\u914d\u7f6e\u65b9\u5f0f",children:"XML \u914d\u7f6e\u65b9\u5f0f"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8"?>\n<beans xmlns="http://www.springframework.org/schema/beans"\n       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n       xmlns:tx="http://www.springframework.org/schema/tx"\n       xsi:schemaLocation="\n           http://www.springframework.org/schema/beans\n           http://www.springframework.org/schema/beans/spring-beans.xsd\n           http://www.springframework.org/schema/tx\n           http://www.springframework.org/schema/tx/spring-tx.xsd">\n    \n    \x3c!-- \u6570\u636e\u6e90 --\x3e\n    <bean id="dataSource" class="com.zaxxer.hikari.HikariDataSource">\n        <property name="driverClassName" value="com.mysql.cj.jdbc.Driver"/>\n        <property name="jdbcUrl" value="jdbc:mysql://localhost:3306/mydb"/>\n        <property name="username" value="root"/>\n        <property name="password" value="123456"/>\n    </bean>\n    \n    \x3c!-- SqlSessionFactory --\x3e\n    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">\n        <property name="dataSource" ref="dataSource"/>\n        <property name="configLocation" value="classpath:mybatis-config.xml"/>\n        <property name="mapperLocations" value="classpath:mapper/*.xml"/>\n        <property name="typeAliasesPackage" value="com.example.entity"/>\n    </bean>\n    \n    \x3c!-- Mapper \u626b\u63cf --\x3e\n    <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">\n        <property name="basePackage" value="com.example.mapper"/>\n        <property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"/>\n    </bean>\n    \n    \x3c!-- \u4e8b\u52a1\u7ba1\u7406\u5668 --\x3e\n    <bean id="transactionManager" \n          class="org.springframework.jdbc.datasource.DataSourceTransactionManager">\n        <property name="dataSource" ref="dataSource"/>\n    </bean>\n    \n    \x3c!-- \u542f\u7528\u6ce8\u89e3\u4e8b\u52a1 --\x3e\n    <tx:annotation-driven transaction-manager="transactionManager"/>\n    \n</beans>\n'})}),"\n",(0,i.jsx)(n.h3,{id:"java-\u914d\u7f6e\u65b9\u5f0f",children:"Java \u914d\u7f6e\u65b9\u5f0f"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Configuration\n@MapperScan("com.example.mapper")\n@EnableTransactionManagement\npublic class MyBatisConfig {\n    \n    @Bean\n    public DataSource dataSource() {\n        HikariDataSource dataSource = new HikariDataSource();\n        dataSource.setDriverClassName("com.mysql.cj.jdbc.Driver");\n        dataSource.setJdbcUrl("jdbc:mysql://localhost:3306/mydb");\n        dataSource.setUsername("root");\n        dataSource.setPassword("123456");\n        return dataSource;\n    }\n    \n    @Bean\n    public SqlSessionFactory sqlSessionFactory(DataSource dataSource) throws Exception {\n        SqlSessionFactoryBean factoryBean = new SqlSessionFactoryBean();\n        factoryBean.setDataSource(dataSource);\n        factoryBean.setTypeAliasesPackage("com.example.entity");\n        factoryBean.setMapperLocations(\n            new PathMatchingResourcePatternResolver()\n                .getResources("classpath:mapper/*.xml"));\n        \n        // MyBatis \u914d\u7f6e\n        org.apache.ibatis.session.Configuration configuration = \n            new org.apache.ibatis.session.Configuration();\n        configuration.setMapUnderscoreToCamelCase(true);\n        configuration.setCacheEnabled(true);\n        factoryBean.setConfiguration(configuration);\n        \n        return factoryBean.getObject();\n    }\n    \n    @Bean\n    public DataSourceTransactionManager transactionManager(DataSource dataSource) {\n        return new DataSourceTransactionManager(dataSource);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u4e8b\u52a1\u7ba1\u7406",children:"\u4e8b\u52a1\u7ba1\u7406"}),"\n",(0,i.jsx)(n.h3,{id:"transactional-\u6ce8\u89e3",children:"@Transactional \u6ce8\u89e3"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Service\npublic class UserService {\n    \n    @Autowired\n    private UserMapper userMapper;\n    \n    @Autowired\n    private OrderMapper orderMapper;\n    \n    // \u57fa\u672c\u4e8b\u52a1\n    @Transactional\n    public void createUser(User user) {\n        userMapper.insert(user);\n    }\n    \n    // \u53ea\u8bfb\u4e8b\u52a1\uff08\u4f18\u5316\u67e5\u8be2\u6027\u80fd\uff09\n    @Transactional(readOnly = true)\n    public User getUser(Long id) {\n        return userMapper.selectById(id);\n    }\n    \n    // \u6307\u5b9a\u56de\u6eda\u5f02\u5e38\n    @Transactional(rollbackFor = Exception.class)\n    public void updateUser(User user) throws Exception {\n        userMapper.update(user);\n        // \u5982\u679c\u629b\u51fa\u5f02\u5e38\uff0c\u4e8b\u52a1\u56de\u6eda\n    }\n    \n    // \u4e0d\u56de\u6eda\u7279\u5b9a\u5f02\u5e38\n    @Transactional(noRollbackFor = BusinessException.class)\n    public void processUser(User user) {\n        // BusinessException \u4e0d\u4f1a\u5bfc\u81f4\u56de\u6eda\n    }\n    \n    // \u8d85\u65f6\u8bbe\u7f6e\n    @Transactional(timeout = 30)\n    public void longOperation() {\n        // \u8d85\u8fc7 30 \u79d2\u81ea\u52a8\u56de\u6eda\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u4e8b\u52a1\u4f20\u64ad\u884c\u4e3a",children:"\u4e8b\u52a1\u4f20\u64ad\u884c\u4e3a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Service\npublic class OrderService {\n    \n    @Autowired\n    private OrderMapper orderMapper;\n    \n    @Autowired\n    private UserService userService;\n    \n    // REQUIRED\uff08\u9ed8\u8ba4\uff09\uff1a\u6709\u4e8b\u52a1\u5c31\u52a0\u5165\uff0c\u6ca1\u6709\u5c31\u65b0\u5efa\n    @Transactional(propagation = Propagation.REQUIRED)\n    public void createOrder(Order order) {\n        orderMapper.insert(order);\n        userService.updateUserPoints(order.getUserId());\n    }\n    \n    // REQUIRES_NEW\uff1a\u603b\u662f\u65b0\u5efa\u4e8b\u52a1\uff0c\u6302\u8d77\u5f53\u524d\u4e8b\u52a1\n    @Transactional(propagation = Propagation.REQUIRES_NEW)\n    public void createOrderLog(OrderLog log) {\n        // \u72ec\u7acb\u4e8b\u52a1\uff0c\u4e0d\u53d7\u5916\u5c42\u4e8b\u52a1\u5f71\u54cd\n    }\n    \n    // NESTED\uff1a\u5d4c\u5957\u4e8b\u52a1\uff0c\u53ef\u4ee5\u72ec\u7acb\u56de\u6eda\n    @Transactional(propagation = Propagation.NESTED)\n    public void updateInventory(Long productId, int quantity) {\n        // \u5d4c\u5957\u4e8b\u52a1\n    }\n    \n    // SUPPORTS\uff1a\u6709\u4e8b\u52a1\u5c31\u52a0\u5165\uff0c\u6ca1\u6709\u5c31\u975e\u4e8b\u52a1\u6267\u884c\n    @Transactional(propagation = Propagation.SUPPORTS)\n    public Order getOrder(Long id) {\n        return orderMapper.selectById(id);\n    }\n    \n    // NOT_SUPPORTED\uff1a\u975e\u4e8b\u52a1\u6267\u884c\uff0c\u6302\u8d77\u5f53\u524d\u4e8b\u52a1\n    @Transactional(propagation = Propagation.NOT_SUPPORTED)\n    public void sendNotification() {\n        // \u4e0d\u9700\u8981\u4e8b\u52a1\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b",children:"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Transactional(isolation = Isolation.READ_COMMITTED)\npublic void updateBalance(Long userId, BigDecimal amount) {\n    // \u8bfb\u5df2\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\n}\n"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u9694\u79bb\u7ea7\u522b"}),(0,i.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DEFAULT"})}),(0,i.jsx)(n.td,{children:"\u4f7f\u7528\u6570\u636e\u5e93\u9ed8\u8ba4"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"READ_UNCOMMITTED"})}),(0,i.jsx)(n.td,{children:"\u8bfb\u672a\u63d0\u4ea4"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"READ_COMMITTED"})}),(0,i.jsx)(n.td,{children:"\u8bfb\u5df2\u63d0\u4ea4"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"REPEATABLE_READ"})}),(0,i.jsx)(n.td,{children:"\u53ef\u91cd\u590d\u8bfb"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"SERIALIZABLE"})}),(0,i.jsx)(n.td,{children:"\u4e32\u884c\u5316"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\u7f16\u7a0b\u5f0f\u4e8b\u52a1",children:"\u7f16\u7a0b\u5f0f\u4e8b\u52a1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Service\npublic class UserService {\n    \n    @Autowired\n    private TransactionTemplate transactionTemplate;\n    \n    @Autowired\n    private UserMapper userMapper;\n    \n    public void createUserWithProgrammaticTx(User user) {\n        transactionTemplate.execute(status -> {\n            try {\n                userMapper.insert(user);\n                // \u5176\u4ed6\u64cd\u4f5c\n                return true;\n            } catch (Exception e) {\n                status.setRollbackOnly();\n                return false;\n            }\n        });\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u591a\u6570\u636e\u6e90\u914d\u7f6e",children:"\u591a\u6570\u636e\u6e90\u914d\u7f6e"}),"\n",(0,i.jsx)(n.h3,{id:"\u914d\u7f6e\u6587\u4ef6-1",children:"\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"spring:\n  datasource:\n    primary:\n      url: jdbc:mysql://localhost:3306/db_primary\n      username: root\n      password: 123456\n      driver-class-name: com.mysql.cj.jdbc.Driver\n    secondary:\n      url: jdbc:mysql://localhost:3306/db_secondary\n      username: root\n      password: 123456\n      driver-class-name: com.mysql.cj.jdbc.Driver\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u6570\u636e\u6e90\u914d\u7f6e\u7c7b",children:"\u6570\u636e\u6e90\u914d\u7f6e\u7c7b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class DataSourceConfig {\n    \n    @Bean\n    @Primary\n    @ConfigurationProperties(prefix = "spring.datasource.primary")\n    public DataSource primaryDataSource() {\n        return DataSourceBuilder.create().build();\n    }\n    \n    @Bean\n    @ConfigurationProperties(prefix = "spring.datasource.secondary")\n    public DataSource secondaryDataSource() {\n        return DataSourceBuilder.create().build();\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3b\u6570\u636e\u6e90-mybatis-\u914d\u7f6e",children:"\u4e3b\u6570\u636e\u6e90 MyBatis \u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Configuration\n@MapperScan(\n    basePackages = "com.example.mapper.primary",\n    sqlSessionFactoryRef = "primarySqlSessionFactory"\n)\npublic class PrimaryMyBatisConfig {\n    \n    @Bean\n    @Primary\n    public SqlSessionFactory primarySqlSessionFactory(\n            @Qualifier("primaryDataSource") DataSource dataSource) throws Exception {\n        SqlSessionFactoryBean factoryBean = new SqlSessionFactoryBean();\n        factoryBean.setDataSource(dataSource);\n        factoryBean.setMapperLocations(\n            new PathMatchingResourcePatternResolver()\n                .getResources("classpath:mapper/primary/*.xml"));\n        return factoryBean.getObject();\n    }\n    \n    @Bean\n    @Primary\n    public DataSourceTransactionManager primaryTransactionManager(\n            @Qualifier("primaryDataSource") DataSource dataSource) {\n        return new DataSourceTransactionManager(dataSource);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u4ece\u6570\u636e\u6e90-mybatis-\u914d\u7f6e",children:"\u4ece\u6570\u636e\u6e90 MyBatis \u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Configuration\n@MapperScan(\n    basePackages = "com.example.mapper.secondary",\n    sqlSessionFactoryRef = "secondarySqlSessionFactory"\n)\npublic class SecondaryMyBatisConfig {\n    \n    @Bean\n    public SqlSessionFactory secondarySqlSessionFactory(\n            @Qualifier("secondaryDataSource") DataSource dataSource) throws Exception {\n        SqlSessionFactoryBean factoryBean = new SqlSessionFactoryBean();\n        factoryBean.setDataSource(dataSource);\n        factoryBean.setMapperLocations(\n            new PathMatchingResourcePatternResolver()\n                .getResources("classpath:mapper/secondary/*.xml"));\n        return factoryBean.getObject();\n    }\n    \n    @Bean\n    public DataSourceTransactionManager secondaryTransactionManager(\n            @Qualifier("secondaryDataSource") DataSource dataSource) {\n        return new DataSourceTransactionManager(dataSource);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u4f7f\u7528\u591a\u6570\u636e\u6e90",children:"\u4f7f\u7528\u591a\u6570\u636e\u6e90"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Service\npublic class UserService {\n    \n    @Autowired\n    private PrimaryUserMapper primaryUserMapper;  // \u4e3b\u5e93\n    \n    @Autowired\n    private SecondaryUserMapper secondaryUserMapper;  // \u4ece\u5e93\n    \n    // \u4f7f\u7528\u4e3b\u5e93\u4e8b\u52a1\n    @Transactional("primaryTransactionManager")\n    public void createUser(User user) {\n        primaryUserMapper.insert(user);\n    }\n    \n    // \u4f7f\u7528\u4ece\u5e93\u4e8b\u52a1\n    @Transactional("secondaryTransactionManager")\n    public User getUser(Long id) {\n        return secondaryUserMapper.selectById(id);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u52a8\u6001\u6570\u636e\u6e90",children:"\u52a8\u6001\u6570\u636e\u6e90"}),"\n",(0,i.jsx)(n.h3,{id:"\u52a8\u6001\u6570\u636e\u6e90\u5b9e\u73b0",children:"\u52a8\u6001\u6570\u636e\u6e90\u5b9e\u73b0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public class DynamicDataSource extends AbstractRoutingDataSource {\n    \n    @Override\n    protected Object determineCurrentLookupKey() {\n        return DataSourceContextHolder.getDataSource();\n    }\n}\n\npublic class DataSourceContextHolder {\n    \n    private static final ThreadLocal<String> CONTEXT = new ThreadLocal<>();\n    \n    public static void setDataSource(String dataSource) {\n        CONTEXT.set(dataSource);\n    }\n    \n    public static String getDataSource() {\n        return CONTEXT.get();\n    }\n    \n    public static void clear() {\n        CONTEXT.remove();\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u914d\u7f6e\u52a8\u6001\u6570\u636e\u6e90",children:"\u914d\u7f6e\u52a8\u6001\u6570\u636e\u6e90"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class DynamicDataSourceConfig {\n    \n    @Bean\n    public DataSource dynamicDataSource(\n            @Qualifier("primaryDataSource") DataSource primary,\n            @Qualifier("secondaryDataSource") DataSource secondary) {\n        \n        Map<Object, Object> targetDataSources = new HashMap<>();\n        targetDataSources.put("primary", primary);\n        targetDataSources.put("secondary", secondary);\n        \n        DynamicDataSource dynamicDataSource = new DynamicDataSource();\n        dynamicDataSource.setTargetDataSources(targetDataSources);\n        dynamicDataSource.setDefaultTargetDataSource(primary);\n        \n        return dynamicDataSource;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u4f7f\u7528\u6ce8\u89e3\u5207\u6362\u6570\u636e\u6e90",children:"\u4f7f\u7528\u6ce8\u89e3\u5207\u6362\u6570\u636e\u6e90"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Target({ElementType.METHOD, ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface DataSource {\n    String value() default "primary";\n}\n\n@Aspect\n@Component\npublic class DataSourceAspect {\n    \n    @Before("@annotation(dataSource)")\n    public void switchDataSource(JoinPoint point, DataSource dataSource) {\n        DataSourceContextHolder.setDataSource(dataSource.value());\n    }\n    \n    @After("@annotation(DataSource)")\n    public void clearDataSource(JoinPoint point) {\n        DataSourceContextHolder.clear();\n    }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Service\npublic class UserService {\n    \n    @DataSource("primary")\n    public void writeUser(User user) {\n        // \u4f7f\u7528\u4e3b\u5e93\n    }\n    \n    @DataSource("secondary")\n    public User readUser(Long id) {\n        // \u4f7f\u7528\u4ece\u5e93\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5b8c\u6574\u9879\u76ee\u793a\u4f8b",children:"\u5b8c\u6574\u9879\u76ee\u793a\u4f8b"}),"\n",(0,i.jsx)(n.h3,{id:"pomxml",children:"pom.xml"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 \n         http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n    \n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.2.0</version>\n    </parent>\n    \n    <groupId>com.example</groupId>\n    <artifactId>mybatis-demo</artifactId>\n    <version>1.0.0</version>\n    \n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.mybatis.spring.boot</groupId>\n            <artifactId>mybatis-spring-boot-starter</artifactId>\n            <version>3.0.3</version>\n        </dependency>\n        <dependency>\n            <groupId>com.mysql</groupId>\n            <artifactId>mysql-connector-j</artifactId>\n            <scope>runtime</scope>\n        </dependency>\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n    </dependencies>\n</project>\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u542f\u52a8\u7c7b",children:"\u542f\u52a8\u7c7b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@SpringBootApplication\n@MapperScan("com.example.mapper")\npublic class Application {\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u5b9e\u4f53\u7c7b",children:"\u5b9e\u4f53\u7c7b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Data\npublic class User implements Serializable {\n    private Long id;\n    private String name;\n    private String email;\n    private Integer age;\n    private Integer status;\n    private LocalDateTime createTime;\n    private LocalDateTime updateTime;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"mapper-\u63a5\u53e3-1",children:"Mapper \u63a5\u53e3"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Mapper\npublic interface UserMapper {\n    \n    User selectById(Long id);\n    \n    List<User> selectByCondition(UserQuery query);\n    \n    int insert(User user);\n    \n    int update(User user);\n    \n    int deleteById(Long id);\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"mapper-xml",children:"Mapper XML"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8" ?>\n<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"\n  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">\n<mapper namespace="com.example.mapper.UserMapper">\n    \n    <sql id="baseColumns">\n        id, name, email, age, status, create_time, update_time\n    </sql>\n    \n    <select id="selectById" resultType="User">\n        SELECT <include refid="baseColumns"/>\n        FROM user WHERE id = #{id}\n    </select>\n    \n    <select id="selectByCondition" resultType="User">\n        SELECT <include refid="baseColumns"/>\n        FROM user\n        <where>\n            <if test="name != null">AND name LIKE CONCAT(\'%\', #{name}, \'%\')</if>\n            <if test="status != null">AND status = #{status}</if>\n        </where>\n        ORDER BY create_time DESC\n    </select>\n    \n    <insert id="insert" useGeneratedKeys="true" keyProperty="id">\n        INSERT INTO user(name, email, age, status, create_time)\n        VALUES(#{name}, #{email}, #{age}, #{status}, NOW())\n    </insert>\n    \n    <update id="update">\n        UPDATE user\n        <set>\n            <if test="name != null">name = #{name},</if>\n            <if test="email != null">email = #{email},</if>\n            <if test="age != null">age = #{age},</if>\n            <if test="status != null">status = #{status},</if>\n            update_time = NOW()\n        </set>\n        WHERE id = #{id}\n    </update>\n    \n    <delete id="deleteById">\n        DELETE FROM user WHERE id = #{id}\n    </delete>\n    \n</mapper>\n'})}),"\n",(0,i.jsx)(n.h3,{id:"service-\u5c42",children:"Service \u5c42"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Service\n@Transactional(readOnly = true)\npublic class UserService {\n    \n    @Autowired\n    private UserMapper userMapper;\n    \n    public User getById(Long id) {\n        return userMapper.selectById(id);\n    }\n    \n    public List<User> search(UserQuery query) {\n        return userMapper.selectByCondition(query);\n    }\n    \n    @Transactional\n    public Long create(User user) {\n        userMapper.insert(user);\n        return user.getId();\n    }\n    \n    @Transactional\n    public void update(User user) {\n        userMapper.update(user);\n    }\n    \n    @Transactional\n    public void delete(Long id) {\n        userMapper.deleteById(id);\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u76f8\u5173\u94fe\u63a5",children:"\u76f8\u5173\u94fe\u63a5"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/mybatis/configuration",children:"\u914d\u7f6e\u8be6\u89e3"})," - MyBatis \u914d\u7f6e"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/mybatis/caching",children:"\u7f13\u5b58\u673a\u5236"})," - \u7f13\u5b58\u914d\u7f6e"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/mybatis/best-practices",children:"\u6700\u4f73\u5b9e\u8df5"})," - \u9879\u76ee\u6700\u4f73\u5b9e\u8df5"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/spring",children:"Spring Framework"})," - Spring \u6846\u67b6"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/springboot",children:"Spring Boot"})," - Spring Boot \u6846\u67b6"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u6700\u540e\u66f4\u65b0"}),": 2025 \u5e74 12 \u6708"]})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},48885:(e,n,a)=>{a.d(n,{R:()=>t,x:()=>c});var r=a(99378);const i={},s=r.createContext(i);function t(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);
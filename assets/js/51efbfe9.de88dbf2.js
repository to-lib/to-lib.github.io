"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[5946],{12809:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>o,contentTitle:()=>t,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>r});const l=JSON.parse('{"id":"linux/security","title":"\u7cfb\u7edf\u5b89\u5168","description":"\u7cfb\u7edf\u5b89\u5168\u662f Linux \u8fd0\u7ef4\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\uff0c\u5305\u62ec\u7528\u6237\u6743\u9650\u3001\u9632\u706b\u5899\u3001SELinux\u3001SSH \u52a0\u56fa\u7b49\u3002","source":"@site/docs/linux/security.md","sourceDirName":"linux","slug":"/linux/security","permalink":"/docs/linux/security","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/linux/security.md","tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"sidebar_position":14,"title":"\u7cfb\u7edf\u5b89\u5168"},"sidebar":"linux","previous":{"title":"\u7f51\u7edc\u914d\u7f6e","permalink":"/docs/linux/networking"},"next":{"title":"Shell \u811a\u672c","permalink":"/docs/linux/shell-scripting"}}');var a=s(22714),d=s(48885);const i={sidebar_position:14,title:"\u7cfb\u7edf\u5b89\u5168"},t="Linux \u7cfb\u7edf\u5b89\u5168",o={},r=[{value:"\u5b89\u5168\u57fa\u7840",id:"\u5b89\u5168\u57fa\u7840",level:2},{value:"\u5b89\u5168\u539f\u5219",id:"\u5b89\u5168\u539f\u5219",level:3},{value:"\u7528\u6237\u548c\u6743\u9650\u5b89\u5168",id:"\u7528\u6237\u548c\u6743\u9650\u5b89\u5168",level:2},{value:"\u5bc6\u7801\u7b56\u7565",id:"\u5bc6\u7801\u7b56\u7565",level:3},{value:"\u8d26\u6237\u5b89\u5168",id:"\u8d26\u6237\u5b89\u5168",level:3},{value:"SSH \u5b89\u5168\u52a0\u56fa",id:"ssh-\u5b89\u5168\u52a0\u56fa",level:2},{value:"SSH \u914d\u7f6e",id:"ssh-\u914d\u7f6e",level:3},{value:"SSH \u5bc6\u94a5\u8ba4\u8bc1",id:"ssh-\u5bc6\u94a5\u8ba4\u8bc1",level:3},{value:"SSH \u53cc\u56e0\u7d20\u8ba4\u8bc1",id:"ssh-\u53cc\u56e0\u7d20\u8ba4\u8bc1",level:3},{value:"\u9632\u706b\u5899",id:"\u9632\u706b\u5899",level:2},{value:"UFW\uff08Ubuntu\uff09",id:"ufwubuntu",level:3},{value:"firewalld\uff08CentOS/RHEL\uff09",id:"firewalldcentosrhel",level:3},{value:"iptables",id:"iptables",level:3},{value:"SELinux",id:"selinux",level:2},{value:"SELinux \u57fa\u7840",id:"selinux-\u57fa\u7840",level:3},{value:"SELinux \u4e0a\u4e0b\u6587",id:"selinux-\u4e0a\u4e0b\u6587",level:3},{value:"SELinux \u5e03\u5c14\u503c",id:"selinux-\u5e03\u5c14\u503c",level:3},{value:"AppArmor\uff08Ubuntu\uff09",id:"apparmorubuntu",level:2},{value:"\u5b89\u5168\u5ba1\u8ba1",id:"\u5b89\u5168\u5ba1\u8ba1",level:2},{value:"auditd",id:"auditd",level:3},{value:"\u6587\u4ef6\u5b8c\u6574\u6027\u68c0\u67e5",id:"\u6587\u4ef6\u5b8c\u6574\u6027\u68c0\u67e5",level:3},{value:"\u7f51\u7edc\u5b89\u5168",id:"\u7f51\u7edc\u5b89\u5168",level:2},{value:"Fail2ban",id:"fail2ban",level:3},{value:"\u7aef\u53e3\u626b\u63cf\u68c0\u6d4b",id:"\u7aef\u53e3\u626b\u63cf\u68c0\u6d4b",level:3},{value:"\u5b89\u5168\u626b\u63cf",id:"\u5b89\u5168\u626b\u63cf",level:2},{value:"\u6f0f\u6d1e\u626b\u63cf",id:"\u6f0f\u6d1e\u626b\u63cf",level:3},{value:"\u75c5\u6bd2\u626b\u63cf",id:"\u75c5\u6bd2\u626b\u63cf",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u5b9a\u671f\u66f4\u65b0",id:"1-\u5b9a\u671f\u66f4\u65b0",level:3},{value:"2. \u6700\u5c0f\u5316\u670d\u52a1",id:"2-\u6700\u5c0f\u5316\u670d\u52a1",level:3},{value:"3. \u76d1\u63a7\u65e5\u5fd7",id:"3-\u76d1\u63a7\u65e5\u5fd7",level:3},{value:"4. \u5907\u4efd",id:"4-\u5907\u4efd",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function u(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"linux-\u7cfb\u7edf\u5b89\u5168",children:"Linux \u7cfb\u7edf\u5b89\u5168"})}),"\n",(0,a.jsx)(e.p,{children:"\u7cfb\u7edf\u5b89\u5168\u662f Linux \u8fd0\u7ef4\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\uff0c\u5305\u62ec\u7528\u6237\u6743\u9650\u3001\u9632\u706b\u5899\u3001SELinux\u3001SSH \u52a0\u56fa\u7b49\u3002"}),"\n",(0,a.jsx)(e.h2,{id:"\u5b89\u5168\u57fa\u7840",children:"\u5b89\u5168\u57fa\u7840"}),"\n",(0,a.jsx)(e.h3,{id:"\u5b89\u5168\u539f\u5219",children:"\u5b89\u5168\u539f\u5219"}),"\n",(0,a.jsx)(e.mermaid,{value:"graph TD\n    A[\u6700\u5c0f\u6743\u9650\u539f\u5219] --\x3e B[\u7eb5\u6df1\u9632\u5fa1]\n    B --\x3e C[\u5b9a\u671f\u66f4\u65b0]\n    C --\x3e D[\u76d1\u63a7\u5ba1\u8ba1]\n    D --\x3e E[\u5907\u4efd\u6062\u590d]"}),"\n",(0,a.jsx)(e.h2,{id:"\u7528\u6237\u548c\u6743\u9650\u5b89\u5168",children:"\u7528\u6237\u548c\u6743\u9650\u5b89\u5168"}),"\n",(0,a.jsx)(e.h3,{id:"\u5bc6\u7801\u7b56\u7565",children:"\u5bc6\u7801\u7b56\u7565"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5\u5bc6\u7801\u8d28\u91cf\u68c0\u67e5\nsudo apt install libpam-pwquality\n\n# \u914d\u7f6e\u5bc6\u7801\u7b56\u7565\nsudo vim /etc/security/pwquality.conf\n\n# \u914d\u7f6e\u9879\nminlen = 12              # \u6700\u5c0f\u957f\u5ea6\ndcredit = -1             # \u81f3\u5c111\u4e2a\u6570\u5b57\nucredit = -1             # \u81f3\u5c111\u4e2a\u5927\u5199\u5b57\u6bcd\nlcredit = -1             # \u81f3\u5c111\u4e2a\u5c0f\u5199\u5b57\u6bcd\nocredit = -1             # \u81f3\u5c111\u4e2a\u7279\u6b8a\u5b57\u7b26\nminclass = 3             # \u81f3\u5c113\u79cd\u5b57\u7b26\u7c7b\u578b\nmaxrepeat = 3            # \u6700\u591a\u91cd\u590d\u5b57\u7b26\u6570\nmaxclassrepeat = 4       # \u540c\u7c7b\u5b57\u7b26\u6700\u5927\u8fde\u7eed\u6570\n\n# \u5bc6\u7801\u6709\u6548\u671f\nsudo chage -M 90 username    # \u6700\u957f90\u5929\nsudo chage -m 7 username     # \u6700\u77ed7\u5929\nsudo chage -W 14 username    # \u8fc7\u671f\u524d14\u5929\u8b66\u544a\n\n# \u5168\u5c40\u8bbe\u7f6e\nsudo vim /etc/login.defs\nPASS_MAX_DAYS   90\nPASS_MIN_DAYS   7\nPASS_WARN_AGE   14\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u8d26\u6237\u5b89\u5168",children:"\u8d26\u6237\u5b89\u5168"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u7981\u7528\u4e0d\u9700\u8981\u7684\u8d26\u6237\nsudo usermod -L username\nsudo passwd -l username\n\n# \u8bbe\u7f6e\u8d26\u6237\u8fc7\u671f\nsudo chage -E 2024-12-31 username\n\n# \u67e5\u627e\u65e0\u5bc6\u7801\u8d26\u6237\nsudo awk -F: '($2 == \"\") {print $1}' /etc/shadow\n\n# \u67e5\u627e UID \u4e3a 0 \u7684\u8d26\u6237\uff08\u9664\u4e86 root\uff09\nsudo awk -F: '($3 == 0) {print $1}' /etc/passwd\n\n# \u7981\u7528 root \u76f4\u63a5\u767b\u5f55\nsudo passwd -l root\n\n# \u7981\u6b62 root SSH \u767b\u5f55\nsudo vim /etc/ssh/sshd_config\nPermitRootLogin no\n"})}),"\n",(0,a.jsx)(e.h2,{id:"ssh-\u5b89\u5168\u52a0\u56fa",children:"SSH \u5b89\u5168\u52a0\u56fa"}),"\n",(0,a.jsx)(e.h3,{id:"ssh-\u914d\u7f6e",children:"SSH \u914d\u7f6e"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# SSH \u670d\u52a1\u5668\u914d\u7f6e\nsudo vim /etc/ssh/sshd_config\n\n# \u63a8\u8350\u914d\u7f6e\nPort 2222                          # \u4fee\u6539\u9ed8\u8ba4\u7aef\u53e3\nPermitRootLogin no                 # \u7981\u6b62 root \u767b\u5f55\nPasswordAuthentication no          # \u7981\u7528\u5bc6\u7801\u8ba4\u8bc1\nPubkeyAuthentication yes           # \u542f\u7528\u5bc6\u94a5\u8ba4\u8bc1\nPermitEmptyPasswords no            # \u7981\u6b62\u7a7a\u5bc6\u7801\nMaxAuthTries 3                     # \u6700\u5927\u8ba4\u8bc1\u5c1d\u8bd5\u6b21\u6570\nLoginGraceTime 60                  # \u767b\u5f55\u8d85\u65f6\u65f6\u95f4\nClientAliveInterval 300            # \u5ba2\u6237\u7aef\u5b58\u6d3b\u68c0\u6d4b\nClientAliveCountMax 2              # \u6700\u5927\u65e0\u54cd\u5e94\u6b21\u6570\nAllowUsers user1 user2             # \u5141\u8bb8\u7684\u7528\u6237\nDenyUsers baduser                  # \u62d2\u7edd\u7684\u7528\u6237\nX11Forwarding no                   # \u7981\u7528 X11 \u8f6c\u53d1\n\n# \u91cd\u542f SSH\nsudo systemctl restart sshd\n"})}),"\n",(0,a.jsx)(e.h3,{id:"ssh-\u5bc6\u94a5\u8ba4\u8bc1",children:"SSH \u5bc6\u94a5\u8ba4\u8bc1"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'# \u751f\u6210\u5bc6\u94a5\u5bf9\nssh-keygen -t ed25519 -C "comment"\nssh-keygen -t rsa -b 4096\n\n# \u590d\u5236\u516c\u94a5\u5230\u670d\u52a1\u5668\nssh-copy-id -i ~/.ssh/id_ed25519.pub user@server\nssh-copy-id -p 2222 user@server\n\n# \u624b\u52a8\u590d\u5236\ncat ~/.ssh/id_ed25519.pub | ssh user@server "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"\n\n# \u8bbe\u7f6e\u6b63\u786e\u6743\u9650\nchmod 700 ~/.ssh\nchmod 600 ~/.ssh/authorized_keys\n\n# \u670d\u52a1\u5668\u7aef\u6743\u9650\nchmod 700 ~/.ssh\nchmod 600 ~/.ssh/authorized_keys\nchmod 644 ~/.ssh/id_ed25519.pub\nchmod 600 ~/.ssh/id_ed25519\n'})}),"\n",(0,a.jsx)(e.h3,{id:"ssh-\u53cc\u56e0\u7d20\u8ba4\u8bc1",children:"SSH \u53cc\u56e0\u7d20\u8ba4\u8bc1"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5 Google Authenticator\nsudo apt install libpam-google-authenticator\n\n# \u914d\u7f6e\u7528\u6237\ngoogle-authenticator\n\n# \u914d\u7f6e PAM\nsudo vim /etc/pam.d/sshd\n# \u6dfb\u52a0\nauth required pam_google_authenticator.so\n\n# \u914d\u7f6e SSH\nsudo vim /etc/ssh/sshd_config\nChallengeResponseAuthentication yes\n\n# \u91cd\u542f SSH\nsudo systemctl restart sshd\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u9632\u706b\u5899",children:"\u9632\u706b\u5899"}),"\n",(0,a.jsx)(e.h3,{id:"ufwubuntu",children:"UFW\uff08Ubuntu\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u542f\u7528\u9632\u706b\u5899\nsudo ufw enable\n\n# \u9ed8\u8ba4\u7b56\u7565\nsudo ufw default deny incoming\nsudo ufw default allow outgoing\n\n# \u5141\u8bb8\u670d\u52a1\nsudo ufw allow ssh\nsudo ufw allow 22/tcp\nsudo ufw allow 80/tcp\nsudo ufw allow443/tcp\nsudo ufw allow 3306/tcp\n\n# \u5141\u8bb8\u7aef\u53e3\u8303\u56f4\nsudo ufw allow 6000:6007/tcp\n\n# \u5141\u8bb8\u7279\u5b9aIP\nsudo ufw allow from 192.168.1.100\n\n# \u5141\u8bb8\u7279\u5b9aIP\u8bbf\u95ee\u7279\u5b9a\u7aef\u53e3\nsudo ufw allow from 192.168.1.100 to any port 22\n\n# \u62d2\u7edd\nsudo ufw deny 23\n\n# \u5220\u9664\u89c4\u5219\nsudo ufw delete allow 80\n\n# \u67e5\u770b\u72b6\u6001\nsudo ufw status\nsudo ufw status numbered\n\n# \u7981\u7528\u9632\u706b\u5899\nsudo ufw disable\n"})}),"\n",(0,a.jsx)(e.h3,{id:"firewalldcentosrhel",children:"firewalld\uff08CentOS/RHEL\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'# \u542f\u52a8\u9632\u706b\u5899\nsudo systemctl start firewalld\nsudo systemctl enable firewalld\n\n# \u67e5\u770b\u72b6\u6001\nsudo firewall-cmd --state\n\n# \u67e5\u770b\u533a\u57df\nsudo firewall-cmd --get-default-zone\nsudo firewall-cmd --get-active-zones\n\n# \u6dfb\u52a0\u670d\u52a1\nsudo firewall-cmd --add-service=http --permanent\nsudo firewall-cmd --add-service=https --permanent\nsudo firewall-cmd --add-service=ssh --permanent\n\n# \u6dfb\u52a0\u7aef\u53e3\nsudo firewall-cmd --add-port=8080/tcp --permanent\nsudo firewall-cmd --add-port=3000-3010/tcp --permanent\n\n# \u6dfb\u52a0\u5bcc\u89c4\u5219\nsudo firewall-cmd --add-rich-rule=\'rule family="ipv4" source address="192.168.1.0/24" accept\' --permanent\n\n# \u91cd\u65b0\u52a0\u8f7d\nsudo firewall-cmd --reload\n\n# \u67e5\u770b\u89c4\u5219\nsudo firewall-cmd --list-all\n'})}),"\n",(0,a.jsx)(e.h3,{id:"iptables",children:"iptables"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u89c4\u5219\nsudo iptables -L -n -v\nsudo iptables -L INPUT -v\n\n# \u5141\u8bb8\u56de\u73af\u63a5\u53e3\nsudo iptables -A INPUT -i lo -j ACCEPT\n\n# \u5141\u8bb8\u5df2\u5efa\u7acb\u7684\u8fde\u63a5\nsudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n# \u5141\u8bb8 SSH\nsudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT\n\n# \u5141\u8bb8 HTTP/HTTPS\nsudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT\nsudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT\n\n# \u62d2\u7edd\u5176\u4ed6\nsudo iptables -A INPUT -j DROP\n\n# \u4fdd\u5b58\u89c4\u5219\nsudo iptables-save > /etc/iptables/rules.v4\nsudo apt install iptables-persistent\n\n# \u6062\u590d\u89c4\u5219\nsudo iptables-restore < /etc/iptables/rules.v4\n"})}),"\n",(0,a.jsx)(e.h2,{id:"selinux",children:"SELinux"}),"\n",(0,a.jsx)(e.h3,{id:"selinux-\u57fa\u7840",children:"SELinux \u57fa\u7840"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b SELinux \u72b6\u6001\nsestatus\ngetenforce\n\n# SELinux \u6a21\u5f0f\n# Enforcing: \u5f3a\u5236\u6a21\u5f0f\n# Permissive: \u5bbd\u677e\u6a21\u5f0f\uff08\u8bb0\u5f55\u4f46\u4e0d\u963b\u6b62\uff09\n# Disabled: \u7981\u7528\n\n# \u4e34\u65f6\u8bbe\u7f6e\u6a21\u5f0f\nsudo setenforce 0    # Permissive\nsudo setenforce 1    # Enforcing\n\n# \u6c38\u4e45\u8bbe\u7f6e\nsudo vim /etc/selinux/config\nSELINUX=enforcing\n# \u6216\nSELINUX=permissive\n# \u6216\nSELINUX=disabled\n"})}),"\n",(0,a.jsx)(e.h3,{id:"selinux-\u4e0a\u4e0b\u6587",children:"SELinux \u4e0a\u4e0b\u6587"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'# \u67e5\u770b\u6587\u4ef6\u4e0a\u4e0b\u6587\nls -Z file\nls -lZ /var/www/html\n\n# \u67e5\u770b\u8fdb\u7a0b\u4e0a\u4e0b\u6587\nps -eZ\n\n# \u6062\u590d\u9ed8\u8ba4\u4e0a\u4e0b\u6587\nsudo restorecon -Rv /var/www/html\n\n# \u4fee\u6539\u6587\u4ef6\u4e0a\u4e0b\u6587\nsudo chcon -t httpd_sys_content_t /var/www/html/file\n\n# \u6c38\u4e45\u4fee\u6539\nsudo semanage fcontext -a -t httpd_sys_content_t "/custom/path(/.*)?"\nsudo restorecon -Rv /custom/path\n'})}),"\n",(0,a.jsx)(e.h3,{id:"selinux-\u5e03\u5c14\u503c",children:"SELinux \u5e03\u5c14\u503c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u6240\u6709\u5e03\u5c14\u503c\ngetsebool -a\n\n# \u67e5\u770b\u7279\u5b9a\u5e03\u5c14\u503c\ngetsebool httpd_can_network_connect\n\n# \u8bbe\u7f6e\u5e03\u5c14\u503c\nsudo setsebool -P httpd_can_network_connect on\n"})}),"\n",(0,a.jsx)(e.h2,{id:"apparmorubuntu",children:"AppArmor\uff08Ubuntu\uff09"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u67e5\u770b\u72b6\u6001\nsudo aa-status\n\n# \u67e5\u770b\u914d\u7f6e\u6587\u4ef6\nls /etc/apparmor.d/\n\n# \u7981\u7528\u914d\u7f6e\nsudo aa-disable /etc/apparmor.d/usr.sbin.mysqld\n\n# \u542f\u7528\u914d\u7f6e\nsudo aa-enforce /etc/apparmor.d/usr.sbin.mysqld\n\n# \u8bbe\u7f6e\u4e3a\u5bbd\u677e\u6a21\u5f0f\nsudo aa-complain /etc/apparmor.d/usr.sbin.mysqld\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u5b89\u5168\u5ba1\u8ba1",children:"\u5b89\u5168\u5ba1\u8ba1"}),"\n",(0,a.jsx)(e.h3,{id:"auditd",children:"auditd"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5 auditd\nsudo apt install auditd\n\n# \u542f\u52a8\u670d\u52a1\nsudo systemctl start auditd\nsudo systemctl enable auditd\n\n# \u67e5\u770b\u5ba1\u8ba1\u89c4\u5219\nsudo auditctl -l\n\n# \u6dfb\u52a0\u89c4\u5219\nsudo auditctl -w /etc/passwd -p wa -k passwd_changes\nsudo auditctl -w /etc/shadow -p wa -k shadow_changes\nsudo auditctl -w /var/log/auth.log -p wa -k auth_log\n\n# \u6c38\u4e45\u89c4\u5219\nsudo vim /etc/audit/rules.d/audit.rules\n\n# \u67e5\u770b\u65e5\u5fd7\nsudo ausearch -k passwd_changes\nsudo ausearch -ts today -k shadow_changes\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u6587\u4ef6\u5b8c\u6574\u6027\u68c0\u67e5",children:"\u6587\u4ef6\u5b8c\u6574\u6027\u68c0\u67e5"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5 AIDE\nsudo apt install aide\n\n# \u521d\u59cb\u5316\u6570\u636e\u5e93\nsudo aideinit\n\n# \u79fb\u52a8\u6570\u636e\u5e93\nsudo mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db\n\n# \u68c0\u67e5\u6587\u4ef6\u5b8c\u6574\u6027\nsudo aide --check\n\n# \u66f4\u65b0\u6570\u636e\u5e93\nsudo aide --update\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u7f51\u7edc\u5b89\u5168",children:"\u7f51\u7edc\u5b89\u5168"}),"\n",(0,a.jsx)(e.h3,{id:"fail2ban",children:"Fail2ban"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5 Fail2ban\nsudo apt install fail2ban\n\n# \u914d\u7f6e\nsudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local\nsudo vim /etc/fail2ban/jail.local\n\n[DEFAULT]\nbantime = 3600           # \u5c01\u7981\u65f6\u95f4\uff08\u79d2\uff09\nfindtime = 600           # \u65f6\u95f4\u7a97\u53e3\nmaxretry = 5             # \u6700\u5927\u5c1d\u8bd5\u6b21\u6570\n\n[sshd]\nenabled = true\nport = 22\nlogpath = /var/log/auth.log\n\n# \u542f\u52a8\u670d\u52a1\nsudo systemctl start fail2ban\nsudo systemctl enable fail2ban\n\n# \u67e5\u770b\u72b6\u6001\nsudo fail2ban-client status\nsudo fail2ban-client status sshd\n\n# \u89e3\u5c01 IP\nsudo fail2ban-client set sshd unbanip 192.168.1.100\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u7aef\u53e3\u626b\u63cf\u68c0\u6d4b",children:"\u7aef\u53e3\u626b\u63cf\u68c0\u6d4b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5 portsentry\nsudo apt install portsentry\n\n# \u914d\u7f6e\nsudo vim /etc/portsentry/portsentry.conf\n\n# \u542f\u52a8\nsudo systemctl start portsentry\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u5b89\u5168\u626b\u63cf",children:"\u5b89\u5168\u626b\u63cf"}),"\n",(0,a.jsx)(e.h3,{id:"\u6f0f\u6d1e\u626b\u63cf",children:"\u6f0f\u6d1e\u626b\u63cf"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u4f7f\u7528 Lynis\nsudo apt install lynis\n\n# \u8fd0\u884c\u5ba1\u8ba1\nsudo lynis audit system\n\n# \u67e5\u770b\u62a5\u544a\ncat /var/log/lynis.log\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u75c5\u6bd2\u626b\u63cf",children:"\u75c5\u6bd2\u626b\u63cf"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5 ClamAV\nsudo apt install clamav clamav-daemon\n\n# \u66f4\u65b0\u75c5\u6bd2\u5e93\nsudo freshclam\n\n# \u626b\u63cf\nsudo clamscan -r /home\nsudo clamscan -r --infected --remove /path\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,a.jsx)(e.h3,{id:"1-\u5b9a\u671f\u66f4\u65b0",children:"1. \u5b9a\u671f\u66f4\u65b0"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u81ea\u52a8\u5b89\u5168\u66f4\u65b0\nsudo apt install unattended-upgrades\nsudo dpkg-reconfigure unattended-upgrades\n"})}),"\n",(0,a.jsx)(e.h3,{id:"2-\u6700\u5c0f\u5316\u670d\u52a1",children:"2. \u6700\u5c0f\u5316\u670d\u52a1"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u5217\u51fa\u8fd0\u884c\u7684\u670d\u52a1\nsystemctl list-units --type=service --state=running\n\n# \u7981\u7528\u4e0d\u9700\u8981\u7684\u670d\u52a1\nsudo systemctl disable service_name\nsudo systemctl stop service_name\n"})}),"\n",(0,a.jsx)(e.h3,{id:"3-\u76d1\u63a7\u65e5\u5fd7",children:"3. \u76d1\u63a7\u65e5\u5fd7"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'# \u76d1\u63a7\u8ba4\u8bc1\u5931\u8d25\nsudo grep "Failed password" /var/log/auth.log\n\n# \u76d1\u63a7 sudo \u4f7f\u7528\nsudo grep sudo /var/log/auth.log\n\n# \u4f7f\u7528 logwatch\nsudo apt install logwatch\nsudo logwatch --detail high --mailto admin@example.com --range today\n'})}),"\n",(0,a.jsx)(e.h3,{id:"4-\u5907\u4efd",children:"4. \u5907\u4efd"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u5b9a\u671f\u5907\u4efd\u5173\u952e\u914d\u7f6e\n/etc/passwd\n/etc/shadow\n/etc/group\n/etc/ssh/\n/etc/fstab\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,a.jsx)(e.p,{children:"\u672c\u6587\u4ecb\u7ecd\u4e86 Linux \u7cfb\u7edf\u5b89\u5168\uff1a"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u2705 \u7528\u6237\u548c\u6743\u9650\u5b89\u5168"}),"\n",(0,a.jsx)(e.li,{children:"\u2705 SSH \u5b89\u5168\u52a0\u56fa"}),"\n",(0,a.jsx)(e.li,{children:"\u2705 \u9632\u706b\u5899\u914d\u7f6e\uff08UFW\u3001firewalld\u3001iptables\uff09"}),"\n",(0,a.jsx)(e.li,{children:"\u2705 SELinux \u548c AppArmor"}),"\n",(0,a.jsx)(e.li,{children:"\u2705 \u5b89\u5168\u5ba1\u8ba1\u548c\u76d1\u63a7"}),"\n",(0,a.jsx)(e.li,{children:"\u2705 \u5165\u4fb5\u68c0\u6d4b\uff08Fail2ban\uff09"}),"\n"]}),"\n",(0,a.jsxs)(e.p,{children:["\u7ee7\u7eed\u5b66\u4e60 ",(0,a.jsx)(e.a,{href:"/docs/linux/performance-tuning",children:"\u6027\u80fd\u4f18\u5316"})," \u548c ",(0,a.jsx)(e.a,{href:"/docs/linux/troubleshooting",children:"\u6545\u969c\u6392\u67e5"}),"\u3002"]})]})}function c(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(u,{...n})}):u(n)}},48885:(n,e,s)=>{s.d(e,{R:()=>i,x:()=>t});var l=s(99378);const a={},d=l.createContext(a);function i(n){const e=l.useContext(d);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:i(n.components),l.createElement(d.Provider,{value:e},n.children)}}}]);
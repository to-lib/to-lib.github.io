"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[2932],{3934:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>t,toc:()=>p});const t=JSON.parse('{"id":"spring-ai/output-parsing","title":"\u8f93\u51fa\u89e3\u6790","description":"AI \u6a21\u578b\u901a\u5e38\u8fd4\u56de\u975e\u7ed3\u6784\u5316\u7684\u6587\u672c\u3002Spring AI \u7684\u8f93\u51fa\u89e3\u6790\u5668\uff08Output Parser\uff09\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u6587\u672c\u8f6c\u6362\u4e3a Java \u5bf9\u8c61\uff08POJO\uff09\uff0c\u4fbf\u4e8e\u7a0b\u5e8f\u5904\u7406\u3002","source":"@site/docs/spring-ai/output-parsing.md","sourceDirName":"spring-ai","slug":"/spring-ai/output-parsing","permalink":"/docs/spring-ai/output-parsing","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/spring-ai/output-parsing.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"\u8f93\u51fa\u89e3\u6790"},"sidebar":"springAi","previous":{"title":"Prompt \u5de5\u7a0b","permalink":"/docs/spring-ai/prompts"},"next":{"title":"API \u53c2\u8003","permalink":"/docs/spring-ai/api-reference"}}');var s=r(22714),a=r(48885);const i={sidebar_position:7,title:"\u8f93\u51fa\u89e3\u6790"},o="\u8f93\u51fa\u89e3\u6790",l={},p=[{value:"BeanOutputParser",id:"beanoutputparser",level:2},{value:"ListOutputParser",id:"listoutputparser",level:2},{value:"MapOutputParser",id:"mapoutputparser",level:2},{value:"\u590d\u6742\u5bf9\u8c61\u89e3\u6790",id:"\u590d\u6742\u5bf9\u8c61\u89e3\u6790",level:2},{value:"\u5d4c\u5957\u5bf9\u8c61",id:"\u5d4c\u5957\u5bf9\u8c61",level:3},{value:"\u4f7f\u7528 Jackson \u6ce8\u89e3",id:"\u4f7f\u7528-jackson-\u6ce8\u89e3",level:3},{value:"\u4f7f\u7528 Converter",id:"\u4f7f\u7528-converter",level:2},{value:"\u9519\u8bef\u5904\u7406",id:"\u9519\u8bef\u5904\u7406",level:2},{value:"\u91cd\u8bd5\u673a\u5236",id:"\u91cd\u8bd5\u673a\u5236",level:2},{value:"\u81ea\u5b9a\u4e49 OutputParser",id:"\u81ea\u5b9a\u4e49-outputparser",level:2},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u8f93\u51fa\u89e3\u6790",children:"\u8f93\u51fa\u89e3\u6790"})}),"\n",(0,s.jsx)(n.p,{children:"AI \u6a21\u578b\u901a\u5e38\u8fd4\u56de\u975e\u7ed3\u6784\u5316\u7684\u6587\u672c\u3002Spring AI \u7684\u8f93\u51fa\u89e3\u6790\u5668\uff08Output Parser\uff09\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u6587\u672c\u8f6c\u6362\u4e3a Java \u5bf9\u8c61\uff08POJO\uff09\uff0c\u4fbf\u4e8e\u7a0b\u5e8f\u5904\u7406\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"beanoutputparser",children:"BeanOutputParser"}),"\n",(0,s.jsx)(n.p,{children:"\u5c06 AI \u8f93\u51fa\u89e3\u6790\u4e3a Java Bean\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'public record BookRecommendation(\n    String title,\n    String author,\n    String genre,\n    String summary\n) {}\n\n@GetMapping("/recommend")\npublic BookRecommendation recommendBook(@RequestParam String topic) {\n    BeanOutputParser<BookRecommendation> parser = new BeanOutputParser<>(BookRecommendation.class);\n\n    String userMessage = String.format("""\n        \u63a8\u8350\u4e00\u672c\u5173\u4e8e %s \u7684\u4e66\u7c4d\u3002\n        %s\n        """, topic, parser.getFormat());\n\n    String response = chatClient.prompt()\n            .user(userMessage)\n            .call()\n            .content();\n\n    return parser.parse(response);\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"parser.getFormat()"})," \u4f1a\u751f\u6210 JSON Schema \u683c\u5f0f\u7684\u8bf4\u660e\uff0c\u544a\u8bc9 AI \u5982\u4f55\u683c\u5f0f\u5316\u8f93\u51fa\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"listoutputparser",children:"ListOutputParser"}),"\n",(0,s.jsx)(n.p,{children:"\u89e3\u6790\u5217\u8868\u8f93\u51fa\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@GetMapping("/ideas")\npublic List<String> generateIdeas(@RequestParam String topic) {\n    ListOutputParser parser = new ListOutputParser(new DefaultConversionService());\n\n    String userMessage = String.format("""\n        \u5217\u51fa 5 \u4e2a\u5173\u4e8e %s \u7684\u521b\u610f\u70b9\u5b50\u3002\n        %s\n        """, topic, parser.getFormat());\n\n    String response = chatClient.prompt()\n            .user(userMessage)\n            .call()\n            .content();\n\n    return parser.parse(response);\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"mapoutputparser",children:"MapOutputParser"}),"\n",(0,s.jsx)(n.p,{children:"\u89e3\u6790\u952e\u503c\u5bf9\u8f93\u51fa\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@GetMapping("/analyze")\npublic Map<String, Object> analyzeText(@RequestParam String text) {\n    MapOutputParser parser = new MapOutputParser();\n\n    String userMessage = String.format("""\n        \u5206\u6790\u4ee5\u4e0b\u6587\u672c\u5e76\u63d0\u4f9b\uff1a\n        - sentiment: \u60c5\u611f\u503e\u5411 (positive/negative/neutral)\n        - keywords: \u5173\u952e\u8bcd\u5217\u8868\n        - summary: \u4e00\u53e5\u8bdd\u6458\u8981\n\n        \u6587\u672c\uff1a%s\n\n        %s\n        """, text, parser.getFormat());\n\n    String response = chatClient.prompt()\n            .user(userMessage)\n            .call()\n            .content();\n\n    return parser.parse(response);\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u590d\u6742\u5bf9\u8c61\u89e3\u6790",children:"\u590d\u6742\u5bf9\u8c61\u89e3\u6790"}),"\n",(0,s.jsx)(n.h3,{id:"\u5d4c\u5957\u5bf9\u8c61",children:"\u5d4c\u5957\u5bf9\u8c61"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'public record TechArticle(\n    String title,\n    Author author,\n    List<String> tags,\n    Content content\n) {}\n\npublic record Author(String name, String email) {}\n\npublic record Content(String introduction, List<Section> sections) {}\n\npublic record Section(String heading, String body) {}\n\n@GetMapping("/article")\npublic TechArticle generateArticle(@RequestParam String topic) {\n    BeanOutputParser<TechArticle> parser = new BeanOutputParser<>(TechArticle.class);\n\n    String response = chatClient.prompt()\n            .system("\u4f60\u662f\u4e00\u4e2a\u6280\u672f\u535a\u5ba2\u4f5c\u8005")\n            .user("\u5199\u4e00\u7bc7\u5173\u4e8e " + topic + " \u7684\u6280\u672f\u6587\u7ae0\u3002" + parser.getFormat())\n            .call()\n            .content();\n\n    return parser.parse(response);\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-jackson-\u6ce8\u89e3",children:"\u4f7f\u7528 Jackson \u6ce8\u89e3"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'public record ApiResponse(\n    @JsonProperty("status_code") int statusCode,\n    @JsonProperty("error_message") String errorMessage,\n    @JsonProperty("data") ResponseData data\n) {}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u4f7f\u7528-converter",children:"\u4f7f\u7528 Converter"}),"\n",(0,s.jsx)(n.p,{children:"Spring AI \u96c6\u6210\u4e86 Spring \u7684 ConversionService\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@Configuration\npublic class ConverterConfig {\n\n    @Bean\n    public ConversionService conversionService() {\n        DefaultConversionService service = new DefaultConversionService();\n        service.addConverter(new StringToLocalDateConverter());\n        return service;\n    }\n}\n\npublic class StringToLocalDateConverter implements Converter<String, LocalDate> {\n    @Override\n    public LocalDate convert(String source) {\n        return LocalDate.parse(source, DateTimeFormatter.ISO_DATE);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"}),"\n",(0,s.jsx)(n.p,{children:"\u89e3\u6790\u53ef\u80fd\u5931\u8d25\uff0c\u9700\u8981\u59a5\u5584\u5904\u7406\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@GetMapping("/parse-safe")\npublic ResponseEntity<?> safeParseExample(@RequestParam String input) {\n    BeanOutputParser<MyDto> parser = new BeanOutputParser<>(MyDto.class);\n\n    try {\n        String response = chatClient.prompt()\n                .user(input + "\\n" + parser.getFormat())\n                .call()\n                .content();\n\n        MyDto result = parser.parse(response);\n        return ResponseEntity.ok(result);\n\n    } catch (JsonParseException e) {\n        // AI \u8fd4\u56de\u7684\u4e0d\u662f\u6709\u6548 JSON\n        return ResponseEntity.badRequest()\n                .body(Map.of("error", "AI \u54cd\u5e94\u683c\u5f0f\u9519\u8bef", "details", e.getMessage()));\n    } catch (Exception e) {\n        return ResponseEntity.internalServerError()\n                .body(Map.of("error", "\u89e3\u6790\u5931\u8d25", "details", e.getMessage()));\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u91cd\u8bd5\u673a\u5236",children:"\u91cd\u8bd5\u673a\u5236"}),"\n",(0,s.jsx)(n.p,{children:"\u5f53\u89e3\u6790\u5931\u8d25\u65f6\u81ea\u52a8\u91cd\u8bd5\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Service\npublic class RobustParsingService {\n\n    private final ChatClient chatClient;\n\n    @Retryable(\n        value = JsonParseException.class,\n        maxAttempts = 3,\n        backoff = @Backoff(delay = 1000)\n    )\n    public <T> T parseWithRetry(String prompt, Class<T> targetClass) {\n        BeanOutputParser<T> parser = new BeanOutputParser<>(targetClass);\n\n        String response = chatClient.prompt()\n                .user(prompt + "\\n\u8bf7\u4e25\u683c\u6309\u7167\u4ee5\u4e0b JSON \u683c\u5f0f\u8f93\u51fa\uff1a\\n" + parser.getFormat())\n                .call()\n                .content();\n\n        return parser.parse(response);\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u81ea\u5b9a\u4e49-outputparser",children:"\u81ea\u5b9a\u4e49 OutputParser"}),"\n",(0,s.jsxs)(n.p,{children:["\u5b9e\u73b0 ",(0,s.jsx)(n.code,{children:"OutputParser"})," \u63a5\u53e3\u521b\u5efa\u81ea\u5b9a\u4e49\u89e3\u6790\u5668\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'public class MarkdownTableParser implements OutputParser<List<Map<String, String>>> {\n\n    @Override\n    public List<Map<String, String>> parse(String text) {\n        List<Map<String, String>> result = new ArrayList<>();\n        String[] lines = text.split("\\n");\n        String[] headers = null;\n\n        for (String line : lines) {\n            if (line.startsWith("|") && line.endsWith("|")) {\n                String[] cells = line.substring(1, line.length() - 1).split("\\\\|");\n                if (headers == null) {\n                    headers = Arrays.stream(cells).map(String::trim).toArray(String[]::new);\n                } else if (!line.contains("---")) {\n                    Map<String, String> row = new HashMap<>();\n                    for (int i = 0; i < headers.length && i < cells.length; i++) {\n                        row.put(headers[i], cells[i].trim());\n                    }\n                    result.add(row);\n                }\n            }\n        }\n        return result;\n    }\n\n    @Override\n    public String getFormat() {\n        return "\u8bf7\u4ee5 Markdown \u8868\u683c\u683c\u5f0f\u8f93\u51fa\uff0c\u5305\u542b\u8868\u5934\u548c\u6570\u636e\u884c\u3002";\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./rag",children:"RAG \u5e94\u7528"})," - \u6784\u5efa\u68c0\u7d22\u589e\u5f3a\u751f\u6210\u5e94\u7528"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./chat-client",children:"ChatClient \u8be6\u89e3"})," - \u6df1\u5165\u4e86\u89e3 ChatClient \u7684\u9ad8\u7ea7\u7528\u6cd5"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},48885:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var t=r(99378);const s={},a=t.createContext(s);function i(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);
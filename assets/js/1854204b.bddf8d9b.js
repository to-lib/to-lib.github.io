"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[3955],{7933:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>o,frontMatter:()=>d,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"redis/pubsub","title":"\u53d1\u5e03\u8ba2\u9605","description":"Redis \u53d1\u5e03\u8ba2\u9605\uff08Pub/Sub\uff09\u662f\u4e00\u79cd\u6d88\u606f\u901a\u4fe1\u6a21\u5f0f\uff0c\u5141\u8bb8\u53d1\u9001\u8005\uff08pub\uff09\u53d1\u9001\u6d88\u606f\uff0c\u8ba2\u9605\u8005\uff08sub\uff09\u63a5\u6536\u6d88\u606f\u3002","source":"@site/docs/redis/pubsub.md","sourceDirName":"redis","slug":"/redis/pubsub","permalink":"/docs/redis/pubsub","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/redis/pubsub.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"\u53d1\u5e03\u8ba2\u9605"},"sidebar":"redis","previous":{"title":"Redis \u4e8b\u52a1","permalink":"/docs/redis/transactions"},"next":{"title":"Stream \u6570\u636e\u6d41","permalink":"/docs/redis/streams"}}');var l=s(22714),r=s(48885);const d={sidebar_position:8,title:"\u53d1\u5e03\u8ba2\u9605"},c="Redis \u53d1\u5e03\u8ba2\u9605",a={},h=[{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5",level:2},{value:"\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f",id:"\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f",level:3},{value:"\u57fa\u672c\u547d\u4ee4",id:"\u57fa\u672c\u547d\u4ee4",level:2},{value:"SUBSCRIBE - \u8ba2\u9605\u9891\u9053",id:"subscribe---\u8ba2\u9605\u9891\u9053",level:3},{value:"PUBLISH - \u53d1\u5e03\u6d88\u606f",id:"publish---\u53d1\u5e03\u6d88\u606f",level:3},{value:"UNSUBSCRIBE - \u53d6\u6d88\u8ba2\u9605",id:"unsubscribe---\u53d6\u6d88\u8ba2\u9605",level:3},{value:"\u6a21\u5f0f\u8ba2\u9605",id:"\u6a21\u5f0f\u8ba2\u9605",level:2},{value:"PSUBSCRIBE - \u6a21\u5f0f\u8ba2\u9605",id:"psubscribe---\u6a21\u5f0f\u8ba2\u9605",level:3},{value:"PUNSUBSCRIBE - \u53d6\u6d88\u6a21\u5f0f\u8ba2\u9605",id:"punsubscribe---\u53d6\u6d88\u6a21\u5f0f\u8ba2\u9605",level:3},{value:"\u5b9e\u6218\u793a\u4f8b",id:"\u5b9e\u6218\u793a\u4f8b",level:2},{value:"\u793a\u4f8b 1: \u804a\u5929\u5ba4",id:"\u793a\u4f8b-1-\u804a\u5929\u5ba4",level:3},{value:"\u793a\u4f8b 2: \u65b0\u95fb\u5206\u7c7b",id:"\u793a\u4f8b-2-\u65b0\u95fb\u5206\u7c7b",level:3},{value:"\u793a\u4f8b 3: \u65e5\u5fd7\u6536\u96c6",id:"\u793a\u4f8b-3-\u65e5\u5fd7\u6536\u96c6",level:3},{value:"Java \u5b9e\u73b0",id:"java-\u5b9e\u73b0",level:2},{value:"\u8ba2\u9605\u8005",id:"\u8ba2\u9605\u8005",level:3},{value:"\u53d1\u5e03\u8005",id:"\u53d1\u5e03\u8005",level:3},{value:"Spring Boot \u96c6\u6210",id:"spring-boot-\u96c6\u6210",level:3},{value:"\u5e94\u7528\u573a\u666f",id:"\u5e94\u7528\u573a\u666f",level:2},{value:"1. \u5b9e\u65f6\u901a\u77e5",id:"1-\u5b9e\u65f6\u901a\u77e5",level:3},{value:"2. \u6d88\u606f\u63a8\u9001",id:"2-\u6d88\u606f\u63a8\u9001",level:3},{value:"3. \u65e5\u5fd7\u6536\u96c6",id:"3-\u65e5\u5fd7\u6536\u96c6",level:3},{value:"4. \u5206\u5e03\u5f0f\u4e8b\u4ef6\u901a\u77e5",id:"4-\u5206\u5e03\u5f0f\u4e8b\u4ef6\u901a\u77e5",level:3},{value:"Pub/Sub vs Stream",id:"pubsub-vs-stream",level:2},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"1. \u6d88\u606f\u4e0d\u6301\u4e45\u5316",id:"1-\u6d88\u606f\u4e0d\u6301\u4e45\u5316",level:3},{value:"2. \u8ba2\u9605\u662f\u963b\u585e\u64cd\u4f5c",id:"2-\u8ba2\u9605\u662f\u963b\u585e\u64cd\u4f5c",level:3},{value:"3. \u7f51\u7edc\u95ee\u9898\u5bfc\u81f4\u6d88\u606f\u4e22\u5931",id:"3-\u7f51\u7edc\u95ee\u9898\u5bfc\u81f4\u6d88\u606f\u4e22\u5931",level:3},{value:"4. \u65e0\u6d88\u606f\u786e\u8ba4\u673a\u5236",id:"4-\u65e0\u6d88\u606f\u786e\u8ba4\u673a\u5236",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:2},{value:"1. \u4f7f\u7528\u6a21\u5f0f\u8ba2\u9605\u8981\u8c28\u614e",id:"1-\u4f7f\u7528\u6a21\u5f0f\u8ba2\u9605\u8981\u8c28\u614e",level:3},{value:"2. \u63a7\u5236\u8ba2\u9605\u6570\u91cf",id:"2-\u63a7\u5236\u8ba2\u9605\u6570\u91cf",level:3},{value:"3. \u5408\u7406\u8bbe\u7f6e\u8d85\u65f6",id:"3-\u5408\u7406\u8bbe\u7f6e\u8d85\u65f6",level:3},{value:"\u76d1\u63a7\u547d\u4ee4",id:"\u76d1\u63a7\u547d\u4ee4",level:2},{value:"PUBSUB CHANNELS",id:"pubsub-channels",level:3},{value:"PUBSUB NUMSUB",id:"pubsub-numsub",level:3},{value:"PUBSUB NUMPAT",id:"pubsub-numpat",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u9891\u9053\u547d\u540d\u89c4\u8303",id:"1-\u9891\u9053\u547d\u540d\u89c4\u8303",level:3},{value:"2. \u6d88\u606f\u683c\u5f0f\u5316",id:"2-\u6d88\u606f\u683c\u5f0f\u5316",level:3},{value:"3. \u5f02\u5e38\u5904\u7406",id:"3-\u5f02\u5e38\u5904\u7406",level:3},{value:"4. \u4f18\u96c5\u5173\u95ed",id:"4-\u4f18\u96c5\u5173\u95ed",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function t(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"redis-\u53d1\u5e03\u8ba2\u9605",children:"Redis \u53d1\u5e03\u8ba2\u9605"})}),"\n",(0,l.jsx)(n.p,{children:"Redis \u53d1\u5e03\u8ba2\u9605\uff08Pub/Sub\uff09\u662f\u4e00\u79cd\u6d88\u606f\u901a\u4fe1\u6a21\u5f0f\uff0c\u5141\u8bb8\u53d1\u9001\u8005\uff08pub\uff09\u53d1\u9001\u6d88\u606f\uff0c\u8ba2\u9605\u8005\uff08sub\uff09\u63a5\u6536\u6d88\u606f\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"\u57fa\u672c\u6982\u5ff5",children:"\u57fa\u672c\u6982\u5ff5"}),"\n",(0,l.jsx)(n.h3,{id:"\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f",children:"\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f"}),"\n",(0,l.jsx)(n.p,{children:"\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\u5305\u542b\u4e09\u4e2a\u89d2\u8272\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u53d1\u5e03\u8005\uff08Publisher\uff09"})," - \u53d1\u9001\u6d88\u606f\u5230\u9891\u9053"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u8ba2\u9605\u8005\uff08Subscriber\uff09"})," - \u8ba2\u9605\u9891\u9053\u63a5\u6536\u6d88\u606f"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u9891\u9053\uff08Channel\uff09"})," - \u6d88\u606f\u4f20\u8f93\u7684\u901a\u9053"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7279\u70b9\uff1a"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u53d1\u5e03\u8005\u548c\u8ba2\u9605\u8005\u89e3\u8026"}),"\n",(0,l.jsx)(n.li,{children:"\u4e00\u4e2a\u6d88\u606f\u53ef\u4ee5\u88ab\u591a\u4e2a\u8ba2\u9605\u8005\u63a5\u6536"}),"\n",(0,l.jsx)(n.li,{children:"\u8ba2\u9605\u8005\u53ea\u80fd\u6536\u5230\u8ba2\u9605\u540e\u53d1\u5e03\u7684\u6d88\u606f"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u57fa\u672c\u547d\u4ee4",children:"\u57fa\u672c\u547d\u4ee4"}),"\n",(0,l.jsx)(n.h3,{id:"subscribe---\u8ba2\u9605\u9891\u9053",children:"SUBSCRIBE - \u8ba2\u9605\u9891\u9053"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u8ba2\u9605\u4e00\u4e2a\u6216\u591a\u4e2a\u9891\u9053\nSUBSCRIBE channel1 channel2 channel3\n"})}),"\n",(0,l.jsx)(n.h3,{id:"publish---\u53d1\u5e03\u6d88\u606f",children:"PUBLISH - \u53d1\u5e03\u6d88\u606f"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u5411\u9891\u9053\u53d1\u5e03\u6d88\u606f\nPUBLISH channel1 "Hello World"\n\n# \u8fd4\u56de\u503c\uff1a\u63a5\u6536\u5230\u6d88\u606f\u7684\u8ba2\u9605\u8005\u6570\u91cf\n'})}),"\n",(0,l.jsx)(n.h3,{id:"unsubscribe---\u53d6\u6d88\u8ba2\u9605",children:"UNSUBSCRIBE - \u53d6\u6d88\u8ba2\u9605"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u53d6\u6d88\u8ba2\u9605\u6307\u5b9a\u9891\u9053\nUNSUBSCRIBE channel1\n\n# \u53d6\u6d88\u6240\u6709\u8ba2\u9605\nUNSUBSCRIBE\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u6a21\u5f0f\u8ba2\u9605",children:"\u6a21\u5f0f\u8ba2\u9605"}),"\n",(0,l.jsx)(n.h3,{id:"psubscribe---\u6a21\u5f0f\u8ba2\u9605",children:"PSUBSCRIBE - \u6a21\u5f0f\u8ba2\u9605"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u4f7f\u7528\u901a\u914d\u7b26\u8ba2\u9605\u591a\u4e2a\u9891\u9053\nPSUBSCRIBE news.*\n\n# \u5339\u914d\u89c4\u5219\n# * \u5339\u914d\u4efb\u610f\u5b57\u7b26\n# ? \u5339\u914d\u5355\u4e2a\u5b57\u7b26\n# [abc] \u5339\u914d\u62ec\u53f7\u5185\u4efb\u4e00\u5b57\u7b26\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u8ba2\u9605\u6240\u6709 news \u5f00\u5934\u7684\u9891\u9053\nPSUBSCRIBE news.*\n\n# \u5339\u914d\uff1anews.sports, news.tech, news.finance\n"})}),"\n",(0,l.jsx)(n.h3,{id:"punsubscribe---\u53d6\u6d88\u6a21\u5f0f\u8ba2\u9605",children:"PUNSUBSCRIBE - \u53d6\u6d88\u6a21\u5f0f\u8ba2\u9605"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u53d6\u6d88\u6a21\u5f0f\u8ba2\u9605\nPUNSUBSCRIBE news.*\n\n# \u53d6\u6d88\u6240\u6709\u6a21\u5f0f\u8ba2\u9605\nPUNSUBSCRIBE\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u5b9e\u6218\u793a\u4f8b",children:"\u5b9e\u6218\u793a\u4f8b"}),"\n",(0,l.jsx)(n.h3,{id:"\u793a\u4f8b-1-\u804a\u5929\u5ba4",children:"\u793a\u4f8b 1: \u804a\u5929\u5ba4"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u8ba2\u9605\u8005\uff08\u5ba2\u6237\u7aef 1\uff09\uff1a"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'redis-cli\n127.0.0.1:6379> SUBSCRIBE chatroom\n\n# \u8f93\u51fa\nReading messages... (press Ctrl-C to quit)\n1) "subscribe"\n2) "chatroom"\n3) (integer) 1\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u53d1\u5e03\u8005\uff08\u5ba2\u6237\u7aef 2\uff09\uff1a"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'redis-cli\n127.0.0.1:6379> PUBLISH chatroom "Alice: Hello everyone!"\n(integer) 1\n\n127.0.0.1:6379> PUBLISH chatroom "Bob: Hi Alice!"\n(integer) 1\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u8ba2\u9605\u8005\u63a5\u6536\uff1a"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'1) "message"\n2) "chatroom"\n3) "Alice: Hello everyone!"\n\n1) "message"\n2) "chatroom"\n3) "Bob: Hi Alice!"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u793a\u4f8b-2-\u65b0\u95fb\u5206\u7c7b",children:"\u793a\u4f8b 2: \u65b0\u95fb\u5206\u7c7b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u8ba2\u9605\u4f53\u80b2\u65b0\u95fb\nSUBSCRIBE news.sports\n\n# \u8ba2\u9605\u79d1\u6280\u65b0\u95fb\nSUBSCRIBE news.tech\n\n# \u53d1\u5e03\u4f53\u80b2\u65b0\u95fb\nPUBLISH news.sports "Lakers won the championship!"\n\n# \u53d1\u5e03\u79d1\u6280\u65b0\u95fb\nPUBLISH news.tech "New iPhone released!"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u793a\u4f8b-3-\u65e5\u5fd7\u6536\u96c6",children:"\u793a\u4f8b 3: \u65e5\u5fd7\u6536\u96c6"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u8ba2\u9605\u6240\u6709\u65e5\u5fd7\nPSUBSCRIBE log.*\n\n# \u53d1\u5e03\u4e0d\u540c\u7ea7\u522b\u65e5\u5fd7\nPUBLISH log.error "Database connection failed"\nPUBLISH log.warning "High memory usage detected"\nPUBLISH log.info "User login successful"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"java-\u5b9e\u73b0",children:"Java \u5b9e\u73b0"}),"\n",(0,l.jsx)(n.h3,{id:"\u8ba2\u9605\u8005",children:"\u8ba2\u9605\u8005"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'import redis.clients.jedis.Jedis;\nimport redis.clients.jedis.JedisPubSub;\n\npublic class RedisSubscriber {\n    public static void main(String[] args) {\n        Jedis jedis = new Jedis("localhost", 6379);\n\n        // \u521b\u5efa\u8ba2\u9605\u76d1\u542c\u5668\n        JedisPubSub jedisPubSub = new JedisPubSub() {\n            @Override\n            public void onMessage(String channel, String message) {\n                System.out.println("\u6536\u5230\u6d88\u606f\uff1a" + channel + " -> " + message);\n            }\n\n            @Override\n            public void onSubscribe(String channel, int subscribedChannels) {\n                System.out.println("\u8ba2\u9605\u9891\u9053\uff1a" + channel);\n            }\n\n            @Override\n            public void onUnsubscribe(String channel, int subscribedChannels) {\n                System.out.println("\u53d6\u6d88\u8ba2\u9605\uff1a" + channel);\n            }\n        };\n\n        // \u8ba2\u9605\u9891\u9053\uff08\u963b\u585e\uff09\n        jedis.subscribe(jedisPubSub, "news", "sports");\n    }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u53d1\u5e03\u8005",children:"\u53d1\u5e03\u8005"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'import redis.clients.jedis.Jedis;\n\npublic class RedisPublisher {\n    public static void main(String[] args) {\n        Jedis jedis = new Jedis("localhost", 6379);\n\n        // \u53d1\u5e03\u6d88\u606f\n        Long receivers = jedis.publish("news", "Breaking news!");\n        System.out.println("\u6d88\u606f\u53d1\u9001\u7ed9 " + receivers + " \u4e2a\u8ba2\u9605\u8005");\n\n        jedis.close();\n    }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"spring-boot-\u96c6\u6210",children:"Spring Boot \u96c6\u6210"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class RedisConfig {\n\n    @Bean\n    RedisMessageListenerContainer container(\n            RedisConnectionFactory connectionFactory,\n            MessageListenerAdapter listenerAdapter) {\n\n        RedisMessageListenerContainer container =\n            new RedisMessageListenerContainer();\n        container.setConnectionFactory(connectionFactory);\n\n        // \u8ba2\u9605\u9891\u9053\n        container.addMessageListener(\n            listenerAdapter,\n            new PatternTopic("news.*")\n        );\n\n        return container;\n    }\n\n    @Bean\n    MessageListenerAdapter listenerAdapter(RedisMessageListener receiver) {\n        return new MessageListenerAdapter(receiver, "receiveMessage");\n    }\n}\n\n@Component\npublic class RedisMessageListener {\n\n    public void receiveMessage(String message) {\n        System.out.println("\u63a5\u6536\u5230\u6d88\u606f\uff1a" + message);\n    }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u5e94\u7528\u573a\u666f",children:"\u5e94\u7528\u573a\u666f"}),"\n",(0,l.jsx)(n.h3,{id:"1-\u5b9e\u65f6\u901a\u77e5",children:"1. \u5b9e\u65f6\u901a\u77e5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u7528\u6237\u5173\u6ce8\u901a\u77e5\nPUBLISH user:1001:notifications "\u65b0\u7684\u5173\u6ce8\u8005\uff1auser:2002"\n\n# \u7cfb\u7edf\u901a\u77e5\nPUBLISH system:announcements "\u7cfb\u7edf\u5c06\u4e8e\u4eca\u665a 23:00 \u7ef4\u62a4"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"2-\u6d88\u606f\u63a8\u9001",children:"2. \u6d88\u606f\u63a8\u9001"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u63a8\u9001\u8ba2\u5355\u72b6\u6001\u66f4\u65b0\nPUBLISH order:updates "\u8ba2\u5355 #12345 \u5df2\u53d1\u8d27"\n\n# \u63a8\u9001\u5e93\u5b58\u53d8\u5316\nPUBLISH inventory:changes "\u5546\u54c1 SKU-001 \u5e93\u5b58\u4e0d\u8db3"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"3-\u65e5\u5fd7\u6536\u96c6",children:"3. \u65e5\u5fd7\u6536\u96c6"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u5e94\u7528\u65e5\u5fd7\nPUBLISH log:app:error "NullPointerException at line 123"\nPUBLISH log:app:info "Application started successfully"\n\n# \u8bbf\u95ee\u65e5\u5fd7\nPUBLISH log:access "GET /api/users - 200 OK"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"4-\u5206\u5e03\u5f0f\u4e8b\u4ef6\u901a\u77e5",children:"4. \u5206\u5e03\u5f0f\u4e8b\u4ef6\u901a\u77e5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u7f13\u5b58\u5931\u6548\u901a\u77e5\nPUBLISH cache:invalidate "user:1001"\n\n# \u914d\u7f6e\u66f4\u65b0\u901a\u77e5\nPUBLISH config:update "database.pool.size=20"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"pubsub-vs-stream",children:"Pub/Sub vs Stream"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u7279\u6027"}),(0,l.jsx)(n.th,{children:"Pub/Sub"}),(0,l.jsx)(n.th,{children:"Stream"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u6d88\u606f\u6301\u4e45\u5316"}),(0,l.jsx)(n.td,{children:"\u274c \u4e0d\u6301\u4e45\u5316"}),(0,l.jsx)(n.td,{children:"\u2705 \u6301\u4e45\u5316"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u5386\u53f2\u6d88\u606f"}),(0,l.jsx)(n.td,{children:"\u274c \u65e0\u6cd5\u83b7\u53d6"}),(0,l.jsx)(n.td,{children:"\u2705 \u53ef\u83b7\u53d6"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u6d88\u8d39\u7ec4"}),(0,l.jsx)(n.td,{children:"\u274c \u4e0d\u652f\u6301"}),(0,l.jsx)(n.td,{children:"\u2705 \u652f\u6301"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u6d88\u606f\u786e\u8ba4"}),(0,l.jsx)(n.td,{children:"\u274c \u65e0"}),(0,l.jsx)(n.td,{children:"\u2705 \u652f\u6301 ACK"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u9002\u7528\u573a\u666f"}),(0,l.jsx)(n.td,{children:"\u5b9e\u65f6\u901a\u77e5\u3001\u5e7f\u64ad"}),(0,l.jsx)(n.td,{children:"\u6d88\u606f\u961f\u5217\u3001\u65e5\u5fd7\u6d41"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,l.jsx)(n.h3,{id:"1-\u6d88\u606f\u4e0d\u6301\u4e45\u5316",children:"1. \u6d88\u606f\u4e0d\u6301\u4e45\u5316"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u8ba2\u9605\u524d\u53d1\u7684\u6d88\u606f\u6536\u4e0d\u5230\nPUBLISH channel1 "message1"  # \u6b64\u65f6\u65e0\u8ba2\u9605\u8005\n\nSUBSCRIBE channel1  # \u73b0\u5728\u8ba2\u9605\n# \u6536\u4e0d\u5230 message1\n'})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u89e3\u51b3\u65b9\u6848\uff1a"})," \u4f7f\u7528 Stream \u6216\u5176\u4ed6\u6d88\u606f\u961f\u5217"]}),"\n",(0,l.jsx)(n.h3,{id:"2-\u8ba2\u9605\u662f\u963b\u585e\u64cd\u4f5c",children:"2. \u8ba2\u9605\u662f\u963b\u585e\u64cd\u4f5c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'// \u6b64\u64cd\u4f5c\u4f1a\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\njedis.subscribe(jedisPubSub, "channel1");\n\n// \u540e\u7eed\u4ee3\u7801\u4e0d\u4f1a\u6267\u884c\nSystem.out.println("This won\'t print");\n'})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u89e3\u51b3\u65b9\u6848\uff1a"})," \u5728\u5355\u72ec\u7ebf\u7a0b\u4e2d\u8ba2\u9605"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'new Thread(() -> {\n    jedis.subscribe(jedisPubSub, "channel1");\n}).start();\n'})}),"\n",(0,l.jsx)(n.h3,{id:"3-\u7f51\u7edc\u95ee\u9898\u5bfc\u81f4\u6d88\u606f\u4e22\u5931",children:"3. \u7f51\u7edc\u95ee\u9898\u5bfc\u81f4\u6d88\u606f\u4e22\u5931"}),"\n",(0,l.jsx)(n.p,{children:"\u8ba2\u9605\u8005\u65ad\u5f00\u8fde\u63a5\u671f\u95f4\u7684\u6d88\u606f\u4f1a\u4e22\u5931\u3002"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u89e3\u51b3\u65b9\u6848\uff1a"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4f7f\u7528\u5fc3\u8df3\u68c0\u6d4b"}),"\n",(0,l.jsx)(n.li,{children:"\u5b9e\u73b0\u91cd\u8fde\u673a\u5236"}),"\n",(0,l.jsx)(n.li,{children:"\u8003\u8651\u4f7f\u7528 Stream"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"4-\u65e0\u6d88\u606f\u786e\u8ba4\u673a\u5236",children:"4. \u65e0\u6d88\u606f\u786e\u8ba4\u673a\u5236"}),"\n",(0,l.jsx)(n.p,{children:"\u53d1\u5e03\u8005\u4e0d\u77e5\u9053\u6d88\u606f\u662f\u5426\u88ab\u6210\u529f\u63a5\u6536\u3002"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u89e3\u51b3\u65b9\u6848\uff1a"})," \u4f7f\u7528 Stream \u7684 ACK \u673a\u5236"]}),"\n",(0,l.jsx)(n.h2,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,l.jsx)(n.h3,{id:"1-\u4f7f\u7528\u6a21\u5f0f\u8ba2\u9605\u8981\u8c28\u614e",children:"1. \u4f7f\u7528\u6a21\u5f0f\u8ba2\u9605\u8981\u8c28\u614e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u907f\u514d\u8fc7\u4e8e\u5bbd\u6cdb\u7684\u6a21\u5f0f\nPSUBSCRIBE *  # \u4e0d\u63a8\u8350\uff0c\u5339\u914d\u6240\u6709\u9891\u9053\n\n# \u4f7f\u7528\u66f4\u5177\u4f53\u7684\u6a21\u5f0f\nPSUBSCRIBE news:tech:*  # \u63a8\u8350\n"})}),"\n",(0,l.jsx)(n.h3,{id:"2-\u63a7\u5236\u8ba2\u9605\u6570\u91cf",children:"2. \u63a7\u5236\u8ba2\u9605\u6570\u91cf"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'// \u4e0d\u8981\u8ba2\u9605\u8fc7\u591a\u9891\u9053\n// \u6bcf\u4e2a\u8ba2\u9605\u90fd\u4f1a\u6d88\u8017\u8d44\u6e90\njedis.subscribe(jedisPubSub,\n    "ch1", "ch2", "ch3"  // \u9002\u91cf\n);\n'})}),"\n",(0,l.jsx)(n.h3,{id:"3-\u5408\u7406\u8bbe\u7f6e\u8d85\u65f6",children:"3. \u5408\u7406\u8bbe\u7f6e\u8d85\u65f6"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'JedisPool pool = new JedisPool(\n    new JedisPoolConfig(),\n    "localhost",\n    6379,\n    2000  // \u8d85\u65f6\u65f6\u95f4 2\u79d2\n);\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u76d1\u63a7\u547d\u4ee4",children:"\u76d1\u63a7\u547d\u4ee4"}),"\n",(0,l.jsx)(n.h3,{id:"pubsub-channels",children:"PUBSUB CHANNELS"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u5217\u51fa\u6240\u6709\u6d3b\u8dc3\u9891\u9053\nPUBSUB CHANNELS\n\n# \u5217\u51fa\u5339\u914d\u7684\u9891\u9053\nPUBSUB CHANNELS news.*\n"})}),"\n",(0,l.jsx)(n.h3,{id:"pubsub-numsub",children:"PUBSUB NUMSUB"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u67e5\u770b\u9891\u9053\u8ba2\u9605\u8005\u6570\u91cf\nPUBSUB NUMSUB channel1 channel2\n\n# \u8f93\u51fa\n1) "channel1"\n2) (integer) 3\n3) "channel2"\n4) (integer) 1\n'})}),"\n",(0,l.jsx)(n.h3,{id:"pubsub-numpat",children:"PUBSUB NUMPAT"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b\u6a21\u5f0f\u8ba2\u9605\u6570\u91cf\nPUBSUB NUMPAT\n\n# \u8f93\u51fa\n(integer) 5\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,l.jsx)(n.h3,{id:"1-\u9891\u9053\u547d\u540d\u89c4\u8303",children:"1. \u9891\u9053\u547d\u540d\u89c4\u8303"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \u4f7f\u7528\u5c42\u7ea7\u7ed3\u6784\napp:notifications:user:1001\nlog:level:error\nevent:type:order:created\n\n# \u4fbf\u4e8e\u6a21\u5f0f\u8ba2\u9605\nPSUBSCRIBE app:notifications:*\nPSUBSCRIBE log:level:*\n"})}),"\n",(0,l.jsx)(n.h3,{id:"2-\u6d88\u606f\u683c\u5f0f\u5316",children:"2. \u6d88\u606f\u683c\u5f0f\u5316"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'// \u4f7f\u7528 JSON \u683c\u5f0f\nString message = new JSONObject()\n    .put("type", "notification")\n    .put("userId", 1001)\n    .put("content", "New message")\n    .put("timestamp", System.currentTimeMillis())\n    .toString();\n\njedis.publish("notifications", message);\n'})}),"\n",(0,l.jsx)(n.h3,{id:"3-\u5f02\u5e38\u5904\u7406",children:"3. \u5f02\u5e38\u5904\u7406"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'JedisPubSub jedisPubSub = new JedisPubSub() {\n    @Override\n    public void onMessage(String channel, String message) {\n        try {\n            processMessage(channel, message);\n        } catch (Exception e) {\n            log.error("\u5904\u7406\u6d88\u606f\u5931\u8d25", e);\n        }\n    }\n};\n'})}),"\n",(0,l.jsx)(n.h3,{id:"4-\u4f18\u96c5\u5173\u95ed",children:"4. \u4f18\u96c5\u5173\u95ed"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"// \u53d6\u6d88\u8ba2\u9605\u5e76\u5173\u95ed\u8fde\u63a5\nRuntime.getRuntime().addShutdownHook(new Thread(() -> {\n    jedisPubSub.unsubscribe();\n    jedis.close();\n}));\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u2705 Pub/Sub \u9002\u5408\u5b9e\u65f6\u901a\u77e5\u548c\u5e7f\u64ad\u573a\u666f"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 \u6d88\u606f\u4e0d\u6301\u4e45\u5316\uff0c\u9002\u5408\u53ef\u4e22\u5931\u7684\u573a\u666f"}),"\n",(0,l.jsx)(n.li,{children:"\u2705 \u652f\u6301\u6a21\u5f0f\u5339\u914d\u8ba2\u9605"}),"\n",(0,l.jsx)(n.li,{children:"\u26a0\ufe0f \u65e0\u6d88\u606f\u786e\u8ba4\u548c\u5386\u53f2\u6d88\u606f"}),"\n",(0,l.jsx)(n.li,{children:"\u26a0\ufe0f \u8ba2\u9605\u64cd\u4f5c\u662f\u963b\u585e\u7684"}),"\n",(0,l.jsx)(n.li,{children:"\ud83d\udca1 \u9700\u8981\u6d88\u606f\u961f\u5217\u529f\u80fd\u8bf7\u4f7f\u7528 Stream"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u5408\u7406\u4f7f\u7528 Pub/Sub\uff0c\u80fd\u7b80\u5316\u5b9e\u65f6\u6d88\u606f\u63a8\u9001\u7684\u5b9e\u73b0\uff01"})]})}function o(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}},48885:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>c});var i=s(99378);const l={},r=i.createContext(l);function d(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);
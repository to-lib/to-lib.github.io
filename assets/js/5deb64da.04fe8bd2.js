"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[80390],{18253:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"ai/vector-database","title":"\ud83d\uddc4\ufe0f \u5411\u91cf\u6570\u636e\u5e93\u5b9e\u6218","description":"\u5411\u91cf\u6570\u636e\u5e93\u662f RAG \u548c\u8bed\u4e49\u641c\u7d22\u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u7528\u4e8e\u5b58\u50a8\u548c\u68c0\u7d22\u9ad8\u7ef4\u5411\u91cf\u3002\u672c\u6587\u4ecb\u7ecd\u4e3b\u6d41\u5411\u91cf\u6570\u636e\u5e93\u7684\u4f7f\u7528\u65b9\u6cd5\u3002","source":"@site/docs/ai/vector-database.md","sourceDirName":"ai","slug":"/ai/vector-database","permalink":"/docs/ai/vector-database","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/ai/vector-database.md","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20,"title":"\ud83d\uddc4\ufe0f \u5411\u91cf\u6570\u636e\u5e93\u5b9e\u6218"}}');var s=i(22714),c=i(48885);const r={sidebar_position:20,title:"\ud83d\uddc4\ufe0f \u5411\u91cf\u6570\u636e\u5e93\u5b9e\u6218"},l="\u5411\u91cf\u6570\u636e\u5e93\u5b9e\u6218",d={},a=[{value:"\u5411\u91cf\u6570\u636e\u5e93\u5bf9\u6bd4",id:"\u5411\u91cf\u6570\u636e\u5e93\u5bf9\u6bd4",level:2},{value:"Chroma",id:"chroma",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:3},{value:"\u57fa\u7840\u4f7f\u7528",id:"\u57fa\u7840\u4f7f\u7528",level:3},{value:"\u66f4\u65b0\u548c\u5220\u9664",id:"\u66f4\u65b0\u548c\u5220\u9664",level:3},{value:"\u4e0e LangChain \u96c6\u6210",id:"\u4e0e-langchain-\u96c6\u6210",level:3},{value:"Milvus",id:"milvus",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5-1",level:3},{value:"\u57fa\u7840\u4f7f\u7528",id:"\u57fa\u7840\u4f7f\u7528-1",level:3},{value:"\u9ad8\u7ea7\u529f\u80fd",id:"\u9ad8\u7ea7\u529f\u80fd",level:3},{value:"\u4e0e LangChain \u96c6\u6210",id:"\u4e0e-langchain-\u96c6\u6210-1",level:3},{value:"Pinecone",id:"pinecone",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5-2",level:3},{value:"\u57fa\u7840\u4f7f\u7528",id:"\u57fa\u7840\u4f7f\u7528-2",level:3},{value:"\u6279\u91cf\u64cd\u4f5c",id:"\u6279\u91cf\u64cd\u4f5c",level:3},{value:"pgvector",id:"pgvector",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5-3",level:3},{value:"\u57fa\u7840\u4f7f\u7528",id:"\u57fa\u7840\u4f7f\u7528-3",level:3},{value:"\u4f7f\u7528 SQLAlchemy",id:"\u4f7f\u7528-sqlalchemy",level:3},{value:"Qdrant",id:"qdrant",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5-4",level:3},{value:"\u57fa\u7840\u4f7f\u7528",id:"\u57fa\u7840\u4f7f\u7528-4",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u7d22\u5f15\u9009\u62e9",id:"1-\u7d22\u5f15\u9009\u62e9",level:3},{value:"2. \u5143\u6570\u636e\u8bbe\u8ba1",id:"2-\u5143\u6570\u636e\u8bbe\u8ba1",level:3},{value:"3. \u5206\u7247\u7b56\u7565",id:"3-\u5206\u7247\u7b56\u7565",level:3},{value:"4. \u6027\u80fd\u4f18\u5316",id:"4-\u6027\u80fd\u4f18\u5316",level:3},{value:"\u5ef6\u4f38\u9605\u8bfb",id:"\u5ef6\u4f38\u9605\u8bfb",level:2}];function o(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"\u5411\u91cf\u6570\u636e\u5e93\u5b9e\u6218",children:"\u5411\u91cf\u6570\u636e\u5e93\u5b9e\u6218"})}),"\n",(0,s.jsx)(e.p,{children:"\u5411\u91cf\u6570\u636e\u5e93\u662f RAG \u548c\u8bed\u4e49\u641c\u7d22\u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u7528\u4e8e\u5b58\u50a8\u548c\u68c0\u7d22\u9ad8\u7ef4\u5411\u91cf\u3002\u672c\u6587\u4ecb\u7ecd\u4e3b\u6d41\u5411\u91cf\u6570\u636e\u5e93\u7684\u4f7f\u7528\u65b9\u6cd5\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"\u5411\u91cf\u6570\u636e\u5e93\u5bf9\u6bd4",children:"\u5411\u91cf\u6570\u636e\u5e93\u5bf9\u6bd4"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u6570\u636e\u5e93"}),(0,s.jsx)(e.th,{children:"\u7c7b\u578b"}),(0,s.jsx)(e.th,{children:"\u7279\u70b9"}),(0,s.jsx)(e.th,{children:"\u9002\u7528\u573a\u666f"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"Chroma"})}),(0,s.jsx)(e.td,{children:"\u5d4c\u5165\u5f0f"}),(0,s.jsx)(e.td,{children:"\u8f7b\u91cf\u3001\u6613\u7528\u3001Python \u539f\u751f"}),(0,s.jsx)(e.td,{children:"\u5f00\u53d1\u6d4b\u8bd5\u3001\u5c0f\u89c4\u6a21"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"Milvus"})}),(0,s.jsx)(e.td,{children:"\u5206\u5e03\u5f0f"}),(0,s.jsx)(e.td,{children:"\u9ad8\u6027\u80fd\u3001\u53ef\u6269\u5c55"}),(0,s.jsx)(e.td,{children:"\u751f\u4ea7\u73af\u5883\u3001\u5927\u89c4\u6a21"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"Pinecone"})}),(0,s.jsx)(e.td,{children:"\u6258\u7ba1"}),(0,s.jsx)(e.td,{children:"\u5168\u6258\u7ba1\u3001\u514d\u8fd0\u7ef4"}),(0,s.jsx)(e.td,{children:"\u5feb\u901f\u4e0a\u7ebf\u3001\u4f01\u4e1a\u7ea7"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"Qdrant"})}),(0,s.jsx)(e.td,{children:"\u5f00\u6e90"}),(0,s.jsx)(e.td,{children:"Rust \u5b9e\u73b0\u3001\u9ad8\u6027\u80fd"}),(0,s.jsx)(e.td,{children:"\u751f\u4ea7\u73af\u5883"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"pgvector"})}),(0,s.jsx)(e.td,{children:"\u6269\u5c55"}),(0,s.jsx)(e.td,{children:"PostgreSQL \u63d2\u4ef6"}),(0,s.jsx)(e.td,{children:"\u5df2\u6709 PG \u57fa\u7840\u8bbe\u65bd"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"Weaviate"})}),(0,s.jsx)(e.td,{children:"\u5f00\u6e90"}),(0,s.jsx)(e.td,{children:"GraphQL API\u3001\u591a\u6a21\u6001"}),(0,s.jsx)(e.td,{children:"\u590d\u6742\u67e5\u8be2\u9700\u6c42"})]})]})]}),"\n",(0,s.jsx)(e.h2,{id:"chroma",children:"Chroma"}),"\n",(0,s.jsx)(e.p,{children:"Chroma \u662f\u6700\u7b80\u5355\u7684\u5411\u91cf\u6570\u636e\u5e93\uff0c\u9002\u5408\u5feb\u901f\u5f00\u53d1\u548c\u539f\u578b\u9a8c\u8bc1\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"pip install chromadb\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u7840\u4f7f\u7528",children:"\u57fa\u7840\u4f7f\u7528"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'import chromadb\nfrom chromadb.utils import embedding_functions\n\n# \u521b\u5efa\u5ba2\u6237\u7aef\nclient = chromadb.Client()  # \u5185\u5b58\u6a21\u5f0f\n# client = chromadb.PersistentClient(path="./chroma_db")  # \u6301\u4e45\u5316\n\n# \u4f7f\u7528 OpenAI Embedding\nopenai_ef = embedding_functions.OpenAIEmbeddingFunction(\n    api_key="your-api-key",\n    model_name="text-embedding-3-small"\n)\n\n# \u521b\u5efa\u96c6\u5408\ncollection = client.create_collection(\n    name="documents",\n    embedding_function=openai_ef,\n    metadata={"hnsw:space": "cosine"}  # \u4f7f\u7528\u4f59\u5f26\u76f8\u4f3c\u5ea6\n)\n\n# \u6dfb\u52a0\u6587\u6863\ncollection.add(\n    documents=["\u673a\u5668\u5b66\u4e60\u662f\u4eba\u5de5\u667a\u80fd\u7684\u4e00\u4e2a\u5206\u652f", "\u6df1\u5ea6\u5b66\u4e60\u4f7f\u7528\u795e\u7ecf\u7f51\u7edc", "\u81ea\u7136\u8bed\u8a00\u5904\u7406\u5904\u7406\u6587\u672c\u6570\u636e"],\n    metadatas=[{"source": "wiki"}, {"source": "book"}, {"source": "paper"}],\n    ids=["doc1", "doc2", "doc3"]\n)\n\n# \u67e5\u8be2\nresults = collection.query(\n    query_texts=["\u4ec0\u4e48\u662f AI\uff1f"],\n    n_results=2,\n    where={"source": "wiki"}  # \u5143\u6570\u636e\u8fc7\u6ee4\n)\n\nprint(results["documents"])\nprint(results["distances"])\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u66f4\u65b0\u548c\u5220\u9664",children:"\u66f4\u65b0\u548c\u5220\u9664"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'# \u66f4\u65b0\ncollection.update(\n    ids=["doc1"],\n    documents=["\u66f4\u65b0\u540e\u7684\u5185\u5bb9"],\n    metadatas=[{"source": "updated"}]\n)\n\n# \u5220\u9664\ncollection.delete(ids=["doc1"])\n\n# \u6309\u6761\u4ef6\u5220\u9664\ncollection.delete(where={"source": "wiki"})\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u4e0e-langchain-\u96c6\u6210",children:"\u4e0e LangChain \u96c6\u6210"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'from langchain_community.vectorstores import Chroma\nfrom langchain_openai import OpenAIEmbeddings\n\nembeddings = OpenAIEmbeddings(model="text-embedding-3-small")\n\n# \u4ece\u6587\u6863\u521b\u5efa\nvectorstore = Chroma.from_documents(\n    documents=docs,\n    embedding=embeddings,\n    persist_directory="./chroma_db"\n)\n\n# \u68c0\u7d22\nretriever = vectorstore.as_retriever(search_kwargs={"k": 3})\ndocs = retriever.invoke("\u67e5\u8be2\u5185\u5bb9")\n'})}),"\n",(0,s.jsx)(e.h2,{id:"milvus",children:"Milvus"}),"\n",(0,s.jsx)(e.p,{children:"Milvus \u662f\u9ad8\u6027\u80fd\u7684\u5206\u5e03\u5f0f\u5411\u91cf\u6570\u636e\u5e93\uff0c\u9002\u5408\u751f\u4ea7\u73af\u5883\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u5b89\u88c5-1",children:"\u5b89\u88c5"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# \u4f7f\u7528 Docker\ndocker run -d --name milvus \\\n    -p 19530:19530 \\\n    -p 9091:9091 \\\n    milvusdb/milvus:latest\n\n# Python SDK\npip install pymilvus\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u7840\u4f7f\u7528-1",children:"\u57fa\u7840\u4f7f\u7528"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'from pymilvus import connections, Collection, FieldSchema, CollectionSchema, DataType, utility\n\n# \u8fde\u63a5\nconnections.connect("default", host="localhost", port="19530")\n\n# \u5b9a\u4e49 Schema\nfields = [\n    FieldSchema(name="id", dtype=DataType.INT64, is_primary=True, auto_id=True),\n    FieldSchema(name="text", dtype=DataType.VARCHAR, max_length=65535),\n    FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=1536),\n    FieldSchema(name="source", dtype=DataType.VARCHAR, max_length=256)\n]\n\nschema = CollectionSchema(fields, description="\u6587\u6863\u96c6\u5408")\n\n# \u521b\u5efa\u96c6\u5408\ncollection = Collection("documents", schema)\n\n# \u521b\u5efa\u7d22\u5f15\nindex_params = {\n    "metric_type": "COSINE",\n    "index_type": "IVF_FLAT",\n    "params": {"nlist": 1024}\n}\ncollection.create_index("embedding", index_params)\n\n# \u63d2\u5165\u6570\u636e\ndata = [\n    ["\u6587\u68631\u5185\u5bb9", "\u6587\u68632\u5185\u5bb9"],  # text\n    [[0.1] * 1536, [0.2] * 1536],  # embedding\n    ["wiki", "book"]  # source\n]\ncollection.insert(data)\n\n# \u52a0\u8f7d\u5230\u5185\u5b58\ncollection.load()\n\n# \u641c\u7d22\nsearch_params = {"metric_type": "COSINE", "params": {"nprobe": 10}}\nresults = collection.search(\n    data=[[0.1] * 1536],  # \u67e5\u8be2\u5411\u91cf\n    anns_field="embedding",\n    param=search_params,\n    limit=5,\n    expr="source == \'wiki\'",  # \u8fc7\u6ee4\u6761\u4ef6\n    output_fields=["text", "source"]\n)\n\nfor hits in results:\n    for hit in hits:\n        print(f"ID: {hit.id}, Distance: {hit.distance}")\n        print(f"Text: {hit.entity.get(\'text\')}")\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u9ad8\u7ea7\u529f\u80fd",children:"\u9ad8\u7ea7\u529f\u80fd"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'# \u6df7\u5408\u641c\u7d22\uff08\u5411\u91cf + \u6807\u91cf\uff09\nresults = collection.search(\n    data=[query_vector],\n    anns_field="embedding",\n    param=search_params,\n    limit=10,\n    expr="source in [\'wiki\', \'book\'] and length(text) > 100",\n    output_fields=["text", "source"]\n)\n\n# \u6279\u91cf\u63d2\u5165\nfrom pymilvus import utility\n\n# \u5206\u6279\u63d2\u5165\u5927\u91cf\u6570\u636e\nbatch_size = 1000\nfor i in range(0, len(all_data), batch_size):\n    batch = all_data[i:i+batch_size]\n    collection.insert(batch)\n    collection.flush()\n\n# \u5220\u9664\ncollection.delete(expr="id in [1, 2, 3]")\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u4e0e-langchain-\u96c6\u6210-1",children:"\u4e0e LangChain \u96c6\u6210"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'from langchain_community.vectorstores import Milvus\nfrom langchain_openai import OpenAIEmbeddings\n\nembeddings = OpenAIEmbeddings()\n\nvectorstore = Milvus.from_documents(\n    documents=docs,\n    embedding=embeddings,\n    connection_args={"host": "localhost", "port": "19530"},\n    collection_name="langchain_docs"\n)\n\n# \u68c0\u7d22\ndocs = vectorstore.similarity_search("\u67e5\u8be2", k=3)\n'})}),"\n",(0,s.jsx)(e.h2,{id:"pinecone",children:"Pinecone"}),"\n",(0,s.jsx)(e.p,{children:"Pinecone \u662f\u5168\u6258\u7ba1\u7684\u5411\u91cf\u6570\u636e\u5e93\u670d\u52a1\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u5b89\u88c5-2",children:"\u5b89\u88c5"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"pip install pinecone-client\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u7840\u4f7f\u7528-2",children:"\u57fa\u7840\u4f7f\u7528"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'from pinecone import Pinecone, ServerlessSpec\n\n# \u521d\u59cb\u5316\npc = Pinecone(api_key="your-api-key")\n\n# \u521b\u5efa\u7d22\u5f15\npc.create_index(\n    name="documents",\n    dimension=1536,\n    metric="cosine",\n    spec=ServerlessSpec(\n        cloud="aws",\n        region="us-east-1"\n    )\n)\n\n# \u83b7\u53d6\u7d22\u5f15\nindex = pc.Index("documents")\n\n# \u63d2\u5165\u5411\u91cf\nindex.upsert(\n    vectors=[\n        {\n            "id": "doc1",\n            "values": [0.1] * 1536,\n            "metadata": {"text": "\u6587\u6863\u5185\u5bb9", "source": "wiki"}\n        }\n    ],\n    namespace="default"\n)\n\n# \u67e5\u8be2\nresults = index.query(\n    vector=[0.1] * 1536,\n    top_k=5,\n    include_metadata=True,\n    filter={"source": {"$eq": "wiki"}}\n)\n\nfor match in results["matches"]:\n    print(f"ID: {match[\'id\']}, Score: {match[\'score\']}")\n    print(f"Metadata: {match[\'metadata\']}")\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u6279\u91cf\u64cd\u4f5c",children:"\u6279\u91cf\u64cd\u4f5c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'# \u6279\u91cf\u63d2\u5165\nvectors = [\n    {"id": f"doc{i}", "values": embeddings[i], "metadata": {"text": texts[i]}}\n    for i in range(len(texts))\n]\n\n# \u5206\u6279\u4e0a\u4f20\nbatch_size = 100\nfor i in range(0, len(vectors), batch_size):\n    batch = vectors[i:i+batch_size]\n    index.upsert(vectors=batch)\n\n# \u5220\u9664\nindex.delete(ids=["doc1", "doc2"])\nindex.delete(filter={"source": {"$eq": "wiki"}})\n'})}),"\n",(0,s.jsx)(e.h2,{id:"pgvector",children:"pgvector"}),"\n",(0,s.jsx)(e.p,{children:"pgvector \u662f PostgreSQL \u7684\u5411\u91cf\u6269\u5c55\uff0c\u9002\u5408\u5df2\u6709 PostgreSQL \u57fa\u7840\u8bbe\u65bd\u7684\u573a\u666f\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u5b89\u88c5-3",children:"\u5b89\u88c5"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- PostgreSQL \u4e2d\u5b89\u88c5\u6269\u5c55\nCREATE EXTENSION vector;\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"pip install pgvector psycopg2-binary\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u7840\u4f7f\u7528-3",children:"\u57fa\u7840\u4f7f\u7528"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'import psycopg2\nfrom pgvector.psycopg2 import register_vector\n\n# \u8fde\u63a5\nconn = psycopg2.connect("postgresql://user:pass@localhost/db")\nregister_vector(conn)\n\ncur = conn.cursor()\n\n# \u521b\u5efa\u8868\ncur.execute("""\n    CREATE TABLE IF NOT EXISTS documents (\n        id SERIAL PRIMARY KEY,\n        text TEXT,\n        embedding vector(1536),\n        source VARCHAR(256),\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n    )\n""")\n\n# \u521b\u5efa\u7d22\u5f15\ncur.execute("""\n    CREATE INDEX ON documents \n    USING ivfflat (embedding vector_cosine_ops)\n    WITH (lists = 100)\n""")\n\n# \u63d2\u5165\ncur.execute(\n    "INSERT INTO documents (text, embedding, source) VALUES (%s, %s, %s)",\n    ("\u6587\u6863\u5185\u5bb9", [0.1] * 1536, "wiki")\n)\n\n# \u67e5\u8be2\uff08\u4f59\u5f26\u76f8\u4f3c\u5ea6\uff09\ncur.execute("""\n    SELECT id, text, source, 1 - (embedding <=> %s) as similarity\n    FROM documents\n    WHERE source = %s\n    ORDER BY embedding <=> %s\n    LIMIT 5\n""", ([0.1] * 1536, "wiki", [0.1] * 1536))\n\nresults = cur.fetchall()\nfor row in results:\n    print(f"ID: {row[0]}, Similarity: {row[3]:.4f}")\n\nconn.commit()\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u4f7f\u7528-sqlalchemy",children:"\u4f7f\u7528 SQLAlchemy"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'from sqlalchemy import create_engine, Column, Integer, String, Text\nfrom sqlalchemy.orm import declarative_base, sessionmaker\nfrom pgvector.sqlalchemy import Vector\n\nBase = declarative_base()\n\nclass Document(Base):\n    __tablename__ = "documents"\n    \n    id = Column(Integer, primary_key=True)\n    text = Column(Text)\n    embedding = Column(Vector(1536))\n    source = Column(String(256))\n\nengine = create_engine("postgresql://user:pass@localhost/db")\nBase.metadata.create_all(engine)\n\nSession = sessionmaker(bind=engine)\nsession = Session()\n\n# \u63d2\u5165\ndoc = Document(text="\u5185\u5bb9", embedding=[0.1] * 1536, source="wiki")\nsession.add(doc)\nsession.commit()\n\n# \u67e5\u8be2\nfrom sqlalchemy import select\n\nquery_embedding = [0.1] * 1536\nresults = session.scalars(\n    select(Document)\n    .order_by(Document.embedding.cosine_distance(query_embedding))\n    .limit(5)\n).all()\n'})}),"\n",(0,s.jsx)(e.h2,{id:"qdrant",children:"Qdrant"}),"\n",(0,s.jsx)(e.p,{children:"Qdrant \u662f\u7528 Rust \u7f16\u5199\u7684\u9ad8\u6027\u80fd\u5411\u91cf\u6570\u636e\u5e93\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u5b89\u88c5-4",children:"\u5b89\u88c5"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# Docker\ndocker run -p 6333:6333 qdrant/qdrant\n\n# Python SDK\npip install qdrant-client\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u7840\u4f7f\u7528-4",children:"\u57fa\u7840\u4f7f\u7528"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'from qdrant_client import QdrantClient\nfrom qdrant_client.models import Distance, VectorParams, PointStruct\n\n# \u8fde\u63a5\nclient = QdrantClient(host="localhost", port=6333)\n\n# \u521b\u5efa\u96c6\u5408\nclient.create_collection(\n    collection_name="documents",\n    vectors_config=VectorParams(size=1536, distance=Distance.COSINE)\n)\n\n# \u63d2\u5165\nclient.upsert(\n    collection_name="documents",\n    points=[\n        PointStruct(\n            id=1,\n            vector=[0.1] * 1536,\n            payload={"text": "\u6587\u6863\u5185\u5bb9", "source": "wiki"}\n        )\n    ]\n)\n\n# \u641c\u7d22\nresults = client.search(\n    collection_name="documents",\n    query_vector=[0.1] * 1536,\n    query_filter={\n        "must": [{"key": "source", "match": {"value": "wiki"}}]\n    },\n    limit=5\n)\n\nfor result in results:\n    print(f"ID: {result.id}, Score: {result.score}")\n    print(f"Payload: {result.payload}")\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsx)(e.h3,{id:"1-\u7d22\u5f15\u9009\u62e9",children:"1. \u7d22\u5f15\u9009\u62e9"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u7d22\u5f15\u7c7b\u578b"}),(0,s.jsx)(e.th,{children:"\u7279\u70b9"}),(0,s.jsx)(e.th,{children:"\u9002\u7528\u573a\u666f"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Flat"}),(0,s.jsx)(e.td,{children:"\u7cbe\u786e\u641c\u7d22\uff0c\u6162"}),(0,s.jsx)(e.td,{children:"\u5c0f\u6570\u636e\u96c6"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"IVF"}),(0,s.jsx)(e.td,{children:"\u8fd1\u4f3c\u641c\u7d22\uff0c\u5feb"}),(0,s.jsx)(e.td,{children:"\u4e2d\u7b49\u6570\u636e\u96c6"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"HNSW"}),(0,s.jsx)(e.td,{children:"\u9ad8\u53ec\u56de\u7387\uff0c\u5185\u5b58\u5360\u7528\u5927"}),(0,s.jsx)(e.td,{children:"\u9ad8\u7cbe\u5ea6\u9700\u6c42"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"PQ"}),(0,s.jsx)(e.td,{children:"\u538b\u7f29\u5b58\u50a8\uff0c\u901f\u5ea6\u5feb"}),(0,s.jsx)(e.td,{children:"\u5927\u89c4\u6a21\u6570\u636e"})]})]})]}),"\n",(0,s.jsx)(e.h3,{id:"2-\u5143\u6570\u636e\u8bbe\u8ba1",children:"2. \u5143\u6570\u636e\u8bbe\u8ba1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'# \u597d\u7684\u5143\u6570\u636e\u8bbe\u8ba1\nmetadata = {\n    "source": "wiki",           # \u6765\u6e90\n    "category": "technology",   # \u5206\u7c7b\n    "created_at": "2024-01-01", # \u65f6\u95f4\n    "author": "\u5f20\u4e09",           # \u4f5c\u8005\n    "access_level": "public",   # \u6743\u9650\n    "chunk_index": 0,           # \u5206\u5757\u7d22\u5f15\n    "doc_id": "doc_123"         # \u539f\u6587\u6863 ID\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"3-\u5206\u7247\u7b56\u7565",children:"3. \u5206\u7247\u7b56\u7565"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'# \u6309\u79df\u6237\u5206\u7247\ncollection_name = f"tenant_{tenant_id}_documents"\n\n# \u6309\u65f6\u95f4\u5206\u7247\ncollection_name = f"documents_{year}_{month}"\n'})}),"\n",(0,s.jsx)(e.h3,{id:"4-\u6027\u80fd\u4f18\u5316",children:"4. \u6027\u80fd\u4f18\u5316"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'# \u6279\u91cf\u64cd\u4f5c\nbatch_size = 1000\nfor i in range(0, len(vectors), batch_size):\n    batch = vectors[i:i+batch_size]\n    collection.insert(batch)\n\n# \u9884\u70ed\u7d22\u5f15\ncollection.load()\n\n# \u8c03\u6574\u7d22\u5f15\u53c2\u6570\nindex_params = {\n    "index_type": "IVF_PQ",\n    "params": {\n        "nlist": 2048,\n        "m": 16,\n        "nbits": 8\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u5ef6\u4f38\u9605\u8bfb",children:"\u5ef6\u4f38\u9605\u8bfb"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://docs.trychroma.com/",children:"Chroma \u6587\u6863"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://milvus.io/docs",children:"Milvus \u6587\u6863"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://docs.pinecone.io/",children:"Pinecone \u6587\u6863"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/pgvector/pgvector",children:"pgvector GitHub"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://qdrant.tech/documentation/",children:"Qdrant \u6587\u6863"})}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(o,{...n})}):o(n)}},48885:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>l});var t=i(99378);const s={},c=t.createContext(s);function r(n){const e=t.useContext(c);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),t.createElement(c.Provider,{value:e},n.children)}}}]);
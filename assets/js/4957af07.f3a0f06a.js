"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[35168],{37081:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"rust/error-handling","title":"\u9519\u8bef\u5904\u7406","description":"Rust \u5c06\u9519\u8bef\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a\u53ef\u6062\u590d\u9519\u8bef\u548c\u4e0d\u53ef\u6062\u590d\u9519\u8bef\u3002\u672c\u6587\u4ecb\u7ecd Result \u548c panic! \u7684\u4f7f\u7528\u3002","source":"@site/docs/rust/error-handling.md","sourceDirName":"rust","slug":"/rust/error-handling","permalink":"/docs/rust/error-handling","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/rust/error-handling.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"\u9519\u8bef\u5904\u7406"},"sidebar":"rust","previous":{"title":"Cargo \u4f7f\u7528\u6307\u5357","permalink":"/docs/rust/cargo-guide"},"next":{"title":"\u6cdb\u578b\u548c Trait","permalink":"/docs/rust/generics-traits"}}');var s=r(22714),t=r(48885);const i={sidebar_position:5,title:"\u9519\u8bef\u5904\u7406"},a="\u9519\u8bef\u5904\u7406",o={},d=[{value:"\u4e0d\u53ef\u6062\u590d\u9519\u8bef panic",id:"\u4e0d\u53ef\u6062\u590d\u9519\u8bef-panic",level:2},{value:"\u89e6\u53d1 panic",id:"\u89e6\u53d1-panic",level:3},{value:"\u6570\u7ec4\u8d8a\u754c\u5bfc\u81f4 panic",id:"\u6570\u7ec4\u8d8a\u754c\u5bfc\u81f4-panic",level:3},{value:"RUST_BACKTRACE \u73af\u5883\u53d8\u91cf",id:"rust_backtrace-\u73af\u5883\u53d8\u91cf",level:3},{value:"\u53ef\u6062\u590d\u9519\u8bef <code>Result&lt;T, E&gt;</code>",id:"\u53ef\u6062\u590d\u9519\u8bef-resultt-e",level:2},{value:"Result \u679a\u4e3e",id:"result-\u679a\u4e3e",level:3},{value:"\u5904\u7406 Result",id:"\u5904\u7406-result",level:3},{value:"\u5339\u914d\u4e0d\u540c\u7684\u9519\u8bef\u7c7b\u578b",id:"\u5339\u914d\u4e0d\u540c\u7684\u9519\u8bef\u7c7b\u578b",level:3},{value:"\u4f7f\u7528\u95ed\u5305\u7b80\u5316",id:"\u4f7f\u7528\u95ed\u5305\u7b80\u5316",level:3},{value:"\u7b80\u5316\u9519\u8bef\u5904\u7406",id:"\u7b80\u5316\u9519\u8bef\u5904\u7406",level:2},{value:"unwrap",id:"unwrap",level:3},{value:"expect",id:"expect",level:3},{value:"\u4f20\u64ad\u9519\u8bef",id:"\u4f20\u64ad\u9519\u8bef",level:2},{value:"\u624b\u52a8\u4f20\u64ad",id:"\u624b\u52a8\u4f20\u64ad",level:3},{value:"? \u8fd0\u7b97\u7b26",id:"-\u8fd0\u7b97\u7b26",level:3},{value:"\u94fe\u5f0f\u8c03\u7528 ?",id:"\u94fe\u5f0f\u8c03\u7528-",level:3},{value:"\u66f4\u7b80\u6d01\u7684\u65b9\u5f0f",id:"\u66f4\u7b80\u6d01\u7684\u65b9\u5f0f",level:3},{value:"? \u8fd0\u7b97\u7b26\u7684\u89c4\u5219",id:"-\u8fd0\u7b97\u7b26\u7684\u89c4\u5219",level:2},{value:"\u53ea\u80fd\u7528\u4e8e\u8fd4\u56de Result \u7684\u51fd\u6570",id:"\u53ea\u80fd\u7528\u4e8e\u8fd4\u56de-result-\u7684\u51fd\u6570",level:3},{value:"Option \u4e5f\u53ef\u4ee5\u4f7f\u7528 ?",id:"option-\u4e5f\u53ef\u4ee5\u4f7f\u7528-",level:3},{value:"\u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b",id:"\u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b",level:2},{value:"panic! \u8fd8\u662f Result?",id:"panic-\u8fd8\u662f-result",level:2},{value:"\u4f55\u65f6\u4f7f\u7528 panic",id:"\u4f55\u65f6\u4f7f\u7528-panic",level:3},{value:"\u4f55\u65f6\u4f7f\u7528 Result",id:"\u4f55\u65f6\u4f7f\u7528-result",level:3},{value:"\u521b\u5efa\u9a8c\u8bc1\u7c7b\u578b",id:"\u521b\u5efa\u9a8c\u8bc1\u7c7b\u578b",level:2},{value:"\u5b9e\u7528\u6a21\u5f0f",id:"\u5b9e\u7528\u6a21\u5f0f",level:2},{value:"\u4f7f\u7528 unwrap_or",id:"\u4f7f\u7528-unwrap_or",level:3},{value:"\u4f7f\u7528 unwrap_or_else",id:"\u4f7f\u7528-unwrap_or_else",level:3},{value:"\u4f7f\u7528 and_then",id:"\u4f7f\u7528-and_then",level:3},{value:"\u4f7f\u7528 or_else",id:"\u4f7f\u7528-or_else",level:3},{value:"\u4f7f\u7528 map \u548c map_err",id:"\u4f7f\u7528-map-\u548c-map_err",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u5728\u51fd\u6570\u7b7e\u540d\u4e2d\u660e\u786e\u9519\u8bef\u7c7b\u578b",id:"1-\u5728\u51fd\u6570\u7b7e\u540d\u4e2d\u660e\u786e\u9519\u8bef\u7c7b\u578b",level:3},{value:"2. \u4f7f\u7528 ? \u8fd0\u7b97\u7b26\u7b80\u5316\u4ee3\u7801",id:"2-\u4f7f\u7528--\u8fd0\u7b97\u7b26\u7b80\u5316\u4ee3\u7801",level:3},{value:"3. \u4e3a\u9519\u8bef\u63d0\u4f9b\u4e0a\u4e0b\u6587",id:"3-\u4e3a\u9519\u8bef\u63d0\u4f9b\u4e0a\u4e0b\u6587",level:3},{value:"\u5e38\u7528\u9519\u8bef\u5904\u7406 Crate",id:"\u5e38\u7528\u9519\u8bef\u5904\u7406-crate",level:2},{value:"anyhow",id:"anyhow",level:3},{value:"thiserror",id:"thiserror",level:3},{value:"\u9519\u8bef\u5904\u7406\u8bbe\u8ba1\u6a21\u5f0f",id:"\u9519\u8bef\u5904\u7406\u8bbe\u8ba1\u6a21\u5f0f",level:2},{value:"\u9519\u8bef\u94fe(Error Chain)",id:"\u9519\u8bef\u94feerror-chain",level:3},{value:"Context \u6a21\u5f0f",id:"context-\u6a21\u5f0f",level:3},{value:"Early Return \u6a21\u5f0f",id:"early-return-\u6a21\u5f0f",level:3},{value:"\u9519\u8bef\u4e0a\u4e0b\u6587\u5904\u7406",id:"\u9519\u8bef\u4e0a\u4e0b\u6587\u5904\u7406",level:2},{value:"\u4f7f\u7528 anyhow crate",id:"\u4f7f\u7528-anyhow-crate",level:3},{value:"\u81ea\u5b9a\u4e49\u4e0a\u4e0b\u6587",id:"\u81ea\u5b9a\u4e49\u4e0a\u4e0b\u6587",level:3},{value:"\u9519\u8bef\u6062\u590d\u7b56\u7565",id:"\u9519\u8bef\u6062\u590d\u7b56\u7565",level:2},{value:"\u91cd\u8bd5\u6a21\u5f0f",id:"\u91cd\u8bd5\u6a21\u5f0f",level:3},{value:"\u964d\u7ea7\u6a21\u5f0f",id:"\u964d\u7ea7\u6a21\u5f0f",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"})}),"\n",(0,s.jsxs)(n.p,{children:["Rust \u5c06\u9519\u8bef\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a\u53ef\u6062\u590d\u9519\u8bef\u548c\u4e0d\u53ef\u6062\u590d\u9519\u8bef\u3002\u672c\u6587\u4ecb\u7ecd ",(0,s.jsx)(n.code,{children:"Result<T, E>"})," \u548c ",(0,s.jsx)(n.code,{children:"panic!"})," \u7684\u4f7f\u7528\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"\u4e0d\u53ef\u6062\u590d\u9519\u8bef-panic",children:"\u4e0d\u53ef\u6062\u590d\u9519\u8bef panic"}),"\n",(0,s.jsx)(n.h3,{id:"\u89e6\u53d1-panic",children:"\u89e6\u53d1 panic"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'fn main() {\n    panic!("\u7a0b\u5e8f\u5d29\u6e83\u4e86\uff01");\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u6570\u7ec4\u8d8a\u754c\u5bfc\u81f4-panic",children:"\u6570\u7ec4\u8d8a\u754c\u5bfc\u81f4 panic"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"fn main() {\n    let v = vec![1, 2, 3];\n    \n    v[99];  // panic\uff1a\u7d22\u5f15\u8d8a\u754c\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"rust_backtrace-\u73af\u5883\u53d8\u91cf",children:"RUST_BACKTRACE \u73af\u5883\u53d8\u91cf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b\u5b8c\u6574\u7684\u9519\u8bef\u56de\u6eaf\nRUST_BACKTRACE=1 cargo run\nRUST_BACKTRACE=full cargo run\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"\u53ef\u6062\u590d\u9519\u8bef-resultt-e",children:["\u53ef\u6062\u590d\u9519\u8bef ",(0,s.jsx)(n.code,{children:"Result<T, E>"})]}),"\n",(0,s.jsx)(n.h3,{id:"result-\u679a\u4e3e",children:"Result \u679a\u4e3e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"enum Result<T, E> {\n    Ok(T),\n    Err(E),\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u5904\u7406-result",children:"\u5904\u7406 Result"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::fs::File;\n\nfn main() {\n    let f = File::open("hello.txt");\n    \n    let f = match f {\n        Ok(file) => file,\n        Err(error) => {\n            panic!("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: {:?}", error);\n        }\n    };\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u5339\u914d\u4e0d\u540c\u7684\u9519\u8bef\u7c7b\u578b",children:"\u5339\u914d\u4e0d\u540c\u7684\u9519\u8bef\u7c7b\u578b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::fs::File;\nuse std::io::ErrorKind;\n\nfn main() {\n    let f = File::open("hello.txt");\n    \n    let f = match f {\n        Ok(file) => file,\n        Err(error) => match error.kind() {\n            ErrorKind::NotFound => match File::create("hello.txt") {\n                Ok(fc) => fc,\n                Err(e) => panic!("\u521b\u5efa\u6587\u4ef6\u5931\u8d25: {:?}", e),\n            },\n            other_error => {\n                panic!("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: {:?}", other_error);\n            }\n        },\n    };\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528\u95ed\u5305\u7b80\u5316",children:"\u4f7f\u7528\u95ed\u5305\u7b80\u5316"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::fs::File;\nuse std::io::ErrorKind;\n\nfn main() {\n    let f = File::open("hello.txt").unwrap_or_else(|error| {\n        if error.kind() == ErrorKind::NotFound {\n            File::create("hello.txt").unwrap_or_else(|error| {\n                panic!("\u521b\u5efa\u6587\u4ef6\u5931\u8d25: {:?}", error);\n            })\n        } else {\n            panic!("\u6253\u5f00\u6587\u4ef6\u5931\u8d25: {:?}", error);\n        }\n    });\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u7b80\u5316\u9519\u8bef\u5904\u7406",children:"\u7b80\u5316\u9519\u8bef\u5904\u7406"}),"\n",(0,s.jsx)(n.h3,{id:"unwrap",children:"unwrap"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::fs::File;\n\nfn main() {\n    // \u5982\u679c Result \u662f Ok\uff0c\u8fd4\u56de\u503c\n    // \u5982\u679c\u662f Err\uff0c\u8c03\u7528 panic!\n    let f = File::open("hello.txt").unwrap();\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"expect",children:"expect"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::fs::File;\n\nfn main() {\n    // \u7c7b\u4f3c unwrap\uff0c\u4f46\u53ef\u4ee5\u81ea\u5b9a\u4e49 panic! \u6d88\u606f\n    let f = File::open("hello.txt")\n        .expect("\u65e0\u6cd5\u6253\u5f00 hello.txt");\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u4f20\u64ad\u9519\u8bef",children:"\u4f20\u64ad\u9519\u8bef"}),"\n",(0,s.jsx)(n.h3,{id:"\u624b\u52a8\u4f20\u64ad",children:"\u624b\u52a8\u4f20\u64ad"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::fs::File;\nuse std::io::{self, Read};\n\nfn read_username_from_file() -> Result<String, io::Error> {\n    let f = File::open("hello.txt");\n    \n    let mut f = match f {\n        Ok(file) => file,\n        Err(e) => return Err(e),  // \u63d0\u524d\u8fd4\u56de\u9519\u8bef\n    };\n    \n    let mut s = String::new();\n    \n    match f.read_to_string(&mut s) {\n        Ok(_) => Ok(s),\n        Err(e) => Err(e),\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"-\u8fd0\u7b97\u7b26",children:"? \u8fd0\u7b97\u7b26"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::fs::File;\nuse std::io::{self, Read};\n\nfn read_username_from_file() -> Result<String, io::Error> {\n    let mut f = File::open("hello.txt")?;  // \u5982\u679c\u51fa\u9519\uff0c\u63d0\u524d\u8fd4\u56de\n    let mut s = String::new();\n    f.read_to_string(&mut s)?;\n    Ok(s)\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u94fe\u5f0f\u8c03\u7528-",children:"\u94fe\u5f0f\u8c03\u7528 ?"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::fs::File;\nuse std::io::{self, Read};\n\nfn read_username_from_file() -> Result<String, io::Error> {\n    let mut s = String::new();\n    File::open("hello.txt")?.read_to_string(&mut s)?;\n    Ok(s)\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u66f4\u7b80\u6d01\u7684\u65b9\u5f0f",children:"\u66f4\u7b80\u6d01\u7684\u65b9\u5f0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::fs;\nuse std::io;\n\nfn read_username_from_file() -> Result<String, io::Error> {\n    fs::read_to_string("hello.txt")\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"-\u8fd0\u7b97\u7b26\u7684\u89c4\u5219",children:"? \u8fd0\u7b97\u7b26\u7684\u89c4\u5219"}),"\n",(0,s.jsx)(n.h3,{id:"\u53ea\u80fd\u7528\u4e8e\u8fd4\u56de-result-\u7684\u51fd\u6570",children:"\u53ea\u80fd\u7528\u4e8e\u8fd4\u56de Result \u7684\u51fd\u6570"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::fs::File;\n\nfn main() {\n    // \u9519\u8bef\uff1amain \u4e0d\u8fd4\u56de Result\n    // let f = File::open("hello.txt")?;\n}\n\n// \u6b63\u786e\uff1a\u8fd4\u56de Result\nfn main() -> Result<(), Box<dyn std::error::Error>> {\n    let f = File::open("hello.txt")?;\n    Ok(())\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"option-\u4e5f\u53ef\u4ee5\u4f7f\u7528-",children:"Option \u4e5f\u53ef\u4ee5\u4f7f\u7528 ?"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'fn last_char_of_first_line(text: &str) -> Option<char> {\n    text.lines().next()?.chars().last()\n}\n\nfn main() {\n    assert_eq!(\n        last_char_of_first_line("Hello, world\\nHow are you today?"),\n        Some(\'d\')\n    );\n    \n    assert_eq!(last_char_of_first_line(""), None);\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b",children:"\u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::fmt;\n\n#[derive(Debug)]\nenum MyError {\n    IoError(std::io::Error),\n    ParseError(std::num::ParseIntError),\n    CustomError(String),\n}\n\nimpl fmt::Display for MyError {\n    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n        match self {\n            MyError::IoError(e) => write!(f, "IO\u9519\u8bef: {}", e),\n            MyError::ParseError(e) => write!(f, "\u89e3\u6790\u9519\u8bef: {}", e),\n            MyError::CustomError(msg) => write!(f, "\u81ea\u5b9a\u4e49\u9519\u8bef: {}", msg),\n        }\n    }\n}\n\nimpl std::error::Error for MyError {}\n\n// \u5b9e\u73b0 From trait \u4ee5\u652f\u6301 ? \u8fd0\u7b97\u7b26\nimpl From<std::io::Error> for MyError {\n    fn from(error: std::io::Error) -> Self {\n        MyError::IoError(error)\n    }\n}\n\nimpl From<std::num::ParseIntError> for MyError {\n    fn from(error: std::num::ParseIntError) -> Self {\n        MyError::ParseError(error)\n    }\n}\n\nfn process_file(filename: &str) -> Result<i32, MyError> {\n    let content = std::fs::read_to_string(filename)?;  // \u81ea\u52a8\u8f6c\u6362\u4e3a MyError\n    let number: i32 = content.trim().parse()?;         // \u81ea\u52a8\u8f6c\u6362\u4e3a MyError\n    Ok(number)\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"panic-\u8fd8\u662f-result",children:"panic! \u8fd8\u662f Result?"}),"\n",(0,s.jsx)(n.h3,{id:"\u4f55\u65f6\u4f7f\u7528-panic",children:"\u4f55\u65f6\u4f7f\u7528 panic"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'// \u793a\u4f8b\u4ee3\u7801\u548c\u539f\u578b\u4ee3\u7801\nfn demo() {\n    let v = vec![1, 2, 3];\n    v[0];  // \u53ef\u4ee5\u4f7f\u7528 unwrap\n}\n\n// \u4f60\u6bd4\u7f16\u8bd1\u5668\u77e5\u9053\u66f4\u591a\u4fe1\u606f\nuse std::net::IpAddr;\n\nfn main() {\n    let home: IpAddr = "127.0.0.1".parse().unwrap();  // \u786e\u5b9a\u4e0d\u4f1a\u5931\u8d25\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f55\u65f6\u4f7f\u7528-result",children:"\u4f55\u65f6\u4f7f\u7528 Result"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'// \u53ef\u6062\u590d\u7684\u9519\u8bef\nfn divide(a: f64, b: f64) -> Result<f64, String> {\n    if b == 0.0 {\n        Err(String::from("\u9664\u6570\u4e0d\u80fd\u4e3a0"))\n    } else {\n        Ok(a / b)\n    }\n}\n\n// \u5e93\u4ee3\u7801\uff08\u4e0d\u5e94\u8be5 panic\uff09\npub fn parse_config(input: &str) -> Result<Config, ConfigError> {\n    // \u8fd4\u56de Result \u8ba9\u8c03\u7528\u8005\u51b3\u5b9a\u5982\u4f55\u5904\u7406\n    Ok(Config {})\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u521b\u5efa\u9a8c\u8bc1\u7c7b\u578b",children:"\u521b\u5efa\u9a8c\u8bc1\u7c7b\u578b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'pub struct Guess {\n    value: i32,\n}\n\nimpl Guess {\n    pub fn new(value: i32) -> Guess {\n        if value < 1 || value > 100 {\n            panic!("Guess value must be between 1 and 100, got {}.", value);\n        }\n        \n        Guess { value }\n    }\n    \n    pub fn value(&self) -> i32 {\n        self.value\n    }\n}\n\nfn main() {\n    let guess = Guess::new(50);\n    println!("\u731c\u6d4b\u7684\u6570\u5b57: {}", guess.value());\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u5b9e\u7528\u6a21\u5f0f",children:"\u5b9e\u7528\u6a21\u5f0f"}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-unwrap_or",children:"\u4f7f\u7528 unwrap_or"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'fn main() {\n    let value: Result<i32, _> = "42".parse();\n    let number = value.unwrap_or(0);  // \u5931\u8d25\u65f6\u8fd4\u56de\u9ed8\u8ba4\u503c\n    \n    let value: Option<i32> = None;\n    let number = value.unwrap_or(0);\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-unwrap_or_else",children:"\u4f7f\u7528 unwrap_or_else"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'fn main() {\n    let value: Result<i32, _> = "not a number".parse();\n    let number = value.unwrap_or_else(|_| {\n        println!("\u89e3\u6790\u5931\u8d25\uff0c\u4f7f\u7528\u9ed8\u8ba4\u503c");\n        0\n    });\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-and_then",children:"\u4f7f\u7528 and_then"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'fn parse_and_double(s: &str) -> Result<i32, std::num::ParseIntError> {\n    s.parse::<i32>()\n        .and_then(|n| Ok(n * 2))\n}\n\nfn main() {\n    assert_eq!(parse_and_double("10"), Ok(20));\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-or_else",children:"\u4f7f\u7528 or_else"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'fn main() {\n    let result1: Result<i32, &str> = Err("first error");\n    let result2 = result1.or_else(|_| Ok(42));\n    \n    assert_eq!(result2, Ok(42));\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-map-\u548c-map_err",children:"\u4f7f\u7528 map \u548c map_err"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'fn main() {\n    // map\uff1a\u8f6c\u6362 Ok \u503c\n    let result: Result<i32, &str> = Ok(5);\n    let doubled = result.map(|x| x * 2);\n    assert_eq!(doubled, Ok(10));\n    \n    // map_err\uff1a\u8f6c\u6362 Err \u503c\n    let result: Result<i32, &str> = Err("error");\n    let custom_error = result.map_err(|e| format!("Error: {}", e));\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u5728\u51fd\u6570\u7b7e\u540d\u4e2d\u660e\u786e\u9519\u8bef\u7c7b\u578b",children:"1. \u5728\u51fd\u6570\u7b7e\u540d\u4e2d\u660e\u786e\u9519\u8bef\u7c7b\u578b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"// \u597d\nfn process_data(input: &str) -> Result<Data, ProcessError> {\n    // ...\n    Ok(Data {})\n}\n\n// \u4e0d\u591f\u597d\uff1a\u4f7f\u7528 Box<dyn Error>\nfn process_data(input: &str) -> Result<Data, Box<dyn std::error::Error>> {\n    // ...\n    Ok(Data {})\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u4f7f\u7528--\u8fd0\u7b97\u7b26\u7b80\u5316\u4ee3\u7801",children:"2. \u4f7f\u7528 ? \u8fd0\u7b97\u7b26\u7b80\u5316\u4ee3\u7801"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'// \u4e0d\u597d\nfn read_file() -> Result<String, std::io::Error> {\n    let f = File::open("file.txt");\n    let mut f = match f {\n        Ok(file) => file,\n        Err(e) => return Err(e),\n    };\n    // ...\n    Ok(String::new())\n}\n\n// \u597d\nfn read_file() -> Result<String, std::io::Error> {\n    let mut f = File::open("file.txt")?;\n    // ...\n    Ok(String::new())\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u4e3a\u9519\u8bef\u63d0\u4f9b\u4e0a\u4e0b\u6587",children:"3. \u4e3a\u9519\u8bef\u63d0\u4f9b\u4e0a\u4e0b\u6587"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::fs::File;\n\nfn main() -> Result<(), Box<dyn std::error::Error>> {\n    let f = File::open("config.json")\n        .expect("\u65e0\u6cd5\u6253\u5f00\u914d\u7f6e\u6587\u4ef6 config.json");\n    \n    // \u6216\u4f7f\u7528 context\uff08\u9700\u8981\u989d\u5916\u7684 crate\uff09\n    Ok(())\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u5e38\u7528\u9519\u8bef\u5904\u7406-crate",children:"\u5e38\u7528\u9519\u8bef\u5904\u7406 Crate"}),"\n",(0,s.jsx)(n.h3,{id:"anyhow",children:"anyhow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use anyhow::{Context, Result};\n\nfn main() -> Result<()> {\n    let content = std::fs::read_to_string("config.json")\n        .context("\u65e0\u6cd5\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6")?;\n    \n    Ok(())\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"thiserror",children:"thiserror"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use thiserror::Error;\n\n#[derive(Error, Debug)]\npub enum DataStoreError {\n    #[error("\u6570\u636e\u5b58\u50a8\u65ad\u5f00\u8fde\u63a5")]\n    Disconnect(#[from] std::io::Error),\n    \n    #[error("\u65e0\u6548\u7684\u6570\u636e\u5934 (expected {expected:?}, found {found:?})")]\n    InvalidHeader {\n        expected: String,\n        found: String,\n    },\n    \n    #[error("\u672a\u77e5\u9519\u8bef")]\n    Unknown,\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u9519\u8bef\u5904\u7406\u8bbe\u8ba1\u6a21\u5f0f",children:"\u9519\u8bef\u5904\u7406\u8bbe\u8ba1\u6a21\u5f0f"}),"\n",(0,s.jsx)(n.h3,{id:"\u9519\u8bef\u94feerror-chain",children:"\u9519\u8bef\u94fe(Error Chain)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::error::Error;\nuse std::fmt;\n\n#[derive(Debug)]\nstruct DatabaseError {\n    message: String,\n    source: Option<Box<dyn Error>>,\n}\n\nimpl fmt::Display for DatabaseError {\n    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n        write!(f, "\u6570\u636e\u5e93\u9519\u8bef: {}", self.message)\n    }\n}\n\nimpl Error for DatabaseError {\n    fn source(&self) -> Option<&(dyn Error + \'static)> {\n        self.source.as_ref().map(|e| e.as_ref())\n    }\n}\n\nimpl From<std::io::Error> for DatabaseError {\n    fn from(error: std::io::Error) -> Self {\n        DatabaseError {\n            message: "IO\u64cd\u4f5c\u5931\u8d25".to_string(),\n            source: Some(Box::new(error)),\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"context-\u6a21\u5f0f",children:"Context \u6a21\u5f0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'trait Context<T, E> {\n    fn context<C>(self, context: C) -> Result<T, String>\n    where\n        C: fmt::Display;\n}\n\nimpl<T, E: fmt::Display> Context<T, E> for Result<T, E> {\n    fn context<C>(self, context: C) -> Result<T, String>\n    where\n        C: fmt::Display,\n    {\n        self.map_err(|e| format!("{}: {}", context, e))\n    }\n}\n\nfn read_config() -> Result<String, String> {\n    std::fs::read_to_string("config.toml")\n        .map_err(|e| e.to_string())\n        .context("\u65e0\u6cd5\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6")\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"early-return-\u6a21\u5f0f",children:"Early Return \u6a21\u5f0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'fn process_data() -> Result<(), Box<dyn Error>> {\n    let file = std::fs::File::open("data.txt")?;\n    let content = std::fs::read_to_string("data.txt")?;\n    let number: i32 = content.trim().parse()?;\n    \n    println!("\u6570\u5b57: {}", number);\n    Ok(())\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u9519\u8bef\u4e0a\u4e0b\u6587\u5904\u7406",children:"\u9519\u8bef\u4e0a\u4e0b\u6587\u5904\u7406"}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-anyhow-crate",children:"\u4f7f\u7528 anyhow crate"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use anyhow::{Context, Result};\n\nfn read_username() -> Result<String> {\n    let path = "username.txt";\n    std::fs::read_to_string(path)\n        .with_context(|| format!("\u65e0\u6cd5\u8bfb\u53d6\u6587\u4ef6 {}", path))\n}\n\nfn main() -> Result<()> {\n    let username = read_username()?;\n    println!("\u7528\u6237\u540d: {}", username);\n    Ok(())\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49\u4e0a\u4e0b\u6587",children:"\u81ea\u5b9a\u4e49\u4e0a\u4e0b\u6587"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'#[derive(Debug)]\nstruct AppError {\n    context: String,\n    source: Box<dyn std::error::Error>,\n}\n\nimpl fmt::Display for AppError {\n    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n        write!(f, "{}\\n\u539f\u56e0: {}", self.context, self.source)\n    }\n}\n\nimpl std::error::Error for AppError {}\n\nfn with_context<T, E>(result: Result<T, E>, context: &str) -> Result<T, AppError>\nwhere\n    E: std::error::Error + \'static,\n{\n    result.map_err(|e| AppError {\n        context: context.to_string(),\n        source: Box::new(e),\n    })\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u9519\u8bef\u6062\u590d\u7b56\u7565",children:"\u9519\u8bef\u6062\u590d\u7b56\u7565"}),"\n",(0,s.jsx)(n.h3,{id:"\u91cd\u8bd5\u6a21\u5f0f",children:"\u91cd\u8bd5\u6a21\u5f0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'fn retry<F, T, E>(mut f: F, max_attempts: u32) -> Result<T, E>\nwhere\n    F: FnMut() -> Result<T, E>,\n{\n    let mut attempts = 0;\n    loop {\n        match f() {\n            Ok(result) => return Ok(result),\n            Err(e) => {\n                attempts += 1;\n                if attempts >= max_attempts {\n                    return Err(e);\n                }\n                std::thread::sleep(std::time::Duration::from_millis(100));\n            }\n        }\n    }\n}\n\nfn main() {\n    let result = retry(\n        || {\n            // \u6a21\u62df\u4e0d\u7a33\u5b9a\u7684\u64cd\u4f5c\n            if rand::random::<bool>() {\n                Ok("\u6210\u529f")\n            } else {\n                Err("\u5931\u8d25")\n            }\n        },\n        3,\n    );\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u964d\u7ea7\u6a21\u5f0f",children:"\u964d\u7ea7\u6a21\u5f0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'fn get_user_from_cache(id: u32) -> Option<User> {\n    // \u5c1d\u8bd5\u4ece\u7f13\u5b58\u83b7\u53d6\n    None\n}\n\nfn get_user_from_database(id: u32) -> Result<User, DbError> {\n    // \u4ece\u6570\u636e\u5e93\u83b7\u53d6\n    Ok(User { id, name: "Alice".to_string() })\n}\n\nfn get_user(id: u32) -> User {\n    // \u4f18\u5148\u7f13\u5b58,\u5931\u8d25\u5219\u6570\u636e\u5e93,\u518d\u5931\u8d25\u5219\u9ed8\u8ba4\u503c\n    get_user_from_cache(id)\n        .or_else(|| get_user_from_database(id).ok())\n        .unwrap_or_else(|| User::default())\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,s.jsx)(n.p,{children:"\u672c\u6587\u4ecb\u7ecd\u4e86 Rust \u7684\u9519\u8bef\u5904\u7406\u673a\u5236\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 panic! \u7528\u4e8e\u4e0d\u53ef\u6062\u590d\u9519\u8bef"}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.code,{children:"Result<T, E>"})," \u7528\u4e8e\u53ef\u6062\u590d\u9519\u8bef"]}),"\n",(0,s.jsx)(n.li,{children:"\u2705 ? \u8fd0\u7b97\u7b26\u7b80\u5316\u9519\u8bef\u4f20\u64ad"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 unwrap \u548c expect"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 \u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 \u9519\u8bef\u5904\u7406\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 \u9519\u8bef\u5904\u7406\u8bbe\u8ba1\u6a21\u5f0f:\u9519\u8bef\u94fe\u3001Context\u6a21\u5f0f\u3001Early Return"}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 \u9519\u8bef\u4e0a\u4e0b\u6587",":anyhow"," crate\u3001\u81ea\u5b9a\u4e49\u4e0a\u4e0b\u6587"]}),"\n",(0,s.jsx)(n.li,{children:"\u2705 \u9519\u8bef\u6062\u590d\u7b56\u7565:\u91cd\u8bd5\u6a21\u5f0f\u3001\u964d\u7ea7\u6a21\u5f0f"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u638c\u63e1\u9519\u8bef\u5904\u7406\u540e\uff0c\u7ee7\u7eed\u5b66\u4e60 ",(0,s.jsx)(n.a,{href:"/docs/rust/generics-traits",children:"\u6cdb\u578b\u548c Trait"}),"\u3002"]})]})}function c(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},48885:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>a});var l=r(99378);const s={},t=l.createContext(s);function i(e){const n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);
"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[21825],{42022:(n,i,e)=>{e.r(i),e.d(i,{assets:()=>o,contentTitle:()=>s,default:()=>p,frontMatter:()=>c,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"c/advanced-pointers","title":"\u9ad8\u7ea7\u6307\u9488","description":"\u6df1\u5165\u63a2\u8ba8\u6307\u9488\u7684\u9ad8\u7ea7\u7528\u6cd5\uff0c\u5305\u62ec\u51fd\u6570\u6307\u9488\u3001\u590d\u6742\u58f0\u660e\u548c\u5e38\u89c1\u6a21\u5f0f\u3002","source":"@site/docs/c/advanced-pointers.md","sourceDirName":"c","slug":"/c/advanced-pointers","permalink":"/docs/c/advanced-pointers","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/c/advanced-pointers.md","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11,"title":"\u9ad8\u7ea7\u6307\u9488"},"sidebar":"c","previous":{"title":"\u6307\u9488","permalink":"/docs/c/pointers"},"next":{"title":"\u5185\u5b58\u7ba1\u7406","permalink":"/docs/c/memory-management"}}');var r=e(22714),d=e(48885);const c={sidebar_position:11,title:"\u9ad8\u7ea7\u6307\u9488"},s="\u9ad8\u7ea7\u6307\u9488",o={},a=[{value:"\u51fd\u6570\u6307\u9488\u8be6\u89e3",id:"\u51fd\u6570\u6307\u9488\u8be6\u89e3",level:2},{value:"\u56de\u8c03\u51fd\u6570\u6a21\u5f0f",id:"\u56de\u8c03\u51fd\u6570\u6a21\u5f0f",level:3},{value:"\u7b56\u7565\u6a21\u5f0f",id:"\u7b56\u7565\u6a21\u5f0f",level:3},{value:"\u8fd4\u56de\u51fd\u6570\u6307\u9488",id:"\u8fd4\u56de\u51fd\u6570\u6307\u9488",level:3},{value:"\u590d\u6742\u6307\u9488\u58f0\u660e",id:"\u590d\u6742\u6307\u9488\u58f0\u660e",level:2},{value:"\u89e3\u8bfb\u89c4\u5219\uff08\u53f3\u5de6\u6cd5\u5219\uff09",id:"\u89e3\u8bfb\u89c4\u5219\u53f3\u5de6\u6cd5\u5219",level:3},{value:"\u4f7f\u7528 typedef \u7b80\u5316",id:"\u4f7f\u7528-typedef-\u7b80\u5316",level:3},{value:"\u4e8c\u7ef4\u6570\u7ec4\u4e0e\u6307\u9488",id:"\u4e8c\u7ef4\u6570\u7ec4\u4e0e\u6307\u9488",level:2},{value:"\u6307\u9488\u4e0e const \u7ec4\u5408",id:"\u6307\u9488\u4e0e-const-\u7ec4\u5408",level:2},{value:"restrict \u5173\u952e\u5b57",id:"restrict-\u5173\u952e\u5b57",level:2},{value:"\u5e38\u89c1\u9677\u9631",id:"\u5e38\u89c1\u9677\u9631",level:2}];function l(n){const i={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,d.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"\u9ad8\u7ea7\u6307\u9488",children:"\u9ad8\u7ea7\u6307\u9488"})}),"\n",(0,r.jsx)(i.p,{children:"\u6df1\u5165\u63a2\u8ba8\u6307\u9488\u7684\u9ad8\u7ea7\u7528\u6cd5\uff0c\u5305\u62ec\u51fd\u6570\u6307\u9488\u3001\u590d\u6742\u58f0\u660e\u548c\u5e38\u89c1\u6a21\u5f0f\u3002"}),"\n",(0,r.jsx)(i.h2,{id:"\u51fd\u6570\u6307\u9488\u8be6\u89e3",children:"\u51fd\u6570\u6307\u9488\u8be6\u89e3"}),"\n",(0,r.jsx)(i.h3,{id:"\u56de\u8c03\u51fd\u6570\u6a21\u5f0f",children:"\u56de\u8c03\u51fd\u6570\u6a21\u5f0f"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n\n// \u5b9a\u4e49\u56de\u8c03\u51fd\u6570\u7c7b\u578b\ntypedef void (*Callback)(int);\n\nvoid on_success(int code) {\n    printf("\u2705 \u6210\u529f: %d\\n", code);\n}\n\nvoid on_error(int code) {\n    printf("\u274c \u9519\u8bef: %d\\n", code);\n}\n\nvoid process(int data, Callback success, Callback error) {\n    if (data > 0) {\n        success(data);\n    } else {\n        error(data);\n    }\n}\n\nint main(void) {\n    process(100, on_success, on_error);\n    process(-1, on_success, on_error);\n    return 0;\n}\n'})}),"\n",(0,r.jsx)(i.h3,{id:"\u7b56\u7565\u6a21\u5f0f",children:"\u7b56\u7565\u6a21\u5f0f"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'#include <stdio.h>\n\ntypedef int (*SortStrategy)(int, int);\n\nint ascending(int a, int b) { return a - b; }\nint descending(int a, int b) { return b - a; }\n\nvoid sort(int arr[], int n, SortStrategy cmp) {\n    for (int i = 0; i < n - 1; i++) {\n        for (int j = 0; j < n - 1 - i; j++) {\n            if (cmp(arr[j], arr[j+1]) > 0) {\n                int temp = arr[j];\n                arr[j] = arr[j+1];\n                arr[j+1] = temp;\n            }\n        }\n    }\n}\n\nvoid print(int arr[], int n) {\n    for (int i = 0; i < n; i++) printf("%d ", arr[i]);\n    printf("\\n");\n}\n\nint main(void) {\n    int arr1[] = {3, 1, 4, 1, 5, 9};\n    int arr2[] = {3, 1, 4, 1, 5, 9};\n\n    sort(arr1, 6, ascending);\n    printf("\u5347\u5e8f: "); print(arr1, 6);\n\n    sort(arr2, 6, descending);\n    printf("\u964d\u5e8f: "); print(arr2, 6);\n\n    return 0;\n}\n'})}),"\n",(0,r.jsx)(i.h3,{id:"\u8fd4\u56de\u51fd\u6570\u6307\u9488",children:"\u8fd4\u56de\u51fd\u6570\u6307\u9488"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:"#include <stdio.h>\n\ntypedef int (*Operation)(int, int);\n\nint add(int a, int b) { return a + b; }\nint sub(int a, int b) { return a - b; }\nint mul(int a, int b) { return a * b; }\n\nOperation get_operation(char op) {\n    switch (op) {\n        case '+': return add;\n        case '-': return sub;\n        case '*': return mul;\n        default: return NULL;\n    }\n}\n\nint main(void) {\n    Operation op = get_operation('+');\n    if (op) {\n        printf(\"10 + 5 = %d\\n\", op(10, 5));\n    }\n    return 0;\n}\n"})}),"\n",(0,r.jsx)(i.h2,{id:"\u590d\u6742\u6307\u9488\u58f0\u660e",children:"\u590d\u6742\u6307\u9488\u58f0\u660e"}),"\n",(0,r.jsx)(i.h3,{id:"\u89e3\u8bfb\u89c4\u5219\u53f3\u5de6\u6cd5\u5219",children:"\u89e3\u8bfb\u89c4\u5219\uff08\u53f3\u5de6\u6cd5\u5219\uff09"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:"// \u4ece\u6807\u8bc6\u7b26\u5f00\u59cb\uff0c\u5148\u53f3\u540e\u5de6\n\nint *p;              // p \u662f\u6307\u5411 int \u7684\u6307\u9488\nint *p[10];          // p \u662f\u6570\u7ec4\uff0c\u5305\u542b10\u4e2a\u6307\u5411 int \u7684\u6307\u9488\nint (*p)[10];        // p \u662f\u6307\u9488\uff0c\u6307\u5411\u5305\u542b10\u4e2a int \u7684\u6570\u7ec4\nint *p(int);         // p \u662f\u51fd\u6570\uff0c\u8fd4\u56de\u6307\u5411 int \u7684\u6307\u9488\nint (*p)(int);       // p \u662f\u6307\u9488\uff0c\u6307\u5411\u8fd4\u56de int \u7684\u51fd\u6570\nint (*p[10])(int);   // p \u662f\u6570\u7ec4\uff0c\u5305\u542b10\u4e2a\u51fd\u6570\u6307\u9488\n"})}),"\n",(0,r.jsx)(i.h3,{id:"\u4f7f\u7528-typedef-\u7b80\u5316",children:"\u4f7f\u7528 typedef \u7b80\u5316"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:"#include <stdio.h>\n\n// \u590d\u6742\u58f0\u660e\nint (*(*fp)(int))[10];  // \u96be\u8bfb\n\n// \u4f7f\u7528 typedef \u7b80\u5316\ntypedef int IntArray10[10];\ntypedef IntArray10* (*FuncPtr)(int);\n\nFuncPtr fp2;  // \u66f4\u6e05\u6670\n"})}),"\n",(0,r.jsx)(i.h2,{id:"\u4e8c\u7ef4\u6570\u7ec4\u4e0e\u6307\u9488",children:"\u4e8c\u7ef4\u6570\u7ec4\u4e0e\u6307\u9488"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n\nvoid print_matrix(int rows, int cols, int matrix[rows][cols]) {\n    for (int i = 0; i < rows; i++) {\n        for (int j = 0; j < cols; j++) {\n            printf("%3d ", matrix[i][j]);\n        }\n        printf("\\n");\n    }\n}\n\nint main(void) {\n    // \u9759\u6001\u4e8c\u7ef4\u6570\u7ec4\n    int arr[3][4] = {\n        {1, 2, 3, 4},\n        {5, 6, 7, 8},\n        {9, 10, 11, 12}\n    };\n\n    // \u6570\u7ec4\u6307\u9488\u904d\u5386\n    int (*p)[4] = arr;\n    printf("p[1][2] = %d\\n", p[1][2]);  // 7\n\n    // \u52a8\u6001\u4e8c\u7ef4\u6570\u7ec4\uff08\u6307\u9488\u6570\u7ec4\u65b9\u5f0f\uff09\n    int rows = 3, cols = 4;\n    int **dynamic = malloc(rows * sizeof(int*));\n    for (int i = 0; i < rows; i++) {\n        dynamic[i] = malloc(cols * sizeof(int));\n        for (int j = 0; j < cols; j++) {\n            dynamic[i][j] = i * cols + j;\n        }\n    }\n\n    printf("\\n\u52a8\u6001\u6570\u7ec4:\\n");\n    for (int i = 0; i < rows; i++) {\n        for (int j = 0; j < cols; j++) {\n            printf("%3d ", dynamic[i][j]);\n        }\n        printf("\\n");\n    }\n\n    // \u91ca\u653e\n    for (int i = 0; i < rows; i++) free(dynamic[i]);\n    free(dynamic);\n\n    return 0;\n}\n'})}),"\n",(0,r.jsx)(i.h2,{id:"\u6307\u9488\u4e0e-const-\u7ec4\u5408",children:"\u6307\u9488\u4e0e const \u7ec4\u5408"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:"#include <stdio.h>\n\nint main(void) {\n    int a = 10, b = 20;\n\n    // 4\u79cd\u7ec4\u5408\n    int *p1 = &a;                // \u666e\u901a\u6307\u9488\n    const int *p2 = &a;          // \u6307\u5411\u5e38\u91cf\n    int *const p3 = &a;          // \u5e38\u91cf\u6307\u9488\n    const int *const p4 = &a;    // \u4e24\u8005\u90fd\u662f\u5e38\u91cf\n\n    // p2: \u53ef\u4ee5\u6539\u6307\u5411\uff0c\u4e0d\u80fd\u6539\u503c\n    p2 = &b;     // OK\n    // *p2 = 30; // \u9519\u8bef\n\n    // p3: \u53ef\u4ee5\u6539\u503c\uff0c\u4e0d\u80fd\u6539\u6307\u5411\n    *p3 = 30;    // OK\n    // p3 = &b;  // \u9519\u8bef\n\n    // p4: \u90fd\u4e0d\u80fd\u6539\n    // *p4 = 40; // \u9519\u8bef\n    // p4 = &b;  // \u9519\u8bef\n\n    return 0;\n}\n"})}),"\n",(0,r.jsx)(i.h2,{id:"restrict-\u5173\u952e\u5b57",children:"restrict \u5173\u952e\u5b57"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'#include <stdio.h>\n\n// restrict \u544a\u8bc9\u7f16\u8bd1\u5668\u6307\u9488\u662f\u552f\u4e00\u8bbf\u95ee\u6570\u636e\u7684\u65b9\u5f0f\nvoid copy(int *restrict dest, const int *restrict src, int n) {\n    for (int i = 0; i < n; i++) {\n        dest[i] = src[i];\n    }\n}\n\nint main(void) {\n    int src[] = {1, 2, 3, 4, 5};\n    int dest[5];\n\n    copy(dest, src, 5);\n\n    for (int i = 0; i < 5; i++) {\n        printf("%d ", dest[i]);\n    }\n    printf("\\n");\n\n    return 0;\n}\n'})}),"\n",(0,r.jsx)(i.h2,{id:"\u5e38\u89c1\u9677\u9631",children:"\u5e38\u89c1\u9677\u9631"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n\n// 1. \u8fd4\u56de\u5c40\u90e8\u53d8\u91cf\u5730\u5740\nint *bad_return(void) {\n    int x = 10;\n    return &x;  // \u9519\u8bef\uff01x \u5728\u51fd\u6570\u8fd4\u56de\u540e\u9500\u6bc1\n}\n\n// \u6b63\u786e\u505a\u6cd5\nint *good_return(void) {\n    int *p = malloc(sizeof(int));\n    *p = 10;\n    return p;  // \u8c03\u7528\u8005\u8d1f\u8d23\u91ca\u653e\n}\n\n// 2. \u6307\u9488\u672a\u521d\u59cb\u5316\nvoid bad_init(void) {\n    int *p;    // \u91ce\u6307\u9488\n    // *p = 10; // \u672a\u5b9a\u4e49\u884c\u4e3a\n}\n\n// 3. \u5185\u5b58\u6cc4\u6f0f\nvoid memory_leak(void) {\n    int *p = malloc(100);\n    p = malloc(200);  // \u4e4b\u524d\u7684100\u5b57\u8282\u6cc4\u6f0f\u4e86\n    free(p);\n}\n\nint main(void) {\n    int *p = good_return();\n    printf("*p = %d\\n", *p);\n    free(p);\n    return 0;\n}\n'})}),"\n",(0,r.jsx)(i.p,{children:"\u638c\u63e1\u9ad8\u7ea7\u6307\u9488\u540e\uff0c\u5c31\u53ef\u4ee5\u7ee7\u7eed\u5b66\u4e60\u6570\u636e\u7ed3\u6784\u4e86\uff01"})]})}function p(n={}){const{wrapper:i}={...(0,d.R)(),...n.components};return i?(0,r.jsx)(i,{...n,children:(0,r.jsx)(l,{...n})}):l(n)}},48885:(n,i,e)=>{e.d(i,{R:()=>c,x:()=>s});var t=e(99378);const r={},d=t.createContext(r);function c(n){const i=t.useContext(d);return t.useMemo(function(){return"function"==typeof n?n(i):{...i,...n}},[i,n])}function s(n){let i;return i=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),t.createElement(d.Provider,{value:i},n.children)}}}]);
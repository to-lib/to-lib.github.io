"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[74192],{43118:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>d,default:()=>f,frontMatter:()=>s,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"ml/advanced-feature-engineering","title":"\ud83d\udd27 \u7279\u5f81\u5de5\u7a0b\u8fdb\u9636","description":"\u9ad8\u7ea7\u7279\u5f81\u5de5\u7a0b\u6280\u672f\u4e0e\u81ea\u52a8\u5316\u65b9\u6cd5\u3002","source":"@site/docs/ml/advanced-feature-engineering.md","sourceDirName":"ml","slug":"/ml/advanced-feature-engineering","permalink":"/docs/ml/advanced-feature-engineering","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/ml/advanced-feature-engineering.md","tags":[],"version":"current","sidebarPosition":40,"frontMatter":{"sidebar_position":40,"title":"\ud83d\udd27 \u7279\u5f81\u5de5\u7a0b\u8fdb\u9636"},"sidebar":"ml","previous":{"title":"\ud83c\udfae \u5f3a\u5316\u5b66\u4e60\u8fdb\u9636","permalink":"/docs/ml/advanced-rl"},"next":{"title":"\u26a1 \u5206\u5e03\u5f0f\u8bad\u7ec3","permalink":"/docs/ml/distributed-training"}}');var r=t(22714),o=t(48885);const s={sidebar_position:40,title:"\ud83d\udd27 \u7279\u5f81\u5de5\u7a0b\u8fdb\u9636"},d="\u7279\u5f81\u5de5\u7a0b\u8fdb\u9636",i={},l=[{value:"\u7279\u5f81\u4ea4\u53c9",id:"\u7279\u5f81\u4ea4\u53c9",level:2},{value:"Target Encoding",id:"target-encoding",level:2},{value:"\u65f6\u95f4\u7279\u5f81",id:"\u65f6\u95f4\u7279\u5f81",level:2},{value:"\u805a\u5408\u7279\u5f81",id:"\u805a\u5408\u7279\u5f81",level:2},{value:"\u81ea\u52a8\u7279\u5f81\u5de5\u7a0b",id:"\u81ea\u52a8\u7279\u5f81\u5de5\u7a0b",level:2},{value:"Featuretools",id:"featuretools",level:3},{value:"OpenFE",id:"openfe",level:3},{value:"\u7279\u5f81\u9009\u62e9\u8fdb\u9636",id:"\u7279\u5f81\u9009\u62e9\u8fdb\u9636",level:2},{value:"Boruta",id:"boruta",level:3},{value:"SHAP \u7279\u5f81\u9009\u62e9",id:"shap-\u7279\u5f81\u9009\u62e9",level:3},{value:"\u7279\u5f81\u5b58\u50a8",id:"\u7279\u5f81\u5b58\u50a8",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\u7279\u5f81\u5de5\u7a0b\u8fdb\u9636",children:"\u7279\u5f81\u5de5\u7a0b\u8fdb\u9636"})}),"\n",(0,r.jsx)(n.p,{children:"\u9ad8\u7ea7\u7279\u5f81\u5de5\u7a0b\u6280\u672f\u4e0e\u81ea\u52a8\u5316\u65b9\u6cd5\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u7279\u5f81\u4ea4\u53c9",children:"\u7279\u5f81\u4ea4\u53c9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from sklearn.preprocessing import PolynomialFeatures\n\n# \u591a\u9879\u5f0f\u7279\u5f81\npoly = PolynomialFeatures(degree=2, interaction_only=True)\nX_poly = poly.fit_transform(X)\n\n# \u624b\u52a8\u4ea4\u53c9\ndf['feature_cross'] = df['feature1'] * df['feature2']\ndf['feature_ratio'] = df['feature1'] / (df['feature2'] + 1e-8)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"target-encoding",children:"Target Encoding"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import category_encoders as ce\n\n# \u76ee\u6807\u7f16\u7801\nencoder = ce.TargetEncoder(cols=['category_col'])\nX_encoded = encoder.fit_transform(X, y)\n\n# \u5e26\u5e73\u6ed1\u7684\u76ee\u6807\u7f16\u7801\ndef target_encode_smooth(df, col, target, m=10):\n    global_mean = df[target].mean()\n    agg = df.groupby(col)[target].agg(['mean', 'count'])\n    smooth = (agg['count'] * agg['mean'] + m * global_mean) / (agg['count'] + m)\n    return df[col].map(smooth)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u65f6\u95f4\u7279\u5f81",children:"\u65f6\u95f4\u7279\u5f81"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def create_time_features(df, date_col):\n    df['year'] = df[date_col].dt.year\n    df['month'] = df[date_col].dt.month\n    df['day'] = df[date_col].dt.day\n    df['dayofweek'] = df[date_col].dt.dayofweek\n    df['hour'] = df[date_col].dt.hour\n    df['is_weekend'] = df['dayofweek'] >= 5\n    df['is_month_start'] = df[date_col].dt.is_month_start\n    df['is_month_end'] = df[date_col].dt.is_month_end\n\n    # \u5468\u671f\u6027\u7f16\u7801\n    df['month_sin'] = np.sin(2 * np.pi * df['month'] / 12)\n    df['month_cos'] = np.cos(2 * np.pi * df['month'] / 12)\n\n    return df\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u805a\u5408\u7279\u5f81",children:"\u805a\u5408\u7279\u5f81"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def create_agg_features(df, group_col, agg_col):\n    aggs = df.groupby(group_col)[agg_col].agg(['mean', 'std', 'min', 'max', 'count'])\n    aggs.columns = [f'{agg_col}_{stat}' for stat in aggs.columns]\n    return df.merge(aggs, on=group_col, how='left')\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u81ea\u52a8\u7279\u5f81\u5de5\u7a0b",children:"\u81ea\u52a8\u7279\u5f81\u5de5\u7a0b"}),"\n",(0,r.jsx)(n.h3,{id:"featuretools",children:"Featuretools"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import featuretools as ft\n\n# \u5b9a\u4e49\u5b9e\u4f53\nes = ft.EntitySet(id='data')\nes.add_dataframe(dataframe=df, dataframe_name='main', index='id')\n\n# \u6df1\u5ea6\u7279\u5f81\u5408\u6210\nfeatures, feature_defs = ft.dfs(\n    entityset=es,\n    target_dataframe_name='main',\n    max_depth=2\n)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"openfe",children:"OpenFE"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from openfe import OpenFE\n\nofe = OpenFE()\nfeatures = ofe.fit(X_train, y_train, n_jobs=-1)\n\n# \u5e94\u7528\u7279\u5f81\nX_train_new = ofe.transform(X_train)\nX_test_new = ofe.transform(X_test)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u7279\u5f81\u9009\u62e9\u8fdb\u9636",children:"\u7279\u5f81\u9009\u62e9\u8fdb\u9636"}),"\n",(0,r.jsx)(n.h3,{id:"boruta",children:"Boruta"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from boruta import BorutaPy\nfrom sklearn.ensemble import RandomForestClassifier\n\nrf = RandomForestClassifier(n_jobs=-1)\nboruta = BorutaPy(rf, n_estimators='auto', verbose=2)\nboruta.fit(X.values, y.values)\n\nselected_features = X.columns[boruta.support_].tolist()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"shap-\u7279\u5f81\u9009\u62e9",children:"SHAP \u7279\u5f81\u9009\u62e9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import shap\n\nexplainer = shap.TreeExplainer(model)\nshap_values = explainer.shap_values(X)\n\n# \u57fa\u4e8e SHAP \u91cd\u8981\u6027\u9009\u62e9\nimportance = np.abs(shap_values).mean(axis=0)\ntop_features = np.argsort(importance)[-20:]\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u7279\u5f81\u5b58\u50a8",children:"\u7279\u5f81\u5b58\u50a8"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# Feast \u793a\u4f8b\nfrom feast import FeatureStore\n\nstore = FeatureStore(repo_path=".")\n\n# \u83b7\u53d6\u5386\u53f2\u7279\u5f81\ntraining_df = store.get_historical_features(\n    entity_df=entity_df,\n    features=["user_features:age", "user_features:income"]\n).to_df()\n\n# \u5728\u7ebf\u83b7\u53d6\nonline_features = store.get_online_features(\n    features=["user_features:age"],\n    entity_rows=[{"user_id": 1001}]\n).to_dict()\n'})})]})}function f(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},48885:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>d});var a=t(99378);const r={},o=a.createContext(r);function s(e){const n=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);
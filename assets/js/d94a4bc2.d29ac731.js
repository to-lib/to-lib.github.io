"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[3818],{48885:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var r=i(99378);const l={},s=r.createContext(l);function o(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),r.createElement(s.Provider,{value:n},e.children)}},54707:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"spring/configuration","title":"Spring \u914d\u7f6e\u4e0e Profiles","description":"Spring Framework \u7684\u6838\u5fc3\u80fd\u529b\u4e4b\u4e00\u662f\u201c\u7528\u4e00\u81f4\u7684\u65b9\u5f0f\u7ba1\u7406\u5e94\u7528\u914d\u7f6e\u201d\uff1a","source":"@site/docs/spring/configuration.md","sourceDirName":"spring","slug":"/spring/configuration","permalink":"/docs/spring/configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/spring/configuration.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"id":"configuration","title":"Spring \u914d\u7f6e\u4e0e Profiles","sidebar_label":"\u914d\u7f6e\u4e0eProfiles","sidebar_position":5},"sidebar":"spring","previous":{"title":"Bean\u7ba1\u7406","permalink":"/docs/spring/bean-management"},"next":{"title":"AOP","permalink":"/docs/spring/aop"}}');var l=i(22714),s=i(48885);const o={id:"configuration",title:"Spring \u914d\u7f6e\u4e0e Profiles",sidebar_label:"\u914d\u7f6e\u4e0eProfiles",sidebar_position:5},c="Spring \u914d\u7f6e\u4e0e Profiles",a={},d=[{value:"1. \u914d\u7f6e\u65b9\u5f0f\u603b\u89c8",id:"1-\u914d\u7f6e\u65b9\u5f0f\u603b\u89c8",level:2},{value:"1.1 JavaConfig\uff08\u63a8\u8350\uff09",id:"11-javaconfig\u63a8\u8350",level:3},{value:"1.2 \u7ec4\u4ef6\u626b\u63cf",id:"12-\u7ec4\u4ef6\u626b\u63cf",level:3},{value:"1.3 XML\uff08\u7406\u89e3\u5373\u53ef\uff09",id:"13-xml\u7406\u89e3\u5373\u53ef",level:3},{value:"2. \u5bfc\u5165\u4e0e\u6a21\u5757\u5316\u914d\u7f6e",id:"2-\u5bfc\u5165\u4e0e\u6a21\u5757\u5316\u914d\u7f6e",level:2},{value:"2.1 \u4f7f\u7528 <code>@Import</code>",id:"21-\u4f7f\u7528-import",level:3},{value:"2.2 \u4f7f\u7528 <code>@ImportResource</code>\uff08\u517c\u5bb9 XML\uff09",id:"22-\u4f7f\u7528-importresource\u517c\u5bb9-xml",level:3},{value:"3. \u5916\u90e8\u5316\u914d\u7f6e\uff1aPropertySource \u4e0e Environment",id:"3-\u5916\u90e8\u5316\u914d\u7f6epropertysource-\u4e0e-environment",level:2},{value:"3.1 <code>@PropertySource</code>",id:"31-propertysource",level:3},{value:"3.2 \u4f7f\u7528 <code>Environment</code> \u8bfb\u53d6\u5c5e\u6027",id:"32-\u4f7f\u7528-environment-\u8bfb\u53d6\u5c5e\u6027",level:3},{value:"3.3 <code>@Value</code> \u6ce8\u5165\uff08\u5c11\u91cf\u4f7f\u7528\uff09",id:"33-value-\u6ce8\u5165\u5c11\u91cf\u4f7f\u7528",level:3},{value:"4. Profiles\uff1a\u9694\u79bb\u73af\u5883\u914d\u7f6e",id:"4-profiles\u9694\u79bb\u73af\u5883\u914d\u7f6e",level:2},{value:"4.1 \u901a\u8fc7 <code>@Profile</code> \u6ce8\u518c\u4e0d\u540c Bean",id:"41-\u901a\u8fc7-profile-\u6ce8\u518c\u4e0d\u540c-bean",level:3},{value:"4.2 \u6fc0\u6d3b Profile \u7684\u65b9\u5f0f",id:"42-\u6fc0\u6d3b-profile-\u7684\u65b9\u5f0f",level:3},{value:"4.3 \u8bfb\u53d6\u5f53\u524d Profile",id:"43-\u8bfb\u53d6\u5f53\u524d-profile",level:3},{value:"5. \u5e38\u89c1\u5751\u4e0e\u6700\u4f73\u5b9e\u8df5",id:"5-\u5e38\u89c1\u5751\u4e0e\u6700\u4f73\u5b9e\u8df5",level:2}];function t(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"spring-\u914d\u7f6e\u4e0e-profiles",children:"Spring \u914d\u7f6e\u4e0e Profiles"})}),"\n",(0,l.jsx)(n.p,{children:"Spring Framework \u7684\u6838\u5fc3\u80fd\u529b\u4e4b\u4e00\u662f\u201c\u7528\u4e00\u81f4\u7684\u65b9\u5f0f\u7ba1\u7406\u5e94\u7528\u914d\u7f6e\u201d\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u57fa\u4e8e ",(0,l.jsx)(n.strong,{children:"JavaConfig"}),"\uff08",(0,l.jsx)(n.code,{children:"@Configuration"})," / ",(0,l.jsx)(n.code,{children:"@Bean"}),"\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:["\u57fa\u4e8e ",(0,l.jsx)(n.strong,{children:"\u7ec4\u4ef6\u626b\u63cf"}),"\uff08",(0,l.jsx)(n.code,{children:"@ComponentScan"}),"\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:["\u57fa\u4e8e ",(0,l.jsx)(n.strong,{children:"\u5916\u90e8\u5316\u914d\u7f6e"}),"\uff08properties/yaml + ",(0,l.jsx)(n.code,{children:"Environment"}),"\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:["\u57fa\u4e8e ",(0,l.jsx)(n.strong,{children:"\u73af\u5883\u9694\u79bb"}),"\uff08Profiles\uff09"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u672c\u6587\u805a\u7126 Spring Framework\uff08\u975e Spring Boot \u4e13\u5c5e\u80fd\u529b\uff09\uff0c\u5728\u7eaf Spring/Boot \u4e24\u79cd\u573a\u666f\u90fd\u9002\u7528\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"1-\u914d\u7f6e\u65b9\u5f0f\u603b\u89c8",children:"1. \u914d\u7f6e\u65b9\u5f0f\u603b\u89c8"}),"\n",(0,l.jsx)(n.h3,{id:"11-javaconfig\u63a8\u8350",children:"1.1 JavaConfig\uff08\u63a8\u8350\uff09"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"@Configuration\npublic class AppConfig {\n\n    @Bean\n    public Clock clock() {\n        return Clock.systemUTC();\n    }\n\n    @Bean\n    public OrderService orderService(Clock clock) {\n        return new OrderService(clock);\n    }\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8981\u70b9\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"@Configuration"})," \u4f1a\u8ba9 Spring \u5bf9\u914d\u7f6e\u7c7b\u505a\u589e\u5f3a\uff08CGLIB\uff09\uff0c\u4fdd\u8bc1\u540c\u4e00\u4e2a ",(0,l.jsx)(n.code,{children:"@Bean"})," \u65b9\u6cd5\u5728\u5bb9\u5668\u5185\u662f\u5355\u4f8b\u8bed\u4e49\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"@Bean"})," \u65b9\u6cd5\u53c2\u6570\u53ef\u76f4\u63a5\u58f0\u660e\u4f9d\u8d56\uff0cSpring \u4f1a\u81ea\u52a8\u89e3\u6790\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"12-\u7ec4\u4ef6\u626b\u63cf",children:"1.2 \u7ec4\u4ef6\u626b\u63cf"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@Configuration\n@ComponentScan(basePackages = "com.example")\npublic class AppConfig {\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u5e38\u7528\u914d\u5957\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"@Component"})," / ",(0,l.jsx)(n.code,{children:"@Service"})," / ",(0,l.jsx)(n.code,{children:"@Repository"})," / ",(0,l.jsx)(n.code,{children:"@Controller"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"@ConfigurationProperties"}),"\uff08\u66f4\u504f Boot \u5e38\u7528\uff0c\u4f46\u5e95\u5c42\u4e5f\u662f Spring \u7ed1\u5b9a\u80fd\u529b\uff09"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"13-xml\u7406\u89e3\u5373\u53ef",children:"1.3 XML\uff08\u7406\u89e3\u5373\u53ef\uff09"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-xml",children:'<beans>\n  <bean id="clock" class="java.time.Clock" factory-method="systemUTC"/>\n</beans>\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u7ef4\u62a4\u8001\u9879\u76ee\u65f6\u53ef\u80fd\u9047\u5230\uff0c\u4f46\u65b0\u9879\u76ee\u901a\u5e38\u4e0d\u518d\u5efa\u8bae\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"2-\u5bfc\u5165\u4e0e\u6a21\u5757\u5316\u914d\u7f6e",children:"2. \u5bfc\u5165\u4e0e\u6a21\u5757\u5316\u914d\u7f6e"}),"\n",(0,l.jsxs)(n.h3,{id:"21-\u4f7f\u7528-import",children:["2.1 \u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"@Import"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"@Configuration\n@Import({DataSourceConfig.class, WebConfig.class})\npublic class RootConfig {\n}\n"})}),"\n",(0,l.jsxs)(n.h3,{id:"22-\u4f7f\u7528-importresource\u517c\u5bb9-xml",children:["2.2 \u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"@ImportResource"}),"\uff08\u517c\u5bb9 XML\uff09"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@Configuration\n@ImportResource("classpath:spring/legacy-context.xml")\npublic class LegacyConfig {\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"3-\u5916\u90e8\u5316\u914d\u7f6epropertysource-\u4e0e-environment",children:"3. \u5916\u90e8\u5316\u914d\u7f6e\uff1aPropertySource \u4e0e Environment"}),"\n",(0,l.jsxs)(n.h3,{id:"31-propertysource",children:["3.1 ",(0,l.jsx)(n.code,{children:"@PropertySource"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@Configuration\n@PropertySource("classpath:application.properties")\npublic class PropertyConfig {\n}\n'})}),"\n",(0,l.jsxs)(n.h3,{id:"32-\u4f7f\u7528-environment-\u8bfb\u53d6\u5c5e\u6027",children:["3.2 \u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"Environment"})," \u8bfb\u53d6\u5c5e\u6027"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@Component\npublic class FeatureFlags {\n\n    private final Environment env;\n\n    public FeatureFlags(Environment env) {\n        this.env = env;\n    }\n\n    public boolean isNewCheckoutEnabled() {\n        return env.getProperty("feature.checkout.v2", Boolean.class, false);\n    }\n}\n'})}),"\n",(0,l.jsxs)(n.h3,{id:"33-value-\u6ce8\u5165\u5c11\u91cf\u4f7f\u7528",children:["3.3 ",(0,l.jsx)(n.code,{children:"@Value"})," \u6ce8\u5165\uff08\u5c11\u91cf\u4f7f\u7528\uff09"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@Component\npublic class HttpClientConfig {\n\n    @Value("${http.connect-timeout-ms:3000}")\n    private int connectTimeoutMs;\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["\u5f53\u6ce8\u5165\u9879\u53d8\u591a\u65f6\uff0c\u5efa\u8bae\u6539\u7528 ",(0,l.jsx)(n.code,{children:"@ConfigurationProperties"}),"\uff08\u53ef\u8bfb\u6027\u66f4\u597d\uff09\u3002"]}),"\n",(0,l.jsx)(n.h2,{id:"4-profiles\u9694\u79bb\u73af\u5883\u914d\u7f6e",children:"4. Profiles\uff1a\u9694\u79bb\u73af\u5883\u914d\u7f6e"}),"\n",(0,l.jsx)(n.p,{children:"Profile \u7528\u4e8e\u533a\u5206\u4e0d\u540c\u73af\u5883\uff08dev/test/prod\uff09\u6216\u4e0d\u540c\u90e8\u7f72\u5f62\u6001\uff08single/cluster\uff09\u3002"}),"\n",(0,l.jsxs)(n.h3,{id:"41-\u901a\u8fc7-profile-\u6ce8\u518c\u4e0d\u540c-bean",children:["4.1 \u901a\u8fc7 ",(0,l.jsx)(n.code,{children:"@Profile"})," \u6ce8\u518c\u4e0d\u540c Bean"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class StorageConfig {\n\n    @Bean\n    @Profile("dev")\n    public Storage storageDev() {\n        return new InMemoryStorage();\n    }\n\n    @Bean\n    @Profile("prod")\n    public Storage storageProd() {\n        return new S3Storage();\n    }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"42-\u6fc0\u6d3b-profile-\u7684\u65b9\u5f0f",children:"4.2 \u6fc0\u6d3b Profile \u7684\u65b9\u5f0f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"JVM \u542f\u52a8\u53c2\u6570\uff1a"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"-Dspring.profiles.active=dev\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u73af\u5883\u53d8\u91cf\uff08\u5e38\u89c1\u4e8e\u5bb9\u5668\uff09\uff1a"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"SPRING_PROFILES_ACTIVE=prod\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6d4b\u8bd5\u4e2d\uff1a"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@ActiveProfiles("test")\nclass MyTest {\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"43-\u8bfb\u53d6\u5f53\u524d-profile",children:"4.3 \u8bfb\u53d6\u5f53\u524d Profile"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"@Component\npublic class EnvInfo {\n\n    private final Environment env;\n\n    public EnvInfo(Environment env) {\n        this.env = env;\n    }\n\n    public List<String> activeProfiles() {\n        return List.of(env.getActiveProfiles());\n    }\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"5-\u5e38\u89c1\u5751\u4e0e\u6700\u4f73\u5b9e\u8df5",children:"5. \u5e38\u89c1\u5751\u4e0e\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"[self-invocation]"}),"\uff1a\u540c\u7c7b\u5185\u90e8\u76f4\u63a5\u8c03\u7528\u5e26 AOP \u7684\u65b9\u6cd5\uff08\u5982 ",(0,l.jsx)(n.code,{children:"@Transactional"}),"\u3001",(0,l.jsx)(n.code,{children:"@Cacheable"}),"\uff09\u4f1a\u7ed5\u8fc7\u4ee3\u7406\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"[\u914d\u7f6e\u7c7b\u589e\u5f3a]"}),"\uff1a",(0,l.jsx)(n.code,{children:"@Configuration"})," \u4e0e ",(0,l.jsx)(n.code,{children:"@Component"})," \u7684\u5dee\u5f02\u4f1a\u5f71\u54cd ",(0,l.jsx)(n.code,{children:"@Bean"})," \u65b9\u6cd5\u7684\u5355\u4f8b\u8bed\u4e49\uff08\u4e00\u822c\u4e0d\u8981\u628a\u914d\u7f6e\u7c7b\u53ea\u6807\u6210 ",(0,l.jsx)(n.code,{children:"@Component"}),"\uff09\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"[\u5c5e\u6027\u9ed8\u8ba4\u503c]"}),"\uff1a",(0,l.jsx)(n.code,{children:"Environment#getProperty"})," \u53ef\u63d0\u4f9b\u9ed8\u8ba4\u503c\uff0c\u907f\u514d NPE\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"[Profile \u547d\u540d]"}),"\uff1a\u5efa\u8bae\u56fa\u5b9a\u4e3a ",(0,l.jsx)(n.code,{children:"dev/test/staging/prod"}),"\uff0c\u907f\u514d\u968f\u610f\u6269\u6563\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.p,{children:"\u4e0b\u4e00\u6b65\u5efa\u8bae\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/spring/spel",children:"SpEL \u8868\u8fbe\u5f0f"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/spring/caching",children:"\u7f13\u5b58\u62bd\u8c61"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/spring/validation",children:"\u53c2\u6570\u6821\u9a8c"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}}}]);
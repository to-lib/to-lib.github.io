"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[1421],{48885:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>i});var c=r(99378);const l={},a=c.createContext(l);function s(e){const n=c.useContext(a);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),c.createElement(a.Provider,{value:n},e.children)}},94380:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>h,contentTitle:()=>i,default:()=>x,frontMatter:()=>s,metadata:()=>c,toc:()=>d});const c=JSON.parse('{"id":"rabbitmq/exchanges","title":"\u4ea4\u6362\u673a\u8be6\u89e3","description":"RabbitMQ Exchange \u7c7b\u578b\u3001\u8def\u7531\u89c4\u5219\u4e0e\u5e38\u89c1\u7528\u6cd5","source":"@site/docs/rabbitmq/exchanges.md","sourceDirName":"rabbitmq","slug":"/rabbitmq/exchanges","permalink":"/docs/rabbitmq/exchanges","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/rabbitmq/exchanges.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"\u4ea4\u6362\u673a\u8be6\u89e3","description":"RabbitMQ Exchange \u7c7b\u578b\u3001\u8def\u7531\u89c4\u5219\u4e0e\u5e38\u89c1\u7528\u6cd5"},"sidebar":"rabbitmq","previous":{"title":"\u6838\u5fc3\u6982\u5ff5","permalink":"/docs/rabbitmq/core-concepts"},"next":{"title":"\u961f\u5217\u7ba1\u7406","permalink":"/docs/rabbitmq/queues"}}');var l=r(22714),a=r(48885);const s={sidebar_position:4,title:"\u4ea4\u6362\u673a\u8be6\u89e3",description:"RabbitMQ Exchange \u7c7b\u578b\u3001\u8def\u7531\u89c4\u5219\u4e0e\u5e38\u89c1\u7528\u6cd5"},i="\u4ea4\u6362\u673a\u8be6\u89e3",h={},d=[{value:"\u4ea4\u6362\u673a\u7684\u6838\u5fc3\u5c5e\u6027",id:"\u4ea4\u6362\u673a\u7684\u6838\u5fc3\u5c5e\u6027",level:2},{value:"\u4ea4\u6362\u673a\u7c7b\u578b",id:"\u4ea4\u6362\u673a\u7c7b\u578b",level:2},{value:"Direct Exchange\uff08\u76f4\u8fde\uff09",id:"direct-exchange\u76f4\u8fde",level:2},{value:"Fanout Exchange\uff08\u6247\u51fa\uff09",id:"fanout-exchange\u6247\u51fa",level:2},{value:"Topic Exchange\uff08\u4e3b\u9898\uff09",id:"topic-exchange\u4e3b\u9898",level:2},{value:"Headers Exchange\uff08\u5934\u4ea4\u6362\u673a\uff09",id:"headers-exchange\u5934\u4ea4\u6362\u673a",level:2},{value:"\u5e38\u89c1\u4f46\u5bb9\u6613\u5ffd\u7565\u7684\u4ea4\u6362\u673a",id:"\u5e38\u89c1\u4f46\u5bb9\u6613\u5ffd\u7565\u7684\u4ea4\u6362\u673a",level:2},{value:"Default Exchange\uff08\u9ed8\u8ba4\u4ea4\u6362\u673a\uff0c\u540d\u5b57\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff09",id:"default-exchange\u9ed8\u8ba4\u4ea4\u6362\u673a\u540d\u5b57\u4e3a\u7a7a\u5b57\u7b26\u4e32",level:2},{value:"Alternate Exchange\uff08\u5907\u7528\u4ea4\u6362\u673a\uff0c\u5904\u7406\u65e0\u6cd5\u8def\u7531\u7684\u6d88\u606f\uff09",id:"alternate-exchange\u5907\u7528\u4ea4\u6362\u673a\u5904\u7406\u65e0\u6cd5\u8def\u7531\u7684\u6d88\u606f",level:2},{value:"Exchange-to-Exchange Binding\uff08\u4ea4\u6362\u673a\u7ed1\u5b9a\u4ea4\u6362\u673a\uff09",id:"exchange-to-exchange-binding\u4ea4\u6362\u673a\u7ed1\u5b9a\u4ea4\u6362\u673a",level:2},{value:"\u4e0e\u53ef\u9760\u6027\u76f8\u5173\u7684\u8981\u70b9",id:"\u4e0e\u53ef\u9760\u6027\u76f8\u5173\u7684\u8981\u70b9",level:2},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2}];function t(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"\u4ea4\u6362\u673a\u8be6\u89e3",children:"\u4ea4\u6362\u673a\u8be6\u89e3"})}),"\n",(0,l.jsxs)(n.p,{children:["\u4ea4\u6362\u673a\uff08Exchange\uff09\u8d1f\u8d23\u63a5\u6536\u751f\u4ea7\u8005\u53d1\u5e03\u7684\u6d88\u606f\uff0c\u5e76\u6839\u636e",(0,l.jsx)(n.strong,{children:"\u4ea4\u6362\u673a\u7c7b\u578b"}),"\u4e0e",(0,l.jsx)(n.strong,{children:"\u7ed1\u5b9a\uff08Binding\uff09\u89c4\u5219"}),"\u628a\u6d88\u606f\u8def\u7531\u5230\u4e00\u4e2a\u6216\u591a\u4e2a\u961f\u5217\u3002"]}),"\n",(0,l.jsx)(n.h2,{id:"\u4ea4\u6362\u673a\u7684\u6838\u5fc3\u5c5e\u6027",children:"\u4ea4\u6362\u673a\u7684\u6838\u5fc3\u5c5e\u6027"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"name"}),"\uff1a\u4ea4\u6362\u673a\u540d\u79f0\uff08\u540c vhost \u5185\u552f\u4e00\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"type"}),"\uff1a\u4ea4\u6362\u673a\u7c7b\u578b\uff08direct/fanout/topic/headers \u7b49\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"durable"}),"\uff1a\u662f\u5426\u6301\u4e45\u5316\uff08Broker \u91cd\u542f\u540e\u662f\u5426\u4fdd\u7559\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"autoDelete"}),"\uff1a\u5f53\u6700\u540e\u4e00\u4e2a\u7ed1\u5b9a\u88ab\u5220\u9664\u540e\u662f\u5426\u81ea\u52a8\u5220\u9664"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"internal"}),"\uff1a\u662f\u5426\u4e3a\u5185\u90e8\u4ea4\u6362\u673a\uff08\u53ea\u80fd\u88ab\u5176\u4ed6\u4ea4\u6362\u673a\u7ed1\u5b9a/\u8def\u7531\uff0c\u4e0d\u80fd\u7531 Producer \u76f4\u63a5 publish\uff09"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Java \u58f0\u660e\u793a\u4f8b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'channel.exchangeDeclare("order.exchange", "direct", true);\n'})}),"\n",(0,l.jsx)(n.p,{children:"Spring\uff08\u58f0\u660e\u5f0f\uff09\u793a\u4f8b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@Bean\npublic DirectExchange orderExchange() {\n    return ExchangeBuilder.directExchange("order.exchange").durable(true).build();\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u4ea4\u6362\u673a\u7c7b\u578b",children:"\u4ea4\u6362\u673a\u7c7b\u578b"}),"\n",(0,l.jsx)(n.h2,{id:"direct-exchange\u76f4\u8fde",children:"Direct Exchange\uff08\u76f4\u8fde\uff09"}),"\n",(0,l.jsxs)(n.p,{children:["\u6309 routing key ",(0,l.jsx)(n.strong,{children:"\u5b8c\u5168\u5339\u914d"}),"\u8def\u7531\u3002"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u9002\u7528\u573a\u666f"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"[\u70b9\u5bf9\u70b9]"}),"\uff1a\u4e00\u4e2a routing key \u5bf9\u5e94\u4e00\u7c7b\u961f\u5217"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"[\u591a\u8def\u5206\u53d1]"}),"\uff1a\u540c\u4e00\u4e2a routing key \u7ed1\u5b9a\u591a\u4e2a\u961f\u5217\uff0c\u53ef\u5b9e\u73b0\u591a\u6d88\u8d39\u8005\u7ec4"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'channel.exchangeDeclare("direct.logs", "direct", true);\nchannel.queueDeclare("error.queue", true, false, false, null);\nchannel.queueBind("error.queue", "direct.logs", "error");\n\nchannel.basicPublish("direct.logs", "error", null, "E".getBytes());\n'})}),"\n",(0,l.jsx)(n.h2,{id:"fanout-exchange\u6247\u51fa",children:"Fanout Exchange\uff08\u6247\u51fa\uff09"}),"\n",(0,l.jsxs)(n.p,{children:["\u5ffd\u7565 routing key\uff0c",(0,l.jsx)(n.strong,{children:"\u5e7f\u64ad"}),"\u5230\u6240\u6709\u7ed1\u5b9a\u7684\u961f\u5217\u3002"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u9002\u7528\u573a\u666f"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"[\u5e7f\u64ad\u901a\u77e5]"}),"\uff1a\u7f13\u5b58\u5931\u6548\u901a\u77e5\u3001\u914d\u7f6e\u53d8\u66f4\u901a\u77e5"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"[\u65e5\u5fd7\u6536\u96c6]"}),"\uff1a\u591a\u4e2a\u65e5\u5fd7\u5904\u7406\u670d\u52a1\u90fd\u8981\u6536\u5230"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'channel.exchangeDeclare("broadcast", "fanout", true);\nchannel.basicPublish("broadcast", "", null, "hello".getBytes());\n'})}),"\n",(0,l.jsx)(n.h2,{id:"topic-exchange\u4e3b\u9898",children:"Topic Exchange\uff08\u4e3b\u9898\uff09"}),"\n",(0,l.jsxs)(n.p,{children:["\u6309 routing key ",(0,l.jsx)(n.strong,{children:"\u6a21\u5f0f\u5339\u914d"}),"\u8def\u7531\u3002"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"*"}),"\uff1a\u5339\u914d\u4e00\u4e2a\u5355\u8bcd"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"#"}),"\uff1a\u5339\u914d\u96f6\u4e2a\u6216\u591a\u4e2a\u5355\u8bcd"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'channel.exchangeDeclare("topic.logs", "topic", true);\nchannel.queueDeclare("kern.queue", true, false, false, null);\nchannel.queueBind("kern.queue", "topic.logs", "kern.*");\nchannel.basicPublish("topic.logs", "kern.critical", null, "C".getBytes());\n'})}),"\n",(0,l.jsx)(n.h2,{id:"headers-exchange\u5934\u4ea4\u6362\u673a",children:"Headers Exchange\uff08\u5934\u4ea4\u6362\u673a\uff09"}),"\n",(0,l.jsxs)(n.p,{children:["\u4e0d\u4f9d\u8d56 routing key\uff0c\u800c\u662f\u57fa\u4e8e headers \u5339\u914d\uff08\u5e38\u89c1\u7b56\u7565\uff1a",(0,l.jsx)(n.code,{children:"x-match=all|any"}),"\uff09\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'channel.exchangeDeclare("headers.ex", "headers", true);\n\nMap<String, Object> bindHeaders = new HashMap<>();\nbindHeaders.put("x-match", "all");\nbindHeaders.put("format", "pdf");\nchannel.queueBind("pdf.queue", "headers.ex", "", bindHeaders);\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u5e38\u89c1\u4f46\u5bb9\u6613\u5ffd\u7565\u7684\u4ea4\u6362\u673a",children:"\u5e38\u89c1\u4f46\u5bb9\u6613\u5ffd\u7565\u7684\u4ea4\u6362\u673a"}),"\n",(0,l.jsx)(n.h2,{id:"default-exchange\u9ed8\u8ba4\u4ea4\u6362\u673a\u540d\u5b57\u4e3a\u7a7a\u5b57\u7b26\u4e32",children:"Default Exchange\uff08\u9ed8\u8ba4\u4ea4\u6362\u673a\uff0c\u540d\u5b57\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff09"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4ea4\u6362\u673a\u540d\u4e3a ",(0,l.jsx)(n.code,{children:'""'})]}),"\n",(0,l.jsx)(n.li,{children:"\u89c4\u5219\uff1arouting key \u76f4\u63a5\u5f53\u4f5c\u961f\u5217\u540d"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'channel.queueDeclare("q1", true, false, false, null);\nchannel.basicPublish("", "q1", null, "msg".getBytes());\n'})}),"\n",(0,l.jsx)(n.h2,{id:"alternate-exchange\u5907\u7528\u4ea4\u6362\u673a\u5904\u7406\u65e0\u6cd5\u8def\u7531\u7684\u6d88\u606f",children:"Alternate Exchange\uff08\u5907\u7528\u4ea4\u6362\u673a\uff0c\u5904\u7406\u65e0\u6cd5\u8def\u7531\u7684\u6d88\u606f\uff09"}),"\n",(0,l.jsx)(n.p,{children:"\u5f53\u6d88\u606f\u65e0\u6cd5\u8def\u7531\u5230\u4efb\u4f55\u961f\u5217\u65f6\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u65b9\u6848 A"}),"\uff1aProducer \u8bbe\u7f6e ",(0,l.jsx)(n.code,{children:"mandatory=true"})," + ReturnListener \u63a5\u56de"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u65b9\u6848 B"}),"\uff1a\u4e3a\u4ea4\u6362\u673a\u914d\u7f6e ",(0,l.jsx)(n.code,{children:"alternate-exchange"}),"\uff0c\u628a unroutable \u6d88\u606f\u8def\u7531\u5230\u5907\u7528\u4ea4\u6362\u673a\uff08\u63a8\u8350\u505a\u6cd5\u4e4b\u4e00\uff09"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u58f0\u660e\u793a\u4f8b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'Map<String, Object> args = new HashMap<>();\nargs.put("alternate-exchange", "ae.exchange");\nchannel.exchangeDeclare("main.exchange", "direct", true, false, args);\n\nchannel.exchangeDeclare("ae.exchange", "fanout", true);\nchannel.queueDeclare("unroutable.queue", true, false, false, null);\nchannel.queueBind("unroutable.queue", "ae.exchange", "");\n'})}),"\n",(0,l.jsx)(n.h2,{id:"exchange-to-exchange-binding\u4ea4\u6362\u673a\u7ed1\u5b9a\u4ea4\u6362\u673a",children:"Exchange-to-Exchange Binding\uff08\u4ea4\u6362\u673a\u7ed1\u5b9a\u4ea4\u6362\u673a\uff09"}),"\n",(0,l.jsx)(n.p,{children:"\u9002\u7528\u4e8e\u642d\u5efa\u66f4\u590d\u6742\u7684\u8def\u7531\u62d3\u6251\uff08\u6ce8\u610f\u907f\u514d\u5faa\u73af\uff09\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'channel.exchangeDeclare("source.ex", "topic", true);\nchannel.exchangeDeclare("dest.ex", "topic", true);\nchannel.exchangeBind("dest.ex", "source.ex", "order.#");\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u4e0e\u53ef\u9760\u6027\u76f8\u5173\u7684\u8981\u70b9",children:"\u4e0e\u53ef\u9760\u6027\u76f8\u5173\u7684\u8981\u70b9"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"durable exchange + durable queue + persistent message"})," \u624d\u6784\u6210\u201c\u91cd\u542f\u540e\u4ecd\u4fdd\u7559\u201d\u7684\u57fa\u7840"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Publisher Confirm"})," \u89e3\u51b3\u201c\u751f\u4ea7\u8005\u4e0d\u77e5\u9053\u6d88\u606f\u662f\u5426\u5230\u8fbe Broker\u201d\u7684\u95ee\u9898\uff08\u89c1 ",(0,l.jsx)(n.code,{children:"producer"})," \u4e0e ",(0,l.jsx)(n.code,{children:"message-types"}),"\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"mandatory + return"})," \u6216 ",(0,l.jsx)(n.strong,{children:"alternate exchange"})," \u89e3\u51b3\u201c\u5230\u8fbe\u4ea4\u6362\u673a\u4f46\u65e0\u6cd5\u8def\u7531\u5230\u961f\u5217\u201d\u7684\u95ee\u9898"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\ud83d\udcca ",(0,l.jsx)(n.a,{href:"/docs/rabbitmq/queues",children:"\u961f\u5217\u7ba1\u7406"})," - \u4e86\u89e3\u961f\u5217\u5c5e\u6027\u3001TTL\u3001DLX\u3001Quorum/Stream"]}),"\n",(0,l.jsxs)(n.li,{children:["\ud83d\udcbb ",(0,l.jsx)(n.a,{href:"/docs/rabbitmq/producer",children:"\u751f\u4ea7\u8005\u6307\u5357"})," - \u751f\u4ea7\u8005\u786e\u8ba4\u3001return\u3001\u5e8f\u5217\u5316\u4e0e\u91cd\u8bd5"]}),"\n",(0,l.jsxs)(n.li,{children:["\ud83c\udfaf ",(0,l.jsx)(n.a,{href:"/docs/rabbitmq/core-concepts",children:"\u6838\u5fc3\u6982\u5ff5"})," - Connection/Channel/Binding/Queue \u7b49\u57fa\u7840"]}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}}}]);
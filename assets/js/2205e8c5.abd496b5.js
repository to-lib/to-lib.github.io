"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[78405],{7260:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>u});const o=JSON.parse('{"id":"react/context","title":"Context API","description":"[!TIP]","source":"@site/docs/react/context.md","sourceDirName":"react","slug":"/react/context","permalink":"/docs/react/context","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/react/context.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"title":"Context API"},"sidebar":"react","previous":{"title":"\u8868\u5355\u5904\u7406","permalink":"/docs/react/forms"},"next":{"title":"Refs \u548c DOM","permalink":"/docs/react/refs-dom"}}');var r=t(22714),i=t(48885);const s={sidebar_position:10,title:"Context API"},c="Context API",a={},u=[{value:"\ud83d\udcda \u4ec0\u4e48\u662f Context?",id:"-\u4ec0\u4e48\u662f-context",level:2},{value:"Props Drilling \u95ee\u9898",id:"props-drilling-\u95ee\u9898",level:3},{value:"\u4f7f\u7528 Context \u89e3\u51b3",id:"\u4f7f\u7528-context-\u89e3\u51b3",level:3},{value:"\ud83c\udfaf \u57fa\u7840\u7528\u6cd5",id:"-\u57fa\u7840\u7528\u6cd5",level:2},{value:"\u521b\u5efa\u548c\u4f7f\u7528 Context",id:"\u521b\u5efa\u548c\u4f7f\u7528-context",level:3},{value:"\ud83d\udd27 \u5b8c\u6574\u793a\u4f8b",id:"-\u5b8c\u6574\u793a\u4f8b",level:2},{value:"\u4e3b\u9898\u5207\u6362",id:"\u4e3b\u9898\u5207\u6362",level:3},{value:"\u7528\u6237\u8ba4\u8bc1",id:"\u7528\u6237\u8ba4\u8bc1",level:3},{value:"\ud83c\udfa8 \u591a\u4e2a Context",id:"-\u591a\u4e2a-context",level:2},{value:"\u26a1 \u6027\u80fd\u4f18\u5316",id:"-\u6027\u80fd\u4f18\u5316",level:2},{value:"\u95ee\u9898\uff1a\u8fc7\u5ea6\u6e32\u67d3",id:"\u95ee\u9898\u8fc7\u5ea6\u6e32\u67d3",level:3},{value:"\u89e3\u51b3\u65b9\u6848 1\uff1a\u62c6\u5206 Context",id:"\u89e3\u51b3\u65b9\u6848-1\u62c6\u5206-context",level:3},{value:"\u89e3\u51b3\u65b9\u6848 2\uff1auseMemo",id:"\u89e3\u51b3\u65b9\u6848-2usememo",level:3},{value:"\ud83d\udca1 \u6700\u4f73\u5b9e\u8df5",id:"-\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u521b\u5efa\u81ea\u5b9a\u4e49 Hook",id:"1-\u521b\u5efa\u81ea\u5b9a\u4e49-hook",level:3},{value:"2. \u63d0\u4f9b\u9ed8\u8ba4\u503c",id:"2-\u63d0\u4f9b\u9ed8\u8ba4\u503c",level:3},{value:"3. \u62c6\u5206\u72b6\u6001\u548c\u66f4\u65b0\u51fd\u6570",id:"3-\u62c6\u5206\u72b6\u6001\u548c\u66f4\u65b0\u51fd\u6570",level:3},{value:"\ud83d\udcd6 \u5b9e\u7528\u793a\u4f8b",id:"-\u5b9e\u7528\u793a\u4f8b",level:2},{value:"\u8d2d\u7269\u8f66 Context",id:"\u8d2d\u7269\u8f66-context",level:3},{value:"\u901a\u77e5\u7cfb\u7edf",id:"\u901a\u77e5\u7cfb\u7edf",level:3}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"context-api",children:"Context API"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"[!TIP]\nContext \u63d0\u4f9b\u4e86\u4e00\u79cd\u5728\u7ec4\u4ef6\u6811\u4e2d\u5171\u4eab\u6570\u636e\u7684\u65b9\u6cd5\uff0c\u65e0\u9700\u901a\u8fc7\u6bcf\u4e00\u5c42\u7ec4\u4ef6\u624b\u52a8\u4f20\u9012 props\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-\u4ec0\u4e48\u662f-context",children:"\ud83d\udcda \u4ec0\u4e48\u662f Context?"}),"\n",(0,r.jsx)(n.p,{children:'Context \u89e3\u51b3\u4e86"prop drilling"\u95ee\u9898\uff08props \u9700\u8981\u5c42\u5c42\u4f20\u9012\uff09\uff0c\u9002\u7528\u4e8e\u5168\u5c40\u6570\u636e\u5982\u4e3b\u9898\u3001\u7528\u6237\u4fe1\u606f\u3001\u8bed\u8a00\u8bbe\u7f6e\u7b49\u3002'}),"\n",(0,r.jsx)(n.h3,{id:"props-drilling-\u95ee\u9898",children:"Props Drilling \u95ee\u9898"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'// \u2717 Props Drilling - props \u5c42\u5c42\u4f20\u9012\nfunction App() {\n  const user = { name: "Alice" };\n  return <Page user={user} />;\n}\n\nfunction Page({ user }) {\n  return <Content user={user} />;\n}\n\nfunction Content({ user }) {\n  return <Sidebar user={user} />;\n}\n\nfunction Sidebar({ user }) {\n  return <UserInfo user={user} />;\n}\n\nfunction UserInfo({ user }) {\n  return <div>{user.name}</div>;\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u4f7f\u7528-context-\u89e3\u51b3",children:"\u4f7f\u7528 Context \u89e3\u51b3"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'// \u2713 \u4f7f\u7528 Context - \u76f4\u63a5\u8bbf\u95ee\nconst UserContext = createContext();\n\nfunction App() {\n  const user = { name: "Alice" };\n  return (\n    <UserContext.Provider value={user}>\n      <Page />\n    </UserContext.Provider>\n  );\n}\n\nfunction UserInfo() {\n  const user = useContext(UserContext);\n  return <div>{user.name}</div>;\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"-\u57fa\u7840\u7528\u6cd5",children:"\ud83c\udfaf \u57fa\u7840\u7528\u6cd5"}),"\n",(0,r.jsx)(n.h3,{id:"\u521b\u5efa\u548c\u4f7f\u7528-context",children:"\u521b\u5efa\u548c\u4f7f\u7528 Context"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'import { createContext, useContext, useState } from "react";\n\n// 1. \u521b\u5efa Context\nconst ThemeContext = createContext("light");\n\n// 2. Provider \u63d0\u4f9b\u6570\u636e\nfunction App() {\n  const [theme, setTheme] = useState("light");\n\n  return (\n    <ThemeContext.Provider value={{ theme, setTheme }}>\n      <Toolbar />\n    </ThemeContext.Provider>\n  );\n}\n\n// 3. Consumer \u4f7f\u7528\u6570\u636e\nfunction ThemedButton() {\n  const { theme, setTheme } = useContext(ThemeContext);\n\n  return (\n    <button\n      style={{\n        background: theme === "dark" ? "#333" : "#FFF",\n        color: theme === "dark" ? "#FFF" : "#333",\n      }}\n      onClick={() => setTheme(theme === "dark" ? "light" : "dark")}\n    >\n      Toggle Theme\n    </button>\n  );\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"-\u5b8c\u6574\u793a\u4f8b",children:"\ud83d\udd27 \u5b8c\u6574\u793a\u4f8b"}),"\n",(0,r.jsx)(n.h3,{id:"\u4e3b\u9898\u5207\u6362",children:"\u4e3b\u9898\u5207\u6362"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'// ThemeContext.js\nimport { createContext, useContext, useState } from "react";\n\nconst ThemeContext = createContext();\n\nexport function ThemeProvider({ children }) {\n  const [theme, setTheme] = useState("light");\n\n  const value = {\n    theme,\n    setTheme,\n    toggleTheme: () => setTheme(theme === "light" ? "dark" : "light"),\n  };\n\n  return (\n    <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error("useTheme must be used within ThemeProvider");\n  }\n  return context;\n}\n\n// App.js\nimport { ThemeProvider, useTheme } from "./ThemeContext";\n\nfunction App() {\n  return (\n    <ThemeProvider>\n      <Page />\n    </ThemeProvider>\n  );\n}\n\nfunction Page() {\n  const { theme } = useTheme();\n\n  return (\n    <div className={`app theme-${theme}`}>\n      <Header />\n      <Content />\n    </div>\n  );\n}\n\nfunction Header() {\n  const { theme, toggleTheme } = useTheme();\n\n  return (\n    <header>\n      <h1>Current Theme: {theme}</h1>\n      <button onClick={toggleTheme}>Toggle Theme</button>\n    </header>\n  );\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u7528\u6237\u8ba4\u8bc1",children:"\u7528\u6237\u8ba4\u8bc1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"// AuthContext.js\nconst AuthContext = createContext();\n\nexport function AuthProvider({ children }) {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  const login = async (email, password) => {\n    const user = await api.login(email, password);\n    setUser(user);\n  };\n\n  const logout = () => {\n    setUser(null);\n  };\n\n  const value = {\n    user,\n    loading,\n    login,\n    logout,\n    isAuthenticated: !!user,\n  };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}\n\n// \u4f7f\u7528\nfunction Profile() {\n  const { user, logout } = useAuth();\n\n  if (!user) {\n    return <div>Please log in</div>;\n  }\n\n  return (\n    <div>\n      <h2>Welcome, {user.name}!</h2>\n      <button onClick={logout}>Logout</button>\n    </div>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-\u591a\u4e2a-context",children:"\ud83c\udfa8 \u591a\u4e2a Context"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'// \u7ec4\u5408\u591a\u4e2a Context\nfunction App() {\n  return (\n    <AuthProvider>\n      <ThemeProvider>\n        <LanguageProvider>\n          <Main />\n        </LanguageProvider>\n      </ThemeProvider>\n    </AuthProvider>\n  );\n}\n\n// \u4f7f\u7528\u591a\u4e2a Context\nfunction Header() {\n  const { user } = useAuth();\n  const { theme } = useTheme();\n  const { language } = useLanguage();\n\n  return (\n    <header className={theme}>\n      <span>\n        {language === "en" ? "Hello" : "\u4f60\u597d"}, {user.name}\n      </span>\n    </header>\n  );\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"-\u6027\u80fd\u4f18\u5316",children:"\u26a1 \u6027\u80fd\u4f18\u5316"}),"\n",(0,r.jsx)(n.h3,{id:"\u95ee\u9898\u8fc7\u5ea6\u6e32\u67d3",children:"\u95ee\u9898\uff1a\u8fc7\u5ea6\u6e32\u67d3"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'// \u2717 \u95ee\u9898 - theme \u53d8\u5316\u4f1a\u5bfc\u81f4\u6240\u6709\u6d88\u8d39\u8005\u91cd\u65b0\u6e32\u67d3\nconst ThemeContext = createContext();\n\nfunction ThemeProvider({ children }) {\n  const [theme, setTheme] = useState("light");\n  const [user, setUser] = useState(null);\n\n  return (\n    <ThemeContext.Provider value={{ theme, setTheme, user, setUser }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u89e3\u51b3\u65b9\u6848-1\u62c6\u5206-context",children:"\u89e3\u51b3\u65b9\u6848 1\uff1a\u62c6\u5206 Context"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'// \u2713 \u62c6\u5206\u6210\u591a\u4e2a Context\nconst ThemeContext = createContext();\nconst UserContext = createContext();\n\nfunction Providers({ children }) {\n  const [theme, setTheme] = useState("light");\n  const [user, setUser] = useState(null);\n\n  return (\n    <ThemeContext.Provider value={{ theme, setTheme }}>\n      <UserContext.Provider value={{ user, setUser }}>\n        {children}\n      </UserContext.Provider>\n    </ThemeContext.Provider>\n  );\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u89e3\u51b3\u65b9\u6848-2usememo",children:"\u89e3\u51b3\u65b9\u6848 2\uff1auseMemo"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'function ThemeProvider({ children }) {\n  const [theme, setTheme] = useState("light");\n\n  // \u4f7f\u7528 useMemo \u7f13\u5b58 value\n  const value = useMemo(() => ({ theme, setTheme }), [theme]);\n\n  return (\n    <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>\n  );\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"-\u6700\u4f73\u5b9e\u8df5",children:"\ud83d\udca1 \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsx)(n.h3,{id:"1-\u521b\u5efa\u81ea\u5b9a\u4e49-hook",children:"1. \u521b\u5efa\u81ea\u5b9a\u4e49 Hook"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'// \u2713 \u63a8\u8350 - \u5c01\u88c5 useContext\nconst ThemeContext = createContext();\n\nexport function ThemeProvider({ children }) {\n  // ...\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error("useTheme must be used within ThemeProvider");\n  }\n  return context;\n}\n\n// \u4f7f\u7528\nimport { useTheme } from "./ThemeContext";\n\nfunction Component() {\n  const { theme } = useTheme(); // \u76f4\u63a5\u4f7f\u7528\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2-\u63d0\u4f9b\u9ed8\u8ba4\u503c",children:"2. \u63d0\u4f9b\u9ed8\u8ba4\u503c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'const ThemeContext = createContext({\n  theme: "light",\n  toggleTheme: () => {},\n});\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-\u62c6\u5206\u72b6\u6001\u548c\u66f4\u65b0\u51fd\u6570",children:"3. \u62c6\u5206\u72b6\u6001\u548c\u66f4\u65b0\u51fd\u6570"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"// \u62c6\u5206\u4e3a\u4e24\u4e2a Context\nconst StateContext = createContext();\nconst DispatchContext = createContext();\n\nfunction Provider({ children }) {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  return (\n    <DispatchContext.Provider value={dispatch}>\n      <StateContext.Provider value={state}>{children}</StateContext.Provider>\n    </DispatchContext.Provider>\n  );\n}\n\n// \u53ea\u9700\u8981\u72b6\u6001\u7684\u7ec4\u4ef6\u4e0d\u4f1a\u56e0 dispatch \u53d8\u5316\u800c\u91cd\u65b0\u6e32\u67d3\nfunction useStore() {\n  return useContext(StateContext);\n}\n\nfunction useStoreDispatch() {\n  return useContext(DispatchContext);\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-\u5b9e\u7528\u793a\u4f8b",children:"\ud83d\udcd6 \u5b9e\u7528\u793a\u4f8b"}),"\n",(0,r.jsx)(n.h3,{id:"\u8d2d\u7269\u8f66-context",children:"\u8d2d\u7269\u8f66 Context"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"const CartContext = createContext();\n\nexport function CartProvider({ children }) {\n  const [items, setItems] = useState([]);\n\n  const addItem = (product) => {\n    setItems([...items, { ...product, quantity: 1 }]);\n  };\n\n  const removeItem = (id) => {\n    setItems(items.filter((item) => item.id !== id));\n  };\n\n  const updateQuantity = (id, quantity) => {\n    setItems(\n      items.map((item) => (item.id === id ? { ...item, quantity } : item))\n    );\n  };\n\n  const total = items.reduce(\n    (sum, item) => sum + item.price * item.quantity,\n    0\n  );\n\n  const value = {\n    items,\n    addItem,\n    removeItem,\n    updateQuantity,\n    total,\n    itemCount: items.length,\n  };\n\n  return <CartContext.Provider value={value}>{children}</CartContext.Provider>;\n}\n\nexport function useCart() {\n  return useContext(CartContext);\n}\n\n// \u4f7f\u7528\nfunction CartButton() {\n  const { itemCount } = useCart();\n  return <button>Cart ({itemCount})</button>;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u901a\u77e5\u7cfb\u7edf",children:"\u901a\u77e5\u7cfb\u7edf"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'const NotificationContext = createContext();\n\nexport function NotificationProvider({ children }) {\n  const [notifications, setNotifications] = useState([]);\n\n  const addNotification = (message, type = "info") => {\n    const id = Date.now();\n    setNotifications([...notifications, { id, message, type }]);\n\n    // 3\u79d2\u540e\u81ea\u52a8\u79fb\u9664\n    setTimeout(() => {\n      removeNotification(id);\n    }, 3000);\n  };\n\n  const removeNotification = (id) => {\n    setNotifications(notifications.filter((n) => n.id !== id));\n  };\n\n  return (\n    <NotificationContext.Provider value={{ addNotification }}>\n      {children}\n      <div className="notifications">\n        {notifications.map((notif) => (\n          <div key={notif.id} className={`notification ${notif.type}`}>\n            {notif.message}\n            <button onClick={() => removeNotification(notif.id)}>\xd7</button>\n          </div>\n        ))}\n      </div>\n    </NotificationContext.Provider>\n  );\n}\n\nexport function useNotification() {\n  return useContext(NotificationContext);\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u4e0b\u4e00\u6b65"}),": \u5b66\u4e60 ",(0,r.jsx)(n.a,{href:"/docs/react/performance-optimization",children:"\u6027\u80fd\u4f18\u5316"})," \u63d0\u5347\u5e94\u7528\u6027\u80fd\uff0c\u6216\u67e5\u770b ",(0,r.jsx)(n.a,{href:"/docs/react/state-management",children:"\u72b6\u6001\u7ba1\u7406"})," \u4e86\u89e3\u66f4\u591a\u72b6\u6001\u7ba1\u7406\u65b9\u6848\u3002"]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},48885:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>c});var o=t(99378);const r={},i=o.createContext(r);function s(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);
"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[38345],{48885:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>d});var s=r(99378);const i={},t=s.createContext(i);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(t.Provider,{value:n},e.children)}},52666:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>o,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"interview/java-senior/performance","title":"\u6027\u80fd\u8c03\u4f18","description":"11. \u5982\u4f55\u6392\u67e5\u7ebf\u4e0a CPU \u98d9\u9ad8\u95ee\u9898\uff1f","source":"@site/docs/interview/java-senior/performance.md","sourceDirName":"interview/java-senior","slug":"/interview/java-senior/performance","permalink":"/docs/interview/java-senior/performance","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/interview/java-senior/performance.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"\u6027\u80fd\u8c03\u4f18"},"sidebar":"interview","previous":{"title":"\u9ad8\u7ea7\u5e76\u53d1\u7f16\u7a0b","permalink":"/docs/interview/java-senior/concurrency"},"next":{"title":"\u67b6\u6784\u8bbe\u8ba1","permalink":"/docs/interview/java-senior/architecture"}}');var i=r(22714),t=r(48885);const c={sidebar_position:4,title:"\u6027\u80fd\u8c03\u4f18"},d="\ud83c\udfaf \u6027\u80fd\u8c03\u4f18\uff08\u4e13\u5bb6\u7ea7\uff09",l={},a=[{value:"11. \u5982\u4f55\u6392\u67e5\u7ebf\u4e0a CPU \u98d9\u9ad8\u95ee\u9898\uff1f",id:"11-\u5982\u4f55\u6392\u67e5\u7ebf\u4e0a-cpu-\u98d9\u9ad8\u95ee\u9898",level:2},{value:"12. \u5982\u4f55\u6392\u67e5\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\uff1f",id:"12-\u5982\u4f55\u6392\u67e5\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898",level:2},{value:"13. Arthas \u6709\u54ea\u4e9b\u5e38\u7528\u547d\u4ee4\uff1f\u5982\u4f55\u4f7f\u7528\uff1f",id:"13-arthas-\u6709\u54ea\u4e9b\u5e38\u7528\u547d\u4ee4\u5982\u4f55\u4f7f\u7528",level:2},{value:"14. \u5982\u4f55\u4f18\u5316\u6570\u636e\u5e93\u67e5\u8be2\u6027\u80fd\uff1f",id:"14-\u5982\u4f55\u4f18\u5316\u6570\u636e\u5e93\u67e5\u8be2\u6027\u80fd",level:2},{value:"15. \u7f13\u5b58\u7a7f\u900f\u3001\u7f13\u5b58\u51fb\u7a7f\u3001\u7f13\u5b58\u96ea\u5d29\u5982\u4f55\u89e3\u51b3\uff1f",id:"15-\u7f13\u5b58\u7a7f\u900f\u7f13\u5b58\u51fb\u7a7f\u7f13\u5b58\u96ea\u5d29\u5982\u4f55\u89e3\u51b3",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"-\u6027\u80fd\u8c03\u4f18\u4e13\u5bb6\u7ea7",children:"\ud83c\udfaf \u6027\u80fd\u8c03\u4f18\uff08\u4e13\u5bb6\u7ea7\uff09"})}),"\n",(0,i.jsx)(n.h2,{id:"11-\u5982\u4f55\u6392\u67e5\u7ebf\u4e0a-cpu-\u98d9\u9ad8\u95ee\u9898",children:"11. \u5982\u4f55\u6392\u67e5\u7ebf\u4e0a CPU \u98d9\u9ad8\u95ee\u9898\uff1f"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u7b54\u6848\u8981\u70b9\uff1a"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u6392\u67e5\u6b65\u9aa4\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# 1. \u627e\u5230 CPU \u5360\u7528\u6700\u9ad8\u7684 Java \u8fdb\u7a0b\ntop -c\n\n# 2. \u627e\u5230\u8fdb\u7a0b\u4e2d CPU \u5360\u7528\u6700\u9ad8\u7684\u7ebf\u7a0b\ntop -Hp <pid>\n\n# 3. \u5c06\u7ebf\u7a0b ID \u8f6c\u4e3a 16 \u8fdb\u5236\nprintf "%x\\n" <tid>\n\n# 4. \u5bfc\u51fa\u7ebf\u7a0b\u5806\u6808\njstack <pid> > thread_dump.txt\n\n# 5. \u5728\u5806\u6808\u4e2d\u641c\u7d22\u5bf9\u5e94\u7ebf\u7a0b\ngrep -A 30 "nid=0x<hex_tid>" thread_dump.txt\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u4f7f\u7528 Arthas \u5feb\u901f\u5b9a\u4f4d\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# \u542f\u52a8 Arthas\njava -jar arthas-boot.jar\n\n# \u67e5\u770b\u6700\u7e41\u5fd9\u7684\u7ebf\u7a0b\nthread -n 3\n\n# \u67e5\u770b\u7279\u5b9a\u7ebf\u7a0b\u5806\u6808\nthread <tid>\n\n# \u5b9e\u65f6\u76d1\u63a7\u65b9\u6cd5\u6267\u884c\nwatch com.example.Service method "{params, returnObj}" -x 3\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u5e38\u89c1 CPU \u98d9\u9ad8\u539f\u56e0\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// 1. \u6b7b\u5faa\u73af\nwhile (true) {\n    // \u6ca1\u6709 sleep \u6216\u963b\u585e\u64cd\u4f5c\n}\n\n// 2. \u9891\u7e41 GC\n// \u68c0\u67e5 GC \u65e5\u5fd7\uff0c\u53ef\u80fd\u662f\u5185\u5b58\u6cc4\u6f0f\u5bfc\u81f4\n\n// 3. \u6b63\u5219\u8868\u8fbe\u5f0f\u56de\u6eaf\nString regex = "(a+)+b";  // \u707e\u96be\u6027\u56de\u6eaf\n"aaaaaaaaaaaaaaaaaaaaac".matches(regex);\n\n// 4. \u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\n// \u5927\u5bf9\u8c61\u9891\u7e41\u5e8f\u5217\u5316\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5ef6\u4f38\uff1a"})," \u53c2\u8003 ",(0,i.jsx)(n.a,{href:"/docs/java/performance",children:"\u6027\u80fd\u4f18\u5316 - \u95ee\u9898\u6392\u67e5"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"12-\u5982\u4f55\u6392\u67e5\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898",children:"12. \u5982\u4f55\u6392\u67e5\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\uff1f"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u7b54\u6848\u8981\u70b9\uff1a"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u5185\u5b58\u6cc4\u6f0f\u6392\u67e5\u6b65\u9aa4\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# 1. \u67e5\u770b\u5806\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\njmap -heap <pid>\n\n# 2. \u5bfc\u51fa\u5806\u8f6c\u50a8\u6587\u4ef6\njmap -dump:format=b,file=heap.hprof <pid>\n\n# 3. \u4f7f\u7528 MAT \u6216 VisualVM \u5206\u6790\n# \u91cd\u70b9\u5173\u6ce8\uff1a\n# - Dominator Tree\uff08\u652f\u914d\u6811\uff09\n# - Leak Suspects\uff08\u6cc4\u6f0f\u5acc\u7591\uff09\n# - Histogram\uff08\u5bf9\u8c61\u76f4\u65b9\u56fe\uff09\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u4f7f\u7528 Arthas \u5728\u7ebf\u5206\u6790\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b\u5806\u5185\u5b58\u6982\u51b5\nmemory\n\n# \u67e5\u770b\u5bf9\u8c61\u5b9e\u4f8b\u6570\u91cf\nheapdump --live /tmp/heap.hprof\n\n# \u67e5\u770b\u7c7b\u52a0\u8f7d\u4fe1\u606f\nclassloader -l\n\n# \u641c\u7d22\u7c7b\u5b9e\u4f8b\nvmtool --action getInstances --className java.util.HashMap --limit 10\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u5e38\u89c1\u5185\u5b58\u6cc4\u6f0f\u573a\u666f\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// 1. \u9759\u6001\u96c6\u5408\u6301\u6709\u5bf9\u8c61\u5f15\u7528\npublic class Cache {\n    private static Map<String, Object> cache = new HashMap<>();\n    \n    public void add(String key, Object value) {\n        cache.put(key, value);  // \u6c38\u8fdc\u4e0d\u4f1a\u88ab GC\n    }\n}\n\n// 2. \u672a\u5173\u95ed\u7684\u8d44\u6e90\npublic void readFile() {\n    InputStream is = new FileInputStream("file.txt");\n    // \u5fd8\u8bb0\u5173\u95ed\uff0c\u5bfc\u81f4\u8d44\u6e90\u6cc4\u6f0f\n}\n\n// 3. \u76d1\u542c\u5668\u672a\u6ce8\u9500\npublic class EventManager {\n    private List<EventListener> listeners = new ArrayList<>();\n    \n    public void addListener(EventListener listener) {\n        listeners.add(listener);\n    }\n    // \u7f3a\u5c11 removeListener \u65b9\u6cd5\n}\n\n// 4. ThreadLocal \u672a\u6e05\u7406\nprivate static ThreadLocal<User> userHolder = new ThreadLocal<>();\n\npublic void process() {\n    userHolder.set(new User());\n    // \u7ebf\u7a0b\u6c60\u573a\u666f\u4e0b\uff0c\u7ebf\u7a0b\u590d\u7528\u5bfc\u81f4 ThreadLocal \u4e0d\u4f1a\u88ab\u6e05\u7406\n    // \u5e94\u8be5\u5728 finally \u4e2d\u8c03\u7528 userHolder.remove()\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5ef6\u4f38\uff1a"})," \u53c2\u8003 ",(0,i.jsx)(n.a,{href:"/docs/java/performance",children:"\u6027\u80fd\u4f18\u5316 - \u5185\u5b58\u4f18\u5316"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"13-arthas-\u6709\u54ea\u4e9b\u5e38\u7528\u547d\u4ee4\u5982\u4f55\u4f7f\u7528",children:"13. Arthas \u6709\u54ea\u4e9b\u5e38\u7528\u547d\u4ee4\uff1f\u5982\u4f55\u4f7f\u7528\uff1f"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u7b54\u6848\u8981\u70b9\uff1a"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Arthas \u6838\u5fc3\u547d\u4ee4\uff1a"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u547d\u4ee4"}),(0,i.jsx)(n.th,{children:"\u529f\u80fd"}),(0,i.jsx)(n.th,{children:"\u793a\u4f8b"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dashboard"})}),(0,i.jsx)(n.td,{children:"\u7cfb\u7edf\u5b9e\u65f6\u9762\u677f"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dashboard"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"thread"})}),(0,i.jsx)(n.td,{children:"\u7ebf\u7a0b\u4fe1\u606f"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"thread -n 3"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"jvm"})}),(0,i.jsx)(n.td,{children:"JVM \u4fe1\u606f"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"jvm"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"memory"})}),(0,i.jsx)(n.td,{children:"\u5185\u5b58\u4fe1\u606f"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"memory"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"watch"})}),(0,i.jsx)(n.td,{children:"\u65b9\u6cd5\u76d1\u63a7"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'watch class method "{params}"'})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"trace"})}),(0,i.jsx)(n.td,{children:"\u65b9\u6cd5\u8c03\u7528\u94fe\u8def"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"trace class method"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"stack"})}),(0,i.jsx)(n.td,{children:"\u65b9\u6cd5\u8c03\u7528\u6808"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"stack class method"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"tt"})}),(0,i.jsx)(n.td,{children:"\u65f6\u95f4\u96a7\u9053"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"tt -t class method"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"profiler"})}),(0,i.jsx)(n.td,{children:"\u706b\u7130\u56fe"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"profiler start"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u5b9e\u6218\u793a\u4f8b\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# 1. \u67e5\u770b\u65b9\u6cd5\u5165\u53c2\u548c\u8fd4\u56de\u503c\nwatch com.example.UserService getUser \"{params, returnObj}\" -x 3\n\n# 2. \u8ffd\u8e2a\u65b9\u6cd5\u8c03\u7528\u8017\u65f6\ntrace com.example.UserService getUser '#cost > 100'\n\n# 3. \u67e5\u770b\u65b9\u6cd5\u8c03\u7528\u6808\nstack com.example.UserService getUser\n\n# 4. \u65f6\u95f4\u96a7\u9053 - \u8bb0\u5f55\u65b9\u6cd5\u8c03\u7528\ntt -t com.example.UserService getUser\ntt -i 1001  # \u67e5\u770b\u7b2c1001\u6b21\u8c03\u7528\ntt -i 1001 -p  # \u91cd\u653e\u8c03\u7528\n\n# 5. \u751f\u6210\u706b\u7130\u56fe\nprofiler start\n# \u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\nprofiler stop --format html --file /tmp/flame.html\n\n# 6. \u53cd\u7f16\u8bd1\u7c7b\njad com.example.UserService\n\n# 7. \u70ed\u66f4\u65b0\u4ee3\u7801\nredefine /tmp/UserService.class\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5ef6\u4f38\uff1a"})," \u53c2\u8003 ",(0,i.jsx)(n.a,{href:"/docs/java/performance",children:"\u6027\u80fd\u4f18\u5316 - \u76d1\u63a7\u5de5\u5177"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"14-\u5982\u4f55\u4f18\u5316\u6570\u636e\u5e93\u67e5\u8be2\u6027\u80fd",children:"14. \u5982\u4f55\u4f18\u5316\u6570\u636e\u5e93\u67e5\u8be2\u6027\u80fd\uff1f"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u7b54\u6848\u8981\u70b9\uff1a"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"SQL \u4f18\u5316\u539f\u5219\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- 1. \u907f\u514d SELECT *\nSELECT id, name, age FROM users WHERE id = 1;\n\n-- 2. \u4f7f\u7528\u8986\u76d6\u7d22\u5f15\nCREATE INDEX idx_name_age ON users(name, age);\nSELECT name, age FROM users WHERE name = 'Tom';  -- \u4e0d\u9700\u8981\u56de\u8868\n\n-- 3. \u907f\u514d\u7d22\u5f15\u5931\u6548\n-- \u9519\u8bef\uff1a\u51fd\u6570\u64cd\u4f5c\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\nSELECT * FROM users WHERE YEAR(create_time) = 2024;\n-- \u6b63\u786e\uff1a\u8303\u56f4\u67e5\u8be2\nSELECT * FROM users WHERE create_time >= '2024-01-01' AND create_time < '2025-01-01';\n\n-- 4. \u907f\u514d OR \u5bfc\u81f4\u7d22\u5f15\u5931\u6548\n-- \u9519\u8bef\nSELECT * FROM users WHERE name = 'Tom' OR age = 20;\n-- \u6b63\u786e\uff1a\u4f7f\u7528 UNION\nSELECT * FROM users WHERE name = 'Tom'\nUNION\nSELECT * FROM users WHERE age = 20;\n\n-- 5. \u5206\u9875\u4f18\u5316\n-- \u9519\u8bef\uff1a\u6df1\u5206\u9875\u6027\u80fd\u5dee\nSELECT * FROM users LIMIT 1000000, 10;\n-- \u6b63\u786e\uff1a\u4f7f\u7528\u6e38\u6807\u5206\u9875\nSELECT * FROM users WHERE id > 1000000 LIMIT 10;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u8fde\u63a5\u6c60\u914d\u7f6e\u4f18\u5316\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# HikariCP \u914d\u7f6e\nspring:\n  datasource:\n    hikari:\n      minimum-idle: 10\n      maximum-pool-size: 50\n      idle-timeout: 600000\n      max-lifetime: 1800000\n      connection-timeout: 30000\n      connection-test-query: SELECT 1\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u6162\u67e5\u8be2\u5206\u6790\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u5f00\u542f\u6162\u67e5\u8be2\u65e5\u5fd7\nSET GLOBAL slow_query_log = 'ON';\nSET GLOBAL long_query_time = 1;\n\n-- \u4f7f\u7528 EXPLAIN \u5206\u6790\nEXPLAIN SELECT * FROM users WHERE name = 'Tom';\n\n-- \u5173\u6ce8\u5b57\u6bb5\uff1a\n-- type: \u8bbf\u95ee\u7c7b\u578b\uff08ALL < index < range < ref < eq_ref < const\uff09\n-- key: \u4f7f\u7528\u7684\u7d22\u5f15\n-- rows: \u626b\u63cf\u884c\u6570\n-- Extra: \u989d\u5916\u4fe1\u606f\uff08Using filesort, Using temporary \u9700\u8981\u4f18\u5316\uff09\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5ef6\u4f38\uff1a"})," \u53c2\u8003 ",(0,i.jsx)(n.a,{href:"/docs/mysql/performance-optimization",children:"MySQL \u6027\u80fd\u4f18\u5316"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"15-\u7f13\u5b58\u7a7f\u900f\u7f13\u5b58\u51fb\u7a7f\u7f13\u5b58\u96ea\u5d29\u5982\u4f55\u89e3\u51b3",children:"15. \u7f13\u5b58\u7a7f\u900f\u3001\u7f13\u5b58\u51fb\u7a7f\u3001\u7f13\u5b58\u96ea\u5d29\u5982\u4f55\u89e3\u51b3\uff1f"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u7b54\u6848\u8981\u70b9\uff1a"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u95ee\u9898"}),(0,i.jsx)(n.th,{children:"\u63cf\u8ff0"}),(0,i.jsx)(n.th,{children:"\u89e3\u51b3\u65b9\u6848"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"\u7f13\u5b58\u7a7f\u900f"})}),(0,i.jsx)(n.td,{children:"\u67e5\u8be2\u4e0d\u5b58\u5728\u7684\u6570\u636e"}),(0,i.jsx)(n.td,{children:"\u5e03\u9686\u8fc7\u6ee4\u5668\u3001\u7a7a\u503c\u7f13\u5b58"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"\u7f13\u5b58\u51fb\u7a7f"})}),(0,i.jsx)(n.td,{children:"\u70ed\u70b9 key \u8fc7\u671f"}),(0,i.jsx)(n.td,{children:"\u4e92\u65a5\u9501\u3001\u6c38\u4e0d\u8fc7\u671f"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"\u7f13\u5b58\u96ea\u5d29"})}),(0,i.jsx)(n.td,{children:"\u5927\u91cf key \u540c\u65f6\u8fc7\u671f"}),(0,i.jsx)(n.td,{children:"\u968f\u673a\u8fc7\u671f\u65f6\u95f4\u3001\u591a\u7ea7\u7f13\u5b58"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u7f13\u5b58\u7a7f\u900f\u89e3\u51b3\u65b9\u6848\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u65b9\u68481\uff1a\u5e03\u9686\u8fc7\u6ee4\u5668\npublic class BloomFilterDemo {\n    private BloomFilter<String> bloomFilter = BloomFilter.create(\n        Funnels.stringFunnel(Charset.defaultCharset()),\n        1000000,  // \u9884\u671f\u5143\u7d20\u6570\u91cf\n        0.01      // \u8bef\u5224\u7387\n    );\n    \n    public User getUser(String id) {\n        // \u5148\u68c0\u67e5\u5e03\u9686\u8fc7\u6ee4\u5668\n        if (!bloomFilter.mightContain(id)) {\n            return null;  // \u4e00\u5b9a\u4e0d\u5b58\u5728\n        }\n        // \u67e5\u7f13\u5b58\u548c\u6570\u636e\u5e93\n        return getUserFromCacheOrDB(id);\n    }\n}\n\n// \u65b9\u68482\uff1a\u7a7a\u503c\u7f13\u5b58\npublic User getUser(String id) {\n    String cacheKey = "user:" + id;\n    User user = cache.get(cacheKey);\n    \n    if (user == null) {\n        user = db.getUser(id);\n        if (user == null) {\n            // \u7f13\u5b58\u7a7a\u503c\uff0c\u8bbe\u7f6e\u8f83\u77ed\u8fc7\u671f\u65f6\u95f4\n            cache.set(cacheKey, NULL_USER, 60);\n        } else {\n            cache.set(cacheKey, user, 3600);\n        }\n    }\n    return user == NULL_USER ? null : user;\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u7f13\u5b58\u51fb\u7a7f\u89e3\u51b3\u65b9\u6848\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u65b9\u6848\uff1a\u4e92\u65a5\u9501\npublic User getUser(String id) {\n    String cacheKey = "user:" + id;\n    User user = cache.get(cacheKey);\n    \n    if (user == null) {\n        String lockKey = "lock:user:" + id;\n        // \u5c1d\u8bd5\u83b7\u53d6\u5206\u5e03\u5f0f\u9501\n        if (redis.setnx(lockKey, "1", 10)) {\n            try {\n                // \u53cc\u91cd\u68c0\u67e5\n                user = cache.get(cacheKey);\n                if (user == null) {\n                    user = db.getUser(id);\n                    cache.set(cacheKey, user, 3600);\n                }\n            } finally {\n                redis.del(lockKey);\n            }\n        } else {\n            // \u7b49\u5f85\u540e\u91cd\u8bd5\n            Thread.sleep(100);\n            return getUser(id);\n        }\n    }\n    return user;\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u7f13\u5b58\u96ea\u5d29\u89e3\u51b3\u65b9\u6848\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// \u65b9\u68481\uff1a\u968f\u673a\u8fc7\u671f\u65f6\u95f4\npublic void setCache(String key, Object value) {\n    int baseExpire = 3600;\n    int randomExpire = new Random().nextInt(600);  // 0-600\u79d2\u968f\u673a\n    cache.set(key, value, baseExpire + randomExpire);\n}\n\n// \u65b9\u68482\uff1a\u591a\u7ea7\u7f13\u5b58\npublic User getUser(String id) {\n    // L1: \u672c\u5730\u7f13\u5b58\uff08Caffeine\uff09\n    User user = localCache.get(id);\n    if (user != null) return user;\n    \n    // L2: \u5206\u5e03\u5f0f\u7f13\u5b58\uff08Redis\uff09\n    user = redisCache.get(id);\n    if (user != null) {\n        localCache.put(id, user);\n        return user;\n    }\n    \n    // L3: \u6570\u636e\u5e93\n    user = db.getUser(id);\n    redisCache.set(id, user);\n    localCache.put(id, user);\n    return user;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u5ef6\u4f38\uff1a"})," \u53c2\u8003 ",(0,i.jsx)(n.a,{href:"/docs/redis/cache-strategies",children:"Redis \u7f13\u5b58\u7b56\u7565"})]})]})}function o(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);
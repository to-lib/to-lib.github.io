"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[49931],{48885:(n,e,l)=>{l.d(e,{R:()=>s,x:()=>i});var r=l(99378);const c={},d=r.createContext(c);function s(n){const e=r.useContext(d);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(c):n.components||c:s(n.components),r.createElement(d.Provider,{value:e},n.children)}},86429:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>a,contentTitle:()=>i,default:()=>o,frontMatter:()=>s,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"linux/cron-scheduling","title":"\u5b9a\u65f6\u4efb\u52a1","description":"\u5b9a\u65f6\u4efb\u52a1\u662f Linux \u7cfb\u7edf\u81ea\u52a8\u5316\u7684\u6838\u5fc3\u529f\u80fd\uff0c\u53ef\u4ee5\u5728\u6307\u5b9a\u65f6\u95f4\u81ea\u52a8\u6267\u884c\u811a\u672c\u548c\u547d\u4ee4\u3002","source":"@site/docs/linux/cron-scheduling.md","sourceDirName":"linux","slug":"/linux/cron-scheduling","permalink":"/docs/linux/cron-scheduling","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/linux/cron-scheduling.md","tags":[],"version":"current","sidebarPosition":21,"frontMatter":{"sidebar_position":21,"title":"\u5b9a\u65f6\u4efb\u52a1"},"sidebar":"linux","previous":{"title":"\u670d\u52a1\u7ba1\u7406","permalink":"/docs/linux/service-management"},"next":{"title":"\u65e5\u5fd7\u7ba1\u7406","permalink":"/docs/linux/log-management"}}');var c=l(22714),d=l(48885);const s={sidebar_position:21,title:"\u5b9a\u65f6\u4efb\u52a1"},i="Linux \u5b9a\u65f6\u4efb\u52a1",a={},t=[{value:"Cron \u5b9a\u65f6\u4efb\u52a1",id:"cron-\u5b9a\u65f6\u4efb\u52a1",level:2},{value:"Cron \u8bed\u6cd5",id:"cron-\u8bed\u6cd5",level:3},{value:"\u7279\u6b8a\u7b26\u53f7",id:"\u7279\u6b8a\u7b26\u53f7",level:3},{value:"\u5e38\u7528\u65f6\u95f4\u8868\u8fbe\u5f0f",id:"\u5e38\u7528\u65f6\u95f4\u8868\u8fbe\u5f0f",level:3},{value:"\u9884\u5b9a\u4e49\u65f6\u95f4\u8868\u8fbe\u5f0f",id:"\u9884\u5b9a\u4e49\u65f6\u95f4\u8868\u8fbe\u5f0f",level:3},{value:"crontab \u547d\u4ee4",id:"crontab-\u547d\u4ee4",level:2},{value:"\u57fa\u672c\u64cd\u4f5c",id:"\u57fa\u672c\u64cd\u4f5c",level:3},{value:"crontab \u6587\u4ef6\u4f4d\u7f6e",id:"crontab-\u6587\u4ef6\u4f4d\u7f6e",level:3},{value:"\u7cfb\u7edf crontab \u683c\u5f0f",id:"\u7cfb\u7edf-crontab-\u683c\u5f0f",level:3},{value:"\u5b9a\u65f6\u4efb\u52a1\u793a\u4f8b",id:"\u5b9a\u65f6\u4efb\u52a1\u793a\u4f8b",level:2},{value:"\u5907\u4efd\u4efb\u52a1",id:"\u5907\u4efd\u4efb\u52a1",level:3},{value:"\u7cfb\u7edf\u7ef4\u62a4",id:"\u7cfb\u7edf\u7ef4\u62a4",level:3},{value:"\u76d1\u63a7\u4efb\u52a1",id:"\u76d1\u63a7\u4efb\u52a1",level:3},{value:"\u65e5\u5fd7\u548c\u8c03\u8bd5",id:"\u65e5\u5fd7\u548c\u8c03\u8bd5",level:2},{value:"\u67e5\u770b cron \u65e5\u5fd7",id:"\u67e5\u770b-cron-\u65e5\u5fd7",level:3},{value:"\u8f93\u51fa\u91cd\u5b9a\u5411",id:"\u8f93\u51fa\u91cd\u5b9a\u5411",level:3},{value:"\u8c03\u8bd5\u6280\u5de7",id:"\u8c03\u8bd5\u6280\u5de7",level:3},{value:"systemd \u5b9a\u65f6\u5668",id:"systemd-\u5b9a\u65f6\u5668",level:2},{value:"Timer \u5355\u5143\u6587\u4ef6",id:"timer-\u5355\u5143\u6587\u4ef6",level:3},{value:"\u5e38\u7528\u65f6\u95f4\u8868\u8fbe\u5f0f",id:"\u5e38\u7528\u65f6\u95f4\u8868\u8fbe\u5f0f-1",level:3},{value:"Timer \u7ba1\u7406\u547d\u4ee4",id:"timer-\u7ba1\u7406\u547d\u4ee4",level:3},{value:"Timer vs Cron \u5bf9\u6bd4",id:"timer-vs-cron-\u5bf9\u6bd4",level:3},{value:"at \u4e00\u6b21\u6027\u4efb\u52a1",id:"at-\u4e00\u6b21\u6027\u4efb\u52a1",level:2},{value:"\u57fa\u672c\u7528\u6cd5",id:"\u57fa\u672c\u7528\u6cd5",level:3},{value:"\u7ba1\u7406 at \u4efb\u52a1",id:"\u7ba1\u7406-at-\u4efb\u52a1",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u4f7f\u7528\u7edd\u5bf9\u8def\u5f84",id:"1-\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84",level:3},{value:"2. \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf",id:"2-\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf",level:3},{value:"3. \u4f7f\u7528\u9501\u6587\u4ef6\u9632\u6b62\u91cd\u590d\u6267\u884c",id:"3-\u4f7f\u7528\u9501\u6587\u4ef6\u9632\u6b62\u91cd\u590d\u6267\u884c",level:3},{value:"4. \u6dfb\u52a0\u6267\u884c\u65e5\u5fd7",id:"4-\u6dfb\u52a0\u6267\u884c\u65e5\u5fd7",level:3},{value:"5. \u9519\u8bef\u5904\u7406",id:"5-\u9519\u8bef\u5904\u7406",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function h(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...n.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(e.header,{children:(0,c.jsx)(e.h1,{id:"linux-\u5b9a\u65f6\u4efb\u52a1",children:"Linux \u5b9a\u65f6\u4efb\u52a1"})}),"\n",(0,c.jsx)(e.p,{children:"\u5b9a\u65f6\u4efb\u52a1\u662f Linux \u7cfb\u7edf\u81ea\u52a8\u5316\u7684\u6838\u5fc3\u529f\u80fd\uff0c\u53ef\u4ee5\u5728\u6307\u5b9a\u65f6\u95f4\u81ea\u52a8\u6267\u884c\u811a\u672c\u548c\u547d\u4ee4\u3002"}),"\n",(0,c.jsx)(e.h2,{id:"cron-\u5b9a\u65f6\u4efb\u52a1",children:"Cron \u5b9a\u65f6\u4efb\u52a1"}),"\n",(0,c.jsx)(e.h3,{id:"cron-\u8bed\u6cd5",children:"Cron \u8bed\u6cd5"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u5206\u949f (0-59)\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u5c0f\u65f6 (0-23)\n\u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u65e5\u671f (1-31)\n\u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u6708\u4efd (1-12)\n\u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u661f\u671f (0-7, 0\u548c7\u90fd\u8868\u793a\u5468\u65e5)\n\u2502 \u2502 \u2502 \u2502 \u2502\n\u2502 \u2502 \u2502 \u2502 \u2502\n* * * * * command\n"})}),"\n",(0,c.jsx)(e.h3,{id:"\u7279\u6b8a\u7b26\u53f7",children:"\u7279\u6b8a\u7b26\u53f7"}),"\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"\u7b26\u53f7"}),(0,c.jsx)(e.th,{children:"\u542b\u4e49"}),(0,c.jsx)(e.th,{children:"\u793a\u4f8b"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:"*"})}),(0,c.jsx)(e.td,{children:"\u4efb\u610f\u503c"}),(0,c.jsxs)(e.td,{children:[(0,c.jsx)(e.code,{children:"* * * * *"})," \u6bcf\u5206\u949f"]})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:","})}),(0,c.jsx)(e.td,{children:"\u5217\u4e3e"}),(0,c.jsxs)(e.td,{children:[(0,c.jsx)(e.code,{children:"0,30 * * * *"})," 0 \u5206\u548c 30 \u5206"]})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:"-"})}),(0,c.jsx)(e.td,{children:"\u8303\u56f4"}),(0,c.jsxs)(e.td,{children:[(0,c.jsx)(e.code,{children:"0-30 * * * *"})," 0-30 \u5206"]})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:(0,c.jsx)(e.code,{children:"/"})}),(0,c.jsx)(e.td,{children:"\u6b65\u957f"}),(0,c.jsxs)(e.td,{children:[(0,c.jsx)(e.code,{children:"*/5 * * * *"})," \u6bcf 5 \u5206\u949f"]})]})]})]}),"\n",(0,c.jsx)(e.h3,{id:"\u5e38\u7528\u65f6\u95f4\u8868\u8fbe\u5f0f",children:"\u5e38\u7528\u65f6\u95f4\u8868\u8fbe\u5f0f"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u6bcf\u5206\u949f\n* * * * * command\n\n# \u6bcf\u5c0f\u65f6\uff08\u6574\u70b9\uff09\n0 * * * * command\n\n# \u6bcf\u5929\u51cc\u66683\u70b9\n0 3 * * * command\n\n# \u6bcf\u5468\u4e00\u51cc\u66683\u70b9\n0 3 * * 1 command\n\n# \u6bcf\u67081\u53f7\u51cc\u66683\u70b9\n0 3 1 * * command\n\n# \u6bcf\u5e741\u67081\u65e5\u51cc\u66683\u70b9\n0 3 1 1 * command\n\n# \u6bcf5\u5206\u949f\n*/5 * * * * command\n\n# \u6bcf\u5c0f\u65f6\u7684\u7b2c30\u5206\u949f\n30 * * * * command\n\n# \u5de5\u4f5c\u65e5\u6bcf\u59299\u70b9\n0 9 * * 1-5 command\n\n# \u6bcf\u59299\u70b9\u548c18\u70b9\n0 9,18 * * * command\n\n# \u6bcf\u96942\u5c0f\u65f6\n0 */2 * * * command\n"})}),"\n",(0,c.jsx)(e.h3,{id:"\u9884\u5b9a\u4e49\u65f6\u95f4\u8868\u8fbe\u5f0f",children:"\u9884\u5b9a\u4e49\u65f6\u95f4\u8868\u8fbe\u5f0f"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"@reboot     # \u7cfb\u7edf\u542f\u52a8\u65f6\u6267\u884c\n@yearly     # \u6bcf\u5e74\u6267\u884c\u4e00\u6b21 (\u7b49\u540c\u4e8e 0 0 1 1 *)\n@annually   # \u540c @yearly\n@monthly    # \u6bcf\u6708\u6267\u884c\u4e00\u6b21 (\u7b49\u540c\u4e8e 0 0 1 * *)\n@weekly     # \u6bcf\u5468\u6267\u884c\u4e00\u6b21 (\u7b49\u540c\u4e8e 0 0 * * 0)\n@daily      # \u6bcf\u5929\u6267\u884c\u4e00\u6b21 (\u7b49\u540c\u4e8e 0 0 * * *)\n@midnight   # \u540c @daily\n@hourly     # \u6bcf\u5c0f\u65f6\u6267\u884c\u4e00\u6b21 (\u7b49\u540c\u4e8e 0 * * * *)\n"})}),"\n",(0,c.jsx)(e.h2,{id:"crontab-\u547d\u4ee4",children:"crontab \u547d\u4ee4"}),"\n",(0,c.jsx)(e.h3,{id:"\u57fa\u672c\u64cd\u4f5c",children:"\u57fa\u672c\u64cd\u4f5c"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u7f16\u8f91\u5f53\u524d\u7528\u6237\u7684 crontab\ncrontab -e\n\n# \u5217\u51fa\u5f53\u524d\u7528\u6237\u7684 crontab\ncrontab -l\n\n# \u5220\u9664\u5f53\u524d\u7528\u6237\u7684 crontab\ncrontab -r\n\n# \u7f16\u8f91\u6307\u5b9a\u7528\u6237\u7684 crontab\uff08\u9700\u8981 root \u6743\u9650\uff09\nsudo crontab -u username -e\n\n# \u5217\u51fa\u6307\u5b9a\u7528\u6237\u7684 crontab\nsudo crontab -u username -l\n"})}),"\n",(0,c.jsx)(e.h3,{id:"crontab-\u6587\u4ef6\u4f4d\u7f6e",children:"crontab \u6587\u4ef6\u4f4d\u7f6e"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u7528\u6237 crontab \u6587\u4ef6\n/var/spool/cron/crontabs/username   # Debian/Ubuntu\n/var/spool/cron/username            # RHEL/CentOS\n\n# \u7cfb\u7edf crontab \u6587\u4ef6\n/etc/crontab\n\n# \u7cfb\u7edf cron \u76ee\u5f55\n/etc/cron.d/          # \u81ea\u5b9a\u4e49\u7cfb\u7edf\u4efb\u52a1\n/etc/cron.hourly/     # \u6bcf\u5c0f\u65f6\u6267\u884c\n/etc/cron.daily/      # \u6bcf\u5929\u6267\u884c\n/etc/cron.weekly/     # \u6bcf\u5468\u6267\u884c\n/etc/cron.monthly/    # \u6bcf\u6708\u6267\u884c\n"})}),"\n",(0,c.jsx)(e.h3,{id:"\u7cfb\u7edf-crontab-\u683c\u5f0f",children:"\u7cfb\u7edf crontab \u683c\u5f0f"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# /etc/crontab \u683c\u5f0f\uff08\u591a\u4e00\u4e2a\u7528\u6237\u5b57\u6bb5\uff09\n# \u5206 \u65f6 \u65e5 \u6708 \u5468 \u7528\u6237 \u547d\u4ee4\n0 3 * * * root /usr/local/bin/backup.sh\n"})}),"\n",(0,c.jsx)(e.h2,{id:"\u5b9a\u65f6\u4efb\u52a1\u793a\u4f8b",children:"\u5b9a\u65f6\u4efb\u52a1\u793a\u4f8b"}),"\n",(0,c.jsx)(e.h3,{id:"\u5907\u4efd\u4efb\u52a1",children:"\u5907\u4efd\u4efb\u52a1"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'# \u6bcf\u5929\u51cc\u66682\u70b9\u5907\u4efd\u6570\u636e\u5e93\n0 2 * * * /usr/bin/mysqldump -u root -ppassword database > /backup/db_$(date +\\%Y\\%m\\%d).sql\n\n# \u6bcf\u5468\u65e5\u51cc\u66683\u70b9\u5907\u4efd\u76ee\u5f55\n0 3 * * 0 tar -czf /backup/home_$(date +\\%Y\\%m\\%d).tar.gz /home\n\n# \u6bcf\u5929\u6e05\u74067\u5929\u524d\u7684\u5907\u4efd\n0 4 * * * find /backup -name "*.sql" -mtime +7 -delete\n'})}),"\n",(0,c.jsx)(e.h3,{id:"\u7cfb\u7edf\u7ef4\u62a4",children:"\u7cfb\u7edf\u7ef4\u62a4"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u6bcf\u5929\u51cc\u66685\u70b9\u6e05\u7406\u4e34\u65f6\u6587\u4ef6\n0 5 * * * find /tmp -type f -atime +7 -delete\n\n# \u6bcf\u5c0f\u65f6\u540c\u6b65\u65f6\u95f4\n0 * * * * /usr/sbin/ntpdate pool.ntp.org > /dev/null 2>&1\n\n# \u6bcf\u5929\u6e05\u7406\u65e5\u5fd7\n0 0 * * * journalctl --vacuum-time=7d\n\n# \u6bcf\u5468\u65e5\u51cc\u6668\u66f4\u65b0\u7cfb\u7edf\uff08Debian/Ubuntu\uff09\n0 3 * * 0 apt update && apt upgrade -y\n"})}),"\n",(0,c.jsx)(e.h3,{id:"\u76d1\u63a7\u4efb\u52a1",children:"\u76d1\u63a7\u4efb\u52a1"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'# \u6bcf5\u5206\u949f\u68c0\u67e5\u670d\u52a1\u72b6\u6001\n*/5 * * * * /usr/local/bin/check_services.sh\n\n# \u6bcf\u5206\u949f\u68c0\u67e5\u78c1\u76d8\u7a7a\u95f4\n* * * * * df -h | awk \'$5 > 80 {print}\' | mail -s "\u78c1\u76d8\u544a\u8b66" admin@example.com\n\n# \u6bcf30\u5206\u949f\u68c0\u67e5\u7f51\u7ad9\u53ef\u7528\u6027\n*/30 * * * * curl -s -o /dev/null -w "%{http_code}" http://example.com | grep -q 200 || echo "\u7f51\u7ad9\u5f02\u5e38" | mail -s "\u7f51\u7ad9\u544a\u8b66" admin@example.com\n'})}),"\n",(0,c.jsx)(e.h2,{id:"\u65e5\u5fd7\u548c\u8c03\u8bd5",children:"\u65e5\u5fd7\u548c\u8c03\u8bd5"}),"\n",(0,c.jsx)(e.h3,{id:"\u67e5\u770b-cron-\u65e5\u5fd7",children:"\u67e5\u770b cron \u65e5\u5fd7"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# Debian/Ubuntu\ngrep CRON /var/log/syslog\ntail -f /var/log/syslog | grep CRON\n\n# RHEL/CentOS\ncat /var/log/cron\ntail -f /var/log/cron\n\n# \u4f7f\u7528 journalctl\njournalctl -u cron\njournalctl -u crond\n"})}),"\n",(0,c.jsx)(e.h3,{id:"\u8f93\u51fa\u91cd\u5b9a\u5411",children:"\u8f93\u51fa\u91cd\u5b9a\u5411"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'# \u4e22\u5f03\u6240\u6709\u8f93\u51fa\n* * * * * command > /dev/null 2>&1\n\n# \u8bb0\u5f55\u8f93\u51fa\u5230\u6587\u4ef6\n* * * * * command >> /var/log/mycron.log 2>&1\n\n# \u53ea\u8bb0\u5f55\u9519\u8bef\n* * * * * command > /dev/null 2>> /var/log/mycron_error.log\n\n# \u90ae\u4ef6\u901a\u77e5\uff08\u9700\u8981\u914d\u7f6e\u90ae\u4ef6\u670d\u52a1\uff09\nMAILTO="admin@example.com"\n* * * * * command\n'})}),"\n",(0,c.jsx)(e.h3,{id:"\u8c03\u8bd5\u6280\u5de7",children:"\u8c03\u8bd5\u6280\u5de7"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'# \u5728\u811a\u672c\u4e2d\u6dfb\u52a0\u8c03\u8bd5\u4fe1\u606f\n#!/bin/bash\necho "$(date): \u811a\u672c\u5f00\u59cb\u6267\u884c" >> /var/log/script_debug.log\n# ... \u811a\u672c\u5185\u5bb9\necho "$(date): \u811a\u672c\u6267\u884c\u5b8c\u6210" >> /var/log/script_debug.log\n\n# \u6d4b\u8bd5 cron \u73af\u5883\n* * * * * env > /tmp/cron_env.txt\n'})}),"\n",(0,c.jsx)(e.h2,{id:"systemd-\u5b9a\u65f6\u5668",children:"systemd \u5b9a\u65f6\u5668"}),"\n",(0,c.jsx)(e.h3,{id:"timer-\u5355\u5143\u6587\u4ef6",children:"Timer \u5355\u5143\u6587\u4ef6"}),"\n",(0,c.jsx)(e.p,{children:"systemd timer \u662f\u73b0\u4ee3 Linux \u7cfb\u7edf\u7684\u66ff\u4ee3\u65b9\u6848\uff0c\u63d0\u4f9b\u66f4\u5f3a\u5927\u7684\u529f\u80fd\u3002"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-ini",children:"# /etc/systemd/system/backup.timer\n[Unit]\nDescription=\u6bcf\u65e5\u5907\u4efd\u5b9a\u65f6\u5668\n\n[Timer]\nOnCalendar=*-*-* 02:00:00\nPersistent=true\n\n[Install]\nWantedBy=timers.target\n"})}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-ini",children:"# /etc/systemd/system/backup.service\n[Unit]\nDescription=\u6267\u884c\u5907\u4efd\u4efb\u52a1\n\n[Service]\nType=oneshot\nExecStart=/usr/local/bin/backup.sh\n"})}),"\n",(0,c.jsx)(e.h3,{id:"\u5e38\u7528\u65f6\u95f4\u8868\u8fbe\u5f0f-1",children:"\u5e38\u7528\u65f6\u95f4\u8868\u8fbe\u5f0f"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# OnCalendar \u65f6\u95f4\u683c\u5f0f\nOnCalendar=*-*-* 02:00:00           # \u6bcf\u5929\u51cc\u66682\u70b9\nOnCalendar=Mon *-*-* 02:00:00       # \u6bcf\u5468\u4e00\u51cc\u66682\u70b9\nOnCalendar=*-*-01 02:00:00          # \u6bcf\u67081\u53f7\u51cc\u66682\u70b9\nOnCalendar=hourly                    # \u6bcf\u5c0f\u65f6\nOnCalendar=daily                     # \u6bcf\u5929\nOnCalendar=weekly                    # \u6bcf\u5468\nOnCalendar=monthly                   # \u6bcf\u6708\n\n# \u5176\u4ed6\u89e6\u53d1\u65b9\u5f0f\nOnBootSec=5min                       # \u542f\u52a8\u540e5\u5206\u949f\nOnUnitActiveSec=1h                   # \u4e0a\u6b21\u6267\u884c\u540e1\u5c0f\u65f6\nOnUnitInactiveSec=1h                 # \u5355\u5143\u53d8\u4e3a\u975e\u6d3b\u52a8\u72b6\u6001\u540e1\u5c0f\u65f6\n"})}),"\n",(0,c.jsx)(e.h3,{id:"timer-\u7ba1\u7406\u547d\u4ee4",children:"Timer \u7ba1\u7406\u547d\u4ee4"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u542f\u7528\u548c\u542f\u52a8 timer\nsudo systemctl enable backup.timer\nsudo systemctl start backup.timer\n\n# \u67e5\u770b timer \u72b6\u6001\nsystemctl status backup.timer\nsystemctl list-timers\nsystemctl list-timers --all\n\n# \u7acb\u5373\u6267\u884c\u5173\u8054\u7684\u670d\u52a1\nsudo systemctl start backup.service\n\n# \u67e5\u770b\u65e5\u5fd7\njournalctl -u backup.service\n"})}),"\n",(0,c.jsx)(e.h3,{id:"timer-vs-cron-\u5bf9\u6bd4",children:"Timer vs Cron \u5bf9\u6bd4"}),"\n",(0,c.jsxs)(e.table,{children:[(0,c.jsx)(e.thead,{children:(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.th,{children:"\u7279\u6027"}),(0,c.jsx)(e.th,{children:"Cron"}),(0,c.jsx)(e.th,{children:"systemd Timer"})]})}),(0,c.jsxs)(e.tbody,{children:[(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u914d\u7f6e\u590d\u6742\u5ea6"}),(0,c.jsx)(e.td,{children:"\u7b80\u5355"}),(0,c.jsx)(e.td,{children:"\u7a0d\u590d\u6742"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u4f9d\u8d56\u7ba1\u7406"}),(0,c.jsx)(e.td,{children:"\u65e0"}),(0,c.jsx)(e.td,{children:"\u652f\u6301"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u65e5\u5fd7"}),(0,c.jsx)(e.td,{children:"syslog"}),(0,c.jsx)(e.td,{children:"journald"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u9519\u8fc7\u6267\u884c"}),(0,c.jsx)(e.td,{children:"\u4e22\u5931"}),(0,c.jsx)(e.td,{children:"\u53ef\u914d\u7f6e\u6301\u4e45\u5316"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u7cbe\u786e\u5ea6"}),(0,c.jsx)(e.td,{children:"\u5206\u949f\u7ea7"}),(0,c.jsx)(e.td,{children:"\u79d2\u7ea7"})]}),(0,c.jsxs)(e.tr,{children:[(0,c.jsx)(e.td,{children:"\u8d44\u6e90\u63a7\u5236"}),(0,c.jsx)(e.td,{children:"\u65e0"}),(0,c.jsx)(e.td,{children:"\u652f\u6301 cgroup"})]})]})]}),"\n",(0,c.jsx)(e.h2,{id:"at-\u4e00\u6b21\u6027\u4efb\u52a1",children:"at \u4e00\u6b21\u6027\u4efb\u52a1"}),"\n",(0,c.jsx)(e.h3,{id:"\u57fa\u672c\u7528\u6cd5",children:"\u57fa\u672c\u7528\u6cd5"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'# \u5728\u6307\u5b9a\u65f6\u95f4\u6267\u884c\u547d\u4ee4\nat 10:00\n> command\n> Ctrl+D\n\n# \u4f7f\u7528 echo \u8f93\u5165\necho "command" | at 10:00\n\n# \u4f7f\u7528\u65f6\u95f4\u8868\u8fbe\u5f0f\nat now + 5 minutes\nat now + 1 hour\nat now + 2 days\nat midnight\nat noon\nat teatime (16:00)\n\n# \u6307\u5b9a\u65e5\u671f\nat 10:00 AM Dec 25\nat 10:00 AM 12/25/2024\n'})}),"\n",(0,c.jsx)(e.h3,{id:"\u7ba1\u7406-at-\u4efb\u52a1",children:"\u7ba1\u7406 at \u4efb\u52a1"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u5217\u51fa\u5f85\u6267\u884c\u7684\u4efb\u52a1\natq\n\n# \u67e5\u770b\u4efb\u52a1\u5185\u5bb9\nat -c job_id\n\n# \u5220\u9664\u4efb\u52a1\natrm job_id\n\n# \u6279\u5904\u7406\u6a21\u5f0f\uff08\u7cfb\u7edf\u8d1f\u8f7d\u4f4e\u65f6\u6267\u884c\uff09\nbatch\n> command\n> Ctrl+D\n"})}),"\n",(0,c.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,c.jsx)(e.h3,{id:"1-\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84",children:"1. \u4f7f\u7528\u7edd\u5bf9\u8def\u5f84"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u9519\u8bef\uff1a\u53ef\u80fd\u627e\u4e0d\u5230\u547d\u4ee4\n* * * * * backup.sh\n\n# \u6b63\u786e\uff1a\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\n* * * * * /usr/local/bin/backup.sh\n"})}),"\n",(0,c.jsx)(e.h3,{id:"2-\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf",children:"2. \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# \u5728 crontab \u4e2d\u5b9a\u4e49\nPATH=/usr/local/bin:/usr/bin:/bin\nSHELL=/bin/bash\nMAILTO=admin@example.com\n\n# \u6216\u5728\u811a\u672c\u5f00\u5934\n#!/bin/bash\nexport PATH=/usr/local/bin:/usr/bin:/bin\n. /etc/profile\n"})}),"\n",(0,c.jsx)(e.h3,{id:"3-\u4f7f\u7528\u9501\u6587\u4ef6\u9632\u6b62\u91cd\u590d\u6267\u884c",children:"3. \u4f7f\u7528\u9501\u6587\u4ef6\u9632\u6b62\u91cd\u590d\u6267\u884c"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\nLOCKFILE="/tmp/myscript.lock"\n\nif [ -f "$LOCKFILE" ]; then\n    echo "\u811a\u672c\u6b63\u5728\u8fd0\u884c\u4e2d"\n    exit 1\nfi\n\ntrap "rm -f $LOCKFILE" EXIT\ntouch "$LOCKFILE"\n\n# \u811a\u672c\u4e3b\u4f53\n# ...\n'})}),"\n",(0,c.jsx)(e.h3,{id:"4-\u6dfb\u52a0\u6267\u884c\u65e5\u5fd7",children:"4. \u6dfb\u52a0\u6267\u884c\u65e5\u5fd7"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\nLOG_FILE="/var/log/mycron.log"\n\nlog() {\n    echo "[$(date \'+%Y-%m-%d %H:%M:%S\')] $*" >> "$LOG_FILE"\n}\n\nlog "\u5f00\u59cb\u6267\u884c"\n# \u4e3b\u8981\u903b\u8f91\nlog "\u6267\u884c\u5b8c\u6210"\n'})}),"\n",(0,c.jsx)(e.h3,{id:"5-\u9519\u8bef\u5904\u7406",children:"5. \u9519\u8bef\u5904\u7406"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\nset -e  # \u9047\u5230\u9519\u8bef\u7acb\u5373\u9000\u51fa\n\n# \u6216\u624b\u52a8\u5904\u7406\ncommand1 || { echo "command1 \u5931\u8d25" | mail -s "\u4efb\u52a1\u5931\u8d25" admin@example.com; exit 1; }\n'})}),"\n",(0,c.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,c.jsx)(e.p,{children:"\u672c\u6587\u4ecb\u7ecd\u4e86 Linux \u5b9a\u65f6\u4efb\u52a1\uff1a"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\u2705 Cron \u8bed\u6cd5\u548c\u8868\u8fbe\u5f0f"}),"\n",(0,c.jsx)(e.li,{children:"\u2705 crontab \u547d\u4ee4\u7ba1\u7406"}),"\n",(0,c.jsx)(e.li,{children:"\u2705 \u5b9a\u65f6\u4efb\u52a1\u5b9e\u9645\u6848\u4f8b"}),"\n",(0,c.jsx)(e.li,{children:"\u2705 \u65e5\u5fd7\u548c\u8c03\u8bd5\u6280\u5de7"}),"\n",(0,c.jsx)(e.li,{children:"\u2705 systemd \u5b9a\u65f6\u5668"}),"\n",(0,c.jsx)(e.li,{children:"\u2705 at \u4e00\u6b21\u6027\u4efb\u52a1"}),"\n",(0,c.jsx)(e.li,{children:"\u2705 \u6700\u4f73\u5b9e\u8df5"}),"\n"]}),"\n",(0,c.jsxs)(e.p,{children:["\u7ee7\u7eed\u5b66\u4e60 ",(0,c.jsx)(e.a,{href:"/docs/linux/service-management",children:"\u670d\u52a1\u7ba1\u7406"})," \u548c ",(0,c.jsx)(e.a,{href:"/docs/linux/shell-scripting",children:"Shell \u811a\u672c"}),"\u3002"]})]})}function o(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,c.jsx)(e,{...n,children:(0,c.jsx)(h,{...n})}):h(n)}}}]);
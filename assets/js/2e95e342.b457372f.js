"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[86344],{24060:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"microservices/observability","title":"\u53ef\u89c2\u6d4b\u6027","description":"\u5fae\u670d\u52a1\u53ef\u89c2\u6d4b\u6027 - \u94fe\u8def\u8ffd\u8e2a\u3001\u65e5\u5fd7\u805a\u5408\u3001\u6307\u6807\u76d1\u63a7\u3001\u5065\u5eb7\u68c0\u67e5","source":"@site/docs/microservices/observability.md","sourceDirName":"microservices","slug":"/microservices/observability","permalink":"/docs/microservices/observability","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/microservices/observability.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"\u53ef\u89c2\u6d4b\u6027","description":"\u5fae\u670d\u52a1\u53ef\u89c2\u6d4b\u6027 - \u94fe\u8def\u8ffd\u8e2a\u3001\u65e5\u5fd7\u805a\u5408\u3001\u6307\u6807\u76d1\u63a7\u3001\u5065\u5eb7\u68c0\u67e5"},"sidebar":"microservices","previous":{"title":"\u670d\u52a1\u6cbb\u7406","permalink":"/docs/microservices/service-governance"},"next":{"title":"\u90e8\u7f72\u4e0e\u8fd0\u7ef4","permalink":"/docs/microservices/deployment"}}');var i=r(22714),s=r(48885);const a={sidebar_position:5,title:"\u53ef\u89c2\u6d4b\u6027",description:"\u5fae\u670d\u52a1\u53ef\u89c2\u6d4b\u6027 - \u94fe\u8def\u8ffd\u8e2a\u3001\u65e5\u5fd7\u805a\u5408\u3001\u6307\u6807\u76d1\u63a7\u3001\u5065\u5eb7\u68c0\u67e5"},l="\u53ef\u89c2\u6d4b\u6027",d={},c=[{value:"\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a",id:"\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:3},{value:"\u6838\u5fc3\u6982\u5ff5",id:"\u6838\u5fc3\u6982\u5ff5",level:3},{value:"Jaeger \u96c6\u6210",id:"jaeger-\u96c6\u6210",level:3},{value:"Spring Cloud Sleuth\uff08\u65e7\u7248\u672c\uff09",id:"spring-cloud-sleuth\u65e7\u7248\u672c",level:3},{value:"\u65e5\u5fd7\u805a\u5408",id:"\u65e5\u5fd7\u805a\u5408",level:2},{value:"ELK Stack",id:"elk-stack",level:3},{value:"\u7ed3\u6784\u5316\u65e5\u5fd7",id:"\u7ed3\u6784\u5316\u65e5\u5fd7",level:3},{value:"Filebeat \u914d\u7f6e",id:"filebeat-\u914d\u7f6e",level:3},{value:"\u6307\u6807\u76d1\u63a7",id:"\u6307\u6807\u76d1\u63a7",level:2},{value:"Prometheus + Grafana",id:"prometheus--grafana",level:3},{value:"Spring Boot Actuator",id:"spring-boot-actuator",level:3},{value:"\u81ea\u5b9a\u4e49\u6307\u6807",id:"\u81ea\u5b9a\u4e49\u6307\u6807",level:3},{value:"Prometheus \u914d\u7f6e",id:"prometheus-\u914d\u7f6e",level:3},{value:"\u544a\u8b66\u89c4\u5219",id:"\u544a\u8b66\u89c4\u5219",level:3},{value:"\u5065\u5eb7\u68c0\u67e5",id:"\u5065\u5eb7\u68c0\u67e5",level:2},{value:"Spring Boot Health",id:"spring-boot-health",level:3},{value:"Kubernetes \u5065\u5eb7\u68c0\u67e5",id:"kubernetes-\u5065\u5eb7\u68c0\u67e5",level:3},{value:"\u53ef\u89c2\u6d4b\u6027\u6700\u4f73\u5b9e\u8df5",id:"\u53ef\u89c2\u6d4b\u6027\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u7edf\u4e00\u65e5\u5fd7\u683c\u5f0f",id:"\u7edf\u4e00\u65e5\u5fd7\u683c\u5f0f",level:3},{value:"\u5173\u952e\u6307\u6807",id:"\u5173\u952e\u6307\u6807",level:3},{value:"\u544a\u8b66\u7b56\u7565",id:"\u544a\u8b66\u7b56\u7565",level:3}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u53ef\u89c2\u6d4b\u6027",children:"\u53ef\u89c2\u6d4b\u6027"})}),"\n",(0,i.jsx)(n.p,{children:"\u53ef\u89c2\u6d4b\u6027\u662f\u5fae\u670d\u52a1\u67b6\u6784\u7684\u5173\u952e\u80fd\u529b\uff0c\u5305\u62ec\u4e09\u5927\u652f\u67f1\uff1a\u65e5\u5fd7\uff08Logging\uff09\u3001\u6307\u6807\uff08Metrics\uff09\u3001\u8ffd\u8e2a\uff08Tracing\uff09\u3002"}),"\n",(0,i.jsx)(n.mermaid,{value:"graph TB\n    subgraph \u53ef\u89c2\u6d4b\u6027\u4e09\u652f\u67f1\n        L[\u65e5\u5fd7 Logging]\n        M[\u6307\u6807 Metrics]\n        T[\u8ffd\u8e2a Tracing]\n    end\n    \n    L --\x3e |ELK Stack| LA[\u65e5\u5fd7\u805a\u5408]\n    M --\x3e |Prometheus| MA[\u6307\u6807\u76d1\u63a7]\n    T --\x3e |Jaeger| TA[\u94fe\u8def\u8ffd\u8e2a]\n    \n    LA --\x3e D[Dashboard]\n    MA --\x3e D\n    TA --\x3e D"}),"\n",(0,i.jsx)(n.h2,{id:"\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a",children:"\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a"}),"\n",(0,i.jsx)(n.h3,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,i.jsx)(n.p,{children:"\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7528\u4e8e\u8ddf\u8e2a\u8bf7\u6c42\u5728\u591a\u4e2a\u670d\u52a1\u95f4\u7684\u8c03\u7528\u94fe\u8def\uff0c\u5e2e\u52a9\u5b9a\u4f4d\u6027\u80fd\u74f6\u9888\u548c\u6545\u969c\u70b9\u3002"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant C as \u5ba2\u6237\u7aef\n    participant G as API \u7f51\u5173\n    participant U as \u7528\u6237\u670d\u52a1\n    participant O as \u8ba2\u5355\u670d\u52a1\n    participant P as \u652f\u4ed8\u670d\u52a1\n    \n    Note over C,P: TraceID: abc123\n    C->>G: \u8bf7\u6c42 (SpanID: 1)\n    G->>U: \u8c03\u7528 (SpanID: 2, ParentID: 1)\n    G->>O: \u8c03\u7528 (SpanID: 3, ParentID: 1)\n    O->>P: \u8c03\u7528 (SpanID: 4, ParentID: 3)\n    P--\x3e>O: \u54cd\u5e94\n    O--\x3e>G: \u54cd\u5e94\n    U--\x3e>G: \u54cd\u5e94\n    G--\x3e>C: \u54cd\u5e94"}),"\n",(0,i.jsx)(n.h3,{id:"\u6838\u5fc3\u6982\u5ff5",children:"\u6838\u5fc3\u6982\u5ff5"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u6982\u5ff5"}),(0,i.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Trace"})}),(0,i.jsx)(n.td,{children:"\u4e00\u6b21\u5b8c\u6574\u8bf7\u6c42\u7684\u8c03\u7528\u94fe"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Span"})}),(0,i.jsx)(n.td,{children:"\u8c03\u7528\u94fe\u4e2d\u7684\u4e00\u4e2a\u64cd\u4f5c\u5355\u5143"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"TraceID"})}),(0,i.jsx)(n.td,{children:"\u552f\u4e00\u6807\u8bc6\u4e00\u4e2a Trace"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"SpanID"})}),(0,i.jsx)(n.td,{children:"\u552f\u4e00\u6807\u8bc6\u4e00\u4e2a Span"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"ParentSpanID"})}),(0,i.jsx)(n.td,{children:"\u7236 Span \u7684 ID"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"jaeger-\u96c6\u6210",children:"Jaeger \u96c6\u6210"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u542f\u52a8 Jaeger\ndocker run -d --name jaeger \\\n  -p 6831:6831/udp \\\n  -p 16686:16686 \\\n  jaegertracing/all-in-one:latest\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"\x3c!-- pom.xml --\x3e\n<dependency>\n    <groupId>io.opentelemetry</groupId>\n    <artifactId>opentelemetry-api</artifactId>\n</dependency>\n<dependency>\n    <groupId>io.opentelemetry</groupId>\n    <artifactId>opentelemetry-sdk</artifactId>\n</dependency>\n<dependency>\n    <groupId>io.opentelemetry</groupId>\n    <artifactId>opentelemetry-exporter-jaeger</artifactId>\n</dependency>\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// OpenTelemetry \u914d\u7f6e\n@Configuration\npublic class TracingConfig {\n    \n    @Bean\n    public OpenTelemetry openTelemetry() {\n        JaegerGrpcSpanExporter exporter = JaegerGrpcSpanExporter.builder()\n            .setEndpoint("http://localhost:14250")\n            .build();\n        \n        SdkTracerProvider tracerProvider = SdkTracerProvider.builder()\n            .addSpanProcessor(BatchSpanProcessor.builder(exporter).build())\n            .setResource(Resource.create(Attributes.of(\n                ResourceAttributes.SERVICE_NAME, "user-service"\n            )))\n            .build();\n        \n        return OpenTelemetrySdk.builder()\n            .setTracerProvider(tracerProvider)\n            .buildAndRegisterGlobal();\n    }\n}\n\n// \u624b\u52a8\u521b\u5efa Span\n@Service\npublic class UserService {\n    \n    @Autowired\n    private Tracer tracer;\n    \n    public User getUser(Long id) {\n        Span span = tracer.spanBuilder("getUser")\n            .setAttribute("user.id", id)\n            .startSpan();\n        \n        try (Scope scope = span.makeCurrent()) {\n            User user = userRepository.findById(id).orElseThrow();\n            span.setAttribute("user.name", user.getName());\n            return user;\n        } catch (Exception e) {\n            span.recordException(e);\n            span.setStatus(StatusCode.ERROR, e.getMessage());\n            throw e;\n        } finally {\n            span.end();\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"spring-cloud-sleuth\u65e7\u7248\u672c",children:"Spring Cloud Sleuth\uff08\u65e7\u7248\u672c\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# application.yml\nspring:\n  sleuth:\n    sampler:\n      probability: 1.0\n  zipkin:\n    base-url: http://localhost:9411\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u65e5\u5fd7\u805a\u5408",children:"\u65e5\u5fd7\u805a\u5408"}),"\n",(0,i.jsx)(n.h3,{id:"elk-stack",children:"ELK Stack"}),"\n",(0,i.jsx)(n.p,{children:"ELK\uff08Elasticsearch + Logstash + Kibana\uff09\u662f\u6700\u6d41\u884c\u7684\u65e5\u5fd7\u805a\u5408\u65b9\u6848\u3002"}),"\n",(0,i.jsx)(n.mermaid,{value:"graph LR\n    A[\u670d\u52a1 A] --\x3e|\u65e5\u5fd7| F[Filebeat]\n    B[\u670d\u52a1 B] --\x3e|\u65e5\u5fd7| F\n    C[\u670d\u52a1 C] --\x3e|\u65e5\u5fd7| F\n    F --\x3e L[Logstash]\n    L --\x3e E[Elasticsearch]\n    E --\x3e K[Kibana]"}),"\n",(0,i.jsx)(n.h3,{id:"\u7ed3\u6784\u5316\u65e5\u5fd7",children:"\u7ed3\u6784\u5316\u65e5\u5fd7"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// logback-spring.xml\n@Configuration\npublic class LogConfig {\n    // \u4f7f\u7528 JSON \u683c\u5f0f\u8f93\u51fa\u65e5\u5fd7\n}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'\x3c!-- logback-spring.xml --\x3e\n<configuration>\n    <appender name="JSON" class="ch.qos.logback.core.ConsoleAppender">\n        <encoder class="net.logstash.logback.encoder.LogstashEncoder">\n            <includeMdcKeyName>traceId</includeMdcKeyName>\n            <includeMdcKeyName>spanId</includeMdcKeyName>\n            <customFields>{"service":"user-service"}</customFields>\n        </encoder>\n    </appender>\n    \n    <root level="INFO">\n        <appender-ref ref="JSON"/>\n    </root>\n</configuration>\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u4f7f\u7528 MDC \u6dfb\u52a0\u4e0a\u4e0b\u6587\n@Aspect\n@Component\npublic class LoggingAspect {\n    \n    @Around("@annotation(org.springframework.web.bind.annotation.RequestMapping)")\n    public Object logRequest(ProceedingJoinPoint joinPoint) throws Throwable {\n        String requestId = UUID.randomUUID().toString();\n        MDC.put("requestId", requestId);\n        \n        try {\n            log.info("\u5f00\u59cb\u5904\u7406\u8bf7\u6c42: {}", joinPoint.getSignature().getName());\n            Object result = joinPoint.proceed();\n            log.info("\u8bf7\u6c42\u5904\u7406\u5b8c\u6210");\n            return result;\n        } finally {\n            MDC.clear();\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"filebeat-\u914d\u7f6e",children:"Filebeat \u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# filebeat.yml\nfilebeat.inputs:\n  - type: container\n    paths:\n      - /var/lib/docker/containers/*/*.log\n    processors:\n      - add_kubernetes_metadata:\n          host: ${NODE_NAME}\n          matchers:\n            - logs_path:\n                logs_path: "/var/lib/docker/containers/"\n\noutput.elasticsearch:\n  hosts: ["elasticsearch:9200"]\n  index: "microservices-%{+yyyy.MM.dd}"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u6307\u6807\u76d1\u63a7",children:"\u6307\u6807\u76d1\u63a7"}),"\n",(0,i.jsx)(n.h3,{id:"prometheus--grafana",children:"Prometheus + Grafana"}),"\n",(0,i.jsx)(n.mermaid,{value:"graph LR\n    A[\u670d\u52a1 A] --\x3e|/metrics| P[Prometheus]\n    B[\u670d\u52a1 B] --\x3e|/metrics| P\n    C[\u670d\u52a1 C] --\x3e|/metrics| P\n    P --\x3e G[Grafana]\n    P --\x3e A2[AlertManager]"}),"\n",(0,i.jsx)(n.h3,{id:"spring-boot-actuator",children:"Spring Boot Actuator"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-actuator</artifactId>\n</dependency>\n<dependency>\n    <groupId>io.micrometer</groupId>\n    <artifactId>micrometer-registry-prometheus</artifactId>\n</dependency>\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# application.yml\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: health,info,prometheus,metrics\n  metrics:\n    tags:\n      application: ${spring.application.name}\n    export:\n      prometheus:\n        enabled: true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49\u6307\u6807",children:"\u81ea\u5b9a\u4e49\u6307\u6807"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Service\npublic class OrderService {\n    \n    private final Counter orderCounter;\n    private final Timer orderTimer;\n    private final Gauge activeOrders;\n    \n    public OrderService(MeterRegistry registry) {\n        this.orderCounter = Counter.builder("orders.created")\n            .description("\u521b\u5efa\u7684\u8ba2\u5355\u6570\u91cf")\n            .tag("service", "order-service")\n            .register(registry);\n        \n        this.orderTimer = Timer.builder("orders.processing.time")\n            .description("\u8ba2\u5355\u5904\u7406\u65f6\u95f4")\n            .register(registry);\n        \n        this.activeOrders = Gauge.builder("orders.active", this, OrderService::getActiveOrderCount)\n            .description("\u6d3b\u8dc3\u8ba2\u5355\u6570\u91cf")\n            .register(registry);\n    }\n    \n    public Order createOrder(OrderDTO dto) {\n        return orderTimer.record(() -> {\n            Order order = orderRepository.save(new Order(dto));\n            orderCounter.increment();\n            return order;\n        });\n    }\n    \n    private double getActiveOrderCount() {\n        return orderRepository.countByStatus(OrderStatus.PROCESSING);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"prometheus-\u914d\u7f6e",children:"Prometheus \u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# prometheus.yml\nglobal:\n  scrape_interval: 15s\n\nscrape_configs:\n  - job_name: 'spring-boot'\n    metrics_path: '/actuator/prometheus'\n    static_configs:\n      - targets: ['user-service:8080', 'order-service:8080']\n    \n  - job_name: 'kubernetes-pods'\n    kubernetes_sd_configs:\n      - role: pod\n    relabel_configs:\n      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]\n        action: keep\n        regex: true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u544a\u8b66\u89c4\u5219",children:"\u544a\u8b66\u89c4\u5219"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# alert-rules.yml\ngroups:\n  - name: microservices\n    rules:\n      - alert: HighErrorRate\n        expr: rate(http_server_requests_seconds_count{status=~"5.."}[5m]) > 0.1\n        for: 5m\n        labels:\n          severity: critical\n        annotations:\n          summary: "\u9ad8\u9519\u8bef\u7387\u544a\u8b66"\n          description: "\u670d\u52a1 {{ $labels.application }} \u9519\u8bef\u7387\u8d85\u8fc7 10%"\n      \n      - alert: HighLatency\n        expr: histogram_quantile(0.95, rate(http_server_requests_seconds_bucket[5m])) > 1\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: "\u9ad8\u5ef6\u8fdf\u544a\u8b66"\n          description: "\u670d\u52a1 {{ $labels.application }} P95 \u5ef6\u8fdf\u8d85\u8fc7 1 \u79d2"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5065\u5eb7\u68c0\u67e5",children:"\u5065\u5eb7\u68c0\u67e5"}),"\n",(0,i.jsx)(n.h3,{id:"spring-boot-health",children:"Spring Boot Health"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Component\npublic class DatabaseHealthIndicator implements HealthIndicator {\n    \n    @Autowired\n    private DataSource dataSource;\n    \n    @Override\n    public Health health() {\n        try (Connection conn = dataSource.getConnection()) {\n            if (conn.isValid(1)) {\n                return Health.up()\n                    .withDetail("database", "MySQL")\n                    .withDetail("status", "\u8fde\u63a5\u6b63\u5e38")\n                    .build();\n            }\n        } catch (SQLException e) {\n            return Health.down()\n                .withDetail("error", e.getMessage())\n                .build();\n        }\n        return Health.down().build();\n    }\n}\n\n@Component\npublic class ExternalServiceHealthIndicator implements HealthIndicator {\n    \n    @Autowired\n    private RestTemplate restTemplate;\n    \n    @Override\n    public Health health() {\n        try {\n            ResponseEntity<String> response = restTemplate.getForEntity(\n                "http://external-service/health", String.class);\n            \n            if (response.getStatusCode().is2xxSuccessful()) {\n                return Health.up().build();\n            }\n        } catch (Exception e) {\n            return Health.down()\n                .withDetail("error", e.getMessage())\n                .build();\n        }\n        return Health.down().build();\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"kubernetes-\u5065\u5eb7\u68c0\u67e5",children:"Kubernetes \u5065\u5eb7\u68c0\u67e5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# deployment.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: user-service\nspec:\n  template:\n    spec:\n      containers:\n        - name: user-service\n          image: user-service:latest\n          ports:\n            - containerPort: 8080\n          livenessProbe:\n            httpGet:\n              path: /actuator/health/liveness\n              port: 8080\n            initialDelaySeconds: 30\n            periodSeconds: 10\n            failureThreshold: 3\n          readinessProbe:\n            httpGet:\n              path: /actuator/health/readiness\n              port: 8080\n            initialDelaySeconds: 10\n            periodSeconds: 5\n            failureThreshold: 3\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# application.yml\nmanagement:\n  endpoint:\n    health:\n      probes:\n        enabled: true\n      group:\n        liveness:\n          include: livenessState\n        readiness:\n          include: readinessState,db,redis\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u53ef\u89c2\u6d4b\u6027\u6700\u4f73\u5b9e\u8df5",children:"\u53ef\u89c2\u6d4b\u6027\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsx)(n.h3,{id:"\u7edf\u4e00\u65e5\u5fd7\u683c\u5f0f",children:"\u7edf\u4e00\u65e5\u5fd7\u683c\u5f0f"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "timestamp": "2024-01-15T10:30:00.000Z",\n  "level": "INFO",\n  "service": "user-service",\n  "traceId": "abc123",\n  "spanId": "def456",\n  "message": "\u7528\u6237\u767b\u5f55\u6210\u529f",\n  "userId": 12345,\n  "duration": 150\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u5173\u952e\u6307\u6807",children:"\u5173\u952e\u6307\u6807"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,i.jsx)(n.th,{children:"\u6307\u6807"}),(0,i.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"RED"})}),(0,i.jsx)(n.td,{children:"Rate"}),(0,i.jsx)(n.td,{children:"\u8bf7\u6c42\u901f\u7387"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Errors"}),(0,i.jsx)(n.td,{children:"\u9519\u8bef\u7387"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Duration"}),(0,i.jsx)(n.td,{children:"\u54cd\u5e94\u65f6\u95f4"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"USE"})}),(0,i.jsx)(n.td,{children:"Utilization"}),(0,i.jsx)(n.td,{children:"\u8d44\u6e90\u5229\u7528\u7387"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Saturation"}),(0,i.jsx)(n.td,{children:"\u9971\u548c\u5ea6"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Errors"}),(0,i.jsx)(n.td,{children:"\u9519\u8bef\u6570"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\u544a\u8b66\u7b56\u7565",children:"\u544a\u8b66\u7b56\u7565"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5206\u7ea7\u544a\u8b66"}),"\uff1aP0\uff08\u7acb\u5373\u5904\u7406\uff09\u3001P1\uff081\u5c0f\u65f6\u5185\uff09\u3001P2\uff08\u5f53\u5929\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u544a\u8b66\u6536\u655b"}),"\uff1a\u76f8\u540c\u544a\u8b66\u5408\u5e76\uff0c\u907f\u514d\u544a\u8b66\u98ce\u66b4"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u544a\u8b66\u5347\u7ea7"}),"\uff1a\u672a\u5904\u7406\u7684\u544a\u8b66\u81ea\u52a8\u5347\u7ea7"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u503c\u73ed\u8f6e\u6362"}),"\uff1a\u5efa\u7acb On-Call \u673a\u5236"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},48885:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>l});var t=r(99378);const i={},s=t.createContext(i);function a(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);
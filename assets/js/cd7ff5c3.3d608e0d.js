"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[90236],{43709:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>h,contentTitle:()=>c,default:()=>a,frontMatter:()=>r,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"redis/monitoring-and-troubleshooting","title":"\u76d1\u63a7\u4e0e\u6392\u969c","description":"\u672c\u7ae0\u76ee\u6807\uff1a\u628a Redis \u7684\u201c\u73b0\u8c61\u201d\u5feb\u901f\u5b9a\u4f4d\u5230\u201c\u539f\u56e0\u201d\uff0c\u5e76\u7ed9\u51fa\u53ef\u4ee5\u843d\u5730\u7684\u6392\u67e5\u987a\u5e8f\u3002","source":"@site/docs/redis/monitoring-and-troubleshooting.md","sourceDirName":"redis","slug":"/redis/monitoring-and-troubleshooting","permalink":"/docs/redis/monitoring-and-troubleshooting","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/redis/monitoring-and-troubleshooting.md","tags":[],"version":"current","sidebarPosition":25,"frontMatter":{"sidebar_position":25,"title":"\u76d1\u63a7\u4e0e\u6392\u969c"},"sidebar":"redis","previous":{"title":"\u914d\u7f6e\u4e0e\u90e8\u7f72","permalink":"/docs/redis/configuration"},"next":{"title":"\u5907\u4efd\u4e0e\u6062\u590d","permalink":"/docs/redis/backup-and-recovery"}}');var l=i(22714),d=i(48885);const r={sidebar_position:25,title:"\u76d1\u63a7\u4e0e\u6392\u969c"},c="Redis \u76d1\u63a7\u4e0e\u6392\u969c",h={},o=[{value:"\u5173\u952e\u76d1\u63a7\u6307\u6807\uff08\u5fc5\u5907\uff09",id:"\u5173\u952e\u76d1\u63a7\u6307\u6807\u5fc5\u5907",level:2},{value:"1. \u53ef\u7528\u6027",id:"1-\u53ef\u7528\u6027",level:3},{value:"2. \u541e\u5410\u4e0e\u5ef6\u8fdf",id:"2-\u541e\u5410\u4e0e\u5ef6\u8fdf",level:3},{value:"3. \u547d\u4e2d\u7387\uff08\u7f13\u5b58\u573a\u666f\uff09",id:"3-\u547d\u4e2d\u7387\u7f13\u5b58\u573a\u666f",level:3},{value:"4. \u5185\u5b58\u4e0e\u788e\u7247",id:"4-\u5185\u5b58\u4e0e\u788e\u7247",level:3},{value:"5. \u6162\u67e5\u8be2",id:"5-\u6162\u67e5\u8be2",level:3},{value:"\u5e38\u89c1\u6545\u969c\u573a\u666f\u4e0e\u6392\u67e5\u8def\u5f84",id:"\u5e38\u89c1\u6545\u969c\u573a\u666f\u4e0e\u6392\u67e5\u8def\u5f84",level:2},{value:"1) \u8fde\u63a5\u4e0d\u4e0a Redis",id:"1-\u8fde\u63a5\u4e0d\u4e0a-redis",level:2},{value:"2) CPU \u98d9\u9ad8 / QPS \u5f88\u9ad8",id:"2-cpu-\u98d9\u9ad8--qps-\u5f88\u9ad8",level:2},{value:"3) \u5185\u5b58\u6301\u7eed\u589e\u957f / OOM / \u9891\u7e41\u6dd8\u6c70",id:"3-\u5185\u5b58\u6301\u7eed\u589e\u957f--oom--\u9891\u7e41\u6dd8\u6c70",level:2},{value:"4) \u4e3b\u4ece\u5ef6\u8fdf / \u6570\u636e\u4e0d\u4e00\u81f4",id:"4-\u4e3b\u4ece\u5ef6\u8fdf--\u6570\u636e\u4e0d\u4e00\u81f4",level:2},{value:"5) \u96c6\u7fa4\u95ee\u9898\uff08MOVED/ASK/\u69fd\u4f4d\u4e0d\u5747\uff09",id:"5-\u96c6\u7fa4\u95ee\u9898movedask\u69fd\u4f4d\u4e0d\u5747",level:2},{value:"\u65e5\u5fd7\u4e0e\u57fa\u7840\u8bca\u65ad\u547d\u4ee4",id:"\u65e5\u5fd7\u4e0e\u57fa\u7840\u8bca\u65ad\u547d\u4ee4",level:2},{value:"Prometheus \u76d1\u63a7\uff08\u53ef\u9009\uff09",id:"prometheus-\u76d1\u63a7\u53ef\u9009",level:2},{value:"\u6392\u969c\u6700\u5c0f\u6e05\u5355",id:"\u6392\u969c\u6700\u5c0f\u6e05\u5355",level:2}];function t(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.header,{children:(0,l.jsx)(s.h1,{id:"redis-\u76d1\u63a7\u4e0e\u6392\u969c",children:"Redis \u76d1\u63a7\u4e0e\u6392\u969c"})}),"\n",(0,l.jsx)(s.p,{children:"\u672c\u7ae0\u76ee\u6807\uff1a\u628a Redis \u7684\u201c\u73b0\u8c61\u201d\u5feb\u901f\u5b9a\u4f4d\u5230\u201c\u539f\u56e0\u201d\uff0c\u5e76\u7ed9\u51fa\u53ef\u4ee5\u843d\u5730\u7684\u6392\u67e5\u987a\u5e8f\u3002"}),"\n",(0,l.jsx)(s.h2,{id:"\u5173\u952e\u76d1\u63a7\u6307\u6807\u5fc5\u5907",children:"\u5173\u952e\u76d1\u63a7\u6307\u6807\uff08\u5fc5\u5907\uff09"}),"\n",(0,l.jsx)(s.h3,{id:"1-\u53ef\u7528\u6027",children:"1. \u53ef\u7528\u6027"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"redis-cli PING\nredis-cli INFO server\n"})}),"\n",(0,l.jsx)(s.p,{children:"\u5173\u6ce8\uff1a"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.code,{children:"uptime_in_seconds"})}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"role"}),"\uff08\u4e3b/\u4ece\uff09"]}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"2-\u541e\u5410\u4e0e\u5ef6\u8fdf",children:"2. \u541e\u5410\u4e0e\u5ef6\u8fdf"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"redis-cli INFO stats\nredis-cli --stat\n"})}),"\n",(0,l.jsx)(s.p,{children:"\u5173\u6ce8\uff1a"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.code,{children:"instantaneous_ops_per_sec"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.code,{children:"total_commands_processed"})}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"3-\u547d\u4e2d\u7387\u7f13\u5b58\u573a\u666f",children:"3. \u547d\u4e2d\u7387\uff08\u7f13\u5b58\u573a\u666f\uff09"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"redis-cli INFO stats | grep -E 'keyspace_(hits|misses)'\n"})}),"\n",(0,l.jsx)(s.p,{children:"\u8ba1\u7b97\uff1a"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\u547d\u4e2d\u7387 = ",(0,l.jsx)(s.code,{children:"keyspace_hits / (keyspace_hits + keyspace_misses)"})]}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"4-\u5185\u5b58\u4e0e\u788e\u7247",children:"4. \u5185\u5b58\u4e0e\u788e\u7247"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"redis-cli INFO memory\n"})}),"\n",(0,l.jsx)(s.p,{children:"\u5173\u6ce8\uff1a"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.code,{children:"used_memory"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.code,{children:"used_memory_rss"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.code,{children:"mem_fragmentation_ratio"})}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["\u66f4\u591a\u89c1\uff1a",(0,l.jsx)(s.a,{href:"/docs/redis/memory-management",children:"\u5185\u5b58\u7ba1\u7406"})]}),"\n",(0,l.jsx)(s.h3,{id:"5-\u6162\u67e5\u8be2",children:"5. \u6162\u67e5\u8be2"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"redis-cli SLOWLOG LEN\nredis-cli SLOWLOG GET 10\n"})}),"\n",(0,l.jsxs)(s.p,{children:["\u914d\u7f6e\u5efa\u8bae\u89c1\uff1a",(0,l.jsx)(s.a,{href:"/docs/redis/performance-optimization",children:"\u6027\u80fd\u4f18\u5316"})]}),"\n",(0,l.jsx)(s.h2,{id:"\u5e38\u89c1\u6545\u969c\u573a\u666f\u4e0e\u6392\u67e5\u8def\u5f84",children:"\u5e38\u89c1\u6545\u969c\u573a\u666f\u4e0e\u6392\u67e5\u8def\u5f84"}),"\n",(0,l.jsx)(s.h2,{id:"1-\u8fde\u63a5\u4e0d\u4e0a-redis",children:"1) \u8fde\u63a5\u4e0d\u4e0a Redis"}),"\n",(0,l.jsx)(s.p,{children:"\u6392\u67e5\u987a\u5e8f\uff1a"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["Redis \u662f\u5426\u5b58\u6d3b\uff1a",(0,l.jsx)(s.code,{children:"PING"})]}),"\n",(0,l.jsxs)(s.li,{children:["\u7aef\u53e3\u76d1\u542c\uff1a\u68c0\u67e5 ",(0,l.jsx)(s.code,{children:"bind"}),"/",(0,l.jsx)(s.code,{children:"port"})]}),"\n",(0,l.jsxs)(s.li,{children:["\u8ba4\u8bc1\u5931\u8d25\uff1a\u68c0\u67e5 ",(0,l.jsx)(s.code,{children:"requirepass"}),"/ACL"]}),"\n",(0,l.jsx)(s.li,{children:"\u7f51\u7edc/\u9632\u706b\u5899\uff1a\u786e\u8ba4\u5e94\u7528\u670d\u52a1\u5668\u5230 Redis \u7684\u8fde\u901a\u6027"}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["\u76f8\u5173\u914d\u7f6e\u89c1\uff1a",(0,l.jsx)(s.a,{href:"/docs/redis/configuration",children:"\u914d\u7f6e\u4e0e\u90e8\u7f72"})]}),"\n",(0,l.jsx)(s.h2,{id:"2-cpu-\u98d9\u9ad8--qps-\u5f88\u9ad8",children:"2) CPU \u98d9\u9ad8 / QPS \u5f88\u9ad8"}),"\n",(0,l.jsx)(s.p,{children:"\u5e38\u89c1\u539f\u56e0\uff1a"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"\u70ed key \u5bfc\u81f4\u96c6\u4e2d\u8bbf\u95ee"}),"\n",(0,l.jsxs)(s.li,{children:["\u6162\u547d\u4ee4\uff08\u5982 ",(0,l.jsx)(s.code,{children:"KEYS"}),"\u3001\u5927\u8303\u56f4 ",(0,l.jsx)(s.code,{children:"LRANGE"}),"\u3001\u5927 Hash ",(0,l.jsx)(s.code,{children:"HGETALL"}),"\uff09"]}),"\n",(0,l.jsx)(s.li,{children:"Lua \u811a\u672c\u6267\u884c\u8fc7\u91cd"}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:"\u5efa\u8bae\u52a8\u4f5c\uff1a"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["\u5148\u770b ",(0,l.jsx)(s.code,{children:"INFO commandstats"})]}),"\n",(0,l.jsxs)(s.li,{children:["\u7ed3\u5408 ",(0,l.jsx)(s.code,{children:"SLOWLOG GET"})]}),"\n",(0,l.jsxs)(s.li,{children:["\u4e34\u65f6\u8c03\u8bd5\u53ef\u4ee5\u7528 ",(0,l.jsx)(s.code,{children:"MONITOR"}),"\uff08\u4ec5\u77ed\u65f6\u95f4\uff09"]}),"\n"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"redis-cli INFO commandstats\nredis-cli SLOWLOG GET 20\n"})}),"\n",(0,l.jsx)(s.h2,{id:"3-\u5185\u5b58\u6301\u7eed\u589e\u957f--oom--\u9891\u7e41\u6dd8\u6c70",children:"3) \u5185\u5b58\u6301\u7eed\u589e\u957f / OOM / \u9891\u7e41\u6dd8\u6c70"}),"\n",(0,l.jsx)(s.p,{children:"\u6392\u67e5\u987a\u5e8f\uff1a"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["\u662f\u5426\u8bbe\u7f6e ",(0,l.jsx)(s.code,{children:"maxmemory"})]}),"\n",(0,l.jsx)(s.li,{children:"\u6dd8\u6c70\u7b56\u7565\u662f\u5426\u5339\u914d\u4e1a\u52a1"}),"\n",(0,l.jsx)(s.li,{children:"\u662f\u5426\u5b58\u5728\u5927 Key / \u70ed Key"}),"\n"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"redis-cli CONFIG GET maxmemory\nredis-cli INFO stats | grep evicted_keys\nredis-cli --bigkeys\n"})}),"\n",(0,l.jsx)(s.h2,{id:"4-\u4e3b\u4ece\u5ef6\u8fdf--\u6570\u636e\u4e0d\u4e00\u81f4",children:"4) \u4e3b\u4ece\u5ef6\u8fdf / \u6570\u636e\u4e0d\u4e00\u81f4"}),"\n",(0,l.jsx)(s.p,{children:"\u6392\u67e5\u987a\u5e8f\uff1a"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:["\u67e5\u770b\u590d\u5236\u72b6\u6001\uff1a",(0,l.jsx)(s.code,{children:"INFO replication"})]}),"\n",(0,l.jsx)(s.li,{children:"\u5173\u6ce8 offset \u5dee\u5f02\u3001\u7f51\u7edc\u6296\u52a8"}),"\n",(0,l.jsx)(s.li,{children:"\u5927 Key\u3001\u5168\u91cf\u540c\u6b65\u3001\u78c1\u76d8 IO \u90fd\u53ef\u80fd\u5bfc\u81f4\u5ef6\u8fdf"}),"\n"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"redis-cli INFO replication\n"})}),"\n",(0,l.jsxs)(s.p,{children:["\u8be6\u89c1\uff1a",(0,l.jsx)(s.a,{href:"/docs/redis/replication",children:"\u4e3b\u4ece\u590d\u5236"})]}),"\n",(0,l.jsx)(s.h2,{id:"5-\u96c6\u7fa4\u95ee\u9898movedask\u69fd\u4f4d\u4e0d\u5747",children:"5) \u96c6\u7fa4\u95ee\u9898\uff08MOVED/ASK/\u69fd\u4f4d\u4e0d\u5747\uff09"}),"\n",(0,l.jsx)(s.p,{children:"\u6392\u67e5\u8981\u70b9\uff1a"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"\u5ba2\u6237\u7aef\u662f\u5426\u652f\u6301 Cluster"}),"\n",(0,l.jsx)(s.li,{children:"\u8282\u70b9\u662f\u5426\u6709 fail \u72b6\u6001"}),"\n",(0,l.jsx)(s.li,{children:"\u69fd\u4f4d\u8fc1\u79fb\u662f\u5426\u5728\u8fdb\u884c"}),"\n"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"redis-cli -c CLUSTER INFO\nredis-cli -c CLUSTER NODES\n"})}),"\n",(0,l.jsxs)(s.p,{children:["\u8be6\u89c1\uff1a",(0,l.jsx)(s.a,{href:"/docs/redis/cluster",children:"Redis \u96c6\u7fa4"})]}),"\n",(0,l.jsx)(s.h2,{id:"\u65e5\u5fd7\u4e0e\u57fa\u7840\u8bca\u65ad\u547d\u4ee4",children:"\u65e5\u5fd7\u4e0e\u57fa\u7840\u8bca\u65ad\u547d\u4ee4"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"# \u5168\u91cf\u4fe1\u606f\uff08\u8f93\u51fa\u5f88\u957f\uff0c\u8c03\u8bd5\u65f6\u4f7f\u7528\uff09\nredis-cli INFO\n\n# \u5ba2\u6237\u7aef\u8fde\u63a5\u4e0e\u963b\u585e\nredis-cli INFO clients\nredis-cli CLIENT LIST\n\n# \u952e\u7a7a\u95f4\nredis-cli INFO keyspace\n"})}),"\n",(0,l.jsx)(s.h2,{id:"prometheus-\u76d1\u63a7\u53ef\u9009",children:"Prometheus \u76d1\u63a7\uff08\u53ef\u9009\uff09"}),"\n",(0,l.jsxs)(s.p,{children:["\u5982\u679c\u4f60\u6709 Prometheus\uff0c\u53ef\u63a5\u5165 ",(0,l.jsx)(s.code,{children:"redis_exporter"}),"\uff0c\u81f3\u5c11\u76d1\u63a7\uff1a"]}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"\u5185\u5b58\u4f7f\u7528\u7387"}),"\n",(0,l.jsx)(s.li,{children:"ops"}),"\n",(0,l.jsx)(s.li,{children:"\u547d\u4e2d\u7387"}),"\n",(0,l.jsx)(s.li,{children:"\u4e3b\u4ece\u72b6\u6001"}),"\n",(0,l.jsx)(s.li,{children:"\u6162\u67e5\u8be2\u589e\u957f"}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"\u6392\u969c\u6700\u5c0f\u6e05\u5355",children:"\u6392\u969c\u6700\u5c0f\u6e05\u5355"}),"\n",(0,l.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(s.code,{children:"INFO"}),"\uff08server/clients/memory/stats/persistence/replication/cluster\uff09"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(s.code,{children:"SLOWLOG GET 10"})]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(s.code,{children:"INFO commandstats"})]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(s.code,{children:"redis-cli --bigkeys"})]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","\u67e5\u770b\u65e5\u5fd7\u6587\u4ef6\uff08loglevel/logfile\uff09"]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["\u6d89\u53ca\u5b89\u5168\u95ee\u9898\u65f6\uff0c\u4f18\u5148\u53c2\u8003\uff1a",(0,l.jsx)(s.a,{href:"/docs/redis/security",children:"\u5b89\u5168\u914d\u7f6e"})]})]})}function a(e={}){const{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}},48885:(e,s,i)=>{i.d(s,{R:()=>r,x:()=>c});var n=i(99378);const l={},d=n.createContext(l);function r(e){const s=n.useContext(d);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),n.createElement(d.Provider,{value:s},e.children)}}}]);
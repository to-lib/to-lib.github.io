"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[7361],{48885:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>c});var l=s(99378);const i={},d=l.createContext(i);function r(e){const n=l.useContext(d);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),l.createElement(d.Provider,{value:n},e.children)}},87295:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>h,contentTitle:()=>c,default:()=>o,frontMatter:()=>r,metadata:()=>l,toc:()=>a});const l=JSON.parse('{"id":"redis/cluster","title":"Redis \u96c6\u7fa4","description":"Redis Cluster \u662f Redis \u5b98\u65b9\u63d0\u4f9b\u7684\u5206\u5e03\u5f0f\u89e3\u51b3\u65b9\u6848\uff0c\u5b9e\u73b0\u4e86\u6570\u636e\u81ea\u52a8\u5206\u7247\u3001\u9ad8\u53ef\u7528\u548c\u6c34\u5e73\u6269\u5c55\u3002","source":"@site/docs/redis/cluster.md","sourceDirName":"redis","slug":"/redis/cluster","permalink":"/docs/redis/cluster","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/redis/cluster.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"Redis \u96c6\u7fa4"},"sidebar":"redis","previous":{"title":"Redis \u54e8\u5175\u6a21\u5f0f","permalink":"/docs/redis/sentinel"},"next":{"title":"Redis \u4e8b\u52a1","permalink":"/docs/redis/transactions"}}');var i=s(22714),d=s(48885);const r={sidebar_position:7,title:"Redis \u96c6\u7fa4"},c="Redis \u96c6\u7fa4",h={},a=[{value:"\u96c6\u7fa4\u67b6\u6784",id:"\u96c6\u7fa4\u67b6\u6784",level:2},{value:"\u6570\u636e\u5206\u7247",id:"\u6570\u636e\u5206\u7247",level:3},{value:"\u4e3b\u4ece\u67b6\u6784",id:"\u4e3b\u4ece\u67b6\u6784",level:3},{value:"\u642d\u5efa\u96c6\u7fa4",id:"\u642d\u5efa\u96c6\u7fa4",level:2},{value:"1. \u51c6\u5907\u8282\u70b9",id:"1-\u51c6\u5907\u8282\u70b9",level:3},{value:"2. \u542f\u52a8\u8282\u70b9",id:"2-\u542f\u52a8\u8282\u70b9",level:3},{value:"3. \u521b\u5efa\u96c6\u7fa4",id:"3-\u521b\u5efa\u96c6\u7fa4",level:3},{value:"4. \u9a8c\u8bc1\u96c6\u7fa4",id:"4-\u9a8c\u8bc1\u96c6\u7fa4",level:3},{value:"\u69fd\u4f4d\u5206\u914d",id:"\u69fd\u4f4d\u5206\u914d",level:2},{value:"\u54c8\u5e0c\u69fd\u8ba1\u7b97",id:"\u54c8\u5e0c\u69fd\u8ba1\u7b97",level:3},{value:"\u54c8\u5e0c\u6807\u7b7e",id:"\u54c8\u5e0c\u6807\u7b7e",level:3},{value:"\u67e5\u770b\u69fd\u4f4d\u5206\u914d",id:"\u67e5\u770b\u69fd\u4f4d\u5206\u914d",level:3},{value:"\u96c6\u7fa4\u64cd\u4f5c",id:"\u96c6\u7fa4\u64cd\u4f5c",level:2},{value:"\u6570\u636e\u64cd\u4f5c",id:"\u6570\u636e\u64cd\u4f5c",level:3},{value:"\u96c6\u7fa4\u547d\u4ee4",id:"\u96c6\u7fa4\u547d\u4ee4",level:3},{value:"\u6269\u5bb9\u4e0e\u7f29\u5bb9",id:"\u6269\u5bb9\u4e0e\u7f29\u5bb9",level:2},{value:"\u6dfb\u52a0\u4e3b\u8282\u70b9",id:"\u6dfb\u52a0\u4e3b\u8282\u70b9",level:3},{value:"\u6dfb\u52a0\u4ece\u8282\u70b9",id:"\u6dfb\u52a0\u4ece\u8282\u70b9",level:3},{value:"\u5220\u9664\u8282\u70b9",id:"\u5220\u9664\u8282\u70b9",level:3},{value:"\u6545\u969c\u8f6c\u79fb",id:"\u6545\u969c\u8f6c\u79fb",level:2},{value:"\u81ea\u52a8\u6545\u969c\u8f6c\u79fb",id:"\u81ea\u52a8\u6545\u969c\u8f6c\u79fb",level:3},{value:"\u624b\u52a8\u6545\u969c\u8f6c\u79fb",id:"\u624b\u52a8\u6545\u969c\u8f6c\u79fb",level:3},{value:"\u5ba2\u6237\u7aef\u8fde\u63a5",id:"\u5ba2\u6237\u7aef\u8fde\u63a5",level:2},{value:"Java\uff08Jedis\uff09",id:"javajedis",level:3},{value:"Spring Boot",id:"spring-boot",level:3},{value:"\u96c6\u7fa4\u7ba1\u7406\u547d\u4ee4",id:"\u96c6\u7fa4\u7ba1\u7406\u547d\u4ee4",level:2},{value:"\u96c6\u7fa4\u7ef4\u62a4",id:"\u96c6\u7fa4\u7ef4\u62a4",level:3},{value:"\u69fd\u4f4d\u7ba1\u7406",id:"\u69fd\u4f4d\u7ba1\u7406",level:3},{value:"\u96c6\u7fa4\u914d\u7f6e\u53c2\u6570",id:"\u96c6\u7fa4\u914d\u7f6e\u53c2\u6570",level:2},{value:"\u96c6\u7fa4\u9650\u5236",id:"\u96c6\u7fa4\u9650\u5236",level:2},{value:"\u4e0d\u652f\u6301\u7684\u529f\u80fd",id:"\u4e0d\u652f\u6301\u7684\u529f\u80fd",level:3},{value:"\u89e3\u51b3\u65b9\u6848",id:"\u89e3\u51b3\u65b9\u6848",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u8282\u70b9\u89c4\u5212",id:"1-\u8282\u70b9\u89c4\u5212",level:3},{value:"2. \u69fd\u4f4d\u5206\u914d",id:"2-\u69fd\u4f4d\u5206\u914d",level:3},{value:"3. \u76d1\u63a7",id:"3-\u76d1\u63a7",level:3},{value:"4. \u5907\u4efd",id:"4-\u5907\u4efd",level:3},{value:"5. \u6269\u5bb9\u7b56\u7565",id:"5-\u6269\u5bb9\u7b56\u7565",level:3},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:2},{value:"1. \u96c6\u7fa4\u65e0\u6cd5\u542f\u52a8",id:"1-\u96c6\u7fa4\u65e0\u6cd5\u542f\u52a8",level:3},{value:"2. \u69fd\u4f4d\u672a\u5b8c\u5168\u8986\u76d6",id:"2-\u69fd\u4f4d\u672a\u5b8c\u5168\u8986\u76d6",level:3},{value:"3. \u6570\u636e\u503e\u659c",id:"3-\u6570\u636e\u503e\u659c",level:3},{value:"4. \u6545\u969c\u8f6c\u79fb\u5931\u8d25",id:"4-\u6545\u969c\u8f6c\u79fb\u5931\u8d25",level:3},{value:"\u5c0f\u7ed3",id:"\u5c0f\u7ed3",level:2}];function t(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"redis-\u96c6\u7fa4",children:"Redis \u96c6\u7fa4"})}),"\n",(0,i.jsx)(n.p,{children:"Redis Cluster \u662f Redis \u5b98\u65b9\u63d0\u4f9b\u7684\u5206\u5e03\u5f0f\u89e3\u51b3\u65b9\u6848\uff0c\u5b9e\u73b0\u4e86\u6570\u636e\u81ea\u52a8\u5206\u7247\u3001\u9ad8\u53ef\u7528\u548c\u6c34\u5e73\u6269\u5c55\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u96c6\u7fa4\u67b6\u6784",children:"\u96c6\u7fa4\u67b6\u6784"}),"\n",(0,i.jsx)(n.h3,{id:"\u6570\u636e\u5206\u7247",children:"\u6570\u636e\u5206\u7247"}),"\n",(0,i.jsx)(n.p,{children:"Redis Cluster \u5c06\u6240\u6709\u6570\u636e\u5206\u6210 16384 \u4e2a\u69fd\u4f4d\uff08slot\uff09\uff0c\u6bcf\u4e2a\u8282\u70b9\u8d1f\u8d23\u90e8\u5206\u69fd\u4f4d\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Slot 0-5460:  Node1\nSlot 5461-10922: Node2\nSlot 10923-16383: Node3\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3b\u4ece\u67b6\u6784",children:"\u4e3b\u4ece\u67b6\u6784"}),"\n",(0,i.jsx)(n.p,{children:"\u6bcf\u4e2a\u4e3b\u8282\u70b9\u53ef\u4ee5\u6709\u591a\u4e2a\u4ece\u8282\u70b9\uff0c\u5b9e\u73b0\u6570\u636e\u5197\u4f59\u548c\u9ad8\u53ef\u7528\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Master1 (0-5460)    Master2 (5461-10922)    Master3 (10923-16383)\n    |                      |                        |\n Slave1                 Slave2                   Slave3\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u642d\u5efa\u96c6\u7fa4",children:"\u642d\u5efa\u96c6\u7fa4"}),"\n",(0,i.jsx)(n.h3,{id:"1-\u51c6\u5907\u8282\u70b9",children:"1. \u51c6\u5907\u8282\u70b9"}),"\n",(0,i.jsx)(n.p,{children:"\u521b\u5efa 6 \u4e2a Redis \u5b9e\u4f8b\uff083 \u4e3b 3 \u4ece\uff09\u3002"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u8282\u70b9 7001 \u914d\u7f6e"})," (",(0,i.jsx)(n.code,{children:"/etc/redis/redis-7001.conf"}),")\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-conf",children:"# \u7aef\u53e3\nport 7001\n\n# \u5f00\u542f\u96c6\u7fa4\u6a21\u5f0f\ncluster-enabled yes\n\n# \u96c6\u7fa4\u914d\u7f6e\u6587\u4ef6\uff08\u81ea\u52a8\u751f\u6210\uff09\ncluster-config-file nodes-7001.conf\n\n# \u8282\u70b9\u8d85\u65f6\u65f6\u95f4\ncluster-node-timeout 15000\n\n# \u6301\u4e45\u5316\nappendonly yes\n\n# \u5de5\u4f5c\u76ee\u5f55\ndir /var/lib/redis/7001\n\n# \u540e\u53f0\u8fd0\u884c\ndaemonize yes\n\n# \u65e5\u5fd7\u6587\u4ef6\nlogfile /var/log/redis/redis-7001.log\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7c7b\u4f3c\u5730\u914d\u7f6e 7002\u30017003\u30017004\u30017005\u30017006 \u516d\u4e2a\u8282\u70b9\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"2-\u542f\u52a8\u8282\u70b9",children:"2. \u542f\u52a8\u8282\u70b9"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"redis-server /etc/redis/redis-7001.conf\nredis-server /etc/redis/redis-7002.conf\nredis-server /etc/redis/redis-7003.conf\nredis-server /etc/redis/redis-7004.conf\nredis-server /etc/redis/redis-7005.conf\nredis-server /etc/redis/redis-7006.conf\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-\u521b\u5efa\u96c6\u7fa4",children:"3. \u521b\u5efa\u96c6\u7fa4"}),"\n",(0,i.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"redis-cli"})," \u521b\u5efa\u96c6\u7fa4\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"redis-cli --cluster create \\\n  127.0.0.1:7001 \\\n  127.0.0.1:7002 \\\n  127.0.0.1:7003 \\\n  127.0.0.1:7004 \\\n  127.0.0.1:7005 \\\n  127.0.0.1:7006 \\\n  --cluster-replicas 1\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u53c2\u6570\u8bf4\u660e\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--cluster-replicas 1"})," - \u6bcf\u4e2a\u4e3b\u8282\u70b9\u6709 1 \u4e2a\u4ece\u8282\u70b9"]}),"\n",(0,i.jsx)(n.li,{children:"\u524d 3 \u4e2a\u8282\u70b9\u4e3a\u4e3b\u8282\u70b9\uff0c\u540e 3 \u4e2a\u4e3a\u4ece\u8282\u70b9"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"4-\u9a8c\u8bc1\u96c6\u7fa4",children:"4. \u9a8c\u8bc1\u96c6\u7fa4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u8fde\u63a5\u96c6\u7fa4\nredis-cli -c -p 7001\n\n# \u67e5\u770b\u96c6\u7fa4\u4fe1\u606f\nCLUSTER INFO\n\n# \u67e5\u770b\u8282\u70b9\u4fe1\u606f\nCLUSTER NODES\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u69fd\u4f4d\u5206\u914d",children:"\u69fd\u4f4d\u5206\u914d"}),"\n",(0,i.jsx)(n.h3,{id:"\u54c8\u5e0c\u69fd\u8ba1\u7b97",children:"\u54c8\u5e0c\u69fd\u8ba1\u7b97"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u4f7f\u7528 CRC16 \u7b97\u6cd5\u8ba1\u7b97\u952e\u7684\u54c8\u5e0c\u69fd\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"slot = CRC16(key) % 16384\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u54c8\u5e0c\u6807\u7b7e",children:"\u54c8\u5e0c\u6807\u7b7e"}),"\n",(0,i.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"{}"})," \u53ef\u4ee5\u6307\u5b9a\u8ba1\u7b97\u54c8\u5e0c\u7684\u90e8\u5206\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# user:1001 \u548c user:1002 \u4f1a\u5206\u914d\u5230\u4e0d\u540c\u69fd\u4f4d\nSET user:1001 "data1"\nSET user:1002 "data2"\n\n# \u4f7f\u7528\u54c8\u5e0c\u6807\u7b7e\uff0c\u786e\u4fdd\u5206\u914d\u5230\u540c\u4e00\u69fd\u4f4d\nSET {user}:1001 "data1"\nSET {user}:1002 "data2"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u67e5\u770b\u69fd\u4f4d\u5206\u914d",children:"\u67e5\u770b\u69fd\u4f4d\u5206\u914d"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b\u952e\u6240\u5728\u7684\u69fd\u4f4d\nCLUSTER KEYSLOT mykey\n\n# \u67e5\u770b\u69fd\u4f4d\u5305\u542b\u7684\u952e\u6570\u91cf\nCLUSTER COUNTKEYSINSLOT 5460\n\n# \u83b7\u53d6\u69fd\u4f4d\u4e2d\u7684\u952e\nCLUSTER GETKEYSINSLOT 5460 10\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u96c6\u7fa4\u64cd\u4f5c",children:"\u96c6\u7fa4\u64cd\u4f5c"}),"\n",(0,i.jsx)(n.h3,{id:"\u6570\u636e\u64cd\u4f5c",children:"\u6570\u636e\u64cd\u4f5c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# \u8fde\u63a5\u96c6\u7fa4\uff08-c \u53c2\u6570\u81ea\u52a8\u91cd\u5b9a\u5411\uff09\nredis-cli -c -p 7001\n\n# \u8bbe\u7f6e\u503c\nSET key1 "value1"\n\n# \u5982\u679c\u952e\u4e0d\u5728\u5f53\u524d\u8282\u70b9\uff0cRedis \u4f1a\u81ea\u52a8\u91cd\u5b9a\u5411\n-> Redirected to slot [9189] located at 127.0.0.1:7002\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u96c6\u7fa4\u547d\u4ee4",children:"\u96c6\u7fa4\u547d\u4ee4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b\u96c6\u7fa4\u4fe1\u606f\nCLUSTER INFO\n\n# \u67e5\u770b\u8282\u70b9\u4fe1\u606f\nCLUSTER NODES\n\n# \u67e5\u770b\u5f53\u524d\u8282\u70b9\u7684\u69fd\u4f4d\nCLUSTER SLOTS\n\n# \u67e5\u770b\u69fd\u4f4d\u72b6\u6001\nCLUSTER KEYSLOT key\n\n# \u624b\u52a8\u91cd\u5b9a\u5411\nASKING  # \u4e34\u65f6\u5141\u8bb8\u5ba2\u6237\u7aef\u5728\u9519\u8bef\u7684\u8282\u70b9\u6267\u884c\u547d\u4ee4\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6269\u5bb9\u4e0e\u7f29\u5bb9",children:"\u6269\u5bb9\u4e0e\u7f29\u5bb9"}),"\n",(0,i.jsx)(n.h3,{id:"\u6dfb\u52a0\u4e3b\u8282\u70b9",children:"\u6dfb\u52a0\u4e3b\u8282\u70b9"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"1. \u542f\u52a8\u65b0\u8282\u70b9"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"redis-server /etc/redis/redis-7007.conf\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"2. \u6dfb\u52a0\u5230\u96c6\u7fa4"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"redis-cli --cluster add-node 127.0.0.1:7007 127.0.0.1:7001\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"3. \u5206\u914d\u69fd\u4f4d"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u91cd\u65b0\u5206\u7247\nredis-cli --cluster reshard 127.0.0.1:7001\n\n# \u6309\u63d0\u793a\u8f93\u5165\uff1a\n# - \u8981\u79fb\u52a8\u591a\u5c11\u69fd\u4f4d\n# - \u76ee\u6807\u8282\u70b9 ID\n# - \u6e90\u8282\u70b9 ID\uff08all \u8868\u793a\u4ece\u6240\u6709\u8282\u70b9\u5747\u5300\u79fb\u52a8\uff09\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u6dfb\u52a0\u4ece\u8282\u70b9",children:"\u6dfb\u52a0\u4ece\u8282\u70b9"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"redis-cli --cluster add-node 127.0.0.1:7008 127.0.0.1:7001 \\\n  --cluster-slave \\\n  --cluster-master-id <master-node-id>\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5220\u9664\u8282\u70b9",children:"\u5220\u9664\u8282\u70b9"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"1. \u79fb\u9664\u4ece\u8282\u70b9"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"redis-cli --cluster del-node 127.0.0.1:7001 <node-id>\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"2. \u79fb\u9664\u4e3b\u8282\u70b9"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u5148\u5c06\u69fd\u4f4d\u8fc1\u79fb\u5230\u5176\u4ed6\u8282\u70b9\nredis-cli --cluster reshard 127.0.0.1:7001\n\n# \u7136\u540e\u5220\u9664\u8282\u70b9\nredis-cli --cluster del-node 127.0.0.1:7001 <node-id>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6545\u969c\u8f6c\u79fb",children:"\u6545\u969c\u8f6c\u79fb"}),"\n",(0,i.jsx)(n.h3,{id:"\u81ea\u52a8\u6545\u969c\u8f6c\u79fb",children:"\u81ea\u52a8\u6545\u969c\u8f6c\u79fb"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u4e3b\u8282\u70b9\u4e0b\u7ebf\u65f6\uff0c\u96c6\u7fa4\u81ea\u52a8\u8fdb\u884c\u6545\u969c\u8f6c\u79fb\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\u68c0\u6d4b\u4e3b\u8282\u70b9\u4e0b\u7ebf\uff08\u8d85\u8fc7 ",(0,i.jsx)(n.code,{children:"cluster-node-timeout"}),"\uff09"]}),"\n",(0,i.jsx)(n.li,{children:"\u4ece\u8282\u70b9\u53d1\u8d77\u9009\u4e3e"}),"\n",(0,i.jsx)(n.li,{children:"\u83b7\u5f97\u591a\u6570\u6295\u7968\u7684\u4ece\u8282\u70b9\u664b\u5347\u4e3a\u4e3b\u8282\u70b9"}),"\n",(0,i.jsx)(n.li,{children:"\u65b0\u4e3b\u8282\u70b9\u63a5\u7ba1\u69fd\u4f4d"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u624b\u52a8\u6545\u969c\u8f6c\u79fb",children:"\u624b\u52a8\u6545\u969c\u8f6c\u79fb"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u5728\u4ece\u8282\u70b9\u6267\u884c\nCLUSTER FAILOVER\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5ba2\u6237\u7aef\u8fde\u63a5",children:"\u5ba2\u6237\u7aef\u8fde\u63a5"}),"\n",(0,i.jsx)(n.h3,{id:"javajedis",children:"Java\uff08Jedis\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'import redis.clients.jedis.HostAndPort;\nimport redis.clients.jedis.JedisCluster;\n\nimport java.util.HashSet;\nimport java.util.Set;\n\npublic class ClusterExample {\n    public static void main(String[] args) {\n        // \u96c6\u7fa4\u8282\u70b9\n        Set<HostAndPort> nodes = new HashSet<>();\n        nodes.add(new HostAndPort("127.0.0.1", 7001));\n        nodes.add(new HostAndPort("127.0.0.1", 7002));\n        nodes.add(new HostAndPort("127.0.0.1", 7003));\n\n        // \u521b\u5efa\u96c6\u7fa4\u8fde\u63a5\n        JedisCluster cluster = new JedisCluster(nodes);\n\n        // \u64cd\u4f5c\u6570\u636e\n        cluster.set("key", "value");\n        String value = cluster.get("key");\n        System.out.println(value);\n\n        cluster.close();\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"spring-boot",children:"Spring Boot"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"spring:\n  redis:\n    cluster:\n      nodes:\n        - 127.0.0.1:7001\n        - 127.0.0.1:7002\n        - 127.0.0.1:7003\n      max-redirects: 3\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class RedisConfig {\n    @Bean\n    public RedisConnectionFactory redisConnectionFactory() {\n        RedisClusterConfiguration config = new RedisClusterConfiguration();\n        config.addClusterNode(new RedisNode("127.0.0.1", 7001));\n        config.addClusterNode(new RedisNode("127.0.0.1", 7002));\n        config.addClusterNode(new RedisNode("127.0.0.1", 7003));\n\n        return new LettuceConnectionFactory(config);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u96c6\u7fa4\u7ba1\u7406\u547d\u4ee4",children:"\u96c6\u7fa4\u7ba1\u7406\u547d\u4ee4"}),"\n",(0,i.jsx)(n.h3,{id:"\u96c6\u7fa4\u7ef4\u62a4",children:"\u96c6\u7fa4\u7ef4\u62a4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u68c0\u67e5\u96c6\u7fa4\nredis-cli --cluster check 127.0.0.1:7001\n\n# \u4fee\u590d\u96c6\u7fa4\nredis-cli --cluster fix 127.0.0.1:7001\n\n# \u91cd\u65b0\u5e73\u8861\u69fd\u4f4d\nredis-cli --cluster rebalance 127.0.0.1:7001\n\n# \u67e5\u770b\u96c6\u7fa4\u4fe1\u606f\nredis-cli --cluster info 127.0.0.1:7001\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u69fd\u4f4d\u7ba1\u7406",children:"\u69fd\u4f4d\u7ba1\u7406"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u624b\u52a8\u5206\u914d\u69fd\u4f4d\nCLUSTER ADDSLOTS 0 1 2 3 4 5\n\n# \u5220\u9664\u69fd\u4f4d\nCLUSTER DELSLOTS 0 1 2\n\n# \u8bbe\u7f6e\u69fd\u4f4d\u72b6\u6001\u4e3a\u5bfc\u5165\u4e2d\nCLUSTER SETSLOT 100 IMPORTING <node-id>\n\n# \u8bbe\u7f6e\u69fd\u4f4d\u72b6\u6001\u4e3a\u8fc1\u79fb\u4e2d\nCLUSTER SETSLOT 100 MIGRATING <node-id>\n\n# \u8bbe\u7f6e\u69fd\u4f4d\u7684\u8d1f\u8d23\u8282\u70b9\nCLUSTER SETSLOT 100 NODE <node-id>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u96c6\u7fa4\u914d\u7f6e\u53c2\u6570",children:"\u96c6\u7fa4\u914d\u7f6e\u53c2\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-conf",children:"# \u5f00\u542f\u96c6\u7fa4\u6a21\u5f0f\ncluster-enabled yes\n\n# \u96c6\u7fa4\u914d\u7f6e\u6587\u4ef6\uff08\u81ea\u52a8\u751f\u6210\u548c\u66f4\u65b0\uff09\ncluster-config-file nodes.conf\n\n# \u8282\u70b9\u8d85\u65f6\u65f6\u95f4\uff08\u6beb\u79d2\uff09\ncluster-node-timeout 15000\n\n# \u6545\u969c\u8f6c\u79fb\u9700\u8981\u7684\u4ece\u8282\u70b9\u6570\u636e\u65b0\u9c9c\u5ea6\ncluster-replica-validity-factor 10\n\n# \u8981\u6c42\u81f3\u5c11\u6709\u4e00\u4e2a\u4ece\u8282\u70b9\u624d\u5141\u8bb8\u6545\u969c\u8f6c\u79fb\ncluster-require-full-coverage yes\n\n# \u4ece\u8282\u70b9\u8fc1\u79fb\u7684\u6700\u5c0f\u95f4\u9694\u65f6\u95f4\ncluster-migration-barrier 1\n\n# \u662f\u5426\u5141\u8bb8\u4ece\u8282\u70b9\u5728\u4e3b\u8282\u70b9\u4e0b\u7ebf\u65f6\u63d0\u4f9b\u8bfb\u670d\u52a1\ncluster-allow-reads-when-down no\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u96c6\u7fa4\u9650\u5236",children:"\u96c6\u7fa4\u9650\u5236"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e0d\u652f\u6301\u7684\u529f\u80fd",children:"\u4e0d\u652f\u6301\u7684\u529f\u80fd"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u591a\u952e\u64cd\u4f5c"})," - \u53ea\u652f\u6301\u5728\u540c\u4e00\u69fd\u4f4d\u7684\u591a\u952e\u64cd\u4f5c"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u4e8b\u52a1"})," - \u53ea\u652f\u6301\u540c\u4e00\u69fd\u4f4d\u7684\u4e8b\u52a1"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6570\u636e\u5e93"})," - \u53ea\u652f\u6301 0 \u53f7\u6570\u636e\u5e93"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u590d\u5236"})," - \u4f7f\u7528\u96c6\u7fa4\u5185\u7f6e\u7684\u590d\u5236\u673a\u5236"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u89e3\u51b3\u65b9\u6848",children:"\u89e3\u51b3\u65b9\u6848"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u591a\u952e\u64cd\u4f5c"}),"\uff1a"]}),"\n",(0,i.jsx)(n.p,{children:"\u4f7f\u7528\u54c8\u5e0c\u6807\u7b7e\u786e\u4fdd\u952e\u5728\u540c\u4e00\u69fd\u4f4d\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u4e0d\u540c\u69fd\u4f4d\uff08\u53ef\u80fd\u5931\u8d25\uff09\nMGET user:1001 user:1002\n\n# \u4f7f\u7528\u54c8\u5e0c\u6807\u7b7e\uff08\u540c\u4e00\u69fd\u4f4d\uff09\nMGET {user}:1001 {user}:1002\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsx)(n.h3,{id:"1-\u8282\u70b9\u89c4\u5212",children:"1. \u8282\u70b9\u89c4\u5212"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6700\u5c11 3 \u4e3b 3 \u4ece"})," - \u4fdd\u8bc1\u9ad8\u53ef\u7528"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5947\u6570\u4e2a\u4e3b\u8282\u70b9"})," - \u907f\u514d\u6295\u7968\u5e73\u5c40"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5206\u5e03\u5f0f\u90e8\u7f72"})," - \u4e0d\u540c\u7269\u7406\u673a\u6216\u53ef\u7528\u533a"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"2-\u69fd\u4f4d\u5206\u914d",children:"2. \u69fd\u4f4d\u5206\u914d"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5747\u5300\u5206\u914d\u69fd\u4f4d\u5230\u5404\u4e2a\u4e3b\u8282\u70b9"}),"\n",(0,i.jsx)(n.li,{children:"\u4f7f\u7528\u54c8\u5e0c\u6807\u7b7e\u63a7\u5236\u952e\u7684\u5206\u5e03"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"3-\u76d1\u63a7",children:"3. \u76d1\u63a7"}),"\n",(0,i.jsx)(n.p,{children:"\u5b9a\u671f\u68c0\u67e5\u96c6\u7fa4\u72b6\u6001\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u68c0\u67e5\u96c6\u7fa4\u5065\u5eb7\nredis-cli --cluster check 127.0.0.1:7001\n\n# \u67e5\u770b\u96c6\u7fa4\u4fe1\u606f\nredis-cli -p 7001 CLUSTER INFO\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-\u5907\u4efd",children:"4. \u5907\u4efd"}),"\n",(0,i.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"BGSAVE"})," \u5b9a\u671f\u5907\u4efd\u5404\u8282\u70b9\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"redis-cli -p 7001 BGSAVE\nredis-cli -p 7002 BGSAVE\nredis-cli -p 7003 BGSAVE\n"})}),"\n",(0,i.jsx)(n.h3,{id:"5-\u6269\u5bb9\u7b56\u7565",children:"5. \u6269\u5bb9\u7b56\u7565"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u9884\u7559\u5bb9\u91cf"})," - \u63d0\u524d\u6269\u5bb9\uff0c\u907f\u514d\u4e34\u65f6\u6269\u5bb9"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5747\u5300\u8fc1\u79fb"})," - \u4ece\u6240\u6709\u8282\u70b9\u5747\u5300\u8fc1\u79fb\u69fd\u4f4d"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u4f4e\u5cf0\u671f\u64cd\u4f5c"})," - \u5728\u4e1a\u52a1\u4f4e\u5cf0\u671f\u6269\u7f29\u5bb9"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,i.jsx)(n.h3,{id:"1-\u96c6\u7fa4\u65e0\u6cd5\u542f\u52a8",children:"1. \u96c6\u7fa4\u65e0\u6cd5\u542f\u52a8"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u539f\u56e0"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u914d\u7f6e\u6587\u4ef6\u9519\u8bef"}),"\n",(0,i.jsx)(n.li,{children:"\u7aef\u53e3\u88ab\u5360\u7528"}),"\n",(0,i.jsx)(n.li,{children:"\u9632\u706b\u5899\u963b\u6b62"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u68c0\u67e5\u7aef\u53e3\nnetstat -tunlp | grep 7001\n\n# \u68c0\u67e5\u914d\u7f6e\nredis-server /etc/redis/redis-7001.conf --test-config\n\n# \u67e5\u770b\u65e5\u5fd7\ntail -f /var/log/redis/redis-7001.log\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-\u69fd\u4f4d\u672a\u5b8c\u5168\u8986\u76d6",children:"2. \u69fd\u4f4d\u672a\u5b8c\u5168\u8986\u76d6"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u539f\u56e0"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u8282\u70b9\u4e0b\u7ebf"}),"\n",(0,i.jsx)(n.li,{children:"\u69fd\u4f4d\u5206\u914d\u4e0d\u5b8c\u6574"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u68c0\u67e5\u96c6\u7fa4\nredis-cli --cluster check 127.0.0.1:7001\n\n# \u4fee\u590d\u96c6\u7fa4\nredis-cli --cluster fix 127.0.0.1:7001\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-\u6570\u636e\u503e\u659c",children:"3. \u6570\u636e\u503e\u659c"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u539f\u56e0"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u69fd\u4f4d\u5206\u914d\u4e0d\u5747"}),"\n",(0,i.jsx)(n.li,{children:"\u70ed\u70b9\u6570\u636e\u96c6\u4e2d\u5728\u67d0\u4e9b\u69fd\u4f4d"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u91cd\u65b0\u5e73\u8861\u69fd\u4f4d\nredis-cli --cluster rebalance 127.0.0.1:7001\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-\u6545\u969c\u8f6c\u79fb\u5931\u8d25",children:"4. \u6545\u969c\u8f6c\u79fb\u5931\u8d25"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u539f\u56e0"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6ca1\u6709\u53ef\u7528\u7684\u4ece\u8282\u70b9"}),"\n",(0,i.jsx)(n.li,{children:"\u8fc7\u534a\u8282\u70b9\u4e0b\u7ebf"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u786e\u4fdd\u6bcf\u4e2a\u4e3b\u8282\u70b9\u81f3\u5c11\u6709\u4e00\u4e2a\u5065\u5eb7\u7684\u4ece\u8282\u70b9"}),"\n",(0,i.jsx)(n.li,{children:"\u4fee\u590d\u4e0b\u7ebf\u7684\u8282\u70b9"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5c0f\u7ed3",children:"\u5c0f\u7ed3"}),"\n",(0,i.jsx)(n.p,{children:"Redis Cluster \u63d0\u4f9b\u4e86\u5b8c\u6574\u7684\u5206\u5e03\u5f0f\u89e3\u51b3\u65b9\u6848\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6570\u636e\u5206\u7247"})," - \u652f\u6301\u5927\u6570\u636e\u91cf\u548c\u9ad8\u5e76\u53d1"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u9ad8\u53ef\u7528"})," - \u81ea\u52a8\u6545\u969c\u8f6c\u79fb"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6c34\u5e73\u6269\u5c55"})," - \u5728\u7ebf\u6269\u7f29\u5bb9"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u5173\u952e\u7279\u6027\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"16384 \u4e2a\u69fd\u4f4d\u81ea\u52a8\u5206\u7247"}),"\n",(0,i.jsx)(n.li,{children:"\u4e3b\u4ece\u67b6\u6784\u4fdd\u8bc1\u9ad8\u53ef\u7528"}),"\n",(0,i.jsx)(n.li,{children:"\u652f\u6301\u5728\u7ebf\u6269\u7f29\u5bb9"}),"\n",(0,i.jsx)(n.li,{children:"\u5ba2\u6237\u7aef\u667a\u80fd\u8def\u7531"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u9002\u7528\u573a\u666f\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6570\u636e\u91cf\u8d85\u8fc7\u5355\u673a\u5185\u5b58"}),"\n",(0,i.jsx)(n.li,{children:"\u9700\u8981\u9ad8\u53ef\u7528\u4fdd\u8bc1"}),"\n",(0,i.jsx)(n.li,{children:"\u9700\u8981\u6c34\u5e73\u6269\u5c55\u80fd\u529b"}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}}}]);
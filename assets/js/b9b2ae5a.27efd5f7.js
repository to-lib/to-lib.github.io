"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[628],{48885:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>l});var s=r(99378);const i={},a=s.createContext(i);function t(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(a.Provider,{value:n},e.children)}},63276:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>t,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"rust/engineering","title":"\u5de5\u7a0b\u5316\u5b9e\u8df5","description":"\u672c\u6587\u4ecb\u7ecd Rust \u9879\u76ee\u7684\u5de5\u7a0b\u5316\u6700\u4f73\u5b9e\u8df5\uff0c\u6db5\u76d6\u9519\u8bef\u5904\u7406\u3001\u65e5\u5fd7\u3001\u914d\u7f6e\u7ba1\u7406\u3001\u5e8f\u5217\u5316\u7b49\u751f\u4ea7\u7ea7\u9879\u76ee\u5fc5\u5907\u7684\u80fd\u529b\u3002","source":"@site/docs/rust/engineering.md","sourceDirName":"rust","slug":"/rust/engineering","permalink":"/docs/rust/engineering","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/rust/engineering.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_position":13,"title":"\u5de5\u7a0b\u5316\u5b9e\u8df5"},"sidebar":"rust","previous":{"title":"\u5e95\u5c42\u539f\u7406","permalink":"/docs/rust/advanced-internals"},"next":{"title":"Web \u540e\u7aef\u5f00\u53d1","permalink":"/docs/rust/web-development"}}');var i=r(22714),a=r(48885);const t={sidebar_position:13,title:"\u5de5\u7a0b\u5316\u5b9e\u8df5"},l="\u5de5\u7a0b\u5316\u5b9e\u8df5",c={},d=[{value:"\u9519\u8bef\u5904\u7406\u751f\u6001",id:"\u9519\u8bef\u5904\u7406\u751f\u6001",level:2},{value:"thiserror - \u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b",id:"thiserror---\u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b",level:3},{value:"anyhow - \u5e94\u7528\u7ea7\u9519\u8bef\u5904\u7406",id:"anyhow---\u5e94\u7528\u7ea7\u9519\u8bef\u5904\u7406",level:3},{value:"thiserror vs anyhow \u9009\u62e9",id:"thiserror-vs-anyhow-\u9009\u62e9",level:3},{value:"\u65e5\u5fd7\u7cfb\u7edf - tracing",id:"\u65e5\u5fd7\u7cfb\u7edf---tracing",level:2},{value:"\u57fa\u7840\u4f7f\u7528",id:"\u57fa\u7840\u4f7f\u7528",level:3},{value:"\u7ed3\u6784\u5316\u65e5\u5fd7",id:"\u7ed3\u6784\u5316\u65e5\u5fd7",level:3},{value:"Span \u548c\u4e0a\u4e0b\u6587",id:"span-\u548c\u4e0a\u4e0b\u6587",level:3},{value:"JSON \u683c\u5f0f\u8f93\u51fa",id:"json-\u683c\u5f0f\u8f93\u51fa",level:3},{value:"\u914d\u7f6e\u7ba1\u7406",id:"\u914d\u7f6e\u7ba1\u7406",level:2},{value:"config crate",id:"config-crate",level:3},{value:"\u5e8f\u5217\u5316 - serde",id:"\u5e8f\u5217\u5316---serde",level:2},{value:"\u57fa\u7840\u7528\u6cd5",id:"\u57fa\u7840\u7528\u6cd5",level:3},{value:"\u9ad8\u7ea7\u5c5e\u6027",id:"\u9ad8\u7ea7\u5c5e\u6027",level:3},{value:"\u81ea\u5b9a\u4e49\u5e8f\u5217\u5316",id:"\u81ea\u5b9a\u4e49\u5e8f\u5217\u5316",level:3},{value:"Cargo Workspace",id:"cargo-workspace",level:2},{value:"\u5de5\u4f5c\u7a7a\u95f4\u7ed3\u6784",id:"\u5de5\u4f5c\u7a7a\u95f4\u7ed3\u6784",level:3},{value:"\u6210\u5458\u5305\u914d\u7f6e",id:"\u6210\u5458\u5305\u914d\u7f6e",level:3},{value:"\u5185\u90e8\u4f9d\u8d56",id:"\u5185\u90e8\u4f9d\u8d56",level:3},{value:"Feature Flags",id:"feature-flags",level:2},{value:"\u5b9a\u4e49 Features",id:"\u5b9a\u4e49-features",level:3},{value:"\u6761\u4ef6\u7f16\u8bd1",id:"\u6761\u4ef6\u7f16\u8bd1",level:3},{value:"\u4f7f\u7528 Features",id:"\u4f7f\u7528-features",level:3},{value:"CI/CD \u914d\u7f6e",id:"cicd-\u914d\u7f6e",level:2},{value:"GitHub Actions",id:"github-actions",level:3},{value:"Rustdoc \u6587\u6863\u751f\u6210",id:"rustdoc-\u6587\u6863\u751f\u6210",level:2},{value:"\u6587\u6863\u6ce8\u91ca\u8bed\u6cd5",id:"\u6587\u6863\u6ce8\u91ca\u8bed\u6cd5",level:3},{value:"\u6587\u6863\u6d4b\u8bd5",id:"\u6587\u6863\u6d4b\u8bd5",level:3},{value:"\u4f7f\u7528 cargo doc",id:"\u4f7f\u7528-cargo-doc",level:3},{value:"\u6587\u6863\u5c5e\u6027",id:"\u6587\u6863\u5c5e\u6027",level:3},{value:"\u94fe\u63a5\u5230\u5176\u4ed6\u9879",id:"\u94fe\u63a5\u5230\u5176\u4ed6\u9879",level:3},{value:"\u53d1\u5e03\u5230 docs.rs",id:"\u53d1\u5e03\u5230-docsrs",level:3},{value:"README \u4f5c\u4e3a crate \u6587\u6863",id:"readme-\u4f5c\u4e3a-crate-\u6587\u6863",level:3},{value:"\u5b8c\u6574\u9879\u76ee\u793a\u4f8b",id:"\u5b8c\u6574\u9879\u76ee\u793a\u4f8b",level:2},{value:"\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3",id:"\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u5de5\u7a0b\u5316\u5b9e\u8df5",children:"\u5de5\u7a0b\u5316\u5b9e\u8df5"})}),"\n",(0,i.jsx)(n.p,{children:"\u672c\u6587\u4ecb\u7ecd Rust \u9879\u76ee\u7684\u5de5\u7a0b\u5316\u6700\u4f73\u5b9e\u8df5\uff0c\u6db5\u76d6\u9519\u8bef\u5904\u7406\u3001\u65e5\u5fd7\u3001\u914d\u7f6e\u7ba1\u7406\u3001\u5e8f\u5217\u5316\u7b49\u751f\u4ea7\u7ea7\u9879\u76ee\u5fc5\u5907\u7684\u80fd\u529b\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u9519\u8bef\u5904\u7406\u751f\u6001",children:"\u9519\u8bef\u5904\u7406\u751f\u6001"}),"\n",(0,i.jsx)(n.h3,{id:"thiserror---\u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b",children:"thiserror - \u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"thiserror"})," \u7528\u4e8e\u4e3a\u5e93\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b,\u63d0\u4f9b\u6d3e\u751f\u5b8f\u7b80\u5316\u5b9e\u73b0\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[dependencies]\nthiserror = "1.0"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use thiserror::Error;\n\n#[derive(Error, Debug)]\npub enum DataError {\n    #[error("\u6570\u636e\u672a\u627e\u5230: {0}")]\n    NotFound(String),\n\n    #[error("\u65e0\u6548\u7684\u8f93\u5165: {field}")]\n    InvalidInput { field: String },\n\n    #[error("IO \u9519\u8bef")]\n    Io(#[from] std::io::Error),\n\n    #[error("\u89e3\u6790\u9519\u8bef: {0}")]\n    Parse(#[from] serde_json::Error),\n}\n\nfn load_config(path: &str) -> Result<Config, DataError> {\n    let content = std::fs::read_to_string(path)?; // \u81ea\u52a8\u8f6c\u6362 io::Error\n    let config: Config = serde_json::from_str(&content)?; // \u81ea\u52a8\u8f6c\u6362 serde Error\n    Ok(config)\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"anyhow---\u5e94\u7528\u7ea7\u9519\u8bef\u5904\u7406",children:"anyhow - \u5e94\u7528\u7ea7\u9519\u8bef\u5904\u7406"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"anyhow"})," \u9002\u7528\u4e8e\u5e94\u7528\u7a0b\u5e8f,\u63d0\u4f9b\u7b80\u5355\u7684\u9519\u8bef\u4f20\u64ad\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[dependencies]\nanyhow = "1.0"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use anyhow::{Context, Result, bail, ensure};\n\nfn read_config(path: &str) -> Result<Config> {\n    let content = std::fs::read_to_string(path)\n        .context("\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\u5931\u8d25")?;\n\n    let config: Config = serde_json::from_str(&content)\n        .context("\u89e3\u6790\u914d\u7f6e\u5931\u8d25")?;\n\n    ensure!(config.port > 0, "\u7aef\u53e3\u5fc5\u987b\u5927\u4e8e 0");\n\n    if config.host.is_empty() {\n        bail!("\u4e3b\u673a\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a");\n    }\n\n    Ok(config)\n}\n\nfn main() -> Result<()> {\n    let config = read_config("config.json")?;\n    println!("Config loaded: {:?}", config);\n    Ok(())\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"thiserror-vs-anyhow-\u9009\u62e9",children:"thiserror vs anyhow \u9009\u62e9"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u573a\u666f"}),(0,i.jsx)(n.th,{children:"\u63a8\u8350"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u5e93\u5f00\u53d1"}),(0,i.jsx)(n.td,{children:"thiserror"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u5e94\u7528\u5f00\u53d1"}),(0,i.jsx)(n.td,{children:"anyhow"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u9700\u8981\u5339\u914d\u9519\u8bef\u7c7b\u578b"}),(0,i.jsx)(n.td,{children:"thiserror"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u5feb\u901f\u539f\u578b\u5f00\u53d1"}),(0,i.jsx)(n.td,{children:"anyhow"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"\u65e5\u5fd7\u7cfb\u7edf---tracing",children:"\u65e5\u5fd7\u7cfb\u7edf - tracing"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"tracing"})," \u662f Rust \u751f\u6001\u4e2d\u6700\u5f3a\u5927\u7684\u7ed3\u6784\u5316\u65e5\u5fd7\u6846\u67b6\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[dependencies]\ntracing = "0.1"\ntracing-subscriber = { version = "0.3", features = ["env-filter"] }\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u57fa\u7840\u4f7f\u7528",children:"\u57fa\u7840\u4f7f\u7528"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use tracing::{info, warn, error, debug, trace, instrument, span, Level};\nuse tracing_subscriber::{layer::SubscriberExt, util::SubscriberInitExt};\n\nfn main() {\n    // \u521d\u59cb\u5316\u65e5\u5fd7\u8ba2\u9605\u5668\n    tracing_subscriber::registry()\n        .with(tracing_subscriber::fmt::layer())\n        .with(tracing_subscriber::EnvFilter::from_default_env())\n        .init();\n\n    info!("\u5e94\u7528\u542f\u52a8");\n    debug!(port = 8080, "\u76d1\u542c\u7aef\u53e3");\n    warn!(user_id = 42, "\u7528\u6237\u5c1d\u8bd5\u8bbf\u95ee\u53d7\u9650\u8d44\u6e90");\n    error!("\u53d1\u751f\u4e25\u91cd\u9519\u8bef");\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u7ed3\u6784\u5316\u65e5\u5fd7",children:"\u7ed3\u6784\u5316\u65e5\u5fd7"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use tracing::{info, instrument};\n\n#[derive(Debug)]\nstruct User {\n    id: u64,\n    name: String,\n}\n\n#[instrument(skip(password))]\nfn login(username: &str, password: &str) -> Result<User, String> {\n    info!("\u7528\u6237\u5c1d\u8bd5\u767b\u5f55");\n    // \u767b\u5f55\u903b\u8f91\n    Ok(User { id: 1, name: username.to_string() })\n}\n\n#[instrument]\nasync fn fetch_user(id: u64) -> Option<User> {\n    info!("\u83b7\u53d6\u7528\u6237\u4fe1\u606f");\n    Some(User { id, name: "Alice".to_string() })\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"span-\u548c\u4e0a\u4e0b\u6587",children:"Span \u548c\u4e0a\u4e0b\u6587"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use tracing::{span, Level, info};\n\nfn process_request(request_id: &str) {\n    let span = span!(Level::INFO, "request", id = request_id);\n    let _guard = span.enter();\n\n    info!("\u5f00\u59cb\u5904\u7406\u8bf7\u6c42");\n    // \u5904\u7406\u903b\u8f91...\n    info!("\u8bf7\u6c42\u5904\u7406\u5b8c\u6210");\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"json-\u683c\u5f0f\u8f93\u51fa",children:"JSON \u683c\u5f0f\u8f93\u51fa"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"use tracing_subscriber::fmt::format::FmtSpan;\n\nfn init_logging() {\n    tracing_subscriber::fmt()\n        .json()\n        .with_span_events(FmtSpan::CLOSE)\n        .with_current_span(true)\n        .init();\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u914d\u7f6e\u7ba1\u7406",children:"\u914d\u7f6e\u7ba1\u7406"}),"\n",(0,i.jsx)(n.h3,{id:"config-crate",children:"config crate"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[dependencies]\nconfig = "0.13"\nserde = { version = "1.0", features = ["derive"] }\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use config::{Config, ConfigError, Environment, File};\nuse serde::Deserialize;\n\n#[derive(Debug, Deserialize)]\npub struct Settings {\n    pub database: DatabaseSettings,\n    pub server: ServerSettings,\n}\n\n#[derive(Debug, Deserialize)]\npub struct DatabaseSettings {\n    pub url: String,\n    pub max_connections: u32,\n}\n\n#[derive(Debug, Deserialize)]\npub struct ServerSettings {\n    pub host: String,\n    pub port: u16,\n}\n\nimpl Settings {\n    pub fn new() -> Result<Self, ConfigError> {\n        let config = Config::builder()\n            // \u9ed8\u8ba4\u914d\u7f6e\n            .add_source(File::with_name("config/default"))\n            // \u73af\u5883\u7279\u5b9a\u914d\u7f6e\n            .add_source(File::with_name(&format!(\n                "config/{}",\n                std::env::var("RUN_ENV").unwrap_or_else(|_| "development".into())\n            )).required(false))\n            // \u73af\u5883\u53d8\u91cf\u8986\u76d6 (APP_DATABASE__URL \u4f1a\u8986\u76d6 database.url)\n            .add_source(Environment::with_prefix("APP").separator("__"))\n            .build()?;\n\n        config.try_deserialize()\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b ",(0,i.jsx)(n.code,{children:"config/default.toml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[database]\nurl = "postgres://localhost/myapp"\nmax_connections = 10\n\n[server]\nhost = "0.0.0.0"\nport = 8080\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5e8f\u5217\u5316---serde",children:"\u5e8f\u5217\u5316 - serde"}),"\n",(0,i.jsx)(n.h3,{id:"\u57fa\u7840\u7528\u6cd5",children:"\u57fa\u7840\u7528\u6cd5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[dependencies]\nserde = { version = "1.0", features = ["derive"] }\nserde_json = "1.0"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use serde::{Deserialize, Serialize};\n\n#[derive(Debug, Serialize, Deserialize)]\nstruct User {\n    id: u64,\n    name: String,\n    #[serde(skip_serializing_if = "Option::is_none")]\n    email: Option<String>,\n}\n\nfn main() {\n    let user = User {\n        id: 1,\n        name: "Alice".to_string(),\n        email: Some("alice@example.com".to_string()),\n    };\n\n    // \u5e8f\u5217\u5316\u4e3a JSON\n    let json = serde_json::to_string_pretty(&user).unwrap();\n    println!("{}", json);\n\n    // \u53cd\u5e8f\u5217\u5316\n    let parsed: User = serde_json::from_str(&json).unwrap();\n    println!("{:?}", parsed);\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u9ad8\u7ea7\u5c5e\u6027",children:"\u9ad8\u7ea7\u5c5e\u6027"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use serde::{Deserialize, Serialize};\n\n#[derive(Debug, Serialize, Deserialize)]\n#[serde(rename_all = "camelCase")]\nstruct ApiResponse {\n    user_id: u64,\n    user_name: String,\n\n    #[serde(rename = "type")]\n    response_type: String,\n\n    #[serde(default)]\n    is_verified: bool,\n\n    #[serde(skip)]\n    internal_data: String,\n\n    #[serde(with = "chrono::serde::ts_seconds")]\n    created_at: chrono::DateTime<chrono::Utc>,\n}\n\n// \u679a\u4e3e\u5e8f\u5217\u5316\n#[derive(Debug, Serialize, Deserialize)]\n#[serde(tag = "type", content = "data")]\nenum Message {\n    Text { content: String },\n    Image { url: String, width: u32, height: u32 },\n    #[serde(rename = "file")]\n    Attachment { name: String, size: u64 },\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49\u5e8f\u5217\u5316",children:"\u81ea\u5b9a\u4e49\u5e8f\u5217\u5316"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use serde::{Deserialize, Deserializer, Serialize, Serializer};\n\nfn serialize_uppercase<S>(value: &str, serializer: S) -> Result<S::Ok, S::Error>\nwhere\n    S: Serializer,\n{\n    serializer.serialize_str(&value.to_uppercase())\n}\n\nfn deserialize_from_str<\'de, D>(deserializer: D) -> Result<u64, D::Error>\nwhere\n    D: Deserializer<\'de>,\n{\n    let s: String = Deserialize::deserialize(deserializer)?;\n    s.parse().map_err(serde::de::Error::custom)\n}\n\n#[derive(Serialize, Deserialize)]\nstruct Item {\n    #[serde(serialize_with = "serialize_uppercase")]\n    name: String,\n\n    #[serde(deserialize_with = "deserialize_from_str")]\n    quantity: u64,\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"cargo-workspace",children:"Cargo Workspace"}),"\n",(0,i.jsx)(n.h3,{id:"\u5de5\u4f5c\u7a7a\u95f4\u7ed3\u6784",children:"\u5de5\u4f5c\u7a7a\u95f4\u7ed3\u6784"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'# \u6839 Cargo.toml\n[workspace]\nresolver = "2"\nmembers = [\n    "crates/core",\n    "crates/api",\n    "crates/cli",\n]\n\n[workspace.package]\nversion = "0.1.0"\nedition = "2021"\nauthors = ["Your Name <you@example.com>"]\nlicense = "MIT"\n\n[workspace.dependencies]\ntokio = { version = "1", features = ["full"] }\nserde = { version = "1.0", features = ["derive"] }\nanyhow = "1.0"\ntracing = "0.1"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u6210\u5458\u5305\u914d\u7f6e",children:"\u6210\u5458\u5305\u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'# crates/core/Cargo.toml\n[package]\nname = "myapp-core"\nversion.workspace = true\nedition.workspace = true\n\n[dependencies]\nserde.workspace = true\nanyhow.workspace = true\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u5185\u90e8\u4f9d\u8d56",children:"\u5185\u90e8\u4f9d\u8d56"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'# crates/api/Cargo.toml\n[package]\nname = "myapp-api"\nversion.workspace = true\nedition.workspace = true\n\n[dependencies]\nmyapp-core = { path = "../core" }\ntokio.workspace = true\n'})}),"\n",(0,i.jsx)(n.h2,{id:"feature-flags",children:"Feature Flags"}),"\n",(0,i.jsx)(n.h3,{id:"\u5b9a\u4e49-features",children:"\u5b9a\u4e49 Features"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[package]\nname = "mylib"\nversion = "0.1.0"\n\n[features]\ndefault = ["json"]\njson = ["serde_json"]\nyaml = ["serde_yaml"]\nfull = ["json", "yaml", "async"]\nasync = ["tokio"]\n\n[dependencies]\nserde = "1.0"\nserde_json = { version = "1.0", optional = true }\nserde_yaml = { version = "0.9", optional = true }\ntokio = { version = "1", features = ["full"], optional = true }\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u6761\u4ef6\u7f16\u8bd1",children:"\u6761\u4ef6\u7f16\u8bd1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'#[cfg(feature = "json")]\npub mod json {\n    use serde::Serialize;\n\n    pub fn to_json<T: Serialize>(value: &T) -> Result<String, serde_json::Error> {\n        serde_json::to_string_pretty(value)\n    }\n}\n\n#[cfg(feature = "async")]\npub mod async_utils {\n    pub async fn sleep_ms(ms: u64) {\n        tokio::time::sleep(tokio::time::Duration::from_millis(ms)).await;\n    }\n}\n\n// \u6761\u4ef6\u5bfc\u5165\n#[cfg(feature = "json")]\npub use json::to_json;\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u4f7f\u7528-features",children:"\u4f7f\u7528 Features"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u9ed8\u8ba4 features\ncargo build\n\n# \u7981\u7528\u9ed8\u8ba4,\u542f\u7528\u7279\u5b9a feature\ncargo build --no-default-features --features yaml\n\n# \u542f\u7528\u6240\u6709 features\ncargo build --features full\n"})}),"\n",(0,i.jsx)(n.h2,{id:"cicd-\u914d\u7f6e",children:"CI/CD \u914d\u7f6e"}),"\n",(0,i.jsx)(n.h3,{id:"github-actions",children:"GitHub Actions"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"name: Rust CI\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\nenv:\n  CARGO_TERM_COLOR: always\n\njobs:\n  check:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: dtolnay/rust-toolchain@stable\n        with:\n          components: rustfmt, clippy\n\n      - name: Cache cargo\n        uses: Swatinem/rust-cache@v2\n\n      - name: Format check\n        run: cargo fmt --all -- --check\n\n      - name: Clippy\n        run: cargo clippy --all-targets --all-features -- -D warnings\n\n      - name: Build\n        run: cargo build --all-features\n\n      - name: Test\n        run: cargo test --all-features\n"})}),"\n",(0,i.jsx)(n.h2,{id:"rustdoc-\u6587\u6863\u751f\u6210",children:"Rustdoc \u6587\u6863\u751f\u6210"}),"\n",(0,i.jsxs)(n.p,{children:["Rust \u5185\u7f6e\u4e86\u5f3a\u5927\u7684\u6587\u6863\u7cfb\u7edf\uff0c\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"rustdoc"})," \u4ece\u4ee3\u7801\u6ce8\u91ca\u751f\u6210 HTML \u6587\u6863\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u6587\u6863\u6ce8\u91ca\u8bed\u6cd5",children:"\u6587\u6863\u6ce8\u91ca\u8bed\u6cd5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'//! \u6a21\u5757\u7ea7\u6587\u6863\uff08\u653e\u5728\u6587\u4ef6\u5f00\u5934\uff09\n//! \u8fd9\u4e2a\u6a21\u5757\u63d0\u4f9b\u7528\u6237\u7ba1\u7406\u529f\u80fd\u3002\n\n/// \u7528\u6237\u7ed3\u6784\u4f53\n///\n/// # \u793a\u4f8b\n///\n/// ```\n/// use mylib::User;\n///\n/// let user = User::new("Alice", 30);\n/// assert_eq!(user.name(), "Alice");\n/// ```\npub struct User {\n    name: String,\n    age: u32,\n}\n\nimpl User {\n    /// \u521b\u5efa\u65b0\u7528\u6237\n    ///\n    /// # \u53c2\u6570\n    ///\n    /// * `name` - \u7528\u6237\u540d\n    /// * `age` - \u5e74\u9f84\n    ///\n    /// # \u8fd4\u56de\u503c\n    ///\n    /// \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 `User` \u5b9e\u4f8b\n    ///\n    /// # \u793a\u4f8b\n    ///\n    /// ```\n    /// # use mylib::User;\n    /// let user = User::new("Bob", 25);\n    /// ```\n    ///\n    /// # Panics\n    ///\n    /// \u5982\u679c\u5e74\u9f84\u8d85\u8fc7 150 \u5c81\u4f1a panic\n    ///\n    /// # Errors\n    ///\n    /// \u6b64\u51fd\u6570\u4e0d\u4f1a\u8fd4\u56de\u9519\u8bef\n    pub fn new(name: &str, age: u32) -> Self {\n        assert!(age <= 150, "\u5e74\u9f84\u4e0d\u5408\u7406");\n        User {\n            name: name.to_string(),\n            age,\n        }\n    }\n\n    /// \u83b7\u53d6\u7528\u6237\u540d\n    #[must_use]\n    pub fn name(&self) -> &str {\n        &self.name\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u6587\u6863\u6d4b\u8bd5",children:"\u6587\u6863\u6d4b\u8bd5"}),"\n",(0,i.jsx)(n.p,{children:"\u6587\u6863\u4e2d\u7684\u4ee3\u7801\u793a\u4f8b\u4f1a\u4f5c\u4e3a\u6d4b\u8bd5\u8fd0\u884c\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'/// \u5c06\u4e24\u4e2a\u6570\u76f8\u52a0\n///\n/// ```\n/// assert_eq!(mylib::add(2, 3), 5);\n/// ```\n///\n/// # \u9690\u85cf\u7684\u4ee3\u7801\n///\n/// ```\n/// # // \u4ee5 # \u5f00\u5934\u7684\u884c\u4f1a\u8fd0\u884c\u4f46\u4e0d\u663e\u793a\n/// # use mylib::add;\n/// let result = add(1, 1);\n/// assert_eq!(result, 2);\n/// ```\n///\n/// # \u5ffd\u7565\u6d4b\u8bd5\n///\n/// ```ignore\n/// // \u8fd9\u4e2a\u6d4b\u8bd5\u4f1a\u88ab\u5ffd\u7565\n/// unimplemented!()\n/// ```\n///\n/// # \u9884\u671f\u5931\u8d25\n///\n/// ```should_panic\n/// panic!("\u8fd9\u4f1a panic");\n/// ```\n///\n/// # \u7f16\u8bd1\u4f46\u4e0d\u8fd0\u884c\n///\n/// ```no_run\n/// loop {\n///     // \u65e0\u9650\u5faa\u73af\uff0c\u53ea\u68c0\u67e5\u7f16\u8bd1\n/// }\n/// ```\npub fn add(a: i32, b: i32) -> i32 {\n    a + b\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd0\u884c\u6587\u6863\u6d4b\u8bd5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u8fd0\u884c\u6240\u6709\u6d4b\u8bd5\uff08\u5305\u62ec\u6587\u6863\u6d4b\u8bd5\uff09\ncargo test\n\n# \u53ea\u8fd0\u884c\u6587\u6863\u6d4b\u8bd5\ncargo test --doc\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u4f7f\u7528-cargo-doc",children:"\u4f7f\u7528 cargo doc"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u751f\u6210\u6587\u6863\ncargo doc\n\n# \u751f\u6210\u5e76\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00\ncargo doc --open\n\n# \u5305\u542b\u79c1\u6709\u9879\u7684\u6587\u6863\ncargo doc --document-private-items\n\n# \u5305\u542b\u4f9d\u8d56\u9879\u7684\u6587\u6863\ncargo doc --no-deps  # \u9ed8\u8ba4\u4e0d\u5305\u542b\uff0c\u8fd9\u662f\u660e\u786e\u6392\u9664\n\n# \u4e3a\u6240\u6709\u76ee\u6807\u751f\u6210\u6587\u6863\ncargo doc --all-features\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u6587\u6863\u5c5e\u6027",children:"\u6587\u6863\u5c5e\u6027"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'/// \u4e00\u4e2a\u5df2\u5f03\u7528\u7684\u51fd\u6570\n#[deprecated(since = "1.0.0", note = "\u8bf7\u4f7f\u7528 new_function \u4ee3\u66ff")]\npub fn old_function() {}\n\n/// \u4ec5\u5728\u6587\u6863\u4e2d\u663e\u793a\u6b64\u51fd\u6570\n#[doc(hidden)]\npub fn internal_function() {}\n\n/// \u4e3a\u6a21\u5757\u6dfb\u52a0\u522b\u540d\n#[doc(alias = "\u522b\u540d")]\npub fn function_with_alias() {}\n\n// \u91cd\u65b0\u5bfc\u51fa\u5e76\u6dfb\u52a0\u6587\u6863\n#[doc(inline)]\npub use other_module::SomeType;\n\n/// \u5728\u6587\u6863\u4e2d\u9690\u85cf\n#[doc(hidden)]\npub mod internal;\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u94fe\u63a5\u5230\u5176\u4ed6\u9879",children:"\u94fe\u63a5\u5230\u5176\u4ed6\u9879"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'/// \u4f7f\u7528 [`User`] \u7ed3\u6784\u4f53\u521b\u5efa\u7528\u6237\n///\n/// \u53c2\u89c1 [`User::new`] \u83b7\u53d6\u66f4\u591a\u4fe1\u606f\n///\n/// \u94fe\u63a5\u5230\u6a21\u5757\uff1a[`crate::user`]\n///\n/// \u5b8c\u6574\u8def\u5f84\u94fe\u63a5\uff1a[`crate::user::User::name`]\npub fn create_user() -> User {\n    User::new("test", 20)\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u53d1\u5e03\u5230-docsrs",children:"\u53d1\u5e03\u5230 docs.rs"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u4f60\u53d1\u5e03 crate \u5230 crates.io \u65f6\uff0c\u6587\u6863\u4f1a\u81ea\u52a8\u53d1\u5e03\u5230 docs.rs\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728 ",(0,i.jsx)(n.code,{children:"Cargo.toml"})," \u4e2d\u914d\u7f6e docs.rs \u6784\u5efa\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[package.metadata.docs.rs]\n# \u542f\u7528\u6240\u6709\u7279\u6027\nall-features = true\n\n# \u6216\u6307\u5b9a\u7279\u6027\nfeatures = ["full", "async"]\n\n# \u6784\u5efa\u76ee\u6807\ntargets = ["x86_64-unknown-linux-gnu"]\n\n# Rustdoc \u53c2\u6570\nrustdoc-args = ["--cfg", "docsrs"]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"docsrs"})," cfg \u6807\u8bb0\u4ec5\u5728\u6587\u6863\u6784\u5efa\u65f6\u663e\u793a\u7684\u5185\u5bb9\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'#[cfg(docsrs)]\n#[doc(cfg(feature = "async"))]\npub mod async_support {\n    //! \u6b64\u6a21\u5757\u9700\u8981 `async` \u7279\u6027\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"readme-\u4f5c\u4e3a-crate-\u6587\u6863",children:"README \u4f5c\u4e3a crate \u6587\u6863"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'// src/lib.rs\n#![doc = include_str!("../README.md")]\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5b8c\u6574\u9879\u76ee\u793a\u4f8b",children:"\u5b8c\u6574\u9879\u76ee\u793a\u4f8b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"myapp/\n\u251c\u2500\u2500 Cargo.toml\n\u251c\u2500\u2500 config/\n\u2502   \u251c\u2500\u2500 default.toml\n\u2502   \u251c\u2500\u2500 development.toml\n\u2502   \u2514\u2500\u2500 production.toml\n\u251c\u2500\u2500 crates/\n\u2502   \u251c\u2500\u2500 core/\n\u2502   \u2502   \u251c\u2500\u2500 Cargo.toml\n\u2502   \u2502   \u2514\u2500\u2500 src/\n\u2502   \u2502       \u251c\u2500\u2500 lib.rs\n\u2502   \u2502       \u251c\u2500\u2500 error.rs\n\u2502   \u2502       \u2514\u2500\u2500 config.rs\n\u2502   \u251c\u2500\u2500 api/\n\u2502   \u2502   \u251c\u2500\u2500 Cargo.toml\n\u2502   \u2502   \u2514\u2500\u2500 src/\n\u2502   \u2502       \u251c\u2500\u2500 lib.rs\n\u2502   \u2502       \u2514\u2500\u2500 routes/\n\u2502   \u2514\u2500\u2500 cli/\n\u2502       \u251c\u2500\u2500 Cargo.toml\n\u2502       \u2514\u2500\u2500 src/\n\u2502           \u2514\u2500\u2500 main.rs\n\u251c\u2500\u2500 tests/\n\u2502   \u2514\u2500\u2500 integration_tests.rs\n\u2514\u2500\u2500 .github/\n    \u2514\u2500\u2500 workflows/\n        \u2514\u2500\u2500 ci.yml\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3",children:"\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u65b9\u9762"}),(0,i.jsx)(n.th,{children:"\u63a8\u8350\u5de5\u5177/\u505a\u6cd5"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u9519\u8bef\u5904\u7406"}),(0,i.jsx)(n.td,{children:"\u5e93\u7528 thiserror\uff0c\u5e94\u7528\u7528 anyhow"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u65e5\u5fd7"}),(0,i.jsx)(n.td,{children:"tracing + tracing-subscriber"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u914d\u7f6e"}),(0,i.jsx)(n.td,{children:"config crate + \u73af\u5883\u53d8\u91cf"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u5e8f\u5217\u5316"}),(0,i.jsx)(n.td,{children:"serde \u5168\u5bb6\u6876"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u9879\u76ee\u7ec4\u7ec7"}),(0,i.jsx)(n.td,{children:"cargo workspace"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u53ef\u9009\u529f\u80fd"}),(0,i.jsx)(n.td,{children:"feature flags"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u4ee3\u7801\u8d28\u91cf"}),(0,i.jsx)(n.td,{children:"cargo fmt + cargo clippy"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CI/CD"}),(0,i.jsx)(n.td,{children:"GitHub Actions"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"\u638c\u63e1\u8fd9\u4e9b\u5de5\u7a0b\u5316\u6280\u80fd\uff0c\u4f60\u5c31\u80fd\u5199\u51fa\u751f\u4ea7\u7ea7\u7684 Rust \u9879\u76ee\uff01"})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);
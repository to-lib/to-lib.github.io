"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[63962],{48885:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>c});var l=i(99378);const t={},r=l.createContext(t);function s(e){const n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),l.createElement(r.Provider,{value:n},e.children)}},70043:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>a});const l=JSON.parse('{"id":"springcloud/resilience4j","title":"Resilience4j \u5bb9\u9519","description":"[!TIP]","source":"@site/docs/springcloud/resilience4j.md","sourceDirName":"springcloud","slug":"/springcloud/resilience4j","permalink":"/docs/springcloud/resilience4j","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/springcloud/resilience4j.md","tags":[],"version":"current","sidebarPosition":8.1,"frontMatter":{"title":"Resilience4j \u5bb9\u9519","sidebar_label":"Resilience4j","sidebar_position":8.1},"sidebar":"springcloud","previous":{"title":"Hystrix","permalink":"/docs/springcloud/hystrix"},"next":{"title":"Gateway","permalink":"/docs/springcloud/gateway"}}');var t=i(22714),r=i(48885);const s={title:"Resilience4j \u5bb9\u9519",sidebar_label:"Resilience4j",sidebar_position:8.1},c="Resilience4j \u5bb9\u9519\u4fdd\u62a4",d={},a=[{value:"1. \u7b80\u4ecb",id:"1-\u7b80\u4ecb",level:2},{value:"\u6838\u5fc3\u6a21\u5757",id:"\u6838\u5fc3\u6a21\u5757",level:3},{value:"2. \u5feb\u901f\u5f00\u59cb",id:"2-\u5feb\u901f\u5f00\u59cb",level:2},{value:"\u6dfb\u52a0\u4f9d\u8d56",id:"\u6dfb\u52a0\u4f9d\u8d56",level:3},{value:"\u4f7f\u7528\u6ce8\u89e3",id:"\u4f7f\u7528\u6ce8\u89e3",level:3},{value:"3. \u914d\u7f6e\u8be6\u89e3 (application.yml)",id:"3-\u914d\u7f6e\u8be6\u89e3-applicationyml",level:2},{value:"CircuitBreaker (\u7194\u65ad\u5668)",id:"circuitbreaker-\u7194\u65ad\u5668",level:3},{value:"RateLimiter (\u9650\u6d41\u5668)",id:"ratelimiter-\u9650\u6d41\u5668",level:3},{value:"Retry (\u91cd\u8bd5)",id:"retry-\u91cd\u8bd5",level:3},{value:"Bulkhead (\u8231\u58c1\u9694\u79bb)",id:"bulkhead-\u8231\u58c1\u9694\u79bb",level:3},{value:"4. \u52a8\u6001\u914d\u7f6e",id:"4-\u52a8\u6001\u914d\u7f6e",level:2},{value:"5. \u76d1\u63a7",id:"5-\u76d1\u63a7",level:2},{value:"6. Resilience4j vs Hystrix",id:"6-resilience4j-vs-hystrix",level:2}];function o(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"resilience4j-\u5bb9\u9519\u4fdd\u62a4",children:"Resilience4j \u5bb9\u9519\u4fdd\u62a4"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["[!TIP]\n",(0,t.jsx)(n.strong,{children:"Hystrix \u7684\u7ee7\u4efb\u8005"}),": Resilience4j \u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u3001\u4e13\u4e3a Java 8+ \u548c\u51fd\u6570\u5f0f\u7f16\u7a0b\u8bbe\u8ba1\u7684\u5bb9\u9519\u5e93\u3002\u5b83\u662f Spring Cloud Circuit Breaker \u5b98\u65b9\u63a8\u8350\u7684 Hystrix \u66ff\u4ee3\u65b9\u6848\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"1-\u7b80\u4ecb",children:"1. \u7b80\u4ecb"}),"\n",(0,t.jsx)(n.p,{children:"Resilience4j \u53d7 Netflix Hystrix \u542f\u53d1\uff0c\u4f46\u4e13\u4e3a Java 8 \u548c\u51fd\u6570\u5f0f\u7f16\u7a0b\u8bbe\u8ba1\u3002\u5b83\u66f4\u52a0\u8f7b\u91cf\uff0c\u6a21\u5757\u5316\u7a0b\u5ea6\u66f4\u9ad8\u3002\u4f60\u53ef\u4ee5\u53ea\u9009\u62e9\u4f60\u9700\u8981\u7684\u90e8\u5206\uff08\u5982\u53ea\u7528\u7194\u65ad\u5668\uff0c\u4e0d\u7528\u9650\u6d41\uff09\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"\u6838\u5fc3\u6a21\u5757",children:"\u6838\u5fc3\u6a21\u5757"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"CircuitBreaker"}),": \u7194\u65ad\u5668"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"RateLimiter"}),": \u9650\u6d41\u5668"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Retry"}),": \u81ea\u52a8\u91cd\u8bd5"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Bulkhead"}),": \u8231\u58c1\u9694\u79bb (\u5e76\u53d1\u9650\u5236)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"TimeLimiter"}),": \u8d85\u65f6\u63a7\u5236"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cache"}),": \u7ed3\u679c\u7f13\u5b58"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"2-\u5feb\u901f\u5f00\u59cb",children:"2. \u5feb\u901f\u5f00\u59cb"}),"\n",(0,t.jsx)(n.h3,{id:"\u6dfb\u52a0\u4f9d\u8d56",children:"\u6dfb\u52a0\u4f9d\u8d56"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-circuitbreaker-resilience4j</artifactId>\n</dependency>\n\x3c!-- \u5982\u679c\u9700\u8981\u76d1\u63a7\uff0c\u6dfb\u52a0 actuator --\x3e\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-actuator</artifactId>\n</dependency>\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-aop</artifactId>\n</dependency>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u4f7f\u7528\u6ce8\u89e3",children:"\u4f7f\u7528\u6ce8\u89e3"}),"\n",(0,t.jsx)(n.p,{children:"Resilience4j \u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6ce8\u89e3\u652f\u6301\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@Service\npublic class OrderService {\n\n    @CircuitBreaker(name = "backendA", fallbackMethod = "fallback")\n    @RateLimiter(name = "backendA")\n    @Bulkhead(name = "backendA")\n    public String doSomething() {\n        // \u53ef\u80fd\u4f1a\u5931\u8d25\u7684\u8c03\u7528\n        return restTemplate.getForObject("http://backend-service/api", String.class);\n    }\n\n    public String fallback(Throwable t) {\n        return "\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528: " + t.getMessage();\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"3-\u914d\u7f6e\u8be6\u89e3-applicationyml",children:"3. \u914d\u7f6e\u8be6\u89e3 (application.yml)"}),"\n",(0,t.jsx)(n.h3,{id:"circuitbreaker-\u7194\u65ad\u5668",children:"CircuitBreaker (\u7194\u65ad\u5668)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"resilience4j.circuitbreaker:\n  instances:\n    backendA:\n      registerHealthIndicator: true\n      # \u6ed1\u52a8\u7a97\u53e3\u7c7b\u578b\uff1aCOUNT_BASED (\u57fa\u4e8e\u8ba1\u6570) \u6216 TIME_BASED (\u57fa\u4e8e\u65f6\u95f4)\n      slidingWindowType: COUNT_BASED\n      # \u6ed1\u52a8\u7a97\u53e3\u5927\u5c0f\n      slidingWindowSize: 10\n      # \u6700\u5c0f\u8bf7\u6c42\u6570\uff0c\u5c11\u4e8e\u8be5\u503c\u4e0d\u4f1a\u89e6\u53d1\u7194\u65ad\n      minimumNumberOfCalls: 5\n      # \u5931\u8d25\u7387\u9608\u503c (\u767e\u5206\u6bd4)\uff0c\u8d85\u8fc7\u8be5\u503c\u89e6\u53d1\u7194\u65ad\n      failureRateThreshold: 50\n      # \u6162\u8c03\u7528\u6bd4\u4f8b\u9608\u503c\n      slowCallRateThreshold: 100\n      # \u6162\u8c03\u7528\u65f6\u95f4\u9608\u503c\n      slowCallDurationThreshold: 2000ms\n      # \u534a\u5f00\u72b6\u6001\u5141\u8bb8\u7684\u8bf7\u6c42\u6570\n      permittedNumberOfCallsInHalfOpenState: 3\n      # \u7194\u65ad\u5668\u6253\u5f00\u72b6\u6001\u7b49\u5f85\u65f6\u95f4 (\u5728\u6b64\u671f\u95f4\u62d2\u7edd\u8bf7\u6c42)\n      waitDurationInOpenState: 5s\n      # \u81ea\u52a8\u4ece Open \u5207\u6362\u5230 Half-Open\n      automaticTransitionFromOpenToHalfOpenEnabled: true\n"})}),"\n",(0,t.jsx)(n.h3,{id:"ratelimiter-\u9650\u6d41\u5668",children:"RateLimiter (\u9650\u6d41\u5668)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"resilience4j.ratelimiter:\n  instances:\n    backendA:\n      # \u9650\u5236\u5237\u65b0\u5468\u671f\n      limitRefreshPeriod: 1s\n      # \u5468\u671f\u5185\u5141\u8bb8\u7684\u6700\u5927\u8bf7\u6c42\u6570\n      limitForPeriod: 10\n      # \u8bf7\u6c42\u7b49\u5f85\u8d85\u65f6\u65f6\u95f4\n      timeoutDuration: 500ms\n"})}),"\n",(0,t.jsx)(n.h3,{id:"retry-\u91cd\u8bd5",children:"Retry (\u91cd\u8bd5)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"resilience4j.retry:\n  instances:\n    backendA:\n      # \u6700\u5927\u91cd\u8bd5\u6b21\u6570\n      maxAttempts: 3\n      # \u91cd\u8bd5\u95f4\u9694\n      waitDuration: 500ms\n      # \u6307\u6570\u9000\u907f (\u91cd\u8bd5\u95f4\u9694\u9010\u6e10\u589e\u52a0)\n      enableExponentialBackoff: true\n      exponentialBackoffMultiplier: 2\n"})}),"\n",(0,t.jsx)(n.h3,{id:"bulkhead-\u8231\u58c1\u9694\u79bb",children:"Bulkhead (\u8231\u58c1\u9694\u79bb)"}),"\n",(0,t.jsx)(n.p,{children:"Resilience4j \u63d0\u4f9b\u4e24\u79cd\u8231\u58c1\u9694\u79bb\uff1a"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SemaphoreBulkhead"})," (\u4fe1\u53f7\u91cf\uff0c\u9ed8\u8ba4): \u9650\u5236\u5e76\u53d1\u8bf7\u6c42\u6570\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ThreadPoolBulkhead"})," (\u7ebf\u7a0b\u6c60): \u4f7f\u7528\u72ec\u7acb\u7ebf\u7a0b\u6c60\u6267\u884c\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"resilience4j.bulkhead:\n  instances:\n    backendA:\n      # \u6700\u5927\u5e76\u53d1\u8c03\u7528\u6570\n      maxConcurrentCalls: 10\n      # \u5f53\u7531\u4e8e\u5e76\u53d1\u9650\u5236\u800c\u88ab\u963b\u585e\u65f6\u7684\u6700\u5927\u7b49\u5f85\u65f6\u95f4\n      maxWaitDuration: 0\n"})}),"\n",(0,t.jsx)(n.h2,{id:"4-\u52a8\u6001\u914d\u7f6e",children:"4. \u52a8\u6001\u914d\u7f6e"}),"\n",(0,t.jsx)(n.p,{children:"Resilience4j \u652f\u6301\u901a\u8fc7 Spring Cloud Config \u52a8\u6001\u5237\u65b0\u914d\u7f6e\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"5-\u76d1\u63a7",children:"5. \u76d1\u63a7"}),"\n",(0,t.jsx)(n.p,{children:"Resilience4j \u901a\u8fc7 Micrometer \u66b4\u9732\u6307\u6807\uff0c\u53ef\u4ee5\u4e0e Prometheus + Grafana \u5b8c\u7f8e\u96c6\u6210\u3002"}),"\n",(0,t.jsxs)(n.p,{children:["\u8bbf\u95ee Actuator \u7aef\u70b9\uff1a",(0,t.jsx)(n.code,{children:"/actuator/metrics/resilience4j.circuitbreaker.calls"})]}),"\n",(0,t.jsx)(n.h2,{id:"6-resilience4j-vs-hystrix",children:"6. Resilience4j vs Hystrix"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"\u7279\u6027"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"Hystrix"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"Resilience4j"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"\u72b6\u6001"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u7ef4\u62a4\u6a21\u5f0f"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"\u6d3b\u8dc3\u5f00\u53d1"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"Java \u7248\u672c"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"Java 6+"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"Java 8+ (\u51fd\u6570\u5f0f\u98ce\u683c)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"\u4f9d\u8d56"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"Guava, Apache Commons"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"Vavr (\u53ef\u9009)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"\u6a21\u5757\u5316"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u5f3a\u8026\u5408"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"\u9ad8\u5ea6\u6a21\u5757\u5316"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"\u914d\u7f6e"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"Archaius (\u590d\u6742)"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"Spring Boot Config (\u6807\u51c6)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"\u9694\u79bb"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u4e3b\u8981\u662f\u7ebf\u7a0b\u6c60"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u4e3b\u8981\u662f\u4fe1\u53f7\u91cf\uff0c\u4e5f\u652f\u6301\u7ebf\u7a0b\u6c60"})]})]})]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"[!WARNING]\nHystrix \u4f7f\u7528 RxJava 1\uff0c\u8fc7\u5ea6\u4f9d\u8d56\u7ebf\u7a0b\u6c60\u9694\u79bb\u5bfc\u81f4\u4e0a\u4e0b\u6587\u4f20\u9012\u56f0\u96be\u3002Resilience4j \u57fa\u4e8e\u88c5\u9970\u5668\u6a21\u5f0f\uff0c\u66f4\u8f7b\u91cf\uff0c\u66f4\u6613\u4e8e\u4e0e Reactor/WebFlux \u96c6\u6210\u3002"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}}}]);
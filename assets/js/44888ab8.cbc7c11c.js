"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[54688],{14732:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"flink/practical-examples","title":"\u5b9e\u6218\u6848\u4f8b","description":"Flink \u751f\u4ea7\u73af\u5883\u5b9e\u6218\u6848\u4f8b\u4e0e\u6700\u4f73\u5b9e\u8df5","source":"@site/docs/flink/practical-examples.md","sourceDirName":"flink","slug":"/flink/practical-examples","permalink":"/docs/flink/practical-examples","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/flink/practical-examples.md","tags":[],"version":"current","sidebarPosition":18,"frontMatter":{"sidebar_position":18,"title":"\u5b9e\u6218\u6848\u4f8b","description":"Flink \u751f\u4ea7\u73af\u5883\u5b9e\u6218\u6848\u4f8b\u4e0e\u6700\u4f73\u5b9e\u8df5"},"sidebar":"flink","previous":{"title":"\u5e38\u89c1\u95ee\u9898","permalink":"/docs/flink/faq"}}');var i=t(22714),r=t(48885);const s={sidebar_position:18,title:"\u5b9e\u6218\u6848\u4f8b",description:"Flink \u751f\u4ea7\u73af\u5883\u5b9e\u6218\u6848\u4f8b\u4e0e\u6700\u4f73\u5b9e\u8df5"},o="Flink \u5b9e\u6218\u6848\u4f8b",l={},c=[{value:"\u6848\u4f8b\u4e00\uff1a\u5b9e\u65f6\u7535\u5546\u6570\u4ed3",id:"\u6848\u4f8b\u4e00\u5b9e\u65f6\u7535\u5546\u6570\u4ed3",level:2},{value:"\u4e1a\u52a1\u573a\u666f",id:"\u4e1a\u52a1\u573a\u666f",level:3},{value:"\u6838\u5fc3\u5b9e\u73b0",id:"\u6838\u5fc3\u5b9e\u73b0",level:3},{value:"\u6570\u636e\u6e90\u5b9a\u4e49",id:"\u6570\u636e\u6e90\u5b9a\u4e49",level:4},{value:"\u5b9e\u65f6\u805a\u5408",id:"\u5b9e\u65f6\u805a\u5408",level:4},{value:"\u6848\u4f8b\u4e8c\uff1a\u5b9e\u65f6\u98ce\u63a7\u7cfb\u7edf",id:"\u6848\u4f8b\u4e8c\u5b9e\u65f6\u98ce\u63a7\u7cfb\u7edf",level:2},{value:"\u4e1a\u52a1\u573a\u666f",id:"\u4e1a\u52a1\u573a\u666f-1",level:3},{value:"\u6838\u5fc3\u5b9e\u73b0",id:"\u6838\u5fc3\u5b9e\u73b0-1",level:3},{value:"\u4f7f\u7528 CEP \u68c0\u6d4b\u5f02\u5e38\u6a21\u5f0f",id:"\u4f7f\u7528-cep-\u68c0\u6d4b\u5f02\u5e38\u6a21\u5f0f",level:4},{value:"\u5f02\u5730\u767b\u5f55\u68c0\u6d4b",id:"\u5f02\u5730\u767b\u5f55\u68c0\u6d4b",level:4},{value:"\u6848\u4f8b\u4e09\uff1a\u5b9e\u65f6\u63a8\u8350\u7cfb\u7edf",id:"\u6848\u4f8b\u4e09\u5b9e\u65f6\u63a8\u8350\u7cfb\u7edf",level:2},{value:"\u4e1a\u52a1\u573a\u666f",id:"\u4e1a\u52a1\u573a\u666f-2",level:3},{value:"\u67b6\u6784\u8bbe\u8ba1",id:"\u67b6\u6784\u8bbe\u8ba1",level:3},{value:"\u5b9e\u65f6\u7279\u5f81\u8ba1\u7b97",id:"\u5b9e\u65f6\u7279\u5f81\u8ba1\u7b97",level:3},{value:"\u6848\u4f8b\u56db\uff1a\u65e5\u5fd7\u5b9e\u65f6\u5206\u6790",id:"\u6848\u4f8b\u56db\u65e5\u5fd7\u5b9e\u65f6\u5206\u6790",level:2},{value:"\u4e1a\u52a1\u573a\u666f",id:"\u4e1a\u52a1\u573a\u666f-3",level:3},{value:"SQL \u5b9e\u73b0",id:"sql-\u5b9e\u73b0",level:3},{value:"\u6848\u4f8b\u4e94\uff1aIoT \u6570\u636e\u5904\u7406",id:"\u6848\u4f8b\u4e94iot-\u6570\u636e\u5904\u7406",level:2},{value:"\u4e1a\u52a1\u573a\u666f",id:"\u4e1a\u52a1\u573a\u666f-4",level:3},{value:"\u5b9e\u73b0\u4ee3\u7801",id:"\u5b9e\u73b0\u4ee3\u7801",level:3},{value:"\u751f\u4ea7\u73af\u5883\u914d\u7f6e\u5efa\u8bae",id:"\u751f\u4ea7\u73af\u5883\u914d\u7f6e\u5efa\u8bae",level:2},{value:"\u8d44\u6e90\u914d\u7f6e",id:"\u8d44\u6e90\u914d\u7f6e",level:3},{value:"\u68c0\u67e5\u70b9\u914d\u7f6e",id:"\u68c0\u67e5\u70b9\u914d\u7f6e",level:3},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"flink-\u5b9e\u6218\u6848\u4f8b",children:"Flink \u5b9e\u6218\u6848\u4f8b"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u9002\u7528\u7248\u672c\uff1aApache Flink v2.2.0"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6848\u4f8b\u4e00\u5b9e\u65f6\u7535\u5546\u6570\u4ed3",children:"\u6848\u4f8b\u4e00\uff1a\u5b9e\u65f6\u7535\u5546\u6570\u4ed3"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e1a\u52a1\u573a\u666f",children:"\u4e1a\u52a1\u573a\u666f"}),"\n",(0,i.jsx)(n.p,{children:"\u6784\u5efa\u5b9e\u65f6\u6570\u636e\u4ed3\u5e93\uff0c\u5b9e\u73b0\u8ba2\u5355\u6570\u636e\u7684\u5b9e\u65f6\u7edf\u8ba1\u5206\u6790\u3002"}),"\n",(0,i.jsx)(n.mermaid,{value:"graph LR\n    A[MySQL] --\x3e|CDC| B[Flink]\n    C[Kafka \u8ba2\u5355\u6d41] --\x3e B\n    B --\x3e D[Kafka \u4e2d\u95f4\u5c42]\n    B --\x3e E[ClickHouse]\n    B --\x3e F[Redis]\n\n    style B fill:#2e7d32,color:#fff"}),"\n",(0,i.jsx)(n.h3,{id:"\u6838\u5fc3\u5b9e\u73b0",children:"\u6838\u5fc3\u5b9e\u73b0"}),"\n",(0,i.jsx)(n.h4,{id:"\u6570\u636e\u6e90\u5b9a\u4e49",children:"\u6570\u636e\u6e90\u5b9a\u4e49"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u8ba2\u5355\u4e8b\u5b9e\u8868\uff08CDC\uff09\nCREATE TABLE orders (\n    order_id STRING,\n    user_id STRING,\n    product_id STRING,\n    amount DECIMAL(10, 2),\n    status STRING,\n    create_time TIMESTAMP(3),\n    update_time TIMESTAMP(3),\n    WATERMARK FOR create_time AS create_time - INTERVAL '5' SECOND,\n    PRIMARY KEY (order_id) NOT ENFORCED\n) WITH (\n    'connector' = 'mysql-cdc',\n    'hostname' = 'mysql-host',\n    'port' = '3306',\n    'username' = 'flink',\n    'password' = 'password',\n    'database-name' = 'ecommerce',\n    'table-name' = 'orders'\n);\n\n-- \u5546\u54c1\u7ef4\u8868\nCREATE TABLE products (\n    product_id STRING,\n    product_name STRING,\n    category STRING,\n    price DECIMAL(10, 2),\n    PRIMARY KEY (product_id) NOT ENFORCED\n) WITH (\n    'connector' = 'jdbc',\n    'url' = 'jdbc:mysql://mysql-host:3306/ecommerce',\n    'table-name' = 'products',\n    'lookup.cache.max-rows' = '5000',\n    'lookup.cache.ttl' = '10min'\n);\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u5b9e\u65f6\u805a\u5408",children:"\u5b9e\u65f6\u805a\u5408"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u6bcf\u5c0f\u65f6\u9500\u552e\u7edf\u8ba1\nINSERT INTO hourly_sales\nSELECT\n    DATE_FORMAT(create_time, 'yyyy-MM-dd HH:00:00') AS hour_time,\n    p.category,\n    COUNT(*) AS order_count,\n    SUM(o.amount) AS total_amount,\n    COUNT(DISTINCT o.user_id) AS user_count\nFROM orders o\nJOIN products FOR SYSTEM_TIME AS OF o.create_time AS p\n    ON o.product_id = p.product_id\nWHERE o.status = 'PAID'\nGROUP BY\n    DATE_FORMAT(create_time, 'yyyy-MM-dd HH:00:00'),\n    p.category;\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u6848\u4f8b\u4e8c\u5b9e\u65f6\u98ce\u63a7\u7cfb\u7edf",children:"\u6848\u4f8b\u4e8c\uff1a\u5b9e\u65f6\u98ce\u63a7\u7cfb\u7edf"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e1a\u52a1\u573a\u666f-1",children:"\u4e1a\u52a1\u573a\u666f"}),"\n",(0,i.jsx)(n.p,{children:"\u68c0\u6d4b\u5f02\u5e38\u4ea4\u6613\u884c\u4e3a\uff0c\u5305\u62ec\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u77ed\u65f6\u95f4\u5185\u591a\u6b21\u4ea4\u6613"}),"\n",(0,i.jsx)(n.li,{children:"\u5f02\u5730\u767b\u5f55\u540e\u7acb\u5373\u4ea4\u6613"}),"\n",(0,i.jsx)(n.li,{children:"\u5927\u989d\u5f02\u5e38\u4ea4\u6613"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u6838\u5fc3\u5b9e\u73b0-1",children:"\u6838\u5fc3\u5b9e\u73b0"}),"\n",(0,i.jsx)(n.h4,{id:"\u4f7f\u7528-cep-\u68c0\u6d4b\u5f02\u5e38\u6a21\u5f0f",children:"\u4f7f\u7528 CEP \u68c0\u6d4b\u5f02\u5e38\u6a21\u5f0f"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u5b9a\u4e49\u5f02\u5e38\u4ea4\u6613\u6a21\u5f0f\uff1a5\u5206\u949f\u5185\u8d85\u8fc73\u6b21\u4ea4\u6613\nPattern<Transaction, ?> pattern = Pattern.<Transaction>begin("first")\n    .where(SimpleCondition.of(t -> t.getAmount() > 1000))\n    .followedBy("second")\n    .where(SimpleCondition.of(t -> t.getAmount() > 1000))\n    .followedBy("third")\n    .where(SimpleCondition.of(t -> t.getAmount() > 1000))\n    .within(Time.minutes(5));\n\n// \u5e94\u7528\u6a21\u5f0f\nPatternStream<Transaction> patternStream = CEP.pattern(\n    transactions.keyBy(Transaction::getUserId),\n    pattern\n);\n\n// \u751f\u6210\u544a\u8b66\nDataStream<RiskAlert> alerts = patternStream.process(\n    new PatternProcessFunction<Transaction, RiskAlert>() {\n        @Override\n        public void processMatch(Map<String, List<Transaction>> match,\n                Context ctx, Collector<RiskAlert> out) {\n            List<Transaction> txns = new ArrayList<>();\n            txns.addAll(match.get("first"));\n            txns.addAll(match.get("second"));\n            txns.addAll(match.get("third"));\n\n            double totalAmount = txns.stream()\n                .mapToDouble(Transaction::getAmount)\n                .sum();\n\n            out.collect(new RiskAlert(\n                txns.get(0).getUserId(),\n                "FREQUENT_LARGE_TRANSACTION",\n                totalAmount,\n                txns.size()\n            ));\n        }\n    }\n);\n'})}),"\n",(0,i.jsx)(n.h4,{id:"\u5f02\u5730\u767b\u5f55\u68c0\u6d4b",children:"\u5f02\u5730\u767b\u5f55\u68c0\u6d4b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public class LocationCheckFunction\n        extends KeyedProcessFunction<String, LoginEvent, RiskAlert> {\n\n    private ValueState<String> lastLocationState;\n    private ValueState<Long> lastLoginTimeState;\n\n    @Override\n    public void open(Configuration parameters) {\n        lastLocationState = getRuntimeContext().getState(\n            new ValueStateDescriptor<>("lastLocation", String.class));\n        lastLoginTimeState = getRuntimeContext().getState(\n            new ValueStateDescriptor<>("lastLoginTime", Long.class));\n    }\n\n    @Override\n    public void processElement(LoginEvent event, Context ctx,\n            Collector<RiskAlert> out) throws Exception {\n        String lastLocation = lastLocationState.value();\n        Long lastLoginTime = lastLoginTimeState.value();\n\n        if (lastLocation != null && lastLoginTime != null) {\n            // \u8ba1\u7b97\u8ddd\u79bb\u548c\u65f6\u95f4\u5dee\n            double distance = calculateDistance(lastLocation, event.getLocation());\n            long timeDiff = event.getTimestamp() - lastLoginTime;\n\n            // \u4e0d\u53ef\u80fd\u5728\u77ed\u65f6\u95f4\u5185\u8de8\u8d8a\u5927\u8ddd\u79bb\n            if (distance > 500 && timeDiff < 3600000) { // 500km, 1\u5c0f\u65f6\n                out.collect(new RiskAlert(\n                    event.getUserId(),\n                    "IMPOSSIBLE_TRAVEL",\n                    distance,\n                    timeDiff\n                ));\n            }\n        }\n\n        lastLocationState.update(event.getLocation());\n        lastLoginTimeState.update(event.getTimestamp());\n    }\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u6848\u4f8b\u4e09\u5b9e\u65f6\u63a8\u8350\u7cfb\u7edf",children:"\u6848\u4f8b\u4e09\uff1a\u5b9e\u65f6\u63a8\u8350\u7cfb\u7edf"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e1a\u52a1\u573a\u666f-2",children:"\u4e1a\u52a1\u573a\u666f"}),"\n",(0,i.jsx)(n.p,{children:"\u57fa\u4e8e\u7528\u6237\u5b9e\u65f6\u884c\u4e3a\uff0c\u751f\u6210\u4e2a\u6027\u5316\u63a8\u8350\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u67b6\u6784\u8bbe\u8ba1",children:"\u67b6\u6784\u8bbe\u8ba1"}),"\n",(0,i.jsx)(n.mermaid,{value:"graph TB\n    A[\u7528\u6237\u884c\u4e3a\u6d41] --\x3e B[Flink \u5b9e\u65f6\u5904\u7406]\n    B --\x3e C[\u7528\u6237\u753b\u50cf\u66f4\u65b0]\n    B --\x3e D[\u5b9e\u65f6\u7279\u5f81\u8ba1\u7b97]\n    D --\x3e E[Redis \u7279\u5f81\u5b58\u50a8]\n    C --\x3e F[HBase \u753b\u50cf\u5b58\u50a8]\n    E --\x3e G[\u63a8\u8350\u670d\u52a1]\n    F --\x3e G\n\n    style B fill:#1976d2,color:#fff"}),"\n",(0,i.jsx)(n.h3,{id:"\u5b9e\u65f6\u7279\u5f81\u8ba1\u7b97",children:"\u5b9e\u65f6\u7279\u5f81\u8ba1\u7b97"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public class UserFeatureFunction\n        extends KeyedProcessFunction<String, UserAction, UserFeature> {\n\n    // \u6700\u8fd1\u6d4f\u89c8\u7684\u5546\u54c1\u7c7b\u76ee\uff08\u4fdd\u7559\u6700\u8fd110\u4e2a\uff09\n    private ListState<String> recentCategoriesState;\n    // \u5404\u7c7b\u76ee\u6d4f\u89c8\u6b21\u6570\n    private MapState<String, Long> categoryCountState;\n    // \u7528\u6237\u6d3b\u8dc3\u5ea6\u5f97\u5206\n    private ValueState<Double> activityScoreState;\n\n    @Override\n    public void open(Configuration parameters) {\n        recentCategoriesState = getRuntimeContext().getListState(\n            new ListStateDescriptor<>("recentCategories", String.class));\n        categoryCountState = getRuntimeContext().getMapState(\n            new MapStateDescriptor<>("categoryCount", String.class, Long.class));\n        activityScoreState = getRuntimeContext().getState(\n            new ValueStateDescriptor<>("activityScore", Double.class));\n    }\n\n    @Override\n    public void processElement(UserAction action, Context ctx,\n            Collector<UserFeature> out) throws Exception {\n        String category = action.getCategory();\n\n        // \u66f4\u65b0\u7c7b\u76ee\u8ba1\u6570\n        Long count = categoryCountState.get(category);\n        categoryCountState.put(category, count == null ? 1L : count + 1);\n\n        // \u66f4\u65b0\u6700\u8fd1\u6d4f\u89c8\n        List<String> recent = new ArrayList<>();\n        recentCategoriesState.get().forEach(recent::add);\n        recent.add(category);\n        if (recent.size() > 10) {\n            recent = recent.subList(recent.size() - 10, recent.size());\n        }\n        recentCategoriesState.update(recent);\n\n        // \u8ba1\u7b97\u6d3b\u8dc3\u5ea6\n        Double score = activityScoreState.value();\n        score = (score == null ? 0 : score * 0.9) + 1.0;\n        activityScoreState.update(score);\n\n        // \u8f93\u51fa\u7279\u5f81\n        out.collect(new UserFeature(\n            action.getUserId(),\n            recent,\n            getTopCategories(categoryCountState, 5),\n            score\n        ));\n    }\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u6848\u4f8b\u56db\u65e5\u5fd7\u5b9e\u65f6\u5206\u6790",children:"\u6848\u4f8b\u56db\uff1a\u65e5\u5fd7\u5b9e\u65f6\u5206\u6790"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e1a\u52a1\u573a\u666f-3",children:"\u4e1a\u52a1\u573a\u666f"}),"\n",(0,i.jsx)(n.p,{children:"\u5b9e\u65f6\u5206\u6790\u5e94\u7528\u65e5\u5fd7\uff0c\u76d1\u63a7\u5f02\u5e38\u548c\u6027\u80fd\u6307\u6807\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"sql-\u5b9e\u73b0",children:"SQL \u5b9e\u73b0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u65e5\u5fd7\u6e90\u8868\nCREATE TABLE app_logs (\n    log_time TIMESTAMP(3),\n    level STRING,\n    service STRING,\n    message STRING,\n    trace_id STRING,\n    duration_ms BIGINT,\n    WATERMARK FOR log_time AS log_time - INTERVAL '10' SECOND\n) WITH (\n    'connector' = 'kafka',\n    'topic' = 'app-logs',\n    'properties.bootstrap.servers' = 'kafka:9092',\n    'format' = 'json'\n);\n\n-- \u6bcf\u5206\u949f\u9519\u8bef\u7edf\u8ba1\nSELECT\n    TUMBLE_START(log_time, INTERVAL '1' MINUTE) AS window_start,\n    service,\n    COUNT(*) FILTER (WHERE level = 'ERROR') AS error_count,\n    COUNT(*) FILTER (WHERE level = 'WARN') AS warn_count,\n    COUNT(*) AS total_count\nFROM app_logs\nGROUP BY TUMBLE(log_time, INTERVAL '1' MINUTE), service\nHAVING COUNT(*) FILTER (WHERE level = 'ERROR') > 10;\n\n-- P99 \u5ef6\u8fdf\u76d1\u63a7\nSELECT\n    TUMBLE_START(log_time, INTERVAL '1' MINUTE) AS window_start,\n    service,\n    PERCENTILE_CONT(0.99) WITHIN GROUP (ORDER BY duration_ms) AS p99_latency,\n    PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY duration_ms) AS p95_latency,\n    AVG(duration_ms) AS avg_latency\nFROM app_logs\nWHERE duration_ms IS NOT NULL\nGROUP BY TUMBLE(log_time, INTERVAL '1' MINUTE), service;\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u6848\u4f8b\u4e94iot-\u6570\u636e\u5904\u7406",children:"\u6848\u4f8b\u4e94\uff1aIoT \u6570\u636e\u5904\u7406"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e1a\u52a1\u573a\u666f-4",children:"\u4e1a\u52a1\u573a\u666f"}),"\n",(0,i.jsx)(n.p,{children:"\u5904\u7406\u6d77\u91cf\u4f20\u611f\u5668\u6570\u636e\uff0c\u5b9e\u65f6\u76d1\u63a7\u8bbe\u5907\u72b6\u6001\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u5b9e\u73b0\u4ee3\u7801",children:"\u5b9e\u73b0\u4ee3\u7801"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u4f20\u611f\u5668\u6570\u636e\u5904\u7406\nDataStream<SensorReading> readings = env\n    .addSource(new FlinkKafkaConsumer<>(\n        "sensor-data",\n        new SensorReadingSchema(),\n        kafkaProps))\n    .assignTimestampsAndWatermarks(\n        WatermarkStrategy\n            .<SensorReading>forBoundedOutOfOrderness(Duration.ofSeconds(5))\n            .withTimestampAssigner((r, ts) -> r.getTimestamp()));\n\n// \u8bbe\u5907\u72b6\u6001\u76d1\u63a7\nreadings\n    .keyBy(SensorReading::getDeviceId)\n    .window(SlidingEventTimeWindows.of(Time.minutes(5), Time.minutes(1)))\n    .aggregate(new SensorStatsAggregate())\n    .filter(stats -> stats.getMaxTemperature() > 80\n                  || stats.getAvgTemperature() > 60)\n    .addSink(new AlertSink());\n\n// \u805a\u5408\u51fd\u6570\npublic class SensorStatsAggregate\n        implements AggregateFunction<SensorReading, SensorStats, SensorStats> {\n\n    @Override\n    public SensorStats createAccumulator() {\n        return new SensorStats();\n    }\n\n    @Override\n    public SensorStats add(SensorReading reading, SensorStats acc) {\n        acc.count++;\n        acc.sumTemperature += reading.getTemperature();\n        acc.maxTemperature = Math.max(acc.maxTemperature, reading.getTemperature());\n        acc.minTemperature = Math.min(acc.minTemperature, reading.getTemperature());\n        return acc;\n    }\n\n    @Override\n    public SensorStats getResult(SensorStats acc) {\n        acc.avgTemperature = acc.sumTemperature / acc.count;\n        return acc;\n    }\n\n    @Override\n    public SensorStats merge(SensorStats a, SensorStats b) {\n        a.count += b.count;\n        a.sumTemperature += b.sumTemperature;\n        a.maxTemperature = Math.max(a.maxTemperature, b.maxTemperature);\n        a.minTemperature = Math.min(a.minTemperature, b.minTemperature);\n        return a;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\u751f\u4ea7\u73af\u5883\u914d\u7f6e\u5efa\u8bae",children:"\u751f\u4ea7\u73af\u5883\u914d\u7f6e\u5efa\u8bae"}),"\n",(0,i.jsx)(n.h3,{id:"\u8d44\u6e90\u914d\u7f6e",children:"\u8d44\u6e90\u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# \u9ad8\u541e\u5410\u573a\u666f\ntaskmanager.memory.process.size: 16g\ntaskmanager.numberOfTaskSlots: 4\nparallelism.default: 16\n\n# \u5927\u72b6\u6001\u573a\u666f\nstate.backend: rocksdb\nstate.backend.incremental: true\nstate.backend.rocksdb.memory.managed: true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u68c0\u67e5\u70b9\u914d\u7f6e",children:"\u68c0\u67e5\u70b9\u914d\u7f6e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"env.enableCheckpointing(60000);\nenv.getCheckpointConfig().setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE);\nenv.getCheckpointConfig().setMinPauseBetweenCheckpoints(30000);\nenv.getCheckpointConfig().setCheckpointTimeout(600000);\nenv.getCheckpointConfig().enableUnalignedCheckpoints();\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\ud83d\udd0c ",(0,i.jsx)(n.a,{href:"/docs/flink/connectors",children:"\u8fde\u63a5\u5668"})," - \u66f4\u591a\u6570\u636e\u6e90\u914d\u7f6e"]}),"\n",(0,i.jsxs)(n.li,{children:["\ud83d\udcca ",(0,i.jsx)(n.a,{href:"/docs/flink/flink-cdc",children:"Flink CDC"})," - CDC \u8be6\u7ec6\u4f7f\u7528"]}),"\n",(0,i.jsxs)(n.li,{children:["\ud83d\ude80 ",(0,i.jsx)(n.a,{href:"/docs/flink/performance-optimization",children:"\u6027\u80fd\u4f18\u5316"})," - \u8c03\u4f18\u6307\u5357"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},48885:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var a=t(99378);const i={},r=a.createContext(i);function s(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);
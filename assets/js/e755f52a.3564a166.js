"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[257],{1293:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"java/jvm-basics","title":"JVM \u57fa\u7840","description":"Java \u865a\u62df\u673a\uff08JVM\uff09\u662f Java \u7a0b\u5e8f\u7684\u8fd0\u884c\u73af\u5883\u3002\u7406\u89e3 JVM \u7684\u5de5\u4f5c\u539f\u7406\u5bf9\u4e8e\u7f16\u5199\u9ad8\u6027\u80fd\u7684 Java \u5e94\u7528\u81f3\u5173\u91cd\u8981\u3002","source":"@site/docs/java/jvm-basics.md","sourceDirName":"java","slug":"/java/jvm-basics","permalink":"/docs/java/jvm-basics","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/java/jvm-basics.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_position":13,"title":"JVM \u57fa\u7840"},"sidebar":"java","previous":{"title":"\u53cd\u5c04\u4e0e\u6ce8\u89e3","permalink":"/docs/java/reflection-annotation"},"next":{"title":"\u6027\u80fd\u4f18\u5316","permalink":"/docs/java/performance"}}');var t=a(22714),l=a(48885);const s={sidebar_position:13,title:"JVM \u57fa\u7840"},r="JVM \u57fa\u7840",c={},o=[{value:"JVM \u67b6\u6784",id:"jvm-\u67b6\u6784",level:2},{value:"JVM \u7ec4\u6210\u7ed3\u6784",id:"jvm-\u7ec4\u6210\u7ed3\u6784",level:3},{value:"\u8fd0\u884c\u65f6\u6570\u636e\u533a",id:"\u8fd0\u884c\u65f6\u6570\u636e\u533a",level:3},{value:"\u7c7b\u52a0\u8f7d\u673a\u5236",id:"\u7c7b\u52a0\u8f7d\u673a\u5236",level:2},{value:"\u7c7b\u52a0\u8f7d\u8fc7\u7a0b",id:"\u7c7b\u52a0\u8f7d\u8fc7\u7a0b",level:3},{value:"\u7c7b\u52a0\u8f7d\u5668",id:"\u7c7b\u52a0\u8f7d\u5668",level:3},{value:"\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b",id:"\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b",level:3},{value:"\u5185\u5b58\u6a21\u578b",id:"\u5185\u5b58\u6a21\u578b",level:2},{value:"Java\u5185\u5b58\u6a21\u578b\uff08JMM\uff09",id:"java\u5185\u5b58\u6a21\u578bjmm",level:3},{value:"happens-before \u539f\u5219",id:"happens-before-\u539f\u5219",level:3},{value:"\u5783\u573e\u56de\u6536\uff08GC\uff09",id:"\u5783\u573e\u56de\u6536gc",level:2},{value:"\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u5b58\u6d3b",id:"\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u5b58\u6d3b",level:3},{value:"\u5f15\u7528\u8ba1\u6570\u6cd5\uff08\u4e0d\u63a8\u8350\uff09",id:"\u5f15\u7528\u8ba1\u6570\u6cd5\u4e0d\u63a8\u8350",level:4},{value:"\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\uff08\u63a8\u8350\uff09",id:"\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\u63a8\u8350",level:4},{value:"\u5783\u573e\u56de\u6536\u7b97\u6cd5",id:"\u5783\u573e\u56de\u6536\u7b97\u6cd5",level:3},{value:"1. \u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5",id:"1-\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5",level:4},{value:"2. \u590d\u5236\u7b97\u6cd5",id:"2-\u590d\u5236\u7b97\u6cd5",level:4},{value:"3. \u6807\u8bb0-\u6574\u7406\u7b97\u6cd5",id:"3-\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5",level:4},{value:"\u5206\u4ee3\u6536\u96c6",id:"\u5206\u4ee3\u6536\u96c6",level:3},{value:"\u5e38\u89c1\u5783\u573e\u56de\u6536\u5668",id:"\u5e38\u89c1\u5783\u573e\u56de\u6536\u5668",level:3},{value:"JVM \u8c03\u4f18",id:"jvm-\u8c03\u4f18",level:2},{value:"\u5e38\u7528JVM\u53c2\u6570",id:"\u5e38\u7528jvm\u53c2\u6570",level:3},{value:"\u5185\u5b58\u6ea2\u51fa\u793a\u4f8b",id:"\u5185\u5b58\u6ea2\u51fa\u793a\u4f8b",level:3},{value:"\u6027\u80fd\u76d1\u63a7\u5de5\u5177",id:"\u6027\u80fd\u76d1\u63a7\u5de5\u5177",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"jvm-\u57fa\u7840",children:"JVM \u57fa\u7840"})}),"\n",(0,t.jsx)(e.p,{children:"Java \u865a\u62df\u673a\uff08JVM\uff09\u662f Java \u7a0b\u5e8f\u7684\u8fd0\u884c\u73af\u5883\u3002\u7406\u89e3 JVM \u7684\u5de5\u4f5c\u539f\u7406\u5bf9\u4e8e\u7f16\u5199\u9ad8\u6027\u80fd\u7684 Java \u5e94\u7528\u81f3\u5173\u91cd\u8981\u3002"}),"\n",(0,t.jsx)(e.h2,{id:"jvm-\u67b6\u6784",children:"JVM \u67b6\u6784"}),"\n",(0,t.jsx)(e.h3,{id:"jvm-\u7ec4\u6210\u7ed3\u6784",children:"JVM \u7ec4\u6210\u7ed3\u6784"}),"\n",(0,t.jsx)(e.mermaid,{value:"graph TD\n    A[Java\u6e90\u4ee3\u7801 .java] --\x3e B[\u7f16\u8bd1\u5668 javac]\n    B --\x3e C[\u5b57\u8282\u7801 .class]\n    C --\x3e D[\u7c7b\u52a0\u8f7d\u5668]\n    D --\x3e E[\u8fd0\u884c\u65f6\u6570\u636e\u533a]\n    E --\x3e F[\u6267\u884c\u5f15\u64ce]\n    F --\x3e G[\u672c\u5730\u65b9\u6cd5\u63a5\u53e3]\n    G --\x3e H[\u672c\u5730\u65b9\u6cd5\u5e93]"}),"\n",(0,t.jsx)(e.h3,{id:"\u8fd0\u884c\u65f6\u6570\u636e\u533a",children:"\u8fd0\u884c\u65f6\u6570\u636e\u533a"}),"\n",(0,t.jsx)(e.p,{children:"JVM \u8fd0\u884c\u65f6\u6570\u636e\u533a\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'/**\n * JVM \u8fd0\u884c\u65f6\u6570\u636e\u533a\u793a\u610f\n */\npublic class RuntimeDataAreas {\n    // 1. \u65b9\u6cd5\u533a\uff08Method Area\uff09- \u7ebf\u7a0b\u5171\u4eab\n    //    \u5b58\u50a8\uff1a\u7c7b\u4fe1\u606f\u3001\u5e38\u91cf\u3001\u9759\u6001\u53d8\u91cf\u3001\u5373\u65f6\u7f16\u8bd1\u5668\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\n    private static String CLASS_INFO = "\u7c7b\u4fe1\u606f";\n    private static final String CONSTANT = "\u5e38\u91cf";\n    \n    // 2. \u5806\uff08Heap\uff09- \u7ebf\u7a0b\u5171\u4eab\n    //    \u5b58\u50a8\uff1a\u5bf9\u8c61\u5b9e\u4f8b\u3001\u6570\u7ec4\n    private Object instance = new Object();\n    private int[] array = new int[10];\n    \n    // 3. \u865a\u62df\u673a\u6808\uff08VM Stack\uff09- \u7ebf\u7a0b\u79c1\u6709\n    //    \u5b58\u50a8\uff1a\u5c40\u90e8\u53d8\u91cf\u8868\u3001\u64cd\u4f5c\u6570\u6808\u3001\u52a8\u6001\u94fe\u63a5\u3001\u65b9\u6cd5\u51fa\u53e3\n    public void method() {\n        int localVar = 10;  // \u5c40\u90e8\u53d8\u91cf\u5b58\u50a8\u5728\u6808\u4e2d\n    }\n    \n    // 4. \u672c\u5730\u65b9\u6cd5\u6808\uff08Native Method Stack\uff09- \u7ebf\u7a0b\u79c1\u6709\n    //    \u4e3a\u672c\u5730\u65b9\u6cd5\u670d\u52a1\n    private native void nativeMethod();\n    \n    // 5. \u7a0b\u5e8f\u8ba1\u6570\u5668\uff08Program Counter\uff09- \u7ebf\u7a0b\u79c1\u6709\n    //    \u5f53\u524d\u7ebf\u7a0b\u6267\u884c\u7684\u5b57\u8282\u7801\u884c\u53f7\u6307\u793a\u5668\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"\u7c7b\u52a0\u8f7d\u673a\u5236",children:"\u7c7b\u52a0\u8f7d\u673a\u5236"}),"\n",(0,t.jsx)(e.h3,{id:"\u7c7b\u52a0\u8f7d\u8fc7\u7a0b",children:"\u7c7b\u52a0\u8f7d\u8fc7\u7a0b"}),"\n",(0,t.jsx)(e.p,{children:"\u7c7b\u4ece\u88ab\u52a0\u8f7d\u5230\u865a\u62df\u673a\u5185\u5b58\u4e2d\u5f00\u59cb\uff0c\u5230\u5378\u8f7d\u51fa\u5185\u5b58\u4e3a\u6b62\uff0c\u6574\u4e2a\u751f\u547d\u5468\u671f\u5305\u62ec\uff1a"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"\u52a0\u8f7d\uff08Loading\uff09"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"\u9a8c\u8bc1\uff08Verification\uff09"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"\u51c6\u5907\uff08Preparation\uff09"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"\u89e3\u6790\uff08Resolution\uff09"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"\u521d\u59cb\u5316\uff08Initialization\uff09"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"\u4f7f\u7528\uff08Using\uff09"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.strong,{children:"\u5378\u8f7d\uff08Unloading\uff09"})}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'public class ClassLoadingExample {\n    // \u51c6\u5907\u9636\u6bb5\uff1a\u4e3a\u9759\u6001\u53d8\u91cf\u5206\u914d\u5185\u5b58\u5e76\u8bbe\u7f6e\u9ed8\u8ba4\u521d\u59cb\u503c 0\n    // \u521d\u59cb\u5316\u9636\u6bb5\uff1a\u6267\u884c\u9759\u6001\u53d8\u91cf\u8d4b\u503c\u548c\u9759\u6001\u4ee3\u7801\u5757\n    private static int value = 123;\n    \n    static {\n        System.out.println("\u9759\u6001\u4ee3\u7801\u5757\u6267\u884c");\n        value = 456;\n    }\n    \n    public static void main(String[] args) {\n        System.out.println("value = " + value);  // 456\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"\u7c7b\u52a0\u8f7d\u5668",children:"\u7c7b\u52a0\u8f7d\u5668"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'public class ClassLoaderExample {\n    public static void main(String[] args) {\n        // \u83b7\u53d6\u7c7b\u52a0\u8f7d\u5668\n        ClassLoader classLoader = ClassLoaderExample.class.getClassLoader();\n        System.out.println("\u5f53\u524d\u7c7b\u7684\u7c7b\u52a0\u8f7d\u5668: " + classLoader);\n        \n        // \u7236\u7c7b\u52a0\u8f7d\u5668\n        ClassLoader parent = classLoader.getParent();\n        System.out.println("\u7236\u7c7b\u52a0\u8f7d\u5668: " + parent);\n        \n        // \u7956\u7236\u7c7b\u52a0\u8f7d\u5668\uff08Bootstrap ClassLoader \u662f C++ \u5b9e\u73b0\uff0cJava\u4e2d\u4e3anull\uff09\n        ClassLoader grandParent = parent.getParent();\n        System.out.println("\u7956\u7236\u7c7b\u52a0\u8f7d\u5668: " + grandParent);\n        \n        // \u7cfb\u7edf\u7c7b\u7684\u7c7b\u52a0\u8f7d\u5668\n        ClassLoader systemClassLoader = String.class.getClassLoader();\n        System.out.println("String\u7c7b\u7684\u7c7b\u52a0\u8f7d\u5668: " + systemClassLoader);\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b",children:"\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'/**\n * \u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668\u793a\u4f8b\n */\npublic class CustomClassLoader extends ClassLoader {\n    \n    @Override\n    protected Class<?> findClass(String name) throws ClassNotFoundException {\n        // \u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u903b\u8f91\n        byte[] classData = loadClassData(name);\n        if (classData == null) {\n            throw new ClassNotFoundException();\n        }\n        return defineClass(name, classData, 0, classData.length);\n    }\n    \n    private byte[] loadClassData(String className) {\n        // \u4ece\u6587\u4ef6\u6216\u7f51\u7edc\u52a0\u8f7d\u7c7b\u7684\u5b57\u8282\u7801\n        // \u8fd9\u91cc\u7701\u7565\u5177\u4f53\u5b9e\u73b0\n        return null;\n    }\n    \n    public static void main(String[] args) {\n        CustomClassLoader loader = new CustomClassLoader();\n        try {\n            Class<?> clazz = loader.loadClass("com.example.MyClass");\n            System.out.println("\u6210\u529f\u52a0\u8f7d\u7c7b: " + clazz.getName());\n        } catch (ClassNotFoundException e) {\n            e.printStackTrace();\n        }\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"\u5185\u5b58\u6a21\u578b",children:"\u5185\u5b58\u6a21\u578b"}),"\n",(0,t.jsx)(e.h3,{id:"java\u5185\u5b58\u6a21\u578bjmm",children:"Java\u5185\u5b58\u6a21\u578b\uff08JMM\uff09"}),"\n",(0,t.jsx)(e.p,{children:"Java \u5185\u5b58\u6a21\u578b\u5b9a\u4e49\u4e86\u7ebf\u7a0b\u548c\u4e3b\u5185\u5b58\u4e4b\u95f4\u7684\u62bd\u8c61\u5173\u7cfb\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"public class JMMExample {\n    // volatile \u4fdd\u8bc1\u53ef\u89c1\u6027\u548c\u6709\u5e8f\u6027\n    private volatile boolean flag = false;\n    private int value = 0;\n    \n    // \u7ebf\u7a0b1\uff1a\u5199\u64cd\u4f5c\n    public void writer() {\n        value = 42;      // 1\n        flag = true;     // 2 - volatile\u5199\n    }\n    \n    // \u7ebf\u7a0b2\uff1a\u8bfb\u64cd\u4f5c\n    public void reader() {\n        if (flag) {      // 3 - volatile\u8bfb\n            int temp = value;  // 4 - \u4fdd\u8bc1\u80fd\u770b\u523042\n            System.out.println(temp);\n        }\n    }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"happens-before-\u539f\u5219",children:"happens-before \u539f\u5219"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"public class HappensBeforeExample {\n    private int x = 0;\n    private int y = 0;\n    \n    // \u89c4\u52191\uff1a\u7a0b\u5e8f\u987a\u5e8f\u89c4\u5219\n    public void rule1() {\n        x = 1;  // happens-before\n        y = 2;  // \u8fd9\u4e2a\u64cd\u4f5c\n    }\n    \n    // \u89c4\u52192\uff1amonitor\u9501\u89c4\u5219\n    private final Object lock = new Object();\n    public void rule2() {\n        synchronized (lock) {\n            x = 1;\n        }  // \u89e3\u9501 happens-before \u540e\u7eed\u7684\u52a0\u9501\n        \n        synchronized (lock) {\n            int temp = x;  // \u80fd\u770b\u5230 x = 1\n        }\n    }\n    \n    // \u89c4\u52193\uff1avolatile\u53d8\u91cf\u89c4\u5219\n    private volatile boolean ready = false;\n    public void rule3() {\n        x = 1;\n        ready = true;  // volatile\u5199 happens-before volatile\u8bfb\n    }\n    \n    public void rule3Read() {\n        if (ready) {\n            int temp = x;  // \u80fd\u770b\u5230 x = 1\n        }\n    }\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u5783\u573e\u56de\u6536gc",children:"\u5783\u573e\u56de\u6536\uff08GC\uff09"}),"\n",(0,t.jsx)(e.h3,{id:"\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u5b58\u6d3b",children:"\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u5b58\u6d3b"}),"\n",(0,t.jsx)(e.h4,{id:"\u5f15\u7528\u8ba1\u6570\u6cd5\u4e0d\u63a8\u8350",children:"\u5f15\u7528\u8ba1\u6570\u6cd5\uff08\u4e0d\u63a8\u8350\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"public class ReferenceCountingGC {\n    public Object instance = null;\n    \n    public static void main(String[] args) {\n        ReferenceCountingGC objA = new ReferenceCountingGC();\n        ReferenceCountingGC objB = new ReferenceCountingGC();\n        \n        // \u5faa\u73af\u5f15\u7528\n        objA.instance = objB;\n        objB.instance = objA;\n        \n        objA = null;\n        objB = null;\n        \n        // \u5f15\u7528\u8ba1\u6570\u6cd5\u65e0\u6cd5\u56de\u6536\u5faa\u73af\u5f15\u7528\u7684\u5bf9\u8c61\n        System.gc();\n    }\n}\n"})}),"\n",(0,t.jsx)(e.h4,{id:"\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\u63a8\u8350",children:"\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\uff08\u63a8\u8350\uff09"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"/**\n * GC Roots \u5305\u62ec\uff1a\n * 1. \u865a\u62df\u673a\u6808\u4e2d\u5f15\u7528\u7684\u5bf9\u8c61\n * 2. \u65b9\u6cd5\u533a\u4e2d\u9759\u6001\u5c5e\u6027\u5f15\u7528\u7684\u5bf9\u8c61\n * 3. \u65b9\u6cd5\u533a\u4e2d\u5e38\u91cf\u5f15\u7528\u7684\u5bf9\u8c61\n * 4. \u672c\u5730\u65b9\u6cd5\u6808\u4e2d\u5f15\u7528\u7684\u5bf9\u8c61\n */\npublic class ReachabilityAnalysis {\n    // GC Root - \u9759\u6001\u53d8\u91cf\n    private static Object staticVar = new Object();\n    \n    // GC Root - \u5e38\u91cf\n    private static final Object CONSTANT = new Object();\n    \n    public void method() {\n        // GC Root - \u5c40\u90e8\u53d8\u91cf\n        Object localVar = new Object();\n        \n        // \u5bf9\u8c61\u53ef\u8fbe\uff0c\u4e0d\u4f1a\u88ab\u56de\u6536\n        Object reachable = staticVar;\n    }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"\u5783\u573e\u56de\u6536\u7b97\u6cd5",children:"\u5783\u573e\u56de\u6536\u7b97\u6cd5"}),"\n",(0,t.jsx)(e.h4,{id:"1-\u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5",children:"1. \u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"/**\n * \u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5\n * \u4f18\u70b9\uff1a\u7b80\u5355\n * \u7f3a\u70b9\uff1a\u6548\u7387\u4f4e\u3001\u4ea7\u751f\u5185\u5b58\u788e\u7247\n */\npublic class MarkSweepGC {\n    public static void main(String[] args) {\n        // \u521b\u5efa\u5bf9\u8c61\n        Object obj1 = new Object();\n        Object obj2 = new Object();\n        Object obj3 = new Object();\n        \n        // \u7f6e\u4e3anull\uff0c\u53d8\u4e3a\u5783\u573e\n        obj1 = null;\n        obj3 = null;\n        \n        // GC\u4f1a\u6807\u8bb0obj1\u548cobj3\uff0c\u7136\u540e\u6e05\u9664\n        System.gc();\n    }\n}\n"})}),"\n",(0,t.jsx)(e.h4,{id:"2-\u590d\u5236\u7b97\u6cd5",children:"2. \u590d\u5236\u7b97\u6cd5"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"/**\n * \u590d\u5236\u7b97\u6cd5\n * \u4f18\u70b9\uff1a\u4e0d\u4ea7\u751f\u788e\u7247\u3001\u6548\u7387\u9ad8\n * \u7f3a\u70b9\uff1a\u6d6a\u8d39\u4e00\u534a\u5185\u5b58\n * \u9002\u7528\u573a\u666f\uff1a\u65b0\u751f\u4ee3\uff08\u5bf9\u8c61\u5b58\u6d3b\u7387\u4f4e\uff09\n */\npublic class CopyingGC {\n    public static void main(String[] args) {\n        // Eden\u533a\u521b\u5efa\u5bf9\u8c61\n        for (int i = 0; i < 1000; i++) {\n            Object obj = new Object();\n        }\n        \n        // Minor GC\u540e\uff0c\u5b58\u6d3b\u5bf9\u8c61\u590d\u5236\u5230Survivor\u533a\n        System.gc();\n    }\n}\n"})}),"\n",(0,t.jsx)(e.h4,{id:"3-\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5",children:"3. \u6807\u8bb0-\u6574\u7406\u7b97\u6cd5"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"/**\n * \u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\n * \u4f18\u70b9\uff1a\u4e0d\u4ea7\u751f\u788e\u7247\u3001\u4e0d\u6d6a\u8d39\u5185\u5b58\n * \u7f3a\u70b9\uff1a\u6548\u7387\u8f83\u4f4e\n * \u9002\u7528\u573a\u666f\uff1a\u8001\u5e74\u4ee3\uff08\u5bf9\u8c61\u5b58\u6d3b\u7387\u9ad8\uff09\n */\npublic class MarkCompactGC {\n    private static List<byte[]> list = new ArrayList<>();\n    \n    public static void main(String[] args) {\n        // \u8001\u5e74\u4ee3\u5bf9\u8c61\n        for (int i = 0; i < 100; i++) {\n            list.add(new byte[1024 * 1024]);  // 1MB\n        }\n        \n        // Full GC\u65f6\u4f7f\u7528\u6807\u8bb0-\u6574\u7406\u7b97\u6cd5\n        System.gc();\n    }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"\u5206\u4ee3\u6536\u96c6",children:"\u5206\u4ee3\u6536\u96c6"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"public class GenerationalGC {\n    public static void main(String[] args) {\n        // \u65b0\u751f\u4ee3\uff08Young Generation\uff09\n        // - Eden\u533a\uff1a\u65b0\u5bf9\u8c61\u5206\u914d\n        // - Survivor From\u533a\n        // - Survivor To\u533a\n        for (int i = 0; i < 1000000; i++) {\n            Object temp = new Object();  // \u5728Eden\u533a\u5206\u914d\n        }  // \u65b9\u6cd5\u7ed3\u675f\uff0ctemp\u53d8\u4e3a\u5783\u573e\uff0cMinor GC\u56de\u6536\n        \n        // \u8001\u5e74\u4ee3\uff08Old Generation\uff09\n        // - \u5927\u5bf9\u8c61\u76f4\u63a5\u8fdb\u5165\u8001\u5e74\u4ee3\n        byte[] largeObj = new byte[10 * 1024 * 1024];  // 10MB\n        \n        // - \u957f\u671f\u5b58\u6d3b\u5bf9\u8c61\u8fdb\u5165\u8001\u5e74\u4ee3\n        List<Object> longLived = new ArrayList<>();\n        for (int i = 0; i < 1000; i++) {\n            longLived.add(new Object());\n        }\n    }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"\u5e38\u89c1\u5783\u573e\u56de\u6536\u5668",children:"\u5e38\u89c1\u5783\u573e\u56de\u6536\u5668"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'/**\n * JVM \u5783\u573e\u56de\u6536\u5668\u53c2\u6570\u793a\u4f8b\n */\npublic class GarbageCollectors {\n    public static void main(String[] args) {\n        // 1. Serial GC\uff08\u4e32\u884c\u6536\u96c6\u5668\uff09\n        // -XX:+UseSerialGC\n        \n        // 2. Parallel GC\uff08\u5e76\u884c\u6536\u96c6\u5668\uff09\n        // -XX:+UseParallelGC\n        // -XX:ParallelGCThreads=4\n        \n        // 3. CMS\uff08Concurrent Mark Sweep\uff09\n        // -XX:+UseConcMarkSweepGC\n        // -XX:CMSInitiatingOccupancyFraction=70\n        \n        // 4. G1\uff08Garbage First\uff09\n        // -XX:+UseG1GC\n        // -XX:MaxGCPauseMillis=200\n        \n        // 5. ZGC\uff08\u4f4e\u5ef6\u8fdf\u6536\u96c6\u5668\uff0cJDK 11+\uff09\n        // -XX:+UseZGC\n        \n        System.out.println("\u5783\u573e\u56de\u6536\u5668\u4fe1\u606f:");\n        System.out.println(System.getProperty("java.vm.name"));\n        \n        // \u6253\u5370GC\u8be6\u7ec6\u4fe1\u606f\n        // -XX:+PrintGCDetails\n        // -XX:+PrintGCTimeStamps\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"jvm-\u8c03\u4f18",children:"JVM \u8c03\u4f18"}),"\n",(0,t.jsx)(e.h3,{id:"\u5e38\u7528jvm\u53c2\u6570",children:"\u5e38\u7528JVM\u53c2\u6570"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'/**\n * JVM \u53c2\u6570\u914d\u7f6e\u793a\u4f8b\n */\npublic class JVMParameters {\n    public static void main(String[] args) {\n        // \u6253\u5370\u5f53\u524dJVM\u53c2\u6570\n        System.out.println("\u6700\u5927\u5806\u5185\u5b58: " + \n            Runtime.getRuntime().maxMemory() / 1024 / 1024 + "MB");\n        System.out.println("\u603b\u5185\u5b58: " + \n            Runtime.getRuntime().totalMemory() / 1024 / 1024 + "MB");\n        System.out.println("\u7a7a\u95f2\u5185\u5b58: " + \n            Runtime.getRuntime().freeMemory() / 1024 / 1024 + "MB");\n    }\n}\n\n/**\n * \u5e38\u7528JVM\u53c2\u6570\uff1a\n * \n * \u5806\u5185\u5b58\u914d\u7f6e\uff1a\n * -Xms2g          # \u521d\u59cb\u5806\u5927\u5c0f 2GB\n * -Xmx2g          # \u6700\u5927\u5806\u5927\u5c0f 2GB\n * -Xmn512m        # \u65b0\u751f\u4ee3\u5927\u5c0f 512MB\n * -XX:SurvivorRatio=8  # Eden:Survivor = 8:1\n * \n * \u65b9\u6cd5\u533a\u914d\u7f6e\uff1a\n * -XX:MetaspaceSize=128m       # \u5143\u7a7a\u95f4\u521d\u59cb\u5927\u5c0f\n * -XX:MaxMetaspaceSize=256m    # \u5143\u7a7a\u95f4\u6700\u5927\u5927\u5c0f\n * \n * \u6808\u914d\u7f6e\uff1a\n * -Xss256k        # \u7ebf\u7a0b\u6808\u5927\u5c0f\n * \n * GC\u65e5\u5fd7\uff1a\n * -XX:+PrintGCDetails          # \u6253\u5370GC\u8be6\u7ec6\u4fe1\u606f\n * -XX:+PrintGCDateStamps       # \u6253\u5370GC\u65f6\u95f4\u6233\n * -Xloggc:gc.log              # GC\u65e5\u5fd7\u6587\u4ef6\n * \n * OOM\u5904\u7406\uff1a\n * -XX:+HeapDumpOnOutOfMemoryError    # OOM\u65f6\u751f\u6210\u5806\u8f6c\u50a8\n * -XX:HeapDumpPath=/path/to/dump     # \u5806\u8f6c\u50a8\u6587\u4ef6\u8def\u5f84\n */\n'})}),"\n",(0,t.jsx)(e.h3,{id:"\u5185\u5b58\u6ea2\u51fa\u793a\u4f8b",children:"\u5185\u5b58\u6ea2\u51fa\u793a\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"import java.util.ArrayList;\nimport java.util.List;\n\npublic class OutOfMemoryExample {\n    \n    // 1. \u5806\u6ea2\u51fa\uff08Heap OOM\uff09\n    public static void heapOOM() {\n        // -Xms20m -Xmx20m\n        List<byte[]> list = new ArrayList<>();\n        while (true) {\n            list.add(new byte[1024 * 1024]);  // 1MB\n        }\n        // Exception: java.lang.OutOfMemoryError: Java heap space\n    }\n    \n    // 2. \u6808\u6ea2\u51fa\uff08Stack Overflow\uff09\n    private static int depth = 0;\n    public static void stackOverflow() {\n        // -Xss256k\n        depth++;\n        stackOverflow();  // \u65e0\u9650\u9012\u5f52\n        // Exception: java.lang.StackOverflowError\n    }\n    \n    // 3. \u5143\u7a7a\u95f4\u6ea2\u51fa\uff08Metaspace OOM\uff09\n    public static void metaspaceOOM() {\n        // -XX:MaxMetaspaceSize=10m\n        while (true) {\n            // \u52a8\u6001\u751f\u6210\u7c7b\n            Enhancer enhancer = new Enhancer();\n            enhancer.setSuperclass(Object.class);\n            enhancer.setCallback((MethodInterceptor) \n                (obj, method, args, proxy) -> proxy.invokeSuper(obj, args));\n            enhancer.create();\n        }\n        // Exception: java.lang.OutOfMemoryError: Metaspace\n    }\n    \n    public static void main(String[] args) {\n        // \u9009\u62e9\u8981\u6d4b\u8bd5\u7684OOM\u573a\u666f\n        // heapOOM();\n        // stackOverflow();\n        // metaspaceOOM();\n    }\n}\n"})}),"\n",(0,t.jsx)(e.h3,{id:"\u6027\u80fd\u76d1\u63a7\u5de5\u5177",children:"\u6027\u80fd\u76d1\u63a7\u5de5\u5177"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'import java.lang.management.*;\n\npublic class JVMMonitoring {\n    public static void main(String[] args) {\n        // 1. \u83b7\u53d6\u5185\u5b58\u4fe1\u606f\n        MemoryMXBean memoryMXBean = ManagementFactory.getMemoryMXBean();\n        MemoryUsage heapUsage = memoryMXBean.getHeapMemoryUsage();\n        \n        System.out.println("\u5806\u5185\u5b58\u4f7f\u7528\u60c5\u51b5:");\n        System.out.println("  \u521d\u59cb: " + heapUsage.getInit() / 1024 / 1024 + "MB");\n        System.out.println("  \u5df2\u7528: " + heapUsage.getUsed() / 1024 / 1024 + "MB");\n        System.out.println("  \u63d0\u4ea4: " + heapUsage.getCommitted() / 1024 / 1024 + "MB");\n        System.out.println("  \u6700\u5927: " + heapUsage.getMax() / 1024 / 1024 + "MB");\n        \n        // 2. \u83b7\u53d6\u7ebf\u7a0b\u4fe1\u606f\n        ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();\n        System.out.println("\\n\u7ebf\u7a0b\u4fe1\u606f:");\n        System.out.println("  \u6d3b\u52a8\u7ebf\u7a0b\u6570: " + threadMXBean.getThreadCount());\n        System.out.println("  \u5cf0\u503c\u7ebf\u7a0b\u6570: " + threadMXBean.getPeakThreadCount());\n        \n        // 3. \u83b7\u53d6GC\u4fe1\u606f\n        List<GarbageCollectorMXBean> gcBeans = \n            ManagementFactory.getGarbageCollectorMXBeans();\n        System.out.println("\\nGC\u4fe1\u606f:");\n        for (GarbageCollectorMXBean gcBean : gcBeans) {\n            System.out.println("  " + gcBean.getName() + ":");\n            System.out.println("    \u6b21\u6570: " + gcBean.getCollectionCount());\n            System.out.println("    \u65f6\u95f4: " + gcBean.getCollectionTime() + "ms");\n        }\n    }\n}\n\n/**\n * \u5e38\u7528\u76d1\u63a7\u5de5\u5177\uff1a\n * \n * 1. jps - \u67e5\u770bJava\u8fdb\u7a0b\n *    jps -l\n * \n * 2. jstat - \u67e5\u770bGC\u7edf\u8ba1\n *    jstat -gc <pid> 1000\n * \n * 3. jmap - \u751f\u6210\u5806\u8f6c\u50a8\n *    jmap -dump:format=b,file=heap.bin <pid>\n * \n * 4. jstack - \u7ebf\u7a0b\u5806\u6808\u8ddf\u8e2a\n *    jstack <pid>\n * \n * 5. jconsole - \u56fe\u5f62\u5316\u76d1\u63a7\u5de5\u5177\n * \n * 6. VisualVM - \u53ef\u89c6\u5316\u76d1\u63a7\u5de5\u5177\n * \n * 7. JProfiler - \u5546\u4e1a\u6027\u80fd\u5206\u6790\u5de5\u5177\n */\n'})}),"\n",(0,t.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,t.jsx)(e.p,{children:"\u672c\u6587\u4ecb\u7ecd\u4e86 JVM \u7684\u6838\u5fc3\u6982\u5ff5\uff1a"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u2705 JVM \u67b6\u6784\u548c\u8fd0\u884c\u65f6\u6570\u636e\u533a"}),"\n",(0,t.jsx)(e.li,{children:"\u2705 \u7c7b\u52a0\u8f7d\u673a\u5236\u548c\u7c7b\u52a0\u8f7d\u5668"}),"\n",(0,t.jsx)(e.li,{children:"\u2705 Java \u5185\u5b58\u6a21\u578b"}),"\n",(0,t.jsx)(e.li,{children:"\u2705 \u5783\u573e\u56de\u6536\u7b97\u6cd5\u548c\u56de\u6536\u5668"}),"\n",(0,t.jsx)(e.li,{children:"\u2705 JVM \u8c03\u4f18\u53c2\u6570\u548c\u76d1\u63a7\u5de5\u5177"}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:["\u7406\u89e3 JVM \u539f\u7406\u6709\u52a9\u4e8e\u7f16\u5199\u9ad8\u6027\u80fd\u3001\u53ef\u9760\u7684 Java \u5e94\u7528\u3002\u4e0b\u4e00\u6b65\u53ef\u4ee5\u5b66\u4e60 ",(0,t.jsx)(e.a,{href:"./performance",children:"\u6027\u80fd\u4f18\u5316"})," \u76f8\u5173\u5185\u5bb9\u3002"]})]})}function p(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},48885:(n,e,a)=>{a.d(e,{R:()=>s,x:()=>r});var i=a(99378);const t={},l=i.createContext(t);function s(n){const e=i.useContext(l);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:s(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);
"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[10425],{19310:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>d,contentTitle:()=>a,default:()=>c,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"ai/guardrails","title":"\ud83d\udee1\ufe0f Guardrails\uff08\u62a4\u680f\uff09","description":"Guardrails \u662f\u4fdd\u62a4 AI \u5e94\u7528\u5b89\u5168\u7684\u9632\u62a4\u673a\u5236\uff0c\u7528\u4e8e\u8fc7\u6ee4\u6709\u5bb3\u8f93\u5165\u3001\u9a8c\u8bc1\u8f93\u51fa\u8d28\u91cf\u3001\u9632\u6b62\u6a21\u578b\u6ee5\u7528\u3002","source":"@site/docs/ai/guardrails.md","sourceDirName":"ai","slug":"/ai/guardrails","permalink":"/docs/ai/guardrails","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/ai/guardrails.md","tags":[],"version":"current","sidebarPosition":26,"frontMatter":{"sidebar_position":26,"title":"\ud83d\udee1\ufe0f Guardrails\uff08\u62a4\u680f\uff09"},"sidebar":"ai","previous":{"title":"\ud83d\udd10 Security\uff08\u5b89\u5168\u4e0e\u9690\u79c1\uff09","permalink":"/docs/ai/security"},"next":{"title":"\u2696\ufe0f AI \u4f26\u7406\u4e0e\u5408\u89c4","permalink":"/docs/ai/ai-ethics"}}');var s=r(22714),i=r(48885);const l={sidebar_position:26,title:"\ud83d\udee1\ufe0f Guardrails\uff08\u62a4\u680f\uff09"},a="Guardrails\uff08\u62a4\u680f\uff09",d={},o=[{value:"\u4e3a\u4ec0\u4e48\u9700\u8981 Guardrails\uff1f",id:"\u4e3a\u4ec0\u4e48\u9700\u8981-guardrails",level:2},{value:"\u62a4\u680f\u7c7b\u578b",id:"\u62a4\u680f\u7c7b\u578b",level:2},{value:"\u57fa\u7840\u5b9e\u73b0",id:"\u57fa\u7840\u5b9e\u73b0",level:2},{value:"\u8f93\u5165\u8fc7\u6ee4",id:"\u8f93\u5165\u8fc7\u6ee4",level:3},{value:"\u8f93\u51fa\u9a8c\u8bc1",id:"\u8f93\u51fa\u9a8c\u8bc1",level:3},{value:"\u8bdd\u9898\u8fb9\u754c\u63a7\u5236",id:"\u8bdd\u9898\u8fb9\u754c\u63a7\u5236",level:3},{value:"NeMo Guardrails",id:"nemo-guardrails",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:3},{value:"\u914d\u7f6e\u6587\u4ef6",id:"\u914d\u7f6e\u6587\u4ef6",level:3},{value:"Colang \u89c4\u5219",id:"colang-\u89c4\u5219",level:3},{value:"\u4f7f\u7528 NeMo Guardrails",id:"\u4f7f\u7528-nemo-guardrails",level:3},{value:"Guardrails AI",id:"guardrails-ai",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5-1",level:3},{value:"\u57fa\u7840\u4f7f\u7528",id:"\u57fa\u7840\u4f7f\u7528",level:3},{value:"\u7ed3\u6784\u5316\u8f93\u51fa\u9a8c\u8bc1",id:"\u7ed3\u6784\u5316\u8f93\u51fa\u9a8c\u8bc1",level:3},{value:"OpenAI Moderation API",id:"openai-moderation-api",level:2},{value:"\u5b8c\u6574\u62a4\u680f\u7cfb\u7edf",id:"\u5b8c\u6574\u62a4\u680f\u7cfb\u7edf",level:2},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u5ef6\u4f38\u9605\u8bfb",id:"\u5ef6\u4f38\u9605\u8bfb",level:2}];function u(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"guardrails\u62a4\u680f",children:"Guardrails\uff08\u62a4\u680f\uff09"})}),"\n",(0,s.jsx)(e.p,{children:"Guardrails \u662f\u4fdd\u62a4 AI \u5e94\u7528\u5b89\u5168\u7684\u9632\u62a4\u673a\u5236\uff0c\u7528\u4e8e\u8fc7\u6ee4\u6709\u5bb3\u8f93\u5165\u3001\u9a8c\u8bc1\u8f93\u51fa\u8d28\u91cf\u3001\u9632\u6b62\u6a21\u578b\u6ee5\u7528\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"\u4e3a\u4ec0\u4e48\u9700\u8981-guardrails",children:"\u4e3a\u4ec0\u4e48\u9700\u8981 Guardrails\uff1f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u7528\u6237\u8f93\u5165 \u2500\u2500> [\u8f93\u5165\u62a4\u680f] \u2500\u2500> LLM \u2500\u2500> [\u8f93\u51fa\u62a4\u680f] \u2500\u2500> \u6700\u7ec8\u54cd\u5e94\n              \u2502                        \u2502\n              \u251c\u2500 \u8fc7\u6ee4\u6076\u610f\u5185\u5bb9           \u251c\u2500 \u9a8c\u8bc1\u683c\u5f0f\n              \u251c\u2500 \u68c0\u6d4b\u6ce8\u5165\u653b\u51fb           \u251c\u2500 \u8fc7\u6ee4\u654f\u611f\u4fe1\u606f\n              \u2514\u2500 \u8bdd\u9898\u8fb9\u754c\u63a7\u5236           \u2514\u2500 \u4e8b\u5b9e\u6027\u68c0\u67e5\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u62a4\u680f\u7c7b\u578b",children:"\u62a4\u680f\u7c7b\u578b"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u7c7b\u578b"}),(0,s.jsx)(e.th,{children:"\u4f5c\u7528"}),(0,s.jsx)(e.th,{children:"\u793a\u4f8b"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u8f93\u5165\u62a4\u680f"}),(0,s.jsx)(e.td,{children:"\u8fc7\u6ee4\u7528\u6237\u8f93\u5165"}),(0,s.jsx)(e.td,{children:"\u6ce8\u5165\u68c0\u6d4b\u3001\u654f\u611f\u8bcd\u8fc7\u6ee4"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u8f93\u51fa\u62a4\u680f"}),(0,s.jsx)(e.td,{children:"\u9a8c\u8bc1\u6a21\u578b\u8f93\u51fa"}),(0,s.jsx)(e.td,{children:"\u683c\u5f0f\u6821\u9a8c\u3001\u5185\u5bb9\u5ba1\u6838"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u8bdd\u9898\u62a4\u680f"}),(0,s.jsx)(e.td,{children:"\u9650\u5236\u5bf9\u8bdd\u8303\u56f4"}),(0,s.jsx)(e.td,{children:"\u53ea\u56de\u7b54\u4ea7\u54c1\u76f8\u5173\u95ee\u9898"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u5b89\u5168\u62a4\u680f"}),(0,s.jsx)(e.td,{children:"\u9632\u6b62\u6709\u5bb3\u5185\u5bb9"}),(0,s.jsx)(e.td,{children:"\u66b4\u529b\u3001\u8272\u60c5\u3001\u6b67\u89c6\u68c0\u6d4b"})]})]})]}),"\n",(0,s.jsx)(e.h2,{id:"\u57fa\u7840\u5b9e\u73b0",children:"\u57fa\u7840\u5b9e\u73b0"}),"\n",(0,s.jsx)(e.h3,{id:"\u8f93\u5165\u8fc7\u6ee4",children:"\u8f93\u5165\u8fc7\u6ee4"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'from openai import OpenAI\nimport re\n\nclient = OpenAI()\n\nclass InputGuardrail:\n    """\u8f93\u5165\u62a4\u680f"""\n    \n    def __init__(self):\n        self.blocked_patterns = [\n            r"ignore.*previous.*instructions",\n            r"ignore.*above",\n            r"disregard.*rules",\n            r"\u4f60\u662f.*DAN",\n            r"jailbreak",\n        ]\n        \n        self.sensitive_words = ["\u5bc6\u7801", "\u4fe1\u7528\u5361", "\u8eab\u4efd\u8bc1"]\n    \n    def check_injection(self, text: str) -> tuple[bool, str]:\n        """\u68c0\u6d4b Prompt \u6ce8\u5165"""\n        text_lower = text.lower()\n        \n        for pattern in self.blocked_patterns:\n            if re.search(pattern, text_lower):\n                return False, "\u68c0\u6d4b\u5230\u6f5c\u5728\u7684\u6ce8\u5165\u653b\u51fb"\n        \n        return True, ""\n    \n    def check_sensitive(self, text: str) -> tuple[bool, str]:\n        """\u68c0\u6d4b\u654f\u611f\u4fe1\u606f"""\n        for word in self.sensitive_words:\n            if word in text:\n                return False, f"\u8bf7\u52ff\u5728\u5bf9\u8bdd\u4e2d\u5305\u542b\u654f\u611f\u4fe1\u606f\uff1a{word}"\n        \n        return True, ""\n    \n    def check_length(self, text: str, max_length: int = 4000) -> tuple[bool, str]:\n        """\u68c0\u67e5\u8f93\u5165\u957f\u5ea6"""\n        if len(text) > max_length:\n            return False, f"\u8f93\u5165\u8fc7\u957f\uff0c\u8bf7\u9650\u5236\u5728 {max_length} \u5b57\u7b26\u4ee5\u5185"\n        return True, ""\n    \n    def validate(self, text: str) -> tuple[bool, str]:\n        """\u7efc\u5408\u9a8c\u8bc1"""\n        checks = [\n            self.check_injection,\n            self.check_sensitive,\n            self.check_length,\n        ]\n        \n        for check in checks:\n            passed, message = check(text)\n            if not passed:\n                return False, message\n        \n        return True, ""\n\n# \u4f7f\u7528\nguardrail = InputGuardrail()\npassed, message = guardrail.validate(user_input)\nif not passed:\n    print(f"\u8f93\u5165\u88ab\u62d2\u7edd\uff1a{message}")\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u8f93\u51fa\u9a8c\u8bc1",children:"\u8f93\u51fa\u9a8c\u8bc1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'import json\nfrom pydantic import BaseModel, ValidationError\n\nclass OutputGuardrail:\n    """\u8f93\u51fa\u62a4\u680f"""\n    \n    def __init__(self):\n        self.forbidden_content = ["\u66b4\u529b", "\u8272\u60c5", "\u6b67\u89c6"]\n        self.client = OpenAI()\n    \n    def check_format(self, output: str, expected_format: type[BaseModel]) -> tuple[bool, str]:\n        """\u9a8c\u8bc1\u8f93\u51fa\u683c\u5f0f"""\n        try:\n            expected_format.model_validate_json(output)\n            return True, ""\n        except ValidationError as e:\n            return False, f"\u683c\u5f0f\u9a8c\u8bc1\u5931\u8d25\uff1a{e}"\n    \n    def check_content_safety(self, output: str) -> tuple[bool, str]:\n        """\u5185\u5bb9\u5b89\u5168\u68c0\u67e5"""\n        # \u4f7f\u7528 Moderation API\n        response = self.client.moderations.create(input=output)\n        \n        result = response.results[0]\n        if result.flagged:\n            categories = [k for k, v in result.categories.model_dump().items() if v]\n            return False, f"\u5185\u5bb9\u4e0d\u5b89\u5168\uff1a{categories}"\n        \n        return True, ""\n    \n    def check_pii(self, output: str) -> tuple[bool, str]:\n        """\u68c0\u6d4b PII\uff08\u4e2a\u4eba\u8eab\u4efd\u4fe1\u606f\uff09"""\n        pii_patterns = {\n            "phone": r"\\d{11}",\n            "id_card": r"\\d{17}[\\dXx]",\n            "email": r"[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}",\n        }\n        \n        for pii_type, pattern in pii_patterns.items():\n            if re.search(pattern, output):\n                return False, f"\u8f93\u51fa\u5305\u542b\u654f\u611f\u4fe1\u606f\uff1a{pii_type}"\n        \n        return True, ""\n    \n    def validate(self, output: str) -> tuple[bool, str]:\n        """\u7efc\u5408\u9a8c\u8bc1"""\n        checks = [\n            self.check_content_safety,\n            self.check_pii,\n        ]\n        \n        for check in checks:\n            passed, message = check(output)\n            if not passed:\n                return False, message\n        \n        return True, ""\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u8bdd\u9898\u8fb9\u754c\u63a7\u5236",children:"\u8bdd\u9898\u8fb9\u754c\u63a7\u5236"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'class TopicGuardrail:\n    """\u8bdd\u9898\u62a4\u680f"""\n    \n    def __init__(self, allowed_topics: list[str], system_context: str):\n        self.allowed_topics = allowed_topics\n        self.system_context = system_context\n        self.client = OpenAI()\n    \n    def check_topic(self, user_input: str) -> tuple[bool, str]:\n        """\u68c0\u67e5\u662f\u5426\u5728\u5141\u8bb8\u7684\u8bdd\u9898\u8303\u56f4\u5185"""\n        response = self.client.chat.completions.create(\n            model="gpt-4o-mini",\n            messages=[\n                {\n                    "role": "system",\n                    "content": f"""\u5224\u65ad\u7528\u6237\u95ee\u9898\u662f\u5426\u4e0e\u4ee5\u4e0b\u8bdd\u9898\u76f8\u5173\uff1a\n{\', \'.join(self.allowed_topics)}\n\n\u4e0a\u4e0b\u6587\uff1a{self.system_context}\n\n\u53ea\u56de\u7b54 "\u76f8\u5173" \u6216 "\u4e0d\u76f8\u5173"\u3002"""\n                },\n                {"role": "user", "content": user_input}\n            ],\n            max_tokens=10\n        )\n        \n        result = response.choices[0].message.content.strip()\n        \n        if "\u4e0d\u76f8\u5173" in result:\n            return False, f"\u62b1\u6b49\uff0c\u6211\u53ea\u80fd\u56de\u7b54\u5173\u4e8e {\', \'.join(self.allowed_topics)} \u7684\u95ee\u9898\u3002"\n        \n        return True, ""\n\n# \u4f7f\u7528\ntopic_guard = TopicGuardrail(\n    allowed_topics=["\u4ea7\u54c1\u529f\u80fd", "\u6280\u672f\u652f\u6301", "\u8d26\u6237\u95ee\u9898"],\n    system_context="\u8fd9\u662f\u4e00\u4e2a\u7535\u5546\u5e73\u53f0\u7684\u5ba2\u670d\u52a9\u624b"\n)\n'})}),"\n",(0,s.jsx)(e.h2,{id:"nemo-guardrails",children:"NeMo Guardrails"}),"\n",(0,s.jsx)(e.p,{children:"NVIDIA NeMo Guardrails \u662f\u4e00\u4e2a\u5f00\u6e90\u6846\u67b6\uff0c\u63d0\u4f9b\u58f0\u660e\u5f0f\u7684\u62a4\u680f\u914d\u7f6e\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"pip install nemoguardrails\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u914d\u7f6e\u6587\u4ef6",children:"\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'# config.yml\nmodels:\n  - type: main\n    engine: openai\n    model: gpt-4o\n\nrails:\n  input:\n    flows:\n      - self check input\n  output:\n    flows:\n      - self check output\n\nprompts:\n  - task: self_check_input\n    content: |\n      \u5224\u65ad\u4ee5\u4e0b\u7528\u6237\u8f93\u5165\u662f\u5426\u5b89\u5168\u3001\u5408\u89c4\uff1a\n      \n      \u7528\u6237\u8f93\u5165\uff1a{{ user_input }}\n      \n      \u5982\u679c\u8f93\u5165\u5b89\u5168\uff0c\u56de\u7b54 "allowed"\n      \u5982\u679c\u8f93\u5165\u4e0d\u5b89\u5168\uff0c\u56de\u7b54 "blocked"\n      \n  - task: self_check_output\n    content: |\n      \u5224\u65ad\u4ee5\u4e0b AI \u56de\u590d\u662f\u5426\u5b89\u5168\u3001\u5408\u89c4\uff1a\n      \n      AI \u56de\u590d\uff1a{{ bot_response }}\n      \n      \u5982\u679c\u56de\u590d\u5b89\u5168\uff0c\u56de\u7b54 "allowed"\n      \u5982\u679c\u56de\u590d\u4e0d\u5b89\u5168\uff0c\u56de\u7b54 "blocked"\n'})}),"\n",(0,s.jsx)(e.h3,{id:"colang-\u89c4\u5219",children:"Colang \u89c4\u5219"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-colang",children:'# rails.co\n\n# \u5b9a\u4e49\u7528\u6237\u610f\u56fe\ndefine user ask about product\n  "\u8fd9\u4e2a\u4ea7\u54c1\u600e\u4e48\u6837"\n  "\u4ea7\u54c1\u6709\u4ec0\u4e48\u529f\u80fd"\n  "\u4ef7\u683c\u662f\u591a\u5c11"\n\ndefine user ask harmful\n  "\u5982\u4f55\u5236\u4f5c\u70b8\u5f39"\n  "\u600e\u4e48\u653b\u51fb\u522b\u4eba"\n\n# \u5b9a\u4e49\u673a\u5668\u4eba\u56de\u590d\ndefine bot refuse harmful\n  "\u62b1\u6b49\uff0c\u6211\u65e0\u6cd5\u56de\u7b54\u8fd9\u7c7b\u95ee\u9898\u3002"\n\ndefine bot answer product\n  "\u8ba9\u6211\u6765\u4ecb\u7ecd\u4e00\u4e0b\u6211\u4eec\u7684\u4ea7\u54c1..."\n\n# \u5b9a\u4e49\u5bf9\u8bdd\u6d41\u7a0b\ndefine flow\n  user ask harmful\n  bot refuse harmful\n\ndefine flow\n  user ask about product\n  bot answer product\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u4f7f\u7528-nemo-guardrails",children:"\u4f7f\u7528 NeMo Guardrails"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'from nemoguardrails import RailsConfig, LLMRails\n\n# \u52a0\u8f7d\u914d\u7f6e\nconfig = RailsConfig.from_path("./config")\nrails = LLMRails(config)\n\n# \u751f\u6210\u56de\u590d\nresponse = await rails.generate_async(\n    messages=[{"role": "user", "content": "\u4ecb\u7ecd\u4e00\u4e0b\u4f60\u4eec\u7684\u4ea7\u54c1"}]\n)\n\nprint(response["content"])\n'})}),"\n",(0,s.jsx)(e.h2,{id:"guardrails-ai",children:"Guardrails AI"}),"\n",(0,s.jsx)(e.p,{children:"Guardrails AI \u662f\u53e6\u4e00\u4e2a\u6d41\u884c\u7684\u62a4\u680f\u6846\u67b6\uff0c\u4e13\u6ce8\u4e8e\u8f93\u51fa\u9a8c\u8bc1\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u5b89\u88c5-1",children:"\u5b89\u88c5"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"pip install guardrails-ai\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u7840\u4f7f\u7528",children:"\u57fa\u7840\u4f7f\u7528"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'from guardrails import Guard\nfrom guardrails.hub import ToxicLanguage, DetectPII\n\n# \u521b\u5efa\u62a4\u680f\nguard = Guard().use_many(\n    ToxicLanguage(on_fail="exception"),\n    DetectPII(pii_entities=["EMAIL_ADDRESS", "PHONE_NUMBER"], on_fail="fix")\n)\n\n# \u9a8c\u8bc1\u8f93\u51fa\ntry:\n    result = guard.validate("\u8fd9\u662f\u4e00\u6bb5\u6d4b\u8bd5\u6587\u672c\uff0c\u6211\u7684\u90ae\u7bb1\u662f test@example.com")\n    print(result.validated_output)\nexcept Exception as e:\n    print(f"\u9a8c\u8bc1\u5931\u8d25\uff1a{e}")\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u7ed3\u6784\u5316\u8f93\u51fa\u9a8c\u8bc1",children:"\u7ed3\u6784\u5316\u8f93\u51fa\u9a8c\u8bc1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'from guardrails import Guard\nfrom pydantic import BaseModel, Field\n\nclass ProductReview(BaseModel):\n    sentiment: str = Field(description="\u60c5\u611f\uff1apositive/negative/neutral")\n    score: int = Field(ge=1, le=5, description="\u8bc4\u5206 1-5")\n    summary: str = Field(max_length=200, description="\u6458\u8981")\n\nguard = Guard.from_pydantic(ProductReview)\n\nraw_output = """\n{\n    "sentiment": "positive",\n    "score": 4,\n    "summary": "\u8fd9\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u4ea7\u54c1\uff0c\u8d28\u91cf\u4e0d\u9519\uff0c\u63a8\u8350\u8d2d\u4e70\u3002"\n}\n"""\n\nresult = guard.validate(raw_output)\nprint(result.validated_output)\n'})}),"\n",(0,s.jsx)(e.h2,{id:"openai-moderation-api",children:"OpenAI Moderation API"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'from openai import OpenAI\n\nclient = OpenAI()\n\ndef moderate_content(text: str) -> dict:\n    """\u4f7f\u7528 OpenAI Moderation API"""\n    response = client.moderations.create(input=text)\n    result = response.results[0]\n    \n    return {\n        "flagged": result.flagged,\n        "categories": {\n            k: v for k, v in result.categories.model_dump().items() if v\n        },\n        "scores": {\n            k: round(v, 4) \n            for k, v in result.category_scores.model_dump().items() \n            if v > 0.1\n        }\n    }\n\n# \u4f7f\u7528\nresult = moderate_content("\u8fd9\u662f\u4e00\u6bb5\u6d4b\u8bd5\u6587\u672c")\nif result["flagged"]:\n    print(f"\u5185\u5bb9\u88ab\u6807\u8bb0\uff1a{result[\'categories\']}")\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u5b8c\u6574\u62a4\u680f\u7cfb\u7edf",children:"\u5b8c\u6574\u62a4\u680f\u7cfb\u7edf"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'from dataclasses import dataclass\nfrom enum import Enum\nfrom typing import Callable\n\nclass GuardrailAction(Enum):\n    ALLOW = "allow"\n    BLOCK = "block"\n    MODIFY = "modify"\n    WARN = "warn"\n\n@dataclass\nclass GuardrailResult:\n    action: GuardrailAction\n    message: str = ""\n    modified_content: str = ""\n\nclass GuardrailSystem:\n    """\u5b8c\u6574\u62a4\u680f\u7cfb\u7edf"""\n    \n    def __init__(self):\n        self.input_guards: list[Callable] = []\n        self.output_guards: list[Callable] = []\n        self.client = OpenAI()\n    \n    def add_input_guard(self, guard: Callable):\n        self.input_guards.append(guard)\n    \n    def add_output_guard(self, guard: Callable):\n        self.output_guards.append(guard)\n    \n    def check_input(self, text: str) -> GuardrailResult:\n        """\u68c0\u67e5\u8f93\u5165"""\n        for guard in self.input_guards:\n            result = guard(text)\n            if result.action == GuardrailAction.BLOCK:\n                return result\n        return GuardrailResult(action=GuardrailAction.ALLOW)\n    \n    def check_output(self, text: str) -> GuardrailResult:\n        """\u68c0\u67e5\u8f93\u51fa"""\n        for guard in self.output_guards:\n            result = guard(text)\n            if result.action == GuardrailAction.BLOCK:\n                return result\n            if result.action == GuardrailAction.MODIFY:\n                text = result.modified_content\n        return GuardrailResult(\n            action=GuardrailAction.ALLOW,\n            modified_content=text\n        )\n    \n    def chat(self, user_input: str, system_prompt: str = "") -> str:\n        """\u5e26\u62a4\u680f\u7684\u5bf9\u8bdd"""\n        # \u8f93\u5165\u68c0\u67e5\n        input_result = self.check_input(user_input)\n        if input_result.action == GuardrailAction.BLOCK:\n            return f"\u8f93\u5165\u88ab\u62d2\u7edd\uff1a{input_result.message}"\n        \n        # \u8c03\u7528 LLM\n        messages = []\n        if system_prompt:\n            messages.append({"role": "system", "content": system_prompt})\n        messages.append({"role": "user", "content": user_input})\n        \n        response = self.client.chat.completions.create(\n            model="gpt-4o",\n            messages=messages\n        )\n        \n        output = response.choices[0].message.content\n        \n        # \u8f93\u51fa\u68c0\u67e5\n        output_result = self.check_output(output)\n        if output_result.action == GuardrailAction.BLOCK:\n            return "\u62b1\u6b49\uff0c\u65e0\u6cd5\u751f\u6210\u5408\u9002\u7684\u56de\u590d\u3002"\n        \n        return output_result.modified_content or output\n\n# \u5b9a\u4e49\u62a4\u680f\u51fd\u6570\ndef injection_guard(text: str) -> GuardrailResult:\n    patterns = ["ignore previous", "disregard"]\n    for p in patterns:\n        if p in text.lower():\n            return GuardrailResult(\n                action=GuardrailAction.BLOCK,\n                message="\u68c0\u6d4b\u5230\u6ce8\u5165\u653b\u51fb"\n            )\n    return GuardrailResult(action=GuardrailAction.ALLOW)\n\ndef pii_guard(text: str) -> GuardrailResult:\n    # \u7b80\u5355\u7684 PII \u8131\u654f\n    import re\n    modified = re.sub(r\'\\d{11}\', \'[PHONE]\', text)\n    modified = re.sub(r\'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}\', \'[EMAIL]\', modified)\n    \n    if modified != text:\n        return GuardrailResult(\n            action=GuardrailAction.MODIFY,\n            modified_content=modified\n        )\n    return GuardrailResult(action=GuardrailAction.ALLOW)\n\n# \u4f7f\u7528\nsystem = GuardrailSystem()\nsystem.add_input_guard(injection_guard)\nsystem.add_output_guard(pii_guard)\n\nresponse = system.chat("\u4f60\u597d\uff0c\u8bf7\u4ecb\u7ecd\u4e00\u4e0b\u4ea7\u54c1")\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5206\u5c42\u9632\u62a4"}),"\uff1a\u8f93\u5165\u3001\u8f93\u51fa\u90fd\u8981\u68c0\u67e5"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5feb\u901f\u5931\u8d25"}),"\uff1a\u5371\u9669\u5185\u5bb9\u7acb\u5373\u62d2\u7edd"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u65e5\u5fd7\u8bb0\u5f55"}),"\uff1a\u8bb0\u5f55\u6240\u6709\u88ab\u62e6\u622a\u7684\u8bf7\u6c42"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5b9a\u671f\u66f4\u65b0"}),"\uff1a\u6839\u636e\u65b0\u7684\u653b\u51fb\u6a21\u5f0f\u66f4\u65b0\u89c4\u5219"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u7528\u6237\u53cd\u9988"}),"\uff1a\u63d0\u4f9b\u6e05\u6670\u7684\u62d2\u7edd\u539f\u56e0"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u5ef6\u4f38\u9605\u8bfb",children:"\u5ef6\u4f38\u9605\u8bfb"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/NVIDIA/NeMo-Guardrails",children:"NeMo Guardrails"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://www.guardrailsai.com/",children:"Guardrails AI"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://platform.openai.com/docs/guides/moderation",children:"OpenAI Moderation"})}),"\n"]})]})}function c(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(u,{...n})}):u(n)}},48885:(n,e,r)=>{r.d(e,{R:()=>l,x:()=>a});var t=r(99378);const s={},i=t.createContext(s);function l(n){const e=t.useContext(i);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:l(n.components),t.createElement(i.Provider,{value:e},n.children)}}}]);
"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[3155],{19019:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"rust/best-practices","title":"Rust \u6700\u4f73\u5b9e\u8df5","description":"\u672c\u6587\u6c47\u603b Rust \u7f16\u7a0b\u7684\u6700\u4f73\u5b9e\u8df5,\u6db5\u76d6\u4ee3\u7801\u98ce\u683c\u3001API\u8bbe\u8ba1\u3001\u6027\u80fd\u4f18\u5316\u3001\u5b89\u5168\u7f16\u7a0b\u7b49\u65b9\u9762\u3002","source":"@site/docs/rust/best-practices.md","sourceDirName":"rust","slug":"/rust/best-practices","permalink":"/docs/rust/best-practices","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/rust/best-practices.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_position":13,"title":"Rust \u6700\u4f73\u5b9e\u8df5"},"sidebar":"rust","previous":{"title":"\u5b8f\u7f16\u7a0b","permalink":"/docs/rust/macros"},"next":{"title":"\u4e0d\u5b89\u5168 Rust","permalink":"/docs/rust/unsafe-rust"}}');var r=s(22714),t=s(48885);const i={sidebar_position:13,title:"Rust \u6700\u4f73\u5b9e\u8df5"},a="Rust \u6700\u4f73\u5b9e\u8df5",d={},c=[{value:"\u4ee3\u7801\u98ce\u683c",id:"\u4ee3\u7801\u98ce\u683c",level:2},{value:"\u547d\u540d\u89c4\u8303",id:"\u547d\u540d\u89c4\u8303",level:3},{value:"\u4f7f\u7528 rustfmt",id:"\u4f7f\u7528-rustfmt",level:3},{value:"\u4f7f\u7528 clippy",id:"\u4f7f\u7528-clippy",level:3},{value:"\u9519\u8bef\u5904\u7406\u6700\u4f73\u5b9e\u8df5",id:"\u9519\u8bef\u5904\u7406\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u4f18\u5148\u4f7f\u7528 Result",id:"1-\u4f18\u5148\u4f7f\u7528-result",level:3},{value:"2. \u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b",id:"2-\u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b",level:3},{value:"3. \u4f7f\u7528 ? \u8fd0\u7b97\u7b26",id:"3-\u4f7f\u7528--\u8fd0\u7b97\u7b26",level:3},{value:"4. \u63d0\u4f9b\u4e0a\u4e0b\u6587",id:"4-\u63d0\u4f9b\u4e0a\u4e0b\u6587",level:3},{value:"API \u8bbe\u8ba1",id:"api-\u8bbe\u8ba1",level:2},{value:"1. \u4f7f\u7528\u6784\u5efa\u8005\u6a21\u5f0f",id:"1-\u4f7f\u7528\u6784\u5efa\u8005\u6a21\u5f0f",level:3},{value:"2. \u4f7f\u7528 Into \u548c From",id:"2-\u4f7f\u7528-into-\u548c-from",level:3},{value:"3. \u8fd4\u56de\u501f\u7528\u800c\u975e\u62e5\u6709",id:"3-\u8fd4\u56de\u501f\u7528\u800c\u975e\u62e5\u6709",level:3},{value:"4. \u4f7f\u7528 AsRef \u548c AsMut",id:"4-\u4f7f\u7528-asref-\u548c-asmut",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:2},{value:"1. \u907f\u514d\u4e0d\u5fc5\u8981\u7684\u514b\u9686",id:"1-\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u514b\u9686",level:3},{value:"2. \u4f7f\u7528 Cow \u907f\u514d\u514b\u9686",id:"2-\u4f7f\u7528-cow-\u907f\u514d\u514b\u9686",level:3},{value:"3. \u4f7f\u7528\u8fed\u4ee3\u5668\u94fe",id:"3-\u4f7f\u7528\u8fed\u4ee3\u5668\u94fe",level:3},{value:"4. \u9884\u5206\u914d\u5bb9\u91cf",id:"4-\u9884\u5206\u914d\u5bb9\u91cf",level:3},{value:"5. \u4f7f\u7528 String::push_str \u800c\u975e +",id:"5-\u4f7f\u7528-stringpush_str-\u800c\u975e-",level:3},{value:"\u6240\u6709\u6743\u548c\u501f\u7528",id:"\u6240\u6709\u6743\u548c\u501f\u7528",level:2},{value:"1. \u4f18\u5148\u4f7f\u7528\u5f15\u7528",id:"1-\u4f18\u5148\u4f7f\u7528\u5f15\u7528",level:3},{value:"2. \u8fd4\u56de\u5f15\u7528\u65f6\u4f7f\u7528\u751f\u547d\u5468\u671f",id:"2-\u8fd4\u56de\u5f15\u7528\u65f6\u4f7f\u7528\u751f\u547d\u5468\u671f",level:3},{value:"3. \u4f7f\u7528 &amp;str \u800c\u975e &amp;String",id:"3-\u4f7f\u7528-str-\u800c\u975e-string",level:3},{value:"\u5e76\u53d1\u7f16\u7a0b",id:"\u5e76\u53d1\u7f16\u7a0b",level:2},{value:"1. \u4f18\u5148\u4f7f\u7528\u6d88\u606f\u4f20\u9012",id:"1-\u4f18\u5148\u4f7f\u7528\u6d88\u606f\u4f20\u9012",level:3},{value:"2. <code>Arc&lt;Mutex&lt;T&gt;&gt;</code> \u7528\u4e8e\u5171\u4eab\u53ef\u53d8\u72b6\u6001",id:"2-arcmutext-\u7528\u4e8e\u5171\u4eab\u53ef\u53d8\u72b6\u6001",level:3},{value:"3. \u4f7f\u7528\u4f5c\u7528\u57df\u7ebf\u7a0b",id:"3-\u4f7f\u7528\u4f5c\u7528\u57df\u7ebf\u7a0b",level:3},{value:"\u7c7b\u578b\u8bbe\u8ba1",id:"\u7c7b\u578b\u8bbe\u8ba1",level:2},{value:"1. \u4f7f\u7528newtype\u6a21\u5f0f",id:"1-\u4f7f\u7528newtype\u6a21\u5f0f",level:3},{value:"2. \u4f7f\u7528\u7c7b\u578b\u72b6\u6001\u6a21\u5f0f",id:"2-\u4f7f\u7528\u7c7b\u578b\u72b6\u6001\u6a21\u5f0f",level:3},{value:"3. \u4f7f\u7528\u679a\u4e3e\u800c\u975e\u591a\u4e2a\u5e03\u5c14\u503c",id:"3-\u4f7f\u7528\u679a\u4e3e\u800c\u975e\u591a\u4e2a\u5e03\u5c14\u503c",level:3},{value:"\u6587\u6863\u7f16\u5199",id:"\u6587\u6863\u7f16\u5199",level:2},{value:"1. \u6a21\u5757\u7ea7\u6587\u6863",id:"1-\u6a21\u5757\u7ea7\u6587\u6863",level:3},{value:"2. \u51fd\u6570\u6587\u6863",id:"2-\u51fd\u6570\u6587\u6863",level:3},{value:"3. \u4f7f\u7528 intra-doc links",id:"3-\u4f7f\u7528-intra-doc-links",level:3},{value:"\u9879\u76ee\u7ed3\u6784",id:"\u9879\u76ee\u7ed3\u6784",level:2},{value:"\u5178\u578b\u9879\u76ee\u5e03\u5c40",id:"\u5178\u578b\u9879\u76ee\u5e03\u5c40",level:3},{value:"\u4f9d\u8d56\u7ba1\u7406",id:"\u4f9d\u8d56\u7ba1\u7406",level:2},{value:"1. \u6307\u5b9a\u7248\u672c",id:"1-\u6307\u5b9a\u7248\u672c",level:3},{value:"2. \u4f7f\u7528 features",id:"2-\u4f7f\u7528-features",level:3},{value:"3. \u5f00\u53d1\u4f9d\u8d56\u5206\u79bb",id:"3-\u5f00\u53d1\u4f9d\u8d56\u5206\u79bb",level:3},{value:"\u6d4b\u8bd5\u7b56\u7565",id:"\u6d4b\u8bd5\u7b56\u7565",level:2},{value:"1. \u6d4b\u8bd5\u91d1\u5b57\u5854",id:"1-\u6d4b\u8bd5\u91d1\u5b57\u5854",level:3},{value:"2. \u8868\u683c\u9a71\u52a8\u6d4b\u8bd5",id:"2-\u8868\u683c\u9a71\u52a8\u6d4b\u8bd5",level:3},{value:"\u5b89\u5168\u7f16\u7a0b",id:"\u5b89\u5168\u7f16\u7a0b",level:2},{value:"1. \u907f\u514d unwrap",id:"1-\u907f\u514d-unwrap",level:3},{value:"2. \u4f7f\u7528 expect \u63d0\u4f9b\u4e0a\u4e0b\u6587",id:"2-\u4f7f\u7528-expect-\u63d0\u4f9b\u4e0a\u4e0b\u6587",level:3},{value:"3. \u9a8c\u8bc1\u8f93\u5165",id:"3-\u9a8c\u8bc1\u8f93\u5165",level:3},{value:"\u5e38\u89c1\u53cd\u6a21\u5f0f",id:"\u5e38\u89c1\u53cd\u6a21\u5f0f",level:2},{value:"1. \u8fc7\u5ea6\u4f7f\u7528 clone",id:"1-\u8fc7\u5ea6\u4f7f\u7528-clone",level:3},{value:"2. \u5b57\u7b26\u4e32\u62fc\u63a5",id:"2-\u5b57\u7b26\u4e32\u62fc\u63a5",level:3},{value:"3. \u5ffd\u7565\u9519\u8bef",id:"3-\u5ffd\u7565\u9519\u8bef",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function o(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"rust-\u6700\u4f73\u5b9e\u8df5",children:"Rust \u6700\u4f73\u5b9e\u8df5"})}),"\n",(0,r.jsx)(e.p,{children:"\u672c\u6587\u6c47\u603b Rust \u7f16\u7a0b\u7684\u6700\u4f73\u5b9e\u8df5,\u6db5\u76d6\u4ee3\u7801\u98ce\u683c\u3001API\u8bbe\u8ba1\u3001\u6027\u80fd\u4f18\u5316\u3001\u5b89\u5168\u7f16\u7a0b\u7b49\u65b9\u9762\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u4ee3\u7801\u98ce\u683c",children:"\u4ee3\u7801\u98ce\u683c"}),"\n",(0,r.jsx)(e.h3,{id:"\u547d\u540d\u89c4\u8303",children:"\u547d\u540d\u89c4\u8303"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"// \u53d8\u91cf\u548c\u51fd\u6570\u540d:snake_case\nlet my_variable = 5;\nfn calculate_sum() {}\n\n// \u7c7b\u578b\u548c Trait:PascalCase  \nstruct MyStruct {}\ntrait MyTrait {}\nenum MyEnum {}\n\n// \u5e38\u91cf:SCREAMING_SNAKE_CASE\nconst MAX_POINTS: u32 = 100;\nstatic GLOBAL_VALUE: i32 = 42;\n\n// \u751f\u547d\u5468\u671f:\u5c0f\u5199\u5355\u5b57\u6bcd\nfn example<'a>(x: &'a str) {}\n\n// \u6cdb\u578b:\u5355\u4e2a\u5927\u5199\u5b57\u6bcd\u6216\u63cf\u8ff0\u6027\u540d\u79f0\nfn generic<T>(value: T) {}\nfn generic<TKey, TValue>(key: TKey, value: TValue) {}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u4f7f\u7528-rustfmt",children:"\u4f7f\u7528 rustfmt"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u683c\u5f0f\u5316\u4ee3\u7801\ncargo fmt\n\n# \u68c0\u67e5\u683c\u5f0f\ncargo fmt -- --check\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-toml",children:'# rustfmt.toml\nmax_width = 100\ntab_spaces = 4\nedition = "2021"\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u4f7f\u7528-clippy",children:"\u4f7f\u7528 clippy"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u8fd0\u884c clippy\ncargo clippy\n\n# \u4e25\u683c\u6a21\u5f0f\ncargo clippy -- -D warnings\n\n# \u4fee\u590d\u5efa\u8bae\ncargo clippy --fix\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"// \u5728\u6587\u4ef6\u7ea7\u522b\u5141\u8bb8\u7279\u5b9a lint\n#![allow(clippy::needless_return)]\n\n// \u5728\u9879\u76ee\u7ea7\u522b\u7981\u6b62\u7279\u5b9a lint\n#![deny(clippy::unwrap_used)]\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u9519\u8bef\u5904\u7406\u6700\u4f73\u5b9e\u8df5",children:"\u9519\u8bef\u5904\u7406\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u4f18\u5148\u4f7f\u7528-result",children:"1. \u4f18\u5148\u4f7f\u7528 Result"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'// \u597d:\u4f7f\u7528 Result\nfn divide(a: f64, b: f64) -> Result<f64, String> {\n    if b == 0.0 {\n        Err("division by zero".to_string())\n    } else {\n        Ok(a / b)\n    }\n}\n\n// \u907f\u514d:\u4f7f\u7528 Option \u4e22\u5931\u9519\u8bef\u4fe1\u606f\nfn divide_bad(a: f64, b: f64) -> Option<f64> {\n    if b == 0.0 {\n        None\n    } else {\n        Some(a / b)\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b",children:"2. \u81ea\u5b9a\u4e49\u9519\u8bef\u7c7b\u578b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'use std::fmt;\n\n#[derive(Debug)]\npub enum AppError {\n    Io(std::io::Error),\n    Parse(std::num::ParseIntError),\n    Custom(String),\n}\n\nimpl fmt::Display for AppError {\n    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n        match self {\n            AppError::Io(e) => write!(f, "IO\u9519\u8bef: {}", e),\n            AppError::Parse(e) => write!(f, "\u89e3\u6790\u9519\u8bef: {}", e),\n            AppError::Custom(msg) => write!(f, "{}", msg),\n        }\n    }\n}\n\nimpl std::error::Error for AppError {}\n\nimpl From<std::io::Error> for AppError {\n    fn from(error: std::io::Error) -> Self {\n        AppError::Io(error)\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u4f7f\u7528--\u8fd0\u7b97\u7b26",children:"3. \u4f7f\u7528 ? \u8fd0\u7b97\u7b26"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'fn read_config() -> Result<String, std::io::Error> {\n    let content = std::fs::read_to_string("config.toml")?;\n    Ok(content)\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"4-\u63d0\u4f9b\u4e0a\u4e0b\u6587",children:"4. \u63d0\u4f9b\u4e0a\u4e0b\u6587"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'use std::fs::File;\nuse std::io::Read;\n\nfn read_username_from_file() -> Result<String, String> {\n    let mut file = File::open("username.txt")\n        .map_err(|e| format!("\u65e0\u6cd5\u6253\u5f00\u6587\u4ef6: {}", e))?;\n    \n    let mut username = String::new();\n    file.read_to_string(&mut username)\n        .map_err(|e| format!("\u65e0\u6cd5\u8bfb\u53d6\u6587\u4ef6: {}", e))?;\n    \n    Ok(username)\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"api-\u8bbe\u8ba1",children:"API \u8bbe\u8ba1"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u4f7f\u7528\u6784\u5efa\u8005\u6a21\u5f0f",children:"1. \u4f7f\u7528\u6784\u5efa\u8005\u6a21\u5f0f"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'pub struct Config {\n    host: String,\n    port: u16,\n    timeout: u64,\n}\n\npub struct ConfigBuilder {\n    host: Option<String>,\n    port: Option<u16>,\n    timeout: Option<u64>,\n}\n\nimpl ConfigBuilder {\n    pub fn new() -> Self {\n        ConfigBuilder {\n            host: None,\n            port: None,\n            timeout: None,\n        }\n    }\n    \n    pub fn host(mut self, host: String) -> Self {\n        self.host = Some(host);\n        self\n    }\n    \n    pub fn port(mut self, port: u16) -> Self {\n        self.port = Some(port);\n        self\n    }\n    \n    pub fn timeout(mut self, timeout: u64) -> Self {\n        self.timeout = Some(timeout);\n        self\n    }\n    \n    pub fn build(self) -> Config {\n        Config {\n            host: self.host.unwrap_or_else(|| "localhost".to_string()),\n            port: self.port.unwrap_or(8080),\n            timeout: self.timeout.unwrap_or(30),\n        }\n    }\n}\n\n// \u4f7f\u7528\nlet config = ConfigBuilder::new()\n    .host("example.com".to_string())\n    .port(3000)\n    .build();\n'})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u4f7f\u7528-into-\u548c-from",children:"2. \u4f7f\u7528 Into \u548c From"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'pub struct User {\n    name: String,\n}\n\nimpl User {\n    // \u597d:\u63a5\u53d7 impl Into<String>\n    pub fn new(name: impl Into<String>) -> Self {\n        User {\n            name: name.into(),\n        }\n    }\n}\n\nfn main() {\n    let user1 = User::new("Alice".to_string());\n    let user2 = User::new("Bob");  // &str \u81ea\u52a8\u8f6c\u6362\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u8fd4\u56de\u501f\u7528\u800c\u975e\u62e5\u6709",children:"3. \u8fd4\u56de\u501f\u7528\u800c\u975e\u62e5\u6709"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"pub struct Container {\n    data: Vec<i32>,\n}\n\nimpl Container {\n    // \u597d:\u8fd4\u56de\u4e0d\u53ef\u53d8\u5f15\u7528\n    pub fn data(&self) -> &[i32] {\n        &self.data\n    }\n    \n    // \u907f\u514d:\u4e0d\u5fc5\u8981\u7684\u514b\u9686\n    // pub fn data(&self) -> Vec<i32> {\n    //     self.data.clone()\n    // }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"4-\u4f7f\u7528-asref-\u548c-asmut",children:"4. \u4f7f\u7528 AsRef \u548c AsMut"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'use std::path::Path;\n\nfn open_file(path: impl AsRef<Path>) -> std::io::Result<()> {\n    let _file = std::fs::File::open(path.as_ref())?;\n    Ok(())\n}\n\nfn main() {\n    open_file("file.txt");  // &str\n    open_file(String::from("file.txt"));  // String\n    open_file(std::path::PathBuf::from("file.txt"));  // PathBuf\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u514b\u9686",children:"1. \u907f\u514d\u4e0d\u5fc5\u8981\u7684\u514b\u9686"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"// \u4e0d\u597d:\u4e0d\u5fc5\u8981\u7684\u514b\u9686\nfn process_bad(data: Vec<i32>) -> Vec<i32> {\n    let copied = data.clone();\n    copied\n}\n\n// \u597d:\u76f4\u63a5\u4f7f\u7528\u5f15\u7528\nfn process_good(data: &[i32]) -> Vec<i32> {\n    data.to_vec()\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u4f7f\u7528-cow-\u907f\u514d\u514b\u9686",children:"2. \u4f7f\u7528 Cow \u907f\u514d\u514b\u9686"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'use std::borrow::Cow;\n\nfn process<\'a>(input: &\'a str) -> Cow<\'a, str> {\n    if input.contains("bad") {\n        // \u9700\u8981\u4fee\u6539:\u8fd4\u56de\u62e5\u6709\u7684\u5b57\u7b26\u4e32\n        Cow::Owned(input.replace("bad", "good"))\n    } else {\n        // \u4e0d\u9700\u8981\u4fee\u6539:\u8fd4\u56de\u501f\u7528\n        Cow::Borrowed(input)\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u4f7f\u7528\u8fed\u4ee3\u5668\u94fe",children:"3. \u4f7f\u7528\u8fed\u4ee3\u5668\u94fe"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"// \u597d:\u60f0\u6027\u6c42\u503c,\u96f6\u5206\u914d\nlet result: Vec<_> = vec![1, 2, 3, 4, 5]\n    .iter()\n    .filter(|&&x| x % 2 == 0)\n    .map(|&x| x * 2)\n    .collect();\n\n// \u907f\u514d:\u591a\u6b21\u5206\u914d\nlet mut temp = vec![];\nfor &x in &vec![1, 2, 3, 4, 5] {\n    if x % 2 == 0 {\n        temp.push(x);\n    }\n}\nlet result: Vec<_> = temp.iter().map(|&x| x * 2).collect();\n"})}),"\n",(0,r.jsx)(e.h3,{id:"4-\u9884\u5206\u914d\u5bb9\u91cf",children:"4. \u9884\u5206\u914d\u5bb9\u91cf"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"// \u597d:\u9884\u5206\u914d\nlet mut vec = Vec::with_capacity(1000);\nfor i in 0..1000 {\n    vec.push(i);\n}\n\n// \u907f\u514d:\u591a\u6b21\u91cd\u65b0\u5206\u914d\nlet mut vec = Vec::new();\nfor i in 0..1000 {\n    vec.push(i);\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"5-\u4f7f\u7528-stringpush_str-\u800c\u975e-",children:"5. \u4f7f\u7528 String::push_str \u800c\u975e +"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'// \u597d:\u539f\u5730\u4fee\u6539\nlet mut s = String::from("Hello");\ns.push_str(", ");\ns.push_str("world");\n\n// \u907f\u514d:\u591a\u6b21\u5206\u914d\nlet s = String::from("Hello") + ", " + "world";\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u6240\u6709\u6743\u548c\u501f\u7528",children:"\u6240\u6709\u6743\u548c\u501f\u7528"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u4f18\u5148\u4f7f\u7528\u5f15\u7528",children:"1. \u4f18\u5148\u4f7f\u7528\u5f15\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"// \u597d:\u4f7f\u7528\u5f15\u7528\nfn calculate_length(s: &String) -> usize {\n    s.len()\n}\n\n// \u907f\u514d:\u4e0d\u5fc5\u8981\u7684\u6240\u6709\u6743\u8f6c\u79fb\nfn calculate_length_bad(s: String) -> (String, usize) {\n    let length = s.len();\n    (s, length)\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u8fd4\u56de\u5f15\u7528\u65f6\u4f7f\u7528\u751f\u547d\u5468\u671f",children:"2. \u8fd4\u56de\u5f15\u7528\u65f6\u4f7f\u7528\u751f\u547d\u5468\u671f"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {\n    if x.len() > y.len() {\n        x\n    } else {\n        y\n    }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u4f7f\u7528-str-\u800c\u975e-string",children:"3. \u4f7f\u7528 &str \u800c\u975e &String"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'// \u597d:\u66f4\u7075\u6d3b\nfn print_string(s: &str) {\n    println!("{}", s);\n}\n\n// \u907f\u514d:\u9650\u5236\u6027\u592a\u5f3a\nfn print_string_bad(s: &String) {\n    println!("{}", s);\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u5e76\u53d1\u7f16\u7a0b",children:"\u5e76\u53d1\u7f16\u7a0b"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u4f18\u5148\u4f7f\u7528\u6d88\u606f\u4f20\u9012",children:"1. \u4f18\u5148\u4f7f\u7528\u6d88\u606f\u4f20\u9012"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'use std::sync::mpsc;\nuse std::thread;\n\n// \u597d:\u4f7f\u7528\u901a\u9053\nfn good_concurrency() {\n    let (tx, rx) = mpsc::channel();\n    \n    thread::spawn(move || {\n        tx.send("Hello").unwrap();\n    });\n    \n    println!("{}", rx.recv().unwrap());\n}\n'})}),"\n",(0,r.jsxs)(e.h3,{id:"2-arcmutext-\u7528\u4e8e\u5171\u4eab\u53ef\u53d8\u72b6\u6001",children:["2. ",(0,r.jsx)(e.code,{children:"Arc<Mutex<T>>"})," \u7528\u4e8e\u5171\u4eab\u53ef\u53d8\u72b6\u6001"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"use std::sync::{Arc, Mutex};\nuse std::thread;\n\nfn shared_state() {\n    let data = Arc::new(Mutex::new(vec![]));\n    \n    let data_clone = Arc::clone(&data);\n    thread::spawn(move || {\n        data_clone.lock().unwrap().push(1);\n    });\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u4f7f\u7528\u4f5c\u7528\u57df\u7ebf\u7a0b",children:"3. \u4f7f\u7528\u4f5c\u7528\u57df\u7ebf\u7a0b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'use std::thread;\n\nfn scoped_threads() {\n    let mut data = vec![1, 2, 3];\n    \n    thread::scope(|s| {\n        s.spawn(|| {\n            data.push(4);\n        });\n    });\n    \n    println!("{:?}", data);\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u7c7b\u578b\u8bbe\u8ba1",children:"\u7c7b\u578b\u8bbe\u8ba1"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u4f7f\u7528newtype\u6a21\u5f0f",children:"1. \u4f7f\u7528newtype\u6a21\u5f0f"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"// \u597d:\u7c7b\u578b\u5b89\u5168\nstruct UserId(u64);\nstruct ProductId(u64);\n\nfn get_user(id: UserId) {}\n\n// \u907f\u514d:\u5bb9\u6613\u6df7\u6dc6\nfn get_user_bad(id: u64) {}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u4f7f\u7528\u7c7b\u578b\u72b6\u6001\u6a21\u5f0f",children:"2. \u4f7f\u7528\u7c7b\u578b\u72b6\u6001\u6a21\u5f0f"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"struct Opened;\nstruct Closed;\n\nstruct Door<State> {\n    _state: std::marker::PhantomData<State>,\n}\n\nimpl Door<Closed> {\n    fn new() -> Self {\n        Door { _state: std::marker::PhantomData }\n    }\n    \n    fn open(self) -> Door<Opened> {\n        Door { _state: std::marker::PhantomData }\n    }\n}\n\nimpl Door<Opened> {\n    fn close(self) -> Door<Closed> {\n        Door { _state: std::marker::PhantomData }\n    }\n}\n\nfn main() {\n    let door = Door::<Closed>::new();\n    let door = door.open();\n    // let door = door.open();  // \u7f16\u8bd1\u9519\u8bef:\u5df2\u7ecf\u6253\u5f00\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u4f7f\u7528\u679a\u4e3e\u800c\u975e\u591a\u4e2a\u5e03\u5c14\u503c",children:"3. \u4f7f\u7528\u679a\u4e3e\u800c\u975e\u591a\u4e2a\u5e03\u5c14\u503c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"// \u597d:\u6e05\u6670\u7684\u72b6\u6001\nenum ConnectionState {\n    Connected,\n    Disconnected,\n    Reconnecting,\n}\n\n// \u907f\u514d:\u96be\u4ee5\u7ef4\u62a4\nstruct Connection {\n    is_connected: bool,\n    is_reconnecting: bool,\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u6587\u6863\u7f16\u5199",children:"\u6587\u6863\u7f16\u5199"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u6a21\u5757\u7ea7\u6587\u6863",children:"1. \u6a21\u5757\u7ea7\u6587\u6863"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"//! # My Crate\n//!\n//! `my_crate` \u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u5de5\u5177\u51fd\u6570\n//!\n//! ## \u793a\u4f8b\n//!\n//! ```\n//! use my_crate::add;\n//! assert_eq!(add(2, 2), 4);\n//! ```\n"})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u51fd\u6570\u6587\u6863",children:"2. \u51fd\u6570\u6587\u6863"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"/// \u8ba1\u7b97\u4e24\u4e2a\u6570\u7684\u548c\n///\n/// # Arguments\n///\n/// * `a` - \u7b2c\u4e00\u4e2a\u52a0\u6570\n/// * `b` - \u7b2c\u4e8c\u4e2a\u52a0\u6570\n///\n/// # Examples\n///\n/// ```\n/// use my_crate::add;\n/// let result = add(2, 2);\n/// assert_eq!(result, 4);\n/// ```\n///\n/// # Panics\n///\n/// \u5f53\u7ed3\u679c\u6ea2\u51fa\u65f6 panic\n///\n/// # Errors\n///\n/// \u6b64\u51fd\u6570\u4e0d\u8fd4\u56de\u9519\u8bef\npub fn add(a: i32, b: i32) -> i32 {\n    a + b\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u4f7f\u7528-intra-doc-links",children:"3. \u4f7f\u7528 intra-doc links"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"/// \u53c2\u89c1 [`add`] \u51fd\u6570\u4e86\u89e3\u66f4\u591a\n///\n/// \u8fd8\u53ef\u4ee5\u94fe\u63a5\u5230 [`std::vec::Vec`]\npub fn multiply(a: i32, b: i32) -> i32 {\n    a * b\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u9879\u76ee\u7ed3\u6784",children:"\u9879\u76ee\u7ed3\u6784"}),"\n",(0,r.jsx)(e.h3,{id:"\u5178\u578b\u9879\u76ee\u5e03\u5c40",children:"\u5178\u578b\u9879\u76ee\u5e03\u5c40"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"my_project/\n\u251c\u2500\u2500 Cargo.toml\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 .gitignore\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 lib.rs          # \u5e93\u5165\u53e3\n\u2502   \u251c\u2500\u2500 main.rs         # \u4e8c\u8fdb\u5236\u5165\u53e3\n\u2502   \u251c\u2500\u2500 config/         # \u914d\u7f6e\u6a21\u5757\n\u2502   \u2502   \u2514\u2500\u2500 mod.rs\n\u2502   \u251c\u2500\u2500 models/         # \u6570\u636e\u6a21\u578b\n\u2502   \u2502   \u2514\u2500\u2500 mod.rs\n\u2502   \u2514\u2500\u2500 utils/          # \u5de5\u5177\u51fd\u6570\n\u2502       \u2514\u2500\u2500 mod.rs\n\u251c\u2500\u2500 tests/              # \u96c6\u6210\u6d4b\u8bd5\n\u2502   \u2514\u2500\u2500 integration_test.rs\n\u251c\u2500\u2500 benches/            # \u57fa\u51c6\u6d4b\u8bd5\n\u2502   \u2514\u2500\u2500 benchmark.rs\n\u2514\u2500\u2500 examples/           # \u793a\u4f8b\u4ee3\u7801\n    \u2514\u2500\u2500 example.rs\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u4f9d\u8d56\u7ba1\u7406",children:"\u4f9d\u8d56\u7ba1\u7406"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u6307\u5b9a\u7248\u672c",children:"1. \u6307\u5b9a\u7248\u672c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-toml",children:'[dependencies]\n# \u597d:\u6307\u5b9a\u5177\u4f53\u7248\u672c\nserde = "1.0.152"\n\n# \u907f\u514d:\u4f7f\u7528\u901a\u914d\u7b26\n# serde = "*"\n'})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u4f7f\u7528-features",children:"2. \u4f7f\u7528 features"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-toml",children:'[dependencies]\ntokio = { version = "1.0", features = ["macros", "rt-multi-thread"] }\n\n[features]\ndefault = ["std"]\nstd = []\nno_std = []\n'})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u5f00\u53d1\u4f9d\u8d56\u5206\u79bb",children:"3. \u5f00\u53d1\u4f9d\u8d56\u5206\u79bb"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-toml",children:'[dependencies]\nserde = "1.0"\n\n[dev-dependencies]\ncriterion = "0.5"\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u6d4b\u8bd5\u7b56\u7565",children:"\u6d4b\u8bd5\u7b56\u7565"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u6d4b\u8bd5\u91d1\u5b57\u5854",children:"1. \u6d4b\u8bd5\u91d1\u5b57\u5854"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"// \u5355\u5143\u6d4b\u8bd5:\u6700\u591a\n#[cfg(test)]\nmod unit_tests {\n    #[test]\n    fn test_add() {\n        assert_eq!(2 + 2, 4);\n    }\n}\n\n// \u96c6\u6210\u6d4b\u8bd5:\u4e2d\u7b49\n// tests/integration_test.rs\n\n// \u7aef\u5230\u7aef\u6d4b\u8bd5:\u6700\u5c11\n"})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u8868\u683c\u9a71\u52a8\u6d4b\u8bd5",children:"2. \u8868\u683c\u9a71\u52a8\u6d4b\u8bd5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"#[cfg(test)]\nmod tests {\n    use super::*;\n    \n    #[test]\n    fn test_cases() {\n        let test_cases = vec![\n            (1, 2, 3),\n            (0, 0, 0),\n            (-1, 1, 0),\n        ];\n        \n        for (a, b, expected) in test_cases {\n            assert_eq!(add(a, b), expected);\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u5b89\u5168\u7f16\u7a0b",children:"\u5b89\u5168\u7f16\u7a0b"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u907f\u514d-unwrap",children:"1. \u907f\u514d unwrap"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'// \u597d:\u5904\u7406\u9519\u8bef\nmatch std::fs::read_to_string("file.txt") {\n    Ok(content) => println!("{}", content),\n    Err(e) => eprintln!("\u9519\u8bef: {}", e),\n}\n\n// \u907f\u514d:\u4f7f\u7528 unwrap\n// let content = std::fs::read_to_string("file.txt").unwrap();\n'})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u4f7f\u7528-expect-\u63d0\u4f9b\u4e0a\u4e0b\u6587",children:"2. \u4f7f\u7528 expect \u63d0\u4f9b\u4e0a\u4e0b\u6587"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'// \u597d:\u63d0\u4f9b\u9519\u8bef\u4e0a\u4e0b\u6587\nlet file = std::fs::File::open("config.toml")\n    .expect("\u65e0\u6cd5\u6253\u5f00\u914d\u7f6e\u6587\u4ef6");\n\n// \u907f\u514d:\u4e0d\u63d0\u4f9b\u4e0a\u4e0b\u6587\n// let file = std::fs::File::open("config.toml").unwrap();\n'})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u9a8c\u8bc1\u8f93\u5165",children:"3. \u9a8c\u8bc1\u8f93\u5165"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'pub struct Age(u8);\n\nimpl Age {\n    pub fn new(value: u8) -> Result<Self, String> {\n        if value > 150 {\n            Err("\u5e74\u9f84\u4e0d\u80fd\u8d85\u8fc7150".to_string())\n        } else {\n            Ok(Age(value))\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u5e38\u89c1\u53cd\u6a21\u5f0f",children:"\u5e38\u89c1\u53cd\u6a21\u5f0f"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u8fc7\u5ea6\u4f7f\u7528-clone",children:"1. \u8fc7\u5ea6\u4f7f\u7528 clone"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:"// \u53cd\u6a21\u5f0f\nfn bad(s: String) -> String {\n    let s2 = s.clone();\n    s2\n}\n\n// \u597d\nfn good(s: String) -> String {\n    s\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u5b57\u7b26\u4e32\u62fc\u63a5",children:"2. \u5b57\u7b26\u4e32\u62fc\u63a5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'// \u53cd\u6a21\u5f0f:\u591a\u6b21\u5206\u914d\nlet s = "Hello".to_string() + " " + "World";\n\n// \u597d:\u4f7f\u7528 format! \u6216 push_str\nlet s = format!("{} {}", "Hello", "World");\n'})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u5ffd\u7565\u9519\u8bef",children:"3. \u5ffd\u7565\u9519\u8bef"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",children:'// \u53cd\u6a21\u5f0f\nlet _ = std::fs::remove_file("file.txt");\n\n// \u597d\nif let Err(e) = std::fs::remove_file("file.txt") {\n    eprintln!("\u5220\u9664\u6587\u4ef6\u5931\u8d25: {}", e);\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,r.jsx)(e.p,{children:"Rust \u6700\u4f73\u5b9e\u8df5\u8981\u70b9:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u2705 \u9075\u5faa\u547d\u540d\u89c4\u8303\u548c\u4ee3\u7801\u98ce\u683c"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 \u4f7f\u7528 Result \u5904\u7406\u9519\u8bef"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 \u8bbe\u8ba1\u6e05\u6670\u7684 API"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 \u4f18\u5316\u6027\u80fd:\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u514b\u9686"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 \u4f18\u5148\u4f7f\u7528\u5f15\u7528\u548c\u501f\u7528"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 \u6d88\u606f\u4f20\u9012\u4f18\u4e8e\u5171\u4eab\u72b6\u6001"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 \u7f16\u5199\u5b8c\u5584\u7684\u6587\u6863"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 \u5408\u7406\u7ec4\u7ec7\u9879\u76ee\u7ed3\u6784"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 \u907f\u514d unwrap,\u5904\u7406\u6240\u6709\u9519\u8bef"}),"\n",(0,r.jsx)(e.li,{children:"\u2705 \u8bc6\u522b\u548c\u907f\u514d\u5e38\u89c1\u53cd\u6a21\u5f0f"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u6301\u7eed\u5b66\u4e60\u548c\u5b9e\u8df5\u8fd9\u4e9b\u6700\u4f73\u5b9e\u8df5,\u5c06\u5e2e\u52a9\u4f60\u7f16\u5199\u66f4\u5b89\u5168\u3001\u9ad8\u6548\u548c\u53ef\u7ef4\u62a4\u7684 Rust \u4ee3\u7801!"})]})}function u(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(o,{...n})}):o(n)}},48885:(n,e,s)=>{s.d(e,{R:()=>i,x:()=>a});var l=s(99378);const r={},t=l.createContext(r);function i(n){const e=l.useContext(t);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:i(n.components),l.createElement(t.Provider,{value:e},n.children)}}}]);
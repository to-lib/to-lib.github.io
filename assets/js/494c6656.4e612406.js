"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[6520],{48885:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>d});var s=r(99378);const i={},l=s.createContext(i);function c(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(l.Provider,{value:n},e.children)}},94414:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"docker/registry","title":"\u955c\u50cf\u4ed3\u5e93\u4e0e\u53d1\u5e03","description":"Docker \u955c\u50cf\u547d\u540d\u3001tag \u7b56\u7565\u3001\u63a8\u9001/\u62c9\u53d6\u4e0e\u79c1\u6709\u4ed3\u5e93\u642d\u5efa","source":"@site/docs/docker/registry.md","sourceDirName":"docker","slug":"/docker/registry","permalink":"/docs/docker/registry","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/docker/registry.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"\u955c\u50cf\u4ed3\u5e93\u4e0e\u53d1\u5e03","description":"Docker \u955c\u50cf\u547d\u540d\u3001tag \u7b56\u7565\u3001\u63a8\u9001/\u62c9\u53d6\u4e0e\u79c1\u6709\u4ed3\u5e93\u642d\u5efa"},"sidebar":"docker","previous":{"title":"\u7f51\u7edc\u914d\u7f6e","permalink":"/docs/docker/networking"},"next":{"title":"BuildKit \u4e0e buildx","permalink":"/docs/docker/buildkit"}}');var i=r(22714),l=r(48885);const c={sidebar_position:6,title:"\u955c\u50cf\u4ed3\u5e93\u4e0e\u53d1\u5e03",description:"Docker \u955c\u50cf\u547d\u540d\u3001tag \u7b56\u7565\u3001\u63a8\u9001/\u62c9\u53d6\u4e0e\u79c1\u6709\u4ed3\u5e93\u642d\u5efa"},d="\u955c\u50cf\u4ed3\u5e93\u4e0e\u53d1\u5e03",t={},a=[{value:"\u955c\u50cf\u547d\u540d\u4e0e Tag",id:"\u955c\u50cf\u547d\u540d\u4e0e-tag",level:2},{value:"\u767b\u5f55\u3001\u6253\u6807\u7b7e\u3001\u63a8\u9001",id:"\u767b\u5f55\u6253\u6807\u7b7e\u63a8\u9001",level:2},{value:"\u9009\u62e9\u4ed3\u5e93\uff1aDocker Hub / GHCR / Harbor",id:"\u9009\u62e9\u4ed3\u5e93docker-hub--ghcr--harbor",level:2},{value:"\u81ea\u5efa registry:2\uff08\u6700\u7b80\u79c1\u6709\u4ed3\u5e93\uff09",id:"\u81ea\u5efa-registry2\u6700\u7b80\u79c1\u6709\u4ed3\u5e93",level:2},{value:"\u5feb\u901f\u542f\u52a8",id:"\u5feb\u901f\u542f\u52a8",level:3},{value:"\u914d\u7f6e\u4e3a\u4e0d\u5b89\u5168\u4ed3\u5e93\uff08\u4ec5\u6d4b\u8bd5\u73af\u5883\uff09",id:"\u914d\u7f6e\u4e3a\u4e0d\u5b89\u5168\u4ed3\u5e93\u4ec5\u6d4b\u8bd5\u73af\u5883",level:3},{value:"TLS\uff08\u751f\u4ea7\u5efa\u8bae\uff09",id:"tls\u751f\u4ea7\u5efa\u8bae",level:2},{value:"\u57fa\u7840\u8ba4\u8bc1\uff08htpasswd\uff09",id:"\u57fa\u7840\u8ba4\u8bc1htpasswd",level:2},{value:"\u955c\u50cf\u6e05\u7406\u4e0e\u7a7a\u95f4\u6cbb\u7406",id:"\u955c\u50cf\u6e05\u7406\u4e0e\u7a7a\u95f4\u6cbb\u7406",level:2},{value:"\u4e0e CI/CD \u96c6\u6210\uff08\u6700\u5c0f\u793a\u4f8b\uff09",id:"\u4e0e-cicd-\u96c6\u6210\u6700\u5c0f\u793a\u4f8b",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u955c\u50cf\u4ed3\u5e93\u4e0e\u53d1\u5e03",children:"\u955c\u50cf\u4ed3\u5e93\u4e0e\u53d1\u5e03"})}),"\n",(0,i.jsx)(n.h2,{id:"\u955c\u50cf\u547d\u540d\u4e0e-tag",children:"\u955c\u50cf\u547d\u540d\u4e0e Tag"}),"\n",(0,i.jsx)(n.p,{children:"\u955c\u50cf\u5b8c\u6574\u540d\u79f0\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"[registry-host[:port]/][namespace/]repo[:tag]\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"nginx:1.25-alpine"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"ghcr.io/org/app:1.2.3"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"registry.example.com/team/app:2025-12-20"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u5efa\u8bae\u7684 tag \u7b56\u7565\uff08\u4ece\u53ef\u56de\u6eda\u4e0e\u53ef\u8ffd\u6eaf\u89d2\u5ea6\uff09\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"v1.2.3"}),"\uff08\u8bed\u4e49\u5316\u7248\u672c\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"v1.2.3-<gitsha>"}),"\uff08\u7248\u672c + \u63d0\u4ea4\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sha-<gitsha>"}),"\uff08CI \u81ea\u52a8\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"latest"})," \u4ec5\u7528\u4e8e\u201c\u9ed8\u8ba4\u7a33\u5b9a\u7248\u201d\uff08\u53ef\u7528\u4f46\u4e0d\u8981\u4f9d\u8d56\u5b83\u505a\u56de\u6eda\uff09"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u767b\u5f55\u6253\u6807\u7b7e\u63a8\u9001",children:"\u767b\u5f55\u3001\u6253\u6807\u7b7e\u3001\u63a8\u9001"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u767b\u5f55\u4ed3\u5e93\ndocker login registry.example.com\n\n# \u6784\u5efa\u955c\u50cf\uff08\u672c\u5730 tag\uff09\ndocker build -t app:local .\n\n# \u6253\u6807\u7b7e\uff08\u63a8\u9001\u5230\u8fdc\u7aef\u4ed3\u5e93\u547d\u540d\u7a7a\u95f4\uff09\ndocker tag app:local registry.example.com/team/app:v1.0.0\n\n# \u63a8\u9001\ndocker push registry.example.com/team/app:v1.0.0\n\n# \u62c9\u53d6\ndocker pull registry.example.com/team/app:v1.0.0\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u9009\u62e9\u4ed3\u5e93docker-hub--ghcr--harbor",children:"\u9009\u62e9\u4ed3\u5e93\uff1aDocker Hub / GHCR / Harbor"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Docker Hub"}),"\uff1a\u751f\u6001\u6700\u5927\uff0c\u516c\u5171\u955c\u50cf\u591a"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"GHCR\uff08GitHub Container Registry\uff09"}),"\uff1a\u4e0e GitHub Actions \u914d\u5408\u65b9\u4fbf\uff0c\u6743\u9650\u7ba1\u7406\u6e05\u6670"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Harbor"}),"\uff1a\u4f01\u4e1a\u79c1\u6709\u5316\u5e38\u7528\uff0c\u652f\u6301\u9879\u76ee/\u955c\u50cf\u626b\u63cf/\u590d\u5236\u7b56\u7565/\u5ba1\u8ba1\u7b49"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u81ea\u5efa-registry2\u6700\u7b80\u79c1\u6709\u4ed3\u5e93",children:"\u81ea\u5efa registry:2\uff08\u6700\u7b80\u79c1\u6709\u4ed3\u5e93\uff09"}),"\n",(0,i.jsx)(n.h3,{id:"\u5feb\u901f\u542f\u52a8",children:"\u5feb\u901f\u542f\u52a8"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run -d \\\n  --name registry \\\n  -p 5000:5000 \\\n  -v registry-data:/var/lib/registry \\\n  registry:2\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u63a8\u9001/\u62c9\u53d6\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker tag app:local localhost:5000/app:v1\n\ndocker push localhost:5000/app:v1\n\ndocker pull localhost:5000/app:v1\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u914d\u7f6e\u4e3a\u4e0d\u5b89\u5168\u4ed3\u5e93\u4ec5\u6d4b\u8bd5\u73af\u5883",children:"\u914d\u7f6e\u4e3a\u4e0d\u5b89\u5168\u4ed3\u5e93\uff08\u4ec5\u6d4b\u8bd5\u73af\u5883\uff09"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"/etc/docker/daemon.json"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "insecure-registries": ["localhost:5000"]\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u91cd\u542f Docker \u540e\u751f\u6548\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"tls\u751f\u4ea7\u5efa\u8bae",children:"TLS\uff08\u751f\u4ea7\u5efa\u8bae\uff09"}),"\n",(0,i.jsx)(n.p,{children:"\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u4e3a\u4ed3\u5e93\u914d\u7f6e TLS\uff08\u5e76\u914d\u7f6e\u8bc1\u4e66\u4fe1\u4efb\u94fe\uff09\uff0c\u5e38\u89c1\u505a\u6cd5\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Nginx/Traefik \u4f5c\u4e3a\u53cd\u5411\u4ee3\u7406\uff0c\u7ec8\u6b62 TLS"}),"\n",(0,i.jsxs)(n.li,{children:["\u4ed3\u5e93\u57df\u540d\u4f7f\u7528\u53d7\u4fe1 CA \u8bc1\u4e66\uff08\u907f\u514d\u5728\u5ba2\u6237\u7aef\u914d ",(0,i.jsx)(n.code,{children:"insecure-registries"}),"\uff09"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u57fa\u7840\u8ba4\u8bc1htpasswd",children:"\u57fa\u7840\u8ba4\u8bc1\uff08htpasswd\uff09"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# \u751f\u6210\u5bc6\u7801\u6587\u4ef6\uff08\u9700\u8981 htpasswd \u5de5\u5177\uff0c\u901a\u5e38\u6765\u81ea apache2-utils/httpd-tools\uff09\nhtpasswd -Bbn user strong_password > htpasswd\n\n# \u542f\u52a8\u5e26\u8ba4\u8bc1\u7684 registry\ndocker run -d \\\n  --name registry \\\n  -p 5000:5000 \\\n  -v $(pwd)/htpasswd:/auth/htpasswd:ro \\\n  -e "REGISTRY_AUTH=htpasswd" \\\n  -e "REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm" \\\n  -e "REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd" \\\n  -v registry-data:/var/lib/registry \\\n  registry:2\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5ba2\u6237\u7aef\u767b\u5f55\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker login localhost:5000\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u955c\u50cf\u6e05\u7406\u4e0e\u7a7a\u95f4\u6cbb\u7406",children:"\u955c\u50cf\u6e05\u7406\u4e0e\u7a7a\u95f4\u6cbb\u7406"}),"\n",(0,i.jsx)(n.p,{children:"\u9ad8\u9891\u75db\u70b9\uff1atag \u5f88\u591a\u4f46\u7a7a\u95f4\u4e0d\u91ca\u653e\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u955c\u50cf\u63a8\u9001\u4f1a\u4ea7\u751f\u5386\u53f2 layer"}),"\n",(0,i.jsx)(n.li,{children:"\u5220\u9664 tag \u4e0d\u4e00\u5b9a\u7acb\u5373\u56de\u6536\u5b58\u50a8\uff08\u4e0e registry \u7684\u5783\u573e\u56de\u6536\u7b56\u7565\u6709\u5173\uff09"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"registry:2 \u7684\u5783\u573e\u56de\u6536\u901a\u5e38\u9700\u8981\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u914d\u7f6e ",(0,i.jsx)(n.code,{children:"storage.delete.enabled=true"})]}),"\n",(0,i.jsxs)(n.li,{children:["\u6267\u884c ",(0,i.jsx)(n.code,{children:"registry garbage-collect"}),"\uff08\u5e38\u5728\u505c\u673a\u7a97\u53e3\u64cd\u4f5c\uff09"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u4f01\u4e1a\u573a\u666f\u66f4\u5efa\u8bae\u4f7f\u7528 Harbor \u8fd9\u7c7b\u5e26\u751f\u547d\u5468\u671f\u7ba1\u7406\u7684\u4ed3\u5e93\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u4e0e-cicd-\u96c6\u6210\u6700\u5c0f\u793a\u4f8b",children:"\u4e0e CI/CD \u96c6\u6210\uff08\u6700\u5c0f\u793a\u4f8b\uff09"}),"\n",(0,i.jsx)(n.p,{children:"\u5e38\u89c1\u53d1\u5e03\u6d41\u7a0b\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u751f\u6210\u7248\u672c\u4fe1\u606f\nVERSION=$(git describe --tags --always)\nSHA=$(git rev-parse --short HEAD)\n\n# \u6784\u5efa\u5e76\u6253\u591a\u4e2a tag\nDOCKER_BUILDKIT=1 docker build -t app:${VERSION} -t app:${VERSION}-${SHA} .\n\n# \u63a8\u9001\u5230\u8fdc\u7aef\nREMOTE=registry.example.com/team/app\n\ndocker tag app:${VERSION} ${REMOTE}:${VERSION}\ndocker tag app:${VERSION}-${SHA} ${REMOTE}:${VERSION}-${SHA}\n\ndocker push ${REMOTE}:${VERSION}\ndocker push ${REMOTE}:${VERSION}-${SHA}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);
"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[3594],{48885:(e,n,l)=>{l.d(n,{R:()=>t,x:()=>d});var r=l(99378);const s={},c=r.createContext(s);function t(e){const n=r.useContext(c);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(c.Provider,{value:n},e.children)}},50580:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>i,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"rust/smart-pointers","title":"\u667a\u80fd\u6307\u9488","description":"\u667a\u80fd\u6307\u9488\u662f\u62e5\u6709\u6570\u636e\u6240\u6709\u6743\u5e76\u63d0\u4f9b\u989d\u5916\u529f\u80fd\u7684\u6570\u636e\u7ed3\u6784\u3002\u4e0e\u666e\u901a\u5f15\u7528\u4e0d\u540c,\u667a\u80fd\u6307\u9488\u901a\u5e38\u62e5\u6709\u5b83\u4eec\u6307\u5411\u7684\u6570\u636e,\u5e76\u5728\u79bb\u5f00\u4f5c\u7528\u57df\u65f6\u81ea\u52a8\u6e05\u7406\u8d44\u6e90\u3002","source":"@site/docs/rust/smart-pointers.md","sourceDirName":"rust","slug":"/rust/smart-pointers","permalink":"/docs/rust/smart-pointers","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/rust/smart-pointers.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"\u667a\u80fd\u6307\u9488"},"sidebar":"rust","previous":{"title":"\u5e76\u53d1\u7f16\u7a0b","permalink":"/docs/rust/concurrency"},"next":{"title":"\u751f\u547d\u5468\u671f","permalink":"/docs/rust/lifetimes"}}');var s=l(22714),c=l(48885);const t={sidebar_position:8,title:"\u667a\u80fd\u6307\u9488"},d="\u667a\u80fd\u6307\u9488",i={},a=[{value:"\u667a\u80fd\u6307\u9488\u6982\u8ff0",id:"\u667a\u80fd\u6307\u9488\u6982\u8ff0",level:2},{value:"\u4ec0\u4e48\u662f\u667a\u80fd\u6307\u9488",id:"\u4ec0\u4e48\u662f\u667a\u80fd\u6307\u9488",level:3},{value:"\u667a\u80fd\u6307\u9488 vs \u5f15\u7528",id:"\u667a\u80fd\u6307\u9488-vs-\u5f15\u7528",level:3},{value:"\u5e38\u89c1\u667a\u80fd\u6307\u9488\u7c7b\u578b",id:"\u5e38\u89c1\u667a\u80fd\u6307\u9488\u7c7b\u578b",level:3},{value:"<code>Box&lt;T&gt;</code> - \u5806\u5206\u914d",id:"boxt---\u5806\u5206\u914d",level:2},{value:"\u57fa\u672c\u4f7f\u7528",id:"\u57fa\u672c\u4f7f\u7528",level:3},{value:"\u4f7f\u7528\u573a\u666f",id:"\u4f7f\u7528\u573a\u666f",level:3},{value:"1. \u7f16\u8bd1\u65f6\u5927\u5c0f\u672a\u77e5\u7684\u7c7b\u578b",id:"1-\u7f16\u8bd1\u65f6\u5927\u5c0f\u672a\u77e5\u7684\u7c7b\u578b",level:4},{value:"2. \u8f6c\u79fb\u5927\u91cf\u6570\u636e\u7684\u6240\u6709\u6743",id:"2-\u8f6c\u79fb\u5927\u91cf\u6570\u636e\u7684\u6240\u6709\u6743",level:4},{value:"3. Trait \u5bf9\u8c61",id:"3-trait-\u5bf9\u8c61",level:4},{value:"\u5b9e\u6218\u793a\u4f8b:\u4e8c\u53c9\u6811",id:"\u5b9e\u6218\u793a\u4f8b\u4e8c\u53c9\u6811",level:3},{value:"<code>Rc&lt;T&gt;</code> - \u5f15\u7528\u8ba1\u6570",id:"rct---\u5f15\u7528\u8ba1\u6570",level:2},{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:3},{value:"\u5171\u4eab\u6570\u636e\u7ed3\u6784",id:"\u5171\u4eab\u6570\u636e\u7ed3\u6784",level:3},{value:"\u5b9e\u6218\u793a\u4f8b:\u56fe\u6570\u636e\u7ed3\u6784",id:"\u5b9e\u6218\u793a\u4f8b\u56fe\u6570\u636e\u7ed3\u6784",level:3},{value:"<code>RefCell&lt;T&gt;</code> - \u5185\u90e8\u53ef\u53d8\u6027",id:"refcellt---\u5185\u90e8\u53ef\u53d8\u6027",level:2},{value:"\u5185\u90e8\u53ef\u53d8\u6027\u6a21\u5f0f",id:"\u5185\u90e8\u53ef\u53d8\u6027\u6a21\u5f0f",level:3},{value:"\u501f\u7528\u89c4\u5219(\u8fd0\u884c\u65f6\u68c0\u67e5)",id:"\u501f\u7528\u89c4\u5219\u8fd0\u884c\u65f6\u68c0\u67e5",level:3},{value:"<code>Rc&lt;RefCell&lt;T&gt;&gt;</code> \u7ec4\u5408",id:"rcrefcellt-\u7ec4\u5408",level:3},{value:"Mock \u5bf9\u8c61\u793a\u4f8b",id:"mock-\u5bf9\u8c61\u793a\u4f8b",level:3},{value:"<code>Arc&lt;T&gt;</code> - \u539f\u5b50\u5f15\u7528\u8ba1\u6570",id:"arct---\u539f\u5b50\u5f15\u7528\u8ba1\u6570",level:2},{value:"\u591a\u7ebf\u7a0b\u5171\u4eab\u6240\u6709\u6743",id:"\u591a\u7ebf\u7a0b\u5171\u4eab\u6240\u6709\u6743",level:3},{value:"<code>Arc&lt;Mutex&lt;T&gt;&gt;</code> \u7ec4\u5408",id:"arcmutext-\u7ec4\u5408",level:3},{value:"Arc vs Rc \u5bf9\u6bd4",id:"arc-vs-rc-\u5bf9\u6bd4",level:3},{value:"<code>Weak&lt;T&gt;</code> - \u5f31\u5f15\u7528",id:"weakt---\u5f31\u5f15\u7528",level:2},{value:"\u907f\u514d\u5faa\u73af\u5f15\u7528",id:"\u907f\u514d\u5faa\u73af\u5f15\u7528",level:3},{value:"\u6811\u7ed3\u6784\u5b9e\u73b0",id:"\u6811\u7ed3\u6784\u5b9e\u73b0",level:3},{value:"\u667a\u80fd\u6307\u9488\u9009\u62e9\u6307\u5357",id:"\u667a\u80fd\u6307\u9488\u9009\u62e9\u6307\u5357",level:2},{value:"\u51b3\u7b56\u6811",id:"\u51b3\u7b56\u6811",level:3},{value:"\u4f7f\u7528\u573a\u666f\u5bf9\u6bd4",id:"\u4f7f\u7528\u573a\u666f\u5bf9\u6bd4",level:3},{value:"\u6027\u80fd\u8003\u91cf",id:"\u6027\u80fd\u8003\u91cf",level:3},{value:"\u5b9e\u6218\u6848\u4f8b",id:"\u5b9e\u6218\u6848\u4f8b",level:2},{value:"\u6848\u4f8b1: DOM \u6811\u7ed3\u6784",id:"\u6848\u4f8b1-dom-\u6811\u7ed3\u6784",level:3},{value:"\u6848\u4f8b2: \u89c2\u5bdf\u8005\u6a21\u5f0f",id:"\u6848\u4f8b2-\u89c2\u5bdf\u8005\u6a21\u5f0f",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u4f18\u5148\u4f7f\u7528 <code>Box&lt;T&gt;</code>",id:"1-\u4f18\u5148\u4f7f\u7528-boxt",level:3},{value:"2. \u907f\u514d\u5faa\u73af\u5f15\u7528",id:"2-\u907f\u514d\u5faa\u73af\u5f15\u7528",level:3},{value:"3. \u5355\u7ebf\u7a0b\u7528 Rc,\u591a\u7ebf\u7a0b\u7528 Arc",id:"3-\u5355\u7ebf\u7a0b\u7528-rc\u591a\u7ebf\u7a0b\u7528-arc",level:3},{value:"4. \u8c28\u614e\u4f7f\u7528 RefCell",id:"4-\u8c28\u614e\u4f7f\u7528-refcell",level:3},{value:"\u5e38\u89c1\u9519\u8bef",id:"\u5e38\u89c1\u9519\u8bef",level:2},{value:"\u9519\u8bef1: RefCell \u501f\u7528\u51b2\u7a81",id:"\u9519\u8bef1-refcell-\u501f\u7528\u51b2\u7a81",level:3},{value:"\u9519\u8bef2: \u5faa\u73af\u5f15\u7528\u5185\u5b58\u6cc4\u6f0f",id:"\u9519\u8bef2-\u5faa\u73af\u5f15\u7528\u5185\u5b58\u6cc4\u6f0f",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u667a\u80fd\u6307\u9488",children:"\u667a\u80fd\u6307\u9488"})}),"\n",(0,s.jsx)(n.p,{children:"\u667a\u80fd\u6307\u9488\u662f\u62e5\u6709\u6570\u636e\u6240\u6709\u6743\u5e76\u63d0\u4f9b\u989d\u5916\u529f\u80fd\u7684\u6570\u636e\u7ed3\u6784\u3002\u4e0e\u666e\u901a\u5f15\u7528\u4e0d\u540c,\u667a\u80fd\u6307\u9488\u901a\u5e38\u62e5\u6709\u5b83\u4eec\u6307\u5411\u7684\u6570\u636e,\u5e76\u5728\u79bb\u5f00\u4f5c\u7528\u57df\u65f6\u81ea\u52a8\u6e05\u7406\u8d44\u6e90\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u667a\u80fd\u6307\u9488\u6982\u8ff0",children:"\u667a\u80fd\u6307\u9488\u6982\u8ff0"}),"\n",(0,s.jsx)(n.h3,{id:"\u4ec0\u4e48\u662f\u667a\u80fd\u6307\u9488",children:"\u4ec0\u4e48\u662f\u667a\u80fd\u6307\u9488"}),"\n",(0,s.jsxs)(n.p,{children:["\u667a\u80fd\u6307\u9488\u662f\u5b9e\u73b0\u4e86 ",(0,s.jsx)(n.code,{children:"Deref"})," \u548c ",(0,s.jsx)(n.code,{children:"Drop"})," trait \u7684\u7ed3\u6784\u4f53:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Deref trait"})," - \u5141\u8bb8\u667a\u80fd\u6307\u9488\u50cf\u5f15\u7528\u4e00\u6837\u88ab\u4f7f\u7528"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Drop trait"})," - \u5141\u8bb8\u81ea\u5b9a\u4e49\u6e05\u7406\u4ee3\u7801"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u667a\u80fd\u6307\u9488-vs-\u5f15\u7528",children:"\u667a\u80fd\u6307\u9488 vs \u5f15\u7528"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"fn main() {\n    // \u666e\u901a\u5f15\u7528:\u53ea\u501f\u7528\u6570\u636e\n    let x = 5;\n    let y = &x;\n    \n    // \u667a\u80fd\u6307\u9488:\u62e5\u6709\u6570\u636e\n    let b = Box::new(5);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u5e38\u89c1\u667a\u80fd\u6307\u9488\u7c7b\u578b",children:"\u5e38\u89c1\u667a\u80fd\u6307\u9488\u7c7b\u578b"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,s.jsx)(n.th,{children:"\u6240\u6709\u6743"}),(0,s.jsx)(n.th,{children:"\u7ebf\u7a0b\u5b89\u5168"}),(0,s.jsx)(n.th,{children:"\u7528\u9014"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Box<T>"})}),(0,s.jsx)(n.td,{children:"\u552f\u4e00"}),(0,s.jsx)(n.td,{children:"\u662f"}),(0,s.jsx)(n.td,{children:"\u5806\u5206\u914d"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Rc<T>"})}),(0,s.jsx)(n.td,{children:"\u5171\u4eab"}),(0,s.jsx)(n.td,{children:"\u5426"}),(0,s.jsx)(n.td,{children:"\u5355\u7ebf\u7a0b\u5f15\u7528\u8ba1\u6570"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Arc<T>"})}),(0,s.jsx)(n.td,{children:"\u5171\u4eab"}),(0,s.jsx)(n.td,{children:"\u662f"}),(0,s.jsx)(n.td,{children:"\u591a\u7ebf\u7a0b\u5f15\u7528\u8ba1\u6570"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RefCell<T>"})}),(0,s.jsx)(n.td,{children:"\u552f\u4e00"}),(0,s.jsx)(n.td,{children:"\u5426"}),(0,s.jsx)(n.td,{children:"\u5185\u90e8\u53ef\u53d8\u6027"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Mutex<T>"})}),(0,s.jsx)(n.td,{children:"\u552f\u4e00"}),(0,s.jsx)(n.td,{children:"\u662f"}),(0,s.jsx)(n.td,{children:"\u7ebf\u7a0b\u5b89\u5168\u7684\u5185\u90e8\u53ef\u53d8\u6027"})]})]})]}),"\n",(0,s.jsxs)(n.h2,{id:"boxt---\u5806\u5206\u914d",children:[(0,s.jsx)(n.code,{children:"Box<T>"})," - \u5806\u5206\u914d"]}),"\n",(0,s.jsx)(n.h3,{id:"\u57fa\u672c\u4f7f\u7528",children:"\u57fa\u672c\u4f7f\u7528"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Box<T>"})," \u7528\u4e8e\u5728\u5806\u4e0a\u5206\u914d\u503c,\u662f\u6700\u7b80\u5355\u7684\u667a\u80fd\u6307\u9488\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'fn main() {\n    // \u5728\u5806\u4e0a\u5206\u914d\u4e00\u4e2a\u6574\u6570\n    let b = Box::new(5);\n    println!("b = {}", b);\n    \n    // \u81ea\u52a8\u89e3\u5f15\u7528\n    let sum = *b + 1;\n    println!("sum = {}", sum);\n}  // b \u79bb\u5f00\u4f5c\u7528\u57df,\u5806\u4e0a\u7684\u6570\u636e\u88ab\u91ca\u653e\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528\u573a\u666f",children:"\u4f7f\u7528\u573a\u666f"}),"\n",(0,s.jsx)(n.h4,{id:"1-\u7f16\u8bd1\u65f6\u5927\u5c0f\u672a\u77e5\u7684\u7c7b\u578b",children:"1. \u7f16\u8bd1\u65f6\u5927\u5c0f\u672a\u77e5\u7684\u7c7b\u578b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"// \u9012\u5f52\u7c7b\u578b\u5fc5\u987b\u4f7f\u7528 Box\nenum List {\n    Cons(i32, Box<List>),\n    Nil,\n}\n\nuse List::{Cons, Nil};\n\nfn main() {\n    let list = Cons(1, \n        Box::new(Cons(2, \n            Box::new(Cons(3, \n                Box::new(Nil))))));\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2-\u8f6c\u79fb\u5927\u91cf\u6570\u636e\u7684\u6240\u6709\u6743",children:"2. \u8f6c\u79fb\u5927\u91cf\u6570\u636e\u7684\u6240\u6709\u6743"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"fn main() {\n    // \u5927\u578b\u6570\u7ec4\u5728\u6808\u4e0a\u53ef\u80fd\u5bfc\u81f4\u6808\u6ea2\u51fa\n    let large_array = [0; 1_000_000];\n    \n    // \u4f7f\u7528 Box \u5728\u5806\u4e0a\u5206\u914d\n    let boxed_array = Box::new([0; 1_000_000]);\n    \n    // \u8f6c\u79fb\u6240\u6709\u6743\u53ea\u9700\u590d\u5236\u6307\u9488(8\u5b57\u8282),\u800c\u975e\u6574\u4e2a\u6570\u7ec4\n    let moved_box = boxed_array;\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"3-trait-\u5bf9\u8c61",children:"3. Trait \u5bf9\u8c61"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'trait Draw {\n    fn draw(&self);\n}\n\nstruct Button {\n    width: u32,\n    height: u32,\n}\n\nimpl Draw for Button {\n    fn draw(&self) {\n        println!("\u7ed8\u5236\u6309\u94ae: {}x{}", self.width, self.height);\n    }\n}\n\nstruct TextField {\n    placeholder: String,\n}\n\nimpl Draw for TextField {\n    fn draw(&self) {\n        println!("\u7ed8\u5236\u6587\u672c\u6846: {}", self.placeholder);\n    }\n}\n\nfn main() {\n    // \u4f7f\u7528 Box<dyn Trait> \u5b58\u50a8\u4e0d\u540c\u7c7b\u578b\n    let components: Vec<Box<dyn Draw>> = vec![\n        Box::new(Button { width: 50, height: 10 }),\n        Box::new(TextField { placeholder: String::from("\u8f93\u5165...") }),\n    ];\n    \n    for component in components.iter() {\n        component.draw();\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u5b9e\u6218\u793a\u4f8b\u4e8c\u53c9\u6811",children:"\u5b9e\u6218\u793a\u4f8b:\u4e8c\u53c9\u6811"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'#[derive(Debug)]\nstruct TreeNode {\n    value: i32,\n    left: Option<Box<TreeNode>>,\n    right: Option<Box<TreeNode>>,\n}\n\nimpl TreeNode {\n    fn new(value: i32) -> Self {\n        TreeNode {\n            value,\n            left: None,\n            right: None,\n        }\n    }\n    \n    fn insert(&mut self, value: i32) {\n        if value < self.value {\n            match self.left {\n                Some(ref mut node) => node.insert(value),\n                None => self.left = Some(Box::new(TreeNode::new(value))),\n            }\n        } else {\n            match self.right {\n                Some(ref mut node) => node.insert(value),\n                None => self.right = Some(Box::new(TreeNode::new(value))),\n            }\n        }\n    }\n    \n    fn inorder(&self) {\n        if let Some(ref left) = self.left {\n            left.inorder();\n        }\n        print!("{} ", self.value);\n        if let Some(ref right) = self.right {\n            right.inorder();\n        }\n    }\n}\n\nfn main() {\n    let mut root = TreeNode::new(5);\n    root.insert(3);\n    root.insert(7);\n    root.insert(1);\n    root.insert(9);\n    \n    print!("\u4e2d\u5e8f\u904d\u5386: ");\n    root.inorder();\n    println!();\n}\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"rct---\u5f15\u7528\u8ba1\u6570",children:[(0,s.jsx)(n.code,{children:"Rc<T>"})," - \u5f15\u7528\u8ba1\u6570"]}),"\n",(0,s.jsx)(n.h3,{id:"\u57fa\u672c\u6982\u5ff5",children:"\u57fa\u672c\u6982\u5ff5"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Rc<T>"})," (Reference Counted) \u5141\u8bb8\u4e00\u4e2a\u503c\u6709\u591a\u4e2a\u6240\u6709\u8005,\u901a\u8fc7\u5f15\u7528\u8ba1\u6570\u8ddf\u8e2a\u6240\u6709\u8005\u6570\u91cf\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::rc::Rc;\n\nfn main() {\n    let a = Rc::new(5);\n    println!("\u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&a));  // 1\n    \n    let b = Rc::clone(&a);\n    println!("\u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&a));  // 2\n    \n    {\n        let c = Rc::clone(&a);\n        println!("\u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&a));  // 3\n    }\n    \n    println!("\u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&a));  // 2\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["[!WARNING]\n",(0,s.jsx)(n.code,{children:"Rc<T>"})," \u53ea\u80fd\u7528\u4e8e\u5355\u7ebf\u7a0b\u573a\u666f\u3002\u591a\u7ebf\u7a0b\u8bf7\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"Arc<T>"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u5171\u4eab\u6570\u636e\u7ed3\u6784",children:"\u5171\u4eab\u6570\u636e\u7ed3\u6784"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::rc::Rc;\n\nenum List {\n    Cons(i32, Rc<List>),\n    Nil,\n}\n\nuse List::{Cons, Nil};\n\nfn main() {\n    let a = Rc::new(Cons(5, Rc::new(Cons(10, Rc::new(Nil)))));\n    println!("a \u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&a));\n    \n    // b \u548c c \u5171\u4eab a \u7684\u6240\u6709\u6743\n    let b = Cons(3, Rc::clone(&a));\n    println!("a \u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&a));\n    \n    let c = Cons(4, Rc::clone(&a));\n    println!("a \u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&a));\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u5b9e\u6218\u793a\u4f8b\u56fe\u6570\u636e\u7ed3\u6784",children:"\u5b9e\u6218\u793a\u4f8b:\u56fe\u6570\u636e\u7ed3\u6784"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::rc::Rc;\nuse std::cell::RefCell;\n\n#[derive(Debug)]\nstruct Node {\n    value: i32,\n    neighbors: RefCell<Vec<Rc<Node>>>,\n}\n\nimpl Node {\n    fn new(value: i32) -> Rc<Self> {\n        Rc::new(Node {\n            value,\n            neighbors: RefCell::new(Vec::new()),\n        })\n    }\n    \n    fn add_neighbor(&self, neighbor: Rc<Node>) {\n        self.neighbors.borrow_mut().push(neighbor);\n    }\n}\n\nfn main() {\n    let node1 = Node::new(1);\n    let node2 = Node::new(2);\n    let node3 = Node::new(3);\n    \n    // \u5efa\u7acb\u56fe\u7684\u8fde\u63a5\n    node1.add_neighbor(Rc::clone(&node2));\n    node1.add_neighbor(Rc::clone(&node3));\n    node2.add_neighbor(Rc::clone(&node3));\n    \n    println!("\u8282\u70b91\u7684\u90bb\u5c45\u6570: {}", node1.neighbors.borrow().len());\n    println!("\u8282\u70b92\u7684\u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&node2));\n}\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"refcellt---\u5185\u90e8\u53ef\u53d8\u6027",children:[(0,s.jsx)(n.code,{children:"RefCell<T>"})," - \u5185\u90e8\u53ef\u53d8\u6027"]}),"\n",(0,s.jsx)(n.h3,{id:"\u5185\u90e8\u53ef\u53d8\u6027\u6a21\u5f0f",children:"\u5185\u90e8\u53ef\u53d8\u6027\u6a21\u5f0f"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"RefCell<T>"})," \u5141\u8bb8\u5728\u62e5\u6709\u4e0d\u53ef\u53d8\u5f15\u7528\u7684\u60c5\u51b5\u4e0b\u4fee\u6539\u6570\u636e,\u501f\u7528\u89c4\u5219\u5728",(0,s.jsx)(n.strong,{children:"\u8fd0\u884c\u65f6"}),"\u68c0\u67e5\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::cell::RefCell;\n\nfn main() {\n    let x = RefCell::new(5);\n    \n    // \u83b7\u53d6\u53ef\u53d8\u5f15\u7528\n    *x.borrow_mut() += 1;\n    \n    // \u83b7\u53d6\u4e0d\u53ef\u53d8\u5f15\u7528\n    println!("x = {:?}", x.borrow());\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u501f\u7528\u89c4\u5219\u8fd0\u884c\u65f6\u68c0\u67e5",children:"\u501f\u7528\u89c4\u5219(\u8fd0\u884c\u65f6\u68c0\u67e5)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::cell::RefCell;\n\nfn main() {\n    let x = RefCell::new(5);\n    \n    // \u540c\u65f6\u6709\u591a\u4e2a\u4e0d\u53ef\u53d8\u501f\u7528:OK\n    let a = x.borrow();\n    let b = x.borrow();\n    println!("a = {}, b = {}", a, b);\n    \n    drop(a);\n    drop(b);\n    \n    // \u53ef\u53d8\u501f\u7528\u4e0e\u4e0d\u53ef\u53d8\u501f\u7528\u540c\u65f6\u5b58\u5728:\u8fd0\u884c\u65f6 panic\n    // let c = x.borrow();\n    // let d = x.borrow_mut();  // panic!\n}\n'})}),"\n",(0,s.jsxs)(n.h3,{id:"rcrefcellt-\u7ec4\u5408",children:[(0,s.jsx)(n.code,{children:"Rc<RefCell<T>>"})," \u7ec4\u5408"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::cell::RefCell;\nuse std::rc::Rc;\n\n#[derive(Debug)]\nenum List {\n    Cons(Rc<RefCell<i32>>, Rc<List>),\n    Nil,\n}\n\nuse List::{Cons, Nil};\n\nfn main() {\n    let value = Rc::new(RefCell::new(5));\n    \n    let a = Rc::new(Cons(Rc::clone(&value), Rc::new(Nil)));\n    let b = Cons(Rc::new(RefCell::new(6)), Rc::clone(&a));\n    let c = Cons(Rc::new(RefCell::new(10)), Rc::clone(&a));\n    \n    // \u4fee\u6539\u5171\u4eab\u7684\u503c\n    *value.borrow_mut() += 10;\n    \n    println!("a = {:?}", a);\n    println!("b = {:?}", b);\n    println!("c = {:?}", c);\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"mock-\u5bf9\u8c61\u793a\u4f8b",children:"Mock \u5bf9\u8c61\u793a\u4f8b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"use std::cell::RefCell;\n\npub trait Messenger {\n    fn send(&self, msg: &str);\n}\n\npub struct LimitTracker<'a, T: Messenger> {\n    messenger: &'a T,\n    value: usize,\n    max: usize,\n}\n\nimpl<'a, T> LimitTracker<'a, T>\nwhere\n    T: Messenger,\n{\n    pub fn new(messenger: &'a T, max: usize) -> LimitTracker<'a, T> {\n        LimitTracker {\n            messenger,\n            value: 0,\n            max,\n        }\n    }\n    \n    pub fn set_value(&mut self, value: usize) {\n        self.value = value;\n        \n        let percentage = self.value as f64 / self.max as f64;\n        \n        if percentage >= 1.0 {\n            self.messenger.send(\"\u9519\u8bef: \u8d85\u8fc7\u914d\u989d!\");\n        } else if percentage >= 0.9 {\n            self.messenger.send(\"\u8b66\u544a: \u5df2\u4f7f\u7528 90% \u914d\u989d\");\n        } else if percentage >= 0.75 {\n            self.messenger.send(\"\u8b66\u544a: \u5df2\u4f7f\u7528 75% \u914d\u989d\");\n        }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    \n    struct MockMessenger {\n        sent_messages: RefCell<Vec<String>>,\n    }\n    \n    impl MockMessenger {\n        fn new() -> MockMessenger {\n            MockMessenger {\n                sent_messages: RefCell::new(vec![]),\n            }\n        }\n    }\n    \n    impl Messenger for MockMessenger {\n        fn send(&self, message: &str) {\n            // \u5728\u4e0d\u53ef\u53d8\u5f15\u7528\u4e2d\u4fee\u6539\u6570\u636e\n            self.sent_messages.borrow_mut().push(String::from(message));\n        }\n    }\n    \n    #[test]\n    fn it_sends_an_over_75_percent_warning_message() {\n        let mock_messenger = MockMessenger::new();\n        let mut limit_tracker = LimitTracker::new(&mock_messenger, 100);\n        \n        limit_tracker.set_value(80);\n        \n        assert_eq!(mock_messenger.sent_messages.borrow().len(), 1);\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"arct---\u539f\u5b50\u5f15\u7528\u8ba1\u6570",children:[(0,s.jsx)(n.code,{children:"Arc<T>"})," - \u539f\u5b50\u5f15\u7528\u8ba1\u6570"]}),"\n",(0,s.jsx)(n.h3,{id:"\u591a\u7ebf\u7a0b\u5171\u4eab\u6240\u6709\u6743",children:"\u591a\u7ebf\u7a0b\u5171\u4eab\u6240\u6709\u6743"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Arc<T>"})," (Atomic Reference Counted) \u662f\u7ebf\u7a0b\u5b89\u5168\u7248\u672c\u7684 ",(0,s.jsx)(n.code,{children:"Rc<T>"}),"\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::sync::Arc;\nuse std::thread;\n\nfn main() {\n    let data = Arc::new(vec![1, 2, 3, 4, 5]);\n    let mut handles = vec![];\n    \n    for i in 0..5 {\n        let data = Arc::clone(&data);\n        let handle = thread::spawn(move || {\n            println!("\u7ebf\u7a0b {} \u7684\u6570\u636e: {:?}", i, data);\n        });\n        handles.push(handle);\n    }\n    \n    for handle in handles {\n        handle.join().unwrap();\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.h3,{id:"arcmutext-\u7ec4\u5408",children:[(0,s.jsx)(n.code,{children:"Arc<Mutex<T>>"})," \u7ec4\u5408"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::sync::{Arc, Mutex};\nuse std::thread;\n\nfn main() {\n    let counter = Arc::new(Mutex::new(0));\n    let mut handles = vec![];\n    \n    for _ in 0..10 {\n        let counter = Arc::clone(&counter);\n        let handle = thread::spawn(move || {\n            let mut num = counter.lock().unwrap();\n            *num += 1;\n        });\n        handles.push(handle);\n    }\n    \n    for handle in handles {\n        handle.join().unwrap();\n    }\n    \n    println!("\u7ed3\u679c: {}", *counter.lock().unwrap());\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"arc-vs-rc-\u5bf9\u6bd4",children:"Arc vs Rc \u5bf9\u6bd4"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::rc::Rc;\nuse std::sync::Arc;\n\nfn main() {\n    // Rc: \u5355\u7ebf\u7a0b,\u6027\u80fd\u66f4\u597d\n    let rc = Rc::new(5);\n    let rc2 = Rc::clone(&rc);\n    \n    // Arc: \u591a\u7ebf\u7a0b,\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\n    let arc = Arc::new(5);\n    let arc2 = Arc::clone(&arc);\n    \n    // Rc \u4e0d\u80fd\u8de8\u7ebf\u7a0b\n    // thread::spawn(move || {\n    //     println!("{}", rc);  // \u9519\u8bef: Rc \u672a\u5b9e\u73b0 Send\n    // });\n    \n    // Arc \u53ef\u4ee5\u8de8\u7ebf\u7a0b\n    thread::spawn(move || {\n        println!("{}", arc);  // \u6b63\u786e\n    });\n}\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"weakt---\u5f31\u5f15\u7528",children:[(0,s.jsx)(n.code,{children:"Weak<T>"})," - \u5f31\u5f15\u7528"]}),"\n",(0,s.jsx)(n.h3,{id:"\u907f\u514d\u5faa\u73af\u5f15\u7528",children:"\u907f\u514d\u5faa\u73af\u5f15\u7528"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Weak<T>"})," \u662f\u5f31\u5f15\u7528,\u4e0d\u589e\u52a0\u5f15\u7528\u8ba1\u6570,\u7528\u4e8e\u907f\u514d\u5faa\u73af\u5f15\u7528\u5bfc\u81f4\u7684\u5185\u5b58\u6cc4\u6f0f\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::cell::RefCell;\nuse std::rc::{Rc, Weak};\n\n#[derive(Debug)]\nstruct Node {\n    value: i32,\n    parent: RefCell<Weak<Node>>,\n    children: RefCell<Vec<Rc<Node>>>,\n}\n\nfn main() {\n    let leaf = Rc::new(Node {\n        value: 3,\n        parent: RefCell::new(Weak::new()),\n        children: RefCell::new(vec![]),\n    });\n    \n    println!("leaf \u5f3a\u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&leaf));\n    println!("leaf \u5f31\u5f15\u7528\u8ba1\u6570: {}", Rc::weak_count(&leaf));\n    \n    {\n        let branch = Rc::new(Node {\n            value: 5,\n            parent: RefCell::new(Weak::new()),\n            children: RefCell::new(vec![Rc::clone(&leaf)]),\n        });\n        \n        // \u5efa\u7acb\u7236\u5b50\u5173\u7cfb\n        *leaf.parent.borrow_mut() = Rc::downgrade(&branch);\n        \n        println!("branch \u5f3a\u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&branch));\n        println!("branch \u5f31\u5f15\u7528\u8ba1\u6570: {}", Rc::weak_count(&branch));\n        \n        println!("leaf \u5f3a\u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&leaf));\n        println!("leaf \u5f31\u5f15\u7528\u8ba1\u6570: {}", Rc::weak_count(&leaf));\n    }\n    \n    // branch \u79bb\u5f00\u4f5c\u7528\u57df\u88ab\u91ca\u653e\n    println!("leaf parent: {:?}", leaf.parent.borrow().upgrade());\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u6811\u7ed3\u6784\u5b9e\u73b0",children:"\u6811\u7ed3\u6784\u5b9e\u73b0"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::cell::RefCell;\nuse std::rc::{Rc, Weak};\n\n#[derive(Debug)]\nstruct TreeNode {\n    value: String,\n    parent: RefCell<Weak<TreeNode>>,\n    children: RefCell<Vec<Rc<TreeNode>>>,\n}\n\nimpl TreeNode {\n    fn new(value: String) -> Rc<Self> {\n        Rc::new(TreeNode {\n            value,\n            parent: RefCell::new(Weak::new()),\n            children: RefCell::new(Vec::new()),\n        })\n    }\n    \n    fn add_child(parent: &Rc<TreeNode>, child: Rc<TreeNode>) {\n        *child.parent.borrow_mut() = Rc::downgrade(parent);\n        parent.children.borrow_mut().push(child);\n    }\n}\n\nfn main() {\n    let root = TreeNode::new(String::from("root"));\n    let child1 = TreeNode::new(String::from("child1"));\n    let child2 = TreeNode::new(String::from("child2"));\n    \n    TreeNode::add_child(&root, child1);\n    TreeNode::add_child(&root, child2);\n    \n    println!("Root \u5b50\u8282\u70b9\u6570: {}", root.children.borrow().len());\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u667a\u80fd\u6307\u9488\u9009\u62e9\u6307\u5357",children:"\u667a\u80fd\u6307\u9488\u9009\u62e9\u6307\u5357"}),"\n",(0,s.jsx)(n.h3,{id:"\u51b3\u7b56\u6811",children:"\u51b3\u7b56\u6811"}),"\n",(0,s.jsx)(n.mermaid,{value:"graph TD\n    A[\u9700\u8981\u667a\u80fd\u6307\u9488] --\x3e B{\u9700\u8981\u5171\u4eab\u6240\u6709\u6743?}\n    B --\x3e|\u5426| C{\u9700\u8981\u6539\u53d8\u503c?}\n    B --\x3e|\u662f| D{\u591a\u7ebf\u7a0b?}\n    \n    C --\x3e|\u5426| E[Box<T>]\n    C --\x3e|\u662f| F{\u7f16\u8bd1\u65f6\u8fd8\u662f\u8fd0\u884c\u65f6\u68c0\u67e5?}\n    \n    F --\x3e|\u7f16\u8bd1\u65f6| G[&mut T]\n    F --\x3e|\u8fd0\u884c\u65f6| H[RefCell<T>]\n    \n    D --\x3e|\u5426| I{\u9700\u8981\u6539\u53d8\u503c?}\n    D --\x3e|\u662f| J{\u9700\u8981\u6539\u53d8\u503c?}\n    \n    I --\x3e|\u5426| K[Rc<T>]\n    I --\x3e|\u662f| L[Rc<RefCell<T>>]\n    \n    J --\x3e|\u5426| M[Arc<T>]\n    J --\x3e|\u662f| N[Arc<Mutex<T>>]"}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528\u573a\u666f\u5bf9\u6bd4",children:"\u4f7f\u7528\u573a\u666f\u5bf9\u6bd4"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u573a\u666f"}),(0,s.jsx)(n.th,{children:"\u63a8\u8350\u65b9\u6848"}),(0,s.jsx)(n.th,{children:"\u539f\u56e0"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u5806\u5206\u914d\u5927\u5bf9\u8c61"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Box<T>"})}),(0,s.jsx)(n.td,{children:"\u907f\u514d\u6808\u6ea2\u51fa"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u9012\u5f52\u6570\u636e\u7ed3\u6784"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Box<T>"})}),(0,s.jsx)(n.td,{children:"\u786e\u5b9a\u5927\u5c0f"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Trait \u5bf9\u8c61"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Box<dyn Trait>"})}),(0,s.jsx)(n.td,{children:"\u52a8\u6001\u5206\u53d1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u5355\u7ebf\u7a0b\u5171\u4eab\u53ea\u8bfb\u6570\u636e"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Rc<T>"})}),(0,s.jsx)(n.td,{children:"\u591a\u4e2a\u6240\u6709\u8005"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u5355\u7ebf\u7a0b\u5171\u4eab\u53ef\u53d8\u6570\u636e"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Rc<RefCell<T>>"})}),(0,s.jsx)(n.td,{children:"\u5185\u90e8\u53ef\u53d8\u6027"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u591a\u7ebf\u7a0b\u5171\u4eab\u53ea\u8bfb\u6570\u636e"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Arc<T>"})}),(0,s.jsx)(n.td,{children:"\u7ebf\u7a0b\u5b89\u5168"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u591a\u7ebf\u7a0b\u5171\u4eab\u53ef\u53d8\u6570\u636e"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Arc<Mutex<T>>"})}),(0,s.jsx)(n.td,{children:"\u7ebf\u7a0b\u5b89\u5168\u7684\u53ef\u53d8\u6027"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u907f\u514d\u5faa\u73af\u5f15\u7528"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Weak<T>"})}),(0,s.jsx)(n.td,{children:"\u4e0d\u589e\u52a0\u5f15\u7528\u8ba1\u6570"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"\u6027\u80fd\u8003\u91cf",children:"\u6027\u80fd\u8003\u91cf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"use std::rc::Rc;\nuse std::sync::Arc;\n\nfn main() {\n    // Box: \u65e0\u8fd0\u884c\u65f6\u5f00\u9500\n    let b = Box::new(5);\n    \n    // Rc: \u975e\u539f\u5b50\u5f15\u7528\u8ba1\u6570,\u6027\u80fd\u8f83\u597d\n    let rc = Rc::new(5);\n    \n    // Arc: \u539f\u5b50\u5f15\u7528\u8ba1\u6570,\u6027\u80fd\u7565\u5dee\n    let arc = Arc::new(5);\n    \n    // RefCell: \u8fd0\u884c\u65f6\u501f\u7528\u68c0\u67e5,\u6709\u5c11\u91cf\u5f00\u9500\n    use std::cell::RefCell;\n    let cell = RefCell::new(5);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u5b9e\u6218\u6848\u4f8b",children:"\u5b9e\u6218\u6848\u4f8b"}),"\n",(0,s.jsx)(n.h3,{id:"\u6848\u4f8b1-dom-\u6811\u7ed3\u6784",children:"\u6848\u4f8b1: DOM \u6811\u7ed3\u6784"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::cell::RefCell;\nuse std::rc::{Rc, Weak};\n\n#[derive(Debug)]\nstruct DomNode {\n    tag: String,\n    attributes: RefCell<Vec<(String, String)>>,\n    parent: RefCell<Weak<DomNode>>,\n    children: RefCell<Vec<Rc<DomNode>>>,\n}\n\nimpl DomNode {\n    fn new(tag: &str) -> Rc<Self> {\n        Rc::new(DomNode {\n            tag: tag.to_string(),\n            attributes: RefCell::new(Vec::new()),\n            parent: RefCell::new(Weak::new()),\n            children: RefCell::new(Vec::new()),\n        })\n    }\n    \n    fn append_child(parent: &Rc<DomNode>, child: Rc<DomNode>) {\n        *child.parent.borrow_mut() = Rc::downgrade(parent);\n        parent.children.borrow_mut().push(child);\n    }\n    \n    fn set_attribute(&self, name: &str, value: &str) {\n        self.attributes.borrow_mut().push((name.to_string(), value.to_string()));\n    }\n    \n    fn render(&self, indent: usize) {\n        let spaces = " ".repeat(indent);\n        print!("{}<{}", spaces, self.tag);\n        \n        for (name, value) in self.attributes.borrow().iter() {\n            print!(" {}=\\"{}\\"", name, value);\n        }\n        \n        if self.children.borrow().is_empty() {\n            println!(" />");\n        } else {\n            println!(">");\n            for child in self.children.borrow().iter() {\n                child.render(indent + 2);\n            }\n            println!("{}</{}>", spaces, self.tag);\n        }\n    }\n}\n\nfn main() {\n    let root = DomNode::new("div");\n    root.set_attribute("class", "container");\n    \n    let header = DomNode::new("h1");\n    header.set_attribute("id", "title");\n    \n    let paragraph = DomNode::new("p");\n    paragraph.set_attribute("class", "content");\n    \n    DomNode::append_child(&root, header);\n    DomNode::append_child(&root, paragraph);\n    \n    root.render(0);\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u6848\u4f8b2-\u89c2\u5bdf\u8005\u6a21\u5f0f",children:"\u6848\u4f8b2: \u89c2\u5bdf\u8005\u6a21\u5f0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::cell::RefCell;\nuse std::rc::Rc;\n\ntrait Observer {\n    fn update(&self, value: i32);\n}\n\nstruct Subject {\n    observers: RefCell<Vec<Rc<dyn Observer>>>,\n    value: RefCell<i32>,\n}\n\nimpl Subject {\n    fn new() -> Self {\n        Subject {\n            observers: RefCell::new(Vec::new()),\n            value: RefCell::new(0),\n        }\n    }\n    \n    fn attach(&self, observer: Rc<dyn Observer>) {\n        self.observers.borrow_mut().push(observer);\n    }\n    \n    fn set_value(&self, value: i32) {\n        *self.value.borrow_mut() = value;\n        self.notify();\n    }\n    \n    fn notify(&self) {\n        let value = *self.value.borrow();\n        for observer in self.observers.borrow().iter() {\n            observer.update(value);\n        }\n    }\n}\n\nstruct ConcreteObserver {\n    id: i32,\n}\n\nimpl Observer for ConcreteObserver {\n    fn update(&self, value: i32) {\n        println!("\u89c2\u5bdf\u8005 {} \u6536\u5230\u66f4\u65b0: {}", self.id, value);\n    }\n}\n\nfn main() {\n    let subject = Subject::new();\n    \n    let observer1 = Rc::new(ConcreteObserver { id: 1 });\n    let observer2 = Rc::new(ConcreteObserver { id: 2 });\n    \n    subject.attach(observer1);\n    subject.attach(observer2);\n    \n    subject.set_value(42);\n    subject.set_value(100);\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsxs)(n.h3,{id:"1-\u4f18\u5148\u4f7f\u7528-boxt",children:["1. \u4f18\u5148\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"Box<T>"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"// \u597d: \u7b80\u5355\u660e\u4e86\nlet data = Box::new(vec![1, 2, 3]);\n\n// \u907f\u514d: \u4e0d\u5fc5\u8981\u7684\u590d\u6742\u6027\nuse std::rc::Rc;\nlet data = Rc::new(vec![1, 2, 3]);  // \u5982\u679c\u4e0d\u9700\u8981\u5171\u4eab\u6240\u6709\u6743\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u907f\u514d\u5faa\u73af\u5f15\u7528",children:"2. \u907f\u514d\u5faa\u73af\u5f15\u7528"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"use std::rc::{Rc, Weak};\n\n// \u597d: \u4f7f\u7528 Weak \u6253\u7834\u5faa\u73af\nstruct Node {\n    parent: Weak<Node>,  // \u5f31\u5f15\u7528\n    children: Vec<Rc<Node>>,  // \u5f3a\u5f15\u7528\n}\n\n// \u907f\u514d: \u5faa\u73af\u5f3a\u5f15\u7528\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\n// struct BadNode {\n//     parent: Rc<BadNode>,\n//     children: Vec<Rc<BadNode>>,\n// }\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u5355\u7ebf\u7a0b\u7528-rc\u591a\u7ebf\u7a0b\u7528-arc",children:"3. \u5355\u7ebf\u7a0b\u7528 Rc,\u591a\u7ebf\u7a0b\u7528 Arc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::rc::Rc;\nuse std::sync::Arc;\nuse std::thread;\n\n// \u5355\u7ebf\u7a0b\nfn single_thread() {\n    let data = Rc::new(vec![1, 2, 3]);\n}\n\n// \u591a\u7ebf\u7a0b\nfn multi_thread() {\n    let data = Arc::new(vec![1, 2, 3]);\n    \n    for i in 0..3 {\n        let data = Arc::clone(&data);\n        thread::spawn(move || {\n            println!("\u7ebf\u7a0b {}: {:?}", i, data);\n        });\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-\u8c28\u614e\u4f7f\u7528-refcell",children:"4. \u8c28\u614e\u4f7f\u7528 RefCell"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"use std::cell::RefCell;\n\n// \u597d: \u5fc5\u8981\u65f6\u4f7f\u7528\nstruct Cache {\n    data: RefCell<Vec<i32>>,\n}\n\nimpl Cache {\n    fn get_or_insert(&self) -> i32 {\n        if self.data.borrow().is_empty() {\n            self.data.borrow_mut().push(42);\n        }\n        self.data.borrow()[0]\n    }\n}\n\n// \u907f\u514d: \u80fd\u7528\u7f16\u8bd1\u65f6\u68c0\u67e5\u5c31\u4e0d\u7528\u8fd0\u884c\u65f6\u68c0\u67e5\n// let mut data = vec![1, 2, 3];  // \u66f4\u597d\n// let data = RefCell::new(vec![1, 2, 3]);  // \u4e0d\u5fc5\u8981\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u5e38\u89c1\u9519\u8bef",children:"\u5e38\u89c1\u9519\u8bef"}),"\n",(0,s.jsx)(n.h3,{id:"\u9519\u8bef1-refcell-\u501f\u7528\u51b2\u7a81",children:"\u9519\u8bef1: RefCell \u501f\u7528\u51b2\u7a81"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"use std::cell::RefCell;\n\nfn main() {\n    let x = RefCell::new(5);\n    \n    let a = x.borrow();\n    // let b = x.borrow_mut();  // panic: \u5df2\u6709\u4e0d\u53ef\u53d8\u501f\u7528\n    \n    drop(a);  // \u91ca\u653e\u501f\u7528\n    let b = x.borrow_mut();  // \u6b63\u786e\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u9519\u8bef2-\u5faa\u73af\u5f15\u7528\u5185\u5b58\u6cc4\u6f0f",children:"\u9519\u8bef2: \u5faa\u73af\u5f15\u7528\u5185\u5b58\u6cc4\u6f0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use std::rc::Rc;\nuse std::cell::RefCell;\n\n#[derive(Debug)]\nstruct Node {\n    next: RefCell<Option<Rc<Node>>>,\n}\n\nfn main() {\n    let a = Rc::new(Node { next: RefCell::new(None) });\n    let b = Rc::new(Node { next: RefCell::new(Some(Rc::clone(&a))) });\n    \n    // \u521b\u5efa\u5faa\u73af\u5f15\u7528\n    *a.next.borrow_mut() = Some(Rc::clone(&b));\n    \n    // \u5185\u5b58\u6cc4\u6f0f: a \u548c b \u7684\u5f15\u7528\u8ba1\u6570\u6c38\u8fdc\u4e0d\u4f1a\u4e3a 0\n    println!("a \u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&a));\n    println!("b \u5f15\u7528\u8ba1\u6570: {}", Rc::strong_count(&b));\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,s.jsx)(n.p,{children:"\u672c\u6587\u8be6\u7ec6\u4ecb\u7ecd\u4e86 Rust \u7684\u667a\u80fd\u6307\u9488:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.code,{children:"Box<T>"})," - \u5806\u5206\u914d,\u552f\u4e00\u6240\u6709\u6743"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.code,{children:"Rc<T>"})," - \u5355\u7ebf\u7a0b\u5f15\u7528\u8ba1\u6570,\u5171\u4eab\u6240\u6709\u6743"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.code,{children:"RefCell<T>"})," - \u5185\u90e8\u53ef\u53d8\u6027,\u8fd0\u884c\u65f6\u501f\u7528\u68c0\u67e5"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.code,{children:"Arc<T>"})," - \u591a\u7ebf\u7a0b\u5f15\u7528\u8ba1\u6570,\u539f\u5b50\u64cd\u4f5c"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.code,{children:"Weak<T>"})," - \u5f31\u5f15\u7528,\u907f\u514d\u5faa\u73af\u5f15\u7528"]}),"\n",(0,s.jsx)(n.li,{children:"\u2705 \u667a\u80fd\u6307\u9488\u9009\u62e9\u6307\u5357\u548c\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 \u5b9e\u6218\u6848\u4f8b: DOM \u6811\u3001\u89c2\u5bdf\u8005\u6a21\u5f0f"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5173\u952e\u8981\u70b9:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Box<T>"})," \u9002\u7528\u4e8e\u5806\u5206\u914d\u548c\u9012\u5f52\u7c7b\u578b"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Rc<T>"})," \u7528\u4e8e\u5355\u7ebf\u7a0b\u5171\u4eab\u6240\u6709\u6743"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Arc<T>"})," \u7528\u4e8e\u591a\u7ebf\u7a0b\u5171\u4eab\u6240\u6709\u6743"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"RefCell<T>"})," \u63d0\u4f9b\u5185\u90e8\u53ef\u53d8\u6027"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Weak<T>"})," \u907f\u514d\u5faa\u73af\u5f15\u7528\u5bfc\u81f4\u7684\u5185\u5b58\u6cc4\u6f0f"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u638c\u63e1\u667a\u80fd\u6307\u9488\u540e,\u7ee7\u7eed\u5b66\u4e60 ",(0,s.jsx)(n.a,{href:"./concurrency",children:"\u5e76\u53d1\u7f16\u7a0b"})," \u548c ",(0,s.jsx)(n.a,{href:"./lifetimes",children:"\u751f\u547d\u5468\u671f"}),"\u3002"]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);
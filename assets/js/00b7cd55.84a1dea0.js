"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[63849],{26951:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"c/memory-management","title":"\u5185\u5b58\u7ba1\u7406","description":"C \u8bed\u8a00\u5141\u8bb8\u7a0b\u5e8f\u5458\u76f4\u63a5\u7ba1\u7406\u5185\u5b58\uff0c\u8fd9\u63d0\u4f9b\u4e86\u6781\u5927\u7684\u7075\u6d3b\u6027\uff0c\u4f46\u4e5f\u9700\u8981\u8c28\u614e\u64cd\u4f5c\u3002","source":"@site/docs/c/memory-management.md","sourceDirName":"c","slug":"/c/memory-management","permalink":"/docs/c/memory-management","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/c/memory-management.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"\u5185\u5b58\u7ba1\u7406"},"sidebar":"c","previous":{"title":"\u9ad8\u7ea7\u6307\u9488","permalink":"/docs/c/advanced-pointers"},"next":{"title":"\u7ed3\u6784\u4f53\u548c\u8054\u5408\u4f53","permalink":"/docs/c/structs-unions"}}');var a=r(22714),t=r(48885);const l={sidebar_position:7,title:"\u5185\u5b58\u7ba1\u7406"},d="\u5185\u5b58\u7ba1\u7406",c={},o=[{value:"\u5185\u5b58\u5e03\u5c40",id:"\u5185\u5b58\u5e03\u5c40",level:2},{value:"\u52a8\u6001\u5185\u5b58\u5206\u914d",id:"\u52a8\u6001\u5185\u5b58\u5206\u914d",level:2},{value:"malloc",id:"malloc",level:3},{value:"calloc",id:"calloc",level:3},{value:"realloc",id:"realloc",level:3},{value:"\u52a8\u6001\u6570\u636e\u7ed3\u6784",id:"\u52a8\u6001\u6570\u636e\u7ed3\u6784",level:2},{value:"\u52a8\u6001\u6570\u7ec4",id:"\u52a8\u6001\u6570\u7ec4",level:3},{value:"\u94fe\u8868",id:"\u94fe\u8868",level:3},{value:"\u5185\u5b58\u95ee\u9898",id:"\u5185\u5b58\u95ee\u9898",level:2},{value:"\u5185\u5b58\u6cc4\u6f0f",id:"\u5185\u5b58\u6cc4\u6f0f",level:3},{value:"\u4f7f\u7528 Valgrind \u68c0\u6d4b",id:"\u4f7f\u7528-valgrind-\u68c0\u6d4b",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2}];function s(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"\u5185\u5b58\u7ba1\u7406",children:"\u5185\u5b58\u7ba1\u7406"})}),"\n",(0,a.jsx)(e.p,{children:"C \u8bed\u8a00\u5141\u8bb8\u7a0b\u5e8f\u5458\u76f4\u63a5\u7ba1\u7406\u5185\u5b58\uff0c\u8fd9\u63d0\u4f9b\u4e86\u6781\u5927\u7684\u7075\u6d3b\u6027\uff0c\u4f46\u4e5f\u9700\u8981\u8c28\u614e\u64cd\u4f5c\u3002"}),"\n",(0,a.jsx)(e.h2,{id:"\u5185\u5b58\u5e03\u5c40",children:"\u5185\u5b58\u5e03\u5c40"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"+------------------+\n|       \u6808         |  <- \u5c40\u90e8\u53d8\u91cf\u3001\u51fd\u6570\u53c2\u6570\n+------------------+\n|        \u2193         |\n|                  |\n|        \u2191         |\n+------------------+\n|       \u5806         |  <- \u52a8\u6001\u5206\u914d\u7684\u5185\u5b58\n+------------------+\n|   \u672a\u521d\u59cb\u5316\u6570\u636e   |  <- \u5168\u5c40\u53d8\u91cf\uff08\u672a\u521d\u59cb\u5316\uff09\n+------------------+\n|   \u5df2\u521d\u59cb\u5316\u6570\u636e   |  <- \u5168\u5c40\u53d8\u91cf\uff08\u5df2\u521d\u59cb\u5316\uff09\n+------------------+\n|      \u4ee3\u7801\u6bb5      |  <- \u7a0b\u5e8f\u4ee3\u7801\n+------------------+\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u52a8\u6001\u5185\u5b58\u5206\u914d",children:"\u52a8\u6001\u5185\u5b58\u5206\u914d"}),"\n",(0,a.jsx)(e.h3,{id:"malloc",children:"malloc"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n\nint main(void) {\n    // \u5206\u914d\u5355\u4e2a\u6574\u6570\n    int *p = (int*)malloc(sizeof(int));\n    if (p == NULL) {\n        printf("\u5185\u5b58\u5206\u914d\u5931\u8d25\\n");\n        return 1;\n    }\n\n    *p = 42;\n    printf("*p = %d\\n", *p);\n    free(p);\n\n    // \u5206\u914d\u6570\u7ec4\n    int n = 5;\n    int *arr = (int*)malloc(n * sizeof(int));\n    if (arr == NULL) {\n        return 1;\n    }\n\n    for (int i = 0; i < n; i++) {\n        arr[i] = i * 10;\n    }\n\n    for (int i = 0; i < n; i++) {\n        printf("arr[%d] = %d\\n", i, arr[i]);\n    }\n\n    free(arr);\n    arr = NULL;  // \u9632\u6b62\u60ac\u7a7a\u6307\u9488\n\n    return 0;\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"calloc",children:"calloc"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n\nint main(void) {\n    // calloc \u5206\u914d\u5e76\u521d\u59cb\u5316\u4e3a0\n    int n = 5;\n    int *arr = (int*)calloc(n, sizeof(int));\n\n    if (arr == NULL) {\n        return 1;\n    }\n\n    // \u6240\u6709\u5143\u7d20\u90fd\u662f0\n    printf("\u521d\u59cb\u503c: ");\n    for (int i = 0; i < n; i++) {\n        printf("%d ", arr[i]);\n    }\n    printf("\\n");\n\n    free(arr);\n    return 0;\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"realloc",children:"realloc"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n\nint main(void) {\n    int *arr = (int*)malloc(3 * sizeof(int));\n    arr[0] = 1; arr[1] = 2; arr[2] = 3;\n\n    // \u6269\u5c55\u6570\u7ec4\n    int *new_arr = (int*)realloc(arr, 5 * sizeof(int));\n    if (new_arr == NULL) {\n        free(arr);\n        return 1;\n    }\n    arr = new_arr;\n\n    arr[3] = 4;\n    arr[4] = 5;\n\n    for (int i = 0; i < 5; i++) {\n        printf("%d ", arr[i]);\n    }\n    printf("\\n");\n\n    free(arr);\n    return 0;\n}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"\u52a8\u6001\u6570\u636e\u7ed3\u6784",children:"\u52a8\u6001\u6570\u636e\u7ed3\u6784"}),"\n",(0,a.jsx)(e.h3,{id:"\u52a8\u6001\u6570\u7ec4",children:"\u52a8\u6001\u6570\u7ec4"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n\ntypedef struct {\n    int *data;\n    int size;\n    int capacity;\n} DynamicArray;\n\nDynamicArray* createArray(int capacity) {\n    DynamicArray *arr = malloc(sizeof(DynamicArray));\n    arr->data = malloc(capacity * sizeof(int));\n    arr->size = 0;\n    arr->capacity = capacity;\n    return arr;\n}\n\nvoid append(DynamicArray *arr, int value) {\n    if (arr->size >= arr->capacity) {\n        arr->capacity *= 2;\n        arr->data = realloc(arr->data, arr->capacity * sizeof(int));\n    }\n    arr->data[arr->size++] = value;\n}\n\nvoid freeArray(DynamicArray *arr) {\n    free(arr->data);\n    free(arr);\n}\n\nint main(void) {\n    DynamicArray *arr = createArray(2);\n\n    for (int i = 0; i < 10; i++) {\n        append(arr, i * 10);\n    }\n\n    printf("Size: %d, Capacity: %d\\n", arr->size, arr->capacity);\n    for (int i = 0; i < arr->size; i++) {\n        printf("%d ", arr->data[i]);\n    }\n    printf("\\n");\n\n    freeArray(arr);\n    return 0;\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"\u94fe\u8868",children:"\u94fe\u8868"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n\ntypedef struct Node {\n    int data;\n    struct Node *next;\n} Node;\n\nNode* createNode(int data) {\n    Node *node = malloc(sizeof(Node));\n    node->data = data;\n    node->next = NULL;\n    return node;\n}\n\nvoid append(Node **head, int data) {\n    Node *newNode = createNode(data);\n    if (*head == NULL) {\n        *head = newNode;\n        return;\n    }\n    Node *curr = *head;\n    while (curr->next != NULL) {\n        curr = curr->next;\n    }\n    curr->next = newNode;\n}\n\nvoid printList(Node *head) {\n    while (head != NULL) {\n        printf("%d -> ", head->data);\n        head = head->next;\n    }\n    printf("NULL\\n");\n}\n\nvoid freeList(Node *head) {\n    while (head != NULL) {\n        Node *temp = head;\n        head = head->next;\n        free(temp);\n    }\n}\n\nint main(void) {\n    Node *list = NULL;\n\n    append(&list, 10);\n    append(&list, 20);\n    append(&list, 30);\n\n    printList(list);\n    freeList(list);\n\n    return 0;\n}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"\u5185\u5b58\u95ee\u9898",children:"\u5185\u5b58\u95ee\u9898"}),"\n",(0,a.jsx)(e.h3,{id:"\u5185\u5b58\u6cc4\u6f0f",children:"\u5185\u5b58\u6cc4\u6f0f"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:"#include <stdlib.h>\n\nvoid memoryLeak(void) {\n    int *p = malloc(100 * sizeof(int));\n    // \u5fd8\u8bb0 free(p)\uff0c\u5185\u5b58\u6cc4\u6f0f\uff01\n}\n\nvoid noLeak(void) {\n    int *p = malloc(100 * sizeof(int));\n    // \u4f7f\u7528\u5185\u5b58...\n    free(p);  // \u6b63\u786e\u91ca\u653e\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u4f7f\u7528-valgrind-\u68c0\u6d4b",children:"\u4f7f\u7528 Valgrind \u68c0\u6d4b"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# \u7f16\u8bd1\ngcc -g program.c -o program\n\n# \u68c0\u6d4b\u5185\u5b58\u6cc4\u6f0f\nvalgrind --leak-check=full ./program\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.strong,{children:"\u59cb\u7ec8\u68c0\u67e5\u5206\u914d\u7ed3\u679c"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.strong,{children:"\u6bcf\u4e2a malloc \u5bf9\u5e94\u4e00\u4e2a free"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.strong,{children:"\u91ca\u653e\u540e\u5c06\u6307\u9488\u7f6e\u4e3a NULL"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.strong,{children:"\u4e0d\u8981\u91ca\u653e\u540c\u4e00\u5185\u5b58\u4e24\u6b21"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.strong,{children:"\u4f7f\u7528\u5de5\u5177\u68c0\u6d4b\u5185\u5b58\u95ee\u9898"})}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-c",children:'#include <stdio.h>\n#include <stdlib.h>\n\nint main(void) {\n    // \u5b89\u5168\u7684\u5185\u5b58\u7ba1\u7406\u6a21\u5f0f\n    int *p = malloc(sizeof(int) * 10);\n\n    if (p == NULL) {\n        fprintf(stderr, "\u5185\u5b58\u5206\u914d\u5931\u8d25\\n");\n        return 1;\n    }\n\n    // \u4f7f\u7528\u5185\u5b58\n    for (int i = 0; i < 10; i++) {\n        p[i] = i;\n    }\n\n    // \u91ca\u653e\u5e76\u7f6e\u7a7a\n    free(p);\n    p = NULL;\n\n    return 0;\n}\n'})}),"\n",(0,a.jsx)(e.p,{children:"\u638c\u63e1\u5185\u5b58\u7ba1\u7406\u540e\uff0c\u5c31\u53ef\u4ee5\u7ee7\u7eed\u5b66\u4e60\u7ed3\u6784\u4f53\u4e86\uff01"})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(s,{...n})}):s(n)}},48885:(n,e,r)=>{r.d(e,{R:()=>l,x:()=>d});var i=r(99378);const a={},t=i.createContext(a);function l(n){const e=i.useContext(t);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:l(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);
"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[62783],{48885:(e,n,c)=>{c.d(n,{R:()=>s,x:()=>d});var t=c(99378);const o={},r=t.createContext(o);function s(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(r.Provider,{value:n},e.children)}},51404:(e,n,c)=>{c.r(n),c.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>x,frontMatter:()=>s,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"docker/context","title":"Docker Context","description":"\u591a\u73af\u5883\u7ba1\u7406\u4e0e\u8fdc\u7a0b Docker \u4e3b\u673a\u5207\u6362","source":"@site/docs/docker/context.md","sourceDirName":"docker","slug":"/docker/context","permalink":"/docs/docker/context","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/docker/context.md","tags":[],"version":"current","sidebarPosition":26,"frontMatter":{"sidebar_position":26,"title":"Docker Context","description":"\u591a\u73af\u5883\u7ba1\u7406\u4e0e\u8fdc\u7a0b Docker \u4e3b\u673a\u5207\u6362"}}');var o=c(22714),r=c(48885);const s={sidebar_position:26,title:"Docker Context",description:"\u591a\u73af\u5883\u7ba1\u7406\u4e0e\u8fdc\u7a0b Docker \u4e3b\u673a\u5207\u6362"},d="Docker Context",l={},a=[{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5",level:2},{value:"\u67e5\u770b\u548c\u7ba1\u7406 Context",id:"\u67e5\u770b\u548c\u7ba1\u7406-context",level:2},{value:"\u521b\u5efa Context",id:"\u521b\u5efa-context",level:2},{value:"\u672c\u5730 Socket",id:"\u672c\u5730-socket",level:3},{value:"SSH \u8fde\u63a5",id:"ssh-\u8fde\u63a5",level:3},{value:"TCP \u8fde\u63a5\uff08\u5e26 TLS\uff09",id:"tcp-\u8fde\u63a5\u5e26-tls",level:3},{value:"\u5207\u6362 Context",id:"\u5207\u6362-context",level:2},{value:"\u8fdc\u7a0b Docker \u914d\u7f6e",id:"\u8fdc\u7a0b-docker-\u914d\u7f6e",level:2},{value:"\u670d\u52a1\u7aef\u914d\u7f6e\uff08\u8fdc\u7a0b\u4e3b\u673a\uff09",id:"\u670d\u52a1\u7aef\u914d\u7f6e\u8fdc\u7a0b\u4e3b\u673a",level:3},{value:"\u751f\u6210 TLS \u8bc1\u4e66",id:"\u751f\u6210-tls-\u8bc1\u4e66",level:3},{value:"SSH \u65b9\u5f0f\uff08\u63a8\u8350\uff09",id:"ssh-\u65b9\u5f0f\u63a8\u8350",level:2},{value:"\u524d\u63d0\u6761\u4ef6",id:"\u524d\u63d0\u6761\u4ef6",level:3},{value:"\u521b\u5efa SSH Context",id:"\u521b\u5efa-ssh-context",level:3},{value:"SSH \u914d\u7f6e\u4f18\u5316",id:"ssh-\u914d\u7f6e\u4f18\u5316",level:3},{value:"\u4e91\u670d\u52a1\u96c6\u6210",id:"\u4e91\u670d\u52a1\u96c6\u6210",level:2},{value:"AWS ECS",id:"aws-ecs",level:3},{value:"Azure ACI",id:"azure-aci",level:3},{value:"\u5b9e\u7528\u6280\u5de7",id:"\u5b9e\u7528\u6280\u5de7",level:2},{value:"\u5feb\u901f\u5207\u6362\u811a\u672c",id:"\u5feb\u901f\u5207\u6362\u811a\u672c",level:3},{value:"\u6279\u91cf\u64cd\u4f5c\u591a\u73af\u5883",id:"\u6279\u91cf\u64cd\u4f5c\u591a\u73af\u5883",level:3},{value:"Context \u5bfc\u51fa\u5bfc\u5165",id:"context-\u5bfc\u51fa\u5bfc\u5165",level:3},{value:"\u5220\u9664 Context",id:"\u5220\u9664-context",level:2}];function i(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"docker-context",children:"Docker Context"})}),"\n",(0,o.jsx)(n.p,{children:"Docker Context \u5141\u8bb8\u4f60\u7ba1\u7406\u591a\u4e2a Docker \u73af\u5883\uff0c\u8f7b\u677e\u5728\u672c\u5730\u3001\u8fdc\u7a0b\u4e3b\u673a\u3001\u4e91\u670d\u52a1\u4e4b\u95f4\u5207\u6362\u3002"}),"\n",(0,o.jsx)(n.h2,{id:"\u57fa\u672c\u6982\u5ff5",children:"\u57fa\u672c\u6982\u5ff5"}),"\n",(0,o.jsx)(n.p,{children:"Context \u5b58\u50a8\u4e86\u8fde\u63a5 Docker \u5b88\u62a4\u8fdb\u7a0b\u6240\u9700\u7684\u6240\u6709\u4fe1\u606f\uff1a"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u7aef\u70b9\u5730\u5740\uff08\u672c\u5730 socket \u6216\u8fdc\u7a0b URL\uff09"}),"\n",(0,o.jsx)(n.li,{children:"TLS \u8bc1\u4e66\u914d\u7f6e"}),"\n",(0,o.jsx)(n.li,{children:"Kubernetes \u914d\u7f6e\uff08\u53ef\u9009\uff09"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"\u67e5\u770b\u548c\u7ba1\u7406-context",children:"\u67e5\u770b\u548c\u7ba1\u7406 Context"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# \u5217\u51fa\u6240\u6709 context\ndocker context ls\n\n# \u8f93\u51fa\u793a\u4f8b\nNAME        DESCRIPTION                               DOCKER ENDPOINT\ndefault *   Current DOCKER_HOST based configuration   unix:///var/run/docker.sock\ndev         Development server                        ssh://dev@192.168.1.100\nprod        Production server                         tcp://prod.example.com:2376\n\n# \u67e5\u770b\u5f53\u524d context\ndocker context show\n\n# \u67e5\u770b context \u8be6\u60c5\ndocker context inspect default\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u521b\u5efa-context",children:"\u521b\u5efa Context"}),"\n",(0,o.jsx)(n.h3,{id:"\u672c\u5730-socket",children:"\u672c\u5730 Socket"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'docker context create local \\\n  --docker "host=unix:///var/run/docker.sock"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"ssh-\u8fde\u63a5",children:"SSH \u8fde\u63a5"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# \u57fa\u672c SSH \u8fde\u63a5\ndocker context create dev \\\n  --docker "host=ssh://user@192.168.1.100"\n\n# \u6307\u5b9a SSH \u5bc6\u94a5\ndocker context create dev \\\n  --docker "host=ssh://user@192.168.1.100" \\\n  --description "Development server"\n\n# SSH \u914d\u7f6e\u4f1a\u4f7f\u7528 ~/.ssh/config\n'})}),"\n",(0,o.jsx)(n.h3,{id:"tcp-\u8fde\u63a5\u5e26-tls",children:"TCP \u8fde\u63a5\uff08\u5e26 TLS\uff09"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'docker context create prod \\\n  --docker "host=tcp://prod.example.com:2376,ca=/path/ca.pem,cert=/path/cert.pem,key=/path/key.pem"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"\u5207\u6362-context",children:"\u5207\u6362 Context"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# \u5207\u6362\u9ed8\u8ba4 context\ndocker context use dev\n\n# \u4e34\u65f6\u4f7f\u7528\u5176\u4ed6 context\uff08\u5355\u6b21\u547d\u4ee4\uff09\ndocker --context prod ps\n\n# \u4f7f\u7528\u73af\u5883\u53d8\u91cf\nexport DOCKER_CONTEXT=prod\ndocker ps\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u8fdc\u7a0b-docker-\u914d\u7f6e",children:"\u8fdc\u7a0b Docker \u914d\u7f6e"}),"\n",(0,o.jsx)(n.h3,{id:"\u670d\u52a1\u7aef\u914d\u7f6e\u8fdc\u7a0b\u4e3b\u673a",children:"\u670d\u52a1\u7aef\u914d\u7f6e\uff08\u8fdc\u7a0b\u4e3b\u673a\uff09"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'// /etc/docker/daemon.json\n{\n  "hosts": ["unix:///var/run/docker.sock", "tcp://0.0.0.0:2376"],\n  "tls": true,\n  "tlscacert": "/etc/docker/certs/ca.pem",\n  "tlscert": "/etc/docker/certs/server-cert.pem",\n  "tlskey": "/etc/docker/certs/server-key.pem",\n  "tlsverify": true\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\u751f\u6210-tls-\u8bc1\u4e66",children:"\u751f\u6210 TLS \u8bc1\u4e66"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# \u521b\u5efa CA\nopenssl genrsa -out ca-key.pem 4096\nopenssl req -new -x509 -days 365 -key ca-key.pem -sha256 -out ca.pem\n\n# \u521b\u5efa\u670d\u52a1\u7aef\u8bc1\u4e66\nopenssl genrsa -out server-key.pem 4096\nopenssl req -subj "/CN=docker-server" -sha256 -new -key server-key.pem -out server.csr\necho "subjectAltName = DNS:docker-server,IP:192.168.1.100" > extfile.cnf\nopenssl x509 -req -days 365 -sha256 -in server.csr -CA ca.pem -CAkey ca-key.pem \\\n  -CAcreateserial -out server-cert.pem -extfile extfile.cnf\n\n# \u521b\u5efa\u5ba2\u6237\u7aef\u8bc1\u4e66\nopenssl genrsa -out key.pem 4096\nopenssl req -subj \'/CN=client\' -new -key key.pem -out client.csr\necho "extendedKeyUsage = clientAuth" > extfile-client.cnf\nopenssl x509 -req -days 365 -sha256 -in client.csr -CA ca.pem -CAkey ca-key.pem \\\n  -CAcreateserial -out cert.pem -extfile extfile-client.cnf\n'})}),"\n",(0,o.jsx)(n.h2,{id:"ssh-\u65b9\u5f0f\u63a8\u8350",children:"SSH \u65b9\u5f0f\uff08\u63a8\u8350\uff09"}),"\n",(0,o.jsx)(n.p,{children:"SSH \u65b9\u5f0f\u66f4\u7b80\u5355\u5b89\u5168\uff0c\u65e0\u9700\u914d\u7f6e TLS\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"\u524d\u63d0\u6761\u4ef6",children:"\u524d\u63d0\u6761\u4ef6"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# \u786e\u4fdd\u8fdc\u7a0b\u4e3b\u673a\u5df2\u5b89\u88c5 Docker\n# \u786e\u4fdd SSH \u5bc6\u94a5\u8ba4\u8bc1\u5df2\u914d\u7f6e\n\n# \u6d4b\u8bd5 SSH \u8fde\u63a5\nssh user@remote-host docker version\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u521b\u5efa-ssh-context",children:"\u521b\u5efa SSH Context"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'docker context create remote --docker "host=ssh://user@remote-host"\ndocker context use remote\n\n# \u73b0\u5728\u6240\u6709 docker \u547d\u4ee4\u90fd\u5728\u8fdc\u7a0b\u6267\u884c\ndocker ps\ndocker images\n'})}),"\n",(0,o.jsx)(n.h3,{id:"ssh-\u914d\u7f6e\u4f18\u5316",children:"SSH \u914d\u7f6e\u4f18\u5316"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# ~/.ssh/config\nHost docker-dev\n    HostName 192.168.1.100\n    User deploy\n    IdentityFile ~/.ssh/docker_key\n    ControlMaster auto\n    ControlPath ~/.ssh/sockets/%r@%h-%p\n    ControlPersist 600\n\n# \u4f7f\u7528 SSH \u522b\u540d\ndocker context create dev --docker "host=ssh://docker-dev"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"\u4e91\u670d\u52a1\u96c6\u6210",children:"\u4e91\u670d\u52a1\u96c6\u6210"}),"\n",(0,o.jsx)(n.h3,{id:"aws-ecs",children:"AWS ECS"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# \u5b89\u88c5 ECS \u63d2\u4ef6\u540e\ndocker context create ecs myecs --from-env\ndocker context use myecs\n\n# \u4f7f\u7528 Compose \u90e8\u7f72\u5230 ECS\ndocker compose up\n"})}),"\n",(0,o.jsx)(n.h3,{id:"azure-aci",children:"Azure ACI"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# \u767b\u5f55 Azure\ndocker login azure\n\n# \u521b\u5efa ACI context\ndocker context create aci myaci\n\n# \u90e8\u7f72\u5bb9\u5668\ndocker context use myaci\ndocker run -d -p 80:80 nginx\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u5b9e\u7528\u6280\u5de7",children:"\u5b9e\u7528\u6280\u5de7"}),"\n",(0,o.jsx)(n.h3,{id:"\u5feb\u901f\u5207\u6362\u811a\u672c",children:"\u5feb\u901f\u5207\u6362\u811a\u672c"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# ~/.bashrc \u6216 ~/.zshrc\nalias ddev='docker context use dev'\nalias dprod='docker context use prod'\nalias dlocal='docker context use default'\n\n# \u663e\u793a\u5f53\u524d context \u7684 PS1\nexport PS1='[$(docker context show)] \\w $ '\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u6279\u91cf\u64cd\u4f5c\u591a\u73af\u5883",children:"\u6279\u91cf\u64cd\u4f5c\u591a\u73af\u5883"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# deploy-all.sh\nfor ctx in dev staging prod; do\n  echo "Deploying to $ctx..."\n  docker --context $ctx compose pull\n  docker --context $ctx compose up -d\ndone\n'})}),"\n",(0,o.jsx)(n.h3,{id:"context-\u5bfc\u51fa\u5bfc\u5165",children:"Context \u5bfc\u51fa\u5bfc\u5165"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# \u5bfc\u51fa context\ndocker context export prod > prod-context.tar\n\n# \u5bfc\u5165 context\ndocker context import prod-backup prod-context.tar\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u5220\u9664-context",children:"\u5220\u9664 Context"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# \u5220\u9664 context\ndocker context rm dev\n\n# \u65e0\u6cd5\u5220\u9664\u5f53\u524d\u4f7f\u7528\u7684 context\ndocker context use default\ndocker context rm dev\n"})})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(i,{...e})}):i(e)}}}]);
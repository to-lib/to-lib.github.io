"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[28011],{21942:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"nginx/security","title":"\u5b89\u5168\u914d\u7f6e","description":"Nginx \u5b89\u5168\u52a0\u56fa\u4e0e\u9632\u62a4\u914d\u7f6e","source":"@site/docs/nginx/security.md","sourceDirName":"nginx","slug":"/nginx/security","permalink":"/docs/nginx/security","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/nginx/security.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"title":"\u5b89\u5168\u914d\u7f6e","description":"Nginx \u5b89\u5168\u52a0\u56fa\u4e0e\u9632\u62a4\u914d\u7f6e"},"sidebar":"nginx","previous":{"title":"\u65e5\u5fd7\u914d\u7f6e","permalink":"/docs/nginx/logging"},"next":{"title":"\u6027\u80fd\u4f18\u5316","permalink":"/docs/nginx/performance"}}');var l=i(22714),t=i(48885);const r={sidebar_position:8,title:"\u5b89\u5168\u914d\u7f6e",description:"Nginx \u5b89\u5168\u52a0\u56fa\u4e0e\u9632\u62a4\u914d\u7f6e"},d="\u5b89\u5168\u914d\u7f6e",c={},o=[{value:"\u5b89\u5168\u6982\u8ff0",id:"\u5b89\u5168\u6982\u8ff0",level:2},{value:"\u9690\u85cf\u7248\u672c\u4fe1\u606f",id:"\u9690\u85cf\u7248\u672c\u4fe1\u606f",level:2},{value:"\u8bbf\u95ee\u63a7\u5236",id:"\u8bbf\u95ee\u63a7\u5236",level:2},{value:"IP \u9ed1\u767d\u540d\u5355",id:"ip-\u9ed1\u767d\u540d\u5355",level:3},{value:"\u57fa\u672c\u8ba4\u8bc1",id:"\u57fa\u672c\u8ba4\u8bc1",level:3},{value:"\u5730\u7406\u4f4d\u7f6e\u9650\u5236",id:"\u5730\u7406\u4f4d\u7f6e\u9650\u5236",level:3},{value:"\u8bf7\u6c42\u9650\u5236",id:"\u8bf7\u6c42\u9650\u5236",level:2},{value:"\u9650\u5236\u8bf7\u6c42\u9891\u7387",id:"\u9650\u5236\u8bf7\u6c42\u9891\u7387",level:3},{value:"\u9650\u5236\u5e76\u53d1\u8fde\u63a5",id:"\u9650\u5236\u5e76\u53d1\u8fde\u63a5",level:3},{value:"DDoS \u9632\u62a4",id:"ddos-\u9632\u62a4",level:2},{value:"\u57fa\u7840\u9632\u62a4\u914d\u7f6e",id:"\u57fa\u7840\u9632\u62a4\u914d\u7f6e",level:3},{value:"\u9632\u6b62 Slowloris \u653b\u51fb",id:"\u9632\u6b62-slowloris-\u653b\u51fb",level:3},{value:"\u9632\u6b62 CC \u653b\u51fb",id:"\u9632\u6b62-cc-\u653b\u51fb",level:3},{value:"\u9632\u6b62\u5e38\u89c1\u653b\u51fb",id:"\u9632\u6b62\u5e38\u89c1\u653b\u51fb",level:2},{value:"\u5b89\u5168\u54cd\u5e94\u5934",id:"\u5b89\u5168\u54cd\u5e94\u5934",level:3},{value:"\u7981\u7528\u5371\u9669\u65b9\u6cd5",id:"\u7981\u7528\u5371\u9669\u65b9\u6cd5",level:3},{value:"\u7981\u6b62\u8bbf\u95ee\u654f\u611f\u6587\u4ef6",id:"\u7981\u6b62\u8bbf\u95ee\u654f\u611f\u6587\u4ef6",level:3},{value:"SQL \u6ce8\u5165\u9632\u62a4",id:"sql-\u6ce8\u5165\u9632\u62a4",level:3},{value:"WAF \u914d\u7f6e\uff08ModSecurity\uff09",id:"waf-\u914d\u7f6emodsecurity",level:2},{value:"\u5b89\u88c5 ModSecurity",id:"\u5b89\u88c5-modsecurity",level:3},{value:"\u57fa\u672c\u914d\u7f6e",id:"\u57fa\u672c\u914d\u7f6e",level:3},{value:"ModSecurity \u89c4\u5219",id:"modsecurity-\u89c4\u5219",level:3},{value:"\u8bf7\u6c42\u4f53\u5927\u5c0f\u9650\u5236",id:"\u8bf7\u6c42\u4f53\u5927\u5c0f\u9650\u5236",level:2},{value:"\u8d85\u65f6\u8bbe\u7f6e",id:"\u8d85\u65f6\u8bbe\u7f6e",level:2},{value:"SSL \u5b89\u5168\u914d\u7f6e",id:"ssl-\u5b89\u5168\u914d\u7f6e",level:2},{value:"\u5b89\u5168\u5ba1\u8ba1\u65e5\u5fd7",id:"\u5b89\u5168\u5ba1\u8ba1\u65e5\u5fd7",level:2},{value:"\u5b89\u5168\u68c0\u67e5\u6e05\u5355",id:"\u5b89\u5168\u68c0\u67e5\u6e05\u5355",level:2},{value:"\u5b8c\u6574\u5b89\u5168\u914d\u7f6e\u793a\u4f8b",id:"\u5b8c\u6574\u5b89\u5168\u914d\u7f6e\u793a\u4f8b",level:2}];function a(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",mermaid:"mermaid",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"\u5b89\u5168\u914d\u7f6e",children:"\u5b89\u5168\u914d\u7f6e"})}),"\n",(0,l.jsx)(e.h2,{id:"\u5b89\u5168\u6982\u8ff0",children:"\u5b89\u5168\u6982\u8ff0"}),"\n",(0,l.jsx)(e.p,{children:"Nginx \u5b89\u5168\u914d\u7f6e\u6d89\u53ca\u591a\u4e2a\u5c42\u9762\uff1a"}),"\n",(0,l.jsx)(e.mermaid,{value:"graph TD\n    A[Nginx \u5b89\u5168] --\x3e B[\u4f20\u8f93\u5c42\u5b89\u5168]\n    A --\x3e C[\u5e94\u7528\u5c42\u5b89\u5168]\n    A --\x3e D[\u8bbf\u95ee\u63a7\u5236]\n    A --\x3e E[\u8d44\u6e90\u9650\u5236]\n\n    B --\x3e B1[SSL/TLS]\n    B --\x3e B2[HSTS]\n\n    C --\x3e C1[\u5b89\u5168\u54cd\u5e94\u5934]\n    C --\x3e C2[WAF]\n    C --\x3e C3[\u6ce8\u5165\u9632\u62a4]\n\n    D --\x3e D1[IP \u9ed1\u767d\u540d\u5355]\n    D --\x3e D2[\u57fa\u672c\u8ba4\u8bc1]\n    D --\x3e D3[\u5730\u7406\u4f4d\u7f6e\u9650\u5236]\n\n    E --\x3e E1[\u9650\u6d41\u9650\u901f]\n    E --\x3e E2[\u8fde\u63a5\u6570\u9650\u5236]\n    E --\x3e E3[\u8bf7\u6c42\u5927\u5c0f\u9650\u5236]"}),"\n",(0,l.jsx)(e.h2,{id:"\u9690\u85cf\u7248\u672c\u4fe1\u606f",children:"\u9690\u85cf\u7248\u672c\u4fe1\u606f"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:'http {\n    # \u9690\u85cf Nginx \u7248\u672c\u53f7\n    server_tokens off;\n\n    # \u4fee\u6539 Server \u54cd\u5e94\u5934\uff08\u9700\u8981\u7b2c\u4e09\u65b9\u6a21\u5757\uff09\n    # more_set_headers "Server: MyServer";\n}\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u8bbf\u95ee\u63a7\u5236",children:"\u8bbf\u95ee\u63a7\u5236"}),"\n",(0,l.jsx)(e.h3,{id:"ip-\u9ed1\u767d\u540d\u5355",children:"IP \u9ed1\u767d\u540d\u5355"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:"# \u767d\u540d\u5355\u6a21\u5f0f\nlocation /admin/ {\n    allow 192.168.1.0/24;\n    allow 10.0.0.1;\n    deny all;\n}\n\n# \u9ed1\u540d\u5355\u6a21\u5f0f\nlocation / {\n    deny 192.168.1.100;\n    deny 10.0.0.0/8;\n    allow all;\n}\n\n# \u4f7f\u7528 geo \u6a21\u5757\u8fdb\u884c\u590d\u6742\u63a7\u5236\ngeo $blocked_ip {\n    default 0;\n    192.168.1.100 1;\n    10.0.0.0/8 1;\n}\n\nserver {\n    if ($blocked_ip) {\n        return 403;\n    }\n}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u57fa\u672c\u8ba4\u8bc1",children:"\u57fa\u672c\u8ba4\u8bc1"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:'location /protected/ {\n    auth_basic "Restricted Area";\n    auth_basic_user_file /etc/nginx/.htpasswd;\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:"\u751f\u6210\u5bc6\u7801\u6587\u4ef6\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5 htpasswd \u5de5\u5177\nsudo apt install apache2-utils\n\n# \u521b\u5efa\u5bc6\u7801\u6587\u4ef6\nsudo htpasswd -c /etc/nginx/.htpasswd username\n\n# \u6dfb\u52a0\u66f4\u591a\u7528\u6237\nsudo htpasswd /etc/nginx/.htpasswd another_user\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u5730\u7406\u4f4d\u7f6e\u9650\u5236",children:"\u5730\u7406\u4f4d\u7f6e\u9650\u5236"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:"# \u9700\u8981 ngx_http_geoip2_module\ngeoip2 /usr/share/GeoIP/GeoLite2-Country.mmdb {\n    $geoip2_country_code country iso_code;\n}\n\nmap $geoip2_country_code $allowed_country {\n    default no;\n    CN yes;\n    HK yes;\n}\n\nserver {\n    if ($allowed_country = no) {\n        return 403;\n    }\n}\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u8bf7\u6c42\u9650\u5236",children:"\u8bf7\u6c42\u9650\u5236"}),"\n",(0,l.jsx)(e.h3,{id:"\u9650\u5236\u8bf7\u6c42\u9891\u7387",children:"\u9650\u5236\u8bf7\u6c42\u9891\u7387"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:"http {\n    # \u5b9a\u4e49\u9650\u5236\u533a\u57df\uff1a\u6bcf\u79d2 10 \u4e2a\u8bf7\u6c42\n    limit_req_zone $binary_remote_addr zone=req_limit:10m rate=10r/s;\n\n    # \u6309 API key \u9650\u6d41\n    limit_req_zone $http_x_api_key zone=api_limit:10m rate=100r/s;\n\n    server {\n        location /api/ {\n            # burst=20: \u5141\u8bb8\u7a81\u53d1 20 \u4e2a\u8bf7\u6c42\n            # nodelay: \u4e0d\u5ef6\u8fdf\u5904\u7406\u7a81\u53d1\u8bf7\u6c42\n            limit_req zone=req_limit burst=20 nodelay;\n\n            # \u81ea\u5b9a\u4e49\u8d85\u9650\u54cd\u5e94\n            limit_req_status 429;\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u9650\u5236\u5e76\u53d1\u8fde\u63a5",children:"\u9650\u5236\u5e76\u53d1\u8fde\u63a5"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:"http {\n    limit_conn_zone $binary_remote_addr zone=conn_limit:10m;\n\n    # \u6309\u670d\u52a1\u5668\u9650\u5236\u603b\u8fde\u63a5\u6570\n    limit_conn_zone $server_name zone=server_limit:10m;\n\n    server {\n        # \u6bcf IP \u6700\u591a 10 \u4e2a\u8fde\u63a5\n        limit_conn conn_limit 10;\n\n        # \u670d\u52a1\u5668\u603b\u8fde\u63a5\u6570\u9650\u5236\n        limit_conn server_limit 1000;\n\n        # \u8fde\u63a5\u8d85\u9650\u72b6\u6001\u7801\n        limit_conn_status 503;\n\n        location /download/ {\n            # \u4e0b\u8f7d\u533a\u57df\u6bcf IP \u53ea\u5141\u8bb8 1 \u4e2a\u8fde\u63a5\n            limit_conn conn_limit 1;\n\n            # \u9650\u5236\u4e0b\u8f7d\u901f\u5ea6\n            limit_rate 1m;\n            limit_rate_after 10m;\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(e.h2,{id:"ddos-\u9632\u62a4",children:"DDoS \u9632\u62a4"}),"\n",(0,l.jsx)(e.h3,{id:"\u57fa\u7840\u9632\u62a4\u914d\u7f6e",children:"\u57fa\u7840\u9632\u62a4\u914d\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:"http {\n    # \u8d85\u65f6\u8bbe\u7f6e\uff08\u5feb\u901f\u91ca\u653e\u65e0\u6548\u8fde\u63a5\uff09\n    client_body_timeout 10s;\n    client_header_timeout 10s;\n    send_timeout 10s;\n\n    # \u9650\u5236\u8bf7\u6c42\u5927\u5c0f\n    client_max_body_size 10m;\n    client_body_buffer_size 128k;\n\n    # \u9650\u5236\u8bf7\u6c42\u5934\u5927\u5c0f\n    client_header_buffer_size 1k;\n    large_client_header_buffers 4 8k;\n\n    # \u5173\u95ed\u6162\u901f\u8fde\u63a5\n    reset_timedout_connection on;\n\n    # \u9650\u6d41\n    limit_req_zone $binary_remote_addr zone=ddos:10m rate=5r/s;\n\n    server {\n        location / {\n            limit_req zone=ddos burst=10 nodelay;\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u9632\u6b62-slowloris-\u653b\u51fb",children:"\u9632\u6b62 Slowloris \u653b\u51fb"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:"# \u9650\u5236\u8bf7\u6c42\u5934\u63a5\u6536\u65f6\u95f4\nclient_header_timeout 10s;\n\n# \u9650\u5236\u8bf7\u6c42\u4f53\u63a5\u6536\u65f6\u95f4\nclient_body_timeout 10s;\n\n# \u53d1\u9001\u54cd\u5e94\u8d85\u65f6\nsend_timeout 10s;\n\n# \u5feb\u901f\u91ca\u653e\u8d85\u65f6\u8fde\u63a5\nreset_timedout_connection on;\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u9632\u6b62-cc-\u653b\u51fb",children:"\u9632\u6b62 CC \u653b\u51fb"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:'http {\n    # \u57fa\u4e8e Cookie \u7684\u9650\u6d41\n    map $cookie_anti_cc $limit_key {\n        default $binary_remote_addr;\n        ~.+ "";\n    }\n\n    limit_req_zone $limit_key zone=cc_limit:10m rate=30r/m;\n\n    server {\n        location / {\n            limit_req zone=cc_limit burst=5;\n\n            # \u8bbe\u7f6e Cookie\n            add_header Set-Cookie "anti_cc=1; path=/; max-age=3600";\n        }\n    }\n}\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u9632\u6b62\u5e38\u89c1\u653b\u51fb",children:"\u9632\u6b62\u5e38\u89c1\u653b\u51fb"}),"\n",(0,l.jsx)(e.h3,{id:"\u5b89\u5168\u54cd\u5e94\u5934",children:"\u5b89\u5168\u54cd\u5e94\u5934"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:"# \u9632\u6b62\u70b9\u51fb\u52ab\u6301\nadd_header X-Frame-Options \"SAMEORIGIN\" always;\n\n# \u9632\u6b62 XSS\nadd_header X-XSS-Protection \"1; mode=block\" always;\n\n# \u9632\u6b62 MIME \u7c7b\u578b\u55c5\u63a2\nadd_header X-Content-Type-Options \"nosniff\" always;\n\n# \u5185\u5bb9\u5b89\u5168\u7b56\u7565\nadd_header Content-Security-Policy \"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;\" always;\n\n# Referrer \u7b56\u7565\nadd_header Referrer-Policy \"strict-origin-when-cross-origin\" always;\n\n# \u6743\u9650\u7b56\u7565\nadd_header Permissions-Policy \"geolocation=(), microphone=(), camera=()\" always;\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u7981\u7528\u5371\u9669\u65b9\u6cd5",children:"\u7981\u7528\u5371\u9669\u65b9\u6cd5"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:"if ($request_method !~ ^(GET|POST|HEAD)$) {\n    return 405;\n}\n\n# \u6216\u4f7f\u7528 limit_except\nlocation /api/ {\n    limit_except GET POST {\n        deny all;\n    }\n}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u7981\u6b62\u8bbf\u95ee\u654f\u611f\u6587\u4ef6",children:"\u7981\u6b62\u8bbf\u95ee\u654f\u611f\u6587\u4ef6"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:"# \u7981\u6b62\u8bbf\u95ee\u9690\u85cf\u6587\u4ef6\nlocation ~ /\\. {\n    deny all;\n    access_log off;\n    log_not_found off;\n}\n\n# \u7981\u6b62\u8bbf\u95ee\u5907\u4efd\u6587\u4ef6\nlocation ~* \\.(bak|config|sql|fla|psd|ini|log|sh|inc|swp|dist|old|~)$ {\n    deny all;\n}\n\n# \u7981\u6b62\u8bbf\u95ee\u7248\u672c\u63a7\u5236\u76ee\u5f55\nlocation ~ /\\.(git|svn|hg) {\n    deny all;\n}\n\n# \u7981\u6b62\u8bbf\u95ee\u654f\u611f\u76ee\u5f55\nlocation ~* /(uploads|temp|tmp|cache)/.*\\.(php|pl|py|jsp|sh|cgi)$ {\n    deny all;\n}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"sql-\u6ce8\u5165\u9632\u62a4",children:"SQL \u6ce8\u5165\u9632\u62a4"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:'# \u7b80\u5355\u7684 SQL \u6ce8\u5165\u68c0\u6d4b\nset $block_sql_injections 0;\nif ($query_string ~* "union.*select.*\\(") { set $block_sql_injections 1; }\nif ($query_string ~* "concat.*\\(") { set $block_sql_injections 1; }\nif ($query_string ~* "select.*from") { set $block_sql_injections 1; }\n\nif ($block_sql_injections = 1) {\n    return 403;\n}\n'})}),"\n",(0,l.jsx)(e.h2,{id:"waf-\u914d\u7f6emodsecurity",children:"WAF \u914d\u7f6e\uff08ModSecurity\uff09"}),"\n",(0,l.jsx)(e.h3,{id:"\u5b89\u88c5-modsecurity",children:"\u5b89\u88c5 ModSecurity"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# Ubuntu/Debian\nsudo apt install libmodsecurity3 libnginx-mod-modsecurity\n\n# \u6216\u7f16\u8bd1\u5b89\u88c5\ngit clone https://github.com/SpiderLabs/ModSecurity-nginx.git\n./configure --add-module=/path/to/ModSecurity-nginx ...\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u57fa\u672c\u914d\u7f6e",children:"\u57fa\u672c\u914d\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:"# \u52a0\u8f7d\u6a21\u5757\nload_module modules/ngx_http_modsecurity_module.so;\n\nhttp {\n    modsecurity on;\n    modsecurity_rules_file /etc/nginx/modsec/main.conf;\n\n    server {\n        location / {\n            # \u53ef\u4ee5\u5728 location \u7ea7\u522b\u5f00\u5173\n            modsecurity on;\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"modsecurity-\u89c4\u5219",children:"ModSecurity \u89c4\u5219"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:'# /etc/nginx/modsec/main.conf\nInclude /etc/nginx/modsec/modsecurity.conf\nInclude /etc/nginx/modsec/crs/crs-setup.conf\nInclude /etc/nginx/modsec/crs/rules/*.conf\n\n# \u81ea\u5b9a\u4e49\u89c4\u5219\nSecRule REQUEST_URI "@contains /admin" \\\n    "id:1001,phase:1,deny,status:403,msg:\'Admin access blocked\'"\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u8bf7\u6c42\u4f53\u5927\u5c0f\u9650\u5236",children:"\u8bf7\u6c42\u4f53\u5927\u5c0f\u9650\u5236"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:"client_max_body_size 10m;\nclient_body_buffer_size 128k;\n\n# \u9488\u5bf9\u4e0a\u4f20\u63a5\u53e3\u653e\u5bbd\u9650\u5236\nlocation /upload/ {\n    client_max_body_size 100m;\n}\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u8d85\u65f6\u8bbe\u7f6e",children:"\u8d85\u65f6\u8bbe\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:"# \u63a5\u6536\u8bf7\u6c42\u4f53\u8d85\u65f6\nclient_body_timeout 10s;\n\n# \u63a5\u6536\u8bf7\u6c42\u5934\u8d85\u65f6\nclient_header_timeout 10s;\n\n# \u53d1\u9001\u54cd\u5e94\u8d85\u65f6\nsend_timeout 10s;\n\n# Keep-alive \u8d85\u65f6\nkeepalive_timeout 65s;\n\n# \u4ee3\u7406\u8d85\u65f6\nproxy_connect_timeout 5s;\nproxy_read_timeout 60s;\nproxy_send_timeout 60s;\n"})}),"\n",(0,l.jsx)(e.h2,{id:"ssl-\u5b89\u5168\u914d\u7f6e",children:"SSL \u5b89\u5168\u914d\u7f6e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:'ssl_protocols TLSv1.2 TLSv1.3;\nssl_prefer_server_ciphers on;\nssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;\nssl_session_tickets off;\n\n# HSTS\nadd_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u5b89\u5168\u5ba1\u8ba1\u65e5\u5fd7",children:"\u5b89\u5168\u5ba1\u8ba1\u65e5\u5fd7"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:'# \u5b9a\u4e49\u5b89\u5168\u65e5\u5fd7\u683c\u5f0f\nlog_format security escape=json \'{\'\n    \'"time":"$time_iso8601",\'\n    \'"remote_addr":"$remote_addr",\'\n    \'"request":"$request",\'\n    \'"status":"$status",\'\n    \'"body_bytes_sent":"$body_bytes_sent",\'\n    \'"http_referer":"$http_referer",\'\n    \'"http_user_agent":"$http_user_agent",\'\n    \'"http_x_forwarded_for":"$http_x_forwarded_for",\'\n    \'"request_body":"$request_body"\'\n\'}\';\n\n# \u8bb0\u5f55\u6240\u6709\u975e 2xx/3xx \u54cd\u5e94\nmap $status $loggable {\n    ~^[23] 0;\n    default 1;\n}\n\naccess_log /var/log/nginx/security.log security if=$loggable;\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u5b89\u5168\u68c0\u67e5\u6e05\u5355",children:"\u5b89\u5168\u68c0\u67e5\u6e05\u5355"}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u68c0\u67e5\u9879"}),(0,l.jsx)(e.th,{children:"\u914d\u7f6e/\u547d\u4ee4"}),(0,l.jsx)(e.th,{children:"\u72b6\u6001"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u9690\u85cf\u7248\u672c\u53f7"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"server_tokens off"})}),(0,l.jsx)(e.td,{children:"\u2610"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"HTTPS \u5f3a\u5236"}),(0,l.jsx)(e.td,{children:"80 \u7aef\u53e3\u91cd\u5b9a\u5411\u5230 443"}),(0,l.jsx)(e.td,{children:"\u2610"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"HSTS \u542f\u7528"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"Strict-Transport-Security"})}),(0,l.jsx)(e.td,{children:"\u2610"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"TLS \u7248\u672c"}),(0,l.jsx)(e.td,{children:"\u4ec5 TLSv1.2/1.3"}),(0,l.jsx)(e.td,{children:"\u2610"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5b89\u5168\u54cd\u5e94\u5934"}),(0,l.jsx)(e.td,{children:"X-Frame-Options \u7b49"}),(0,l.jsx)(e.td,{children:"\u2610"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u8bf7\u6c42\u9650\u6d41"}),(0,l.jsxs)(e.td,{children:[(0,l.jsx)(e.code,{children:"limit_req"})," \u914d\u7f6e"]}),(0,l.jsx)(e.td,{children:"\u2610"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u8fde\u63a5\u9650\u5236"}),(0,l.jsxs)(e.td,{children:[(0,l.jsx)(e.code,{children:"limit_conn"})," \u914d\u7f6e"]}),(0,l.jsx)(e.td,{children:"\u2610"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u8bf7\u6c42\u5927\u5c0f\u9650\u5236"}),(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"client_max_body_size"})}),(0,l.jsx)(e.td,{children:"\u2610"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u8d85\u65f6\u8bbe\u7f6e"}),(0,l.jsx)(e.td,{children:"\u5408\u7406\u7684\u8d85\u65f6\u503c"}),(0,l.jsx)(e.td,{children:"\u2610"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u654f\u611f\u6587\u4ef6\u4fdd\u62a4"}),(0,l.jsx)(e.td,{children:"\u7981\u6b62\u8bbf\u95ee .git \u7b49"}),(0,l.jsx)(e.td,{children:"\u2610"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u65e5\u5fd7\u5ba1\u8ba1"}),(0,l.jsx)(e.td,{children:"\u5b89\u5168\u65e5\u5fd7\u914d\u7f6e"}),(0,l.jsx)(e.td,{children:"\u2610"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6743\u9650\u6700\u5c0f\u5316"}),(0,l.jsx)(e.td,{children:"nginx \u7528\u6237\u6743\u9650"}),(0,l.jsx)(e.td,{children:"\u2610"})]})]})]}),"\n",(0,l.jsx)(e.h2,{id:"\u5b8c\u6574\u5b89\u5168\u914d\u7f6e\u793a\u4f8b",children:"\u5b8c\u6574\u5b89\u5168\u914d\u7f6e\u793a\u4f8b"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:'http {\n    # \u9690\u85cf\u7248\u672c\n    server_tokens off;\n\n    # \u9650\u6d41\u914d\u7f6e\n    limit_req_zone $binary_remote_addr zone=req_limit:10m rate=10r/s;\n    limit_conn_zone $binary_remote_addr zone=conn_limit:10m;\n\n    # \u8d85\u65f6\u8bbe\u7f6e\n    client_body_timeout 10s;\n    client_header_timeout 10s;\n    send_timeout 10s;\n    keepalive_timeout 65s;\n\n    server {\n        listen 443 ssl http2;\n        server_name example.com;\n\n        # SSL \u914d\u7f6e\n        ssl_protocols TLSv1.2 TLSv1.3;\n        ssl_prefer_server_ciphers on;\n\n        # \u5b89\u5168\u54cd\u5e94\u5934\n        add_header X-Frame-Options "SAMEORIGIN" always;\n        add_header X-XSS-Protection "1; mode=block" always;\n        add_header X-Content-Type-Options "nosniff" always;\n        add_header Strict-Transport-Security "max-age=31536000" always;\n\n        # \u9650\u6d41\n        limit_req zone=req_limit burst=20 nodelay;\n        limit_conn conn_limit 10;\n\n        # \u8bf7\u6c42\u9650\u5236\n        client_max_body_size 10m;\n\n        # \u7981\u7528\u5371\u9669\u65b9\u6cd5\n        if ($request_method !~ ^(GET|POST|HEAD)$) {\n            return 405;\n        }\n\n        # \u7981\u6b62\u8bbf\u95ee\u654f\u611f\u6587\u4ef6\n        location ~ /\\. {\n            deny all;\n        }\n\n        location / {\n            root /var/www/html;\n        }\n    }\n}\n'})})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(a,{...n})}):a(n)}},48885:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>d});var s=i(99378);const l={},t=s.createContext(l);function r(n){const e=s.useContext(t);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:r(n.components),s.createElement(t.Provider,{value:e},n.children)}}}]);
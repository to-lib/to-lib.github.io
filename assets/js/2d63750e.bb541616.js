"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[83729],{30406:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"cpp/multithreading","title":"\u591a\u7ebf\u7a0b\u7f16\u7a0b","description":"C++11 \u5f15\u5165\u4e86\u6807\u51c6\u7ebf\u7a0b\u5e93\uff0c\u652f\u6301\u8de8\u5e73\u53f0\u591a\u7ebf\u7a0b\u7f16\u7a0b\u3002","source":"@site/docs/cpp/multithreading.md","sourceDirName":"cpp","slug":"/cpp/multithreading","permalink":"/docs/cpp/multithreading","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/cpp/multithreading.md","tags":[],"version":"current","sidebarPosition":18,"frontMatter":{"sidebar_position":18,"title":"\u591a\u7ebf\u7a0b\u7f16\u7a0b"},"sidebar":"cpp","previous":{"title":"Lambda \u8868\u8fbe\u5f0f","permalink":"/docs/cpp/lambda"},"next":{"title":"\u9884\u5904\u7406\u5668","permalink":"/docs/cpp/preprocessor"}}');var d=t(22714),s=t(48885);const r={sidebar_position:18,title:"\u591a\u7ebf\u7a0b\u7f16\u7a0b"},l="C++ \u591a\u7ebf\u7a0b\u7f16\u7a0b",c={},o=[{value:"\ud83c\udfaf std::thread",id:"-stdthread",level:2},{value:"\ud83d\udd12 \u4e92\u65a5\u9501",id:"-\u4e92\u65a5\u9501",level:2},{value:"\ud83d\udd14 \u6761\u4ef6\u53d8\u91cf",id:"-\u6761\u4ef6\u53d8\u91cf",level:2},{value:"\u269b\ufe0f \u539f\u5b50\u64cd\u4f5c",id:"\ufe0f-\u539f\u5b50\u64cd\u4f5c",level:2},{value:"\ud83d\udccb async \u548c future",id:"-async-\u548c-future",level:2},{value:"\u26a1 \u6700\u4f73\u5b9e\u8df5",id:"-\u6700\u4f73\u5b9e\u8df5",level:2}];function a(n){const e={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...n.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(e.header,{children:(0,d.jsx)(e.h1,{id:"c-\u591a\u7ebf\u7a0b\u7f16\u7a0b",children:"C++ \u591a\u7ebf\u7a0b\u7f16\u7a0b"})}),"\n",(0,d.jsx)(e.p,{children:"C++11 \u5f15\u5165\u4e86\u6807\u51c6\u7ebf\u7a0b\u5e93\uff0c\u652f\u6301\u8de8\u5e73\u53f0\u591a\u7ebf\u7a0b\u7f16\u7a0b\u3002"}),"\n",(0,d.jsx)(e.h2,{id:"-stdthread",children:"\ud83c\udfaf std::thread"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-cpp",children:'#include <thread>\n#include <iostream>\n\nvoid hello() {\n    std::cout << "Hello from thread!" << std::endl;\n}\n\nint main() {\n    std::thread t(hello);\n    t.join();  // \u7b49\u5f85\u7ebf\u7a0b\u5b8c\u6210\n\n    // Lambda\n    std::thread t2([]() {\n        std::cout << "Lambda thread" << std::endl;\n    });\n    t2.join();\n\n    // \u5e26\u53c2\u6570\n    std::thread t3([](int x) {\n        std::cout << "Value: " << x << std::endl;\n    }, 42);\n    t3.join();\n\n    return 0;\n}\n'})}),"\n",(0,d.jsx)(e.h2,{id:"-\u4e92\u65a5\u9501",children:"\ud83d\udd12 \u4e92\u65a5\u9501"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-cpp",children:"#include <mutex>\n\nstd::mutex mtx;\nint counter = 0;\n\nvoid increment() {\n    for (int i = 0; i < 1000; i++) {\n        std::lock_guard<std::mutex> lock(mtx);\n        counter++;\n    }\n}\n\n// unique_lock (\u66f4\u7075\u6d3b)\nvoid flexible() {\n    std::unique_lock<std::mutex> lock(mtx);\n    // \u53ef\u4ee5\u624b\u52a8\u89e3\u9501\n    lock.unlock();\n    // \u518d\u52a0\u9501\n    lock.lock();\n}\n\n// scoped_lock (C++17) - \u540c\u65f6\u9501\u591a\u4e2a\nstd::mutex m1, m2;\nvoid multiLock() {\n    std::scoped_lock lock(m1, m2);\n}\n"})}),"\n",(0,d.jsx)(e.h2,{id:"-\u6761\u4ef6\u53d8\u91cf",children:"\ud83d\udd14 \u6761\u4ef6\u53d8\u91cf"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-cpp",children:'#include <condition_variable>\n\nstd::mutex mtx;\nstd::condition_variable cv;\nbool ready = false;\n\nvoid worker() {\n    std::unique_lock<std::mutex> lock(mtx);\n    cv.wait(lock, [] { return ready; });\n    std::cout << "Worker running" << std::endl;\n}\n\nvoid signal() {\n    {\n        std::lock_guard<std::mutex> lock(mtx);\n        ready = true;\n    }\n    cv.notify_one();  // \u6216 notify_all()\n}\n'})}),"\n",(0,d.jsx)(e.h2,{id:"\ufe0f-\u539f\u5b50\u64cd\u4f5c",children:"\u269b\ufe0f \u539f\u5b50\u64cd\u4f5c"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-cpp",children:"#include <atomic>\n\nstd::atomic<int> counter{0};\n\nvoid increment() {\n    for (int i = 0; i < 1000; i++) {\n        counter++;  // \u539f\u5b50\u64cd\u4f5c\n    }\n}\n\n// \u539f\u5b50\u6807\u5fd7\nstd::atomic_flag flag = ATOMIC_FLAG_INIT;\n"})}),"\n",(0,d.jsx)(e.h2,{id:"-async-\u548c-future",children:"\ud83d\udccb async \u548c future"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-cpp",children:"#include <future>\n\nint compute() {\n    return 42;\n}\n\nint main() {\n    // \u5f02\u6b65\u6267\u884c\n    std::future<int> result = std::async(std::launch::async, compute);\n\n    // \u83b7\u53d6\u7ed3\u679c\uff08\u963b\u585e\uff09\n    int value = result.get();\n\n    // promise\n    std::promise<int> prom;\n    std::future<int> fut = prom.get_future();\n\n    std::thread t([&prom]() {\n        prom.set_value(100);\n    });\n\n    std::cout << fut.get() << std::endl;\n    t.join();\n\n    return 0;\n}\n"})}),"\n",(0,d.jsx)(e.h2,{id:"-\u6700\u4f73\u5b9e\u8df5",children:"\u26a1 \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u4f7f\u7528 lock_guard/scoped_lock"})," - \u81ea\u52a8\u7ba1\u7406\u9501"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u907f\u514d\u6b7b\u9501"})," - \u7edf\u4e00\u9501\u987a\u5e8f"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c"})," - \u7b80\u5355\u8ba1\u6570\u5668"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u4f7f\u7528 async"})," - \u7b80\u5316\u5f02\u6b65\u7f16\u7a0b"]}),"\n",(0,d.jsxs)(e.li,{children:[(0,d.jsx)(e.strong,{children:"\u6700\u5c0f\u5316\u4e34\u754c\u533a"})," - \u63d0\u9ad8\u5e76\u53d1\u6027\u80fd"]}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,d.jsx)(e,{...n,children:(0,d.jsx)(a,{...n})}):a(n)}},48885:(n,e,t)=>{t.d(e,{R:()=>r,x:()=>l});var i=t(99378);const d={},s=i.createContext(d);function r(n){const e=i.useContext(s);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(d):n.components||d:r(n.components),i.createElement(s.Provider,{value:e},n.children)}}}]);
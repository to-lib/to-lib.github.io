"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[9650],{30384:(n,e,E)=>{E.r(e),E.d(e,{assets:()=>d,contentTitle:()=>i,default:()=>o,frontMatter:()=>s,metadata:()=>N,toc:()=>t});const N=JSON.parse('{"id":"mysql/practical-examples","title":"\u5b9e\u6218\u6848\u4f8b","description":"[!TIP] > \u5b9e\u6218\u6f14\u7ec3: \u672c\u6587\u6863\u901a\u8fc7\u5b9e\u9645\u9879\u76ee\u6848\u4f8b\uff0c\u5c55\u793a MySQL \u5728\u4e0d\u540c\u4e1a\u52a1\u573a\u666f\u4e0b\u7684\u5e94\u7528\u548c\u6700\u4f73\u5b9e\u8df5\u3002","source":"@site/docs/mysql/practical-examples.md","sourceDirName":"mysql","slug":"/mysql/practical-examples","permalink":"/docs/mysql/practical-examples","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/mysql/practical-examples.md","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12,"title":"\u5b9e\u6218\u6848\u4f8b"},"sidebar":"mysql","previous":{"title":"\u6700\u4f73\u5b9e\u8df5","permalink":"/docs/mysql/best-practices"},"next":{"title":"\u5feb\u901f\u53c2\u8003","permalink":"/docs/mysql/quick-reference"}}');var T=E(22714),r=E(48885);const s={sidebar_position:12,title:"\u5b9e\u6218\u6848\u4f8b"},i="MySQL \u5b9e\u6218\u6848\u4f8b",d={},t=[{value:"\u7528\u6237\u7cfb\u7edf\u8bbe\u8ba1",id:"\u7528\u6237\u7cfb\u7edf\u8bbe\u8ba1",level:2},{value:"\u9700\u6c42\u5206\u6790",id:"\u9700\u6c42\u5206\u6790",level:3},{value:"\u6570\u636e\u5e93\u8bbe\u8ba1",id:"\u6570\u636e\u5e93\u8bbe\u8ba1",level:3},{value:"\u5e38\u7528\u67e5\u8be2",id:"\u5e38\u7528\u67e5\u8be2",level:3},{value:"\u7535\u5546\u8ba2\u5355\u7cfb\u7edf",id:"\u7535\u5546\u8ba2\u5355\u7cfb\u7edf",level:2},{value:"\u9700\u6c42\u5206\u6790",id:"\u9700\u6c42\u5206\u6790-1",level:3},{value:"\u6570\u636e\u5e93\u8bbe\u8ba1",id:"\u6570\u636e\u5e93\u8bbe\u8ba1-1",level:3},{value:"\u521b\u5efa\u8ba2\u5355\uff08\u5e26\u4e8b\u52a1\uff09",id:"\u521b\u5efa\u8ba2\u5355\u5e26\u4e8b\u52a1",level:3},{value:"\u8ba2\u5355\u7edf\u8ba1\u67e5\u8be2",id:"\u8ba2\u5355\u7edf\u8ba1\u67e5\u8be2",level:3},{value:"\u535a\u5ba2\u7cfb\u7edf\u8bbe\u8ba1",id:"\u535a\u5ba2\u7cfb\u7edf\u8bbe\u8ba1",level:2},{value:"\u6570\u636e\u5e93\u8bbe\u8ba1",id:"\u6570\u636e\u5e93\u8bbe\u8ba1-2",level:3},{value:"\u5e38\u7528\u67e5\u8be2",id:"\u5e38\u7528\u67e5\u8be2-1",level:3},{value:"\u5206\u5e93\u5206\u8868\u5b9e\u6218",id:"\u5206\u5e93\u5206\u8868\u5b9e\u6218",level:2},{value:"\u573a\u666f\uff1a\u8ba2\u5355\u8868\u6570\u636e\u91cf\u8fc7\u5927",id:"\u573a\u666f\u8ba2\u5355\u8868\u6570\u636e\u91cf\u8fc7\u5927",level:3},{value:"\u6c34\u5e73\u5206\u8868\u65b9\u6848",id:"\u6c34\u5e73\u5206\u8868\u65b9\u6848",level:3},{value:"\u5e94\u7528\u5c42\u8def\u7531",id:"\u5e94\u7528\u5c42\u8def\u7531",level:3},{value:"\u4e3b\u4ece\u590d\u5236\u4e0e\u8bfb\u5199\u5206\u79bb",id:"\u4e3b\u4ece\u590d\u5236\u4e0e\u8bfb\u5199\u5206\u79bb",level:2},{value:"\u914d\u7f6e\u4e3b\u4ece\u590d\u5236",id:"\u914d\u7f6e\u4e3b\u4ece\u590d\u5236",level:3},{value:"\u5e94\u7528\u5c42\u8bfb\u5199\u5206\u79bb",id:"\u5e94\u7528\u5c42\u8bfb\u5199\u5206\u79bb",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function a(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(e.header,{children:(0,T.jsx)(e.h1,{id:"mysql-\u5b9e\u6218\u6848\u4f8b",children:"MySQL \u5b9e\u6218\u6848\u4f8b"})}),"\n",(0,T.jsxs)(e.blockquote,{children:["\n",(0,T.jsxs)(e.p,{children:["[!TIP] > ",(0,T.jsx)(e.strong,{children:"\u5b9e\u6218\u6f14\u7ec3"}),": \u672c\u6587\u6863\u901a\u8fc7\u5b9e\u9645\u9879\u76ee\u6848\u4f8b\uff0c\u5c55\u793a MySQL \u5728\u4e0d\u540c\u4e1a\u52a1\u573a\u666f\u4e0b\u7684\u5e94\u7528\u548c\u6700\u4f73\u5b9e\u8df5\u3002"]}),"\n"]}),"\n",(0,T.jsx)(e.h2,{id:"\u7528\u6237\u7cfb\u7edf\u8bbe\u8ba1",children:"\u7528\u6237\u7cfb\u7edf\u8bbe\u8ba1"}),"\n",(0,T.jsx)(e.h3,{id:"\u9700\u6c42\u5206\u6790",children:"\u9700\u6c42\u5206\u6790"}),"\n",(0,T.jsx)(e.p,{children:"\u8bbe\u8ba1\u4e00\u4e2a\u652f\u6301\u7528\u6237\u6ce8\u518c\u3001\u767b\u5f55\u3001\u6743\u9650\u7ba1\u7406\u7684\u7528\u6237\u7cfb\u7edf\u3002"}),"\n",(0,T.jsx)(e.h3,{id:"\u6570\u636e\u5e93\u8bbe\u8ba1",children:"\u6570\u636e\u5e93\u8bbe\u8ba1"}),"\n",(0,T.jsx)(e.pre,{children:(0,T.jsx)(e.code,{className:"language-sql",children:"-- \u7528\u6237\u8868\nCREATE TABLE users (\n    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '\u7528\u6237ID',\n    username VARCHAR(50) NOT NULL UNIQUE COMMENT '\u7528\u6237\u540d',\n    email VARCHAR(100) NOT NULL UNIQUE COMMENT '\u90ae\u7bb1',\n    password_hash VARCHAR(255) NOT NULL COMMENT '\u5bc6\u7801\u54c8\u5e0c',\n    phone VARCHAR(20) COMMENT '\u624b\u673a\u53f7',\n    avatar_url VARCHAR(255) COMMENT '\u5934\u50cfURL',\n    status TINYINT NOT NULL DEFAULT 1 COMMENT '\u72b6\u6001: 1-\u6b63\u5e38 2-\u7981\u7528',\n    last_login_at TIMESTAMP NULL COMMENT '\u6700\u540e\u767b\u5f55\u65f6\u95f4',\n    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '\u66f4\u65b0\u65f6\u95f4',\n    INDEX idx_email (email),\n    INDEX idx_phone (phone),\n    INDEX idx_status (status)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='\u7528\u6237\u8868';\n\n-- \u89d2\u8272\u8868\nCREATE TABLE roles (\n    id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '\u89d2\u8272ID',\n    name VARCHAR(50) NOT NULL UNIQUE COMMENT '\u89d2\u8272\u540d\u79f0',\n    description VARCHAR(255) COMMENT '\u89d2\u8272\u63cf\u8ff0',\n    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4'\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='\u89d2\u8272\u8868';\n\n-- \u6743\u9650\u8868\nCREATE TABLE permissions (\n    id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '\u6743\u9650ID',\n    name VARCHAR(50) NOT NULL UNIQUE COMMENT '\u6743\u9650\u540d\u79f0',\n    resource VARCHAR(100) NOT NULL COMMENT '\u8d44\u6e90',\n    action VARCHAR(50) NOT NULL COMMENT '\u64cd\u4f5c',\n    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n    INDEX idx_resource (resource)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='\u6743\u9650\u8868';\n\n-- \u7528\u6237\u89d2\u8272\u5173\u8054\u8868\nCREATE TABLE user_roles (\n    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,\n    user_id BIGINT UNSIGNED NOT NULL COMMENT '\u7528\u6237ID',\n    role_id INT UNSIGNED NOT NULL COMMENT '\u89d2\u8272ID',\n    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n    UNIQUE KEY uk_user_role (user_id, role_id),\n    INDEX idx_user_id (user_id),\n    INDEX idx_role_id (role_id),\n    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='\u7528\u6237\u89d2\u8272\u5173\u8054\u8868';\n\n-- \u89d2\u8272\u6743\u9650\u5173\u8054\u8868\nCREATE TABLE role_permissions (\n    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,\n    role_id INT UNSIGNED NOT NULL COMMENT '\u89d2\u8272ID',\n    permission_id INT UNSIGNED NOT NULL COMMENT '\u6743\u9650ID',\n    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n    UNIQUE KEY uk_role_permission (role_id, permission_id),\n    INDEX idx_role_id (role_id),\n    INDEX idx_permission_id (permission_id),\n    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,\n    FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='\u89d2\u8272\u6743\u9650\u5173\u8054\u8868';\n"})}),"\n",(0,T.jsx)(e.h3,{id:"\u5e38\u7528\u67e5\u8be2",children:"\u5e38\u7528\u67e5\u8be2"}),"\n",(0,T.jsx)(e.pre,{children:(0,T.jsx)(e.code,{className:"language-sql",children:"-- \u7528\u6237\u6ce8\u518c\nINSERT INTO users (username, email, password_hash, phone)\nVALUES ('zhangsan', 'zhangsan@example.com', '$2a$10$...', '13800138000');\n\n-- \u7528\u6237\u767b\u5f55\u9a8c\u8bc1\nSELECT id, username, password_hash, status\nFROM users\nWHERE email = 'zhangsan@example.com' AND status = 1;\n\n-- \u5206\u914d\u89d2\u8272\nINSERT INTO user_roles (user_id, role_id) VALUES (1, 2);\n\n-- \u67e5\u8be2\u7528\u6237\u7684\u6240\u6709\u6743\u9650\nSELECT DISTINCT p.name, p.resource, p.action\nFROM users u\nINNER JOIN user_roles ur ON u.id = ur.user_id\nINNER JOIN roles r ON ur.role_id = r.id\nINNER JOIN role_permissions rp ON r.id = rp.role_id\nINNER JOIN permissions p ON rp.permission_id = p.id\nWHERE u.id = 1;\n\n-- \u68c0\u67e5\u7528\u6237\u662f\u5426\u6709\u7279\u5b9a\u6743\u9650\nSELECT COUNT(*) > 0 AS has_permission\nFROM users u\nINNER JOIN user_roles ur ON u.id = ur.user_id\nINNER JOIN role_permissions rp ON ur.role_id = rp.role_id\nINNER JOIN permissions p ON rp.permission_id = p.id\nWHERE u.id = 1 AND p.resource = 'articles' AND p.action = 'create';\n"})}),"\n",(0,T.jsx)(e.h2,{id:"\u7535\u5546\u8ba2\u5355\u7cfb\u7edf",children:"\u7535\u5546\u8ba2\u5355\u7cfb\u7edf"}),"\n",(0,T.jsx)(e.h3,{id:"\u9700\u6c42\u5206\u6790-1",children:"\u9700\u6c42\u5206\u6790"}),"\n",(0,T.jsx)(e.p,{children:"\u8bbe\u8ba1\u4e00\u4e2a\u652f\u6301\u5546\u54c1\u3001\u8ba2\u5355\u3001\u652f\u4ed8\u7684\u7535\u5546\u7cfb\u7edf\u3002"}),"\n",(0,T.jsx)(e.h3,{id:"\u6570\u636e\u5e93\u8bbe\u8ba1-1",children:"\u6570\u636e\u5e93\u8bbe\u8ba1"}),"\n",(0,T.jsx)(e.pre,{children:(0,T.jsx)(e.code,{className:"language-sql",children:"-- \u5546\u54c1\u8868\nCREATE TABLE products (\n    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '\u5546\u54c1ID',\n    name VARCHAR(200) NOT NULL COMMENT '\u5546\u54c1\u540d\u79f0',\n    description TEXT COMMENT '\u5546\u54c1\u63cf\u8ff0',\n    price DECIMAL(10,2) NOT NULL COMMENT '\u4ef7\u683c',\n    stock INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '\u5e93\u5b58',\n    category_id INT UNSIGNED COMMENT '\u5206\u7c7bID',\n    status TINYINT NOT NULL DEFAULT 1 COMMENT '\u72b6\u6001: 1-\u4e0a\u67b6 2-\u4e0b\u67b6',\n    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '\u66f4\u65b0\u65f6\u95f4',\n    INDEX idx_category (category_id),\n    INDEX idx_status (status),\n    INDEX idx_name (name(50))\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='\u5546\u54c1\u8868';\n\n-- \u8ba2\u5355\u8868\nCREATE TABLE orders (\n    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '\u8ba2\u5355ID',\n    order_no VARCHAR(32) NOT NULL UNIQUE COMMENT '\u8ba2\u5355\u53f7',\n    user_id BIGINT UNSIGNED NOT NULL COMMENT '\u7528\u6237ID',\n    total_amount DECIMAL(10,2) NOT NULL COMMENT '\u8ba2\u5355\u603b\u91d1\u989d',\n    status TINYINT NOT NULL DEFAULT 1 COMMENT '\u8ba2\u5355\u72b6\u6001: 1-\u5f85\u652f\u4ed8 2-\u5df2\u652f\u4ed8 3-\u5df2\u53d1\u8d27 4-\u5df2\u5b8c\u6210 5-\u5df2\u53d6\u6d88',\n    payment_method TINYINT COMMENT '\u652f\u4ed8\u65b9\u5f0f: 1-\u652f\u4ed8\u5b9d 2-\u5fae\u4fe1 3-\u94f6\u884c\u5361',\n    paid_at TIMESTAMP NULL COMMENT '\u652f\u4ed8\u65f6\u95f4',\n    shipped_at TIMESTAMP NULL COMMENT '\u53d1\u8d27\u65f6\u95f4',\n    completed_at TIMESTAMP NULL COMMENT '\u5b8c\u6210\u65f6\u95f4',\n    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '\u66f4\u65b0\u65f6\u95f4',\n    INDEX idx_order_no (order_no),\n    INDEX idx_user_id (user_id),\n    INDEX idx_status (status),\n    INDEX idx_created_at (created_at)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='\u8ba2\u5355\u8868';\n\n-- \u8ba2\u5355\u660e\u7ec6\u8868\nCREATE TABLE order_items (\n    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '\u660e\u7ec6ID',\n    order_id BIGINT UNSIGNED NOT NULL COMMENT '\u8ba2\u5355ID',\n    product_id BIGINT UNSIGNED NOT NULL COMMENT '\u5546\u54c1ID',\n    product_name VARCHAR(200) NOT NULL COMMENT '\u5546\u54c1\u540d\u79f0',\n    price DECIMAL(10,2) NOT NULL COMMENT '\u5546\u54c1\u4ef7\u683c',\n    quantity INT UNSIGNED NOT NULL COMMENT '\u8d2d\u4e70\u6570\u91cf',\n    subtotal DECIMAL(10,2) NOT NULL COMMENT '\u5c0f\u8ba1',\n    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n    INDEX idx_order_id (order_id),\n    INDEX idx_product_id (product_id),\n    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='\u8ba2\u5355\u660e\u7ec6\u8868';\n"})}),"\n",(0,T.jsx)(e.h3,{id:"\u521b\u5efa\u8ba2\u5355\u5e26\u4e8b\u52a1",children:"\u521b\u5efa\u8ba2\u5355\uff08\u5e26\u4e8b\u52a1\uff09"}),"\n",(0,T.jsx)(e.pre,{children:(0,T.jsx)(e.code,{className:"language-sql",children:"START TRANSACTION;\n\n-- 1. \u521b\u5efa\u8ba2\u5355\nINSERT INTO orders (order_no, user_id, total_amount, status)\nVALUES ('ORD20251210001', 1, 299.00, 1);\n\nSET @order_id = LAST_INSERT_ID();\n\n-- 2. \u6dfb\u52a0\u8ba2\u5355\u660e\u7ec6\nINSERT INTO order_items (order_id, product_id, product_name, price, quantity, subtotal)\nVALUES\n    (@order_id, 101, 'iPhone 15', 5999.00, 1, 5999.00),\n    (@order_id, 102, 'AirPods Pro', 1999.00, 1, 1999.00);\n\n-- 3. \u6263\u51cf\u5e93\u5b58\nUPDATE products SET stock = stock - 1 WHERE id = 101 AND stock >= 1;\nUPDATE products SET stock = stock - 1 WHERE id = 102 AND stock >= 1;\n\n-- 4. \u68c0\u67e5\u5e93\u5b58\u662f\u5426\u5145\u8db3\nSELECT COUNT(*) INTO @stock_ok FROM products\nWHERE id IN (101, 102) AND stock >= 0;\n\nIF @stock_ok = 2 THEN\n    COMMIT;\nELSE\n    ROLLBACK;\nEND IF;\n"})}),"\n",(0,T.jsx)(e.h3,{id:"\u8ba2\u5355\u7edf\u8ba1\u67e5\u8be2",children:"\u8ba2\u5355\u7edf\u8ba1\u67e5\u8be2"}),"\n",(0,T.jsx)(e.pre,{children:(0,T.jsx)(e.code,{className:"language-sql",children:"-- \u6bcf\u65e5\u8ba2\u5355\u7edf\u8ba1\nSELECT\n    DATE(created_at) AS order_date,\n    COUNT(*) AS order_count,\n    SUM(total_amount) AS total_sales,\n    AVG(total_amount) AS avg_order_value\nFROM orders\nWHERE status IN (2, 3, 4)  -- \u5df2\u652f\u4ed8\u3001\u5df2\u53d1\u8d27\u3001\u5df2\u5b8c\u6210\n  AND created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)\nGROUP BY DATE(created_at)\nORDER BY order_date DESC;\n\n-- \u70ed\u9500\u5546\u54c1 TOP 10\nSELECT\n    p.id,\n    p.name,\n    SUM(oi.quantity) AS total_sold,\n    SUM(oi.subtotal) AS total_revenue\nFROM products p\nINNER JOIN order_items oi ON p.id = oi.product_id\nINNER JOIN orders o ON oi.order_id = o.id\nWHERE o.status IN (2, 3, 4)\n  AND o.created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)\nGROUP BY p.id, p.name\nORDER BY total_sold DESC\nLIMIT 10;\n"})}),"\n",(0,T.jsx)(e.h2,{id:"\u535a\u5ba2\u7cfb\u7edf\u8bbe\u8ba1",children:"\u535a\u5ba2\u7cfb\u7edf\u8bbe\u8ba1"}),"\n",(0,T.jsx)(e.h3,{id:"\u6570\u636e\u5e93\u8bbe\u8ba1-2",children:"\u6570\u636e\u5e93\u8bbe\u8ba1"}),"\n",(0,T.jsx)(e.pre,{children:(0,T.jsx)(e.code,{className:"language-sql",children:"-- \u6587\u7ae0\u8868\nCREATE TABLE posts (\n    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '\u6587\u7ae0ID',\n    user_id BIGINT UNSIGNED NOT NULL COMMENT '\u4f5c\u8005ID',\n    title VARCHAR(200) NOT NULL COMMENT '\u6807\u9898',\n    content LONGTEXT NOT NULL COMMENT '\u5185\u5bb9',\n    summary VARCHAR(500) COMMENT '\u6458\u8981',\n    cover_image VARCHAR(255) COMMENT '\u5c01\u9762\u56fe',\n    view_count INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '\u6d4f\u89c8\u91cf',\n    like_count INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '\u70b9\u8d5e\u6570',\n    comment_count INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '\u8bc4\u8bba\u6570',\n    status TINYINT NOT NULL DEFAULT 1 COMMENT '\u72b6\u6001: 1-\u8349\u7a3f 2-\u5df2\u53d1\u5e03 3-\u5df2\u5220\u9664',\n    published_at TIMESTAMP NULL COMMENT '\u53d1\u5e03\u65f6\u95f4',\n    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '\u66f4\u65b0\u65f6\u95f4',\n    INDEX idx_user_id (user_id),\n    INDEX idx_status (status),\n    INDEX idx_published_at (published_at),\n    FULLTEXT INDEX ft_title_content (title, content)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='\u6587\u7ae0\u8868';\n\n-- \u6807\u7b7e\u8868\nCREATE TABLE tags (\n    id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '\u6807\u7b7eID',\n    name VARCHAR(50) NOT NULL UNIQUE COMMENT '\u6807\u7b7e\u540d\u79f0',\n    post_count INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '\u6587\u7ae0\u6570',\n    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4'\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='\u6807\u7b7e\u8868';\n\n-- \u6587\u7ae0\u6807\u7b7e\u5173\u8054\u8868\nCREATE TABLE post_tags (\n    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,\n    post_id BIGINT UNSIGNED NOT NULL COMMENT '\u6587\u7ae0ID',\n    tag_id INT UNSIGNED NOT NULL COMMENT '\u6807\u7b7eID',\n    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n    UNIQUE KEY uk_post_tag (post_id, tag_id),\n    INDEX idx_post_id (post_id),\n    INDEX idx_tag_id (tag_id),\n    FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE,\n    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='\u6587\u7ae0\u6807\u7b7e\u5173\u8054\u8868';\n\n-- \u8bc4\u8bba\u8868\nCREATE TABLE comments (\n    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '\u8bc4\u8bbaID',\n    post_id BIGINT UNSIGNED NOT NULL COMMENT '\u6587\u7ae0ID',\n    user_id BIGINT UNSIGNED NOT NULL COMMENT '\u7528\u6237ID',\n    parent_id BIGINT UNSIGNED COMMENT '\u7236\u8bc4\u8bbaID',\n    content TEXT NOT NULL COMMENT '\u8bc4\u8bba\u5185\u5bb9',\n    like_count INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '\u70b9\u8d5e\u6570',\n    status TINYINT NOT NULL DEFAULT 1 COMMENT '\u72b6\u6001: 1-\u6b63\u5e38 2-\u5df2\u5220\u9664',\n    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '\u521b\u5efa\u65f6\u95f4',\n    INDEX idx_post_id (post_id),\n    INDEX idx_user_id (user_id),\n    INDEX idx_parent_id (parent_id),\n    FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='\u8bc4\u8bba\u8868';\n"})}),"\n",(0,T.jsx)(e.h3,{id:"\u5e38\u7528\u67e5\u8be2-1",children:"\u5e38\u7528\u67e5\u8be2"}),"\n",(0,T.jsx)(e.pre,{children:(0,T.jsx)(e.code,{className:"language-sql",children:"-- \u83b7\u53d6\u6587\u7ae0\u5217\u8868\uff08\u5e26\u5206\u9875\uff09\nSELECT\n    p.id,\n    p.title,\n    p.summary,\n    p.cover_image,\n    p.view_count,\n    p.like_count,\n    p.comment_count,\n    p.published_at,\n    u.username AS author\nFROM posts p\nINNER JOIN users u ON p.user_id = u.id\nWHERE p.status = 2  -- \u5df2\u53d1\u5e03\nORDER BY p.published_at DESC\nLIMIT 20 OFFSET 0;\n\n-- \u83b7\u53d6\u6587\u7ae0\u8be6\u60c5\uff08\u5e26\u6807\u7b7e\uff09\nSELECT\n    p.*,\n    u.username AS author,\n    GROUP_CONCAT(t.name) AS tags\nFROM posts p\nINNER JOIN users u ON p.user_id = u.id\nLEFT JOIN post_tags pt ON p.id = pt.post_id\nLEFT JOIN tags t ON pt.tag_id = t.id\nWHERE p.id = 1 AND p.status = 2\nGROUP BY p.id;\n\n-- \u589e\u52a0\u6d4f\u89c8\u91cf\uff08\u975e\u4e8b\u52a1\uff09\nUPDATE posts SET view_count = view_count + 1 WHERE id = 1;\n\n-- \u5168\u6587\u641c\u7d22\nSELECT id, title, summary\nFROM posts\nWHERE MATCH(title, content) AGAINST('MySQL \u4f18\u5316' IN NATURAL LANGUAGE MODE)\n  AND status = 2\nLIMIT 20;\n\n-- \u70ed\u95e8\u6807\u7b7e TOP 10\nSELECT t.name, t.post_count\nFROM tags t\nORDER BY t.post_count DESC\nLIMIT 10;\n"})}),"\n",(0,T.jsx)(e.h2,{id:"\u5206\u5e93\u5206\u8868\u5b9e\u6218",children:"\u5206\u5e93\u5206\u8868\u5b9e\u6218"}),"\n",(0,T.jsx)(e.h3,{id:"\u573a\u666f\u8ba2\u5355\u8868\u6570\u636e\u91cf\u8fc7\u5927",children:"\u573a\u666f\uff1a\u8ba2\u5355\u8868\u6570\u636e\u91cf\u8fc7\u5927"}),"\n",(0,T.jsx)(e.p,{children:"\u5f53\u8ba2\u5355\u8868\u6570\u636e\u8d85\u8fc7\u5343\u4e07\u7ea7\u522b\u65f6\uff0c\u9700\u8981\u8fdb\u884c\u5206\u8868\u3002"}),"\n",(0,T.jsx)(e.h3,{id:"\u6c34\u5e73\u5206\u8868\u65b9\u6848",children:"\u6c34\u5e73\u5206\u8868\u65b9\u6848"}),"\n",(0,T.jsx)(e.pre,{children:(0,T.jsx)(e.code,{className:"language-sql",children:"-- \u6309\u8ba2\u5355ID\u8fdb\u884c\u54c8\u5e0c\u5206\u8868\uff084\u5f20\u8868\uff09\nCREATE TABLE orders_0 LIKE orders;\nCREATE TABLE orders_1 LIKE orders;\nCREATE TABLE orders_2 LIKE orders;\nCREATE TABLE orders_3 LIKE orders;\n\n-- \u8def\u7531\u89c4\u5219\uff1aorder_id % 4\n-- order_id = 1 -> orders_1\n-- order_id = 2 -> orders_2\n-- order_id = 3 -> orders_3\n-- order_id = 4 -> orders_0\n"})}),"\n",(0,T.jsx)(e.h3,{id:"\u5e94\u7528\u5c42\u8def\u7531",children:"\u5e94\u7528\u5c42\u8def\u7531"}),"\n",(0,T.jsx)(e.pre,{children:(0,T.jsx)(e.code,{className:"language-java",children:'public class OrderShardingStrategy {\n    private static final int SHARD_COUNT = 4;\n\n    public String getTableName(Long orderId) {\n        int shardIndex = (int)(orderId % SHARD_COUNT);\n        return "orders_" + shardIndex;\n    }\n\n    public void insertOrder(Order order) {\n        String tableName = getTableName(order.getId());\n        String sql = "INSERT INTO " + tableName + " ...";\n        // \u6267\u884c\u63d2\u5165\n    }\n\n    public Order getOrder(Long orderId) {\n        String tableName = getTableName(orderId);\n        String sql = "SELECT * FROM " + tableName + " WHERE id = ?";\n        // \u6267\u884c\u67e5\u8be2\n    }\n}\n'})}),"\n",(0,T.jsx)(e.h2,{id:"\u4e3b\u4ece\u590d\u5236\u4e0e\u8bfb\u5199\u5206\u79bb",children:"\u4e3b\u4ece\u590d\u5236\u4e0e\u8bfb\u5199\u5206\u79bb"}),"\n",(0,T.jsx)(e.h3,{id:"\u914d\u7f6e\u4e3b\u4ece\u590d\u5236",children:"\u914d\u7f6e\u4e3b\u4ece\u590d\u5236"}),"\n",(0,T.jsxs)(e.p,{children:[(0,T.jsx)(e.strong,{children:"\u4e3b\u5e93\u914d\u7f6e"})," (",(0,T.jsx)(e.code,{children:"master"}),"):"]}),"\n",(0,T.jsx)(e.pre,{children:(0,T.jsx)(e.code,{className:"language-ini",children:"# my.cnf\n[mysqld]\nserver-id=1\nlog-bin=mysql-bin\nbinlog-format=ROW\nbinlog-do-db=mydb\n"})}),"\n",(0,T.jsxs)(e.p,{children:[(0,T.jsx)(e.strong,{children:"\u4ece\u5e93\u914d\u7f6e"})," (",(0,T.jsx)(e.code,{children:"slave"}),"):"]}),"\n",(0,T.jsx)(e.pre,{children:(0,T.jsx)(e.code,{className:"language-ini",children:"# my.cnf\n[mysqld]\nserver-id=2\nrelay-log=mysql-relay-bin\nread_only=1\n"})}),"\n",(0,T.jsxs)(e.p,{children:[(0,T.jsx)(e.strong,{children:"\u914d\u7f6e\u4ece\u5e93"}),":"]}),"\n",(0,T.jsx)(e.pre,{children:(0,T.jsx)(e.code,{className:"language-sql",children:"-- \u4ece\u5e93\u6267\u884c\nCHANGE MASTER TO\n    MASTER_HOST='192.168.1.100',\n    MASTER_PORT=3306,\n    MASTER_USER='repl',\n    MASTER_PASSWORD='password',\n    MASTER_LOG_FILE='mysql-bin.000001',\n    MASTER_LOG_POS=154;\n\nSTART SLAVE;\n\n-- \u67e5\u770b\u72b6\u6001\nSHOW SLAVE STATUS\\G\n"})}),"\n",(0,T.jsx)(e.h3,{id:"\u5e94\u7528\u5c42\u8bfb\u5199\u5206\u79bb",children:"\u5e94\u7528\u5c42\u8bfb\u5199\u5206\u79bb"}),"\n",(0,T.jsx)(e.pre,{children:(0,T.jsx)(e.code,{className:"language-java",children:"public class DataSourceRouter {\n    private DataSource masterDataSource;  // \u4e3b\u5e93\n    private List<DataSource> slaveDataSources;  // \u4ece\u5e93\u5217\u8868\n    private AtomicInteger counter = new AtomicInteger(0);\n\n    public DataSource getDataSource() {\n        // \u5224\u65ad\u5f53\u524d\u64cd\u4f5c\u7c7b\u578b\n        if (isWriteOperation()) {\n            return masterDataSource;  // \u5199\u64cd\u4f5c\u7528\u4e3b\u5e93\n        } else {\n            // \u8bfb\u64cd\u4f5c\u4ece\u591a\u4e2a\u4ece\u5e93\u4e2d\u8f6e\u8be2\u9009\u62e9\n            int index = counter.getAndIncrement() % slaveDataSources.size();\n            return slaveDataSources.get(index);\n        }\n    }\n}\n"})}),"\n",(0,T.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,T.jsx)(e.p,{children:"\u672c\u6587\u6863\u901a\u8fc7\u5b9e\u9645\u6848\u4f8b\u5c55\u793a\u4e86\uff1a"}),"\n",(0,T.jsxs)(e.ul,{children:["\n",(0,T.jsx)(e.li,{children:"\u2705 \u7528\u6237\u7cfb\u7edf\uff1a\u8868\u8bbe\u8ba1\u3001RBAC \u6743\u9650\u6a21\u578b"}),"\n",(0,T.jsx)(e.li,{children:"\u2705 \u7535\u5546\u8ba2\u5355\uff1a\u8ba2\u5355\u6d41\u7a0b\u3001\u5e93\u5b58\u6263\u51cf\u3001\u4e8b\u52a1\u5904\u7406"}),"\n",(0,T.jsx)(e.li,{children:"\u2705 \u535a\u5ba2\u7cfb\u7edf\uff1a\u6587\u7ae0\u7ba1\u7406\u3001\u6807\u7b7e\u7cfb\u7edf\u3001\u8bc4\u8bba\u7cfb\u7edf"}),"\n",(0,T.jsx)(e.li,{children:"\u2705 \u5206\u5e93\u5206\u8868\uff1a\u6c34\u5e73\u5206\u8868\u3001\u8def\u7531\u7b56\u7565"}),"\n",(0,T.jsx)(e.li,{children:"\u2705 \u4e3b\u4ece\u590d\u5236\uff1a\u914d\u7f6e\u65b9\u6cd5\u3001\u8bfb\u5199\u5206\u79bb"}),"\n"]}),"\n",(0,T.jsxs)(e.p,{children:["\u8fd9\u4e9b\u6848\u4f8b\u53ef\u4ee5\u76f4\u63a5\u5e94\u7528\u5230\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u7ee7\u7eed\u5b66\u4e60 ",(0,T.jsx)(e.a,{href:"/docs/mysql/performance-optimization",children:"\u6027\u80fd\u4f18\u5316"})," \u548c ",(0,T.jsx)(e.a,{href:"/docs/mysql/best-practices",children:"\u6700\u4f73\u5b9e\u8df5"}),"\uff01"]})]})}function o(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,T.jsx)(e,{...n,children:(0,T.jsx)(a,{...n})}):a(n)}},48885:(n,e,E)=>{E.d(e,{R:()=>s,x:()=>i});var N=E(99378);const T={},r=N.createContext(T);function s(n){const e=N.useContext(r);return N.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(T):n.components||T:s(n.components),N.createElement(r.Provider,{value:e},n.children)}}}]);
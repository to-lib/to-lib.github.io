"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[90946],{11493:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"flink/datastream-api","title":"DataStream API","description":"Flink DataStream API \u6d41\u5904\u7406\u7f16\u7a0b\u8be6\u89e3","source":"@site/docs/flink/datastream-api.md","sourceDirName":"flink","slug":"/flink/datastream-api","permalink":"/docs/flink/datastream-api","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/flink/datastream-api.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"DataStream API","description":"Flink DataStream API \u6d41\u5904\u7406\u7f16\u7a0b\u8be6\u89e3"},"sidebar":"flink","previous":{"title":"\u5feb\u901f\u5f00\u59cb","permalink":"/docs/flink/quick-start"},"next":{"title":"Table API \u4e0e SQL","permalink":"/docs/flink/table-sql"}}');var a=t(22714),r=t(48885);const l={sidebar_position:5,title:"DataStream API",description:"Flink DataStream API \u6d41\u5904\u7406\u7f16\u7a0b\u8be6\u89e3"},s="DataStream API",c={},d=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"\u6267\u884c\u73af\u5883",id:"\u6267\u884c\u73af\u5883",level:2},{value:"\u521b\u5efa\u73af\u5883",id:"\u521b\u5efa\u73af\u5883",level:3},{value:"\u914d\u7f6e\u73af\u5883",id:"\u914d\u7f6e\u73af\u5883",level:3},{value:"\u6570\u636e\u6e90\uff08Source\uff09",id:"\u6570\u636e\u6e90source",level:2},{value:"\u5185\u7f6e\u6570\u636e\u6e90",id:"\u5185\u7f6e\u6570\u636e\u6e90",level:3},{value:"\u81ea\u5b9a\u4e49\u6570\u636e\u6e90",id:"\u81ea\u5b9a\u4e49\u6570\u636e\u6e90",level:3},{value:"\u8f6c\u6362\u7b97\u5b50",id:"\u8f6c\u6362\u7b97\u5b50",level:2},{value:"Map",id:"map",level:3},{value:"FlatMap",id:"flatmap",level:3},{value:"Filter",id:"filter",level:3},{value:"KeyBy",id:"keyby",level:3},{value:"Reduce",id:"reduce",level:3},{value:"Aggregations",id:"aggregations",level:3},{value:"\u7a97\u53e3\u64cd\u4f5c",id:"\u7a97\u53e3\u64cd\u4f5c",level:2},{value:"\u65f6\u95f4\u7a97\u53e3",id:"\u65f6\u95f4\u7a97\u53e3",level:3},{value:"\u8ba1\u6570\u7a97\u53e3",id:"\u8ba1\u6570\u7a97\u53e3",level:3},{value:"\u7a97\u53e3\u51fd\u6570",id:"\u7a97\u53e3\u51fd\u6570",level:3},{value:"\u591a\u6d41\u64cd\u4f5c",id:"\u591a\u6d41\u64cd\u4f5c",level:2},{value:"Union",id:"union",level:3},{value:"Connect",id:"connect",level:3},{value:"Join",id:"join",level:3},{value:"\u8f93\u51fa\uff08Sink\uff09",id:"\u8f93\u51fasink",level:2},{value:"\u5185\u7f6e Sink",id:"\u5185\u7f6e-sink",level:3},{value:"\u81ea\u5b9a\u4e49 Sink",id:"\u81ea\u5b9a\u4e49-sink",level:3},{value:"\u6267\u884c\u4f5c\u4e1a",id:"\u6267\u884c\u4f5c\u4e1a",level:2},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"datastream-api",children:"DataStream API"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"\u9002\u7528\u7248\u672c\uff1aApache Flink v2.2.0"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,a.jsx)(n.p,{children:"DataStream API \u662f Flink \u7684\u6838\u5fc3\u6d41\u5904\u7406 API\uff0c\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u7b97\u5b50\u7528\u4e8e\u5904\u7406\u65e0\u754c\u548c\u6709\u754c\u6570\u636e\u6d41\u3002"}),"\n",(0,a.jsx)(n.h2,{id:"\u6267\u884c\u73af\u5883",children:"\u6267\u884c\u73af\u5883"}),"\n",(0,a.jsx)(n.h3,{id:"\u521b\u5efa\u73af\u5883",children:"\u521b\u5efa\u73af\u5883"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u6807\u51c6\u65b9\u5f0f\uff08\u81ea\u52a8\u68c0\u6d4b\u672c\u5730\u6216\u96c6\u7fa4\uff09\nStreamExecutionEnvironment env =\n    StreamExecutionEnvironment.getExecutionEnvironment();\n\n// \u672c\u5730\u73af\u5883\uff08\u7528\u4e8e\u6d4b\u8bd5\uff09\nStreamExecutionEnvironment env =\n    StreamExecutionEnvironment.createLocalEnvironment();\n\n// \u8fdc\u7a0b\u73af\u5883\nStreamExecutionEnvironment env =\n    StreamExecutionEnvironment.createRemoteEnvironment(\n        "host", 8081, "path/to/jar");\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u914d\u7f6e\u73af\u5883",children:"\u914d\u7f6e\u73af\u5883"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u8bbe\u7f6e\u5e76\u884c\u5ea6\nenv.setParallelism(4);\n\n// \u65f6\u95f4\u8bed\u4e49\u4e0e\u6c34\u5370\uff1a\u5728 Source \u4e0a\u5206\u914d WatermarkStrategy\uff08\u65e0\u9700\u663e\u5f0f\u8bbe\u7f6e TimeCharacteristic\uff09\n// \u4f8b\u5982\uff1a\n// DataStream<Event> events = env.fromSource(\n//     source,\n//     WatermarkStrategy\n//         .<Event>forBoundedOutOfOrderness(Duration.ofSeconds(5))\n//         .withTimestampAssigner((e, ts) -> e.getTimestamp()),\n//     "my-source"\n// );\n\n// \u8bbe\u7f6e\u91cd\u542f\u7b56\u7565\nenv.setRestartStrategy(RestartStrategies.fixedDelayRestart(3, Time.seconds(10)));\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u6570\u636e\u6e90source",children:"\u6570\u636e\u6e90\uff08Source\uff09"}),"\n",(0,a.jsx)(n.h3,{id:"\u5185\u7f6e\u6570\u636e\u6e90",children:"\u5185\u7f6e\u6570\u636e\u6e90"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u4ece\u96c6\u5408\u521b\u5efa\nDataStream<String> stream = env.fromElements("a", "b", "c");\nDataStream<Integer> numbers = env.fromCollection(Arrays.asList(1, 2, 3));\n\n// \u4ece\u6587\u4ef6\u8bfb\u53d6\nDataStream<String> lines = env.readTextFile("/path/to/file");\n\n// \u4ece Socket \u8bfb\u53d6\nDataStream<String> socket = env.socketTextStream("localhost", 9999);\n\n// \u751f\u6210\u5e8f\u5217\nDataStream<Long> sequence = env.fromSequence(1, 100);\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49\u6570\u636e\u6e90",children:"\u81ea\u5b9a\u4e49\u6570\u636e\u6e90"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'public class MySource implements SourceFunction<String> {\n    private volatile boolean isRunning = true;\n\n    @Override\n    public void run(SourceContext<String> ctx) throws Exception {\n        while (isRunning) {\n            ctx.collect("data-" + System.currentTimeMillis());\n            Thread.sleep(1000);\n        }\n    }\n\n    @Override\n    public void cancel() {\n        isRunning = false;\n    }\n}\n\n// \u4f7f\u7528\u81ea\u5b9a\u4e49\u6e90\nDataStream<String> stream = env.addSource(new MySource());\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u8f6c\u6362\u7b97\u5b50",children:"\u8f6c\u6362\u7b97\u5b50"}),"\n",(0,a.jsx)(n.h3,{id:"map",children:"Map"}),"\n",(0,a.jsx)(n.p,{children:"\u4e00\u5bf9\u4e00\u8f6c\u6362\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'DataStream<Integer> doubled = stream.map(x -> x * 2);\n\n// \u4f7f\u7528 MapFunction\nDataStream<String> result = stream.map(new MapFunction<Integer, String>() {\n    @Override\n    public String map(Integer value) {\n        return "Value: " + value;\n    }\n});\n'})}),"\n",(0,a.jsx)(n.h3,{id:"flatmap",children:"FlatMap"}),"\n",(0,a.jsx)(n.p,{children:"\u4e00\u5bf9\u591a\u8f6c\u6362\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'DataStream<String> words = lines.flatMap(\n    (String line, Collector<String> out) -> {\n        for (String word : line.split(" ")) {\n            out.collect(word);\n        }\n    }\n).returns(Types.STRING); // \u9700\u8981\u6307\u5b9a\u8fd4\u56de\u7c7b\u578b\n'})}),"\n",(0,a.jsx)(n.h3,{id:"filter",children:"Filter"}),"\n",(0,a.jsx)(n.p,{children:"\u8fc7\u6ee4\u6570\u636e\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"DataStream<Integer> positives = numbers.filter(x -> x > 0);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"keyby",children:"KeyBy"}),"\n",(0,a.jsx)(n.p,{children:"\u6309\u952e\u5206\u7ec4\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u4f7f\u7528 Lambda\nKeyedStream<Event, String> keyed = events.keyBy(event -> event.getKey());\n\n// \u4f7f\u7528\u5b57\u6bb5\u540d\uff08POJO\uff09\nKeyedStream<Event, Tuple> keyed = events.keyBy("userId");\n\n// \u4f7f\u7528\u5b57\u6bb5\u4f4d\u7f6e\uff08Tuple\uff09\nKeyedStream<Tuple2<String, Integer>, Tuple> keyed = tuples.keyBy(0);\n'})}),"\n",(0,a.jsx)(n.h3,{id:"reduce",children:"Reduce"}),"\n",(0,a.jsx)(n.p,{children:"\u805a\u5408\u64cd\u4f5c\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"DataStream<Event> reduced = keyed.reduce(\n    (e1, e2) -> new Event(e1.getKey(), e1.getValue() + e2.getValue())\n);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"aggregations",children:"Aggregations"}),"\n",(0,a.jsx)(n.p,{children:"\u5185\u7f6e\u805a\u5408\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'keyedStream.sum(1);           // \u6c42\u548c\nkeyedStream.min("field");     // \u6700\u5c0f\u503c\nkeyedStream.max("field");     // \u6700\u5927\u503c\nkeyedStream.minBy("field");   // \u6700\u5c0f\u503c\u5bf9\u5e94\u7684\u6574\u6761\u8bb0\u5f55\nkeyedStream.maxBy("field");   // \u6700\u5927\u503c\u5bf9\u5e94\u7684\u6574\u6761\u8bb0\u5f55\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u7a97\u53e3\u64cd\u4f5c",children:"\u7a97\u53e3\u64cd\u4f5c"}),"\n",(0,a.jsx)(n.h3,{id:"\u65f6\u95f4\u7a97\u53e3",children:"\u65f6\u95f4\u7a97\u53e3"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u6eda\u52a8\u4e8b\u4ef6\u65f6\u95f4\u7a97\u53e3\nstream\n    .keyBy(event -> event.getKey())\n    .window(TumblingEventTimeWindows.of(Time.seconds(30)))\n    .sum("value");\n\n// \u6ed1\u52a8\u5904\u7406\u65f6\u95f4\u7a97\u53e3\nstream\n    .keyBy(event -> event.getKey())\n    .window(SlidingProcessingTimeWindows.of(Time.minutes(5), Time.minutes(1)))\n    .reduce((a, b) -> a.getValue() > b.getValue() ? a : b);\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u8ba1\u6570\u7a97\u53e3",children:"\u8ba1\u6570\u7a97\u53e3"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u6eda\u52a8\u8ba1\u6570\u7a97\u53e3\nstream\n    .keyBy(event -> event.getKey())\n    .countWindow(100)\n    .sum("value");\n\n// \u6ed1\u52a8\u8ba1\u6570\u7a97\u53e3\nstream\n    .keyBy(event -> event.getKey())\n    .countWindow(100, 10)\n    .sum("value");\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u7a97\u53e3\u51fd\u6570",children:"\u7a97\u53e3\u51fd\u6570"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"// ProcessWindowFunction - \u8bbf\u95ee\u7a97\u53e3\u5143\u6570\u636e\nstream\n    .keyBy(event -> event.getKey())\n    .window(TumblingEventTimeWindows.of(Time.minutes(5)))\n    .process(new ProcessWindowFunction<Event, Result, String, TimeWindow>() {\n        @Override\n        public void process(String key, Context ctx,\n                Iterable<Event> elements, Collector<Result> out) {\n            long count = 0;\n            for (Event e : elements) {\n                count++;\n            }\n            out.collect(new Result(key, ctx.window().getEnd(), count));\n        }\n    });\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u591a\u6d41\u64cd\u4f5c",children:"\u591a\u6d41\u64cd\u4f5c"}),"\n",(0,a.jsx)(n.h3,{id:"union",children:"Union"}),"\n",(0,a.jsx)(n.p,{children:"\u5408\u5e76\u540c\u7c7b\u578b\u6d41\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"DataStream<Event> unified = stream1.union(stream2, stream3);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"connect",children:"Connect"}),"\n",(0,a.jsx)(n.p,{children:"\u8fde\u63a5\u4e0d\u540c\u7c7b\u578b\u6d41\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'ConnectedStreams<String, Integer> connected =\n    stringStream.connect(intStream);\n\nDataStream<String> result = connected.map(\n    new CoMapFunction<String, Integer, String>() {\n        @Override\n        public String map1(String value) {\n            return "String: " + value;\n        }\n\n        @Override\n        public String map2(Integer value) {\n            return "Integer: " + value;\n        }\n    }\n);\n'})}),"\n",(0,a.jsx)(n.h3,{id:"join",children:"Join"}),"\n",(0,a.jsx)(n.p,{children:"\u7a97\u53e3 Join\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"stream1\n    .join(stream2)\n    .where(e -> e.getKey())\n    .equalTo(e -> e.getKey())\n    .window(TumblingEventTimeWindows.of(Time.seconds(10)))\n    .apply((e1, e2) -> new JoinResult(e1, e2));\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u8f93\u51fasink",children:"\u8f93\u51fa\uff08Sink\uff09"}),"\n",(0,a.jsx)(n.h3,{id:"\u5185\u7f6e-sink",children:"\u5185\u7f6e Sink"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u6253\u5370\u5230\u63a7\u5236\u53f0\nstream.print();\n\n// \u5199\u5165\u6587\u4ef6\nstream.writeAsText("/path/to/output");\n\n// \u5199\u5165 Socket\nstream.writeToSocket("localhost", 9999, new SimpleStringSchema());\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49-sink",children:"\u81ea\u5b9a\u4e49 Sink"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'public class MySink implements SinkFunction<String> {\n    @Override\n    public void invoke(String value, Context context) {\n        System.out.println("Output: " + value);\n    }\n}\n\nstream.addSink(new MySink());\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u6267\u884c\u4f5c\u4e1a",children:"\u6267\u884c\u4f5c\u4e1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u6267\u884c\u5e76\u7b49\u5f85\u7ed3\u679c\nJobExecutionResult result = env.execute("My Job");\n\n// \u5f02\u6b65\u6267\u884c\nJobClient client = env.executeAsync("My Job");\nJobExecutionResult result = client.getJobExecutionResult().get();\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\ud83d\udcca ",(0,a.jsx)(n.a,{href:"/docs/flink/table-sql",children:"Table API & SQL"})," - \u58f0\u660e\u5f0f\u6570\u636e\u5904\u7406"]}),"\n",(0,a.jsxs)(n.li,{children:["\ud83c\udfaf ",(0,a.jsx)(n.a,{href:"/docs/flink/core-concepts",children:"\u6838\u5fc3\u6982\u5ff5"})," - \u6df1\u5165\u7406\u89e3 Flink \u6982\u5ff5"]}),"\n",(0,a.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,a.jsx)(n.a,{href:"/docs/flink/state-management",children:"\u72b6\u6001\u7ba1\u7406"})," - \u6709\u72b6\u6001\u8ba1\u7b97\u8be6\u89e3"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},48885:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>s});var i=t(99378);const a={},r=i.createContext(a);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);
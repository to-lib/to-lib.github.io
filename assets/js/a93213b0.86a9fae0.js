"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[5204],{46138:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"kafka/security","title":"\u5b89\u5168\u914d\u7f6e","description":"Kafka \u5b89\u5168\u7279\u6027\uff1a\u8ba4\u8bc1\u3001\u6388\u6743\u548c\u52a0\u5bc6","source":"@site/docs/kafka/security.md","sourceDirName":"kafka","slug":"/kafka/security","permalink":"/docs/kafka/security","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/kafka/security.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_position":13,"title":"\u5b89\u5168\u914d\u7f6e","description":"Kafka \u5b89\u5168\u7279\u6027\uff1a\u8ba4\u8bc1\u3001\u6388\u6743\u548c\u52a0\u5bc6"},"sidebar":"kafka","previous":{"title":"\u76d1\u63a7\u4e0e\u8fd0\u7ef4","permalink":"/docs/kafka/monitoring"},"next":{"title":"Kafka Connect","permalink":"/docs/kafka/kafka-connect"}}');var l=r(22714),a=r(48885);const i={sidebar_position:13,title:"\u5b89\u5168\u914d\u7f6e",description:"Kafka \u5b89\u5168\u7279\u6027\uff1a\u8ba4\u8bc1\u3001\u6388\u6743\u548c\u52a0\u5bc6"},t="Kafka \u5b89\u5168\u914d\u7f6e",o={},c=[{value:"\u5b89\u5168\u6982\u8ff0",id:"\u5b89\u5168\u6982\u8ff0",level:2},{value:"SSL/TLS \u52a0\u5bc6",id:"ssltls-\u52a0\u5bc6",level:2},{value:"\u751f\u6210\u8bc1\u4e66",id:"\u751f\u6210\u8bc1\u4e66",level:3},{value:"Broker SSL \u914d\u7f6e",id:"broker-ssl-\u914d\u7f6e",level:3},{value:"\u5ba2\u6237\u7aef SSL \u914d\u7f6e",id:"\u5ba2\u6237\u7aef-ssl-\u914d\u7f6e",level:3},{value:"SASL \u8ba4\u8bc1",id:"sasl-\u8ba4\u8bc1",level:2},{value:"\u8ba4\u8bc1\u673a\u5236\u5bf9\u6bd4",id:"\u8ba4\u8bc1\u673a\u5236\u5bf9\u6bd4",level:3},{value:"SASL/PLAIN \u914d\u7f6e",id:"saslplain-\u914d\u7f6e",level:3},{value:"SASL/SCRAM \u914d\u7f6e",id:"saslscram-\u914d\u7f6e",level:3},{value:"ACL \u6743\u9650\u63a7\u5236",id:"acl-\u6743\u9650\u63a7\u5236",level:2},{value:"\u542f\u7528 ACL",id:"\u542f\u7528-acl",level:3},{value:"ACL \u64cd\u4f5c\u547d\u4ee4",id:"acl-\u64cd\u4f5c\u547d\u4ee4",level:3},{value:"ACL \u6743\u9650\u7c7b\u578b",id:"acl-\u6743\u9650\u7c7b\u578b",level:3},{value:"\u5e38\u7528 ACL \u914d\u7f6e\u793a\u4f8b",id:"\u5e38\u7528-acl-\u914d\u7f6e\u793a\u4f8b",level:3},{value:"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5",id:"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u7f51\u7edc\u5b89\u5168",id:"\u7f51\u7edc\u5b89\u5168",level:3},{value:"\u8ba4\u8bc1\u914d\u7f6e",id:"\u8ba4\u8bc1\u914d\u7f6e",level:3},{value:"\u5bc6\u7801\u7ba1\u7406",id:"\u5bc6\u7801\u7ba1\u7406",level:3},{value:"\u5ba1\u8ba1\u65e5\u5fd7",id:"\u5ba1\u8ba1\u65e5\u5fd7",level:3},{value:"\u5b89\u5168\u914d\u7f6e\u68c0\u67e5\u6e05\u5355",id:"\u5b89\u5168\u914d\u7f6e\u68c0\u67e5\u6e05\u5355",level:2},{value:"\u751f\u4ea7\u73af\u5883\u5fc5\u5907",id:"\u751f\u4ea7\u73af\u5883\u5fc5\u5907",level:3},{value:"\u589e\u5f3a\u5b89\u5168",id:"\u589e\u5f3a\u5b89\u5168",level:3},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:2},{value:"Q: SSL \u63e1\u624b\u5931\u8d25\u600e\u4e48\u529e\uff1f",id:"q-ssl-\u63e1\u624b\u5931\u8d25\u600e\u4e48\u529e",level:3},{value:"Q: SASL \u8ba4\u8bc1\u5931\u8d25\u600e\u4e48\u529e\uff1f",id:"q-sasl-\u8ba4\u8bc1\u5931\u8d25\u600e\u4e48\u529e",level:3},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.header,{children:(0,l.jsx)(s.h1,{id:"kafka-\u5b89\u5168\u914d\u7f6e",children:"Kafka \u5b89\u5168\u914d\u7f6e"})}),"\n",(0,l.jsx)(s.h2,{id:"\u5b89\u5168\u6982\u8ff0",children:"\u5b89\u5168\u6982\u8ff0"}),"\n",(0,l.jsx)(s.p,{children:"Kafka \u63d0\u4f9b\u591a\u5c42\u5b89\u5168\u673a\u5236\u4fdd\u62a4\u6570\u636e\u548c\u7cfb\u7edf\uff1a"}),"\n",(0,l.jsx)(s.mermaid,{value:"graph TB\n    subgraph \u5b89\u5168\u5c42\n        A[\u8ba4\u8bc1 Authentication] --\x3e B[\u6388\u6743 Authorization]\n        B --\x3e C[\u52a0\u5bc6 Encryption]\n    end\n\n    D[\u5ba2\u6237\u7aef] --\x3e A\n    C --\x3e E[Kafka Broker]\n\n    style A fill:#2e7d32,color:#fff\n    style B fill:#1976d2,color:#fff\n    style C fill:#ff9800,color:#fff"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{children:"\u5b89\u5168\u5c42"}),(0,l.jsx)(s.th,{children:"\u4f5c\u7528"}),(0,l.jsx)(s.th,{children:"\u652f\u6301\u65b9\u5f0f"})]})}),(0,l.jsxs)(s.tbody,{children:[(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"\u8ba4\u8bc1"})}),(0,l.jsx)(s.td,{children:"\u9a8c\u8bc1\u5ba2\u6237\u7aef\u8eab\u4efd"}),(0,l.jsx)(s.td,{children:"SSL\u3001SASL"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"\u6388\u6743"})}),(0,l.jsx)(s.td,{children:"\u63a7\u5236\u8d44\u6e90\u8bbf\u95ee\u6743\u9650"}),(0,l.jsx)(s.td,{children:"ACL"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"\u52a0\u5bc6"})}),(0,l.jsx)(s.td,{children:"\u4fdd\u62a4\u6570\u636e\u4f20\u8f93"}),(0,l.jsx)(s.td,{children:"SSL/TLS"})]})]})]}),"\n",(0,l.jsx)(s.h2,{id:"ssltls-\u52a0\u5bc6",children:"SSL/TLS \u52a0\u5bc6"}),"\n",(0,l.jsx)(s.h3,{id:"\u751f\u6210\u8bc1\u4e66",children:"\u751f\u6210\u8bc1\u4e66"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:'#!/bin/bash\n# 1. \u751f\u6210 CA \u8bc1\u4e66\nopenssl req -new -x509 -keyout ca-key -out ca-cert -days 365 \\\n  -subj "/CN=Kafka-CA" -passout pass:ca-password\n\n# 2. \u4e3a\u6bcf\u4e2a Broker \u751f\u6210\u5bc6\u94a5\u5e93\nkeytool -keystore kafka.server.keystore.jks -alias localhost \\\n  -keyalg RSA -validity 365 -genkey -storepass password \\\n  -dname "CN=kafka-broker1"\n\n# 3. \u751f\u6210\u8bc1\u4e66\u7b7e\u540d\u8bf7\u6c42\nkeytool -keystore kafka.server.keystore.jks -alias localhost \\\n  -certreq -file cert-file -storepass password\n\n# 4. \u7528 CA \u7b7e\u540d\nopenssl x509 -req -CA ca-cert -CAkey ca-key -in cert-file \\\n  -out cert-signed -days 365 -CAcreateserial -passin pass:ca-password\n\n# 5. \u5bfc\u5165 CA \u8bc1\u4e66\nkeytool -keystore kafka.server.keystore.jks -alias CARoot \\\n  -import -file ca-cert -storepass password -noprompt\n\n# 6. \u5bfc\u5165\u7b7e\u540d\u8bc1\u4e66\nkeytool -keystore kafka.server.keystore.jks -alias localhost \\\n  -import -file cert-signed -storepass password\n\n# 7. \u521b\u5efa\u4fe1\u4efb\u5e93\nkeytool -keystore kafka.server.truststore.jks -alias CARoot \\\n  -import -file ca-cert -storepass password -noprompt\n'})}),"\n",(0,l.jsx)(s.h3,{id:"broker-ssl-\u914d\u7f6e",children:"Broker SSL \u914d\u7f6e"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-properties",children:"# server.properties\nlisteners=SSL://kafka-broker1:9093\nadvertised.listeners=SSL://kafka-broker1:9093\n\n# SSL \u914d\u7f6e\nssl.keystore.location=/var/ssl/kafka.server.keystore.jks\nssl.keystore.password=password\nssl.key.password=password\nssl.truststore.location=/var/ssl/kafka.server.truststore.jks\nssl.truststore.password=password\n\n# \u5ba2\u6237\u7aef\u8ba4\u8bc1\uff08\u53ef\u9009\uff09\nssl.client.auth=required\n\n# \u63a8\u8350\u7684\u534f\u8bae\u548c\u5bc6\u7801\u5957\u4ef6\nssl.enabled.protocols=TLSv1.2,TLSv1.3\nssl.cipher.suites=TLS_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\n"})}),"\n",(0,l.jsx)(s.h3,{id:"\u5ba2\u6237\u7aef-ssl-\u914d\u7f6e",children:"\u5ba2\u6237\u7aef SSL \u914d\u7f6e"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-java",children:'Properties props = new Properties();\nprops.put("bootstrap.servers", "kafka-broker1:9093");\nprops.put("security.protocol", "SSL");\n\n// SSL \u914d\u7f6e\nprops.put("ssl.truststore.location", "/var/ssl/client.truststore.jks");\nprops.put("ssl.truststore.password", "password");\n\n// \u53cc\u5411\u8ba4\u8bc1\u65f6\u9700\u8981\nprops.put("ssl.keystore.location", "/var/ssl/client.keystore.jks");\nprops.put("ssl.keystore.password", "password");\nprops.put("ssl.key.password", "password");\n'})}),"\n",(0,l.jsx)(s.h2,{id:"sasl-\u8ba4\u8bc1",children:"SASL \u8ba4\u8bc1"}),"\n",(0,l.jsx)(s.h3,{id:"\u8ba4\u8bc1\u673a\u5236\u5bf9\u6bd4",children:"\u8ba4\u8bc1\u673a\u5236\u5bf9\u6bd4"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{children:"\u673a\u5236"}),(0,l.jsx)(s.th,{children:"\u8bf4\u660e"}),(0,l.jsx)(s.th,{children:"\u9002\u7528\u573a\u666f"})]})}),(0,l.jsxs)(s.tbody,{children:[(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"PLAIN"})}),(0,l.jsx)(s.td,{children:"\u7528\u6237\u540d/\u5bc6\u7801\uff08\u660e\u6587\uff09"}),(0,l.jsx)(s.td,{children:"\u5f00\u53d1\u73af\u5883"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"SCRAM"})}),(0,l.jsx)(s.td,{children:"\u52a0\u76d0\u6311\u6218\u54cd\u5e94"}),(0,l.jsx)(s.td,{children:"\u751f\u4ea7\u73af\u5883"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"GSSAPI"})}),(0,l.jsx)(s.td,{children:"Kerberos"}),(0,l.jsx)(s.td,{children:"\u4f01\u4e1a\u73af\u5883"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"OAUTHBEARER"})}),(0,l.jsx)(s.td,{children:"OAuth 2.0"}),(0,l.jsx)(s.td,{children:"\u4e91\u539f\u751f"})]})]})]}),"\n",(0,l.jsx)(s.h3,{id:"saslplain-\u914d\u7f6e",children:"SASL/PLAIN \u914d\u7f6e"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Broker \u914d\u7f6e\uff1a"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-properties",children:"# server.properties\nlisteners=SASL_PLAINTEXT://kafka-broker1:9092\nadvertised.listeners=SASL_PLAINTEXT://kafka-broker1:9092\nsecurity.inter.broker.protocol=SASL_PLAINTEXT\n\n# SASL \u914d\u7f6e\nsasl.enabled.mechanisms=PLAIN\nsasl.mechanism.inter.broker.protocol=PLAIN\n"})}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Broker JAAS \u914d\u7f6e\uff1a"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-properties",children:'# kafka_server_jaas.conf\nKafkaServer {\n    org.apache.kafka.common.security.plain.PlainLoginModule required\n    username="admin"\n    password="admin-secret"\n    user_admin="admin-secret"\n    user_producer="producer-secret"\n    user_consumer="consumer-secret";\n};\n'})}),"\n",(0,l.jsx)(s.p,{children:"\u542f\u52a8 Broker \u65f6\u6307\u5b9a JAAS \u914d\u7f6e\uff1a"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:'export KAFKA_OPTS="-Djava.security.auth.login.config=/etc/kafka/kafka_server_jaas.conf"\nbin/kafka-server-start.sh config/server.properties\n'})}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"\u5ba2\u6237\u7aef\u914d\u7f6e\uff1a"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-java",children:'Properties props = new Properties();\nprops.put("bootstrap.servers", "kafka-broker1:9092");\nprops.put("security.protocol", "SASL_PLAINTEXT");\nprops.put("sasl.mechanism", "PLAIN");\nprops.put("sasl.jaas.config",\n    "org.apache.kafka.common.security.plain.PlainLoginModule required " +\n    "username=\\"producer\\" password=\\"producer-secret\\";");\n'})}),"\n",(0,l.jsx)(s.h3,{id:"saslscram-\u914d\u7f6e",children:"SASL/SCRAM \u914d\u7f6e"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"\u521b\u5efa SCRAM \u7528\u6237\uff1a"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"# \u521b\u5efa\u7ba1\u7406\u5458\u7528\u6237\nkafka-configs.sh --bootstrap-server localhost:9092 \\\n  --alter --add-config 'SCRAM-SHA-256=[password=admin-secret]' \\\n  --entity-type users --entity-name admin\n\n# \u521b\u5efa\u666e\u901a\u7528\u6237\nkafka-configs.sh --bootstrap-server localhost:9092 \\\n  --alter --add-config 'SCRAM-SHA-256=[password=user-secret]' \\\n  --entity-type users --entity-name producer\n"})}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"Broker \u914d\u7f6e\uff1a"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-properties",children:"# server.properties\nlisteners=SASL_SSL://kafka-broker1:9093\nsecurity.inter.broker.protocol=SASL_SSL\nsasl.enabled.mechanisms=SCRAM-SHA-256\nsasl.mechanism.inter.broker.protocol=SCRAM-SHA-256\n"})}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.strong,{children:"\u5ba2\u6237\u7aef\u914d\u7f6e\uff1a"})}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-java",children:'props.put("security.protocol", "SASL_SSL");\nprops.put("sasl.mechanism", "SCRAM-SHA-256");\nprops.put("sasl.jaas.config",\n    "org.apache.kafka.common.security.scram.ScramLoginModule required " +\n    "username=\\"producer\\" password=\\"user-secret\\";");\n'})}),"\n",(0,l.jsx)(s.h2,{id:"acl-\u6743\u9650\u63a7\u5236",children:"ACL \u6743\u9650\u63a7\u5236"}),"\n",(0,l.jsx)(s.h3,{id:"\u542f\u7528-acl",children:"\u542f\u7528 ACL"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-properties",children:"# server.properties\nauthorizer.class.name=kafka.security.authorizer.AclAuthorizer\nsuper.users=User:admin\nallow.everyone.if.no.acl.found=false\n"})}),"\n",(0,l.jsx)(s.h3,{id:"acl-\u64cd\u4f5c\u547d\u4ee4",children:"ACL \u64cd\u4f5c\u547d\u4ee4"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"# \u67e5\u770b\u6240\u6709 ACL\nkafka-acls.sh --bootstrap-server localhost:9092 --list\n\n# \u6388\u4e88\u751f\u4ea7\u8005\u5199\u6743\u9650\nkafka-acls.sh --bootstrap-server localhost:9092 \\\n  --add --allow-principal User:producer \\\n  --operation Write --topic my-topic\n\n# \u6388\u4e88\u6d88\u8d39\u8005\u8bfb\u6743\u9650\nkafka-acls.sh --bootstrap-server localhost:9092 \\\n  --add --allow-principal User:consumer \\\n  --operation Read --topic my-topic \\\n  --group my-group\n\n# \u6388\u4e88\u5168\u90e8\u6743\u9650\nkafka-acls.sh --bootstrap-server localhost:9092 \\\n  --add --allow-principal User:admin \\\n  --operation All --topic '*' --group '*'\n\n# \u5220\u9664 ACL\nkafka-acls.sh --bootstrap-server localhost:9092 \\\n  --remove --allow-principal User:producer \\\n  --operation Write --topic my-topic\n"})}),"\n",(0,l.jsx)(s.h3,{id:"acl-\u6743\u9650\u7c7b\u578b",children:"ACL \u6743\u9650\u7c7b\u578b"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{children:"\u6743\u9650"}),(0,l.jsx)(s.th,{children:"\u8bf4\u660e"}),(0,l.jsx)(s.th,{children:"\u9002\u7528\u8d44\u6e90"})]})}),(0,l.jsxs)(s.tbody,{children:[(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"Read"})}),(0,l.jsx)(s.td,{children:"\u8bfb\u53d6"}),(0,l.jsx)(s.td,{children:"Topic\u3001Group"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"Write"})}),(0,l.jsx)(s.td,{children:"\u5199\u5165"}),(0,l.jsx)(s.td,{children:"Topic"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"Create"})}),(0,l.jsx)(s.td,{children:"\u521b\u5efa"}),(0,l.jsx)(s.td,{children:"Topic\u3001Cluster"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"Delete"})}),(0,l.jsx)(s.td,{children:"\u5220\u9664"}),(0,l.jsx)(s.td,{children:"Topic"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"Alter"})}),(0,l.jsx)(s.td,{children:"\u4fee\u6539"}),(0,l.jsx)(s.td,{children:"Topic\u3001Cluster"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"Describe"})}),(0,l.jsx)(s.td,{children:"\u67e5\u770b"}),(0,l.jsx)(s.td,{children:"Topic\u3001Group\u3001Cluster"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"ClusterAction"})}),(0,l.jsx)(s.td,{children:"\u96c6\u7fa4\u64cd\u4f5c"}),(0,l.jsx)(s.td,{children:"Cluster"})]}),(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{children:(0,l.jsx)(s.strong,{children:"All"})}),(0,l.jsx)(s.td,{children:"\u5168\u90e8\u6743\u9650"}),(0,l.jsx)(s.td,{children:"\u6240\u6709\u8d44\u6e90"})]})]})]}),"\n",(0,l.jsx)(s.h3,{id:"\u5e38\u7528-acl-\u914d\u7f6e\u793a\u4f8b",children:"\u5e38\u7528 ACL \u914d\u7f6e\u793a\u4f8b"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"# \u751f\u4ea7\u8005\u6743\u9650\nkafka-acls.sh --bootstrap-server localhost:9092 \\\n  --add --allow-principal User:producer \\\n  --operation Write --operation Describe \\\n  --topic 'orders-*' --resource-pattern-type prefixed\n\n# \u6d88\u8d39\u8005\u6743\u9650\nkafka-acls.sh --bootstrap-server localhost:9092 \\\n  --add --allow-principal User:consumer \\\n  --operation Read --operation Describe \\\n  --topic 'orders-*' --resource-pattern-type prefixed\n\nkafka-acls.sh --bootstrap-server localhost:9092 \\\n  --add --allow-principal User:consumer \\\n  --operation Read \\\n  --group 'order-consumer-*' --resource-pattern-type prefixed\n\n# Kafka Connect \u6743\u9650\nkafka-acls.sh --bootstrap-server localhost:9092 \\\n  --add --allow-principal User:connect \\\n  --operation Read --operation Write --operation Create \\\n  --topic '*' --group '*'\n"})}),"\n",(0,l.jsx)(s.h2,{id:"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5",children:"\u5b89\u5168\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,l.jsx)(s.h3,{id:"\u7f51\u7edc\u5b89\u5168",children:"\u7f51\u7edc\u5b89\u5168"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u4f7f\u7528\u4e13\u7528\u7f51\u7edc"}),"\uff1aKafka \u96c6\u7fa4\u90e8\u7f72\u5728\u5185\u7f51"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u9632\u706b\u5899\u89c4\u5219"}),"\uff1a\u4ec5\u5f00\u653e\u5fc5\u8981\u7aef\u53e3"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"TLS \u52a0\u5bc6"}),"\uff1a\u751f\u4ea7\u73af\u5883\u5fc5\u987b\u542f\u7528"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"\u6700\u5c0f\u6743\u9650\u539f\u5219"}),"\uff1a\u4ec5\u6388\u4e88\u5fc5\u8981\u6743\u9650"]}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"\u8ba4\u8bc1\u914d\u7f6e",children:"\u8ba4\u8bc1\u914d\u7f6e"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-properties",children:"# \u63a8\u8350\u7684\u5b89\u5168\u914d\u7f6e\nlisteners=SASL_SSL://0.0.0.0:9093\nsecurity.inter.broker.protocol=SASL_SSL\nsasl.mechanism.inter.broker.protocol=SCRAM-SHA-256\nsasl.enabled.mechanisms=SCRAM-SHA-256\n\n# SSL \u914d\u7f6e\nssl.client.auth=required\nssl.enabled.protocols=TLSv1.2,TLSv1.3\n\n# \u7981\u7528\u4e0d\u5b89\u5168\u9009\u9879\nallow.everyone.if.no.acl.found=false\nauto.create.topics.enable=false\n"})}),"\n",(0,l.jsx)(s.h3,{id:"\u5bc6\u7801\u7ba1\u7406",children:"\u5bc6\u7801\u7ba1\u7406"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-java",children:'// \u4f7f\u7528\u73af\u5883\u53d8\u91cf\u6216\u5bc6\u94a5\u7ba1\u7406\u670d\u52a1\nString password = System.getenv("KAFKA_SSL_PASSWORD");\nprops.put("ssl.keystore.password", password);\n\n// \u6216\u4f7f\u7528 Secret Manager\n// AWS Secrets Manager\u3001HashiCorp Vault \u7b49\n'})}),"\n",(0,l.jsx)(s.h3,{id:"\u5ba1\u8ba1\u65e5\u5fd7",children:"\u5ba1\u8ba1\u65e5\u5fd7"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-properties",children:"# \u542f\u7528\u5ba1\u8ba1\u65e5\u5fd7\nlog4j.logger.kafka.authorizer.logger=INFO, authorizerAppender\nlog4j.additivity.kafka.authorizer.logger=false\n\nlog4j.appender.authorizerAppender=org.apache.log4j.DailyRollingFileAppender\nlog4j.appender.authorizerAppender.File=/var/log/kafka/kafka-authorizer.log\nlog4j.appender.authorizerAppender.layout=org.apache.log4j.PatternLayout\nlog4j.appender.authorizerAppender.layout.ConversionPattern=[%d] %p %m%n\n"})}),"\n",(0,l.jsx)(s.h2,{id:"\u5b89\u5168\u914d\u7f6e\u68c0\u67e5\u6e05\u5355",children:"\u5b89\u5168\u914d\u7f6e\u68c0\u67e5\u6e05\u5355"}),"\n",(0,l.jsx)(s.h3,{id:"\u751f\u4ea7\u73af\u5883\u5fc5\u5907",children:"\u751f\u4ea7\u73af\u5883\u5fc5\u5907"}),"\n",(0,l.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","\u542f\u7528 SASL \u8ba4\u8bc1"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","\u542f\u7528 TLS \u52a0\u5bc6"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","\u914d\u7f6e ACL \u6743\u9650\u63a7\u5236"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","\u7981\u7528\u533f\u540d\u8bbf\u95ee"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Broker \u95f4\u901a\u4fe1\u52a0\u5bc6"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","\u4f7f\u7528\u5f3a\u5bc6\u7801"]}),"\n"]}),"\n",(0,l.jsx)(s.h3,{id:"\u589e\u5f3a\u5b89\u5168",children:"\u589e\u5f3a\u5b89\u5168"}),"\n",(0,l.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","\u542f\u7528\u5ba2\u6237\u7aef\u8bc1\u4e66\u8ba4\u8bc1\uff08\u53cc\u5411 TLS\uff09"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","\u5b9a\u671f\u8f6e\u6362\u8bc1\u4e66\u548c\u5bc6\u7801"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","\u542f\u7528\u5ba1\u8ba1\u65e5\u5fd7"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","\u914d\u7f6e\u7f51\u7edc\u9694\u79bb"]}),"\n",(0,l.jsxs)(s.li,{className:"task-list-item",children:[(0,l.jsx)(s.input,{type:"checkbox",disabled:!0})," ","\u76d1\u63a7\u5f02\u5e38\u8bbf\u95ee"]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,l.jsx)(s.h3,{id:"q-ssl-\u63e1\u624b\u5931\u8d25\u600e\u4e48\u529e",children:"Q: SSL \u63e1\u624b\u5931\u8d25\u600e\u4e48\u529e\uff1f"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"A:"})," \u6392\u67e5\u6b65\u9aa4\uff1a"]}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsx)(s.li,{children:"\u68c0\u67e5\u8bc1\u4e66\u662f\u5426\u8fc7\u671f"}),"\n",(0,l.jsx)(s.li,{children:"\u786e\u8ba4 truststore \u5305\u542b\u6b63\u786e\u7684 CA \u8bc1\u4e66"}),"\n",(0,l.jsx)(s.li,{children:"\u68c0\u67e5\u4e3b\u673a\u540d\u662f\u5426\u5339\u914d\u8bc1\u4e66 CN"}),"\n",(0,l.jsx)(s.li,{children:"\u786e\u8ba4 TLS \u534f\u8bae\u7248\u672c\u517c\u5bb9"}),"\n"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:"# \u6d4b\u8bd5 SSL \u8fde\u63a5\nopenssl s_client -connect kafka-broker1:9093 -CAfile ca-cert\n"})}),"\n",(0,l.jsx)(s.h3,{id:"q-sasl-\u8ba4\u8bc1\u5931\u8d25\u600e\u4e48\u529e",children:"Q: SASL \u8ba4\u8bc1\u5931\u8d25\u600e\u4e48\u529e\uff1f"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"A:"})," \u6392\u67e5\u6b65\u9aa4\uff1a"]}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsx)(s.li,{children:"\u68c0\u67e5 JAAS \u914d\u7f6e\u6587\u4ef6\u8def\u5f84"}),"\n",(0,l.jsx)(s.li,{children:"\u786e\u8ba4\u7528\u6237\u540d\u5bc6\u7801\u6b63\u786e"}),"\n",(0,l.jsx)(s.li,{children:"\u68c0\u67e5 SASL \u673a\u5236\u914d\u7f6e\u4e00\u81f4"}),"\n",(0,l.jsx)(s.li,{children:"\u67e5\u770b Broker \u65e5\u5fd7"}),"\n"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-bash",children:'# \u67e5\u770b\u8ba4\u8bc1\u9519\u8bef\ngrep -i "authentication" /var/log/kafka/server.log\n'})}),"\n",(0,l.jsx)(s.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"https://kafka.apache.org/documentation/#security",children:"Kafka \u5b89\u5168\u6587\u6863"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"https://kafka.apache.org/documentation/#security_ssl",children:"SSL \u914d\u7f6e\u6307\u5357"})}),"\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"https://kafka.apache.org/documentation/#security_sasl",children:"SASL \u914d\u7f6e\u6307\u5357"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},48885:(e,s,r)=>{r.d(s,{R:()=>i,x:()=>t});var n=r(99378);const l={},a=n.createContext(l);function i(e){const s=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),n.createElement(a.Provider,{value:s},e.children)}}}]);
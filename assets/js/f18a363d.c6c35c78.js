"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[13135],{48885:(n,r,e)=>{e.d(r,{R:()=>s,x:()=>i});var o=e(99378);const t={},a=o.createContext(t);function s(n){const r=o.useContext(a);return o.useMemo(function(){return"function"==typeof n?n(r):{...r,...n}},[r,n])}function i(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:s(n.components),o.createElement(a.Provider,{value:r},n.children)}},92691:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"react/error-boundaries","title":"\u9519\u8bef\u8fb9\u754c","description":"[!TIP]","source":"@site/docs/react/error-boundaries.md","sourceDirName":"react","slug":"/react/error-boundaries","permalink":"/docs/react/error-boundaries","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/react/error-boundaries.md","tags":[],"version":"current","sidebarPosition":17,"frontMatter":{"sidebar_position":17,"title":"\u9519\u8bef\u8fb9\u754c"},"sidebar":"react","previous":{"title":"Refs \u548c DOM","permalink":"/docs/react/refs-dom"},"next":{"title":"\u7ec4\u4ef6\u7ec4\u5408\u6a21\u5f0f","permalink":"/docs/react/composition-patterns"}}');var t=e(22714),a=e(48885);const s={sidebar_position:17,title:"\u9519\u8bef\u8fb9\u754c"},i="\u9519\u8bef\u8fb9\u754c\uff08Error Boundaries\uff09",c={},l=[{value:"\ud83d\udcda \u4ec0\u4e48\u662f\u9519\u8bef\u8fb9\u754c\uff1f",id:"-\u4ec0\u4e48\u662f\u9519\u8bef\u8fb9\u754c",level:2},{value:"\u9519\u8bef\u8fb9\u754c\u7684\u4f5c\u7528",id:"\u9519\u8bef\u8fb9\u754c\u7684\u4f5c\u7528",level:3},{value:"\ud83d\udee0\ufe0f \u521b\u5efa\u9519\u8bef\u8fb9\u754c",id:"\ufe0f-\u521b\u5efa\u9519\u8bef\u8fb9\u754c",level:2},{value:"\u57fa\u7840\u5b9e\u73b0",id:"\u57fa\u7840\u5b9e\u73b0",level:3},{value:"\u4f7f\u7528\u9519\u8bef\u8fb9\u754c",id:"\u4f7f\u7528\u9519\u8bef\u8fb9\u754c",level:3},{value:"\ud83c\udfaf \u5b8c\u6574\u7684\u9519\u8bef\u8fb9\u754c\u7ec4\u4ef6",id:"-\u5b8c\u6574\u7684\u9519\u8bef\u8fb9\u754c\u7ec4\u4ef6",level:2},{value:"\u529f\u80fd\u4e30\u5bcc\u7684\u5b9e\u73b0",id:"\u529f\u80fd\u4e30\u5bcc\u7684\u5b9e\u73b0",level:3},{value:"\u4f7f\u7528\u81ea\u5b9a\u4e49\u964d\u7ea7 UI",id:"\u4f7f\u7528\u81ea\u5b9a\u4e49\u964d\u7ea7-ui",level:3},{value:"\ud83d\udd0d \u9519\u8bef\u8fb9\u754c\u7684\u9650\u5236",id:"-\u9519\u8bef\u8fb9\u754c\u7684\u9650\u5236",level:2},{value:"1. \u4e8b\u4ef6\u5904\u7406\u5668\u4e2d\u7684\u9519\u8bef",id:"1-\u4e8b\u4ef6\u5904\u7406\u5668\u4e2d\u7684\u9519\u8bef",level:3},{value:"2. \u5f02\u6b65\u4ee3\u7801\u9519\u8bef",id:"2-\u5f02\u6b65\u4ee3\u7801\u9519\u8bef",level:3},{value:"3. \u670d\u52a1\u7aef\u6e32\u67d3\u9519\u8bef",id:"3-\u670d\u52a1\u7aef\u6e32\u67d3\u9519\u8bef",level:3},{value:"4. \u9519\u8bef\u8fb9\u754c\u81ea\u8eab\u7684\u9519\u8bef",id:"4-\u9519\u8bef\u8fb9\u754c\u81ea\u8eab\u7684\u9519\u8bef",level:3},{value:"\ud83c\udfa8 \u9519\u8bef\u8fb9\u754c\u7684\u5c42\u6b21\u5316\u4f7f\u7528",id:"-\u9519\u8bef\u8fb9\u754c\u7684\u5c42\u6b21\u5316\u4f7f\u7528",level:2},{value:"\u7c92\u5ea6\u5316\u7684\u9519\u8bef\u5904\u7406",id:"\u7c92\u5ea6\u5316\u7684\u9519\u8bef\u5904\u7406",level:3},{value:"\u4e0d\u540c\u533a\u57df\u7684\u964d\u7ea7\u7b56\u7565",id:"\u4e0d\u540c\u533a\u57df\u7684\u964d\u7ea7\u7b56\u7565",level:3},{value:"\ud83d\udd27 \u4e0e\u5f02\u6b65\u9519\u8bef\u5904\u7406\u7ed3\u5408",id:"-\u4e0e\u5f02\u6b65\u9519\u8bef\u5904\u7406\u7ed3\u5408",level:2},{value:"\u81ea\u5b9a\u4e49 Hook \u5904\u7406\u5f02\u6b65\u9519\u8bef",id:"\u81ea\u5b9a\u4e49-hook-\u5904\u7406\u5f02\u6b65\u9519\u8bef",level:3},{value:"\ud83d\udcca \u4e0e React Query \u96c6\u6210",id:"-\u4e0e-react-query-\u96c6\u6210",level:2},{value:"\ud83d\udca1 \u6700\u4f73\u5b9e\u8df5",id:"-\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u5408\u7406\u7684\u9519\u8bef\u8fb9\u754c\u7c92\u5ea6",id:"1-\u5408\u7406\u7684\u9519\u8bef\u8fb9\u754c\u7c92\u5ea6",level:3},{value:"2. \u5f00\u53d1\u548c\u751f\u4ea7\u73af\u5883\u4e0d\u540c\u5904\u7406",id:"2-\u5f00\u53d1\u548c\u751f\u4ea7\u73af\u5883\u4e0d\u540c\u5904\u7406",level:3},{value:"3. \u9519\u8bef\u4e0a\u62a5",id:"3-\u9519\u8bef\u4e0a\u62a5",level:3},{value:"4. \u63d0\u4f9b\u91cd\u8bd5\u673a\u5236",id:"4-\u63d0\u4f9b\u91cd\u8bd5\u673a\u5236",level:3},{value:"\ud83d\ude80 React 19 \u7684\u6539\u8fdb",id:"-react-19-\u7684\u6539\u8fdb",level:2}];function d(n){const r={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"\u9519\u8bef\u8fb9\u754cerror-boundaries",children:"\u9519\u8bef\u8fb9\u754c\uff08Error Boundaries\uff09"})}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"[!TIP]\n\u9519\u8bef\u8fb9\u754c\u662f React \u7ec4\u4ef6\uff0c\u7528\u4e8e\u6355\u83b7\u5b50\u7ec4\u4ef6\u6811\u4e2d\u7684 JavaScript \u9519\u8bef\uff0c\u8bb0\u5f55\u9519\u8bef\u5e76\u663e\u793a\u5907\u7528 UI\u3002\u8fd9\u662f\u6784\u5efa\u5065\u58ee\u5e94\u7528\u7684\u91cd\u8981\u7279\u6027\u3002"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"-\u4ec0\u4e48\u662f\u9519\u8bef\u8fb9\u754c",children:"\ud83d\udcda \u4ec0\u4e48\u662f\u9519\u8bef\u8fb9\u754c\uff1f"}),"\n",(0,t.jsx)(r.p,{children:"\u9519\u8bef\u8fb9\u754c\u662f\u4e00\u79cd\u7279\u6b8a\u7684 React \u7ec4\u4ef6\uff0c\u53ef\u4ee5\u6355\u83b7\u53d1\u751f\u5728\u5176\u5b50\u7ec4\u4ef6\u6811\u4efb\u4f55\u4f4d\u7f6e\u7684 JavaScript \u9519\u8bef\uff0c\u5e76\u8bb0\u5f55\u8fd9\u4e9b\u9519\u8bef\uff0c\u540c\u65f6\u5c55\u793a\u964d\u7ea7 UI\u3002"}),"\n",(0,t.jsx)(r.h3,{id:"\u9519\u8bef\u8fb9\u754c\u7684\u4f5c\u7528",children:"\u9519\u8bef\u8fb9\u754c\u7684\u4f5c\u7528"}),"\n",(0,t.jsx)(r.mermaid,{value:"graph TB\n    A[App] --\x3e B[ErrorBoundary]\n    B --\x3e C[\u6b63\u5e38\u6e32\u67d3]\n    B --\x3e D[\u6355\u83b7\u9519\u8bef]\n    D --\x3e E[\u663e\u793a\u964d\u7ea7 UI]\n    D --\x3e F[\u8bb0\u5f55\u9519\u8bef\u65e5\u5fd7]\n\n    style B fill:#ffe0b2\n    style E fill:#ffcdd2\n    style F fill:#c8e6c9"}),"\n",(0,t.jsx)(r.h2,{id:"\ufe0f-\u521b\u5efa\u9519\u8bef\u8fb9\u754c",children:"\ud83d\udee0\ufe0f \u521b\u5efa\u9519\u8bef\u8fb9\u754c"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsxs)(r.p,{children:["[!WARNING]\n\u9519\u8bef\u8fb9\u754c",(0,t.jsx)(r.strong,{children:"\u5fc5\u987b"}),"\u662f\u7c7b\u7ec4\u4ef6\uff0c\u76ee\u524d\u8fd8\u6ca1\u6709 Hook \u5f62\u5f0f\u7684\u9519\u8bef\u8fb9\u754c\u3002"]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"\u57fa\u7840\u5b9e\u73b0",children:"\u57fa\u7840\u5b9e\u73b0"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:'import React from "react";\n\nclass ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { hasError: false, error: null };\n  }\n\n  // \u6355\u83b7\u9519\u8bef\uff0c\u66f4\u65b0\u72b6\u6001\n  static getDerivedStateFromError(error) {\n    return { hasError: true, error };\n  }\n\n  // \u8bb0\u5f55\u9519\u8bef\u4fe1\u606f\n  componentDidCatch(error, errorInfo) {\n    console.error("Error caught by boundary:", error, errorInfo);\n    // \u53ef\u4ee5\u53d1\u9001\u5230\u9519\u8bef\u62a5\u544a\u670d\u52a1\n    // logErrorToService(error, errorInfo);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div style={{ padding: "20px", border: "1px solid red" }}>\n          <h2>\u26a0\ufe0f \u51fa\u9519\u4e86</h2>\n          <p>\u62b1\u6b49\uff0c\u5e94\u7528\u9047\u5230\u4e86\u4e00\u4e2a\u9519\u8bef\u3002</p>\n          <details>\n            <summary>\u9519\u8bef\u8be6\u60c5</summary>\n            <pre>{this.state.error?.toString()}</pre>\n          </details>\n          <button onClick={() => this.setState({ hasError: false })}>\n            \u91cd\u8bd5\n          </button>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;\n'})}),"\n",(0,t.jsx)(r.h3,{id:"\u4f7f\u7528\u9519\u8bef\u8fb9\u754c",children:"\u4f7f\u7528\u9519\u8bef\u8fb9\u754c"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:"function App() {\n  return (\n    <ErrorBoundary>\n      <Header />\n      <MainContent />\n      <Footer />\n    </ErrorBoundary>\n  );\n}\n"})}),"\n",(0,t.jsx)(r.h2,{id:"-\u5b8c\u6574\u7684\u9519\u8bef\u8fb9\u754c\u7ec4\u4ef6",children:"\ud83c\udfaf \u5b8c\u6574\u7684\u9519\u8bef\u8fb9\u754c\u7ec4\u4ef6"}),"\n",(0,t.jsx)(r.h3,{id:"\u529f\u80fd\u4e30\u5bcc\u7684\u5b9e\u73b0",children:"\u529f\u80fd\u4e30\u5bcc\u7684\u5b9e\u73b0"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:'class ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      errorCount: 0,\n    };\n  }\n\n  static getDerivedStateFromError(error) {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    const { errorCount } = this.state;\n\n    this.setState({\n      errorInfo,\n      errorCount: errorCount + 1,\n    });\n\n    // \u8bb0\u5f55\u5230\u76d1\u63a7\u670d\u52a1\n    this.logError(error, errorInfo);\n  }\n\n  logError = (error, errorInfo) => {\n    // \u53d1\u9001\u5230 Sentry\u3001LogRocket \u7b49\u670d\u52a1\n    console.error("Error:", error);\n    console.error("Error Info:", errorInfo);\n\n    // \u793a\u4f8b\uff1a\u53d1\u9001\u5230\u670d\u52a1\u5668\n    /*\n    fetch(\'/api/log-error\', {\n      method: \'POST\',\n      headers: { \'Content-Type\': \'application/json\' },\n      body: JSON.stringify({\n        error: error.toString(),\n        errorInfo: errorInfo.componentStack,\n        timestamp: new Date().toISOString(),\n      }),\n    });\n    */\n  };\n\n  handleReset = () => {\n    this.setState({\n      hasError: false,\n      error: null,\n      errorInfo: null,\n    });\n  };\n\n  render() {\n    const { hasError, error, errorInfo, errorCount } = this.state;\n    const { fallback, children } = this.props;\n\n    if (hasError) {\n      // \u4f7f\u7528\u81ea\u5b9a\u4e49\u964d\u7ea7 UI\n      if (fallback) {\n        return fallback(error, this.handleReset);\n      }\n\n      // \u9ed8\u8ba4\u964d\u7ea7 UI\n      return (\n        <div className="error-boundary">\n          <div className="error-content">\n            <h1>\ud83d\ude22 \u51fa\u9519\u4e86</h1>\n            <p>\u5e94\u7528\u9047\u5230\u4e86\u4e00\u4e2a\u610f\u5916\u9519\u8bef\u3002</p>\n\n            {errorCount > 3 && (\n              <div className="error-warning">\n                <p>\u26a0\ufe0f \u68c0\u6d4b\u5230\u591a\u6b21\u9519\u8bef\uff0c\u53ef\u80fd\u9700\u8981\u5237\u65b0\u9875\u9762\u3002</p>\n              </div>\n            )}\n\n            {process.env.NODE_ENV === "development" && (\n              <details className="error-details">\n                <summary>\u67e5\u770b\u9519\u8bef\u8be6\u60c5</summary>\n                <pre>{error?.toString()}</pre>\n                <pre>{errorInfo?.componentStack}</pre>\n              </details>\n            )}\n\n            <div className="error-actions">\n              <button onClick={this.handleReset}>\u91cd\u8bd5</button>\n              <button onClick={() => window.location.reload()}>\u5237\u65b0\u9875\u9762</button>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return children;\n  }\n}\n'})}),"\n",(0,t.jsx)(r.h3,{id:"\u4f7f\u7528\u81ea\u5b9a\u4e49\u964d\u7ea7-ui",children:"\u4f7f\u7528\u81ea\u5b9a\u4e49\u964d\u7ea7 UI"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:'function App() {\n  return (\n    <ErrorBoundary\n      fallback={(error, reset) => (\n        <div className="custom-error">\n          <h2>\u81ea\u5b9a\u4e49\u9519\u8bef\u9875\u9762</h2>\n          <p>{error.message}</p>\n          <button onClick={reset}>\u91cd\u8bd5</button>\n        </div>\n      )}\n    >\n      <MyApp />\n    </ErrorBoundary>\n  );\n}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"-\u9519\u8bef\u8fb9\u754c\u7684\u9650\u5236",children:"\ud83d\udd0d \u9519\u8bef\u8fb9\u754c\u7684\u9650\u5236"}),"\n",(0,t.jsxs)(r.p,{children:["\u9519\u8bef\u8fb9\u754c",(0,t.jsx)(r.strong,{children:"\u65e0\u6cd5"}),"\u6355\u83b7\u4ee5\u4e0b\u9519\u8bef\uff1a"]}),"\n",(0,t.jsx)(r.h3,{id:"1-\u4e8b\u4ef6\u5904\u7406\u5668\u4e2d\u7684\u9519\u8bef",children:"1. \u4e8b\u4ef6\u5904\u7406\u5668\u4e2d\u7684\u9519\u8bef"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:'// \u274c \u9519\u8bef\u8fb9\u754c\u65e0\u6cd5\u6355\u83b7\nfunction MyComponent() {\n  const handleClick = () => {\n    throw new Error("\u4e8b\u4ef6\u5904\u7406\u5668\u9519\u8bef");\n  };\n\n  return <button onClick={handleClick}>\u70b9\u51fb</button>;\n}\n\n// \u2705 \u9700\u8981\u624b\u52a8 try-catch\nfunction MyComponent() {\n  const handleClick = () => {\n    try {\n      throw new Error("\u4e8b\u4ef6\u5904\u7406\u5668\u9519\u8bef");\n    } catch (error) {\n      console.error(error);\n      // \u5904\u7406\u9519\u8bef\n    }\n  };\n\n  return <button onClick={handleClick}>\u70b9\u51fb</button>;\n}\n'})}),"\n",(0,t.jsx)(r.h3,{id:"2-\u5f02\u6b65\u4ee3\u7801\u9519\u8bef",children:"2. \u5f02\u6b65\u4ee3\u7801\u9519\u8bef"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:'// \u274c \u9519\u8bef\u8fb9\u754c\u65e0\u6cd5\u6355\u83b7\nuseEffect(() => {\n  setTimeout(() => {\n    throw new Error("\u5f02\u6b65\u9519\u8bef");\n  }, 1000);\n}, []);\n\n// \u2705 \u4f7f\u7528 try-catch \u6216 Promise.catch\nuseEffect(() => {\n  const fetchData = async () => {\n    try {\n      const data = await fetch("/api/data");\n      // \u5904\u7406\u6570\u636e\n    } catch (error) {\n      console.error(error);\n      // \u5904\u7406\u9519\u8bef\n    }\n  };\n\n  fetchData();\n}, []);\n'})}),"\n",(0,t.jsx)(r.h3,{id:"3-\u670d\u52a1\u7aef\u6e32\u67d3\u9519\u8bef",children:"3. \u670d\u52a1\u7aef\u6e32\u67d3\u9519\u8bef"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:"// SSR \u65f6\u9700\u8981\u7279\u6b8a\u5904\u7406\n// \u9519\u8bef\u8fb9\u754c\u4e3b\u8981\u7528\u4e8e\u5ba2\u6237\u7aef\n"})}),"\n",(0,t.jsx)(r.h3,{id:"4-\u9519\u8bef\u8fb9\u754c\u81ea\u8eab\u7684\u9519\u8bef",children:"4. \u9519\u8bef\u8fb9\u754c\u81ea\u8eab\u7684\u9519\u8bef"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:"// \u9519\u8bef\u8fb9\u754c\u81ea\u5df1\u629b\u51fa\u7684\u9519\u8bef\u4f1a\u5411\u4e0a\u4f20\u64ad\n// \u9700\u8981\u5728\u66f4\u4e0a\u5c42\u518d\u5305\u88f9\u4e00\u4e2a\u9519\u8bef\u8fb9\u754c\n"})}),"\n",(0,t.jsx)(r.h2,{id:"-\u9519\u8bef\u8fb9\u754c\u7684\u5c42\u6b21\u5316\u4f7f\u7528",children:"\ud83c\udfa8 \u9519\u8bef\u8fb9\u754c\u7684\u5c42\u6b21\u5316\u4f7f\u7528"}),"\n",(0,t.jsx)(r.h3,{id:"\u7c92\u5ea6\u5316\u7684\u9519\u8bef\u5904\u7406",children:"\u7c92\u5ea6\u5316\u7684\u9519\u8bef\u5904\u7406"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:'function App() {\n  return (\n    <div className="app">\n      {/* \u9876\u5c42\u9519\u8bef\u8fb9\u754c */}\n      <ErrorBoundary fallback={<GlobalErrorPage />}>\n        <Header /> {/* Header \u7684\u9519\u8bef\u4e0d\u5f71\u54cd\u6574\u4e2a\u5e94\u7528 */}\n        {/* \u5c40\u90e8\u9519\u8bef\u8fb9\u754c */}\n        <ErrorBoundary fallback={<SidebarError />}>\n          <Sidebar />\n        </ErrorBoundary>\n        {/* \u4e3b\u5185\u5bb9\u533a\u9519\u8bef\u8fb9\u754c */}\n        <ErrorBoundary fallback={<ContentError />}>\n          <MainContent />\n        </ErrorBoundary>\n        <Footer />\n      </ErrorBoundary>\n    </div>\n  );\n}\n'})}),"\n",(0,t.jsx)(r.h3,{id:"\u4e0d\u540c\u533a\u57df\u7684\u964d\u7ea7\u7b56\u7565",children:"\u4e0d\u540c\u533a\u57df\u7684\u964d\u7ea7\u7b56\u7565"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:'function Dashboard() {\n  return (\n    <div className="dashboard">\n      {/* \u5173\u952e\u529f\u80fd\uff1a\u663e\u793a\u5b8c\u6574\u9519\u8bef */}\n      <ErrorBoundary\n        fallback={(error, reset) => (\n          <div className="critical-error">\n            <h2>\u6838\u5fc3\u529f\u80fd\u51fa\u9519</h2>\n            <p>{error.message}</p>\n            <button onClick={reset}>\u91cd\u8bd5</button>\n          </div>\n        )}\n      >\n        <CriticalWidget />\n      </ErrorBoundary>\n\n      {/* \u975e\u5173\u952e\u529f\u80fd\uff1a\u7b80\u5355\u63d0\u793a */}\n      <ErrorBoundary\n        fallback={() => (\n          <div className="minor-error">\n            <p>\u6b64\u90e8\u5206\u6682\u65f6\u4e0d\u53ef\u7528</p>\n          </div>\n        )}\n      >\n        <OptionalWidget />\n      </ErrorBoundary>\n    </div>\n  );\n}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"-\u4e0e\u5f02\u6b65\u9519\u8bef\u5904\u7406\u7ed3\u5408",children:"\ud83d\udd27 \u4e0e\u5f02\u6b65\u9519\u8bef\u5904\u7406\u7ed3\u5408"}),"\n",(0,t.jsx)(r.h3,{id:"\u81ea\u5b9a\u4e49-hook-\u5904\u7406\u5f02\u6b65\u9519\u8bef",children:"\u81ea\u5b9a\u4e49 Hook \u5904\u7406\u5f02\u6b65\u9519\u8bef"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:'function useAsyncError() {\n  const [, setError] = useState();\n\n  return useCallback((error) => {\n    setError(() => {\n      throw error; // \u89e6\u53d1\u9519\u8bef\u8fb9\u754c\n    });\n  }, []);\n}\n\n// \u4f7f\u7528\nfunction MyComponent() {\n  const throwError = useAsyncError();\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const res = await fetch("/api/data");\n        if (!res.ok) throw new Error("\u8bf7\u6c42\u5931\u8d25");\n        const data = await res.json();\n        // \u5904\u7406\u6570\u636e\n      } catch (error) {\n        throwError(error); // \u629b\u7ed9\u9519\u8bef\u8fb9\u754c\u5904\u7406\n      }\n    };\n\n    fetchData();\n  }, [throwError]);\n\n  return <div>\u5185\u5bb9</div>;\n}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"-\u4e0e-react-query-\u96c6\u6210",children:"\ud83d\udcca \u4e0e React Query \u96c6\u6210"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:'import { QueryErrorResetBoundary } from "@tanstack/react-query";\n\nfunction App() {\n  return (\n    <QueryErrorResetBoundary>\n      {({ reset }) => (\n        <ErrorBoundary\n          onReset={reset}\n          fallback={(error, resetError) => (\n            <div>\n              <p>\u67e5\u8be2\u51fa\u9519: {error.message}</p>\n              <button onClick={resetError}>\u91cd\u8bd5</button>\n            </div>\n          )}\n        >\n          <DataComponent />\n        </ErrorBoundary>\n      )}\n    </QueryErrorResetBoundary>\n  );\n}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"-\u6700\u4f73\u5b9e\u8df5",children:"\ud83d\udca1 \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,t.jsx)(r.h3,{id:"1-\u5408\u7406\u7684\u9519\u8bef\u8fb9\u754c\u7c92\u5ea6",children:"1. \u5408\u7406\u7684\u9519\u8bef\u8fb9\u754c\u7c92\u5ea6"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:'// \u2713 \u597d\uff1a\u5206\u5c42\u6b21\u7684\u9519\u8bef\u8fb9\u754c\nfunction App() {\n  return (\n    <ErrorBoundary>\n      {" "}\n      {/* \u5168\u5c40\u9519\u8bef */}\n      <Layout>\n        <ErrorBoundary>\n          {" "}\n          {/* \u9875\u9762\u7ea7\u9519\u8bef */}\n          <Page>\n            <ErrorBoundary>\n              {" "}\n              {/* \u7ec4\u4ef6\u7ea7\u9519\u8bef */}\n              <ComplexWidget />\n            </ErrorBoundary>\n          </Page>\n        </ErrorBoundary>\n      </Layout>\n    </ErrorBoundary>\n  );\n}\n\n// \u2717 \u4e0d\u597d\uff1a\u6240\u6709\u7ec4\u4ef6\u7528\u4e00\u4e2a\u9519\u8bef\u8fb9\u754c\n<ErrorBoundary>\n  <Component1 />\n  <Component2 />\n  <Component3 />\n</ErrorBoundary>;\n'})}),"\n",(0,t.jsx)(r.h3,{id:"2-\u5f00\u53d1\u548c\u751f\u4ea7\u73af\u5883\u4e0d\u540c\u5904\u7406",children:"2. \u5f00\u53d1\u548c\u751f\u4ea7\u73af\u5883\u4e0d\u540c\u5904\u7406"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:'class ErrorBoundary extends React.Component {\n  render() {\n    if (this.state.hasError) {\n      if (process.env.NODE_ENV === "development") {\n        // \u5f00\u53d1\u73af\u5883\uff1a\u663e\u793a\u8be6\u7ec6\u9519\u8bef\u4fe1\u606f\n        return (\n          <div>\n            <h2>\u5f00\u53d1\u6a21\u5f0f - \u9519\u8bef\u8be6\u60c5</h2>\n            <pre>{this.state.error.stack}</pre>\n            <pre>{this.state.errorInfo.componentStack}</pre>\n          </div>\n        );\n      } else {\n        // \u751f\u4ea7\u73af\u5883\uff1a\u7528\u6237\u53cb\u597d\u7684\u63d0\u793a\n        return (\n          <div>\n            <h2>\u62b1\u6b49\uff0c\u51fa\u73b0\u4e86\u9519\u8bef</h2>\n            <p>\u6211\u4eec\u5df2\u8bb0\u5f55\u6b64\u95ee\u9898\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002</p>\n            <button onClick={() => (window.location.href = "/")}>\n              \u8fd4\u56de\u9996\u9875\n            </button>\n          </div>\n        );\n      }\n    }\n\n    return this.props.children;\n  }\n}\n'})}),"\n",(0,t.jsx)(r.h3,{id:"3-\u9519\u8bef\u4e0a\u62a5",children:"3. \u9519\u8bef\u4e0a\u62a5"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:"componentDidCatch(error, errorInfo) {\n  // \u4e0a\u62a5\u5230\u9519\u8bef\u76d1\u63a7\u670d\u52a1\n  if (window.Sentry) {\n    window.Sentry.captureException(error, {\n      contexts: {\n        react: {\n          componentStack: errorInfo.componentStack,\n        },\n      },\n    });\n  }\n\n  // \u6216\u4f7f\u7528\u5176\u4ed6\u670d\u52a1\n  logErrorToService({\n    error: error.toString(),\n    stack: error.stack,\n    componentStack: errorInfo.componentStack,\n    userAgent: navigator.userAgent,\n    timestamp: new Date().toISOString(),\n  });\n}\n"})}),"\n",(0,t.jsx)(r.h3,{id:"4-\u63d0\u4f9b\u91cd\u8bd5\u673a\u5236",children:"4. \u63d0\u4f9b\u91cd\u8bd5\u673a\u5236"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:"class ErrorBoundary extends React.Component {\n  state = { hasError: false, retryCount: 0 };\n\n  static getDerivedStateFromError(error) {\n    return { hasError: true };\n  }\n\n  handleRetry = () => {\n    this.setState((prev) => ({\n      hasError: false,\n      retryCount: prev.retryCount + 1,\n    }));\n  };\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div>\n          <h2>\u51fa\u9519\u4e86</h2>\n          {this.state.retryCount < 3 ? (\n            <button onClick={this.handleRetry}>\n              \u91cd\u8bd5 ({this.state.retryCount}/3)\n            </button>\n          ) : (\n            <p>\u591a\u6b21\u91cd\u8bd5\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u6216\u8054\u7cfb\u5ba2\u670d\u3002</p>\n          )}\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n"})}),"\n",(0,t.jsx)(r.h2,{id:"-react-19-\u7684\u6539\u8fdb",children:"\ud83d\ude80 React 19 \u7684\u6539\u8fdb"}),"\n",(0,t.jsx)(r.p,{children:"React 19 \u5bf9\u9519\u8bef\u5904\u7406\u505a\u4e86\u4e00\u4e9b\u6539\u8fdb\uff1a"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-jsx",children:"// React 19: \u66f4\u597d\u7684\u9519\u8bef\u6062\u590d\nfunction App() {\n  return (\n    <ErrorBoundary\n      fallback={<ErrorUI />}\n      onError={(error, errorInfo) => {\n        // \u65b0\u7684 onError \u56de\u8c03\n        logError(error, errorInfo);\n      }}\n    >\n      <MyApp />\n    </ErrorBoundary>\n  );\n}\n"})}),"\n",(0,t.jsx)(r.hr,{}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"\u4e0b\u4e00\u6b65"}),"\uff1a\u5b66\u4e60 ",(0,t.jsx)(r.a,{href:"/docs/react/composition-patterns",children:"\u7ec4\u4ef6\u7ec4\u5408\u6a21\u5f0f"})," \u638c\u63e1\u9ad8\u7ea7\u7ec4\u4ef6\u8bbe\u8ba1\uff0c\u6216\u67e5\u770b ",(0,t.jsx)(r.a,{href:"/docs/react/performance-optimization",children:"\u6027\u80fd\u4f18\u5316"})," \u63d0\u5347\u5e94\u7528\u6027\u80fd\u3002"]})]})}function u(n={}){const{wrapper:r}={...(0,a.R)(),...n.components};return r?(0,t.jsx)(r,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}}}]);
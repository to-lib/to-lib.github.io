"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[88958],{46012:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>l,frontMatter:()=>a,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"nginx/reverse-proxy","title":"\u53cd\u5411\u4ee3\u7406","description":"Nginx \u53cd\u5411\u4ee3\u7406\u914d\u7f6e\u8be6\u89e3","source":"@site/docs/nginx/reverse-proxy.md","sourceDirName":"nginx","slug":"/nginx/reverse-proxy","permalink":"/docs/nginx/reverse-proxy","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/nginx/reverse-proxy.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"\u53cd\u5411\u4ee3\u7406","description":"Nginx \u53cd\u5411\u4ee3\u7406\u914d\u7f6e\u8be6\u89e3"},"sidebar":"nginx","previous":{"title":"\u9759\u6001\u6587\u4ef6\u670d\u52a1","permalink":"/docs/nginx/static-files"},"next":{"title":"\u8d1f\u8f7d\u5747\u8861","permalink":"/docs/nginx/load-balancing"}}');var t=r(22714),s=r(48885);const a={sidebar_position:5,title:"\u53cd\u5411\u4ee3\u7406",description:"Nginx \u53cd\u5411\u4ee3\u7406\u914d\u7f6e\u8be6\u89e3"},i="\u53cd\u5411\u4ee3\u7406",d={},c=[{value:"\u57fa\u672c\u914d\u7f6e",id:"\u57fa\u672c\u914d\u7f6e",level:2},{value:"Proxy \u6307\u4ee4\u8be6\u89e3",id:"proxy-\u6307\u4ee4\u8be6\u89e3",level:2},{value:"WebSocket \u4ee3\u7406",id:"websocket-\u4ee3\u7406",level:2},{value:"Upstream \u914d\u7f6e",id:"upstream-\u914d\u7f6e",level:2},{value:"\u4ee3\u7406\u7f13\u5b58",id:"\u4ee3\u7406\u7f13\u5b58",level:2},{value:"\u4f20\u9012\u771f\u5b9e IP",id:"\u4f20\u9012\u771f\u5b9e-ip",level:2}];function p(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\u53cd\u5411\u4ee3\u7406",children:"\u53cd\u5411\u4ee3\u7406"})}),"\n",(0,t.jsx)(n.h2,{id:"\u57fa\u672c\u914d\u7f6e",children:"\u57fa\u672c\u914d\u7f6e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-nginx",children:"server {\n    listen 80;\n    server_name api.example.com;\n\n    location / {\n        proxy_pass http://localhost:3000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"proxy-\u6307\u4ee4\u8be6\u89e3",children:"Proxy \u6307\u4ee4\u8be6\u89e3"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-nginx",children:"location /api/ {\n    proxy_pass http://backend:8080/;\n\n    # \u8bf7\u6c42\u5934\u8bbe\u7f6e\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n\n    # \u8d85\u65f6\u8bbe\u7f6e\n    proxy_connect_timeout 60s;\n    proxy_send_timeout 60s;\n    proxy_read_timeout 60s;\n\n    # \u7f13\u51b2\u8bbe\u7f6e\n    proxy_buffering on;\n    proxy_buffer_size 4k;\n    proxy_buffers 8 32k;\n\n    # HTTP \u7248\u672c\n    proxy_http_version 1.1;\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"websocket-\u4ee3\u7406",children:"WebSocket \u4ee3\u7406"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-nginx",children:"map $http_upgrade $connection_upgrade {\n    default upgrade;\n    '' close;\n}\n\nlocation /ws/ {\n    proxy_pass http://websocket_server;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection $connection_upgrade;\n    proxy_read_timeout 3600s;\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"upstream-\u914d\u7f6e",children:"Upstream \u914d\u7f6e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-nginx",children:'upstream backend {\n    server 192.168.1.10:8080;\n    server 192.168.1.11:8080;\n    keepalive 32;\n}\n\nserver {\n    location / {\n        proxy_pass http://backend;\n        proxy_http_version 1.1;\n        proxy_set_header Connection "";\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u4ee3\u7406\u7f13\u5b58",children:"\u4ee3\u7406\u7f13\u5b58"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-nginx",children:"proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m max_size=1g;\n\nlocation /api/ {\n    proxy_pass http://backend;\n    proxy_cache my_cache;\n    proxy_cache_valid 200 10m;\n    add_header X-Cache-Status $upstream_cache_status;\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u4f20\u9012\u771f\u5b9e-ip",children:"\u4f20\u9012\u771f\u5b9e IP"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-nginx",children:"set_real_ip_from 10.0.0.0/8;\nreal_ip_header X-Forwarded-For;\nreal_ip_recursive on;\n"})})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},48885:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>i});var o=r(99378);const t={},s=o.createContext(t);function a(e){const n=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);
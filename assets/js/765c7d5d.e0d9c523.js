"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[74530],{48885:(n,e,l)=>{l.d(e,{R:()=>c,x:()=>a});var s=l(99378);const i={},d=s.createContext(i);function c(n){const e=s.useContext(d);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:c(n.components),s.createElement(d.Provider,{value:e},n.children)}},49621:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>E});const s=JSON.parse('{"id":"mysql/transactions","title":"\u4e8b\u52a1\u5904\u7406","description":"[!TIP] > \u6570\u636e\u4e00\u81f4\u6027\u4fdd\u969c: \u4e8b\u52a1\u662f\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\u548c\u5b8c\u6574\u6027\u7684\u6838\u5fc3\u673a\u5236\u3002\u7406\u89e3 ACID \u7279\u6027\u3001\u9694\u79bb\u7ea7\u522b\u548c\u9501\u673a\u5236\u662f\u638c\u63e1 MySQL \u7684\u5173\u952e\u3002","source":"@site/docs/mysql/transactions.md","sourceDirName":"mysql","slug":"/mysql/transactions","permalink":"/docs/mysql/transactions","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/mysql/transactions.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"\u4e8b\u52a1\u5904\u7406"},"sidebar":"mysql","previous":{"title":"\u7d22\u5f15\u4f18\u5316","permalink":"/docs/mysql/indexes"},"next":{"title":"\u9501\u673a\u5236\u8be6\u89e3","permalink":"/docs/mysql/locks"}}');var i=l(22714),d=l(48885);const c={sidebar_position:6,title:"\u4e8b\u52a1\u5904\u7406"},a="MySQL \u4e8b\u52a1\u5904\u7406",r={},E=[{value:"\u4e8b\u52a1\u57fa\u7840",id:"\u4e8b\u52a1\u57fa\u7840",level:2},{value:"\u4ec0\u4e48\u662f\u4e8b\u52a1",id:"\u4ec0\u4e48\u662f\u4e8b\u52a1",level:3},{value:"ACID \u7279\u6027",id:"acid-\u7279\u6027",level:3},{value:"Atomicity (\u539f\u5b50\u6027)",id:"atomicity-\u539f\u5b50\u6027",level:4},{value:"Consistency (\u4e00\u81f4\u6027)",id:"consistency-\u4e00\u81f4\u6027",level:4},{value:"Isolation (\u9694\u79bb\u6027)",id:"isolation-\u9694\u79bb\u6027",level:4},{value:"Durability (\u6301\u4e45\u6027)",id:"durability-\u6301\u4e45\u6027",level:4},{value:"\u4e8b\u52a1\u64cd\u4f5c",id:"\u4e8b\u52a1\u64cd\u4f5c",level:2},{value:"\u5f00\u542f\u4e8b\u52a1",id:"\u5f00\u542f\u4e8b\u52a1",level:3},{value:"\u63d0\u4ea4\u4e8b\u52a1",id:"\u63d0\u4ea4\u4e8b\u52a1",level:3},{value:"\u56de\u6eda\u4e8b\u52a1",id:"\u56de\u6eda\u4e8b\u52a1",level:3},{value:"\u4fdd\u5b58\u70b9",id:"\u4fdd\u5b58\u70b9",level:3},{value:"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b",id:"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b",level:2},{value:"\u56db\u5927\u9694\u79bb\u7ea7\u522b",id:"\u56db\u5927\u9694\u79bb\u7ea7\u522b",level:3},{value:"\u5e76\u53d1\u95ee\u9898",id:"\u5e76\u53d1\u95ee\u9898",level:3},{value:"\u810f\u8bfb (Dirty Read)",id:"\u810f\u8bfb-dirty-read",level:4},{value:"\u4e0d\u53ef\u91cd\u590d\u8bfb (Non-Repeatable Read)",id:"\u4e0d\u53ef\u91cd\u590d\u8bfb-non-repeatable-read",level:4},{value:"\u5e7b\u8bfb (Phantom Read)",id:"\u5e7b\u8bfb-phantom-read",level:4},{value:"\u8bbe\u7f6e\u9694\u79bb\u7ea7\u522b",id:"\u8bbe\u7f6e\u9694\u79bb\u7ea7\u522b",level:3},{value:"\u9694\u79bb\u7ea7\u522b\u793a\u4f8b",id:"\u9694\u79bb\u7ea7\u522b\u793a\u4f8b",level:3},{value:"READ UNCOMMITTED",id:"read-uncommitted",level:4},{value:"READ COMMITTED",id:"read-committed",level:4},{value:"REPEATABLE READ (MySQL \u9ed8\u8ba4)",id:"repeatable-read-mysql-\u9ed8\u8ba4",level:4},{value:"\u9501\u673a\u5236",id:"\u9501\u673a\u5236",level:2},{value:"\u9501\u7684\u5206\u7c7b",id:"\u9501\u7684\u5206\u7c7b",level:3},{value:"\u6309\u9501\u7c92\u5ea6\u5206\u7c7b",id:"\u6309\u9501\u7c92\u5ea6\u5206\u7c7b",level:4},{value:"\u6309\u9501\u6a21\u5f0f\u5206\u7c7b",id:"\u6309\u9501\u6a21\u5f0f\u5206\u7c7b",level:4},{value:"\u8868\u9501",id:"\u8868\u9501",level:3},{value:"\u884c\u9501 (InnoDB)",id:"\u884c\u9501-innodb",level:3},{value:"\u5171\u4eab\u9501 (S \u9501)",id:"\u5171\u4eab\u9501-s-\u9501",level:4},{value:"\u6392\u5b83\u9501 (X \u9501)",id:"\u6392\u5b83\u9501-x-\u9501",level:4},{value:"\u610f\u5411\u9501",id:"\u610f\u5411\u9501",level:4},{value:"\u95f4\u9699\u9501 (Gap Lock)",id:"\u95f4\u9699\u9501-gap-lock",level:3},{value:"Next-Key Lock",id:"next-key-lock",level:3},{value:"\u6b7b\u9501",id:"\u6b7b\u9501",level:2},{value:"\u4ec0\u4e48\u662f\u6b7b\u9501",id:"\u4ec0\u4e48\u662f\u6b7b\u9501",level:3},{value:"\u67e5\u770b\u6b7b\u9501",id:"\u67e5\u770b\u6b7b\u9501",level:3},{value:"\u907f\u514d\u6b7b\u9501",id:"\u907f\u514d\u6b7b\u9501",level:3},{value:"MVCC (\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236)",id:"mvcc-\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236",level:2},{value:"MVCC \u539f\u7406",id:"mvcc-\u539f\u7406",level:3},{value:"\u9690\u85cf\u5217",id:"\u9690\u85cf\u5217",level:3},{value:"Read View",id:"read-view",level:3},{value:"\u4e8b\u52a1\u65e5\u5fd7",id:"\u4e8b\u52a1\u65e5\u5fd7",level:2},{value:"Undo Log (\u56de\u6eda\u65e5\u5fd7)",id:"undo-log-\u56de\u6eda\u65e5\u5fd7",level:3},{value:"Redo Log (\u91cd\u505a\u65e5\u5fd7)",id:"redo-log-\u91cd\u505a\u65e5\u5fd7",level:3},{value:"Binlog (\u4e8c\u8fdb\u5236\u65e5\u5fd7)",id:"binlog-\u4e8c\u8fdb\u5236\u65e5\u5fd7",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u4e8b\u52a1\u4f7f\u7528\u89c4\u8303",id:"\u4e8b\u52a1\u4f7f\u7528\u89c4\u8303",level:3},{value:"\u793a\u4f8b\uff1a\u89c4\u8303\u7684\u4e8b\u52a1\u5904\u7406",id:"\u793a\u4f8b\u89c4\u8303\u7684\u4e8b\u52a1\u5904\u7406",level:3},{value:"\u9519\u8bef\u5904\u7406",id:"\u9519\u8bef\u5904\u7406",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function T(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"mysql-\u4e8b\u52a1\u5904\u7406",children:"MySQL \u4e8b\u52a1\u5904\u7406"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.p,{children:["[!TIP] > ",(0,i.jsx)(e.strong,{children:"\u6570\u636e\u4e00\u81f4\u6027\u4fdd\u969c"}),": \u4e8b\u52a1\u662f\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\u548c\u5b8c\u6574\u6027\u7684\u6838\u5fc3\u673a\u5236\u3002\u7406\u89e3 ACID \u7279\u6027\u3001\u9694\u79bb\u7ea7\u522b\u548c\u9501\u673a\u5236\u662f\u638c\u63e1 MySQL \u7684\u5173\u952e\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"\u4e8b\u52a1\u57fa\u7840",children:"\u4e8b\u52a1\u57fa\u7840"}),"\n",(0,i.jsx)(e.h3,{id:"\u4ec0\u4e48\u662f\u4e8b\u52a1",children:"\u4ec0\u4e48\u662f\u4e8b\u52a1"}),"\n",(0,i.jsx)(e.p,{children:"\u4e8b\u52a1\u662f\u4e00\u7ec4 SQL \u64cd\u4f5c\u7684\u96c6\u5408\uff0c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002\u7ecf\u5178\u4f8b\u5b50\uff1a\u94f6\u884c\u8f6c\u8d26\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u8f6c\u8d26\u793a\u4f8b\nSTART TRANSACTION;\n\nUPDATE accounts SET balance = balance - 100 WHERE user_id = 1;  -- \u6263\u6b3e\nUPDATE accounts SET balance = balance + 100 WHERE user_id = 2;  -- \u5165\u8d26\n\nCOMMIT;  -- \u63d0\u4ea4\u4e8b\u52a1\n"})}),"\n",(0,i.jsx)(e.h3,{id:"acid-\u7279\u6027",children:"ACID \u7279\u6027"}),"\n",(0,i.jsx)(e.h4,{id:"atomicity-\u539f\u5b50\u6027",children:"Atomicity (\u539f\u5b50\u6027)"}),"\n",(0,i.jsx)(e.p,{children:"\u4e8b\u52a1\u662f\u4e0d\u53ef\u5206\u5272\u7684\u6700\u5c0f\u5355\u4f4d\uff0c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"START TRANSACTION;\n\nINSERT INTO orders (user_id, amount) VALUES (1, 100);\nINSERT INTO order_items (order_id, product_id) VALUES (LAST_INSERT_ID(), 10);\n\n-- \u5982\u679c\u4efb\u4f55\u4e00\u6761\u5931\u8d25\uff0c\u6574\u4e2a\u4e8b\u52a1\u56de\u6eda\nROLLBACK;  -- \u6216 COMMIT;\n"})}),"\n",(0,i.jsx)(e.h4,{id:"consistency-\u4e00\u81f4\u6027",children:"Consistency (\u4e00\u81f4\u6027)"}),"\n",(0,i.jsx)(e.p,{children:"\u4e8b\u52a1\u524d\u540e\uff0c\u6570\u636e\u4fdd\u6301\u4e00\u81f4\u72b6\u6001\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u8f6c\u8d26\u524d\u540e\uff0c\u603b\u91d1\u989d\u4e0d\u53d8\n-- A: 1000, B: 500, Total: 1500\n-- A: 900,  B: 600, Total: 1500 (\u4e00\u81f4)\n"})}),"\n",(0,i.jsx)(e.h4,{id:"isolation-\u9694\u79bb\u6027",children:"Isolation (\u9694\u79bb\u6027)"}),"\n",(0,i.jsx)(e.p,{children:"\u5e76\u53d1\u4e8b\u52a1\u4e4b\u95f4\u76f8\u4e92\u9694\u79bb\uff0c\u4e92\u4e0d\u5e72\u6270\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4e8b\u52a11\nSTART TRANSACTION;\nUPDATE accounts SET balance = balance - 100 WHERE id = 1;\n-- ... \u5176\u4ed6\u64cd\u4f5c\n\n-- \u4e8b\u52a12 \u770b\u4e0d\u5230\u4e8b\u52a11\u672a\u63d0\u4ea4\u7684\u4fee\u6539\nSTART TRANSACTION;\nSELECT balance FROM accounts WHERE id = 1;  -- \u770b\u5230\u539f\u59cb\u503c\n"})}),"\n",(0,i.jsx)(e.h4,{id:"durability-\u6301\u4e45\u6027",children:"Durability (\u6301\u4e45\u6027)"}),"\n",(0,i.jsx)(e.p,{children:"\u4e8b\u52a1\u4e00\u65e6\u63d0\u4ea4\uff0c\u4fee\u6539\u6c38\u4e45\u4fdd\u5b58\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"COMMIT;  -- \u63d0\u4ea4\u540e\uff0c\u5373\u4f7f\u6570\u636e\u5e93\u5d29\u6e83\uff0c\u6570\u636e\u4e5f\u4e0d\u4f1a\u4e22\u5931\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u4e8b\u52a1\u64cd\u4f5c",children:"\u4e8b\u52a1\u64cd\u4f5c"}),"\n",(0,i.jsx)(e.h3,{id:"\u5f00\u542f\u4e8b\u52a1",children:"\u5f00\u542f\u4e8b\u52a1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u65b9\u5f0f1\uff1a\u663e\u5f0f\u5f00\u542f\nSTART TRANSACTION;\n-- \u6216\nBEGIN;\n\n-- \u65b9\u5f0f2\uff1a\u8bbe\u7f6e\u81ea\u52a8\u63d0\u4ea4\nSET autocommit = 0;  -- \u5173\u95ed\u81ea\u52a8\u63d0\u4ea4\n-- \u4e4b\u540e\u6bcf\u6761 SQL \u90fd\u5728\u4e8b\u52a1\u4e2d\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u63d0\u4ea4\u4e8b\u52a1",children:"\u63d0\u4ea4\u4e8b\u52a1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"COMMIT;  -- \u63d0\u4ea4\u6240\u6709\u4fee\u6539\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u56de\u6eda\u4e8b\u52a1",children:"\u56de\u6eda\u4e8b\u52a1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"ROLLBACK;  -- \u64a4\u9500\u6240\u6709\u4fee\u6539\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u4fdd\u5b58\u70b9",children:"\u4fdd\u5b58\u70b9"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:'START TRANSACTION;\n\nINSERT INTO users (username) VALUES (\'\u5f20\u4e09\');\nSAVEPOINT sp1;  -- \u4fdd\u5b58\u70b91\n\nINSERT INTO users (username) VALUES (\'\u674e\u56db\');\nSAVEPOINT sp2;  -- \u4fdd\u5b58\u70b92\n\nINSERT INTO users (username) VALUES (\'\u738b\u4e94\');\n\nROLLBACK TO sp2;  -- \u56de\u6eda\u5230\u4fdd\u5b58\u70b92\uff08\u64a4\u9500"\u738b\u4e94"\uff09\nROLLBACK TO sp1;  -- \u56de\u6eda\u5230\u4fdd\u5b58\u70b91\uff08\u64a4\u9500"\u674e\u56db"\u548c"\u738b\u4e94"\uff09\n\nCOMMIT;  -- \u53ea\u63d0\u4ea4"\u5f20\u4e09"\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b",children:"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b"}),"\n",(0,i.jsx)(e.h3,{id:"\u56db\u5927\u9694\u79bb\u7ea7\u522b",children:"\u56db\u5927\u9694\u79bb\u7ea7\u522b"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u9694\u79bb\u7ea7\u522b"}),(0,i.jsx)(e.th,{children:"\u810f\u8bfb"}),(0,i.jsx)(e.th,{children:"\u4e0d\u53ef\u91cd\u590d\u8bfb"}),(0,i.jsx)(e.th,{children:"\u5e7b\u8bfb"}),(0,i.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"READ UNCOMMITTED"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u8bfb\u672a\u63d0\u4ea4"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"READ COMMITTED"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u8bfb\u5df2\u63d0\u4ea4"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"REPEATABLE READ"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u53ef\u91cd\u590d\u8bfb\uff08MySQL \u9ed8\u8ba4\uff09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"SERIALIZABLE"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u4e32\u884c\u5316"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"\u5e76\u53d1\u95ee\u9898",children:"\u5e76\u53d1\u95ee\u9898"}),"\n",(0,i.jsx)(e.h4,{id:"\u810f\u8bfb-dirty-read",children:"\u810f\u8bfb (Dirty Read)"}),"\n",(0,i.jsx)(e.p,{children:"\u8bfb\u53d6\u5230\u5176\u4ed6\u4e8b\u52a1\u672a\u63d0\u4ea4\u7684\u6570\u636e\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4e8b\u52a1A\nSTART TRANSACTION;\nUPDATE accounts SET balance = 1000 WHERE id = 1;\n-- \u672a\u63d0\u4ea4\n\n-- \u4e8b\u52a1B\uff08READ UNCOMMITTED\uff09\nSTART TRANSACTION;\nSELECT balance FROM accounts WHERE id = 1;  -- \u8bfb\u52301000\uff08\u810f\u8bfb\uff09\n\n-- \u4e8b\u52a1A\u56de\u6eda\nROLLBACK;  -- balance \u6062\u590d\u539f\u503c\uff0c\u4e8b\u52a1B\u8bfb\u5230\u7684\u6570\u636e\u65e0\u6548\n"})}),"\n",(0,i.jsx)(e.h4,{id:"\u4e0d\u53ef\u91cd\u590d\u8bfb-non-repeatable-read",children:"\u4e0d\u53ef\u91cd\u590d\u8bfb (Non-Repeatable Read)"}),"\n",(0,i.jsx)(e.p,{children:"\u540c\u4e00\u4e8b\u52a1\u4e2d\uff0c\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6570\u636e\u7ed3\u679c\u4e0d\u540c\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4e8b\u52a1A\nSTART TRANSACTION;\nSELECT balance FROM accounts WHERE id = 1;  -- \u8bfb\u5230500\n\n-- \u4e8b\u52a1B\nSTART TRANSACTION;\nUPDATE accounts SET balance = 1000 WHERE id = 1;\nCOMMIT;\n\n-- \u4e8b\u52a1A\nSELECT balance FROM accounts WHERE id = 1;  -- \u8bfb\u52301000\uff08\u4e0d\u53ef\u91cd\u590d\u8bfb\uff09\n"})}),"\n",(0,i.jsx)(e.h4,{id:"\u5e7b\u8bfb-phantom-read",children:"\u5e7b\u8bfb (Phantom Read)"}),"\n",(0,i.jsx)(e.p,{children:"\u540c\u4e00\u4e8b\u52a1\u4e2d\uff0c\u591a\u6b21\u67e5\u8be2\u8bb0\u5f55\u6570\u4e0d\u540c\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4e8b\u52a1A\nSTART TRANSACTION;\nSELECT COUNT(*) FROM users WHERE age > 18;  -- \u7ed3\u679c\uff1a100\n\n-- \u4e8b\u52a1B\nSTART TRANSACTION;\nINSERT INTO users (age) VALUES (20);\nCOMMIT;\n\n-- \u4e8b\u52a1A\nSELECT COUNT(*) FROM users WHERE age > 18;  -- \u7ed3\u679c\uff1a101\uff08\u5e7b\u8bfb\uff09\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u8bbe\u7f6e\u9694\u79bb\u7ea7\u522b",children:"\u8bbe\u7f6e\u9694\u79bb\u7ea7\u522b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u67e5\u770b\u5168\u5c40\u9694\u79bb\u7ea7\u522b\nSELECT @@global.transaction_isolation;\n\n-- \u67e5\u770b\u4f1a\u8bdd\u9694\u79bb\u7ea7\u522b\nSELECT @@transaction_isolation;\n\n-- \u8bbe\u7f6e\u4f1a\u8bdd\u9694\u79bb\u7ea7\u522b\nSET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;\nSET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;\nSET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;\n\n-- \u8bbe\u7f6e\u5168\u5c40\u9694\u79bb\u7ea7\u522b\nSET GLOBAL TRANSACTION ISOLATION LEVEL REPEATABLE READ;\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u9694\u79bb\u7ea7\u522b\u793a\u4f8b",children:"\u9694\u79bb\u7ea7\u522b\u793a\u4f8b"}),"\n",(0,i.jsx)(e.h4,{id:"read-uncommitted",children:"READ UNCOMMITTED"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4f1a\u8bdd1\nSET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;\nSTART TRANSACTION;\nSELECT balance FROM accounts WHERE id = 1;  -- 500\n\n-- \u4f1a\u8bdd2\nSTART TRANSACTION;\nUPDATE accounts SET balance = 1000 WHERE id = 1;  -- \u672a\u63d0\u4ea4\n\n-- \u4f1a\u8bdd1\nSELECT balance FROM accounts WHERE id = 1;  -- 1000\uff08\u810f\u8bfb\uff09\n"})}),"\n",(0,i.jsx)(e.h4,{id:"read-committed",children:"READ COMMITTED"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4f1a\u8bdd1\nSET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;\nSTART TRANSACTION;\nSELECT balance FROM accounts WHERE id = 1;  -- 500\n\n-- \u4f1a\u8bdd2\nSTART TRANSACTION;\nUPDATE accounts SET balance = 1000 WHERE id = 1;\nCOMMIT;\n\n-- \u4f1a\u8bdd1\nSELECT balance FROM accounts WHERE id = 1;  -- 1000\uff08\u4e0d\u53ef\u91cd\u590d\u8bfb\uff0c\u4f46\u4e0d\u662f\u810f\u8bfb\uff09\n"})}),"\n",(0,i.jsx)(e.h4,{id:"repeatable-read-mysql-\u9ed8\u8ba4",children:"REPEATABLE READ (MySQL \u9ed8\u8ba4)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4f1a\u8bdd1\nSET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;\nSTART TRANSACTION;\nSELECT balance FROM accounts WHERE id = 1;  -- 500\n\n-- \u4f1a\u8bdd2\nSTART TRANSACTION;\nUPDATE accounts SET balance = 1000 WHERE id = 1;\nCOMMIT;\n\n-- \u4f1a\u8bdd1\nSELECT balance FROM accounts WHERE id = 1;  -- \u4ecd\u7136\u662f 500\uff08\u53ef\u91cd\u590d\u8bfb\uff09\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u9501\u673a\u5236",children:"\u9501\u673a\u5236"}),"\n",(0,i.jsx)(e.h3,{id:"\u9501\u7684\u5206\u7c7b",children:"\u9501\u7684\u5206\u7c7b"}),"\n",(0,i.jsx)(e.h4,{id:"\u6309\u9501\u7c92\u5ea6\u5206\u7c7b",children:"\u6309\u9501\u7c92\u5ea6\u5206\u7c7b"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8868\u9501"})," - \u9501\u5b9a\u6574\u5f20\u8868"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u884c\u9501"})," - \u9501\u5b9a\u7279\u5b9a\u884c\uff08InnoDB \u652f\u6301\uff09"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9875\u9501"})," - \u9501\u5b9a\u6570\u636e\u9875"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"\u6309\u9501\u6a21\u5f0f\u5206\u7c7b",children:"\u6309\u9501\u6a21\u5f0f\u5206\u7c7b"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5171\u4eab\u9501 (S \u9501)"})," - \u8bfb\u9501\uff0c\u591a\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u540c\u65f6\u6301\u6709"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6392\u5b83\u9501 (X \u9501)"})," - \u5199\u9501\uff0c\u72ec\u5360\u8bbf\u95ee"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u8868\u9501",children:"\u8868\u9501"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u52a0\u8bfb\u9501\nLOCK TABLES users READ;\nSELECT * FROM users;  -- \u5141\u8bb8\nUPDATE users SET age = 25;  -- \u62a5\u9519\uff08\u53ea\u8bfb\uff09\nUNLOCK TABLES;\n\n-- \u52a0\u5199\u9501\nLOCK TABLES users WRITE;\nSELECT * FROM users;  -- \u5141\u8bb8\nUPDATE users SET age = 25;  -- \u5141\u8bb8\nUNLOCK TABLES;\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u884c\u9501-innodb",children:"\u884c\u9501 (InnoDB)"}),"\n",(0,i.jsx)(e.h4,{id:"\u5171\u4eab\u9501-s-\u9501",children:"\u5171\u4eab\u9501 (S \u9501)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u52a0\u5171\u4eab\u9501\nSTART TRANSACTION;\nSELECT * FROM users WHERE id = 1 LOCK IN SHARE MODE;\n\n-- \u5176\u4ed6\u4e8b\u52a1\u53ef\u4ee5\u8bfb\uff0c\u4f46\u4e0d\u80fd\u5199\n-- \u5176\u4ed6\u4e8b\u52a1: SELECT * FROM users WHERE id = 1;  -- \u6210\u529f\n-- \u5176\u4ed6\u4e8b\u52a1: UPDATE users SET age = 25 WHERE id = 1;  -- \u7b49\u5f85\n"})}),"\n",(0,i.jsx)(e.h4,{id:"\u6392\u5b83\u9501-x-\u9501",children:"\u6392\u5b83\u9501 (X \u9501)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u52a0\u6392\u5b83\u9501\nSTART TRANSACTION;\nSELECT * FROM users WHERE id = 1 FOR UPDATE;\n\n-- \u5176\u4ed6\u4e8b\u52a1\u4e0d\u80fd\u8bfb\uff08\u52a0\u9501\u8bfb\uff09\u4e5f\u4e0d\u80fd\u5199\n-- \u5176\u4ed6\u4e8b\u52a1: SELECT * FROM users WHERE id = 1 FOR UPDATE;  -- \u7b49\u5f85\n-- \u5176\u4ed6\u4e8b\u52a1: UPDATE users SET age = 25 WHERE id = 1;  -- \u7b49\u5f85\n"})}),"\n",(0,i.jsx)(e.h4,{id:"\u610f\u5411\u9501",children:"\u610f\u5411\u9501"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u610f\u5411\u5171\u4eab\u9501 (IS)"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u610f\u5411\u6392\u5b83\u9501 (IX)"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- InnoDB \u81ea\u52a8\u52a0\u610f\u5411\u9501\n-- \u884c\u9501\u4e4b\u524d\u5148\u52a0\u8868\u7ea7\u610f\u5411\u9501\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u95f4\u9699\u9501-gap-lock",children:"\u95f4\u9699\u9501 (Gap Lock)"}),"\n",(0,i.jsx)(e.p,{children:"\u9632\u6b62\u5e7b\u8bfb\uff0c\u9501\u5b9a\u7d22\u5f15\u8303\u56f4\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- REPEATABLE READ \u9694\u79bb\u7ea7\u522b\u4e0b\nSTART TRANSACTION;\nSELECT * FROM users WHERE id BETWEEN 10 AND 20 FOR UPDATE;\n\n-- \u9501\u5b9a (10, 20) \u8303\u56f4\uff0c\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id=15 \u7684\u8bb0\u5f55\n-- \u5176\u4ed6\u4e8b\u52a1: INSERT INTO users (id, username) VALUES (15, '\u5f20\u4e09');  -- \u7b49\u5f85\n"})}),"\n",(0,i.jsx)(e.h3,{id:"next-key-lock",children:"Next-Key Lock"}),"\n",(0,i.jsx)(e.p,{children:"\u884c\u9501 + \u95f4\u9699\u9501\uff0cInnoDB \u9ed8\u8ba4\u4f7f\u7528\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u9501\u5b9a\u8bb0\u5f55 + \u8bb0\u5f55\u524d\u7684\u95f4\u9699\nSTART TRANSACTION;\nSELECT * FROM users WHERE id >= 10 FOR UPDATE;\n-- \u9501\u5b9a id=10 \u7684\u8bb0\u5f55 + (\u524d\u4e00\u6761\u8bb0\u5f55, 10] \u7684\u95f4\u9699\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u6b7b\u9501",children:"\u6b7b\u9501"}),"\n",(0,i.jsx)(e.h3,{id:"\u4ec0\u4e48\u662f\u6b7b\u9501",children:"\u4ec0\u4e48\u662f\u6b7b\u9501"}),"\n",(0,i.jsx)(e.p,{children:"\u4e24\u4e2a\u6216\u591a\u4e2a\u4e8b\u52a1\u4e92\u76f8\u7b49\u5f85\u5bf9\u65b9\u91ca\u653e\u9501\uff0c\u5f62\u6210\u5faa\u73af\u7b49\u5f85\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4e8b\u52a1A\nSTART TRANSACTION;\nUPDATE accounts SET balance = balance - 100 WHERE id = 1;  -- \u9501\u5b9a id=1\n-- \u7b49\u5f85\u9501\u5b9a id=2\nUPDATE accounts SET balance = balance + 100 WHERE id = 2;\n\n-- \u4e8b\u52a1B\nSTART TRANSACTION;\nUPDATE accounts SET balance = balance - 50 WHERE id = 2;  -- \u9501\u5b9a id=2\n-- \u7b49\u5f85\u9501\u5b9a id=1\nUPDATE accounts SET balance = balance + 50 WHERE id = 1;\n\n-- \u6b7b\u9501\uff01MySQL \u4f1a\u81ea\u52a8\u68c0\u6d4b\u5e76\u56de\u6eda\u5176\u4e2d\u4e00\u4e2a\u4e8b\u52a1\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u67e5\u770b\u6b7b\u9501",children:"\u67e5\u770b\u6b7b\u9501"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u67e5\u770b\u6700\u8fd1\u4e00\u6b21 InnoDB \u6b7b\u9501\u4fe1\u606f\nSHOW ENGINE INNODB STATUS\\G\n\n-- \u67e5\u770b\u9501\u7b49\u5f85\u60c5\u51b5\nSELECT * FROM performance_schema.data_locks;\nSELECT * FROM performance_schema.data_lock_waits;\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u907f\u514d\u6b7b\u9501",children:"\u907f\u514d\u6b7b\u9501"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.p,{children:["[!IMPORTANT] > ",(0,i.jsx)(e.strong,{children:"\u6b7b\u9501\u9884\u9632\u7b56\u7565"}),":"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u6309\u76f8\u540c\u987a\u5e8f\u8bbf\u95ee\u8868\u548c\u884c"}),"\n",(0,i.jsx)(e.li,{children:"\u5c3d\u91cf\u4f7f\u7528\u7d22\u5f15\u8bbf\u95ee\u6570\u636e"}),"\n",(0,i.jsx)(e.li,{children:"\u51cf\u5c11\u4e8b\u52a1\u6301\u6709\u9501\u7684\u65f6\u95f4"}),"\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528\u8f83\u4f4e\u7684\u9694\u79bb\u7ea7\u522b"}),"\n",(0,i.jsx)(e.li,{children:"\u5408\u7406\u8bbe\u7f6e\u9501\u7b49\u5f85\u8d85\u65f6"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u8bbe\u7f6e\u9501\u7b49\u5f85\u8d85\u65f6\nSET innodb_lock_wait_timeout = 50;  -- 50\u79d2\n\n-- \u7edf\u4e00\u8bbf\u95ee\u987a\u5e8f\n-- \u2705 \u597d\uff1a\u6309 ID \u5347\u5e8f\u8bbf\u95ee\nSTART TRANSACTION;\nUPDATE accounts SET balance = balance - 100 WHERE id = 1;\nUPDATE accounts SET balance = balance + 100 WHERE id = 2;\nCOMMIT;\n\n-- \u274c \u4e0d\u597d\uff1a\u4e0d\u540c\u4e8b\u52a1\u6309\u4e0d\u540c\u987a\u5e8f\u8bbf\u95ee\n-- \u4e8b\u52a1A: \u51481\u540e2\n-- \u4e8b\u52a1B: \u51482\u540e1  -- \u53ef\u80fd\u6b7b\u9501\n"})}),"\n",(0,i.jsx)(e.h2,{id:"mvcc-\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236",children:"MVCC (\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236)"}),"\n",(0,i.jsx)(e.h3,{id:"mvcc-\u539f\u7406",children:"MVCC \u539f\u7406"}),"\n",(0,i.jsx)(e.p,{children:"InnoDB \u4f7f\u7528 MVCC \u5b9e\u73b0\u975e\u9501\u5b9a\u8bfb\uff0c\u63d0\u9ad8\u5e76\u53d1\u6027\u80fd\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6bcf\u884c\u8bb0\u5f55\u6709\u591a\u4e2a\u7248\u672c"}),"\n",(0,i.jsx)(e.li,{children:"\u4e8b\u52a1\u8bfb\u53d6\u65f6\u6839\u636e\u7248\u672c\u53f7\u5224\u65ad\u53ef\u89c1\u6027"}),"\n",(0,i.jsx)(e.li,{children:"\u4e0d\u9700\u8981\u52a0\u9501\uff0c\u63d0\u9ad8\u5e76\u53d1"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u9690\u85cf\u5217",children:"\u9690\u85cf\u5217"}),"\n",(0,i.jsx)(e.p,{children:"InnoDB \u4e3a\u6bcf\u884c\u6dfb\u52a0\u9690\u85cf\u5217\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"DB_TRX_ID"})," - \u4e8b\u52a1 ID"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"DB_ROLL_PTR"})," - \u56de\u6eda\u6307\u9488"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"DB_ROW_ID"})," - \u884c ID\uff08\u65e0\u4e3b\u952e\u65f6\uff09"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"read-view",children:"Read View"}),"\n",(0,i.jsx)(e.p,{children:"\u4e8b\u52a1\u5f00\u59cb\u65f6\u521b\u5efa Read View\uff0c\u786e\u5b9a\u54ea\u4e9b\u7248\u672c\u53ef\u89c1\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- REPEATABLE READ\uff1a\u4e8b\u52a1\u5f00\u59cb\u65f6\u521b\u5efa Read View\nSTART TRANSACTION;\nSELECT * FROM users WHERE id = 1;  -- \u521b\u5efa Read View\n-- \u4e4b\u540e\u7684\u67e5\u8be2\u4f7f\u7528\u540c\u4e00\u4e2a Read View\uff08\u53ef\u91cd\u590d\u8bfb\uff09\n\n-- READ COMMITTED\uff1a\u6bcf\u6b21\u67e5\u8be2\u90fd\u521b\u5efa\u65b0\u7684 Read View\nSTART TRANSACTION;\nSELECT * FROM users WHERE id = 1;  -- \u521b\u5efa Read View 1\nSELECT * FROM users WHERE id = 1;  -- \u521b\u5efa Read View 2\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u4e8b\u52a1\u65e5\u5fd7",children:"\u4e8b\u52a1\u65e5\u5fd7"}),"\n",(0,i.jsx)(e.h3,{id:"undo-log-\u56de\u6eda\u65e5\u5fd7",children:"Undo Log (\u56de\u6eda\u65e5\u5fd7)"}),"\n",(0,i.jsx)(e.p,{children:"\u7528\u4e8e\u56de\u6eda\u548c MVCC\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4e8b\u52a1\u5f00\u59cb\nSTART TRANSACTION;\nUPDATE users SET age = 26 WHERE id = 1;  -- Undo Log: age = 25\n\n-- \u56de\u6eda\nROLLBACK;  -- \u4f7f\u7528 Undo Log \u6062\u590d age = 25\n"})}),"\n",(0,i.jsx)(e.h3,{id:"redo-log-\u91cd\u505a\u65e5\u5fd7",children:"Redo Log (\u91cd\u505a\u65e5\u5fd7)"}),"\n",(0,i.jsx)(e.p,{children:"\u7528\u4e8e\u5d29\u6e83\u6062\u590d\uff0c\u4fdd\u8bc1\u6301\u4e45\u6027\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4e8b\u52a1\u63d0\u4ea4\nSTART TRANSACTION;\nUPDATE users SET age = 26 WHERE id = 1;\nCOMMIT;  -- \u5199\u5165 Redo Log\uff0c\u5373\u4f7f\u5d29\u6e83\u4e5f\u80fd\u6062\u590d\n"})}),"\n",(0,i.jsx)(e.h3,{id:"binlog-\u4e8c\u8fdb\u5236\u65e5\u5fd7",children:"Binlog (\u4e8c\u8fdb\u5236\u65e5\u5fd7)"}),"\n",(0,i.jsx)(e.p,{children:"\u7528\u4e8e\u4e3b\u4ece\u590d\u5236\u548c\u6570\u636e\u6062\u590d\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u5f00\u542f binlog\nSET GLOBAL log_bin = ON;\n\n-- \u67e5\u770b binlog \u6587\u4ef6\nSHOW BINARY LOGS;\n\n-- \u67e5\u770b binlog \u5185\u5bb9\nSHOW BINLOG EVENTS IN 'mysql-bin.000001';\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsx)(e.h3,{id:"\u4e8b\u52a1\u4f7f\u7528\u89c4\u8303",children:"\u4e8b\u52a1\u4f7f\u7528\u89c4\u8303"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.p,{children:["[!IMPORTANT] > ",(0,i.jsx)(e.strong,{children:"\u4e8b\u52a1\u6700\u4f73\u5b9e\u8df5"}),":"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u4fdd\u6301\u4e8b\u52a1\u7b80\u77ed\uff0c\u51cf\u5c11\u9501\u6301\u6709\u65f6\u95f4"}),"\n",(0,i.jsx)(e.li,{children:"\u907f\u514d\u5728\u4e8b\u52a1\u4e2d\u6267\u884c\u8017\u65f6\u64cd\u4f5c\uff08\u5982\u7f51\u7edc\u8bf7\u6c42\uff09"}),"\n",(0,i.jsx)(e.li,{children:"\u5408\u7406\u9009\u62e9\u9694\u79bb\u7ea7\u522b\uff08\u4e00\u822c\u7528\u9ed8\u8ba4\u7684 REPEATABLE READ\uff09"}),"\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528\u7d22\u5f15\u8bbf\u95ee\u6570\u636e\uff0c\u51cf\u5c11\u9501\u8303\u56f4"}),"\n",(0,i.jsx)(e.li,{children:"\u7edf\u4e00\u8bbf\u95ee\u987a\u5e8f\uff0c\u907f\u514d\u6b7b\u9501"}),"\n",(0,i.jsx)(e.li,{children:"\u53ca\u65f6\u63d0\u4ea4\u6216\u56de\u6eda\u4e8b\u52a1"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u793a\u4f8b\u89c4\u8303\u7684\u4e8b\u52a1\u5904\u7406",children:"\u793a\u4f8b\uff1a\u89c4\u8303\u7684\u4e8b\u52a1\u5904\u7406"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u2705 \u597d\u7684\u4e8b\u52a1\nSTART TRANSACTION;\n-- 1. \u5feb\u901f\u6267\u884c\nUPDATE accounts SET balance = balance - 100 WHERE user_id = 1;\nUPDATE accounts SET balance = balance + 100 WHERE user_id = 2;\n-- 2. \u53ca\u65f6\u63d0\u4ea4\nCOMMIT;\n\n-- \u274c \u4e0d\u597d\u7684\u4e8b\u52a1\nSTART TRANSACTION;\n-- 1. \u8017\u65f6\u64cd\u4f5c\nSELECT * FROM large_table;  -- \u5168\u8868\u626b\u63cf\n-- 2. \u5916\u90e8\u8c03\u7528\n-- \u8c03\u7528\u5916\u90e8 API\uff08\u7f51\u7edc\u5ef6\u8fdf\uff09\n-- 3. \u957f\u65f6\u95f4\u6301\u6709\u9501\n-- ... \u5176\u4ed6\u64cd\u4f5c\nCOMMIT;\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sql",children:"-- \u4f7f\u7528\u5b58\u50a8\u8fc7\u7a0b\u5904\u7406\u4e8b\u52a1\u548c\u9519\u8bef\nDELIMITER //\n\nCREATE PROCEDURE transfer_money(\n    IN from_user_id INT,\n    IN to_user_id INT,\n    IN amount DECIMAL(10,2)\n)\nBEGIN\n    DECLARE EXIT HANDLER FOR SQLEXCEPTION\n    BEGIN\n        ROLLBACK;  -- \u53d1\u751f\u9519\u8bef\u65f6\u56de\u6eda\n    END;\n\n    START TRANSACTION;\n\n    UPDATE accounts SET balance = balance - amount WHERE user_id = from_user_id;\n    UPDATE accounts SET balance = balance + amount WHERE user_id = to_user_id;\n\n    COMMIT;  -- \u6210\u529f\u65f6\u63d0\u4ea4\nEND//\n\nDELIMITER ;\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,i.jsx)(e.p,{children:"\u672c\u6587\u8be6\u7ec6\u4ecb\u7ecd\u4e86 MySQL \u4e8b\u52a1\u5904\u7406\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u2705 ACID \u7279\u6027\uff1a\u539f\u5b50\u6027\u3001\u4e00\u81f4\u6027\u3001\u9694\u79bb\u6027\u3001\u6301\u4e45\u6027"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 \u4e8b\u52a1\u64cd\u4f5c\uff1aBEGIN\u3001COMMIT\u3001ROLLBACK\u3001SAVEPOINT"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 \u9694\u79bb\u7ea7\u522b\uff1aREAD UNCOMMITTED\u3001READ COMMITTED\u3001REPEATABLE READ\u3001SERIALIZABLE"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 \u9501\u673a\u5236\uff1a\u8868\u9501\u3001\u884c\u9501\u3001\u95f4\u9699\u9501\u3001Next-Key Lock"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 \u6b7b\u9501\u68c0\u6d4b\u548c\u907f\u514d"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 MVCC \u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 \u4e8b\u52a1\u65e5\u5fd7\uff1aUndo Log\u3001Redo Log\u3001Binlog"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u638c\u63e1\u4e8b\u52a1\u5904\u7406\u540e\uff0c\u53ef\u4ee5\u7ee7\u7eed\u5b66\u4e60 ",(0,i.jsx)(e.a,{href:"/docs/mysql/performance-optimization",children:"\u6027\u80fd\u4f18\u5316"}),"\uff01"]})]})}function h(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(T,{...n})}):T(n)}}}]);
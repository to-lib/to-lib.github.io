"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[3248],{48885:(n,e,r)=>{r.d(e,{R:()=>t,x:()=>a});var i=r(99378);const s={},o=i.createContext(s);function t(n){const e=i.useContext(o);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:t(n.components),i.createElement(o.Provider,{value:e},n.children)}},89827:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"kafka/consumer-api","title":"\u6d88\u8d39\u8005 API","description":"\u6df1\u5165\u5b66\u4e60 Kafka \u6d88\u8d39\u8005 API","source":"@site/docs/kafka/consumer-api.md","sourceDirName":"kafka","slug":"/kafka/consumer-api","permalink":"/docs/kafka/consumer-api","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/kafka/consumer-api.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"\u6d88\u8d39\u8005 API","description":"\u6df1\u5165\u5b66\u4e60 Kafka \u6d88\u8d39\u8005 API"},"sidebar":"kafka","previous":{"title":"\u751f\u4ea7\u8005 API","permalink":"/docs/kafka/producer-api"},"next":{"title":"\u96c6\u7fa4\u7ba1\u7406","permalink":"/docs/kafka/cluster-management"}}');var s=r(22714),o=r(48885);const t={sidebar_position:6,title:"\u6d88\u8d39\u8005 API",description:"\u6df1\u5165\u5b66\u4e60 Kafka \u6d88\u8d39\u8005 API"},a="Kafka \u6d88\u8d39\u8005 API",c={},l=[{value:"\u57fa\u672c\u914d\u7f6e",id:"\u57fa\u672c\u914d\u7f6e",level:2},{value:"\u8ba2\u9605 Topic",id:"\u8ba2\u9605-topic",level:2},{value:"1. \u8ba2\u9605\u5355\u4e2a Topic",id:"1-\u8ba2\u9605\u5355\u4e2a-topic",level:3},{value:"2. \u8ba2\u9605\u591a\u4e2a Topic",id:"2-\u8ba2\u9605\u591a\u4e2a-topic",level:3},{value:"3. \u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u8ba2\u9605",id:"3-\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u8ba2\u9605",level:3},{value:"4. \u624b\u52a8\u5206\u914d\u5206\u533a",id:"4-\u624b\u52a8\u5206\u914d\u5206\u533a",level:3},{value:"\u6d88\u8d39\u6d88\u606f",id:"\u6d88\u8d39\u6d88\u606f",level:2},{value:"\u57fa\u672c\u6d88\u8d39\u6a21\u5f0f",id:"\u57fa\u672c\u6d88\u8d39\u6a21\u5f0f",level:3},{value:"\u6309\u5206\u533a\u5904\u7406",id:"\u6309\u5206\u533a\u5904\u7406",level:3},{value:"\u4f4d\u79fb\u63d0\u4ea4",id:"\u4f4d\u79fb\u63d0\u4ea4",level:2},{value:"1. \u81ea\u52a8\u63d0\u4ea4\uff08\u9ed8\u8ba4\uff09",id:"1-\u81ea\u52a8\u63d0\u4ea4\u9ed8\u8ba4",level:3},{value:"2. \u624b\u52a8\u540c\u6b65\u63d0\u4ea4",id:"2-\u624b\u52a8\u540c\u6b65\u63d0\u4ea4",level:3},{value:"3. \u624b\u52a8\u5f02\u6b65\u63d0\u4ea4\uff08\u63a8\u8350\uff09",id:"3-\u624b\u52a8\u5f02\u6b65\u63d0\u4ea4\u63a8\u8350",level:3},{value:"4. \u7ec4\u5408\u540c\u6b65\u548c\u5f02\u6b65\u63d0\u4ea4",id:"4-\u7ec4\u5408\u540c\u6b65\u548c\u5f02\u6b65\u63d0\u4ea4",level:3},{value:"5. \u63d0\u4ea4\u7279\u5b9a\u4f4d\u79fb",id:"5-\u63d0\u4ea4\u7279\u5b9a\u4f4d\u79fb",level:3},{value:"\u91cd\u8981\u914d\u7f6e\u53c2\u6570",id:"\u91cd\u8981\u914d\u7f6e\u53c2\u6570",level:2},{value:"\u6d88\u8d39\u7b56\u7565",id:"\u6d88\u8d39\u7b56\u7565",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:3},{value:"\u6d88\u8d39\u8005\u7ec4",id:"\u6d88\u8d39\u8005\u7ec4",level:2},{value:"\u6d88\u8d39\u8005\u7ec4\u7279\u70b9",id:"\u6d88\u8d39\u8005\u7ec4\u7279\u70b9",level:3},{value:"\u518d\u5747\u8861\uff08Rebalance\uff09",id:"\u518d\u5747\u8861rebalance",level:3},{value:"\u4f4d\u79fb\u7ba1\u7406",id:"\u4f4d\u79fb\u7ba1\u7406",level:2},{value:"\u91cd\u7f6e\u4f4d\u79fb",id:"\u91cd\u7f6e\u4f4d\u79fb",level:3},{value:"\u67e5\u8be2\u4f4d\u79fb",id:"\u67e5\u8be2\u4f4d\u79fb",level:3},{value:"\u6d88\u606f\u53cd\u5e8f\u5217\u5316",id:"\u6d88\u606f\u53cd\u5e8f\u5217\u5316",level:2},{value:"\u81ea\u5b9a\u4e49\u53cd\u5e8f\u5217\u5316\u5668",id:"\u81ea\u5b9a\u4e49\u53cd\u5e8f\u5217\u5316\u5668",level:3},{value:"\u6682\u505c\u548c\u6062\u590d\u6d88\u8d39",id:"\u6682\u505c\u548c\u6062\u590d\u6d88\u8d39",level:2},{value:"\u72ec\u7acb\u6d88\u8d39\u8005",id:"\u72ec\u7acb\u6d88\u8d39\u8005",level:2},{value:"\u591a\u7ebf\u7a0b\u6d88\u8d39",id:"\u591a\u7ebf\u7a0b\u6d88\u8d39",level:2},{value:"\u65b9\u6848\u4e00\uff1a\u6bcf\u4e2a\u7ebf\u7a0b\u4e00\u4e2a\u6d88\u8d39\u8005",id:"\u65b9\u6848\u4e00\u6bcf\u4e2a\u7ebf\u7a0b\u4e00\u4e2a\u6d88\u8d39\u8005",level:3},{value:"\u65b9\u6848\u4e8c\uff1a\u5355\u6d88\u8d39\u8005+\u7ebf\u7a0b\u6c60\u5904\u7406",id:"\u65b9\u6848\u4e8c\u5355\u6d88\u8d39\u8005\u7ebf\u7a0b\u6c60\u5904\u7406",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u4f18\u96c5\u5173\u95ed",id:"1-\u4f18\u96c5\u5173\u95ed",level:3},{value:"2. \u907f\u514d\u518d\u5747\u8861",id:"2-\u907f\u514d\u518d\u5747\u8861",level:3},{value:"3. \u7cbe\u786e\u4e00\u6b21\u6d88\u8d39",id:"3-\u7cbe\u786e\u4e00\u6b21\u6d88\u8d39",level:3},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function d(n){const e={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"kafka-\u6d88\u8d39\u8005-api",children:"Kafka \u6d88\u8d39\u8005 API"})}),"\n",(0,s.jsx)(e.p,{children:"\u672c\u6587\u6863\u8be6\u7ec6\u4ecb\u7ecd Kafka Consumer API \u7684\u4f7f\u7528\u65b9\u6cd5\u3001\u914d\u7f6e\u53c2\u6570\u548c\u6700\u4f73\u5b9e\u8df5\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"\u57fa\u672c\u914d\u7f6e",children:"\u57fa\u672c\u914d\u7f6e"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'Properties props = new Properties();\n\n// Kafka \u96c6\u7fa4\u5730\u5740\nprops.put("bootstrap.servers", "localhost:9092");\n\n// \u6d88\u8d39\u8005\u7ec4 ID\uff08\u5fc5\u9700\uff09\nprops.put("group.id", "my-consumer-group");\n\n// Key \u53cd\u5e8f\u5217\u5316\u5668\nprops.put("key.deserializer",\n    "org.apache.kafka.common.serialization.StringDeserializer");\n\n// Value \u53cd\u5e8f\u5217\u5316\u5668\nprops.put("value.deserializer",\n    "org.apache.kafka.common.serialization.StringDeserializer");\n\n// \u521b\u5efa\u6d88\u8d39\u8005\nKafkaConsumer<String, String> consumer = new KafkaConsumer<>(props);\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u8ba2\u9605-topic",children:"\u8ba2\u9605 Topic"}),"\n",(0,s.jsx)(e.h3,{id:"1-\u8ba2\u9605\u5355\u4e2a-topic",children:"1. \u8ba2\u9605\u5355\u4e2a Topic"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'consumer.subscribe(Collections.singletonList("my-topic"));\n'})}),"\n",(0,s.jsx)(e.h3,{id:"2-\u8ba2\u9605\u591a\u4e2a-topic",children:"2. \u8ba2\u9605\u591a\u4e2a Topic"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'consumer.subscribe(Arrays.asList("topic1", "topic2", "topic3"));\n'})}),"\n",(0,s.jsx)(e.h3,{id:"3-\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u8ba2\u9605",children:"3. \u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u8ba2\u9605"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// \u8ba2\u9605\u6240\u6709\u4ee5 "test-" \u5f00\u5934\u7684 Topic\nconsumer.subscribe(Pattern.compile("test-.*"));\n'})}),"\n",(0,s.jsx)(e.h3,{id:"4-\u624b\u52a8\u5206\u914d\u5206\u533a",children:"4. \u624b\u52a8\u5206\u914d\u5206\u533a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// \u624b\u52a8\u5206\u914d\u7279\u5b9a\u5206\u533a\nTopicPartition partition0 = new TopicPartition("my-topic", 0);\nTopicPartition partition1 = new TopicPartition("my-topic", 1);\nconsumer.assign(Arrays.asList(partition0, partition1));\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u6d88\u8d39\u6d88\u606f",children:"\u6d88\u8d39\u6d88\u606f"}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u672c\u6d88\u8d39\u6a21\u5f0f",children:"\u57fa\u672c\u6d88\u8d39\u6a21\u5f0f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'try {\n    consumer.subscribe(Arrays.asList("my-topic"));\n\n    while (true) {\n        // \u62c9\u53d6\u6d88\u606f\uff0c\u8d85\u65f6\u65f6\u95f4 100ms\n        ConsumerRecords<String, String> records =\n            consumer.poll(Duration.ofMillis(100));\n\n        for (ConsumerRecord<String, String> record : records) {\n            System.out.printf("topic=%s, partition=%d, offset=%d, key=%s, value=%s%n",\n                record.topic(), record.partition(), record.offset(),\n                record.key(), record.value());\n        }\n    }\n} finally {\n    consumer.close();\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u6309\u5206\u533a\u5904\u7406",children:"\u6309\u5206\u533a\u5904\u7406"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\n\n// \u6309\u5206\u533a\u8fed\u4ee3\nfor (TopicPartition partition : records.partitions()) {\n    List<ConsumerRecord<String, String>> partitionRecords =\n        records.records(partition);\n\n    for (ConsumerRecord<String, String> record : partitionRecords) {\n        System.out.printf("\u5206\u533a %d \u7684\u6d88\u606f: %s%n",\n            partition.partition(), record.value());\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u4f4d\u79fb\u63d0\u4ea4",children:"\u4f4d\u79fb\u63d0\u4ea4"}),"\n",(0,s.jsx)(e.h3,{id:"1-\u81ea\u52a8\u63d0\u4ea4\u9ed8\u8ba4",children:"1. \u81ea\u52a8\u63d0\u4ea4\uff08\u9ed8\u8ba4\uff09"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'props.put("enable.auto.commit", "true");\nprops.put("auto.commit.interval.ms", "5000"); // \u6bcf 5 \u79d2\u63d0\u4ea4\u4e00\u6b21\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4f18\u70b9\uff1a"})," \u7b80\u5355\uff0c\u65e0\u9700\u624b\u52a8\u7ba1\u7406",(0,s.jsx)(e.br,{}),"\n",(0,s.jsx)(e.strong,{children:"\u7f3a\u70b9\uff1a"})," \u53ef\u80fd\u91cd\u590d\u6d88\u8d39\u6216\u4e22\u5931\u6d88\u606f"]}),"\n",(0,s.jsx)(e.h3,{id:"2-\u624b\u52a8\u540c\u6b65\u63d0\u4ea4",children:"2. \u624b\u52a8\u540c\u6b65\u63d0\u4ea4"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'props.put("enable.auto.commit", "false");\n\ntry {\n    while (true) {\n        ConsumerRecords<String, String> records =\n            consumer.poll(Duration.ofMillis(100));\n\n        for (ConsumerRecord<String, String> record : records) {\n            // \u5904\u7406\u6d88\u606f\n            processRecord(record);\n        }\n\n        // \u540c\u6b65\u63d0\u4ea4\u4f4d\u79fb\uff08\u963b\u585e\uff09\n        consumer.commitSync();\n    }\n} catch (CommitFailedException e) {\n    e.printStackTrace();\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4f18\u70b9\uff1a"})," \u53ef\u9760\u6027\u9ad8",(0,s.jsx)(e.br,{}),"\n",(0,s.jsx)(e.strong,{children:"\u7f3a\u70b9\uff1a"})," \u963b\u585e\uff0c\u6027\u80fd\u8f83\u4f4e"]}),"\n",(0,s.jsx)(e.h3,{id:"3-\u624b\u52a8\u5f02\u6b65\u63d0\u4ea4\u63a8\u8350",children:"3. \u624b\u52a8\u5f02\u6b65\u63d0\u4ea4\uff08\u63a8\u8350\uff09"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'props.put("enable.auto.commit", "false");\n\nconsumer.subscribe(Arrays.asList("my-topic"));\n\nwhile (true) {\n    ConsumerRecords<String, String> records =\n        consumer.poll(Duration.ofMillis(100));\n\n    for (ConsumerRecord<String, String> record : records) {\n        processRecord(record);\n    }\n\n    // \u5f02\u6b65\u63d0\u4ea4\n    consumer.commitAsync((offsets, exception) -> {\n        if (exception != null) {\n            System.err.println("\u63d0\u4ea4\u5931\u8d25: " + exception.getMessage());\n        }\n    });\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"4-\u7ec4\u5408\u540c\u6b65\u548c\u5f02\u6b65\u63d0\u4ea4",children:"4. \u7ec4\u5408\u540c\u6b65\u548c\u5f02\u6b65\u63d0\u4ea4"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"try {\n    while (true) {\n        ConsumerRecords<String, String> records =\n            consumer.poll(Duration.ofMillis(100));\n\n        for (ConsumerRecord<String, String> record : records) {\n            processRecord(record);\n        }\n\n        // \u6b63\u5e38\u60c5\u51b5\u4f7f\u7528\u5f02\u6b65\u63d0\u4ea4\n        consumer.commitAsync();\n    }\n} catch (Exception e) {\n    e.printStackTrace();\n} finally {\n    try {\n        // \u5173\u95ed\u524d\u4f7f\u7528\u540c\u6b65\u63d0\u4ea4\uff0c\u786e\u4fdd\u4f4d\u79fb\u63d0\u4ea4\u6210\u529f\n        consumer.commitSync();\n    } finally {\n        consumer.close();\n    }\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"5-\u63d0\u4ea4\u7279\u5b9a\u4f4d\u79fb",children:"5. \u63d0\u4ea4\u7279\u5b9a\u4f4d\u79fb"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"Map<TopicPartition, OffsetAndMetadata> offsets = new HashMap<>();\nint count = 0;\n\nwhile (true) {\n    ConsumerRecords<String, String> records =\n        consumer.poll(Duration.ofMillis(100));\n\n    for (ConsumerRecord<String, String> record : records) {\n        processRecord(record);\n\n        // \u8bb0\u5f55\u4f4d\u79fb\n        offsets.put(\n            new TopicPartition(record.topic(), record.partition()),\n            new OffsetAndMetadata(record.offset() + 1)\n        );\n\n        // \u6bcf\u5904\u7406 100 \u6761\u6d88\u606f\u63d0\u4ea4\u4e00\u6b21\n        if (++count % 100 == 0) {\n            consumer.commitSync(offsets);\n            offsets.clear();\n        }\n    }\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u91cd\u8981\u914d\u7f6e\u53c2\u6570",children:"\u91cd\u8981\u914d\u7f6e\u53c2\u6570"}),"\n",(0,s.jsx)(e.h3,{id:"\u6d88\u8d39\u7b56\u7565",children:"\u6d88\u8d39\u7b56\u7565"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// \u81ea\u52a8\u63d0\u4ea4\nprops.put("enable.auto.commit", "true");\nprops.put("auto.commit.interval.ms", "5000");\n\n// \u4f4d\u79fb\u91cd\u7f6e\u7b56\u7565\nprops.put("auto.offset.reset", "earliest");  // earliest, latest, none\n\n// \u5355\u6b21\u62c9\u53d6\u6700\u5927\u8bb0\u5f55\u6570\nprops.put("max.poll.records", 500);\n\n// \u62c9\u53d6\u6700\u5927\u95f4\u9694\uff08\u9632\u6b62\u88ab\u8e22\u51fa\u6d88\u8d39\u8005\u7ec4\uff09\nprops.put("max.poll.interval.ms", 300000);  // 5 \u5206\u949f\n\n// \u4f1a\u8bdd\u8d85\u65f6\u65f6\u95f4\nprops.put("session.timeout.ms", 10000);  // 10 \u79d2\n\n// \u5fc3\u8df3\u95f4\u9694\nprops.put("heartbeat.interval.ms", 3000);  // 3 \u79d2\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// \u62c9\u53d6\u6700\u5c0f\u5b57\u8282\u6570\nprops.put("fetch.min.bytes", 1024);\n\n// \u62c9\u53d6\u6700\u5927\u7b49\u5f85\u65f6\u95f4\nprops.put("fetch.max.wait.ms", 500);\n\n// \u5355\u6b21\u62c9\u53d6\u6700\u5927\u5b57\u8282\u6570\nprops.put("fetch.max.bytes", 52428800);  // 50MB\n\n// \u5355\u4e2a\u5206\u533a\u62c9\u53d6\u6700\u5927\u5b57\u8282\u6570\nprops.put("max.partition.fetch.bytes", 1048576);  // 1MB\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u6d88\u8d39\u8005\u7ec4",children:"\u6d88\u8d39\u8005\u7ec4"}),"\n",(0,s.jsx)(e.h3,{id:"\u6d88\u8d39\u8005\u7ec4\u7279\u70b9",children:"\u6d88\u8d39\u8005\u7ec4\u7279\u70b9"}),"\n",(0,s.jsx)(e.mermaid,{value:"graph TB\n    Topic[Topic: 6 \u4e2a\u5206\u533a]\n\n    subgraph CG1[\u6d88\u8d39\u8005\u7ec4 1 - 3 \u4e2a\u6d88\u8d39\u8005]\n        C1[\u6d88\u8d39\u8005 1<br/>P0, P1]\n        C2[\u6d88\u8d39\u8005 2<br/>P2, P3]\n        C3[\u6d88\u8d39\u8005 3<br/>P4, P5]\n    end\n\n    subgraph CG2[\u6d88\u8d39\u8005\u7ec4 2 - 2 \u4e2a\u6d88\u8d39\u8005]\n        C4[\u6d88\u8d39\u8005 4<br/>P0, P1, P2]\n        C5[\u6d88\u8d39\u8005 5<br/>P3, P4, P5]\n    end\n\n    Topic --\x3e C1\n    Topic --\x3e C2\n    Topic --\x3e C3\n    Topic --\x3e C4\n    Topic --\x3e C5\n\n    style Topic fill:#2e7d32,color:#fff\n    style CG1 fill:#1976d2,color:#fff\n    style CG2 fill:#ff9800,color:#fff"}),"\n",(0,s.jsx)(e.h3,{id:"\u518d\u5747\u8861rebalance",children:"\u518d\u5747\u8861\uff08Rebalance\uff09"}),"\n",(0,s.jsx)(e.p,{children:"\u5f53\u6d88\u8d39\u8005\u7ec4\u6210\u5458\u53d8\u5316\u65f6\u4f1a\u89e6\u53d1\u518d\u5747\u8861\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'consumer.subscribe(Arrays.asList("my-topic"), new ConsumerRebalanceListener() {\n    @Override\n    public void onPartitionsRevoked(Collection<TopicPartition> partitions) {\n        // \u518d\u5747\u8861\u5f00\u59cb\u524d\u8c03\u7528\n        System.out.println("\u5206\u533a\u88ab\u56de\u6536: " + partitions);\n        // \u63d0\u4ea4\u4f4d\u79fb\n        consumer.commitSync();\n    }\n\n    @Override\n    public void onPartitionsAssigned(Collection<TopicPartition> partitions) {\n        // \u518d\u5747\u8861\u5b8c\u6210\u540e\u8c03\u7528\n        System.out.println("\u5206\u914d\u65b0\u5206\u533a: " + partitions);\n    }\n});\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u4f4d\u79fb\u7ba1\u7406",children:"\u4f4d\u79fb\u7ba1\u7406"}),"\n",(0,s.jsx)(e.h3,{id:"\u91cd\u7f6e\u4f4d\u79fb",children:"\u91cd\u7f6e\u4f4d\u79fb"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// \u4ece\u6700\u65e9\u4f4d\u7f6e\u5f00\u59cb\u6d88\u8d39\nconsumer.seekToBeginning(consumer.assignment());\n\n// \u4ece\u6700\u65b0\u4f4d\u7f6e\u5f00\u59cb\u6d88\u8d39\nconsumer.seekToEnd(consumer.assignment());\n\n// \u4ece\u6307\u5b9a\u4f4d\u79fb\u5f00\u59cb\u6d88\u8d39\nTopicPartition partition = new TopicPartition("my-topic", 0);\nconsumer.seek(partition, 100);\n\n// \u4ece\u6307\u5b9a\u65f6\u95f4\u6233\u5f00\u59cb\u6d88\u8d39\nMap<TopicPartition, Long> timestampsToSearch = new HashMap<>();\ntimestampsToSearch.put(partition, System.currentTimeMillis() - 24 * 60 * 60 * 1000);\nMap<TopicPartition, OffsetAndTimestamp> offsets =\n    consumer.offsetsForTimes(timestampsToSearch);\nconsumer.seek(partition, offsets.get(partition).offset());\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u67e5\u8be2\u4f4d\u79fb",children:"\u67e5\u8be2\u4f4d\u79fb"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// \u67e5\u8be2\u5f53\u524d\u4f4d\u79fb\nSet<TopicPartition> assignment = consumer.assignment();\nMap<TopicPartition, Long> endOffsets = consumer.endOffsets(assignment);\nMap<TopicPartition, Long> beginningOffsets = consumer.beginningOffsets(assignment);\n\nfor (TopicPartition partition : assignment) {\n    long position = consumer.position(partition);\n    long committed = consumer.committed(partition).offset();\n    System.out.printf("\u5206\u533a %d: \u5f53\u524d\u4f4d\u79fb=%d, \u5df2\u63d0\u4ea4\u4f4d\u79fb=%d%n",\n        partition.partition(), position, committed);\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u6d88\u606f\u53cd\u5e8f\u5217\u5316",children:"\u6d88\u606f\u53cd\u5e8f\u5217\u5316"}),"\n",(0,s.jsx)(e.h3,{id:"\u81ea\u5b9a\u4e49\u53cd\u5e8f\u5217\u5316\u5668",children:"\u81ea\u5b9a\u4e49\u53cd\u5e8f\u5217\u5316\u5668"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'public class JsonDeserializer<T> implements Deserializer<T> {\n    private final ObjectMapper objectMapper = new ObjectMapper();\n    private Class<T> targetClass;\n\n    @Override\n    public void configure(Map<String, ?> configs, boolean isKey) {\n        String className = (String) configs.get("value.deserializer.class");\n        try {\n            this.targetClass = (Class<T>) Class.forName(className);\n        } catch (ClassNotFoundException e) {\n            throw new SerializationException("Error configuring deserializer", e);\n        }\n    }\n\n    @Override\n    public T deserialize(String topic, byte[] data) {\n        if (data == null) {\n            return null;\n        }\n        try {\n            return objectMapper.readValue(data, targetClass);\n        } catch (Exception e) {\n            throw new SerializationException("Error deserializing JSON", e);\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u6682\u505c\u548c\u6062\u590d\u6d88\u8d39",children:"\u6682\u505c\u548c\u6062\u590d\u6d88\u8d39"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"Set<TopicPartition> assignment = consumer.assignment();\n\n// \u6682\u505c\u6d88\u8d39\nconsumer.pause(assignment);\n\n// \u68c0\u67e5\u662f\u5426\u5df2\u6682\u505c\nSet<TopicPartition> paused = consumer.paused();\n\n// \u6062\u590d\u6d88\u8d39\nconsumer.resume(assignment);\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u72ec\u7acb\u6d88\u8d39\u8005",children:"\u72ec\u7acb\u6d88\u8d39\u8005"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// \u4e0d\u4f7f\u7528\u6d88\u8d39\u8005\u7ec4\uff0c\u624b\u52a8\u5206\u914d\u5206\u533a\nList<TopicPartition> partitions = new ArrayList<>();\npartitions.add(new TopicPartition("my-topic", 0));\npartitions.add(new TopicPartition("my-topic", 1));\n\nconsumer.assign(partitions);\n\nwhile (true) {\n    ConsumerRecords<String, String> records =\n        consumer.poll(Duration.ofMillis(100));\n\n    for (ConsumerRecord<String, String> record : records) {\n        processRecord(record);\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u591a\u7ebf\u7a0b\u6d88\u8d39",children:"\u591a\u7ebf\u7a0b\u6d88\u8d39"}),"\n",(0,s.jsx)(e.h3,{id:"\u65b9\u6848\u4e00\u6bcf\u4e2a\u7ebf\u7a0b\u4e00\u4e2a\u6d88\u8d39\u8005",children:"\u65b9\u6848\u4e00\uff1a\u6bcf\u4e2a\u7ebf\u7a0b\u4e00\u4e2a\u6d88\u8d39\u8005"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'public class ConsumerThread extends Thread {\n    private final KafkaConsumer<String, String> consumer;\n\n    public ConsumerThread(Properties props, String topic) {\n        this.consumer = new KafkaConsumer<>(props);\n        this.consumer.subscribe(Collections.singletonList(topic));\n    }\n\n    @Override\n    public void run() {\n        try {\n            while (true) {\n                ConsumerRecords<String, String> records =\n                    consumer.poll(Duration.ofMillis(100));\n\n                for (ConsumerRecord<String, String> record : records) {\n                    processRecord(record);\n                }\n\n                consumer.commitAsync();\n            }\n        } finally {\n            consumer.close();\n        }\n    }\n}\n\n// \u542f\u52a8\u591a\u4e2a\u6d88\u8d39\u8005\u7ebf\u7a0b\nfor (int i = 0; i < 3; i++) {\n    new ConsumerThread(props, "my-topic").start();\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u65b9\u6848\u4e8c\u5355\u6d88\u8d39\u8005\u7ebf\u7a0b\u6c60\u5904\u7406",children:"\u65b9\u6848\u4e8c\uff1a\u5355\u6d88\u8d39\u8005+\u7ebf\u7a0b\u6c60\u5904\u7406"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'ExecutorService executor = Executors.newFixedThreadPool(10);\n\nconsumer.subscribe(Arrays.asList("my-topic"));\n\nwhile (true) {\n    ConsumerRecords<String, String> records =\n        consumer.poll(Duration.ofMillis(100));\n\n    for (ConsumerRecord<String, String> record : records) {\n        executor.submit(() -> processRecord(record));\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsx)(e.h3,{id:"1-\u4f18\u96c5\u5173\u95ed",children:"1. \u4f18\u96c5\u5173\u95ed"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'Runtime.getRuntime().addShutdownHook(new Thread(() -> {\n    System.out.println("\u4f18\u96c5\u5173\u95ed\u6d88\u8d39\u8005...");\n    consumer.wakeup();\n}));\n\ntry {\n    while (true) {\n        ConsumerRecords<String, String> records =\n            consumer.poll(Duration.ofMillis(100));\n        // \u5904\u7406\u6d88\u606f\n    }\n} catch (WakeupException e) {\n    // \u5ffd\u7565\uff0c\u51c6\u5907\u5173\u95ed\n} finally {\n    consumer.commitSync();\n    consumer.close();\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"2-\u907f\u514d\u518d\u5747\u8861",children:"2. \u907f\u514d\u518d\u5747\u8861"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// \u589e\u52a0 session timeout\nprops.put("session.timeout.ms", 30000);\n\n// \u589e\u52a0 max.poll.interval.ms\nprops.put("max.poll.interval.ms", 600000);\n\n// \u51cf\u5c11\u5355\u6b21\u62c9\u53d6\u6570\u91cf\nprops.put("max.poll.records", 100);\n'})}),"\n",(0,s.jsx)(e.h3,{id:"3-\u7cbe\u786e\u4e00\u6b21\u6d88\u8d39",children:"3. \u7cbe\u786e\u4e00\u6b21\u6d88\u8d39"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'// \u914d\u7f6e\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\nprops.put("isolation.level", "read_committed");\n\n// \u624b\u52a8\u63d0\u4ea4\u4f4d\u79fb\nprops.put("enable.auto.commit", "false");\n\nwhile (true) {\n    ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\n\n    for (ConsumerRecord<String, String> record : records) {\n        // \u5904\u7406\u6d88\u606f\u548c\u63d0\u4ea4\u4f4d\u79fb\u5728\u540c\u4e00\u4e2a\u4e8b\u52a1\u4e2d\n        processRecordInTransaction(record);\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\ud83d\udcbe ",(0,s.jsx)(e.a,{href:"./message-storage.md",children:"\u6d88\u606f\u5b58\u50a8\u673a\u5236"})," - \u4e86\u89e3 Kafka \u5982\u4f55\u5b58\u50a8\u6d88\u606f"]}),"\n",(0,s.jsxs)(e.li,{children:["\ud83d\udd27 ",(0,s.jsx)(e.a,{href:"/docs/kafka/cluster-management",children:"\u96c6\u7fa4\u7ba1\u7406"})," - \u5b66\u4e60\u96c6\u7fa4\u7ba1\u7406"]}),"\n",(0,s.jsxs)(e.li,{children:["\u26a1 ",(0,s.jsx)(e.a,{href:"/docs/kafka/performance-optimization",children:"\u6027\u80fd\u4f18\u5316"})," - \u4f18\u5316\u6d88\u8d39\u6027\u80fd"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://kafka.apache.org/documentation/#consumerapi",children:"Consumer API \u5b98\u65b9\u6587\u6863"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://kafka.apache.org/documentation/#consumerconfigs",children:"Consumer Configuration"})}),"\n"]})]})}function p(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}}}]);
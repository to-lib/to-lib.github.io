"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[52250],{48885:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var r=s(99378);const a={},i=r.createContext(a);function t(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),r.createElement(i.Provider,{value:n},e.children)}},50501:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>o,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"redis/streams","title":"Stream \u6570\u636e\u6d41","description":"Redis Stream \u662f Redis 5.0 \u5f15\u5165\u7684\u65b0\u6570\u636e\u7c7b\u578b\uff0c\u4e13\u95e8\u7528\u4e8e\u6d88\u606f\u961f\u5217\u548c\u65e5\u5fd7\u5b58\u50a8\u573a\u666f\u3002","source":"@site/docs/redis/streams.md","sourceDirName":"redis","slug":"/redis/streams","permalink":"/docs/redis/streams","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/redis/streams.md","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11,"title":"Stream \u6570\u636e\u6d41"},"sidebar":"redis","previous":{"title":"\u53d1\u5e03\u8ba2\u9605","permalink":"/docs/redis/pubsub"},"next":{"title":"\u7ba1\u9053\u548c\u6279\u91cf\u64cd\u4f5c","permalink":"/docs/redis/pipeline"}}');var a=s(22714),i=s(48885);const t={sidebar_position:11,title:"Stream \u6570\u636e\u6d41"},l="Redis Stream \u6570\u636e\u6d41",d={},c=[{value:"Stream \u7b80\u4ecb",id:"stream-\u7b80\u4ecb",level:2},{value:"\u6838\u5fc3\u6982\u5ff5",id:"\u6838\u5fc3\u6982\u5ff5",level:3},{value:"\u4e0e Pub/Sub \u5bf9\u6bd4",id:"\u4e0e-pubsub-\u5bf9\u6bd4",level:3},{value:"\u57fa\u672c\u547d\u4ee4",id:"\u57fa\u672c\u547d\u4ee4",level:2},{value:"XADD - \u6dfb\u52a0\u6d88\u606f",id:"xadd---\u6dfb\u52a0\u6d88\u606f",level:3},{value:"XREAD - \u8bfb\u53d6\u6d88\u606f",id:"xread---\u8bfb\u53d6\u6d88\u606f",level:3},{value:"XLEN - \u83b7\u53d6\u957f\u5ea6",id:"xlen---\u83b7\u53d6\u957f\u5ea6",level:3},{value:"XRANGE - \u8303\u56f4\u67e5\u8be2",id:"xrange---\u8303\u56f4\u67e5\u8be2",level:3},{value:"XDEL - \u5220\u9664\u6d88\u606f",id:"xdel---\u5220\u9664\u6d88\u606f",level:3},{value:"XTRIM - \u88c1\u526a Stream",id:"xtrim---\u88c1\u526a-stream",level:3},{value:"\u6d88\u8d39\u7ec4",id:"\u6d88\u8d39\u7ec4",level:2},{value:"XGROUP CREATE - \u521b\u5efa\u6d88\u8d39\u7ec4",id:"xgroup-create---\u521b\u5efa\u6d88\u8d39\u7ec4",level:3},{value:"XREADGROUP - \u7ec4\u5185\u6d88\u8d39",id:"xreadgroup---\u7ec4\u5185\u6d88\u8d39",level:3},{value:"XACK - \u786e\u8ba4\u6d88\u606f",id:"xack---\u786e\u8ba4\u6d88\u606f",level:3},{value:"XPENDING - \u67e5\u770b\u5f85\u786e\u8ba4\u6d88\u606f",id:"xpending---\u67e5\u770b\u5f85\u786e\u8ba4\u6d88\u606f",level:3},{value:"XCLAIM - \u6d88\u606f\u8f6c\u79fb",id:"xclaim---\u6d88\u606f\u8f6c\u79fb",level:3},{value:"Java \u5b9e\u73b0",id:"java-\u5b9e\u73b0",level:2},{value:"\u6dfb\u52a0\u6d88\u606f",id:"\u6dfb\u52a0\u6d88\u606f",level:3},{value:"\u7b80\u5355\u6d88\u8d39",id:"\u7b80\u5355\u6d88\u8d39",level:3},{value:"\u6d88\u8d39\u7ec4\u5b9e\u73b0",id:"\u6d88\u8d39\u7ec4\u5b9e\u73b0",level:3},{value:"Spring Boot \u96c6\u6210",id:"spring-boot-\u96c6\u6210",level:3},{value:"\u5e94\u7528\u573a\u666f",id:"\u5e94\u7528\u573a\u666f",level:2},{value:"1. \u6d88\u606f\u961f\u5217",id:"1-\u6d88\u606f\u961f\u5217",level:3},{value:"2. \u65e5\u5fd7\u6536\u96c6",id:"2-\u65e5\u5fd7\u6536\u96c6",level:3},{value:"3. \u5b9e\u65f6\u76d1\u63a7",id:"3-\u5b9e\u65f6\u76d1\u63a7",level:3},{value:"4. \u4e8b\u4ef6\u6eaf\u6e90",id:"4-\u4e8b\u4ef6\u6eaf\u6e90",level:3},{value:"\u9ad8\u7ea7\u7279\u6027",id:"\u9ad8\u7ea7\u7279\u6027",level:2},{value:"1. \u6d88\u606f\u91cd\u8bd5",id:"1-\u6d88\u606f\u91cd\u8bd5",level:3},{value:"2. \u6d88\u606f\u8fc7\u671f",id:"2-\u6d88\u606f\u8fc7\u671f",level:3},{value:"3. \u591a Stream \u76d1\u542c",id:"3-\u591a-stream-\u76d1\u542c",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:2},{value:"1. \u6279\u91cf\u64cd\u4f5c",id:"1-\u6279\u91cf\u64cd\u4f5c",level:3},{value:"2. \u5408\u7406\u8bbe\u7f6e MAXLEN",id:"2-\u5408\u7406\u8bbe\u7f6e-maxlen",level:3},{value:"3. \u4f7f\u7528 COUNT \u9650\u5236",id:"3-\u4f7f\u7528-count-\u9650\u5236",level:3},{value:"\u76d1\u63a7\u548c\u7ba1\u7406",id:"\u76d1\u63a7\u548c\u7ba1\u7406",level:2},{value:"XINFO - \u67e5\u770b\u4fe1\u606f",id:"xinfo---\u67e5\u770b\u4fe1\u606f",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u5408\u7406\u5212\u5206\u6d88\u8d39\u7ec4",id:"1-\u5408\u7406\u5212\u5206\u6d88\u8d39\u7ec4",level:3},{value:"2. \u6d88\u606f\u683c\u5f0f\u5316",id:"2-\u6d88\u606f\u683c\u5f0f\u5316",level:3},{value:"3. \u9519\u8bef\u5904\u7406",id:"3-\u9519\u8bef\u5904\u7406",level:3},{value:"4. \u4f18\u96c5\u5173\u95ed",id:"4-\u4f18\u96c5\u5173\u95ed",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function m(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"redis-stream-\u6570\u636e\u6d41",children:"Redis Stream \u6570\u636e\u6d41"})}),"\n",(0,a.jsx)(n.p,{children:"Redis Stream \u662f Redis 5.0 \u5f15\u5165\u7684\u65b0\u6570\u636e\u7c7b\u578b\uff0c\u4e13\u95e8\u7528\u4e8e\u6d88\u606f\u961f\u5217\u548c\u65e5\u5fd7\u5b58\u50a8\u573a\u666f\u3002"}),"\n",(0,a.jsx)(n.h2,{id:"stream-\u7b80\u4ecb",children:"Stream \u7b80\u4ecb"}),"\n",(0,a.jsx)(n.h3,{id:"\u6838\u5fc3\u6982\u5ff5",children:"\u6838\u5fc3\u6982\u5ff5"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Stream"})," - \u6d88\u606f\u6d41\uff0c\u7c7b\u4f3c\u4e8e\u53ea\u80fd\u8ffd\u52a0\u7684\u65e5\u5fd7"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Entry"})," - \u6d88\u606f\u6761\u76ee\uff0c\u5305\u542b ID \u548c\u5b57\u6bb5-\u503c\u5bf9"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Consumer Group"})," - \u6d88\u8d39\u7ec4\uff0c\u652f\u6301\u5206\u5e03\u5f0f\u6d88\u8d39"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Consumer"})," - \u6d88\u8d39\u8005\uff0c\u4ece Stream \u8bfb\u53d6\u6d88\u606f"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"\u4e0e-pubsub-\u5bf9\u6bd4",children:"\u4e0e Pub/Sub \u5bf9\u6bd4"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"\u7279\u6027"}),(0,a.jsx)(n.th,{children:"Stream"}),(0,a.jsx)(n.th,{children:"Pub/Sub"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"\u6301\u4e45\u5316"}),(0,a.jsx)(n.td,{children:"\u2705 \u6301\u4e45\u5316"}),(0,a.jsx)(n.td,{children:"\u274c \u4e0d\u6301\u4e45\u5316"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"\u5386\u53f2\u6d88\u606f"}),(0,a.jsx)(n.td,{children:"\u2705 \u53ef\u8bfb\u53d6"}),(0,a.jsx)(n.td,{children:"\u274c \u4e0d\u53ef\u8bfb\u53d6"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"\u6d88\u8d39\u7ec4"}),(0,a.jsx)(n.td,{children:"\u2705 \u652f\u6301"}),(0,a.jsx)(n.td,{children:"\u274c \u4e0d\u652f\u6301"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"ACK \u786e\u8ba4"}),(0,a.jsx)(n.td,{children:"\u2705 \u652f\u6301"}),(0,a.jsx)(n.td,{children:"\u274c \u4e0d\u652f\u6301"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"\u6d88\u606f\u91cd\u8bd5"}),(0,a.jsx)(n.td,{children:"\u2705 \u652f\u6301"}),(0,a.jsx)(n.td,{children:"\u274c \u4e0d\u652f\u6301"})]})]})]}),"\n",(0,a.jsx)(n.h2,{id:"\u57fa\u672c\u547d\u4ee4",children:"\u57fa\u672c\u547d\u4ee4"}),"\n",(0,a.jsx)(n.h3,{id:"xadd---\u6dfb\u52a0\u6d88\u606f",children:"XADD - \u6dfb\u52a0\u6d88\u606f"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# \u8bed\u6cd5\nXADD stream_name ID field1 value1 [field2 value2 ...]\n\n# \u793a\u4f8b\uff1a\u81ea\u52a8\u751f\u6210 ID\nXADD mystream * name "Alice" age "25"\n# \u8fd4\u56de\uff1a1609459200000-0\n\n# \u6307\u5b9a ID\nXADD mystream 1609459200000-0 name "Bob" age "30"\n\n# ID \u683c\u5f0f\uff1a\u6beb\u79d2\u65f6\u95f4\u6233-\u5e8f\u5217\u53f7\n'})}),"\n",(0,a.jsx)(n.h3,{id:"xread---\u8bfb\u53d6\u6d88\u606f",children:"XREAD - \u8bfb\u53d6\u6d88\u606f"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u8bfb\u53d6\u6700\u65b0\u6d88\u606f\nXREAD COUNT 10 STREAMS mystream 0\n\n# \u963b\u585e\u8bfb\u53d6\nXREAD BLOCK 5000 STREAMS mystream $\n\n# \u4ece\u6307\u5b9a ID \u5f00\u59cb\u8bfb\u53d6\nXREAD STREAMS mystream 1609459200000-0\n"})}),"\n",(0,a.jsx)(n.h3,{id:"xlen---\u83b7\u53d6\u957f\u5ea6",children:"XLEN - \u83b7\u53d6\u957f\u5ea6"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u83b7\u53d6 Stream \u4e2d\u6d88\u606f\u6570\u91cf\nXLEN mystream\n"})}),"\n",(0,a.jsx)(n.h3,{id:"xrange---\u8303\u56f4\u67e5\u8be2",children:"XRANGE - \u8303\u56f4\u67e5\u8be2"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u8be2\u6240\u6709\u6d88\u606f\nXRANGE mystream - +\n\n# \u67e5\u8be2\u6307\u5b9a\u8303\u56f4\nXRANGE mystream 1609459200000-0 1609459300000-0\n\n# \u9650\u5236\u6570\u91cf\nXRANGE mystream - + COUNT 10\n"})}),"\n",(0,a.jsx)(n.h3,{id:"xdel---\u5220\u9664\u6d88\u606f",children:"XDEL - \u5220\u9664\u6d88\u606f"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u5220\u9664\u6307\u5b9a\u6d88\u606f\nXDEL mystream 1609459200000-0\n"})}),"\n",(0,a.jsx)(n.h3,{id:"xtrim---\u88c1\u526a-stream",children:"XTRIM - \u88c1\u526a Stream"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u4fdd\u7559\u6700\u65b0 1000 \u6761\nXTRIM mystream MAXLEN 1000\n\n# \u8fd1\u4f3c\u88c1\u526a\uff08\u6027\u80fd\u66f4\u597d\uff09\nXTRIM mystream MAXLEN ~ 1000\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u6d88\u8d39\u7ec4",children:"\u6d88\u8d39\u7ec4"}),"\n",(0,a.jsx)(n.h3,{id:"xgroup-create---\u521b\u5efa\u6d88\u8d39\u7ec4",children:"XGROUP CREATE - \u521b\u5efa\u6d88\u8d39\u7ec4"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u8bed\u6cd5\nXGROUP CREATE stream_name group_name start_id\n\n# \u4ece\u5934\u5f00\u59cb\u6d88\u8d39\nXGROUP CREATE mystream mygroup 0\n\n# \u4ecestream\u672b\u5c3e\u5f00\u59cb\nXGROUP CREATE mystream mygroup $\n\n# \u521b\u5efastream\u5e76\u521b\u5efa\u6d88\u8d39\u7ec4\nXGROUP CREATE mystream mygroup $ MKSTREAM\n"})}),"\n",(0,a.jsx)(n.h3,{id:"xreadgroup---\u7ec4\u5185\u6d88\u8d39",children:"XREADGROUP - \u7ec4\u5185\u6d88\u8d39"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u8bed\u6cd5\nXREADGROUP GROUP group consumer COUNT count STREAMS stream >\n\n# \u793a\u4f8b\nXREADGROUP GROUP mygroup consumer1 COUNT 10 STREAMS mystream >\n\n# \u963b\u585e\u8bfb\u53d6\nXREADGROUP GROUP mygroup consumer1 BLOCK 5000 COUNT 10 STREAMS mystream >\n"})}),"\n",(0,a.jsx)(n.h3,{id:"xack---\u786e\u8ba4\u6d88\u606f",children:"XACK - \u786e\u8ba4\u6d88\u606f"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u786e\u8ba4\u5df2\u5904\u7406\u7684\u6d88\u606f\nXACK mystream mygroup 1609459200000-0 1609459200001-0\n"})}),"\n",(0,a.jsx)(n.h3,{id:"xpending---\u67e5\u770b\u5f85\u786e\u8ba4\u6d88\u606f",children:"XPENDING - \u67e5\u770b\u5f85\u786e\u8ba4\u6d88\u606f"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b\u6d88\u8d39\u7ec4\u7684\u5f85\u786e\u8ba4\u6d88\u606f\nXPENDING mystream mygroup\n\n# \u67e5\u770b\u8be6\u7ec6\u4fe1\u606f\nXPENDING mystream mygroup - + 10\n\n# \u67e5\u770b\u6307\u5b9a\u6d88\u8d39\u8005\u7684\u5f85\u786e\u8ba4\u6d88\u606f\nXPENDING mystream mygroup - + 10 consumer1\n"})}),"\n",(0,a.jsx)(n.h3,{id:"xclaim---\u6d88\u606f\u8f6c\u79fb",children:"XCLAIM - \u6d88\u606f\u8f6c\u79fb"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u5c06\u6d88\u606f\u8f6c\u79fb\u7ed9\u5176\u4ed6\u6d88\u8d39\u8005\nXCLAIM mystream mygroup consumer2 3600000 1609459200000-0\n"})}),"\n",(0,a.jsx)(n.h2,{id:"java-\u5b9e\u73b0",children:"Java \u5b9e\u73b0"}),"\n",(0,a.jsx)(n.h3,{id:"\u6dfb\u52a0\u6d88\u606f",children:"\u6dfb\u52a0\u6d88\u606f"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'import redis.clients.jedis.Jedis;\nimport redis.clients.jedis.StreamEntryID;\n\npublic class StreamProducer {\n    public static void main(String[] args) {\n        Jedis jedis = new Jedis("localhost", 6379);\n\n        // \u6dfb\u52a0\u6d88\u606f\n        Map<String, String> message = new HashMap<>();\n        message.put("user", "Alice");\n        message.put("action", "login");\n        message.put("timestamp", String.valueOf(System.currentTimeMillis()));\n\n        StreamEntryID id = jedis.xadd(\n            "user-events",      // stream name\n            StreamEntryID.NEW_ENTRY,  // \u81ea\u52a8\u751f\u6210ID\n            message\n        );\n\n        System.out.println("\u6d88\u606fID: " + id);\n        jedis.close();\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u7b80\u5355\u6d88\u8d39",children:"\u7b80\u5355\u6d88\u8d39"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'import redis.clients.jedis.Jedis;\nimport redis.clients.jedis.StreamEntry;\nimport redis.clients.jedis.params.XReadParams;\n\nimport java.util.List;\nimport java.util.Map;\n\npublic class StreamConsumer {\n    public static void main(String[] args) {\n        Jedis jedis = new Jedis("localhost", 6379);\n\n        String lastId = "0";  // \u4ece\u5934\u5f00\u59cb\n\n        while (true) {\n            // \u8bfb\u53d6\u6d88\u606f\n            List<Map.Entry<String, List<StreamEntry>>> result = jedis.xread(\n                XReadParams.xReadParams().count(10).block(5000),\n                Map.of("user-events", lastId)\n            );\n\n            if (result != null && !result.isEmpty()) {\n                for (Map.Entry<String, List<StreamEntry>> entry : result) {\n                    for (StreamEntry streamEntry : entry.getValue()) {\n                        System.out.println("\u6d88\u606fID: " + streamEntry.getID());\n                        System.out.println("\u5185\u5bb9: " + streamEntry.getFields());\n\n                        lastId = streamEntry.getID().toString();\n                    }\n                }\n            }\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u6d88\u8d39\u7ec4\u5b9e\u73b0",children:"\u6d88\u8d39\u7ec4\u5b9e\u73b0"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'import redis.clients.jedis.Jedis;\nimport redis.clients.jedis.StreamEntry;\nimport redis.clients.jedis.params.XReadGroupParams;\n\npublic class StreamGroupConsumer {\n    public static void main(String[] args) {\n        Jedis jedis = new Jedis("localhost", 6379);\n\n        String streamName = "user-events";\n        String groupName = "event-processors";\n        String consumerName = "consumer-1";\n\n        try {\n            // \u521b\u5efa\u6d88\u8d39\u7ec4\n            jedis.xgroupCreate(streamName, groupName, "0", true);\n        } catch (Exception e) {\n            // \u6d88\u8d39\u7ec4\u5df2\u5b58\u5728\n        }\n\n        while (true) {\n            // \u8bfb\u53d6\u6d88\u606f\n            List<Map.Entry<String, List<StreamEntry>>> messages =\n                jedis.xreadGroup(\n                    groupName,\n                    consumerName,\n                    XReadGroupParams.xReadGroupParams().count(10).block(5000),\n                    Map.of(streamName, ">")\n                );\n\n            if (messages != null && !messages.isEmpty()) {\n                for (Map.Entry<String, List<StreamEntry>> entry : messages) {\n                    for (StreamEntry msg : entry.getValue()) {\n                        try {\n                            // \u5904\u7406\u6d88\u606f\n                            processMessage(msg);\n\n                            // \u786e\u8ba4\u6d88\u606f\n                            jedis.xack(streamName, groupName, msg.getID());\n                        } catch (Exception e) {\n                            System.err.println("\u5904\u7406\u5931\u8d25: " + e.getMessage());\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    private static void processMessage(StreamEntry msg) {\n        System.out.println("\u5904\u7406\u6d88\u606f: " + msg.getID());\n        System.out.println("\u5185\u5bb9: " + msg.getFields());\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"spring-boot-\u96c6\u6210",children:"Spring Boot \u96c6\u6210"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class RedisStreamConfig {\n\n    @Bean\n    public StreamMessageListenerContainer<String, MapRecord<String, String, String>>\n            streamMessageListenerContainer(RedisConnectionFactory connectionFactory) {\n\n        StreamMessageListenerContainerOptions<String, MapRecord<String, String, String>> options =\n            StreamMessageListenerContainerOptions\n                .builder()\n                .pollTimeout(Duration.ofSeconds(1))\n                .build();\n\n        StreamMessageListenerContainer<String, MapRecord<String, String, String>> container =\n            StreamMessageListenerContainer.create(connectionFactory, options);\n\n        // \u8ba2\u9605 Stream\n        container.receive(\n            Consumer.from("event-group", "consumer-1"),\n            StreamOffset.create("user-events", ReadOffset.lastConsumed()),\n            message -> {\n                System.out.println("\u6536\u5230\u6d88\u606f: " + message.getValue());\n                // \u5904\u7406\u6d88\u606f...\n            }\n        );\n\n        container.start();\n        return container;\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u5e94\u7528\u573a\u666f",children:"\u5e94\u7528\u573a\u666f"}),"\n",(0,a.jsx)(n.h3,{id:"1-\u6d88\u606f\u961f\u5217",children:"1. \u6d88\u606f\u961f\u5217"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# \u751f\u4ea7\u8005\nXADD task-queue * type "email" to "user@example.com" subject "Welcome"\n\n# \u6d88\u8d39\u7ec4\nXGROUP CREATE task-queue email-workers $ MKSTREAM\n\n# \u6d88\u8d39\u8005\nXREADGROUP GROUP email-workers worker-1 COUNT 1 STREAMS task-queue >\n'})}),"\n",(0,a.jsx)(n.h3,{id:"2-\u65e5\u5fd7\u6536\u96c6",children:"2. \u65e5\u5fd7\u6536\u96c6"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# \u5e94\u7528\u65e5\u5fd7\nXADD app-logs * level "ERROR" message "Connection timeout" service "api-server"\n\n# \u8bbf\u95ee\u65e5\u5fd7\nXADD access-logs * method "GET" path "/api/users" status "200" duration "45ms"\n\n# \u67e5\u8be2\u6700\u8fd1\u7684\u9519\u8bef\u65e5\u5fd7\nXREVRANGE app-logs + - COUNT 100\n'})}),"\n",(0,a.jsx)(n.h3,{id:"3-\u5b9e\u65f6\u76d1\u63a7",children:"3. \u5b9e\u65f6\u76d1\u63a7"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# \u7cfb\u7edf\u6307\u6807\nXADD metrics * cpu "45.2" memory "78.5" disk "62.1"\n\n# \u4e1a\u52a1\u6307\u6807\nXADD business-metrics * orders "1234" revenue "56789.00" users "9876"\n'})}),"\n",(0,a.jsx)(n.h3,{id:"4-\u4e8b\u4ef6\u6eaf\u6e90",children:"4. \u4e8b\u4ef6\u6eaf\u6e90"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# \u8bb0\u5f55\u6240\u6709\u4e8b\u4ef6\nXADD order-events * type "created" orderId "12345" amount "99.99"\nXADD order-events * type "paid" orderId "12345" paymentId "PAY-001"\nXADD order-events * type "shipped" orderId "12345" trackingNo "TRACK-001"\n\n# \u56de\u653e\u4e8b\u4ef6\nXRANGE order-events - +\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u9ad8\u7ea7\u7279\u6027",children:"\u9ad8\u7ea7\u7279\u6027"}),"\n",(0,a.jsx)(n.h3,{id:"1-\u6d88\u606f\u91cd\u8bd5",children:"1. \u6d88\u606f\u91cd\u8bd5"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"// \u67e5\u627e\u957f\u65f6\u95f4\u672a\u786e\u8ba4\u7684\u6d88\u606f\nList<StreamPendingEntry> pending = jedis.xpending(\n    streamName,\n    groupName,\n    null, null, 100,\n    consumerName\n);\n\n// \u91cd\u65b0\u5904\u7406\u8d85\u65f6\u6d88\u606f\nfor (StreamPendingEntry entry : pending) {\n    if (entry.getIdleTime() > 60000) {  // \u8d85\u8fc71\u5206\u949f\n        // \u8f6c\u79fb\u7ed9\u5f53\u524d\u6d88\u8d39\u8005\n        List<StreamEntry> claimed = jedis.xclaim(\n            streamName,\n            groupName,\n            consumerName,\n            60000,\n            entry.getID()\n        );\n\n        // \u91cd\u65b0\u5904\u7406\n        for (StreamEntry msg : claimed) {\n            processMessage(msg);\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-\u6d88\u606f\u8fc7\u671f",children:"2. \u6d88\u606f\u8fc7\u671f"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u81ea\u52a8\u88c1\u526a\uff0c\u4fdd\u7559\u6700\u65b0 10000 \u6761\nXTRIM mystream MAXLEN ~ 10000\n\n# \u57fa\u4e8e\u65f6\u95f4\u88c1\u526a\uff08\u9700\u8981\u5b9a\u671f\u6267\u884c\uff09\n# \u5220\u9664 7 \u5929\u524d\u7684\u6d88\u606f\nXDEL mystream $(XRANGE mystream - $(expr $(date +%s) - 604800)000-0)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-\u591a-stream-\u76d1\u542c",children:"3. \u591a Stream \u76d1\u542c"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u540c\u65f6\u76d1\u542c\u591a\u4e2a Stream\nMap<String, StreamEntryID> streams = new HashMap<>();\nstreams.put("orders", lastOrderId);\nstreams.put("payments", lastPaymentId);\nstreams.put("shipments", lastShipmentId);\n\nList<Map.Entry<String, List<StreamEntry>>> results =\n    jedis.xread(\n        XReadParams.xReadParams().count(10).block(1000),\n        streams\n    );\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,a.jsx)(n.h3,{id:"1-\u6279\u91cf\u64cd\u4f5c",children:"1. \u6279\u91cf\u64cd\u4f5c"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Pipeline \u6279\u91cf\u6dfb\u52a0\nMULTI\nXADD stream1 * field1 value1\nXADD stream1 * field2 value2\nXADD stream1 * field3 value3\nEXEC\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-\u5408\u7406\u8bbe\u7f6e-maxlen",children:"2. \u5408\u7406\u8bbe\u7f6e MAXLEN"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u907f\u514d\u65e0\u9650\u589e\u957f\nXADD mystream MAXLEN ~ 10000 * field value\n\n# \u5b9a\u671f\u88c1\u526a\nXTRIM mystream MAXLEN ~ 10000\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-\u4f7f\u7528-count-\u9650\u5236",children:"3. \u4f7f\u7528 COUNT \u9650\u5236"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u907f\u514d\u4e00\u6b21\u8bfb\u53d6\u8fc7\u591a\nXREAD COUNT 100 STREAMS mystream 0\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u76d1\u63a7\u548c\u7ba1\u7406",children:"\u76d1\u63a7\u548c\u7ba1\u7406"}),"\n",(0,a.jsx)(n.h3,{id:"xinfo---\u67e5\u770b\u4fe1\u606f",children:"XINFO - \u67e5\u770b\u4fe1\u606f"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Stream \u4fe1\u606f\nXINFO STREAM mystream\n\n# \u6d88\u8d39\u7ec4\u4fe1\u606f\nXINFO GROUPS mystream\n\n# \u6d88\u8d39\u8005\u4fe1\u606f\nXINFO CONSUMERS mystream mygroup\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,a.jsx)(n.h3,{id:"1-\u5408\u7406\u5212\u5206\u6d88\u8d39\u7ec4",children:"1. \u5408\u7406\u5212\u5206\u6d88\u8d39\u7ec4"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u6309\u529f\u80fd\u5212\u5206\nXGROUP CREATE orders email-group $    # \u53d1\u90ae\u4ef6\nXGROUP CREATE orders sms-group $      # \u53d1\u77ed\u4fe1\nXGROUP CREATE orders log-group $      # \u8bb0\u5f55\u65e5\u5fd7\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-\u6d88\u606f\u683c\u5f0f\u5316",children:"2. \u6d88\u606f\u683c\u5f0f\u5316"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'// \u4f7f\u7528 JSON \u683c\u5f0f\nString message = new JSONObject()\n    .put("eventType", "ORDER_CREATED")\n    .put("orderId", "12345")\n    .put("timestamp", System.currentTimeMillis())\n    .put("data", new JSONObject()\n        .put("amount", 99.99)\n        .put("userId", 1001)\n    )\n    .toString();\n\njedis.xadd("orders", "*", Map.of("payload", message));\n'})}),"\n",(0,a.jsx)(n.h3,{id:"3-\u9519\u8bef\u5904\u7406",children:"3. \u9519\u8bef\u5904\u7406"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'try {\n    processMessage(msg);\n    jedis.xack(streamName, groupName, msg.getID());\n} catch (Exception e) {\n    // \u8bb0\u5f55\u9519\u8bef\n    log.error("\u5904\u7406\u5931\u8d25", e);\n\n    // \u8f6c\u79fb\u5230\u6b7b\u4fe1\u961f\u5217\n    jedis.xadd(\n        "dlq-" + streamName,\n        "*",\n        Map.of(\n            "originalId", msg.getID().toString(),\n            "error", e.getMessage(),\n            "payload", msg.getFields().toString()\n        )\n    );\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"4-\u4f18\u96c5\u5173\u95ed",children:"4. \u4f18\u96c5\u5173\u95ed"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"Runtime.getRuntime().addShutdownHook(new Thread(() -> {\n    container.stop();\n    jedis.close();\n}));\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u2705 Stream \u662f\u529f\u80fd\u5f3a\u5927\u7684\u6d88\u606f\u961f\u5217\u89e3\u51b3\u65b9\u6848"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 \u652f\u6301\u6301\u4e45\u5316\u3001\u6d88\u8d39\u7ec4\u3001ACK \u786e\u8ba4"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 \u9002\u5408\u65e5\u5fd7\u6536\u96c6\u3001\u6d88\u606f\u961f\u5217\u3001\u4e8b\u4ef6\u6eaf\u6e90"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 \u6bd4 Pub/Sub \u66f4\u53ef\u9760\uff0c\u4f46\u5f00\u9500\u7a0d\u5927"}),"\n",(0,a.jsx)(n.li,{children:"\ud83d\udca1 \u751f\u4ea7\u73af\u5883\u63a8\u8350\u4f7f\u7528 Stream \u4ee3\u66ff Pub/Sub"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Stream \u662f Redis \u6d88\u606f\u961f\u5217\u7684\u6700\u4f73\u9009\u62e9\uff01"})]})}function o(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}}}]);
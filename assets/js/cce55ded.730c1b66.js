"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[22343],{48885:(n,e,t)=>{t.d(e,{R:()=>i,x:()=>s});var o=t(99378);const l={},r=o.createContext(l);function i(n){const e=o.useContext(r);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:i(n.components),o.createElement(r.Provider,{value:e},n.children)}},62693:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"react/portals","title":"Portals","description":"[!TIP]","source":"@site/docs/react/portals.md","sourceDirName":"react","slug":"/react/portals","permalink":"/docs/react/portals","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/react/portals.md","tags":[],"version":"current","sidebarPosition":18,"frontMatter":{"sidebar_position":18,"title":"Portals"}}');var l=t(22714),r=t(48885);const i={sidebar_position:18,title:"Portals"},s="React Portals",d={},a=[{value:"\ud83c\udfaf \u4ec0\u4e48\u662f Portal\uff1f",id:"-\u4ec0\u4e48\u662f-portal",level:2},{value:"\ud83d\udce6 \u57fa\u7840\u7528\u6cd5",id:"-\u57fa\u7840\u7528\u6cd5",level:2},{value:"HTML \u7ed3\u6784",id:"html-\u7ed3\u6784",level:3},{value:"\ud83c\udfa8 \u5b8c\u6574\u6a21\u6001\u6846\u7ec4\u4ef6",id:"-\u5b8c\u6574\u6a21\u6001\u6846\u7ec4\u4ef6",level:2},{value:"\ud83d\udccc \u4e0b\u62c9\u83dc\u5355 / Tooltip",id:"-\u4e0b\u62c9\u83dc\u5355--tooltip",level:2},{value:"\ud83d\udd04 \u4e8b\u4ef6\u5192\u6ce1",id:"-\u4e8b\u4ef6\u5192\u6ce1",level:2},{value:"\u963b\u6b62\u5192\u6ce1",id:"\u963b\u6b62\u5192\u6ce1",level:3},{value:"\ud83d\udca1 \u6700\u4f73\u5b9e\u8df5",id:"-\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u786e\u4fdd\u6302\u8f7d\u70b9\u5b58\u5728",id:"1-\u786e\u4fdd\u6302\u8f7d\u70b9\u5b58\u5728",level:3},{value:"2. \u4f7f\u7528 Context \u4f20\u9012\u6570\u636e",id:"2-\u4f7f\u7528-context-\u4f20\u9012\u6570\u636e",level:3},{value:"3. \u7126\u70b9\u7ba1\u7406",id:"3-\u7126\u70b9\u7ba1\u7406",level:3},{value:"\ud83d\udd17 \u76f8\u5173\u8d44\u6e90",id:"-\u76f8\u5173\u8d44\u6e90",level:2}];function c(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"react-portals",children:"React Portals"})}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"[!TIP]\nPortals \u5141\u8bb8\u4f60\u5c06\u5b50\u7ec4\u4ef6\u6e32\u67d3\u5230\u7236\u7ec4\u4ef6 DOM \u5c42\u6b21\u7ed3\u6784\u4e4b\u5916\u7684 DOM \u8282\u70b9\u4e2d\uff0c\u5e38\u7528\u4e8e\u6a21\u6001\u6846\u3001\u5f39\u51fa\u83dc\u5355\u3001\u63d0\u793a\u6846\u7b49\u573a\u666f\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"-\u4ec0\u4e48\u662f-portal",children:"\ud83c\udfaf \u4ec0\u4e48\u662f Portal\uff1f"}),"\n",(0,l.jsx)(e.p,{children:"Portal \u63d0\u4f9b\u4e86\u4e00\u79cd\u5c06\u5b50\u8282\u70b9\u6e32\u67d3\u5230\u5b58\u5728\u4e8e\u7236\u7ec4\u4ef6\u4ee5\u5916\u7684 DOM \u8282\u70b9\u7684\u65b9\u6848\u3002"}),"\n",(0,l.jsx)(e.mermaid,{value:"graph TB\n    A[App Component] --\x3e B[#root]\n    A --\x3e C[Modal Portal]\n    C -.->|Renders to| D[#modal-root]\n\n    style C fill:#fff9c4\n    style D fill:#e1f5ff"}),"\n",(0,l.jsx)(e.h2,{id:"-\u57fa\u7840\u7528\u6cd5",children:"\ud83d\udce6 \u57fa\u7840\u7528\u6cd5"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-jsx",children:'import { createPortal } from "react-dom";\n\nfunction Modal({ children, isOpen }) {\n  if (!isOpen) return null;\n\n  return createPortal(\n    <div className="modal-overlay">\n      <div className="modal-content">{children}</div>\n    </div>,\n    document.getElementById("modal-root")\n  );\n}\n\n// \u4f7f\u7528\nfunction App() {\n  const [showModal, setShowModal] = useState(false);\n\n  return (\n    <div>\n      <button onClick={() => setShowModal(true)}>\u6253\u5f00\u6a21\u6001\u6846</button>\n      <Modal isOpen={showModal}>\n        <h2>\u6a21\u6001\u6846\u6807\u9898</h2>\n        <p>\u6a21\u6001\u6846\u5185\u5bb9</p>\n        <button onClick={() => setShowModal(false)}>\u5173\u95ed</button>\n      </Modal>\n    </div>\n  );\n}\n'})}),"\n",(0,l.jsx)(e.h3,{id:"html-\u7ed3\u6784",children:"HTML \u7ed3\u6784"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-html",children:'<body>\n  <div id="root">\n    \x3c!-- React \u5e94\u7528 --\x3e\n  </div>\n  <div id="modal-root">\n    \x3c!-- Portal \u5185\u5bb9\u6e32\u67d3\u5230\u8fd9\u91cc --\x3e\n  </div>\n</body>\n'})}),"\n",(0,l.jsx)(e.h2,{id:"-\u5b8c\u6574\u6a21\u6001\u6846\u7ec4\u4ef6",children:"\ud83c\udfa8 \u5b8c\u6574\u6a21\u6001\u6846\u7ec4\u4ef6"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-jsx",children:'import { createPortal } from "react-dom";\nimport { useEffect, useRef } from "react";\n\nfunction Modal({ isOpen, onClose, title, children }) {\n  const overlayRef = useRef(null);\n\n  // ESC \u952e\u5173\u95ed\n  useEffect(() => {\n    const handleEsc = (e) => {\n      if (e.key === "Escape") onClose();\n    };\n\n    if (isOpen) {\n      document.addEventListener("keydown", handleEsc);\n      document.body.style.overflow = "hidden"; // \u7981\u6b62\u80cc\u666f\u6eda\u52a8\n    }\n\n    return () => {\n      document.removeEventListener("keydown", handleEsc);\n      document.body.style.overflow = "";\n    };\n  }, [isOpen, onClose]);\n\n  // \u70b9\u51fb\u906e\u7f69\u5173\u95ed\n  const handleOverlayClick = (e) => {\n    if (e.target === overlayRef.current) {\n      onClose();\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return createPortal(\n    <div\n      ref={overlayRef}\n      onClick={handleOverlayClick}\n      className="modal-overlay"\n      style={{\n        position: "fixed",\n        inset: 0,\n        backgroundColor: "rgba(0, 0, 0, 0.5)",\n        display: "flex",\n        alignItems: "center",\n        justifyContent: "center",\n        zIndex: 1000,\n      }}\n    >\n      <div\n        className="modal-content"\n        role="dialog"\n        aria-modal="true"\n        aria-labelledby="modal-title"\n        style={{\n          background: "white",\n          borderRadius: "8px",\n          padding: "24px",\n          maxWidth: "500px",\n          width: "90%",\n        }}\n      >\n        <header style={{ display: "flex", justifyContent: "space-between" }}>\n          <h2 id="modal-title">{title}</h2>\n          <button onClick={onClose} aria-label="\u5173\u95ed">\n            \xd7\n          </button>\n        </header>\n        <div>{children}</div>\n      </div>\n    </div>,\n    document.getElementById("modal-root")\n  );\n}\n'})}),"\n",(0,l.jsx)(e.h2,{id:"-\u4e0b\u62c9\u83dc\u5355--tooltip",children:"\ud83d\udccc \u4e0b\u62c9\u83dc\u5355 / Tooltip"}),"\n",(0,l.jsx)(e.p,{children:"Portal \u4e5f\u9002\u7528\u4e8e\u9700\u8981\u8131\u79bb\u7236\u5bb9\u5668\u5b9a\u4f4d\u7684\u5143\u7d20\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-jsx",children:'function Tooltip({ children, content, position = "top" }) {\n  const [isVisible, setIsVisible] = useState(false);\n  const [coords, setCoords] = useState({ top: 0, left: 0 });\n  const triggerRef = useRef(null);\n\n  const showTooltip = () => {\n    const rect = triggerRef.current.getBoundingClientRect();\n    setCoords({\n      top: position === "top" ? rect.top - 8 : rect.bottom + 8,\n      left: rect.left + rect.width / 2,\n    });\n    setIsVisible(true);\n  };\n\n  return (\n    <>\n      <span\n        ref={triggerRef}\n        onMouseEnter={showTooltip}\n        onMouseLeave={() => setIsVisible(false)}\n      >\n        {children}\n      </span>\n\n      {isVisible &&\n        createPortal(\n          <div\n            style={{\n              position: "fixed",\n              top: coords.top,\n              left: coords.left,\n              transform: "translateX(-50%)",\n              background: "#333",\n              color: "white",\n              padding: "4px 8px",\n              borderRadius: "4px",\n              fontSize: "12px",\n              zIndex: 9999,\n            }}\n          >\n            {content}\n          </div>,\n          document.body\n        )}\n    </>\n  );\n}\n\n// \u4f7f\u7528\n<Tooltip content="\u8fd9\u662f\u4e00\u4e2a\u63d0\u793a">\n  <button>\u60ac\u505c\u67e5\u770b</button>\n</Tooltip>;\n'})}),"\n",(0,l.jsx)(e.h2,{id:"-\u4e8b\u4ef6\u5192\u6ce1",children:"\ud83d\udd04 \u4e8b\u4ef6\u5192\u6ce1"}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsxs)(e.p,{children:["[!IMPORTANT]\n\u5373\u4f7f Portal \u5c06 DOM \u6e32\u67d3\u5230\u5176\u4ed6\u4f4d\u7f6e\uff0c",(0,l.jsx)(e.strong,{children:"React \u4e8b\u4ef6\u4ecd\u7136\u6309\u7167\u7ec4\u4ef6\u6811\u5192\u6ce1"}),"\uff0c\u800c\u975e DOM \u6811\u3002"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-jsx",children:'function Parent() {\n  const handleClick = () => {\n    console.log("Parent clicked!"); // \u4f1a\u89e6\u53d1\uff01\n  };\n\n  return (\n    <div onClick={handleClick}>\n      <Modal isOpen={true}>\n        <button>\u70b9\u51fb\u6211</button> {/* \u70b9\u51fb\u4f1a\u5192\u6ce1\u5230 Parent */}\n      </Modal>\n    </div>\n  );\n}\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u963b\u6b62\u5192\u6ce1",children:"\u963b\u6b62\u5192\u6ce1"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-jsx",children:'function Modal({ children }) {\n  const handleClick = (e) => {\n    e.stopPropagation(); // \u963b\u6b62\u5192\u6ce1\u5230\u7236\u7ec4\u4ef6\n  };\n\n  return createPortal(\n    <div onClick={handleClick}>{children}</div>,\n    document.getElementById("modal-root")\n  );\n}\n'})}),"\n",(0,l.jsx)(e.h2,{id:"-\u6700\u4f73\u5b9e\u8df5",children:"\ud83d\udca1 \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,l.jsx)(e.h3,{id:"1-\u786e\u4fdd\u6302\u8f7d\u70b9\u5b58\u5728",children:"1. \u786e\u4fdd\u6302\u8f7d\u70b9\u5b58\u5728"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-jsx",children:'function Modal({ isOpen, children }) {\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  if (!mounted || !isOpen) return null;\n\n  const modalRoot = document.getElementById("modal-root");\n  if (!modalRoot) return null;\n\n  return createPortal(children, modalRoot);\n}\n'})}),"\n",(0,l.jsx)(e.h3,{id:"2-\u4f7f\u7528-context-\u4f20\u9012\u6570\u636e",children:"2. \u4f7f\u7528 Context \u4f20\u9012\u6570\u636e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-jsx",children:'const ModalContext = createContext();\n\nfunction ModalProvider({ children }) {\n  const [modals, setModals] = useState([]);\n\n  const openModal = (content) => {\n    setModals((prev) => [...prev, { id: Date.now(), content }]);\n  };\n\n  const closeModal = (id) => {\n    setModals((prev) => prev.filter((m) => m.id !== id));\n  };\n\n  return (\n    <ModalContext.Provider value={{ openModal, closeModal }}>\n      {children}\n      {modals.map((modal) =>\n        createPortal(\n          <div key={modal.id}>{modal.content}</div>,\n          document.getElementById("modal-root")\n        )\n      )}\n    </ModalContext.Provider>\n  );\n}\n'})}),"\n",(0,l.jsx)(e.h3,{id:"3-\u7126\u70b9\u7ba1\u7406",children:"3. \u7126\u70b9\u7ba1\u7406"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-jsx",children:"function Modal({ isOpen, onClose, children }) {\n  const firstFocusableRef = useRef(null);\n\n  useEffect(() => {\n    if (isOpen && firstFocusableRef.current) {\n      firstFocusableRef.current.focus();\n    }\n  }, [isOpen]);\n\n  // ... \u5176\u4f59\u5b9e\u73b0\n}\n"})}),"\n",(0,l.jsx)(e.h2,{id:"-\u76f8\u5173\u8d44\u6e90",children:"\ud83d\udd17 \u76f8\u5173\u8d44\u6e90"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"/docs/react/refs-dom",children:"Refs \u548c DOM"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"/docs/react/accessibility",children:"\u53ef\u8bbf\u95ee\u6027"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"/docs/react/composition-patterns",children:"\u7ec4\u4ef6\u7ec4\u5408\u6a21\u5f0f"})}),"\n"]}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u4e0b\u4e00\u6b65"}),"\uff1a\u5b66\u4e60 ",(0,l.jsx)(e.a,{href:"/docs/react/accessibility",children:"\u53ef\u8bbf\u95ee\u6027"})," \u786e\u4fdd Portal \u7ec4\u4ef6\u5bf9\u6240\u6709\u7528\u6237\u53cb\u597d\u3002"]})]})}function u(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(c,{...n})}):c(n)}}}]);
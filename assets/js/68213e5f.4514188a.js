"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[99759],{48885:(n,e,t)=>{t.d(e,{R:()=>l,x:()=>r});var a=t(99378);const s={},i=a.createContext(s);function l(n){const e=a.useContext(i);return a.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:l(n.components),a.createElement(i.Provider,{value:e},n.children)}},62690:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>r,default:()=>o,frontMatter:()=>l,metadata:()=>a,toc:()=>u});const a=JSON.parse('{"id":"rust/async-programming","title":"\u5f02\u6b65\u7f16\u7a0b","description":"Rust \u7684\u5f02\u6b65\u7f16\u7a0b\u63d0\u4f9b\u4e86\u9ad8\u6027\u80fd\u7684\u5e76\u53d1\u80fd\u529b\uff0c\u65e0\u9700\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u7684\u5f00\u9500\u3002","source":"@site/docs/rust/async-programming.md","sourceDirName":"rust","slug":"/rust/async-programming","permalink":"/docs/rust/async-programming","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/rust/async-programming.md","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12,"title":"\u5f02\u6b65\u7f16\u7a0b"},"sidebar":"rust","previous":{"title":"\u5e76\u53d1\u7f16\u7a0b","permalink":"/docs/rust/concurrency"},"next":{"title":"\u5b8f\u7f16\u7a0b","permalink":"/docs/rust/macros"}}');var s=t(22714),i=t(48885);const l={sidebar_position:12,title:"\u5f02\u6b65\u7f16\u7a0b"},r="\u5f02\u6b65\u7f16\u7a0b",c={},u=[{value:"async/await \u57fa\u7840",id:"asyncawait-\u57fa\u7840",level:2},{value:"\u5f02\u6b65\u51fd\u6570",id:"\u5f02\u6b65\u51fd\u6570",level:3},{value:".await \u5173\u952e\u5b57",id:"await-\u5173\u952e\u5b57",level:3},{value:"\u5f02\u6b65\u5757",id:"\u5f02\u6b65\u5757",level:3},{value:"Future Trait",id:"future-trait",level:2},{value:"Poll \u72b6\u6001",id:"poll-\u72b6\u6001",level:3},{value:"Pin \u548c Unpin \u6df1\u5ea6\u89e3\u6790",id:"pin-\u548c-unpin-\u6df1\u5ea6\u89e3\u6790",level:2},{value:"\u4e3a\u4ec0\u4e48\u9700\u8981 Pin\uff1f",id:"\u4e3a\u4ec0\u4e48\u9700\u8981-pin",level:3},{value:"Pin \u7684\u4f5c\u7528",id:"pin-\u7684\u4f5c\u7528",level:3},{value:"Unpin Trait",id:"unpin-trait",level:3},{value:"Pin \u7684\u521b\u5efa\u548c\u4f7f\u7528",id:"pin-\u7684\u521b\u5efa\u548c\u4f7f\u7528",level:3},{value:"Future \u4e3a\u4ec0\u4e48\u9700\u8981 Pin",id:"future-\u4e3a\u4ec0\u4e48\u9700\u8981-pin",level:3},{value:"async/await \u7f16\u8bd1\u5668\u5c55\u5f00",id:"asyncawait-\u7f16\u8bd1\u5668\u5c55\u5f00",level:3},{value:"Pin \u6700\u4f73\u5b9e\u8df5",id:"pin-\u6700\u4f73\u5b9e\u8df5",level:3},{value:"Tokio \u8fd0\u884c\u65f6",id:"tokio-\u8fd0\u884c\u65f6",level:2},{value:"\u5b89\u88c5\u4f9d\u8d56",id:"\u5b89\u88c5\u4f9d\u8d56",level:3},{value:"\u57fa\u672c\u4f7f\u7528",id:"\u57fa\u672c\u4f7f\u7528",level:3},{value:"\u624b\u52a8\u521b\u5efa\u8fd0\u884c\u65f6",id:"\u624b\u52a8\u521b\u5efa\u8fd0\u884c\u65f6",level:3},{value:"\u5f02\u6b65\u4efb\u52a1",id:"\u5f02\u6b65\u4efb\u52a1",level:2},{value:"\u521b\u5efa\u4efb\u52a1",id:"\u521b\u5efa\u4efb\u52a1",level:3},{value:"\u591a\u4efb\u52a1\u5e76\u53d1",id:"\u591a\u4efb\u52a1\u5e76\u53d1",level:3},{value:"join! \u5b8f",id:"join-\u5b8f",level:3},{value:"select! \u5b8f",id:"select-\u5b8f",level:3},{value:"\u8d85\u65f6\u548c\u53d6\u6d88",id:"\u8d85\u65f6\u548c\u53d6\u6d88",level:2},{value:"\u8d85\u65f6\u63a7\u5236",id:"\u8d85\u65f6\u63a7\u5236",level:3},{value:"\u4efb\u52a1\u53d6\u6d88",id:"\u4efb\u52a1\u53d6\u6d88",level:3},{value:"\u5f02\u6b65 I/O",id:"\u5f02\u6b65-io",level:2},{value:"\u5f02\u6b65\u6587\u4ef6\u8bfb\u53d6",id:"\u5f02\u6b65\u6587\u4ef6\u8bfb\u53d6",level:3},{value:"\u5f02\u6b65\u6587\u4ef6\u5199\u5165",id:"\u5f02\u6b65\u6587\u4ef6\u5199\u5165",level:3},{value:"\u5f02\u6b65\u7f51\u7edc\u7f16\u7a0b",id:"\u5f02\u6b65\u7f51\u7edc\u7f16\u7a0b",level:3},{value:"\u5f02\u6b65\u901a\u9053",id:"\u5f02\u6b65\u901a\u9053",level:2},{value:"mpsc \u901a\u9053",id:"mpsc-\u901a\u9053",level:3},{value:"oneshot \u901a\u9053",id:"oneshot-\u901a\u9053",level:3},{value:"\u5f02\u6b65\u6d41 (Stream)",id:"\u5f02\u6b65\u6d41-stream",level:2},{value:"\u6d41\u9002\u914d\u5668",id:"\u6d41\u9002\u914d\u5668",level:3},{value:"async-std",id:"async-std",level:2},{value:"\u5b89\u88c5\u4f9d\u8d56",id:"\u5b89\u88c5\u4f9d\u8d56-1",level:3},{value:"\u57fa\u672c\u4f7f\u7528",id:"\u57fa\u672c\u4f7f\u7528-1",level:3},{value:"\u5f02\u6b65\u4efb\u52a1",id:"\u5f02\u6b65\u4efb\u52a1-1",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u907f\u514d\u963b\u585e\u64cd\u4f5c",id:"1-\u907f\u514d\u963b\u585e\u64cd\u4f5c",level:3},{value:"2. \u4f7f\u7528 spawn_blocking \u5904\u7406 CPU \u5bc6\u96c6\u4efb\u52a1",id:"2-\u4f7f\u7528-spawn_blocking-\u5904\u7406-cpu-\u5bc6\u96c6\u4efb\u52a1",level:3},{value:"3. \u4f7f\u7528 Arc \u5171\u4eab\u6570\u636e",id:"3-\u4f7f\u7528-arc-\u5171\u4eab\u6570\u636e",level:3},{value:"4. \u5408\u7406\u4f7f\u7528\u8d85\u65f6",id:"4-\u5408\u7406\u4f7f\u7528\u8d85\u65f6",level:3},{value:"5. \u9519\u8bef\u5904\u7406",id:"5-\u9519\u8bef\u5904\u7406",level:3},{value:"\u5e38\u89c1\u9677\u9631",id:"\u5e38\u89c1\u9677\u9631",level:2},{value:"1. \u5fd8\u8bb0 .await",id:"1-\u5fd8\u8bb0-await",level:3},{value:"2. \u6b7b\u9501",id:"2-\u6b7b\u9501",level:3},{value:"3. \u8fc7\u5ea6\u4f7f\u7528 spawn",id:"3-\u8fc7\u5ea6\u4f7f\u7528-spawn",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:2},{value:"1. \u9009\u62e9\u5408\u9002\u7684 buffer \u5927\u5c0f",id:"1-\u9009\u62e9\u5408\u9002\u7684-buffer-\u5927\u5c0f",level:3},{value:"2. \u4f7f\u7528 futures::stream::FuturesUnordered",id:"2-\u4f7f\u7528-futuresstreamfuturesunordered",level:3},{value:"3. \u907f\u514d\u4e0d\u5fc5\u8981\u7684\u514b\u9686",id:"3-\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u514b\u9686",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"\u5f02\u6b65\u7f16\u7a0b",children:"\u5f02\u6b65\u7f16\u7a0b"})}),"\n",(0,s.jsx)(e.p,{children:"Rust \u7684\u5f02\u6b65\u7f16\u7a0b\u63d0\u4f9b\u4e86\u9ad8\u6027\u80fd\u7684\u5e76\u53d1\u80fd\u529b\uff0c\u65e0\u9700\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u7684\u5f00\u9500\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"asyncawait-\u57fa\u7840",children:"async/await \u57fa\u7840"}),"\n",(0,s.jsx)(e.h3,{id:"\u5f02\u6b65\u51fd\u6570",children:"\u5f02\u6b65\u51fd\u6570"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'// \u5f02\u6b65\u51fd\u6570\u8fd4\u56de Future\nasync fn hello_async() {\n    println!("Hello from async!");\n}\n\nasync fn get_data() -> String {\n    "data".to_string()\n}\n\n// \u4f7f\u7528 async \u5757\nfn main() {\n    let future = async {\n        let data = get_data().await;\n        println!("{}", data);\n    };\n\n    // future \u9700\u8981\u88ab\u6267\u884c\u5668\u8fd0\u884c\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"await-\u5173\u952e\u5b57",children:".await \u5173\u952e\u5b57"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'async fn learn_song() -> String {\n    "song".to_string()\n}\n\nasync fn sing_song(song: String) {\n    println!("Singing: {}", song);\n}\n\nasync fn learn_and_sing() {\n    // .await \u7b49\u5f85 Future \u5b8c\u6210\n    let song = learn_song().await;\n    sing_song(song).await;\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u5f02\u6b65\u5757",children:"\u5f02\u6b65\u5757"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'async fn example() {\n    let future = async {\n        println!("\u5f02\u6b65\u5757");\n        42\n    };\n\n    let result = future.await;\n    println!("{}", result);\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"future-trait",children:"Future Trait"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:"use std::pin::Pin;\nuse std::task::{Context, Poll};\nuse std::future::Future;\n\nstruct MyFuture {\n    count: u32,\n}\n\nimpl Future for MyFuture {\n    type Output = u32;\n\n    fn poll(mut self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output> {\n        if self.count < 5 {\n            self.count += 1;\n            cx.waker().wake_by_ref();  // \u8bf7\u6c42\u518d\u6b21\u8f6e\u8be2\n            Poll::Pending\n        } else {\n            Poll::Ready(self.count)\n        }\n    }\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"poll-\u72b6\u6001",children:"Poll \u72b6\u6001"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:"enum Poll<T> {\n    Ready(T),    // Future \u5df2\u5b8c\u6210\n    Pending,     // Future \u672a\u5b8c\u6210\uff0c\u9700\u8981\u518d\u6b21\u8f6e\u8be2\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"pin-\u548c-unpin-\u6df1\u5ea6\u89e3\u6790",children:"Pin \u548c Unpin \u6df1\u5ea6\u89e3\u6790"}),"\n",(0,s.jsx)(e.h3,{id:"\u4e3a\u4ec0\u4e48\u9700\u8981-pin",children:"\u4e3a\u4ec0\u4e48\u9700\u8981 Pin\uff1f"}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u5f02\u6b65\u7f16\u7a0b\u4e2d\uff0c\u7f16\u8bd1\u5668\u4f1a\u5c06 ",(0,s.jsx)(e.code,{children:"async"})," \u5757\u8f6c\u6362\u4e3a\u72b6\u6001\u673a\u3002\u8fd9\u4e2a\u72b6\u6001\u673a\u53ef\u80fd\u5305\u542b",(0,s.jsx)(e.strong,{children:"\u81ea\u5f15\u7528\u7ed3\u6784\u4f53"}),"\uff08\u4e00\u4e2a\u5b57\u6bb5\u5f15\u7528\u53e6\u4e00\u4e2a\u5b57\u6bb5\uff09\uff0c\u5982\u679c\u8fd9\u4e2a\u7ed3\u6784\u4f53\u88ab\u79fb\u52a8\uff0c\u5f15\u7528\u5c31\u4f1a\u5931\u6548\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:"// async \u5757\u88ab\u7f16\u8bd1\u6210\u7c7b\u4f3c\u8fd9\u6837\u7684\u72b6\u6001\u673a\nstruct AsyncStateMachine {\n    data: String,\n    // \u8fd9\u662f\u4e2a\u81ea\u5f15\u7528\uff1a\u6307\u5411 data \u5b57\u6bb5\n    reference: *const String,  // \u5982\u679c\u7ed3\u6784\u4f53\u79fb\u52a8\uff0c\u8fd9\u4e2a\u6307\u9488\u5931\u6548\uff01\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"pin-\u7684\u4f5c\u7528",children:"Pin \u7684\u4f5c\u7528"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"Pin<P>"})," \u4fdd\u8bc1\u88ab\u5305\u88f9\u7684\u503c",(0,s.jsx)(e.strong,{children:"\u4e0d\u4f1a\u88ab\u79fb\u52a8"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:"use std::pin::Pin;\nuse std::marker::PhantomPinned;\n\nstruct SelfReferential {\n    data: String,\n    self_ptr: *const String,\n    _marker: PhantomPinned,  // \u6807\u8bb0\u4e3a !Unpin\n}\n\nimpl SelfReferential {\n    fn new(data: String) -> Self {\n        SelfReferential {\n            data,\n            self_ptr: std::ptr::null(),\n            _marker: PhantomPinned,\n        }\n    }\n\n    fn init(self: Pin<&mut Self>) {\n        let self_ptr = &self.data as *const String;\n        // \u5b89\u5168\uff1a\u6211\u4eec\u4e0d\u4f1a\u79fb\u52a8 self\n        unsafe {\n            self.get_unchecked_mut().self_ptr = self_ptr;\n        }\n    }\n\n    fn get_data(self: Pin<&Self>) -> &str {\n        &self.data\n    }\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"unpin-trait",children:"Unpin Trait"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Unpin"}),"\uff1a\u7c7b\u578b\u53ef\u4ee5\u5b89\u5168\u5730\u4ece ",(0,s.jsx)(e.code,{children:"Pin"})," \u4e2d\u79fb\u51fa\uff08\u5927\u591a\u6570\u7c7b\u578b\u9ed8\u8ba4\u5b9e\u73b0\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"!Unpin"}),"\uff1a\u7c7b\u578b\u4e0d\u80fd\u4ece ",(0,s.jsx)(e.code,{children:"Pin"})," \u4e2d\u79fb\u51fa\uff08\u81ea\u5f15\u7528\u7c7b\u578b\uff09"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:"use std::marker::Unpin;\n\n// \u5927\u591a\u6570\u7c7b\u578b\u81ea\u52a8\u5b9e\u73b0 Unpin\nfn is_unpin<T: Unpin>() {}\n\nfn main() {\n    is_unpin::<i32>();      // \u2705 \u57fa\u672c\u7c7b\u578b\n    is_unpin::<String>();   // \u2705 String\n    is_unpin::<Vec<i32>>(); // \u2705 Vec\n\n    // async \u5757\u751f\u6210\u7684 Future \u901a\u5e38\u662f !Unpin\n    // is_unpin::<impl Future<Output = ()>>();  // \u274c \u901a\u5e38\u4e0d\u884c\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"pin-\u7684\u521b\u5efa\u548c\u4f7f\u7528",children:"Pin \u7684\u521b\u5efa\u548c\u4f7f\u7528"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use std::pin::Pin;\n\nfn main() {\n    // \u65b9\u6cd5 1\uff1aBox::pin\uff08\u5806\u4e0a\u56fa\u5b9a\uff09\n    let mut boxed = Box::pin(async {\n        println!("\u6211\u88ab pin \u4f4f\u4e86\uff01");\n    });\n\n    // \u65b9\u6cd5 2\uff1apin! \u5b8f\uff08\u6808\u4e0a\u56fa\u5b9a\uff0c\u9700\u8981 tokio\uff09\n    // tokio::pin!(future);\n\n    // \u65b9\u6cd5 3\uff1a\u624b\u52a8 pin\uff08\u9700\u8981 unsafe\uff09\n    let mut data = String::from("hello");\n    let pinned = unsafe { Pin::new_unchecked(&mut data) };\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"future-\u4e3a\u4ec0\u4e48\u9700\u8981-pin",children:"Future \u4e3a\u4ec0\u4e48\u9700\u8981 Pin"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:"use std::future::Future;\nuse std::pin::Pin;\nuse std::task::{Context, Poll};\n\n// Future trait \u7684 poll \u65b9\u6cd5\u63a5\u6536 Pin<&mut Self>\n// \u8fd9\u786e\u4fdd Future \u5728\u591a\u6b21 poll \u4e4b\u95f4\u4e0d\u4f1a\u88ab\u79fb\u52a8\ntrait MyFuture {\n    type Output;\n    fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output>;\n}\n\n// \u5982\u679c Future \u5b9e\u73b0\u4e86 Unpin\uff0c\u53ef\u4ee5\u5b89\u5168\u79fb\u52a8\nasync fn example() {\n    let future = async { 42 };\n\n    // \u4f7f\u7528 Box::pin \u5c06 Future \u56fa\u5b9a\u5728\u5806\u4e0a\n    let mut pinned = Box::pin(future);\n\n    // \u73b0\u5728\u53ef\u4ee5\u5b89\u5168\u5730 poll\n    use std::task::{Context, RawWaker, RawWakerVTable, Waker};\n\n    fn dummy_waker() -> Waker {\n        fn no_op(_: *const ()) {}\n        fn clone(_: *const ()) -> RawWaker {\n            RawWaker::new(std::ptr::null(), &VTABLE)\n        }\n        static VTABLE: RawWakerVTable = RawWakerVTable::new(clone, no_op, no_op, no_op);\n        unsafe { Waker::from_raw(RawWaker::new(std::ptr::null(), &VTABLE)) }\n    }\n\n    let waker = dummy_waker();\n    let mut cx = Context::from_waker(&waker);\n\n    // poll \u8fd4\u56de Poll::Ready(42)\n    let _ = pinned.as_mut().poll(&mut cx);\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"asyncawait-\u7f16\u8bd1\u5668\u5c55\u5f00",children:"async/await \u7f16\u8bd1\u5668\u5c55\u5f00"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"async fn"})," \u4f1a\u88ab\u7f16\u8bd1\u5668\u8f6c\u6362\u4e3a\u72b6\u6001\u673a\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'// \u539f\u59cb\u4ee3\u7801\nasync fn fetch_data() -> String {\n    let url = "https://example.com".to_string();\n    let response = http_get(&url).await;  // \u7b2c\u4e00\u4e2a await \u70b9\n    let parsed = parse(response).await;    // \u7b2c\u4e8c\u4e2a await \u70b9\n    parsed\n}\n\n// \u7f16\u8bd1\u5668\u5927\u81f4\u5c55\u5f00\u4e3a\uff1a\nenum FetchDataState {\n    Start,\n    WaitingHttpGet { url: String, future: HttpGetFuture },\n    WaitingParse { future: ParseFuture },\n    Done,\n}\n\nstruct FetchDataFuture {\n    state: FetchDataState,\n}\n\nimpl Future for FetchDataFuture {\n    type Output = String;\n\n    fn poll(self: Pin<&mut Self>, cx: &mut Context<\'_>) -> Poll<Self::Output> {\n        // \u6839\u636e\u5f53\u524d\u72b6\u6001\u6267\u884c\u76f8\u5e94\u903b\u8f91\n        // \u6bcf\u4e2a await \u70b9\u5bf9\u5e94\u4e00\u4e2a\u72b6\u6001\u8f6c\u6362\n        loop {\n            match &mut self.state {\n                FetchDataState::Start => {\n                    let url = "https://example.com".to_string();\n                    let future = http_get(&url);\n                    self.state = FetchDataState::WaitingHttpGet { url, future };\n                }\n                FetchDataState::WaitingHttpGet { future, .. } => {\n                    match Pin::new(future).poll(cx) {\n                        Poll::Ready(response) => {\n                            let future = parse(response);\n                            self.state = FetchDataState::WaitingParse { future };\n                        }\n                        Poll::Pending => return Poll::Pending,\n                    }\n                }\n                FetchDataState::WaitingParse { future } => {\n                    match Pin::new(future).poll(cx) {\n                        Poll::Ready(parsed) => {\n                            self.state = FetchDataState::Done;\n                            return Poll::Ready(parsed);\n                        }\n                        Poll::Pending => return Poll::Pending,\n                    }\n                }\n                FetchDataState::Done => panic!("polled after completion"),\n            }\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"pin-\u6700\u4f73\u5b9e\u8df5",children:"Pin \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u573a\u666f"}),(0,s.jsx)(e.th,{children:"\u63a8\u8350\u505a\u6cd5"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u521b\u5efa Future"}),(0,s.jsxs)(e.td,{children:["\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"Box::pin()"})," \u6216 ",(0,s.jsx)(e.code,{children:"tokio::pin!()"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u5b9e\u73b0 Future"}),(0,s.jsxs)(e.td,{children:["\u5982\u679c\u4e0d\u542b\u81ea\u5f15\u7528\uff0c\u6dfb\u52a0 ",(0,s.jsx)(e.code,{children:"impl Unpin for MyFuture {}"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u5b58\u50a8 Future"}),(0,s.jsxs)(e.td,{children:["\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"Pin<Box<dyn Future<Output = T>>>"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u4f20\u9012 Future"}),(0,s.jsxs)(e.td,{children:["\u63a5\u53d7 ",(0,s.jsx)(e.code,{children:"impl Future"})," \u8ba9\u7f16\u8bd1\u5668\u5904\u7406"]})]})]})]}),"\n",(0,s.jsx)(e.h2,{id:"tokio-\u8fd0\u884c\u65f6",children:"Tokio \u8fd0\u884c\u65f6"}),"\n",(0,s.jsx)(e.p,{children:"Tokio \u662f Rust \u6700\u6d41\u884c\u7684\u5f02\u6b65\u8fd0\u884c\u65f6\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u5b89\u88c5\u4f9d\u8d56",children:"\u5b89\u88c5\u4f9d\u8d56"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-toml",children:'[dependencies]\ntokio = { version = "1", features = ["full"] }\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u672c\u4f7f\u7528",children:"\u57fa\u672c\u4f7f\u7528"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'#[tokio::main]\nasync fn main() {\n    println!("Hello");\n    say_world().await;\n}\n\nasync fn say_world() {\n    println!("World");\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u624b\u52a8\u521b\u5efa\u8fd0\u884c\u65f6",children:"\u624b\u52a8\u521b\u5efa\u8fd0\u884c\u65f6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::runtime::Runtime;\n\nfn main() {\n    let rt = Runtime::new().unwrap();\n\n    rt.block_on(async {\n        println!("\u5f02\u6b65\u4efb\u52a1");\n    });\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u5f02\u6b65\u4efb\u52a1",children:"\u5f02\u6b65\u4efb\u52a1"}),"\n",(0,s.jsx)(e.h3,{id:"\u521b\u5efa\u4efb\u52a1",children:"\u521b\u5efa\u4efb\u52a1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::task;\n\n#[tokio::main]\nasync fn main() {\n    let handle = task::spawn(async {\n        println!("\u5f02\u6b65\u4efb\u52a1");\n        42\n    });\n\n    let result = handle.await.unwrap();\n    println!("\u7ed3\u679c: {}", result);\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u591a\u4efb\u52a1\u5e76\u53d1",children:"\u591a\u4efb\u52a1\u5e76\u53d1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::time::{sleep, Duration};\n\n#[tokio::main]\nasync fn main() {\n    let task1 = task::spawn(async {\n        sleep(Duration::from_secs(1)).await;\n        println!("\u4efb\u52a1 1 \u5b8c\u6210");\n    });\n\n    let task2 = task::spawn(async {\n        sleep(Duration::from_secs(2)).await;\n        println!("\u4efb\u52a1 2 \u5b8c\u6210");\n    });\n\n    task1.await.unwrap();\n    task2.await.unwrap();\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"join-\u5b8f",children:"join! \u5b8f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::join;\n\nasync fn task1() -> u32 {\n    // ...\n    1\n}\n\nasync fn task2() -> u32 {\n    // ...\n    2\n}\n\n#[tokio::main]\nasync fn main() {\n    // \u5e76\u53d1\u6267\u884c\uff0c\u7b49\u5f85\u6240\u6709\u5b8c\u6210\n    let (result1, result2) = join!(task1(), task2());\n    println!("{}, {}", result1, result2);\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"select-\u5b8f",children:"select! \u5b8f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::select;\nuse tokio::time::{sleep, Duration};\n\n#[tokio::main]\nasync fn main() {\n    let result = select! {\n        _ = sleep(Duration::from_secs(1)) => {\n            "\u7b2c\u4e00\u4e2a\u5b8c\u6210"\n        }\n        _ = sleep(Duration::from_secs(2)) => {\n            "\u7b2c\u4e8c\u4e2a\u5b8c\u6210"\n        }\n    };\n\n    println!("{}", result);  // "\u7b2c\u4e00\u4e2a\u5b8c\u6210"\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u8d85\u65f6\u548c\u53d6\u6d88",children:"\u8d85\u65f6\u548c\u53d6\u6d88"}),"\n",(0,s.jsx)(e.h3,{id:"\u8d85\u65f6\u63a7\u5236",children:"\u8d85\u65f6\u63a7\u5236"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::time::{timeout, Duration};\n\n#[tokio::main]\nasync fn main() {\n    let result = timeout(\n        Duration::from_secs(1),\n        async {\n            sleep(Duration::from_secs(2)).await;\n            "\u5b8c\u6210"\n        }\n    ).await;\n\n    match result {\n        Ok(v) => println!("\u53ca\u65f6\u5b8c\u6210: {}", v),\n        Err(_) => println!("\u8d85\u65f6!"),\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u4efb\u52a1\u53d6\u6d88",children:"\u4efb\u52a1\u53d6\u6d88"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::time::{sleep, Duration};\n\n#[tokio::main]\nasync fn main() {\n    let handle = task::spawn(async {\n        loop {\n            println!("\u5de5\u4f5c\u4e2d...");\n            sleep(Duration::from_millis(100)).await;\n        }\n    });\n\n    sleep(Duration::from_secs(1)).await;\n\n    // \u53d6\u6d88\u4efb\u52a1\n    handle.abort();\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u5f02\u6b65-io",children:"\u5f02\u6b65 I/O"}),"\n",(0,s.jsx)(e.h3,{id:"\u5f02\u6b65\u6587\u4ef6\u8bfb\u53d6",children:"\u5f02\u6b65\u6587\u4ef6\u8bfb\u53d6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::fs::File;\nuse tokio::io::AsyncReadExt;\n\n#[tokio::main]\nasync fn main() -> std::io::Result<()> {\n    let mut file = File::open("test.txt").await?;\n    let mut contents = String::new();\n    file.read_to_string(&mut contents).await?;\n    println!("{}", contents);\n    Ok(())\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u5f02\u6b65\u6587\u4ef6\u5199\u5165",children:"\u5f02\u6b65\u6587\u4ef6\u5199\u5165"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::fs::File;\nuse tokio::io::AsyncWriteExt;\n\n#[tokio::main]\nasync fn main() -> std::io::Result<()> {\n    let mut file = File::create("output.txt").await?;\n    file.write_all(b"Hello, async world!").await?;\n    Ok(())\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u5f02\u6b65\u7f51\u7edc\u7f16\u7a0b",children:"\u5f02\u6b65\u7f51\u7edc\u7f16\u7a0b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::net::TcpListener;\nuse tokio::io::{AsyncReadExt, AsyncWriteExt};\n\n#[tokio::main]\nasync fn main() -> std::io::Result<()> {\n    let listener = TcpListener::bind("127.0.0.1:8080").await?;\n\n    loop {\n        let (mut socket, _) = listener.accept().await?;\n\n        tokio::spawn(async move {\n            let mut buf = [0; 1024];\n\n            match socket.read(&mut buf).await {\n                Ok(n) if n == 0 => return,\n                Ok(n) => {\n                    if socket.write_all(&buf[0..n]).await.is_err() {\n                        return;\n                    }\n                }\n                Err(_) => return,\n            }\n        });\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u5f02\u6b65\u901a\u9053",children:"\u5f02\u6b65\u901a\u9053"}),"\n",(0,s.jsx)(e.h3,{id:"mpsc-\u901a\u9053",children:"mpsc \u901a\u9053"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::sync::mpsc;\n\n#[tokio::main]\nasync fn main() {\n    let (tx, mut rx) = mpsc::channel(32);\n\n    tokio::spawn(async move {\n        for i in 0..10 {\n            if tx.send(i).await.is_err() {\n                return;\n            }\n        }\n    });\n\n    while let Some(i) = rx.recv().await {\n        println!("\u6536\u5230: {}", i);\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"oneshot-\u901a\u9053",children:"oneshot \u901a\u9053"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::sync::oneshot;\n\n#[tokio::main]\nasync fn main() {\n    let (tx, rx) = oneshot::channel();\n\n    tokio::spawn(async move {\n        let _ = tx.send("Hello");\n    });\n\n    match rx.await {\n        Ok(v) => println!("\u6536\u5230: {}", v),\n        Err(_) => println!("\u53d1\u9001\u8005\u5df2\u4e22\u5f03"),\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u5f02\u6b65\u6d41-stream",children:"\u5f02\u6b65\u6d41 (Stream)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio_stream::{self as stream, StreamExt};\n\n#[tokio::main]\nasync fn main() {\n    let mut stream = stream::iter(vec![1, 2, 3]);\n\n    while let Some(v) = stream.next().await {\n        println!("{}", v);\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u6d41\u9002\u914d\u5668",children:"\u6d41\u9002\u914d\u5668"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio_stream::{self as stream, StreamExt};\n\n#[tokio::main]\nasync fn main() {\n    let mut stream = stream::iter(vec![1, 2, 3, 4, 5])\n        .filter(|x| x % 2 == 0)\n        .map(|x| x * 2);\n\n    while let Some(v) = stream.next().await {\n        println!("{}", v);\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"async-std",children:"async-std"}),"\n",(0,s.jsx)(e.p,{children:"async-std \u662f\u53e6\u4e00\u4e2a\u6d41\u884c\u7684\u5f02\u6b65\u8fd0\u884c\u65f6\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u5b89\u88c5\u4f9d\u8d56-1",children:"\u5b89\u88c5\u4f9d\u8d56"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-toml",children:'[dependencies]\nasync-std = "1"\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u672c\u4f7f\u7528-1",children:"\u57fa\u672c\u4f7f\u7528"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use async_std::task;\n\nfn main() {\n    task::block_on(async {\n        println!("Hello from async-std");\n    });\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u5f02\u6b65\u4efb\u52a1-1",children:"\u5f02\u6b65\u4efb\u52a1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use async_std::task;\nuse std::time::Duration;\n\nfn main() {\n    task::block_on(async {\n        let handle = task::spawn(async {\n            task::sleep(Duration::from_secs(1)).await;\n            42\n        });\n\n        let result = handle.await;\n        println!("{}", result);\n    });\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsx)(e.h3,{id:"1-\u907f\u514d\u963b\u585e\u64cd\u4f5c",children:"1. \u907f\u514d\u963b\u585e\u64cd\u4f5c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:"// \u4e0d\u597d\uff1a\u963b\u585e\u7ebf\u7a0b\n#[tokio::main]\nasync fn main() {\n    std::thread::sleep(std::time::Duration::from_secs(1));  // \u963b\u585e\uff01\n}\n\n// \u597d\uff1a\u4f7f\u7528\u5f02\u6b65\u7761\u7720\n#[tokio::main]\nasync fn main() {\n    tokio::time::sleep(tokio::time::Duration::from_secs(1)).await;\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"2-\u4f7f\u7528-spawn_blocking-\u5904\u7406-cpu-\u5bc6\u96c6\u4efb\u52a1",children:"2. \u4f7f\u7528 spawn_blocking \u5904\u7406 CPU \u5bc6\u96c6\u4efb\u52a1"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::task;\n\n#[tokio::main]\nasync fn main() {\n    let result = task::spawn_blocking(|| {\n        // CPU \u5bc6\u96c6\u8ba1\u7b97\n        let mut sum = 0;\n        for i in 0..1000000 {\n            sum += i;\n        }\n        sum\n    }).await.unwrap();\n\n    println!("{}", result);\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"3-\u4f7f\u7528-arc-\u5171\u4eab\u6570\u636e",children:"3. \u4f7f\u7528 Arc \u5171\u4eab\u6570\u636e"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use std::sync::Arc;\nuse tokio::task;\n\n#[tokio::main]\nasync fn main() {\n    let data = Arc::new(vec![1, 2, 3]);\n\n    let data_clone = Arc::clone(&data);\n    let handle = task::spawn(async move {\n        println!("{:?}", data_clone);\n    });\n\n    handle.await.unwrap();\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"4-\u5408\u7406\u4f7f\u7528\u8d85\u65f6",children:"4. \u5408\u7406\u4f7f\u7528\u8d85\u65f6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::time::{timeout, Duration};\n\nasync fn fetch_data() -> Result<String, &\'static str> {\n    // \u6a21\u62df\u7f51\u7edc\u8bf7\u6c42\n    tokio::time::sleep(Duration::from_secs(2)).await;\n    Ok("data".to_string())\n}\n\n#[tokio::main]\nasync fn main() {\n    match timeout(Duration::from_secs(1), fetch_data()).await {\n        Ok(Ok(data)) => println!("\u6210\u529f: {}", data),\n        Ok(Err(e)) => println!("\u9519\u8bef: {}", e),\n        Err(_) => println!("\u8d85\u65f6"),\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"5-\u9519\u8bef\u5904\u7406",children:"5. \u9519\u8bef\u5904\u7406"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use tokio::fs::File;\nuse tokio::io::AsyncReadExt;\n\nasync fn read_file(path: &str) -> Result<String, std::io::Error> {\n    let mut file = File::open(path).await?;\n    let mut contents = String::new();\n    file.read_to_string(&mut contents).await?;\n    Ok(contents)\n}\n\n#[tokio::main]\nasync fn main() {\n    match read_file("test.txt").await {\n        Ok(contents) => println!("{}", contents),\n        Err(e) => eprintln!("\u9519\u8bef: {}", e),\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"\u5e38\u89c1\u9677\u9631",children:"\u5e38\u89c1\u9677\u9631"}),"\n",(0,s.jsx)(e.h3,{id:"1-\u5fd8\u8bb0-await",children:"1. \u5fd8\u8bb0 .await"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'async fn get_data() -> String {\n    "data".to_string()\n}\n\n// \u9519\u8bef\uff1afuture \u672a\u88ab\u6267\u884c\nlet data = get_data();  // \u8fd9\u53ea\u662f\u521b\u5efa\u4e86 Future\n\n// \u6b63\u786e\nlet data = get_data().await;\n'})}),"\n",(0,s.jsx)(e.h3,{id:"2-\u6b7b\u9501",children:"2. \u6b7b\u9501"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:"use tokio::sync::Mutex;\n\n// \u53ef\u80fd\u6b7b\u9501\nasync fn bad_example() {\n    let mutex = Mutex::new(0);\n\n    let guard = mutex.lock().await;\n    // \u957f\u65f6\u95f4\u6301\u6709\u9501\n    some_async_operation().await;  // \u53ef\u80fd\u5bfc\u81f4\u6b7b\u9501\n    drop(guard);\n}\n\n// \u597d\u7684\u505a\u6cd5\nasync fn good_example() {\n    let mutex = Mutex::new(0);\n\n    {\n        let mut guard = mutex.lock().await;\n        *guard += 1;\n    }  // \u5c3d\u5feb\u91ca\u653e\u9501\n\n    some_async_operation().await;\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"3-\u8fc7\u5ea6\u4f7f\u7528-spawn",children:"3. \u8fc7\u5ea6\u4f7f\u7528 spawn"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:"// \u4e0d\u597d\uff1a\u521b\u5efa\u592a\u591a\u4efb\u52a1\nfor i in 0..10000 {\n    tokio::spawn(async move {\n        // \u7b80\u5355\u64cd\u4f5c\n    });\n}\n\n// \u597d\uff1a\u4f7f\u7528 join_all \u6216\u6d41\nuse futures::future::join_all;\n\nlet futures: Vec<_> = (0..10000)\n    .map(|i| async move {\n        // \u64cd\u4f5c\n    })\n    .collect();\n\njoin_all(futures).await;\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,s.jsx)(e.h3,{id:"1-\u9009\u62e9\u5408\u9002\u7684-buffer-\u5927\u5c0f",children:"1. \u9009\u62e9\u5408\u9002\u7684 buffer \u5927\u5c0f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:"use tokio::sync::mpsc;\n\n// \u592a\u5c0f\uff1a\u9891\u7e41\u963b\u585e\nlet (tx, rx) = mpsc::channel(1);\n\n// \u592a\u5927\uff1a\u5185\u5b58\u6d6a\u8d39\nlet (tx, rx) = mpsc::channel(10000);\n\n// \u5408\u9002\uff1a\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8c03\u6574\nlet (tx, rx) = mpsc::channel(100);\n"})}),"\n",(0,s.jsx)(e.h3,{id:"2-\u4f7f\u7528-futuresstreamfuturesunordered",children:"2. \u4f7f\u7528 futures::stream::FuturesUnordered"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use futures::stream::{FuturesUnordered, StreamExt};\n\n#[tokio::main]\nasync fn main() {\n    let mut futures = FuturesUnordered::new();\n\n    for i in 0..10 {\n        futures.push(async move {\n            tokio::time::sleep(tokio::time::Duration::from_millis(100)).await;\n            i\n        });\n    }\n\n    while let Some(result) = futures.next().await {\n        println!("{}", result);\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"3-\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u514b\u9686",children:"3. \u907f\u514d\u4e0d\u5fc5\u8981\u7684\u514b\u9686"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:"use std::sync::Arc;\n\n// \u4e0d\u597d\nasync fn bad(data: Vec<u8>) {\n    tokio::spawn(async move {\n        // data \u88ab\u79fb\u52a8\uff0c\u9700\u8981\u514b\u9686\n    });\n}\n\n// \u597d\nasync fn good(data: Arc<Vec<u8>>) {\n    let data_clone = Arc::clone(&data);\n    tokio::spawn(async move {\n        // \u53ea\u514b\u9686\u4e86 Arc\uff0c\u4e0d\u662f\u6570\u636e\n    });\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u2705 async/await \u63d0\u4f9b\u7b80\u6d01\u7684\u5f02\u6b65\u7f16\u7a0b\u8bed\u6cd5"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Future \u662f\u5f02\u6b65\u8ba1\u7b97\u7684\u62bd\u8c61"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Tokio \u662f\u6210\u719f\u7684\u5f02\u6b65\u8fd0\u884c\u65f6"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u907f\u514d\u5728\u5f02\u6b65\u4ee3\u7801\u4e2d\u4f7f\u7528\u963b\u585e\u64cd\u4f5c"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u4f7f\u7528\u8d85\u65f6\u673a\u5236\u9632\u6b62\u4efb\u52a1 hang \u4f4f"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u5408\u7406\u4f7f\u7528\u5e76\u53d1\u539f\u8bed\uff08\u901a\u9053\u3001\u9501\u7b49\uff09"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 \u6ce8\u610f\u5f02\u6b65\u4ee3\u7801\u7684\u9519\u8bef\u5904\u7406"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u638c\u63e1\u5f02\u6b65\u7f16\u7a0b\uff0c\u80fd\u8ba9\u4f60\u7684 Rust \u5e94\u7528\u5b9e\u73b0\u9ad8\u5e76\u53d1\u3001\u9ad8\u6027\u80fd\uff01"})]})}function o(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}}}]);
"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[2214],{48885:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>l});var s=r(99378);const o={},t=s.createContext(o);function i(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(t.Provider,{value:n},e.children)}},65038:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"ml/anomaly-detection","title":"\ud83d\udd0d \u5f02\u5e38\u68c0\u6d4b\u8be6\u89e3","description":"\u5f02\u5e38\u68c0\u6d4b\u8bc6\u522b\u4e0e\u6b63\u5e38\u6a21\u5f0f\u663e\u8457\u4e0d\u540c\u7684\u6570\u636e\u70b9\u3002","source":"@site/docs/ml/anomaly-detection.md","sourceDirName":"ml","slug":"/ml/anomaly-detection","permalink":"/docs/ml/anomaly-detection","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/ml/anomaly-detection.md","tags":[],"version":"current","sidebarPosition":38,"frontMatter":{"sidebar_position":38,"title":"\ud83d\udd0d \u5f02\u5e38\u68c0\u6d4b\u8be6\u89e3"},"sidebar":"ml","previous":{"title":"\ud83d\udcd0 \u4e0d\u786e\u5b9a\u6027\u91cf\u5316","permalink":"/docs/ml/uncertainty-quantification"},"next":{"title":"\ud83c\udfae \u5f3a\u5316\u5b66\u4e60\u8fdb\u9636","permalink":"/docs/ml/advanced-rl"}}');var o=r(22714),t=r(48885);const i={sidebar_position:38,title:"\ud83d\udd0d \u5f02\u5e38\u68c0\u6d4b\u8be6\u89e3"},l="\u5f02\u5e38\u68c0\u6d4b\u8be6\u89e3",a={},c=[{value:"\u65b9\u6cd5\u5206\u7c7b",id:"\u65b9\u6cd5\u5206\u7c7b",level:2},{value:"\u7edf\u8ba1\u65b9\u6cd5",id:"\u7edf\u8ba1\u65b9\u6cd5",level:2},{value:"\u673a\u5668\u5b66\u4e60\u65b9\u6cd5",id:"\u673a\u5668\u5b66\u4e60\u65b9\u6cd5",level:2},{value:"Isolation Forest",id:"isolation-forest",level:3},{value:"Local Outlier Factor",id:"local-outlier-factor",level:3},{value:"One-Class SVM",id:"one-class-svm",level:3},{value:"\u6df1\u5ea6\u5b66\u4e60\u65b9\u6cd5",id:"\u6df1\u5ea6\u5b66\u4e60\u65b9\u6cd5",level:2},{value:"AutoEncoder",id:"autoencoder",level:3},{value:"VAE \u5f02\u5e38\u68c0\u6d4b",id:"vae-\u5f02\u5e38\u68c0\u6d4b",level:3},{value:"\u65f6\u95f4\u5e8f\u5217\u5f02\u5e38\u68c0\u6d4b",id:"\u65f6\u95f4\u5e8f\u5217\u5f02\u5e38\u68c0\u6d4b",level:2},{value:"\u8bc4\u4f30\u6307\u6807",id:"\u8bc4\u4f30\u6307\u6807",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",mermaid:"mermaid",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"\u5f02\u5e38\u68c0\u6d4b\u8be6\u89e3",children:"\u5f02\u5e38\u68c0\u6d4b\u8be6\u89e3"})}),"\n",(0,o.jsx)(n.p,{children:"\u5f02\u5e38\u68c0\u6d4b\u8bc6\u522b\u4e0e\u6b63\u5e38\u6a21\u5f0f\u663e\u8457\u4e0d\u540c\u7684\u6570\u636e\u70b9\u3002"}),"\n",(0,o.jsx)(n.h2,{id:"\u65b9\u6cd5\u5206\u7c7b",children:"\u65b9\u6cd5\u5206\u7c7b"}),"\n",(0,o.jsx)(n.mermaid,{value:"graph TB\n    A[\u5f02\u5e38\u68c0\u6d4b] --\x3e B[\u7edf\u8ba1\u65b9\u6cd5]\n    A --\x3e C[\u673a\u5668\u5b66\u4e60]\n    A --\x3e D[\u6df1\u5ea6\u5b66\u4e60]\n    B --\x3e B1[Z-Score]\n    B --\x3e B2[IQR]\n    C --\x3e C1[Isolation Forest]\n    C --\x3e C2[One-Class SVM]\n    C --\x3e C3[LOF]\n    D --\x3e D1[AutoEncoder]\n    D --\x3e D2[VAE]"}),"\n",(0,o.jsx)(n.h2,{id:"\u7edf\u8ba1\u65b9\u6cd5",children:"\u7edf\u8ba1\u65b9\u6cd5"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import numpy as np\nfrom scipy import stats\n\n# Z-Score\ndef zscore_anomaly(data, threshold=3):\n    z_scores = np.abs(stats.zscore(data))\n    return z_scores > threshold\n\n# IQR\ndef iqr_anomaly(data, k=1.5):\n    Q1, Q3 = np.percentile(data, [25, 75])\n    IQR = Q3 - Q1\n    lower = Q1 - k * IQR\n    upper = Q3 + k * IQR\n    return (data < lower) | (data > upper)\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u673a\u5668\u5b66\u4e60\u65b9\u6cd5",children:"\u673a\u5668\u5b66\u4e60\u65b9\u6cd5"}),"\n",(0,o.jsx)(n.h3,{id:"isolation-forest",children:"Isolation Forest"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from sklearn.ensemble import IsolationForest\n\niso = IsolationForest(contamination=0.1, random_state=42)\npredictions = iso.fit_predict(X)  # -1: \u5f02\u5e38, 1: \u6b63\u5e38\nscores = iso.decision_function(X)  # \u5f02\u5e38\u5206\u6570\n"})}),"\n",(0,o.jsx)(n.h3,{id:"local-outlier-factor",children:"Local Outlier Factor"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from sklearn.neighbors import LocalOutlierFactor\n\nlof = LocalOutlierFactor(n_neighbors=20, contamination=0.1)\npredictions = lof.fit_predict(X)\nscores = -lof.negative_outlier_factor_\n"})}),"\n",(0,o.jsx)(n.h3,{id:"one-class-svm",children:"One-Class SVM"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from sklearn.svm import OneClassSVM\n\nocsvm = OneClassSVM(kernel='rbf', gamma='scale', nu=0.1)\npredictions = ocsvm.fit_predict(X)\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u6df1\u5ea6\u5b66\u4e60\u65b9\u6cd5",children:"\u6df1\u5ea6\u5b66\u4e60\u65b9\u6cd5"}),"\n",(0,o.jsx)(n.h3,{id:"autoencoder",children:"AutoEncoder"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import torch.nn as nn\n\nclass AnomalyAutoEncoder(nn.Module):\n    def __init__(self, input_dim, latent_dim=32):\n        super().__init__()\n        self.encoder = nn.Sequential(\n            nn.Linear(input_dim, 64),\n            nn.ReLU(),\n            nn.Linear(64, latent_dim)\n        )\n        self.decoder = nn.Sequential(\n            nn.Linear(latent_dim, 64),\n            nn.ReLU(),\n            nn.Linear(64, input_dim)\n        )\n\n    def forward(self, x):\n        z = self.encoder(x)\n        return self.decoder(z)\n\n    def anomaly_score(self, x):\n        recon = self.forward(x)\n        return ((x - recon) ** 2).mean(dim=1)\n\n# \u91cd\u5efa\u8bef\u5dee\u5927 \u2192 \u5f02\u5e38\nscores = model.anomaly_score(X)\nthreshold = np.percentile(scores, 95)\nanomalies = scores > threshold\n"})}),"\n",(0,o.jsx)(n.h3,{id:"vae-\u5f02\u5e38\u68c0\u6d4b",children:"VAE \u5f02\u5e38\u68c0\u6d4b"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"class VAEAD(nn.Module):\n    def anomaly_score(self, x):\n        mu, log_var = self.encode(x)\n        z = self.reparameterize(mu, log_var)\n        recon = self.decode(z)\n\n        # \u91cd\u5efa\u8bef\u5dee + KL \u6563\u5ea6\n        recon_loss = ((x - recon) ** 2).sum(dim=1)\n        kl_loss = -0.5 * (1 + log_var - mu.pow(2) - log_var.exp()).sum(dim=1)\n\n        return recon_loss + kl_loss\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u65f6\u95f4\u5e8f\u5217\u5f02\u5e38\u68c0\u6d4b",children:"\u65f6\u95f4\u5e8f\u5217\u5f02\u5e38\u68c0\u6d4b"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from pyod.models.knn import KNN\nfrom pyod.models.copod import COPOD\n\n# \u6ed1\u52a8\u7a97\u53e3\u7279\u5f81\ndef create_features(series, window=10):\n    features = []\n    for i in range(window, len(series)):\n        features.append([\n            series[i-window:i].mean(),\n            series[i-window:i].std(),\n            series[i] - series[i-1]\n        ])\n    return np.array(features)\n\n# \u68c0\u6d4b\ndetector = COPOD()\ndetector.fit(features)\nscores = detector.decision_scores_\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u8bc4\u4f30\u6307\u6807",children:"\u8bc4\u4f30\u6307\u6807"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"from sklearn.metrics import precision_recall_curve, auc\n\n# \u7531\u4e8e\u5f02\u5e38\u7a00\u5c11\uff0c\u4f7f\u7528 PR-AUC\nprecision, recall, _ = precision_recall_curve(y_true, scores)\npr_auc = auc(recall, precision)\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"\u6307\u6807"}),(0,o.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"PR-AUC"}),(0,o.jsx)(n.td,{children:"\u7cbe\u786e\u7387-\u53ec\u56de\u7387 AUC"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"F1@K"}),(0,o.jsx)(n.td,{children:"\u524d K \u4e2a\u9884\u6d4b\u7684 F1"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Hit Rate"}),(0,o.jsx)(n.td,{children:"\u771f\u5b9e\u5f02\u5e38\u5728\u524d K \u7684\u6bd4\u4f8b"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);
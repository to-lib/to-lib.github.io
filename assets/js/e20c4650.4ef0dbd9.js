"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[60068],{48885:(n,e,r)=>{r.d(e,{R:()=>t,x:()=>i});var c=r(99378);const o={},s=c.createContext(o);function t(n){const e=c.useContext(s);return c.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:t(n.components),c.createElement(s.Provider,{value:e},n.children)}},58205:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>a});const c=JSON.parse('{"id":"kafka/kafka-connect","title":"Kafka Connect","description":"Kafka Connect \u6570\u636e\u96c6\u6210\u6846\u67b6\u4f7f\u7528\u6307\u5357","source":"@site/docs/kafka/kafka-connect.md","sourceDirName":"kafka","slug":"/kafka/kafka-connect","permalink":"/docs/kafka/kafka-connect","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/kafka/kafka-connect.md","tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"sidebar_position":14,"title":"Kafka Connect","description":"Kafka Connect \u6570\u636e\u96c6\u6210\u6846\u67b6\u4f7f\u7528\u6307\u5357"},"sidebar":"kafka","previous":{"title":"\u96c6\u7fa4\u7ba1\u7406","permalink":"/docs/kafka/cluster-management"},"next":{"title":"Kafka Streams","permalink":"/docs/kafka/kafka-streams"}}');var o=r(22714),s=r(48885);const t={sidebar_position:14,title:"Kafka Connect",description:"Kafka Connect \u6570\u636e\u96c6\u6210\u6846\u67b6\u4f7f\u7528\u6307\u5357"},i="Kafka Connect",l={},a=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"\u6838\u5fc3\u6982\u5ff5",id:"\u6838\u5fc3\u6982\u5ff5",level:2},{value:"Connector \u7c7b\u578b",id:"connector-\u7c7b\u578b",level:3},{value:"\u6838\u5fc3\u7ec4\u4ef6",id:"\u6838\u5fc3\u7ec4\u4ef6",level:3},{value:"\u90e8\u7f72\u6a21\u5f0f",id:"\u90e8\u7f72\u6a21\u5f0f",level:2},{value:"\u5355\u673a\u6a21\u5f0f",id:"\u5355\u673a\u6a21\u5f0f",level:3},{value:"\u5206\u5e03\u5f0f\u6a21\u5f0f",id:"\u5206\u5e03\u5f0f\u6a21\u5f0f",level:3},{value:"\u5e38\u7528 Connector",id:"\u5e38\u7528-connector",level:2},{value:"JDBC Source Connector",id:"jdbc-source-connector",level:3},{value:"JDBC Sink Connector",id:"jdbc-sink-connector",level:3},{value:"Elasticsearch Sink Connector",id:"elasticsearch-sink-connector",level:3},{value:"S3 Sink Connector",id:"s3-sink-connector",level:3},{value:"File Source Connector",id:"file-source-connector",level:3},{value:"REST API \u64cd\u4f5c",id:"rest-api-\u64cd\u4f5c",level:2},{value:"\u67e5\u770b Connector \u72b6\u6001",id:"\u67e5\u770b-connector-\u72b6\u6001",level:3},{value:"\u7ba1\u7406 Connector",id:"\u7ba1\u7406-connector",level:3},{value:"\u6570\u636e\u8f6c\u6362\uff08SMT\uff09",id:"\u6570\u636e\u8f6c\u6362smt",level:2},{value:"\u5185\u7f6e\u8f6c\u6362",id:"\u5185\u7f6e\u8f6c\u6362",level:3},{value:"\u5e38\u7528 SMT",id:"\u5e38\u7528-smt",level:3},{value:"\u81ea\u5b9a\u4e49 Connector",id:"\u81ea\u5b9a\u4e49-connector",level:2},{value:"\u5f00\u53d1 Source Connector",id:"\u5f00\u53d1-source-connector",level:3},{value:"\u5f00\u53d1 Source Task",id:"\u5f00\u53d1-source-task",level:3},{value:"\u76d1\u63a7\u4e0e\u8fd0\u7ef4",id:"\u76d1\u63a7\u4e0e\u8fd0\u7ef4",level:2},{value:"\u5173\u952e\u6307\u6807",id:"\u5173\u952e\u6307\u6807",level:3},{value:"\u65e5\u5fd7\u6392\u67e5",id:"\u65e5\u5fd7\u6392\u67e5",level:3},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u914d\u7f6e\u5efa\u8bae",id:"\u914d\u7f6e\u5efa\u8bae",level:3},{value:"\u9ad8\u53ef\u7528\u90e8\u7f72",id:"\u9ad8\u53ef\u7528\u90e8\u7f72",level:3},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"kafka-connect",children:"Kafka Connect"})}),"\n",(0,o.jsx)(e.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,o.jsx)(e.p,{children:"Kafka Connect \u662f Kafka \u7684\u6570\u636e\u96c6\u6210\u6846\u67b6\uff0c\u7528\u4e8e\u5728 Kafka \u548c\u5916\u90e8\u7cfb\u7edf\u4e4b\u95f4\u53ef\u9760\u5730\u4f20\u8f93\u6570\u636e\u3002"}),"\n",(0,o.jsx)(e.mermaid,{value:"graph LR\n    subgraph \u6570\u636e\u6e90\n        DB[(MySQL)]\n        FS[\u6587\u4ef6\u7cfb\u7edf]\n        API[REST API]\n    end\n\n    subgraph Kafka Connect\n        SC[Source Connector]\n        SK[Sink Connector]\n    end\n\n    subgraph Kafka\n        T[Topic]\n    end\n\n    subgraph \u76ee\u6807\u7cfb\u7edf\n        ES[(Elasticsearch)]\n        S3[(S3)]\n        DW[(\u6570\u636e\u4ed3\u5e93)]\n    end\n\n    DB --\x3e SC\n    FS --\x3e SC\n    API --\x3e SC\n    SC --\x3e T\n    T --\x3e SK\n    SK --\x3e ES\n    SK --\x3e S3\n    SK --\x3e DW\n\n    style T fill:#2e7d32,color:#fff"}),"\n",(0,o.jsx)(e.h2,{id:"\u6838\u5fc3\u6982\u5ff5",children:"\u6838\u5fc3\u6982\u5ff5"}),"\n",(0,o.jsx)(e.h3,{id:"connector-\u7c7b\u578b",children:"Connector \u7c7b\u578b"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,o.jsxs)(e.table,{children:[(0,o.jsx)(e.thead,{children:(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.th,{children:"\u7c7b\u578b"}),(0,o.jsx)(e.th,{children:"\u4f5c\u7528"}),(0,o.jsx)(e.th,{children:"\u6570\u636e\u6d41\u5411"})]})}),(0,o.jsxs)(e.tbody,{children:[(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.strong,{children:"Source Connector"})}),(0,o.jsx)(e.td,{children:"\u4ece\u5916\u90e8\u7cfb\u7edf\u5bfc\u5165\u6570\u636e"}),(0,o.jsx)(e.td,{children:"\u5916\u90e8\u7cfb\u7edf \u2192 Kafka"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.strong,{children:"Sink Connector"})}),(0,o.jsx)(e.td,{children:"\u5c06\u6570\u636e\u5bfc\u51fa\u5230\u5916\u90e8\u7cfb\u7edf"}),(0,o.jsx)(e.td,{children:"Kafka \u2192 \u5916\u90e8\u7cfb\u7edf"})]})]})]}),"\n",(0,o.jsx)(e.h3,{id:"\u6838\u5fc3\u7ec4\u4ef6",children:"\u6838\u5fc3\u7ec4\u4ef6"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Connector"}),"\uff1a\u5b9a\u4e49\u6570\u636e\u5982\u4f55\u5728 Kafka \u548c\u5916\u90e8\u7cfb\u7edf\u4e4b\u95f4\u6d41\u52a8"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Task"}),"\uff1a\u5b9e\u9645\u6267\u884c\u6570\u636e\u590d\u5236\u7684\u5de5\u4f5c\u5355\u5143"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Worker"}),"\uff1a\u8fd0\u884c Connector \u548c Task \u7684 JVM \u8fdb\u7a0b"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Converter"}),"\uff1a\u6570\u636e\u683c\u5f0f\u8f6c\u6362\uff08JSON\u3001Avro \u7b49\uff09"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Transform"}),"\uff1a\u6570\u636e\u8f6c\u6362\u5904\u7406"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"\u90e8\u7f72\u6a21\u5f0f",children:"\u90e8\u7f72\u6a21\u5f0f"}),"\n",(0,o.jsx)(e.h3,{id:"\u5355\u673a\u6a21\u5f0f",children:"\u5355\u673a\u6a21\u5f0f"}),"\n",(0,o.jsx)(e.p,{children:"\u9002\u7528\u4e8e\u5f00\u53d1\u548c\u6d4b\u8bd5\uff1a"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"# \u542f\u52a8\u5355\u673a\u6a21\u5f0f\nbin/connect-standalone.sh \\\n  config/connect-standalone.properties \\\n  config/connect-file-source.properties\n"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"\u914d\u7f6e\u6587\u4ef6\uff08connect-standalone.properties\uff09\uff1a"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-properties",children:"bootstrap.servers=localhost:9092\nkey.converter=org.apache.kafka.connect.json.JsonConverter\nvalue.converter=org.apache.kafka.connect.json.JsonConverter\nkey.converter.schemas.enable=false\nvalue.converter.schemas.enable=false\n\n# \u4f4d\u79fb\u5b58\u50a8\noffset.storage.file.filename=/tmp/connect.offsets\n"})}),"\n",(0,o.jsx)(e.h3,{id:"\u5206\u5e03\u5f0f\u6a21\u5f0f",children:"\u5206\u5e03\u5f0f\u6a21\u5f0f"}),"\n",(0,o.jsx)(e.p,{children:"\u9002\u7528\u4e8e\u751f\u4ea7\u73af\u5883\uff1a"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"# \u542f\u52a8\u5206\u5e03\u5f0f\u6a21\u5f0f\nbin/connect-distributed.sh config/connect-distributed.properties\n"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"\u914d\u7f6e\u6587\u4ef6\uff08connect-distributed.properties\uff09\uff1a"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-properties",children:"bootstrap.servers=kafka1:9092,kafka2:9092,kafka3:9092\ngroup.id=connect-cluster\n\nkey.converter=org.apache.kafka.connect.json.JsonConverter\nvalue.converter=org.apache.kafka.connect.json.JsonConverter\n\n# \u5185\u90e8 Topic \u914d\u7f6e\nconfig.storage.topic=connect-configs\nconfig.storage.replication.factor=3\noffset.storage.topic=connect-offsets\noffset.storage.replication.factor=3\nstatus.storage.topic=connect-status\nstatus.storage.replication.factor=3\n\n# REST API \u7aef\u53e3\nrest.port=8083\nrest.advertised.host.name=connect-worker1\n"})}),"\n",(0,o.jsx)(e.h2,{id:"\u5e38\u7528-connector",children:"\u5e38\u7528 Connector"}),"\n",(0,o.jsx)(e.h3,{id:"jdbc-source-connector",children:"JDBC Source Connector"}),"\n",(0,o.jsx)(e.p,{children:"\u4ece\u6570\u636e\u5e93\u5bfc\u5165\u6570\u636e\uff1a"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-json",children:'{\n  "name": "jdbc-source-connector",\n  "config": {\n    "connector.class": "io.confluent.connect.jdbc.JdbcSourceConnector",\n    "connection.url": "jdbc:mysql://localhost:3306/mydb",\n    "connection.user": "user",\n    "connection.password": "password",\n    "table.whitelist": "users,orders",\n    "mode": "incrementing",\n    "incrementing.column.name": "id",\n    "topic.prefix": "mysql-",\n    "poll.interval.ms": 1000\n  }\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"jdbc-sink-connector",children:"JDBC Sink Connector"}),"\n",(0,o.jsx)(e.p,{children:"\u5c06\u6570\u636e\u5199\u5165\u6570\u636e\u5e93\uff1a"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-json",children:'{\n  "name": "jdbc-sink-connector",\n  "config": {\n    "connector.class": "io.confluent.connect.jdbc.JdbcSinkConnector",\n    "connection.url": "jdbc:postgresql://localhost:5432/analytics",\n    "connection.user": "user",\n    "connection.password": "password",\n    "topics": "mysql-users,mysql-orders",\n    "insert.mode": "upsert",\n    "pk.mode": "record_key",\n    "pk.fields": "id",\n    "auto.create": true\n  }\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"elasticsearch-sink-connector",children:"Elasticsearch Sink Connector"}),"\n",(0,o.jsx)(e.p,{children:"\u5c06\u6570\u636e\u5199\u5165 Elasticsearch\uff1a"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-json",children:'{\n  "name": "elasticsearch-sink",\n  "config": {\n    "connector.class": "io.confluent.connect.elasticsearch.ElasticsearchSinkConnector",\n    "connection.url": "http://elasticsearch:9200",\n    "topics": "logs",\n    "type.name": "_doc",\n    "key.ignore": true,\n    "schema.ignore": true\n  }\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"s3-sink-connector",children:"S3 Sink Connector"}),"\n",(0,o.jsx)(e.p,{children:"\u5c06\u6570\u636e\u5199\u5165 S3\uff1a"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-json",children:'{\n  "name": "s3-sink",\n  "config": {\n    "connector.class": "io.confluent.connect.s3.S3SinkConnector",\n    "s3.bucket.name": "my-bucket",\n    "s3.region": "us-east-1",\n    "topics": "events",\n    "format.class": "io.confluent.connect.s3.format.parquet.ParquetFormat",\n    "flush.size": 10000,\n    "rotate.interval.ms": 3600000,\n    "storage.class": "io.confluent.connect.s3.storage.S3Storage"\n  }\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"file-source-connector",children:"File Source Connector"}),"\n",(0,o.jsx)(e.p,{children:"\u4ece\u6587\u4ef6\u8bfb\u53d6\u6570\u636e\uff1a"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-json",children:'{\n  "name": "file-source",\n  "config": {\n    "connector.class": "org.apache.kafka.connect.file.FileStreamSourceConnector",\n    "file": "/var/log/app.log",\n    "topic": "app-logs"\n  }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"rest-api-\u64cd\u4f5c",children:"REST API \u64cd\u4f5c"}),"\n",(0,o.jsx)(e.h3,{id:"\u67e5\u770b-connector-\u72b6\u6001",children:"\u67e5\u770b Connector \u72b6\u6001"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"# \u5217\u51fa\u6240\u6709 Connector\ncurl http://localhost:8083/connectors\n\n# \u67e5\u770b Connector \u8be6\u60c5\ncurl http://localhost:8083/connectors/jdbc-source-connector\n\n# \u67e5\u770b Connector \u72b6\u6001\ncurl http://localhost:8083/connectors/jdbc-source-connector/status\n\n# \u67e5\u770b Connector \u914d\u7f6e\ncurl http://localhost:8083/connectors/jdbc-source-connector/config\n"})}),"\n",(0,o.jsx)(e.h3,{id:"\u7ba1\u7406-connector",children:"\u7ba1\u7406 Connector"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:'# \u521b\u5efa Connector\ncurl -X POST http://localhost:8083/connectors \\\n  -H "Content-Type: application/json" \\\n  -d @connector-config.json\n\n# \u66f4\u65b0 Connector \u914d\u7f6e\ncurl -X PUT http://localhost:8083/connectors/my-connector/config \\\n  -H "Content-Type: application/json" \\\n  -d @new-config.json\n\n# \u6682\u505c Connector\ncurl -X PUT http://localhost:8083/connectors/my-connector/pause\n\n# \u6062\u590d Connector\ncurl -X PUT http://localhost:8083/connectors/my-connector/resume\n\n# \u91cd\u542f Connector\ncurl -X POST http://localhost:8083/connectors/my-connector/restart\n\n# \u5220\u9664 Connector\ncurl -X DELETE http://localhost:8083/connectors/my-connector\n'})}),"\n",(0,o.jsx)(e.h2,{id:"\u6570\u636e\u8f6c\u6362smt",children:"\u6570\u636e\u8f6c\u6362\uff08SMT\uff09"}),"\n",(0,o.jsx)(e.h3,{id:"\u5185\u7f6e\u8f6c\u6362",children:"\u5185\u7f6e\u8f6c\u6362"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-json",children:'{\n  "name": "jdbc-source",\n  "config": {\n    "connector.class": "io.confluent.connect.jdbc.JdbcSourceConnector",\n    "transforms": "route,filter,mask",\n\n    "transforms.route.type": "org.apache.kafka.connect.transforms.RegexRouter",\n    "transforms.route.regex": "(.*)orders(.*)",\n    "transforms.route.replacement": "$1orders_v2$2",\n\n    "transforms.filter.type": "org.apache.kafka.connect.transforms.Filter",\n    "transforms.filter.predicate": "IsTest",\n    "transforms.filter.negate": true,\n\n    "transforms.mask.type": "org.apache.kafka.connect.transforms.MaskField$Value",\n    "transforms.mask.fields": "password,ssn",\n    "transforms.mask.replacement": "***",\n\n    "predicates": "IsTest",\n    "predicates.IsTest.type": "org.apache.kafka.connect.transforms.predicates.RecordIsTombstone"\n  }\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"\u5e38\u7528-smt",children:"\u5e38\u7528 SMT"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,o.jsxs)(e.table,{children:[(0,o.jsx)(e.thead,{children:(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.th,{children:"\u8f6c\u6362"}),(0,o.jsx)(e.th,{children:"\u4f5c\u7528"})]})}),(0,o.jsxs)(e.tbody,{children:[(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"InsertField"})}),(0,o.jsx)(e.td,{children:"\u6dfb\u52a0\u5b57\u6bb5"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"ReplaceField"})}),(0,o.jsx)(e.td,{children:"\u91cd\u547d\u540d/\u5220\u9664\u5b57\u6bb5"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"MaskField"})}),(0,o.jsx)(e.td,{children:"\u8131\u654f\u5b57\u6bb5"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"ExtractField"})}),(0,o.jsx)(e.td,{children:"\u63d0\u53d6\u5b57\u6bb5"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"TimestampRouter"})}),(0,o.jsx)(e.td,{children:"\u6309\u65f6\u95f4\u8def\u7531 Topic"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"RegexRouter"})}),(0,o.jsx)(e.td,{children:"\u6b63\u5219\u8def\u7531 Topic"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"Flatten"})}),(0,o.jsx)(e.td,{children:"\u6241\u5e73\u5316\u5d4c\u5957\u7ed3\u6784"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"Cast"})}),(0,o.jsx)(e.td,{children:"\u7c7b\u578b\u8f6c\u6362"})]})]})]}),"\n",(0,o.jsx)(e.h2,{id:"\u81ea\u5b9a\u4e49-connector",children:"\u81ea\u5b9a\u4e49 Connector"}),"\n",(0,o.jsx)(e.h3,{id:"\u5f00\u53d1-source-connector",children:"\u5f00\u53d1 Source Connector"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-java",children:'public class MySourceConnector extends SourceConnector {\n    private Map<String, String> configProperties;\n\n    @Override\n    public void start(Map<String, String> props) {\n        this.configProperties = props;\n    }\n\n    @Override\n    public Class<? extends Task> taskClass() {\n        return MySourceTask.class;\n    }\n\n    @Override\n    public List<Map<String, String>> taskConfigs(int maxTasks) {\n        List<Map<String, String>> configs = new ArrayList<>();\n        for (int i = 0; i < maxTasks; i++) {\n            Map<String, String> config = new HashMap<>(configProperties);\n            config.put("task.id", String.valueOf(i));\n            configs.add(config);\n        }\n        return configs;\n    }\n\n    @Override\n    public void stop() {\n        // \u6e05\u7406\u8d44\u6e90\n    }\n\n    @Override\n    public ConfigDef config() {\n        return new ConfigDef()\n            .define("my.config", ConfigDef.Type.STRING,\n                    ConfigDef.Importance.HIGH, "My configuration");\n    }\n\n    @Override\n    public String version() {\n        return "1.0.0";\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"\u5f00\u53d1-source-task",children:"\u5f00\u53d1 Source Task"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-java",children:'public class MySourceTask extends SourceTask {\n    private String topic;\n    private long offset = 0;\n\n    @Override\n    public void start(Map<String, String> props) {\n        this.topic = props.get("topic");\n    }\n\n    @Override\n    public List<SourceRecord> poll() throws InterruptedException {\n        List<SourceRecord> records = new ArrayList<>();\n\n        // \u4ece\u5916\u90e8\u7cfb\u7edf\u83b7\u53d6\u6570\u636e\n        String data = fetchData();\n\n        if (data != null) {\n            Map<String, ?> sourcePartition = Collections.singletonMap("partition", 0);\n            Map<String, ?> sourceOffset = Collections.singletonMap("offset", offset++);\n\n            records.add(new SourceRecord(\n                sourcePartition,\n                sourceOffset,\n                topic,\n                Schema.STRING_SCHEMA,\n                data\n            ));\n        }\n\n        return records;\n    }\n\n    @Override\n    public void stop() {\n        // \u6e05\u7406\u8d44\u6e90\n    }\n\n    @Override\n    public String version() {\n        return "1.0.0";\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"\u76d1\u63a7\u4e0e\u8fd0\u7ef4",children:"\u76d1\u63a7\u4e0e\u8fd0\u7ef4"}),"\n",(0,o.jsx)(e.h3,{id:"\u5173\u952e\u6307\u6807",children:"\u5173\u952e\u6307\u6807"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,o.jsxs)(e.table,{children:[(0,o.jsx)(e.thead,{children:(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.th,{children:"\u6307\u6807"}),(0,o.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,o.jsxs)(e.tbody,{children:[(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"connector-count"})}),(0,o.jsx)(e.td,{children:"\u8fd0\u884c\u7684 Connector \u6570\u91cf"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"task-count"})}),(0,o.jsx)(e.td,{children:"\u8fd0\u884c\u7684 Task \u6570\u91cf"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"connector-startup-success-total"})}),(0,o.jsx)(e.td,{children:"\u6210\u529f\u542f\u52a8\u6b21\u6570"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"connector-startup-failure-total"})}),(0,o.jsx)(e.td,{children:"\u542f\u52a8\u5931\u8d25\u6b21\u6570"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"source-record-poll-rate"})}),(0,o.jsx)(e.td,{children:"Source \u62c9\u53d6\u901f\u7387"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"sink-record-send-rate"})}),(0,o.jsx)(e.td,{children:"Sink \u53d1\u9001\u901f\u7387"})]})]})]}),"\n",(0,o.jsx)(e.h3,{id:"\u65e5\u5fd7\u6392\u67e5",children:"\u65e5\u5fd7\u6392\u67e5"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:'# \u67e5\u770b Connector \u65e5\u5fd7\ngrep "my-connector" /var/log/kafka-connect/connect.log\n\n# \u67e5\u770b Task \u9519\u8bef\ncurl http://localhost:8083/connectors/my-connector/tasks/0/status\n'})}),"\n",(0,o.jsx)(e.h3,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"Q: Connector \u542f\u52a8\u5931\u8d25"})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"# \u68c0\u67e5 Connector \u72b6\u6001\ncurl http://localhost:8083/connectors/my-connector/status | jq '.tasks[0].trace'\n"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.strong,{children:"Q: \u6570\u636e\u5ef6\u8fdf"})}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"\u589e\u52a0 Task \u6570\u91cf"}),"\n",(0,o.jsxs)(e.li,{children:["\u8c03\u6574 ",(0,o.jsx)(e.code,{children:"poll.interval.ms"})]}),"\n",(0,o.jsx)(e.li,{children:"\u68c0\u67e5\u76ee\u6807\u7cfb\u7edf\u6027\u80fd"}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,o.jsx)(e.h3,{id:"\u914d\u7f6e\u5efa\u8bae",children:"\u914d\u7f6e\u5efa\u8bae"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-properties",children:"# \u589e\u52a0 Task \u6570\u91cf\u63d0\u9ad8\u5e76\u884c\ntasks.max=4\n\n# \u9519\u8bef\u5904\u7406\nerrors.tolerance=all\nerrors.deadletterqueue.topic.name=dlq-topic\nerrors.deadletterqueue.topic.replication.factor=3\nerrors.log.enable=true\nerrors.log.include.messages=true\n\n# \u751f\u4ea7\u8005\u4f18\u5316\nproducer.batch.size=32768\nproducer.linger.ms=100\nproducer.compression.type=lz4\n"})}),"\n",(0,o.jsx)(e.h3,{id:"\u9ad8\u53ef\u7528\u90e8\u7f72",children:"\u9ad8\u53ef\u7528\u90e8\u7f72"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"\u591a Worker \u8282\u70b9"}),"\uff1a\u81f3\u5c11 3 \u4e2a Worker"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"\u5185\u90e8 Topic \u526f\u672c"}),"\uff1areplication.factor >= 3"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"\u76d1\u63a7\u544a\u8b66"}),"\uff1aPrometheus + Grafana"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"\u5bb9\u91cf\u89c4\u5212"}),"\uff1a\u9884\u7559\u8db3\u591f\u8d44\u6e90"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"https://kafka.apache.org/documentation/#connect",children:"Kafka Connect \u5b98\u65b9\u6587\u6863"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"https://docs.confluent.io/platform/current/connect/",children:"Confluent Connect \u6587\u6863"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"https://www.confluent.io/hub/",children:"Connector Hub"})}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(d,{...n})}):d(n)}}}]);
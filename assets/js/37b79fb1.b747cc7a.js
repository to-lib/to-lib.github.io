"use strict";(globalThis.webpackChunkto_lib_github_io=globalThis.webpackChunkto_lib_github_io||[]).push([[8974],{1266:(n,e,r)=>{r.d(e,{R:()=>t,x:()=>c});var s=r(9378);const i={},a=s.createContext(i);function t(n){const e=s.useContext(a);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),s.createElement(a.Provider,{value:e},n.children)}},8039:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"spring/transactions","title":"\u4e8b\u52a1\u7ba1\u7406","description":"1. \u4e8b\u52a1\u57fa\u7840","source":"@site/docs/spring/transactions.md","sourceDirName":"spring","slug":"/spring/transactions","permalink":"/docs/spring/transactions","draft":false,"unlisted":false,"editUrl":"https://github.com/to-lib/to-lib.github.io/tree/main/docs/spring/transactions.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"transactions","title":"\u4e8b\u52a1\u7ba1\u7406","sidebar_label":"\u4e8b\u52a1\u7ba1\u7406","sidebar_position":6},"sidebar":"spring","previous":{"title":"AOP","permalink":"/docs/spring/aop"},"next":{"title":"Spring MVC","permalink":"/docs/spring/spring-mvc"}}');var i=r(2714),a=r(1266);const t={id:"transactions",title:"\u4e8b\u52a1\u7ba1\u7406",sidebar_label:"\u4e8b\u52a1\u7ba1\u7406",sidebar_position:6},c="Spring \u4e8b\u52a1\u7ba1\u7406",l={},o=[{value:"1. \u4e8b\u52a1\u57fa\u7840",id:"1-\u4e8b\u52a1\u57fa\u7840",level:2},{value:"1.1 \u4e8b\u52a1\u7684\u7279\u6027\uff08ACID\uff09",id:"11-\u4e8b\u52a1\u7684\u7279\u6027acid",level:3},{value:"1.2 Spring\u4e8b\u52a1\u7ba1\u7406\u65b9\u5f0f",id:"12-spring\u4e8b\u52a1\u7ba1\u7406\u65b9\u5f0f",level:3},{value:"2. \u7f16\u7a0b\u5f0f\u4e8b\u52a1\u7ba1\u7406",id:"2-\u7f16\u7a0b\u5f0f\u4e8b\u52a1\u7ba1\u7406",level:2},{value:"2.1 \u4f7f\u7528TransactionTemplate",id:"21-\u4f7f\u7528transactiontemplate",level:3},{value:"2.2 \u4f7f\u7528PlatformTransactionManager",id:"22-\u4f7f\u7528platformtransactionmanager",level:3},{value:"3. \u58f0\u660e\u5f0f\u4e8b\u52a1\u7ba1\u7406\uff08\u63a8\u8350\uff09",id:"3-\u58f0\u660e\u5f0f\u4e8b\u52a1\u7ba1\u7406\u63a8\u8350",level:2},{value:"3.1 \u57fa\u672c\u4f7f\u7528",id:"31-\u57fa\u672c\u4f7f\u7528",level:3},{value:"3.2 \u914d\u7f6e",id:"32-\u914d\u7f6e",level:3},{value:"4. @Transactional\u8be6\u89e3",id:"4-transactional\u8be6\u89e3",level:2},{value:"4.1 \u5e38\u7528\u5c5e\u6027",id:"41-\u5e38\u7528\u5c5e\u6027",level:3},{value:"4.2 \u4f20\u64ad\u884c\u4e3a\uff08Propagation\uff09",id:"42-\u4f20\u64ad\u884c\u4e3apropagation",level:3},{value:"4.3 \u9694\u79bb\u7ea7\u522b\uff08Isolation\uff09",id:"43-\u9694\u79bb\u7ea7\u522bisolation",level:3},{value:"4.4 \u53ea\u8bfb\u4e8b\u52a1",id:"44-\u53ea\u8bfb\u4e8b\u52a1",level:3},{value:"4.5 \u8d85\u65f6\u8bbe\u7f6e",id:"45-\u8d85\u65f6\u8bbe\u7f6e",level:3},{value:"4.6 \u5f02\u5e38\u5904\u7406",id:"46-\u5f02\u5e38\u5904\u7406",level:3},{value:"5. \u4e8b\u52a1\u7684\u56de\u6eda",id:"5-\u4e8b\u52a1\u7684\u56de\u6eda",level:2},{value:"5.1 \u81ea\u52a8\u56de\u6eda",id:"51-\u81ea\u52a8\u56de\u6eda",level:3},{value:"5.2 \u624b\u52a8\u56de\u6eda",id:"52-\u624b\u52a8\u56de\u6eda",level:3},{value:"6. \u5e38\u89c1\u95ee\u9898",id:"6-\u5e38\u89c1\u95ee\u9898",level:2},{value:"6.1 self-invocation\u95ee\u9898",id:"61-self-invocation\u95ee\u9898",level:3},{value:"6.2 private\u65b9\u6cd5\u4e0d\u751f\u6548",id:"62-private\u65b9\u6cd5\u4e0d\u751f\u6548",level:3},{value:"6.3 \u6ce8\u89e3\u5728\u63a5\u53e3\u4e0a",id:"63-\u6ce8\u89e3\u5728\u63a5\u53e3\u4e0a",level:3},{value:"7. \u5b9e\u6218\u793a\u4f8b",id:"7-\u5b9e\u6218\u793a\u4f8b",level:2},{value:"7.1 \u8f6c\u8d26\u793a\u4f8b",id:"71-\u8f6c\u8d26\u793a\u4f8b",level:3},{value:"7.2 \u8ba2\u5355\u5904\u7406\u793a\u4f8b",id:"72-\u8ba2\u5355\u5904\u7406\u793a\u4f8b",level:3},{value:"8. \u603b\u7ed3",id:"8-\u603b\u7ed3",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"spring-\u4e8b\u52a1\u7ba1\u7406",children:"Spring \u4e8b\u52a1\u7ba1\u7406"})}),"\n",(0,i.jsx)(e.h2,{id:"1-\u4e8b\u52a1\u57fa\u7840",children:"1. \u4e8b\u52a1\u57fa\u7840"}),"\n",(0,i.jsx)(e.h3,{id:"11-\u4e8b\u52a1\u7684\u7279\u6027acid",children:"1.1 \u4e8b\u52a1\u7684\u7279\u6027\uff08ACID\uff09"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"A (Atomicity)"})}),(0,i.jsx)(e.td,{children:"\u539f\u5b50\u6027 - \u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u64cd\u4f5c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"C (Consistency)"})}),(0,i.jsx)(e.td,{children:"\u4e00\u81f4\u6027 - \u4e8b\u52a1\u6267\u884c\u524d\u540e\u6570\u636e\u5fc5\u987b\u4fdd\u6301\u4e00\u81f4"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"I (Isolation)"})}),(0,i.jsx)(e.td,{children:"\u9694\u79bb\u6027 - \u5e76\u53d1\u4e8b\u52a1\u4e4b\u95f4\u4e92\u4e0d\u5f71\u54cd"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"D (Durability)"})}),(0,i.jsx)(e.td,{children:"\u6301\u4e45\u6027 - \u4e8b\u52a1\u6210\u529f\u540e\uff0c\u6570\u636e\u6c38\u4e45\u4fdd\u5b58"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"12-spring\u4e8b\u52a1\u7ba1\u7406\u65b9\u5f0f",children:"1.2 Spring\u4e8b\u52a1\u7ba1\u7406\u65b9\u5f0f"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7f16\u7a0b\u5f0f\u4e8b\u52a1"})," - \u624b\u52a8\u7f16\u5199\u4ee3\u7801\u7ba1\u7406\u4e8b\u52a1"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u58f0\u660e\u5f0f\u4e8b\u52a1"})," - \u4f7f\u7528\u6ce8\u89e3\u6216XML\u914d\u7f6e\uff08\u63a8\u8350\uff09"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"2-\u7f16\u7a0b\u5f0f\u4e8b\u52a1\u7ba1\u7406",children:"2. \u7f16\u7a0b\u5f0f\u4e8b\u52a1\u7ba1\u7406"}),"\n",(0,i.jsx)(e.h3,{id:"21-\u4f7f\u7528transactiontemplate",children:"2.1 \u4f7f\u7528TransactionTemplate"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@Service\npublic class UserService {\n    \n    @Autowired\n    private TransactionTemplate transactionTemplate;\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    public void createUser(User user) {\n        transactionTemplate.execute(new TransactionCallback<Void>() {\n            @Override\n            public Void doInTransaction(TransactionStatus status) {\n                try {\n                    userRepository.save(user);\n                    // \u5176\u4ed6\u64cd\u4f5c\n                    return null;\n                } catch (Exception ex) {\n                    status.setRollbackOnly();  // \u624b\u52a8\u56de\u6eda\n                    throw ex;\n                }\n            }\n        });\n    }\n    \n    // Lambda\u8868\u8fbe\u5f0f\u7b80\u5316\n    public void createUserLambda(User user) {\n        transactionTemplate.execute(status -> {\n            userRepository.save(user);\n            return null;\n        });\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"22-\u4f7f\u7528platformtransactionmanager",children:"2.2 \u4f7f\u7528PlatformTransactionManager"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@Service\npublic class UserService {\n    \n    @Autowired\n    private PlatformTransactionManager transactionManager;\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    public void createUser(User user) {\n        // \u5f00\u59cb\u4e8b\u52a1\n        TransactionStatus status = transactionManager.getTransaction(\n            new DefaultTransactionDefinition()\n        );\n        \n        try {\n            userRepository.save(user);\n            // \u63d0\u4ea4\u4e8b\u52a1\n            transactionManager.commit(status);\n        } catch (Exception ex) {\n            // \u56de\u6eda\u4e8b\u52a1\n            transactionManager.rollback(status);\n            throw ex;\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"3-\u58f0\u660e\u5f0f\u4e8b\u52a1\u7ba1\u7406\u63a8\u8350",children:"3. \u58f0\u660e\u5f0f\u4e8b\u52a1\u7ba1\u7406\uff08\u63a8\u8350\uff09"}),"\n",(0,i.jsx)(e.h3,{id:"31-\u57fa\u672c\u4f7f\u7528",children:"3.1 \u57fa\u672c\u4f7f\u7528"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@Service\npublic class UserService {\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    // \u6700\u7b80\u5355\u7684\u4e8b\u52a1\u7ba1\u7406\n    @Transactional\n    public void saveUser(User user) {\n        userRepository.save(user);\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"32-\u914d\u7f6e",children:"3.2 \u914d\u7f6e"}),"\n",(0,i.jsx)(e.p,{children:"\u9700\u8981\u5728\u914d\u7f6e\u7c7b\u4e2d\u542f\u7528\u4e8b\u52a1\u7ba1\u7406\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@Configuration\n@EnableTransactionManagement  // \u542f\u7528\u4e8b\u52a1\u7ba1\u7406\npublic class AppConfig {\n    \n    @Bean\n    public PlatformTransactionManager transactionManager(DataSource dataSource) {\n        return new DataSourceTransactionManager(dataSource);\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u6216\u5728XML\u914d\u7f6e\u4e2d\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:'<tx:annotation-driven transaction-manager="transactionManager" />\n\n<bean id="transactionManager" \n      class="org.springframework.jdbc.datasource.DataSourceTransactionManager">\n    <property name="dataSource" ref="dataSource" />\n</bean>\n'})}),"\n",(0,i.jsx)(e.h2,{id:"4-transactional\u8be6\u89e3",children:"4. @Transactional\u8be6\u89e3"}),"\n",(0,i.jsx)(e.h3,{id:"41-\u5e38\u7528\u5c5e\u6027",children:"4.1 \u5e38\u7528\u5c5e\u6027"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Transactional(\n    // \u4e8b\u52a1\u7684\u4f20\u64ad\u884c\u4e3a\n    propagation = Propagation.REQUIRED,\n    \n    // \u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\n    isolation = Isolation.READ_COMMITTED,\n    \n    // \u662f\u5426\u53ea\u8bfb\n    readOnly = false,\n    \n    // \u8d85\u65f6\u65f6\u95f4\uff08\u79d2\uff09\n    timeout = 30,\n    \n    // \u6307\u5b9a\u54ea\u4e9b\u5f02\u5e38\u9700\u8981\u56de\u6eda\n    rollbackFor = Exception.class,\n    \n    // \u6307\u5b9a\u54ea\u4e9b\u5f02\u5e38\u4e0d\u9700\u8981\u56de\u6eda\n    noRollbackFor = {IllegalArgumentException.class},\n    \n    // \u6307\u5b9a\u4f7f\u7528\u7684\u4e8b\u52a1\u7ba1\u7406\u5668\n    value = "transactionManager"\n)\npublic void saveUser(User user) {\n    // \u4e1a\u52a1\u903b\u8f91\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"42-\u4f20\u64ad\u884c\u4e3apropagation",children:"4.2 \u4f20\u64ad\u884c\u4e3a\uff08Propagation\uff09"}),"\n",(0,i.jsx)(e.p,{children:"\u4f20\u64ad\u884c\u4e3a\u5b9a\u4e49\u4e86\u4e8b\u52a1\u65b9\u6cd5\u8c03\u7528\u53e6\u4e00\u4e2a\u4e8b\u52a1\u65b9\u6cd5\u65f6\u5982\u4f55\u5904\u7406\u4e8b\u52a1\u3002"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u4f20\u64ad\u884c\u4e3a"}),(0,i.jsx)(e.th,{children:"\u8bf4\u660e"}),(0,i.jsx)(e.th,{children:"\u573a\u666f"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"REQUIRED"})}),(0,i.jsx)(e.td,{children:"\u6709\u5219\u7528\uff0c\u65e0\u5219\u521b\u5efa\uff08\u9ed8\u8ba4\uff09"}),(0,i.jsx)(e.td,{children:"\u5927\u591a\u6570\u4e1a\u52a1\u65b9\u6cd5"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"REQUIRES_NEW"})}),(0,i.jsx)(e.td,{children:"\u603b\u662f\u521b\u5efa\u65b0\u4e8b\u52a1"}),(0,i.jsx)(e.td,{children:"\u9700\u8981\u72ec\u7acb\u4e8b\u52a1\u7684\u64cd\u4f5c"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"NESTED"})}),(0,i.jsx)(e.td,{children:"\u5d4c\u5957\u4e8b\u52a1"}),(0,i.jsx)(e.td,{children:"\u5b50\u64cd\u4f5c\u5931\u8d25\u4e0d\u5f71\u54cd\u4e3b\u4e8b\u52a1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"SUPPORTS"})}),(0,i.jsx)(e.td,{children:"\u6709\u5219\u7528\uff0c\u65e0\u5219\u4e0d\u7528"}),(0,i.jsx)(e.td,{children:"\u53ef\u9009\u7684\u4e8b\u52a1\u64cd\u4f5c"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"NOT_SUPPORTED"})}),(0,i.jsx)(e.td,{children:"\u975e\u4e8b\u52a1\u6267\u884c"}),(0,i.jsx)(e.td,{children:"\u660e\u786e\u4e0d\u9700\u8981\u4e8b\u52a1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"MANDATORY"})}),(0,i.jsx)(e.td,{children:"\u5fc5\u987b\u6709\u4e8b\u52a1"}),(0,i.jsx)(e.td,{children:"\u5fc5\u987b\u5728\u4e8b\u52a1\u4e2d\u8c03\u7528"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"NEVER"})}),(0,i.jsx)(e.td,{children:"\u5fc5\u987b\u65e0\u4e8b\u52a1"}),(0,i.jsx)(e.td,{children:"\u4e0d\u80fd\u5728\u4e8b\u52a1\u4e2d\u8c03\u7528"})]})]})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Service\npublic class UserService {\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    @Autowired\n    private LogService logService;\n    \n    // REQUIRED - \u5171\u4eab\u5916\u5c42\u4e8b\u52a1\uff08\u9ed8\u8ba4\uff09\n    @Transactional(propagation = Propagation.REQUIRED)\n    public void saveUser(User user) {\n        userRepository.save(user);\n        logService.log("User saved");  // \u5171\u4eab\u540c\u4e00\u4e2a\u4e8b\u52a1\n    }\n    \n    // REQUIRES_NEW - \u521b\u5efa\u65b0\u4e8b\u52a1\n    @Transactional(propagation = Propagation.REQUIRES_NEW)\n    public void logOperation(String operation) {\n        // \u5373\u4f7f\u5916\u5c42\u4e8b\u52a1\u56de\u6eda\uff0c\u65e5\u5fd7\u4e5f\u4f1a\u88ab\u4fdd\u5b58\n    }\n    \n    // NESTED - \u5d4c\u5957\u4e8b\u52a1\n    @Transactional(propagation = Propagation.NESTED)\n    public void saveUserWithNested(User user) {\n        userRepository.save(user);\n        try {\n            updateStatistics(user);\n        } catch (Exception ex) {\n            // \u7edf\u8ba1\u66f4\u65b0\u5931\u8d25\uff0c\u4f46\u7528\u6237\u4fdd\u5b58\u6210\u529f\n        }\n    }\n}\n\n@Service\npublic class LogService {\n    \n    // \u5982\u679c\u5728\u4e8b\u52a1\u4e2d\u8c03\u7528\uff0c\u4f1a\u4f7f\u7528\u5916\u5c42\u4e8b\u52a1\n    // \u5982\u679c\u4e0d\u5728\u4e8b\u52a1\u4e2d\u8c03\u7528\uff0c\u5219\u521b\u5efa\u65b0\u4e8b\u52a1\n    @Transactional(propagation = Propagation.SUPPORTS)\n    public void log(String message) {\n        // \u8bb0\u5f55\u65e5\u5fd7\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"43-\u9694\u79bb\u7ea7\u522bisolation",children:"4.3 \u9694\u79bb\u7ea7\u522b\uff08Isolation\uff09"}),"\n",(0,i.jsx)(e.p,{children:"\u9694\u79bb\u7ea7\u522b\u5b9a\u4e49\u4e86\u5e76\u53d1\u4e8b\u52a1\u4e4b\u95f4\u7684\u9694\u79bb\u7a0b\u5ea6\u3002"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u9694\u79bb\u7ea7\u522b"}),(0,i.jsx)(e.th,{children:"\u8bf4\u660e"}),(0,i.jsx)(e.th,{children:"\u810f\u8bfb"}),(0,i.jsx)(e.th,{children:"\u4e0d\u53ef\u91cd\u590d\u8bfb"}),(0,i.jsx)(e.th,{children:"\u5e7b\u8bfb"}),(0,i.jsx)(e.th,{children:"\u6027\u80fd"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"READ_UNCOMMITTED"})}),(0,i.jsx)(e.td,{children:"\u8bfb\u672a\u63d0\u4ea4"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u6700\u9ad8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"READ_COMMITTED"})}),(0,i.jsx)(e.td,{children:"\u8bfb\u63d0\u4ea4"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u9ad8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"REPEATABLE_READ"})}),(0,i.jsx)(e.td,{children:"\u53ef\u91cd\u590d\u8bfb"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u4e2d"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"SERIALIZABLE"})}),(0,i.jsx)(e.td,{children:"\u4e32\u884c\u5316"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u6700\u4f4e"})]})]})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@Service\npublic class UserService {\n    \n    // \u6700\u5e38\u7528\u7684\u9694\u79bb\u7ea7\u522b\n    @Transactional(isolation = Isolation.READ_COMMITTED)\n    public void saveUser(User user) {\n        // \u53ef\u4ee5\u770b\u5230\u5176\u4ed6\u4e8b\u52a1\u5df2\u63d0\u4ea4\u7684\u6570\u636e\n        // \u4f46\u4e0d\u4f1a\u770b\u5230\u672a\u63d0\u4ea4\u7684\u6570\u636e\n    }\n    \n    // \u6700\u4e25\u683c\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u6027\u80fd\u6700\u4f4e\n    @Transactional(isolation = Isolation.SERIALIZABLE)\n    public void criticalOperation() {\n        // \u5b8c\u5168\u9694\u79bb\uff0c\u4e0d\u53d7\u5176\u4ed6\u4e8b\u52a1\u5f71\u54cd\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"44-\u53ea\u8bfb\u4e8b\u52a1",children:"4.4 \u53ea\u8bfb\u4e8b\u52a1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u53ea\u8bfb\u4e8b\u52a1\uff08\u4f18\u5316\u67e5\u8be2\u6027\u80fd\uff09\n@Transactional(readOnly = true)\npublic User getUserById(Long id) {\n    return userRepository.findById(id);\n}\n\n// \u975e\u53ea\u8bfb\u4e8b\u52a1\uff08\u9ed8\u8ba4\uff09\n@Transactional(readOnly = false)\npublic void updateUser(User user) {\n    userRepository.save(user);\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"45-\u8d85\u65f6\u8bbe\u7f6e",children:"4.5 \u8d85\u65f6\u8bbe\u7f6e"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u4e3a30\u79d2\n@Transactional(timeout = 30)\npublic void longRunningOperation() {\n    // \u5982\u679c\u8d85\u8fc730\u79d2\u672a\u5b8c\u6210\uff0c\u4f1a\u629b\u51fa\u5f02\u5e38\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"46-\u5f02\u5e38\u5904\u7406",children:"4.6 \u5f02\u5e38\u5904\u7406"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Service\npublic class UserService {\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    // \u6240\u6709\u5f02\u5e38\u90fd\u56de\u6eda\n    @Transactional(rollbackFor = Exception.class)\n    public void saveUser(User user) {\n        userRepository.save(user);\n        throw new RuntimeException("Failed");  // \u4f1a\u56de\u6eda\n    }\n    \n    // \u6307\u5b9a\u56de\u6eda\u5f02\u5e38\n    @Transactional(rollbackFor = {IOException.class, SQLException.class})\n    public void createUserWithFile(User user, File file) throws IOException {\n        userRepository.save(user);\n        // \u5982\u679c\u629b\u51faIOException\u6216SQLException\uff0c\u5219\u56de\u6eda\n    }\n    \n    // \u6307\u5b9a\u4e0d\u56de\u6eda\u7684\u5f02\u5e38\n    @Transactional(noRollbackFor = {IllegalArgumentException.class})\n    public void saveUserWithValidation(User user) {\n        if (user.getAge() < 0) {\n            throw new IllegalArgumentException("Invalid age");  // \u4e0d\u4f1a\u56de\u6eda\n        }\n        userRepository.save(user);\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"5-\u4e8b\u52a1\u7684\u56de\u6eda",children:"5. \u4e8b\u52a1\u7684\u56de\u6eda"}),"\n",(0,i.jsx)(e.h3,{id:"51-\u81ea\u52a8\u56de\u6eda",children:"5.1 \u81ea\u52a8\u56de\u6eda"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Service\npublic class UserService {\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    @Transactional\n    public void saveUser(User user) {\n        userRepository.save(user);\n        \n        // \u2705 RuntimeException\u81ea\u52a8\u56de\u6eda\n        throw new RuntimeException("Error");\n    }\n    \n    @Transactional(rollbackFor = Exception.class)\n    public void saveUserWithChecked(User user) throws Exception {\n        userRepository.save(user);\n        \n        // \u2705 \u68c0\u67e5\u5f02\u5e38\u4e5f\u4f1a\u56de\u6eda\n        throw new Exception("Error");\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"52-\u624b\u52a8\u56de\u6eda",children:"5.2 \u624b\u52a8\u56de\u6eda"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Service\npublic class UserService {\n    \n    @Autowired\n    private UserRepository userRepository;\n    \n    @Transactional\n    public void saveUserWithManualRollback(User user) {\n        userRepository.save(user);\n        \n        // \u83b7\u53d6\u4e8b\u52a1\u72b6\u6001\n        TransactionInterceptor.currentTransactionStatus().setRollbackOnly();\n        \n        // \u6216\u8005\u901a\u8fc7\u629b\u51fa\u5f02\u5e38\n        throw new RuntimeException("Rollback");\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"6-\u5e38\u89c1\u95ee\u9898",children:"6. \u5e38\u89c1\u95ee\u9898"}),"\n",(0,i.jsx)(e.h3,{id:"61-self-invocation\u95ee\u9898",children:"6.1 self-invocation\u95ee\u9898"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@Service\npublic class UserService {\n    \n    @Transactional\n    public void register(User user) {\n        saveUser(user);  // \u274c saveUser\u7684@Transactional\u5931\u6548\n        notifyUser(user);\n    }\n    \n    @Transactional\n    public void saveUser(User user) {\n        // \u4e8b\u52a1\u5931\u6548\n    }\n    \n    // \u2705 \u89e3\u51b3\u65b9\u68481\uff1a\u6ce8\u5165\u81ea\u5df1\n    @Autowired\n    private UserService userService;\n    \n    public void registerFixed(User user) {\n        userService.saveUser(user);  // \u901a\u8fc7\u4ee3\u7406\u8c03\u7528\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"62-private\u65b9\u6cd5\u4e0d\u751f\u6548",children:"6.2 private\u65b9\u6cd5\u4e0d\u751f\u6548"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@Service\npublic class UserService {\n    \n    // \u274c private\u65b9\u6cd5\u7684@Transactional\u4e0d\u751f\u6548\n    @Transactional\n    private void saveUserPrivate(User user) {\n    }\n    \n    // \u2705 public\u65b9\u6cd5\u624d\u80fd\u88ab\u62e6\u622a\n    @Transactional\n    public void saveUser(User user) {\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"63-\u6ce8\u89e3\u5728\u63a5\u53e3\u4e0a",children:"6.3 \u6ce8\u89e3\u5728\u63a5\u53e3\u4e0a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u2705 \u63a8\u8350\uff1a\u6ce8\u89e3\u5728\u5b9e\u73b0\u7c7b\u4e0a\n@Service\npublic class UserServiceImpl implements UserService {\n    @Transactional\n    public void save(User user) {\n    }\n}\n\n// \u6216\u8005\u5728\u63a5\u53e3\u4e0a\uff08\u4f46\u4e0d\u63a8\u8350\uff09\npublic interface UserService {\n    @Transactional\n    void save(User user);\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"7-\u5b9e\u6218\u793a\u4f8b",children:"7. \u5b9e\u6218\u793a\u4f8b"}),"\n",(0,i.jsx)(e.h3,{id:"71-\u8f6c\u8d26\u793a\u4f8b",children:"7.1 \u8f6c\u8d26\u793a\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Service\npublic class AccountService {\n    \n    @Autowired\n    private AccountRepository accountRepository;\n    \n    @Transactional\n    public void transfer(Long fromId, Long toId, BigDecimal amount) {\n        // \u83b7\u53d6\u8d26\u6237\n        Account fromAccount = accountRepository.findById(fromId);\n        Account toAccount = accountRepository.findById(toId);\n        \n        // \u9a8c\u8bc1\u4f59\u989d\n        if (fromAccount.getBalance().compareTo(amount) < 0) {\n            throw new IllegalArgumentException("Insufficient balance");\n        }\n        \n        // \u6267\u884c\u8f6c\u8d26\n        fromAccount.setBalance(fromAccount.getBalance().subtract(amount));\n        toAccount.setBalance(toAccount.getBalance().add(amount));\n        \n        // \u66f4\u65b0\u8d26\u6237\n        accountRepository.save(fromAccount);\n        accountRepository.save(toAccount);\n        \n        // \u5982\u679c\u4efb\u4f55\u64cd\u4f5c\u5931\u8d25\uff0c\u6574\u4e2a\u4e8b\u52a1\u56de\u6eda\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"72-\u8ba2\u5355\u5904\u7406\u793a\u4f8b",children:"7.2 \u8ba2\u5355\u5904\u7406\u793a\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Service\npublic class OrderService {\n    \n    @Autowired\n    private OrderRepository orderRepository;\n    \n    @Autowired\n    private InventoryService inventoryService;\n    \n    @Autowired\n    private PaymentService paymentService;\n    \n    @Transactional(\n        propagation = Propagation.REQUIRED,\n        isolation = Isolation.READ_COMMITTED,\n        rollbackFor = Exception.class\n    )\n    public void placeOrder(Order order) {\n        // 1. \u4fdd\u5b58\u8ba2\u5355\n        orderRepository.save(order);\n        \n        // 2. \u6263\u51cf\u5e93\u5b58\n        for (OrderItem item : order.getItems()) {\n            inventoryService.decreaseStock(item.getProductId(), item.getQuantity());\n        }\n        \n        // 3. \u5904\u7406\u652f\u4ed8\n        try {\n            paymentService.processPayment(order);\n        } catch (PaymentException ex) {\n            // \u652f\u4ed8\u5931\u8d25\uff0c\u4e8b\u52a1\u56de\u6eda\n            throw new OrderException("Payment failed", ex);\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"8-\u603b\u7ed3",children:"8. \u603b\u7ed3"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4f20\u64ad\u884c\u4e3a"}),(0,i.jsx)(e.td,{children:"\u51b3\u5b9a\u4e8b\u52a1\u5982\u4f55\u4f20\u9012"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9694\u79bb\u7ea7\u522b"}),(0,i.jsx)(e.td,{children:"\u51b3\u5b9a\u5e76\u53d1\u9694\u79bb\u7a0b\u5ea6"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u53ea\u8bfb\u4e8b\u52a1"}),(0,i.jsx)(e.td,{children:"\u4f18\u5316\u67e5\u8be2\u6027\u80fd"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u8d85\u65f6\u65f6\u95f4"}),(0,i.jsx)(e.td,{children:"\u9632\u6b62\u957f\u65f6\u95f4\u5360\u7528\u8d44\u6e90"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5f02\u5e38\u5904\u7406"}),(0,i.jsx)(e.td,{children:"\u63a7\u5236\u4f55\u65f6\u56de\u6eda"})]})]})]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6700\u4f73\u5b9e\u8df5"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528\u58f0\u660e\u5f0f\u4e8b\u52a1\u7ba1\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u4e8b\u52a1\u65b9\u6cd5\u5e94\u8be5\u5c3d\u53ef\u80fd\u77ed"}),"\n",(0,i.jsx)(e.li,{children:"\u907f\u514d\u5728\u4e8b\u52a1\u4e2d\u6267\u884c\u957f\u65f6\u95f4\u64cd\u4f5c"}),"\n",(0,i.jsx)(e.li,{children:"\u5408\u7406\u9009\u62e9\u9694\u79bb\u7ea7\u522b\u548c\u4f20\u64ad\u884c\u4e3a"}),"\n",(0,i.jsx)(e.li,{children:"\u53ea\u8bfb\u4e8b\u52a1\u53ef\u4ee5\u4f18\u5316\u6027\u80fd"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4e0b\u4e00\u6b65"}),"\uff1a\u5b66\u4e60",(0,i.jsx)(e.a,{href:"/docs/spring/spring-mvc",children:"Spring MVC"})]})]})}function h(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}}}]);